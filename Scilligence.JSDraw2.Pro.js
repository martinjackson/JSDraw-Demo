
//////////////////////////////////////////////////////////////////////////////////
//
// Scilligence JSDraw
// Copyright Scilligence Corporation, 2020
// Version 6.3.0.34143
// http://www.scilligence.com/
//
//////////////////////////////////////////////////////////////////////////////////

scilligence={_base:function(){}};oln=scilligence;scil=scilligence;scilligence.overwrite=scilligence.apply=function(f,c,d){var h=true;if(d!=null){if(d===true||d===false){h=d}else{if(typeof(d)=="object"){scilligence.apply(f,d)}}}if(f&&c&&typeof(c)=="object"){for(var g in c){if(h||f[g]==null){f[g]=c[g]}}}return f};DEBUG={enable:false,clear:function(){if(DEBUG.enable){document.getElementById("DEBUG").value=""}},print:function(d){if(DEBUG.enable){var c=document.getElementById("DEBUG");c.value+=d+"\n"}}};scilligence.apply(scilligence,{extend:function(){var c=function(f){for(var g in f){this[g]=f[g]}};var d=Object.prototype.constructor;return function(h,l,g){if(typeof l=="object"){g=l;l=h;h=g.constructor!=d?g.constructor:function(){l.apply(this,arguments)}}var f=function(){};var n=l.prototype;f.prototype=n;var j=h.prototype=new f();j.constructor=h;h.superclass=n;if(n.constructor==d){n.constructor=l}h.override=function(q){scilligence.override(h,q)};j.superclass=j.supr=(function(){return n});j.override=c;scilligence.override(h,g);h.extend=function(q){return scilligence.extend(h,q)};return h}}(),override:function(c,d){if(d){var f=c.prototype;scilligence.apply(f,d);if(document.all!=null&&d.hasOwnProperty("toString")){f.toString=d.toString}}},clone:function(d){if(d==null){return null}if(d.length!=null){return d.concat([])}var c={};scil.apply(c,d);return c},cloneArray:function(g){if(g==null){return null}if(g.length!=null){var f=[];for(var d=0;d<g.length;++d){if(typeof g[d]=="object"){f[d]=scil.clone(g[d])}else{f[d]=g[d]}}return f}var c={};scil.apply(c,g);return c},byId:function(c){return document.getElementById(c)},connect:function(d,f,c){if(d==null||f==null||f==""||c==null){return}if(d.addEventListener!=null){d.addEventListener(f.substr(2),function(g){c(g,d)})}else{if(d.attachEvent!=null){d.attachEvent(f,function(g){c(g,d)})}else{dojo.connect(d,f,function(g){c(g,d)})}}}});scilligence.ready=dojo.ready;scilligence.onload=dojo.addOnLoad;function getIEVersion(){if(window.navigator.appName!="Microsoft Internet Explorer"&&window.navigator.appName.indexOf("MSAppHost")<0&&!(window.navigator.appVersion.indexOf("Trident")>0&&document.documentMode>=11)){return false}return document.documentMode==null?(document.compatMode=="CSS1Compat"?7:6):document.documentMode}var __ieversion=getIEVersion();var __ieAppVersion=__ieversion?(window.postMessage?(window.performance?9:8):7):null;if(__ieversion){var silverlight=typeof(JSDraw2_disablesilverlight)=="undefined"||!JSDraw2_disablesilverlight?"silverlight,":"";if(dojo.version.major<=1&&dojo.version.minor<7){dojo.config.gfxRenderer=silverlight+"vml"}else{if(__ieversion<9){dojo.config.gfxRenderer=silverlight+"vml,svg"}}}dojo.require("dojo.io.script");dojo.require("dojo.io.iframe");dojo.require("dojox.gfx");dojo.require("dojox.gfx.utils");dojo.require("dojo.window");if(typeof(__JSDraw2_TouchMol)=="undefined"){dojo.require("dojox.charting.Chart2D");dojo.require("dojox.charting.axis2d.Default");dojo.require("dojox.charting.plot2d.Default");dojo.require("dojox.charting.themes.Wetland")}if(!(dojo.version.major<=1&&dojo.version.minor<=6)){dojo.require("dojox.storage.LocalStorageProvider")}if(dojo.version.major<=1&&dojo.version.minor<7){scil.onload(function(){dojox.gfx.Text.prototype._renderShape=function(c){var d=this.shape;c.save();c.fillStyle=d.fillStyle;c.strokeStyle=d.fillStyle;c.font=d.fontStyle;c.textAlign=d.align;c.fillText(d.text,d.x,d.y);c.restore();c.stroke()}})}scilligence.suggestInstallSilverlight=function(){if(dojox.gfx.renderer=="vml"){if(confirm("JSDraw2.Editor runs much faster with Silverlight in IE 6,7,8.  Do you want to install Silvelight now?")){window.open("http://www.silverlight.net/downloads")}}};function _isHtml5(){var c=__ieversion;if(c){return c>=9}else{return document.doctype!=null&&document.doctype.name!=null&&document.doctype.name.toLowerCase()=="html"}}function getAndroidVersion(){var d=window.navigator.userAgent;var c=d.indexOf("Android");if(c<0){return false}d=d.substr(c+8);c=d.indexOf(";");d=d.substr(0,c);c=d.indexOf(".");if(c>0){d=d.substr(0,c)}return isNaN(d)?true:parseFloat(d)}function getiOSVersion(){var d=window.navigator.userAgent;var c=d.indexOf("iPad");if(c<0){c=d.indexOf("iPhone")}if(c<0){return false}var c=d.indexOf("OS",c+4);if(c<0){return true}d=d.substr(c+3);c=d.indexOf("_");d=d.substr(0,c);c=d.indexOf(".");if(c>0){d=d.substr(0,c)}return isNaN(d)?true:parseInt(d)}scilligence.Utils={__xcode:10,isIE:__ieversion,isIE8Lower:__ieversion&&__ieversion<9,nativemode:window.navigator.appName.indexOf("MSAppHost")>=0,isHtml5:_isHtml5(),isFirefox:navigator.userAgent.indexOf("Firefox")>=0,isOpera:navigator.userAgent.indexOf("Opera")>=0,isChrome:navigator.userAgent.indexOf("Chrome")>=0,isEdge:navigator.userAgent.indexOf("Edge/")>=0,isLinux:navigator.userAgent.indexOf("Linux")>=0,isUbuntu:navigator.userAgent.indexOf("Ubuntu")>=0,isIpad:getiOSVersion(),isAndroid:getAndroidVersion(),isTouch:navigator.userAgent.indexOf("iPad")>=0||navigator.userAgent.indexOf("iPhone")>=0||navigator.userAgent.indexOf("Android")>=0,isSilverlight:null,lastTouchTm:0,buttonWidth:160,getTopWindow:function(){var c=window;while(c.parent!=null&&c.parent!=c){c=c.parent}return c},isRightButton:function(c){if(c==null){return}if(c.which){return c.which==3}else{if("button" in c){return c.button==2}}return false},isTouchDblClick:function(f){var g=new Date().getTime();var c=g-scil.Utils.lastTouchTm;scil.Utils.lastTouchTm=g;return f.touches.length==1&&c<=500},hasAnsestor:function(c,d){if(d==null||c==null){return false}while(c!=null){if(c.parentNode==d){return true}c=c.parentNode}return false},round:function(d,c){return scil.Math.round(d,c)},roundToSignificantDigits:function(c,f){if(c==0||isNaN(c)){return c}var g=Math.pow(10,Math.floor(this.log10(Math.abs(c)))+1);return g*this.round(c/g,f)},log10:function(c){return scil.Math.log10(c)},roundStr:function(w,j,q){if(w==null||isNaN(w)){return""}else{if(w==0){return"0"}}var c=Math.pow(10,j);var u=(Math.round(w*c)/c)+"";if(u=="0"&&w!=0||j>0&&(Math.abs(w)<1/c||w<1&&u.length<(w+"").length)){var f=Math.floor(this.log10(w));if(f<1){var t=this.roundStr(w*Math.pow(10,-f),j,q)+"e"+f;return parseFloat(t)==parseFloat(u)?u:t}}if(q==false||j<=0){return u}var l=u.indexOf(".");if(l<0){u+=".";l=u.length-1}var h=u.length-1-l;for(var g=h;g<j;++g){u+="0"}return u},num2str:function(h,d,g,f,c){if(h==null||!isFinite(h)||isNaN(h)){return""}if(g==null){return this.roundStr(h,d,f)}else{if(g=="%"){return this.roundStr(h*100,d,f)+g}else{if(c){return this.roundStr(h,d,f)+g}}}if(g=="L"||g=="l"){g=g.toUpperCase()}if(Math.abs(h)>=1000){return this.roundStr(h/1000,d,f)+" "+this._convertUnit(g,1000)}if(Math.abs(h)>=1){return this.roundStr(h,d,f)+" "+this._convertUnit(g,1)}h*=1000;if(Math.abs(h)>=1){return this.roundStr(h,d,f)+" "+this._convertUnit(g,0.001)}h*=1000;return this.roundStr(h,d,f)+" "+this._convertUnit(g,1e-06)},_convertUnit:function(d,c){switch(c){case 1:if(d=="g/L"){return"mg/mL"}else{if(d=="U/L"){return"mU/mL"}else{return d}}case 1000:if(d=="g/L"){return"g/mL"}else{if(d=="U/L"){return"U/mL"}else{return"k"+d}}case 0.001:if(d=="g/L"||d=="mg/mL"){return"mg/L"}else{if(d=="U/L"||d=="mU/mL"){return"mU/L"}else{return"m"+d}}case 1e-06:if(d=="g/L"||d=="mg/mL"){return"μg/L"}else{if(d=="U/L"||d=="mU/mL"){return"μU/L"}else{return"μ"+d}}}},disabledcontextmenus:[],disableContextMenu:function(d,c){if(d!=null&&scil.Utils.indexOf(this.disabledcontextmenus,d)<0){this.disabledcontextmenus.push(d)}if(c==null){c=document}if(c.body.__contextmenudisabled){return}c.body.__contextmenudisabled=true;c.body.oncontextmenu=function(g){if(g==null){g=event}var l=g.target||g.srcElement;var j=scil.Utils.disabledcontextmenus;for(var h=0;h<j.length;++h){if(l==j[h]||scil.Utils.isChildOf(l,j[h])){return false}}if(l.parentNode!=null&&JSDraw2.Editor.get(l.parentNode.id)!=null||l.firstChild!=null&&l.firstChild.getAttribute!=null&&l.firstChild.getAttribute("jspopupmenu")=="1"){if(g.preventDefault!=null){g.preventDefault()}return false}if(scil.ContextMenu.isFromContextMenu(l)){if(g.preventDefault!=null){g.preventDefault()}return false}var f=scil.Utils.getParent(l,"div");if(f!=null&&JSDraw2.Editor.get(f.id)!=null){if(g.preventDefault!=null){g.preventDefault()}return false}}},serviceAvailable:function(){return typeof JSDrawServices!="undefined"&&typeof JSDrawServices.url!="undefined"&&JSDrawServices.url!=null},eval:function(s){if(s==null||s==""||typeof(s)!="string"){return null}try{eval("var s="+s);return s}catch(e){}return null},isTrue:function(c){c=(c+"").toLowerCase();return c=="1"||c=="true"||c=="yes"||c=="on"},isFalse:function(c){c=(c+"").toLowerCase();return c=="0"||c=="false"||c=="no"||c=="off"},isAttTrue:function(d,c){var f=d.getAttribute(c)+"";return f==""||this.isTrue(f)},isAttFalse:function(d,c){var f=d.getAttribute(c)+"";return f=="0"||f.toLowerCase()=="false"},formatStr:function(g,h,c){var f=g==null?"":g.toFixed(c)+"";return scil.Utils.padLeft(f,h," ")},uuid:function(){var c="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split("");var h=[];var d;var g=c.length;var f;h[8]=h[13]=h[18]=h[23]="-";h[14]="4";for(d=0;d<36;d++){if(!h[d]){f=0|Math.random()*16;h[d]=c[(d==19)?(f&3)|8:f]}}return h.join("").toLowerCase()},padLeft:function(h,g,d){var j="";for(var f=(h+"").length;f<g;++f){j+=(d==null?" ":d)}return j+h},padRight:function(h,g,d){var j="";for(var f=h.length;f<g;++f){j+=(d==null?" ":d)}return h+j},endswith:function(d,g,c){if(d==null||g==null||d.length<g.length){return false}var f=d.substr(d.length-g.length,g.length);if(c){return f==g}else{return f.toLowerCase()==g.toLowerCase()}},startswith:function(d,g,c){if(d==null||g==null||d.length<g.length){return false}var f=d.substr(0,g.length);if(c){return f==g}else{return f.toLowerCase()==g.toLowerCase()}},trim:function(c){return c==null?null:c.replace(/^[\s|\t\r\n]+|[\s|\t\r\n]+$/g,"")},ltrim:function(c){return c==null?null:c.replace(/^[\s|\t\r\n]+/,"")},rtrim:function(c){return c==null?null:c.replace(/[\s|\t\r\n]+$/,"")},isFixedPosition:function(c){while(c!=null){if(c.style!=null&&c.style.position=="fixed"){return true}c=c.parentNode}return false},getOffset:function(h,t,l){var c=scil.Utils.getScrollOffset(h.parentNode);var q=new JSDraw2.Point(0,0);var j=h;while(h!=null){if(h.offsetLeft>0||h.offsetTop>0){q.offset(h.offsetLeft,h.offsetTop)}if(this.isIE&&(h.scrollLeft>0||h.scrollTop>0)){q.offset(h.scrollLeft,h.scrollTop)}if(scil.Utils.isIE){if(h.scrollTop>0||h.scrollLeft>0){q.offset(-h.scrollLeft,-h.scrollTop)}}if(q.absolute==null&&h.style.position=="absolute"){q.absolute={x:h.offsetLeft,y:h.offsetTop}}h=h.offsetParent}var n=false;while(j!=null){if(j.style!=null&&j.style.position=="fixed"){n=true;break}j=j.parentNode}if(t!=false&&!n){q.offset(-c.x,-c.y)}if(n){q.fixedposition=true}else{var f=window.scrollX||window.pageXOffset;var g=window.scrollY||window.pageYOffset;if(l&&(f>0||g>0)){q.x+=f;q.y+=g}}return q},getScrollOffset:function(c){var d=new JSDraw2.Point(0,0);while(c!=null){if(c.scrollLeft>0||c.scrollTop>0){d.offset(c.scrollLeft,c.scrollTop)}c=c.parentNode}return d},scrollOffset:function(){var c=(document.compatMode&&document.compatMode!="BackCompat")?document.documentElement:document.body;var d=scil.Utils.isIE?c.scrollLeft:pageXOffset;var f=scil.Utils.isIE?c.scrollTop:pageYOffset;return new JSDraw2.Point(d,f)},scriptUrl:function(){if(this._scripturl!=null){return this._scripturl}if(JSDraw2.defaultoptions.imagebase!=null){this._scripturl=JSDraw2.defaultoptions.imagebase}if(this._scripturl!=null){return this._scripturl}var g=document.getElementsByTagName("script");for(var f=0;f<g.length;f++){var c=g[f];if(c.tagName=="SCRIPT"){var l=c.getAttribute("src");if(l==null||l.length==0){continue}var h=l.lastIndexOf("/");var j=h<0?"":scil.Utils.trim(l.substr(0,h+1));var d=scil.Utils.trim(h<0?l:l.substr(h+1)).toLowerCase();h=d.indexOf("?");if(h>0){d=d.substr(0,h)}if(this.startswith(d,"scilligence.jsdraw2.")&&this.endswith(d,".js")){if(scil.Utils.startswith(j,"http://")||scil.Utils.startswith(j,"https://")||scil.Utils.startswith(j,"//")){return this._scripturl=j}if(scil.Utils.startswith(j,"/")){return this._scripturl=document.location.protocol+"//"+document.location.host+j}var n=document.location+"";h=n.indexOf("?");if(h>0){n=n.substr(0,h)}h=n.lastIndexOf("/");return this._scripturl=n.substr(0,h+1)+j}else{if(d=="jsdraw.core.js"){return this._scripturl=j+"../"}}}}return null},_imgBase:function(){return scil.Utils.scriptUrl()},imgSrc:function(c,f){var d=scil.Utils._imgBase()+c;if(f){d="url("+d+")"}return d},imgTag:function(c,f,d){return"<img"+(d==null?"":" "+d)+" src='"+this.imgSrc("img/"+c)+"'>"+(f==null?"":f)},styleRect:function(c){return new JSDraw2.Rect(scil.Utils.parsePixel(c.style.left),scil.Utils.parsePixel(c.style.top),scil.Utils.parsePixel(c.style.width),scil.Utils.parsePixel(c.style.height))},parsePixel:function(d,c){if(d==null){return null}if(!scil.Utils.endswith(d,"px")){return c}d=d.substr(0,d.length-2);return isNaN(d)?c:parseInt(d)},cloneArray:function(c){var d=[];this.mergeArray(d,c);return d},mergeArray:function(c,f){for(var d=0;d<f.length;++d){c.push(f[d])}},fingArrayIndex:function(c,d){for(var f=0;f<c.length;++f){if(c[f]==d){return f}}return -1},getFunctionName:function(c){if(typeof c=="function"){var d=(c+"").match(/function\s*([\w\$]*)\s*\(/);if(d!==null){return d[1]}}return null},splitCsvRow:function(l){if(l==null||l=="\r"||l==""){return}if(l.substr(l.length-1)=="\r"){l=l.substr(0,l.length-1)}var j=[];var h=false;var n="";for(var g=0;g<l.length;++g){var d=l.substr(g,1);if(d=='"'){if(!h){if(n==""){h=true}else{n+=d}}else{if(g<l.length-1){var f=l.substr(g+1,1);if(f=='"'){n+=d;++g}else{if(f==","){j.push(n);n="";h=false;++g}else{n+=d}}}else{h=false}}}else{if(d==","){if(h){n+=d}else{j.push(n);n=""}}}}j.push(n);return j},escCsvValue:function(c){if(c==null){return""}if(typeof(c)!="string"){c=c+""}if(c.indexOf(",")>=0||c.indexOf('"')>=0||c.indexOf("\r")>=0||c.indexOf("\n")>=0){c='"'+c.replace(/[\"]/g,'""').replace(/\r\n/g,"")+'"'}return c},unescXmlValue:function(c){if(c==null){return""}return c.replace(/&lt;/gi,"<").replace(/&gt;/gi,">").replace(/&#xA;/gi,"\n").replace(/&apos;/g,"'").replace(/&quot;/g,'"').replace(/&amp;/gi,"&")},escXmlValue:function(d,c){if(d==null){return""}if(typeof(d)!="string"){d=d+""}if(c){d=scil.Utils.trim(d)}return d.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\r/g,"&#xD;").replace(/\n/g,"&#xA;").replace(/'/g,"&apos;").replace(/"/g,"&quot;")},escUrlData:function(h){if(h==null){return h}var g="";for(var f=0;f<h.length;++f){var d=h.charCodeAt(f);var j=h.substr(f,1);if(d>255){g+=j}else{if(j=="+"){g+="%2b"}else{g+=escape(j)}}}return g},escFileName:function(h){if(h==null){return h}var g="";for(var f=0;f<h.length;++f){var d=h.substr(f,1);if(h.charCodeAt(f)>255||/[a-z|0-9|_| |\-|\(|\)|\{|\}|\[|\]|\.]/ig.test(d)){g+=d}else{g+="_"}}return g},getFirstChild:function(d,f){if(d==null){return null}for(var c=0;c<d.childNodes.length;++c){if(d.childNodes[c].tagName==f){return d.childNodes[c]}}return null},parseXml:function(d){var c=this.parseXml2(d);if(c!=null&&c.succeeded){return c.doc}return null},parseXml2:function(h){if(h==null){return null}h=this.trim(h);if(h.length<10||h.substr(0,1)!="<"||h.substr(h.length-1,1)!=">"){return null}var g=false;var f=null;var c=null;try{h=h.replace(/&nbsp;/g," ");if(window.DOMParser){c=new DOMParser().parseFromString(h,"text/xml")}else{c=new ActiveXObject("Microsoft.XMLDOM");c.async="false";c.loadXML(h)}g=true}catch(d){f=d.message}return{succeeded:g,error:f,doc:c}},xquery:function(f,t,w){if(f==null||t==null||t==""){return null}var u=null;var n=t.split("/");for(var h=0;h<n.length;++h){var x=n[h];if(x==""){continue}var y=x.replace(/[\[]@[a-z]+[0-9|a-z]{0,9}='[^\']+'[\]]$/,"");x=x.substr(y.length+2,x.length-(y.length+3));var l=null;var z=null;var q=x.indexOf("=");if(q>0){l=x.substr(0,q);q+=2;z=x.substr(q,x.length-q-1)}var g=null;for(var j=0;j<f.childNodes.length;++j){var d=f.childNodes[j];if(d.tagName==y){if(l==null||d.getAttribute(l)==z){g=d}}if(g!=null){if(h==n.length-1){if(w){return g}if(u==null){u=[g]}else{u.push(g)}}else{g=d;break}}}if(u!=null){return u}if(g==null){return null}else{f=g}}return null},parseJson:function(s){return this.eval(s)},containsWord:function(f,g,d){if(f==null||g==null||f==""||g==""){return false}if(d){g=g.toLowerCase()}var h=f.toLowerCase().split(/\W+/);for(var c=0;c<h.length;++c){if(h[c]==g){return true}}return false},alert2:function(h,d,c,f,u){if(scil.Utils.alertdlg==null){var n=scil.Utils.createTable();var t=scil.Utils.createElement(n,"tr");var g=scil.Utils.createElement(scil.Utils.createElement(t,"td",null,{verticalAlign:"top"}),"img",null,{height:"50px",width:"50px"});var q=scil.Utils.createElement(t,"td",null,{textAlign:"center"});var j=scil.Utils.createElement(q,"div",null,{padding:"10px",textAlign:"left",maxWidth:"800px",maxHeight:"400px",overflow:"auto",color:"#000"});var l=scil.Utils.createElement(q,"button",scil.Utils.imgTag("tick.gif",this.res("OK")),{width:"80px"});scil.Utils.alertdlg=new JSDraw2.Dialog("Attention",n.parentNode);scil.Utils.alertdlg.msg=j;scil.Utils.alertdlg.img=g;dojo.connect(l,"onclick",function(x){var w=scil.Utils.alertdlg;if(w.callback!=null){w.callback()}w.hide();x.preventDefault()})}if(f==null||f==""){f=scil.Utils.imgSrc("img/information.gif")}else{if(!scil.Utils.startswith(f,"http:")){f=scil.Utils.imgSrc("img/"+f+".gif")}}scil.Utils.alertdlg.show(d);scil.Utils.alertdlg.callback=c;scil.Utils.alertdlg.msg.innerHTML=h==null?"":"<div style='margin:0;max-width:800px;'>"+h+"</div>";scil.Utils.alertdlg.img.src=f;scil.Utils.alertdlg.moveCenter()},confirm:function(h,c,f,g,n){if(scil.Utils.confirmdlg==null){var q=scil.Utils.createTable();var u=scil.Utils.createElement(q,"tr");scil.Utils.createElement(u,"td","<img style='width:50px;height:50px;' src='"+scil.Utils.imgSrc("img/question.gif")+"'>",{verticalAlign:"top"});var t=scil.Utils.createElement(u,"td",null,{textAlign:"center"});var j=scil.Utils.createElement(t,"div",null,{padding:"10px",textAlign:"left",maxHeight:"360px",color:"black"});var w=scil.Utils.createElement(t,"button",this.res("Yes"),{width:"80px"});var l=scil.Utils.createElement(t,"button",this.res("No"),{width:"80px"});var d=scil.Utils.createElement(t,"button",this.res("Cancel"),{width:"80px"});scil.Utils.confirmdlg=new JSDraw2.Dialog(this.res("Attention"),q.parentNode);scil.Utils.confirmdlg.msg=j;scil.Utils.confirmdlg.cancel=d;dojo.connect(w,"onclick",function(y){var x=scil.Utils.confirmdlg;x.hide();y.preventDefault();if(x.callback!=null){x.callback(true)}});dojo.connect(l,"onclick",function(y){var x=scil.Utils.confirmdlg;x.hide();y.preventDefault();if(x.callback!=null){x.callback(false)}});dojo.connect(d,"onclick",function(y){var x=scil.Utils.confirmdlg;x.hide();y.preventDefault();if(x.callback!=null){x.callback("cancel")}})}scil.Utils.confirmdlg.show();scil.Utils.confirmdlg.callback=c;scil.Utils.confirmdlg.cancel.style.display=f?"":"none";scil.Utils.confirmdlg.msg.innerHTML=h==null?"":"<pre style='margin:0'>"+h+"</pre>";scil.Utils.confirmdlg.hide(true);scil.Utils.confirmdlg.show(g,null,null,null,n)},confirmYes:function(d,c,f){scil.Utils.confirm(d,function(g){if(g){c()}},null,null,f)},prompt2:function(c){return this.prompt(c.caption,c.message,c.defaultvalue,c.button,c.callback,c.iconurl,c.zindex,c.multiline,c.autosuggesturl,c.owner,c.maxlength,c.height)},prompt:function(h,z,j,d,g,w,H,B,c,C,y,t){if(scil.Utils.promptdlg==null){var D=scil.Utils.createTable();var G=scil.Utils.createElement(D,"tr");var u=scil.Utils.createElement(scil.Utils.createElement(G,"td"),"div",null,{width:"50px"});var E=scil.Utils.createElement(G,"td");var A=scil.Utils.createElement(E,"div",null,{color:"black"});var l=scil.Utils.createElement(E,"div");var x=scil.Utils.createElement(l,"input",null,{width:"700px",display:"none"});x.setAttribute("x-webkit-speech","on");var F=scil.Utils.createElement(l,"textarea",null,{width:"700px",display:"none"});var l=scil.Utils.createElement(E,"div",null,{textAlign:"center",paddingTop:"5px"});var f=scil.Utils.createElement(l,"button",d,{width:scil.Utils.buttonWidth+"px"});var n=scil.Utils.promptdlg=new JSDraw2.Dialog(this.res("Message"),D.parentNode);n.icon=u;n.msg=A;n.input=x;n.textarea=F;n.button=f;var q=function(J){var I=n;I.hide();if(I.callback!=null){var K=I.input.style.display=="none"?I.textarea.value:I.input.value;I.callback(scil.Form.makeSafeHtml(K),I.input.style.display=="none"?I.textarea:I.input)}if(J.preventDefault!=null){J.preventDefault()}};dojo.connect(n.input,"onkeydown",function(I){if(I.keyCode==13){q(I)}});dojo.connect(f,"onclick",q);n.auto=new scil.AutoComplete(x,null)}var n=scil.Utils.promptdlg;n.input.style.display=B?"none":"";n.textarea.style.display=B?"":"none";n.input.setAttribute("maxlength",y>0?y:"");if(t>0){n.input.style.height=t+"px";n.textarea.style.height=t+"px"}else{n.input.style.height="";n.textarea.style.height=""}n.auto.url=c;n.auto.disabled=c==null||c=="";n.show(h,H);if(w==null){n.icon.innerHTML="&nbsp;"}else{n.icon.innerHTML="<img style='width:50px;height:50px;' src='"+w+"'>";n.icon.style.display=""}n.msg.innerHTML=z==null?"":z;n.button.innerHTML=d==null?this.res("OK"):this.res(d);(B?n.textarea:n.input).value=j==null?"":j;n.callback=g;n.hide(true);n.show2({owner:C});(B?n.textarea:n.input).select();(B?n.textarea:n.input).focus()},createCookie:function(h,l,d,g){if(!g){var j=dojox.storage==null||dojox.storage.LocalStorageProvider==null?null:new dojox.storage.LocalStorageProvider();if(j!=null&&j.isAvailable()){j.initialize();j.put(h,l);return}}var f="";if(d){var c=new Date();c.setTime(c.getTime()+(d*24*60*60*1000));f="; expires="+c.toGMTString()}document.cookie=h+"="+escape(l)+f+"; path=/"},readCookie:function(l,j){if(!j){var q=dojox.storage==null||dojox.storage.LocalStorageProvider==null?null:new dojox.storage.LocalStorageProvider();if(q!=null&&q.isAvailable()){q.initialize();try{return q.get(l)}catch(g){return null}}}var n=l+"=";var f=document.cookie.split(";");for(var h=0;h<f.length;h++){var d=f[h];while(d.charAt(0)==" "){d=d.substring(1,d.length)}if(d.indexOf(n)==0){return unescape(d.substring(n.length,d.length))}}return null},eraseCookie:function(c){if(dojox.storage!=null&&dojox.storage.LocalStorageProvider!=null){var d=new dojox.storage.LocalStorageProvider();if(d.isAvailable()){d.initialize();d.remove(c)}}this.createCookie(c,"",-1)},formatFilesize:function(c){if(!(c>0)){return""}if(c/1000<1){return c+"Bytes"}c=c/1000;if(c/1000<1){return Math.round(c*10)/10+"KB"}c=c/1000;if(c/1000<1){return Math.round(c*10)/10+"MB"}c=c/1000;if(c/1000<1){return Math.round(c*10)/10+"GB"}c=c/1024;return Math.round(c*10)/10+"TB"},today:function(c){if(typeof(c)=="number"){return scil.Utils.trunc2date(new Date(new Date().getTime()+c*24*60*60*1000))}else{return scil.Utils.trunc2date(new Date())}},trunc2date:function(c){return c==null?null:new Date(c.getFullYear(),c.getMonth(),c.getDate())},time:function(l){if(l==null){return new Date()}var j=null;if(typeof(l)=="string"){if(/^[0-9]+$/.test(l)){l=parseInt(l)}else{var h=l.split("-");if(h.length==3){var n=parseInt(h[0]);var f=h[1].length==3?this._parseMonth(h[1]):(parseInt(h[1])-1);var c=parseInt(h[2]);if(n>0&&f>=0&&f<12&&c>0&&c<=31){return new Date(n,f,c)}}}}if(j==null){j=new Date(l)}var g=j.getTimezoneOffset();if(isNaN(g)){g=0}return new Date(j.getTime()+g*60000)},_months:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],_weekdays:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],weekday:function(c){return this._weekdays[c.getDay()]},_parseMonth:function(c){if(c==null||c.length!=3){return -1}c=c.substr(0,1).toUpperCase()+c.substr(1).toLowerCase();return scil.Utils.indexOf(this._months,c)},isnull:function(d,c){return this.isNullOrEmpty(d)?c:d},iif:function(c,f,d){return c?f:d},formatTime:function(j,c){if(j==0){return""}if(j==null){j=new Date()}if(typeof j!="object"){j=scil.Utils.time(j)}if(JSDraw2.timezoneoffet>0){j=new Date(j.getTime()+JSDraw2.timezoneoffet*60*60*1000)}if(!(j.getFullYear()>0)){return""}var g=c;if(scil.Utils.isNullOrEmpty(g)){g="yyyy-mmm-dd"}g=g.replace("yyyy",j.getFullYear()).replace("yy",(j.getFullYear()+"").substr(2)).replace("mmm",scil.Utils._months[j.getMonth()]).replace("mm",scil.Utils.padLeft(j.getMonth()+1,2,"0")).replace("dd",scil.Utils.padLeft(j.getDate(),2,"0"));var f=g.indexOf("hh")>=0;var d=j.getHours();g=g.replace("hh",this.padLeft(d%12,2,"0")).replace("HH",this.padLeft(d,2,"0")).replace("MM",this.padLeft(j.getMinutes(),2,"0")).replace("SS",this.padLeft(j.getSeconds(),2,"0")).replace("ss",this.padLeft(j.getSeconds(),2,"0"));if(f){g+=d>=12?"PM":"AM"}return g},dateStr:function(g,c,f){if(scil.Utils.isNullOrEmpty(g)||g==0){return""}var l=typeof(g);if(!(l=="object"||l=="number"||l=="string")){return""}var j=g;if(l!="object"){j=scil.Utils.time(j);if(j==null){return""}}var d=(scil.Utils.today().getTime()-scil.Utils.trunc2date(j).getTime())/1000/60/60/24;var h=null;if(c==null){c=JSDraw2.config.classicdate}if(!c){if(d==0){h=JSDraw2.Language.res("Today")}else{if(d==1){h=JSDraw2.Language.res("Yesterday")}}}if(h==null){if(scil.Utils.isNullOrEmpty(f)){f=JSDraw2.defaultoptions.dateformat;if(scil.Utils.isNullOrEmpty(f)){f="yyyy-mmm-dd"}}if(typeof(g)=="string"){j=new Date(j)}h=scil.Utils.formatTime(j,f)}return h},timeStr:function(g,c,f){if(scil.Utils.isNullOrEmpty(g)||g==0){return""}if(typeof(g)=="string"){if(g=="new"){return"<span style='color:red'>"+JSDraw2.Language.res("New")+"</span>"}else{return g}}if(g==null){return""}if(typeof g!="object"){g=scil.Utils.time(g)}var d=f!=null?f:JSDraw2.defaultoptions.timeformat;if(scil.Utils.isNullOrEmpty(d)){d="HH:MM"}return scil.Utils.dateStr(g,c)+" "+scil.Utils.formatTime(g,d)},createButton:function(n,g,l){if(typeof n=="string"){n=dojo.byId(n)}if(g==null){return}if(typeof(g)=="string"){this.createElement(n,"span",g);return}var q=(l==null?scil.Lang:l).res(g.caption||g.label);if(g.src==null&&g.iconurl!=null){g.src=g.iconurl}if(g.title==null&&g.tooltips!=null){g.title=g.tooltips}var u=scil.Lang.res(g.title);var d=null;if(g.type=="b"){var t=scil.Utils.createTable(n,0,0,{"float":g.float==null?"left":g.float,textAlign:"center",margin:0,borderRadius:"2px"});d=t.parentNode;if(g.id!=null){d.setAttribute("id",g.id)}if(g.largetext!=null){scil.Utils.createElement(scil.Utils.createElement(t,"tr"),"td",g.largetext,{padding:"3px 12px 0 12px",background:g.background})}else{scil.Utils.createElement(scil.Utils.createElement(t,"tr"),"td","<img src='"+g.src+"'"+(g.imgheight>0?" height='"+g.imgheight+"'":"")+">",{padding:"3px 12px 0 12px"})}scil.Utils.createElement(scil.Utils.createElement(t,"tr"),"td",q,{color:"#fff",fontSize:"60%"})}else{if(q==null&&(g.src||g.icon)!=null){d=this.createElement(n,"img",null,{width:g.width,cursor:"pointer",verticalAlign:"middle"},{src:(g.src||g.icon),title:u,id:g.id})}else{if(g.src!=null){q="<img style='vertical-align:middle' src='"+g.src+"'"+(g.imgheight>0?" height='"+g.imgheight+"'":"")+">"+q}if(g.type=="a"){d=this.createElement(n,g.tagname!=null?g.tagname:(q==""||q==null?"span":"u"),q,{width:g.width,cursor:"pointer",background:g.background,whiteSpace:"nowrap"},{title:u,id:g.id})}else{d=this.createElement(n,"button",q,{width:g.width,background:g.background,padding:g.padding},{title:u,id:g.id})}}}if(g.items!=null){if(d.tagName=="IMG"||d.tagName=="U"){var f=this.createElement(n,"span",null);f.appendChild(d);d=f}}var j=g.highlightcolor==null?JSDraw2.Skin.menu.highlightcolor:g.highlightcolor;var h=g.color==null?(g.type=="b"?"":JSDraw2.Skin.menu.color):g.color;d.style.color=h;if(g.type=="b"){}else{scil.connect(d,"onmouseover",function(){d.style.color=j});scil.connect(d,"onmouseout",function(){d.style.color=h})}if(g.items!=null){if(g.callback==null){g.callback=function(c){if(g.onclick!=null){g.onclick(c,g)}else{for(var w=0;w<g.items.length;++w){if(g.items[w].label==c&&g.items[w].url!=null){if(g.items[w].target==null){window.location=g.items[w].url}else{window.open(g.items[w].url,g.items[w].target)}break}}}}}g.jsd=new scil.DropdownButton(d,g)}else{if(g.onclick!=null){dojo.connect(d,"onclick",function(c){g.onclick(c,g)})}else{if(g.url){dojo.connect(d,"onclick",function(){if(g.target==null){window.location=g.url}else{window.open(g.url,g.target)}})}}}if(g.key!=null){d.setAttribute("key",g.key)}return d},createElement:function(q,u,g,t,d,l){if(typeof(q)=="string"){q=scil.byId(q)}if(d!=null&&d.title!=null){d.title=this.res(d.title)}var f=null;u=u.toLowerCase();if(JSDraw2.Skin.kRoundish){if(u=="button"){if(t==null){t={}}if(t.border==null&&scil.App.config!=null){t.border="solid 1px "+scil.App.config.frame}if(t.borderRadius==null){t.borderRadius=JSDraw2.Skin.kBigRadius}if(t.padding==null){t.padding="5px 20px 5px 20px"}if(t.background==null&&scil.App.config!=null){t.background=scil.App.config.button}t.outlineWidth=0;t.marginRight="3px"}else{if(u=="input"||u=="select"||u=="password"||u=="textarea"){if(t==null){t={}}if(t.borderRadius==null){t.borderRadius=JSDraw2.Skin.kBigRadius}if(t.padding==null){t.padding="2px 6px 2px 6px"}if(t.border==null){if(scil.App.config!=null){t.border="solid 1px "+scil.App.config.line}else{t.border="solid 1px #999"}}t.outlineWidth=0}}}if(u=="password"&&scil.Utils.isIE){for(var h=0;h<5;++h){var n=scil.byId("__pwd"+h);if(n!=null&&n.style.display=="none"){f=n;n.style.display=""}}}if(f==null){if(u=="checkbox"||u=="radio"||u=="password"||u=="hidden"||u=="file"||u=="image"){if(scil.Utils.isIE8Lower){var c=d!=null&&d.name!=null?" name='"+d.name+"'":"";f=document.createElement("<input type='"+u+"'"+c+">")}else{f=document.createElement("input");f.type=u}}else{f=document.createElement(u)}}if(q!=null){q.appendChild(f)}if(g!=null){if(u=="radio"||u=="checkbox"){this.createElement(q,"span",g)}else{f.innerHTML=g}}if(t!=null){for(var j in t){var w=t[j];if(w==null){continue}if((j=="width"||j=="height"||j=="padding"||j=="margin")&&typeof(w)=="number"){w=w+"px"}f.style[j]=w}}if(d!=null){for(var j in d){if(d[j]!=null){f.setAttribute(j,d[j])}}}if(l!=null){dojo.connect(f,"onclick",function(x){l(x,f)})}return f},createTable:function(g,f,d,h,c){var j=this.createElement(g,"table",null,h);if(f!=null){j.cellSpacing=f}if(d!=null){j.cellPadding=d}if(c>=0){j.border=c}return this.createElement(j,"tbody")},createTable2:function(d,f,c){var g=this.createElement(d,"table",null,f,c);return this.createElement(g,"tbody")},createTR:function(c,d){return scil.Utils.createElement(c,"tr",d)},createTD:function(c,d){if(c.tagName!="TR"){c=this.createTR(c)}return scil.Utils.createElement(c,"td",d)},createCenterBox:function(d,c){var f=this.createTable(d,0,0,null,c);f.parentNode.setAttribute("align","center");var h=this.createElement(f,"tr");var g=this.createElement(h,"td",null,{textAlign:"left"});return g},createSelect:function(d,c,j,g,h){var f=this.createElement(d,"select",null,h);this.listOptions(f,c,j,false,g);return f},listOptions:function(n,d,w,j,q){if(j){this.removeAll(n)}if(d==null){return}if(d.length!=null){if(q){d.sort()}for(var c=0;c<d.length;++c){var l=d[c];var h=this.createElement(n,"option",l,null,{value:l});if(l==w){h.setAttribute("selected","selected")}}}else{var t={};var g=[];for(var f in d){t[d[f]]=f;g.push(d[f])}if(q){g.sort()}for(var c=0;c<g.length;++c){var u=g[c];var f=t[u];var h=this.createElement(n,"option",u,null,{value:f});if(f==w){h.setAttribute("selected","selected")}}}},selectOption:function(g,h,d){if(g==null){return}g.removeAttribute("_value");for(var c=0;c<g.options.length;++c){var f=g.options[c];if(this.isEqualStr(f.value,h+"",d)||typeof(h)=="boolean"&&(h==true&&scil.Utils.isTrue(f.value)||h==false&&scil.Utils.isFalse(f.value))){g.selectedIndex=c;return}}g.selectedIndex=-1;g.setAttribute("_value",h==null?"":h)},isEqualStr:function(d,f,c){if(d==null&&f==null){return true}if(d==null||f==null){return false}if(c){return d.toLowerCase()==f.toLowerCase()}return d==f},removeAll:function(d){if(d==null||d.childNodes==null){return}for(var c=d.childNodes.length-1;c>=0;--c){d.removeChild(d.childNodes[c])}},getParent:function(c,d){d=d.toUpperCase();while(c!=null){if(c.tagName!=null&&c.tagName.toUpperCase()==d){return c}c=c.parentNode}return c},testParent:function(c,d){if(c==null||d==null){return false}while(c!=null){if(c.parentNode==d){return true}c=c.parentNode}return false},firstElement:function(g,h){if(g==null){return null}for(var f=0;f<g.childNodes.length;++f){var d=g.childNodes[f];if(h==null&&d.nodeName!="#text"||h!=null&&d.nodeName==h){return d}}return null},arrayContainsArray:function(f,d){if(f==null||d==null||f.length<d.length){return false}for(var c=0;c<d.length;++c){if(this.indexOf(f,d[c])<0){return false}}return true},indexOf:function(g,c,f){if(g==null){return -1}if(f&&typeof(c)=="string"){c=c.toLowerCase()}else{if(typeof(c)!="string"){f=false}}for(var d=0;d<g.length;++d){var h=g[d];if(f){h=h.toLowerCase()}if(h==c){return d}}return -1},delFromArray:function(f,c){var g=0;for(var d=f.length-1;d>=0;--d){if(f[d]==c){f.splice(d,1);++g}}return g},post:function(j,c,h){if(this.form==null){this.form=scil.Utils.createElement(document.body,"form",null,{display:"none"})}scil.Utils.removeAll(this.form);for(var g in c){var d=scil.Utils.createElement(this.form,"textarea");d.name=g;d.value=c[g]}this.form.target=h;this.form.method="post";this.form.action=j;this.form.submit()},postIframe:function(d,c){if(this.postform==null){this.postform=scil.Utils.createElement(document.body,"form",null,{display:"none"})}dojo.io.iframe.send({url:d,form:this.form,method:"POST",content:c,timeoutSeconds:5,preventCache:true,handleAs:"text",error:function(f){},handle:function(f){}})},alert:function(c){if(scil.Utils.isNullOrEmpty(c)){return}if(c.length>1000){c=c.substr(0,1000)+"..."}if(scil.Utils.nativemode){this.alert2(c,"JSDraw2.Editor Message")}else{alert(c)}},download:function(f,c){if(f.indexOf("?")>0){f+="&__tm="+new Date().getTime()}else{f+="?__tm="+new Date().getTime()}if(scil.Utils.startswith(f,"http://")){var d={url:f,callbackParamName:"callback",load:c,error:function(h){alert(h)}};dojo.io.script.get(d)}else{var g={url:f,handleAs:"text",load:c,error:function(h){}};dojo.xhrGet(g)}},ajax:function(g,c,f,d){if(d==null){d={}}var h={url:g,sync:d.sync,handleAs:"text",content:scil.Utils.stupidTomcatBug(f),timeout:d.timeout,error:function(j){if(d.showprogress){scil.Progress.hide()}if(d.onError!=null){d.onError(j)}else{scil.Utils.alert(j.message)}},load:function(j){if(d.showprogress){scil.Progress.hide()}scil.Utils.ajaxCallback(j,c,d.onError,d.ignoresucceedcheck);if(scil.User!=null&&scil.User.onAjax!=null){scil.User.onAjax()}}};if(d.showprogress){scil.Progress.show((d.caption==null?"Loading ...":d.caption),false,(d.message==null?"Communicating with the server ...":d.message),false)}if(scil.Utils.onajaxcall!=null){scil.Utils.onajaxcall(h,d)}if(d.headers!=null){h.headers=d.headers}switch(d.verb){case"delete":case"del":dojo.xhrDelete(h);break;case"put":dojo.xhrPut(h);break;case"get":dojo.xhrGet(h);break;default:dojo.xhrPost(h);break}},stupidTomcatBug:function(c){return c},ajaxwait:function(g,d){var f=null;var c=function(h){f=h};this.ajax(g,c,d,{sync:true});return f},jsonp:function(l,c,h,f){if(scil.Utils.isNullOrEmpty(l)){return}if(f==null){f={}}if(h==null){h={wrapper:"jsonp"}}else{h.wrapper="jsonp"}if(scil.Utils.startswith(l,"//")){var j=(window.location+"").toLowerCase();if(scil.Utils.startswith(j,"https:")){l="https:"+l}else{l="http:"+l}}var g=l.indexOf("?");if(g<0){l+="?"}else{l+="&"}l+="__jsdraw_timestamp__="+new Date().getTime();if(f.showprogress){scil.Progress.show((f.caption==null?"Loading ...":f.caption),false,(f.message==null?"Communicating with the server ...":f.message),false)}if(f.xdomainurl!=null){scil.Utils.postXdomainData(f.xdomainurl,function(n){scil.Utils.jsonp(l,function(q){if(f.showprogress){scil.Progress.hide()}if(c!=null){c(q)}},{_xfilename:n})},h)}else{var d={url:l,callbackParamName:"callback",content:scil.Utils.stupidTomcatBug(h),error:function(n){if(f.showprogress){scil.Progress.hide()}if(f.onError!=null){f.onError(n)}else{scil.Utils.alert(n.message)}},load:function(n){if(f.showprogress){scil.Progress.hide()}scil.Utils.ajaxCallback(n,c,f.onError,f.ignoresucceedcheck)}};if(scil.Utils.onjsonpcall!=null){scil.Utils.onjsonpcall(d)}dojo.io.script.get(d)}},getZindex:function(c){while(c!=null){if(c.style!=null&&c.style.zIndex!=""&&c.style.zIndex!=null){return parseInt(c.style.zIndex)}c=c.parentNode}return 1},onAjaxCallback:null,ajaxCallback:function(data,callback,onError,ignoresucceedcheck){var ret=null;switch(typeof(data)){case"string":try{if(data==""){ret=null}else{eval("var o="+data);ret=o}}catch(e){scil.Utils.alert("Error when parsing Ajax results:\n"+e.message+"\n"+data);return}break;case"object":ret=data;break;default:scil.Utils.alert("Unknown return format");break}if(scil.Utils.onAjaxCallback!=null){if(scil.Utils.onAjaxCallback(ret)){return}}if(ignoresucceedcheck==true){if(callback!=null){callback(ret)}}else{if(ret.succeed){if(callback!=null){callback(ret.ret)}}else{if(scil.User!=null&&scil.User.needLogin!=null&&scil.User.needLogin(ret)){return}if(onError!=null){onError(ret)}else{if(ret.errcode=="None"){scil.Utils.alert(ret.error)}else{scil.Utils.alert("["+(ret.errcode==null?"ERROR":ret.errcode)+"]: "+ret.error)}}}}},ajaxUploadFile:function(d,h,g,c){if(g==null){g={}}if(h.toLowerCase().indexOf("wrapper=textarea")<0){var f=h.indexOf("?");if(f>0){h+="&wrapper=textarea"}else{h+="?wrapper=textarea"}}dojo.io.iframe.send({url:h,form:d,method:"post",content:g,timeoutSeconds:60,preventCache:true,handleAs:"text",error:function(j){scil.Progress.hide();scil.Utils.alert(j.message)},handle:function(j){scil.Progress.hide();scil.Utils.ajaxCallback(j,c)}});scil.Progress.show("Uploading",false,"Communicating with the server ...",false)},ajaxPostFile:function(d,h,g,c){if(g==null){g={}}if(h.toLowerCase().indexOf("wrapper=textarea")<0){var f=h.indexOf("?");if(f>0){h+="&wrapper=textarea"}else{h+="?wrapper=textarea"}}dojo.io.iframe.send({url:h,form:d,method:"post",content:g,timeoutSeconds:5,preventCache:true,handleAs:"text",handle:function(j){if(c!=null){c(j)}}})},res:function(c){return JSDraw2.Language.res(c)},UploadFileDlg:scilligence.extend(scilligence._base,{callback:null,url:null,params:null,msg:null,checkfiles:null,dlg:null,btn:null,tbody:null,files:[],constructor:function(h){var d=JsUtils.createElement(null,"div","<form method='post' enctype='multipart/form-data'></form>");this.form=d.firstChild;this.tbody=JsUtils.createTable(this.form,null,null,{margin:"6px",width:"350px"},{align:"center"});var q=JsUtils.createElement(this.tbody,"tr");this.msg=JsUtils.createElement(q,"td");this.msg.colSpan=2;if(h!=null&&h==true){h=5}var j=1;if(h&&scil.Utils.isIE&&scil.Utils.isIE<10){var j=h>1?h:5}var c={size:26,name:"file"};if(h&&j==1){c.multiple="multiple"}for(var f=0;f<j;++f){q=JsUtils.createElement(this.tbody,"tr");JsUtils.createElement(q,"td",scil.Utils.res("File")+":");this.files[f]=JsUtils.createElement(JsUtils.createElement(q,"td"),"file",null,null,c)}if(!scil.MobileData.disabled){var g=this;q=JsUtils.createElement(this.tbody,"tr");JsUtils.createElement(q,"td","<div style='white-space:nowrap'>"+scil.Utils.res("From Mobile")+":</div>",null,{valign:"top"});var l=JsUtils.createElement(q,"td");this.mobileimages=JsUtils.createElement(l,"hidden",null,null,{name:"mobileimages"});scil.Utils.createButton(l,{label:"Show",type:"a",onclick:function(){g.showImageList()}});this.imagelistdiv=JsUtils.createElement(l,"div",null,{display:"none"});this.imagelist=scil.MobileData.createImageList(this.imagelistdiv,h)}q=JsUtils.createElement(this.tbody,"tr",null,{display:"none"});JsUtils.createElement(q,"td","Password:");JsUtils.createElement(JsUtils.createElement(q,"td"),"password",null,null,{name:"jsdraw.upload.password"});this.passwordRow=q;JsUtils.createElement(JsUtils.createElement(this.tbody,"tr"),"td","&nbsp;");q=JsUtils.createElement(this.tbody,"tr");JsUtils.createElement(q,"td");this.btn=JsUtils.createElement(scil.Utils.createElement(q,"td"),"button","<img src='"+scil.App.imgSmall("submit.png")+"' />"+scil.Utils.res("Upload"));this.dlg=new JSDraw2.Dialog("Upload File",d)},showImageList:function(){if(this.imagelistdiv.style.display=="none"){this.imagelistdiv.style.display="";scil.MobileData.listImages(this.imagelist,this.params)}else{this.imagelistdiv.style.display="none"}},show:function(d,h,q,c,j,n,l,f){this.dlg.show(d);this.postonly=l;this.checkfiles=f;if(this.imagelistdiv!=null){this.imagelistdiv.style.display="none";this.imagelist.clear()}var g=this;if(this.btn!=null){dojo.connect(this.btn,"onclick",function(t){g.show2();t.preventDefault()});this.btn=null}this.callback=function(t){if(c!=null){c(t)}g.dlg.hide()};this.url=q;this.params=j;this.form.reset();this.passwordRow.style.display=n?"":"none";this.msg.innerHTML=h},show2:function(){if(this.mobileimages!=null){this.mobileimages.value=scil.MobileData.getSelectedImages(this.imagelist)}if(this.postonly){var d=this.files[0].value;var n=d.lastIndexOf("\\");if(n>0){d=d.substr(n+1)}var h=new Date().getTime();var c=this.params==null?{}:scil.clone(this.params);c._xfilename=h+"_"+d;var l=this;scil.Utils.ajaxPostFile(this.form,this.url,c,function(){l.callback(c._xfilename)})}else{var l=this;if(this.checkfiles){var j=[];var f=this.files[0].files;for(var g=0;g<f.length;++g){j.push(f[g].name)}this.checkfiles(j,function(t){var q=scil.clone(l.params);q.overwrite=t;scil.Utils.ajaxUploadFile(l.form,l.url,q,l.callback)})}else{scil.Utils.ajaxUploadFile(l.form,l.url,l.params,l.callback)}}}}),postXdomainData:function(h,d,f){var g=new Date().getTime();var c=scil.clone(f);if(c==null){c={}}c._xfilename=g;if(this.xdomainform==null){this.xdomainform=scil.Utils.createElement(document.body,"form",null,{display:"none"})}scil.Utils.ajaxPostFile(this.xdomainform,h,c,function(){if(d!=null){d(c._xfilename)}})},uploadfileDlg:null,uploadfileDlg2:null,uploadFile:function(d,h,t,c,l,g,j,q,n,f){if(j){if(this.uploadfileDlg2==null){this.uploadfileDlg2=new scil.Utils.UploadFileDlg(true)}this.uploadfileDlg2.show(d,h,t,c,l,q,n,f);this.uploadfileDlg2.check=g}else{if(this.uploadfileDlg==null){this.uploadfileDlg=new scil.Utils.UploadFileDlg()}this.uploadfileDlg.show(d,h,t,c,l,q,n,f);this.uploadfileDlg.check=g}},uploadFile2:function(){var c=this.uploadfileDlg;var d=c.params;scil.Utils.ajaxUploadFile(this.uploadfileDlg.form,c.url,d==null?{}:d,c.callback)},ie2touches:function(c){var f=c.getPointerList();var g=[];for(var d=0;d<f.length;++d){g.push({pointerId:f[d].pointerId,clientX:f[d].clientX,clientY:f[d].clientY,target:c.target,button:c.button})}g.sort(function(h,j){return h.pointerId-j.pointerId});c.touches=g;return c},getScreenSize:function(f){if(f==null){f=window}var c=f.document.documentElement||f.document.body;var d=f.document.parentWindow||f.document.defaultView;return{w:d.innerWidth||c.clientWidth,h:d.innerHeight||c.clientHeight}},json2str:function(q,h,l){var g=l?'"':"'";if(q==null){return"null"}if(typeof(q)=="number"){return q}if(typeof(q)=="boolean"){return q?"true":"false"}if(typeof(q)=="string"){var n=q.replace(/\r/g,"\\r").replace(/\n/g,"\\n");if(g=='"'){n=n.replace(/\"/g,'\\"')}else{n=n.replace(/\'/g,"\\'")}return g+n+g}if(typeof(q)=="object"){if(q.length!=null){var n=(h?"[ ":"[");for(var c=0;c<q.length;++c){n+=(c>0?(h?", ":","):"")+this.json2str(q[c],h,l)}n+=(h?" ]":"]");return n}else{var n=(h?"{ ":"{");var d=0;for(var f in q){if(f==null||f==""||q[f]==null||f.substr(0,1)=="_"){continue}if(++d>1){if(n.substr(n.length-1,1)=="}"){n+=(h?",\r\n":",")}else{n+=(h?", ":",")}}if(!l&&/^[a-z|_]+[0-9|a-z|_]{0,1000}$/.test(f)){n+=f}else{n+=g+f+g}n+=(h?": ":":")+this.json2str(q[f],h,l)}n+=(h?" }":"}");return n}}return"null"},getMaxZindex:function(){var c=this.getMaxZindex2("div");var d=this.getMaxZindex2("iframe");var f=this.getMaxZindex2("table");return Math.max(Math.max(c,d),f)},getMaxZindex2:function(g){var j=document.body.className=="mce-fullscreen"?101:1;var f=document.getElementsByTagName(g);for(var c=0;c<f.length;++c){if(f[c].style==null||f[c].style.display=="none"){continue}var h=f[c].style.zIndex;if(h!=null&&h!=""){var d=parseInt(h);if(d>j){j=d}}}return j},isAllParentVisible:function(c){if(c==null){return false}while(c!=null&&c.style!=null){if(c.style.display=="none"){return false}c=c.parentNode}return true},xml2Json:function(l,q){if(l==null){return null}var j=l.getElementsByTagName(q);if(j==null||j.length==0){return null}var n=[];for(var f=0;f<j.length;++f){var d=j[f];var g={_e:d};for(var h=0;h<d.attributes.length;++h){var c=d.attributes[h];g[c.name]=c.value}n.push(g)}return n},jsonList2Xml:function(d,g){if(d==null){return""}var f="";for(var c=0;c<d.length;++c){f+=this.json2Xml(d[c],g)}return f},json2Xml:function(c,h,d){if(c==null){return""}var g="<"+h;for(var f in c){var l=c[f];if(l==null||typeof(l)=="string"&&l==""){continue}var j=typeof(l);if(j!="object"&&j!="function"){g+=" "+f+'="'+scil.Utils.escXmlValue(c[f])+'"'}}if(d!=null&&d!=""){g+=">"+d+"</"+h+">"}else{g+="/>"}return g},joinArray:function(d,f){if(d==null&&f==null){return null}else{if(d==null){return f}else{if(f==null){return d}}}var g=[];if(typeof d=="string"||d.length==null){g.push(d)}else{for(var c=0;c<d.length;++c){g.push(d[c])}}if(typeof f=="string"||f.length==null){g.push(f)}else{for(var c=0;c<f.length;++c){g.push(f[c])}}return g},getInnerXml:function(c){if(c==null){return}if(c.documentElement!=null){c=c.documentElement}if(c.innerXML){return c.innerXML}if(c.xml){return c.xml}if(typeof XMLSerializer!="undefined"){var f="";for(var d=0;d<c.childNodes.length;++d){f+=(new XMLSerializer()).serializeToString(c.childNodes[d])}return f}return null},getInnerText:function(c){if(c==null){return}if(c!=null&&c.documentElement!=null){c=c.documentElement}return scil.Utils.trim(c.innerText||c.textContent||c.text)},getChildXmlElements:function(c,g){if(c!=null&&c.documentElement!=null){c=c.documentElement}if(c==null){return null}var f=[];for(var d=0;d<c.childNodes.length;++d){if(c.childNodes[d].tagName==g){f.push(c.childNodes[d])}}return f},isImg:function(c){if(c!=null){c=c.toLowerCase()}return c=="gif"||c=="png"||c=="jpg"||c=="jpeg"||c=="tif"||c=="tiff"||c=="bmp"},isOfficeFile:function(c){if(c!=null){c=c.toLowerCase()}return c=="doc"||c=="docx"||c=="rtf"||c=="ppt"||c=="pptx"||c=="xls"||c=="xlsx"},isPDF:function(c){if(c!=null){c=c.toLowerCase()}return c=="pdf"},isVideo:function(c){if(c!=null){c=c.toLowerCase()}return c=="mp4"||c=="wmv"||c=="mov"},isSpectraFile:function(c){if(c!=null){c=c.toLowerCase()}return c=="jdx"},isChemFile:function(c){if(c!=null){c=c.toLowerCase()}return c=="cdx"||c=="cdxml"||c=="jsd"||c=="jsdraw"||c=="mol"||c=="sdf"||c=="mol2"||c=="cml"||c=="skc"||c=="tgf"||c=="mrv"||c=="rxn"||c=="rdf"||c=="helm"||c=="xhelm"},getFileExt:function(c){if(c==null){return null}var d=c==null?-1:c.lastIndexOf(".");if(d<=0){return null}return c.substr(d+1).toLowerCase()},isChildOf:function(c,d){if(d==null||c==null){return false}while(c!=null){if(c.parentNode==d){return true}c=c.parentNode}return false},getElements:function(h,g,f){var j=[];if(h!=null&&h.childNodes!=null){for(var d=0;d<h.childNodes.length;++d){var c=h.childNodes[d];if(g==null||c.tagName==g||f&&c.tagName!=null&&g!=null&&c.tagName.toLowerCase()==g.toLowerCase()){j.push(c)}}}return j},getFirstElement:function(g,f){var h=[];if(g!=null&&g.childNodes!=null){for(var d=0;d<g.childNodes.length;++d){var c=g.childNodes[d];if(f==null&&c.tagName!=null||f!=null&&c.tagName==f){return c}}}return null},parseIndex:function(c){if(c==null){return null}var d=c.replace(/[0-9]+$/,"");if(d==c){return{prefix:d,index:null}}return{prefix:d,index:parseInt(c.substr(d.length))}},removeArrayItem:function(d,c){var f=scil.Utils.indexOf(d,c);if(f<0){return false}d.splice(f,1);return true},removeArrayItems:function(f,d){var g=0;for(var c=0;c<d.length;++c){if(this.removeArrayItem(f,d[c])){++g}}return g},moveToScreen:function(h,j,f,g){var c=dojo.window.getBox();if(h+f.offsetWidth>c.l+c.w){if(g!=null){h=g-f.offsetWidth}else{h=c.l+c.w-f.offsetWidth}}if(h<0){h=0}if(j+f.offsetHeight>c.t+c.h){j=c.t+c.h-f.offsetHeight}if(j<0){j=0}f.style.left=h+"px";f.style.top=j+"px"},unselectable:function(c){c.onselectstart=function(){return false};c.setAttribute("unselectable","on");dojo.style(c,{webkitTouchCallout:"none",webkiUserDelect:"none",khtmlUserSelect:"none",MozUserSelect:"none",msUserSelect:"none",userSelect:"none"})},letter2num:function(h){if(scil.Utils.isNullOrEmpty(h)){return 0}var g=0;h=h.toUpperCase();for(var f=0;f<h.length;++f){var d=h.charCodeAt(f);if(d>=65&&d<=90){g=g*26+(d-65+1)}}return g},num2letter:function(f,g){var h="";while(f>0){var d=(f-1)%26;h=String.fromCharCode(d+(g?97:65))+h;f=(f-d-1)/26}return h},connect:function(c,d,f){return dojo.connect(c,d,f)},array2str:function(d,g){if(d==null||d.length==0){return""}var f="";if(g==null){g=","}for(var c=0;c<d.length;++c){if(c>0){f+=g}if(d[c]!=null){f+=d[c]}}return f},isDictEmpty:function(d){if(d==null){return true}for(var c in d){return false}return true},getDictValues:function(c,f){if(c==null){return null}if(f==null){f=[]}else{if(f==true){f=[""]}}for(var d in c){f.push(c[d])}return f},getDictKeys:function(c,f){if(c==null){return null}if(f==null){f=[]}else{if(f==true){f=[""]}}for(var d in c){f.push(d)}return f},getDictKeyByValue:function(c,f){if(c==null){return null}for(var d in c){if(c[d]==f){return d}}return null},list2dict:function(f,d){var h={};for(var c=0;c<f.length;++c){var g=f[c];h[g[d]]=g}return h},setEnv:function(c){if(c==null||c==""){return}document.body.style.backgroundImage=scil.Utils.imgSrc("img/"+c+".gif",true);document.body.style.backgroundRepeat="no-repeat"},sound:function(c){if(this.isIE&&this.isIE<9){return}if(this.__sound==null){this.__sound=this.createElement(document.body,"audio",null,{display:"none"})}if(this.__sound.src!=c){this.__sound.src=c}this.__sound.play()},escapeHtml:function(c){if(c==null){return""}return c.replace(/>/g,"&gt;").replace(/</g,"&lt;")},textWidth:function(d){if(d==null||d.length==null){return 0}var f=0;for(var c=0;c<d.length;++c){if(d.charCodeAt(c)>255){f+=2}else{++f}}return f},areListEq:function(d,f){if(d==f){return true}if(d==null&&f!=null||d!=null&&f==null||d.length!=f.length){return false}for(var c=0;c<d.length;++c){if(d[c]!=f[c]){return false}}return true},areDictEq:function(d,f){if(d==f){return true}if(d==null||f==null){return false}for(var c in d){var g=d[c];var h=f[c];if(!(g==h||g==null&&h==""||g==""&&h==null)){return false}}return true},splitStr:function(f,g){if(f==null){return null}var d=[];var h=f.split(g);for(var c=0;c<h.length;++c){d.push(this.trim(h[c]))}return d},isEmptyStr:function(c){return this.isNullOrEmpty(c)},regFindAllMatches:function(h,f,l){var g=[];if(h==null){return g}if(l>0){h=h.substr(l)}else{l=0}var c;var j=0;while((c=f.exec(h))!=null){var d=c.index;var n=c+"";g.push({start:j+d+l,str:n});j+=d+n.length;h=h.substr(d+n.length)}return g},isNumber:function(g,c){if(typeof(g)=="number"){return true}if(scil.Utils.isNullOrEmpty(g)){return false}var f=g.indexOf(".");if(f>0){var d=g.indexOf(",");if(d>0&&d<f){g=g.replace(/[,]/g,"")}}if(c){return new RegExp("^[>|<|≥|≤]$").test(g+"")||new RegExp("^[>|<|≥|≤]?[ ]{0,50}[-]?[0-9]+([.][0-9]{0,50})?([e|E][-|+][0-9]+)?([ ]{0,50}[±][0-9]{0,50}([.][0-9]{0,50})?)?$").test(g+"")}else{return !isNaN(g)}},htmlDecode:function(d){if(scil.Utils.isNullOrEmpty(d)){return d}var c=document.createElement("div");c.innerHTML=d;return c.childNodes.length===0?"":c.childNodes[0].nodeValue},html2Text:function(d){if(this.isNullOrEmpty(d)){return d}var c=document.createElement("div");c.innerHTML=d;return c.childNodes.length===0?"":this.getInnerText(c)},parseNumber:function(d){var c=d==null?NaN:parseFloat(d);return isNaN(c)?null:c},isNullOrEmpty:function(c,d){if(c==null){return true}if(typeof(c)=="string"){if(d){c=this.trim(c)}return c.length==0}return false},isNaN:function(c){return c==null||isNaN(c)},getOuterXml:function(c){if(c==null){return null}return c.xml!=null?c.xml:(new XMLSerializer()).serializeToString(c)},addCss:function(c){var d=document.createElement("style");d.type="text/css";if(d.styleSheet){d.styleSheet.cssText=c}else{d.innerHTML=c}document.getElementsByTagName("head")[0].appendChild(d)},insertAfterDict:function(c,d,g){var h={};for(var f in c){h[f]=c[f];if(f==g){for(var j in d){h[j]=d[j]}}}return h},insertBeforeDict:function(c,d,g){var h={};for(var f in c){if(f==g){for(var j in d){h[j]=d[j]}}h[f]=c[f]}return h},insertBeforeArray:function(h,f,c){for(var d=0;d<h.length;++d){if(c(h[d])==true){if(f.length==null){h.splice(d,0,f)}else{for(var g=0;g<f.length;++g){h.splice(d+g,0,f[g])}}return true}}return false},insertAfterArray:function(h,f,c){for(var d=0;d<h.length;++d){if(c(h[d])==true){if(f.length==null){h.splice(d+1,0,f)}else{for(var g=0;g<f.length;++g){h.splice(d+1+g,0,f[g])}}return true}}return false},disableSelection:function(c){if(c==null){return}scil.apply(c.style,{webkitTouchCallout:"none",webkitUserSelect:"none",mozUserSelect:"none",msUserSelect:"none",userSelect:"none"})},getLastBarcode:function(c,d,f,g){scil.Utils.jsonp(g!=null?g:"JSDraw/Service.aspx?cmd=mobile.getlast",function(h){c(h)},{category:d,useremail:f})},beep:function(c){if(typeof(Audio)=="undefined"){return}if(this._beepobj==null){this._beepobj=new Audio("data:audio/wav;base64,UklGRtoEAABXQVZFZm10IBAAAAABAAEAESsAABErAAABAAgAZGF0YbUEAAB9dXFpa3F4fYSLkZiUjoeCe3RuaWtze36GjJOZkYyGgHpybGhvc3uBiI2UmZCKhX93cWxob3Z9g4mQlZaPioN8dm9qanF4f4OLkZeUjoiBe3RvaWxzeICGi5OYlIuFgXlybWltdHuBiI6Ul5CLhn14cmlqcHV8g4mOl5ePiYR8dnBoa3F3foWKkZaVjoiBenVwZ2xyeoCFjZKXlIyGgHpza2lvdHmCh4+Tl5KKhX54cWtpb3Z9gYmPlpePiYN9dnBoa3F4foOLkZeWjYmAfHRvZ25yeX+FjZKXlIyFgXlza2lvc3uAh46Vl5CLhX93cWtqb3V9g4iQlZePioJ9dnFoa3F4foSKkZaUj4eBfHVuaWtzeX+GjJKYk4yGgHl0bWdudXt/iI2VmJCMhX53cWtqb3Z8g4iQlZaPioN8dnFoa3B4foSKkZeVjoiCe3RuaWxzeX+Gi5OXk42Gf3tzbGhtdXuBh4yVl5GMhH54cmtpcHV8g4mOlpaRiYN9dm9raXF4fYSLkJaWjoeCenZuaGxzeICFjJOXk4yHf3pzbWltdHqBiI2Ul5GNhH54cmtpbnd7gomQlZePi4J9dnBqanF3fYOLkJiUj4eBfHVuaWtzeX+FjJKYk4yHgHpzbGltc3uBh42Vl5GLhX92c2ppcXV8gomPlZiOioJ+dnFpaXF5fYOKkZeWjYiDenVuaWtzeIGFjJKXk42GgHl1bWhtdHt/h42Vl5KLhH93c2tob3V9g4iPlZePi4N8d3Bpa3F3foSJkZaWj4eCfHNvaGtyen+FjJGYlIuIgHl0bGhuc3uBh42Ul5KMg4B4cmtocXR8g4mPlZWRioJ9d29ram93foSJkZeUjomCe3VvaG1yd3+Hi5KYlI2GgHpzbmdtdHqBiIyVlpKLhH95cmppb3V8g4iOlpeQiYN+dnFqaXJ2fYSLj5iUj4iCfHRuaWxzeH+FjJGYk42Hf3tzbWhudHqAho6TmZGLhX94c2ppbnZ8gomOlpePi4J+dnBqanB3foOKkJeWjoiBfHRwaGxyeH+Gi5KYk46GgXpzbWdudHqAh46TmJGMhX54cmtpb3V8g4ePlZiPioR9dnFpa3B2foOKkZaVj4iBfHZuaWxyeX6EjZGYlI2GgXlzbmhuc3qBho2Ul5KLhX95cWtpcHV8gYiPlZePi4R8d3FpanB3foOKkJiVjomBe3ZuamtyeICFipOWlI6FgXp1a2psc3uAh46SmJKLhX94c2tocHR9goiOlZeRioN9d3BqaXF3foKLkJWVj4mBfHVvaWtyeH+Gi5KXloyHgHl0bmhuc3qAh42Tl5KMhX55cmtocHZ7goiOlZePioR8eHBqanF2fYSJkJiVj4iCfHZuaGxzeH2Hi5KXlY2FgHtzbWltc3qAh42UlpKMhX94c2tqbnZ6gomOlpaRi4N9d3FpanF2fYSKkJWWjomCe3ZvaWtxeX6Fi5KYk42HgXp0bmhtc3uAhoyUmJKLhYB4c2tocHR9gYiOlpeQioN9d3JqanB3fISJkJeVj4iBfnRwaWpyeX6FjJGXlI6GgHp1bGlucnqBhoyUmJKMhH94c21nb3V8gYmOlZeQi4N+d3FqaXB3fQA=")}this._beepobj.play();if(c){var d=this;setTimeout(function(){d._beepobj.play()},300)}},textareaSelect:function(g,f,c){if(typeof(g.selectionStart)!="undefined"){g.focus();g.selectionStart=f;g.selectionEnd=c}if(document.selection&&document.selection.createRange){g.focus();g.select();var d=document.selection.createRange();d.collapse(true);d.moveEnd("character",c);d.moveStart("character",f);d.select()}},fireEvent:function(g,j,d,f,c){var h;if(document.createEvent){h=document.createEvent("HTMLEvents");h.initEvent(j,d==null?true:d,f==null?true:f)}else{h=document.createEventObject();h.eventType=j}if(c!=null){scil.apply(h,c)}h.eventName=j;if(document.createEvent){g.dispatchEvent(h)}else{g.fireEvent("on"+h.eventType,h)}},sum:function(c){return scil.Math.sum(c)},avg:function(c){return scil.Math.avg(c)},stdev:function(c){return scil.Math.stdev(c)},xml2Lines:function(t){var d=t==null?null:scil.Utils.parseXml("<d> "+t+"</d>");var q=d==null?null:d.documentElement||d.firstElementChild;if(q==null){return null}var n=[];var l=scil.Utils.getElements(q,null);for(var g=0;g<l.length;++g){var f=l[g];var j={};for(var h=0;h<f.attributes.length;++h){var c=f.attributes[h];j[c.name]=c.value}n.push(j)}return n}};scil.form={};JsUtils=scil.Utils;scil.Utils.padleft=scil.Utils.padLeft;scil.Utils.padright=scil.Utils.padRight;scil.Utils.addCss(".scil_table td a{white-space:nowrap;}");if(scil.Utils.isIE){scil.Utils.addCss("select::-ms-expand{display:none;}select{border:solid 1px gray;padding-right:20px;background-repeat:no-repeat;background-position:right center;background-image:url(jsdraw/img/dropdown.gif);}")}JSDraw2={version:"6.3.0.34143",kFileVersion:"6.3",speedup:{fontsize:2,gap:0,disableundo:false,minbondlength:1},defaultoptions:{},config:{},password:{encrypt:true},TEXTKEYWORDS:["°C","rt","reflux","hr","min","sec","psi","atm","overnight","microwave","Δ"],MOLECULETYPES:["SmallMolecule","Polymer","Peptide","DNA","RNA","ADC","Payload","Linker"],CHIRALITIES:["Achiral","Absolute","Racemic","Diastereomeric","Enantiomer R","Enantiomer S"],molchirals:["or","and","rac","ena","unk","1"]};JSDrawServices={};scilligence.JSDraw2=JSDraw2;scilligence.JSDraw3=JSDraw3=JSDraw2;JSDraw2.BONDTYPES={UNKNOWN:0,SINGLE:1,DOUBLE:2,TRIPLE:3,DELOCALIZED:4,WEDGE:5,HASH:6,WIGGLY:7,EITHER:8,SINGLEORDOUBLE:9,SINGLEORAROMATIC:10,DOUBLEORAROMATIC:11,QUADRUPLE:12,DUMMY:13,BOLD:14,BOLDHASH:15,PEPTIDE:21,NUCLEOTIDE:22,DISULFIDE:23,AMIDE:24};JSDraw2.RXNCENTER={NOTCENTER:-1,CENTER:1,BREAK:4,CHANGE:8,BREAKANDCHANGE:12};JSDraw2.ALIGN={RIGHT:0,BOTTOM:1,LEFT:2,TOP:3};JSDraw2.BIO={AA:"AA",ANTIBODY:"ANTIBODY",PROTEIN:"PROTEIN",GENE:"GENE",DNA:"DNA",RNA:"RNA",BASE_DNA:"BASEDNA",BASE_RNA:"BASERNA"};JSDraw2.ANTIBODY={IgG:"IgG",Fab:"Fab",ScFv:"ScFv"};JSDraw2.DNATable={GCT:"A",GCC:"A",GCA:"A",GCG:"A",CGT:"R",CGC:"R",CGA:"R",CGG:"R",AGA:"R",AGG:"R",AAT:"",AAC:"N",GAT:"D",GAC:"D",TGT:"C",TGC:"C",CAA:"Q",CAG:"Q",GAA:"E",GAG:"E",GGT:"G",GGC:"G",GGA:"G",GGG:"G",CAT:"H",CAC:"H",ATT:"I",ATC:"I",ATA:"I",TTA:"L",TTG:"L",CTT:"L",CTC:"L",CTA:"L",CTG:"L",AAA:"K",AAG:"K",ATG:"M",TTT:"F",TTC:"F",CCT:"P",CCC:"P",CCA:"P",CCG:"P",TCT:"S",TCC:"S",TCA:"S",TCG:"S",AGT:"S",AGC:"S",ACT:"T",ACC:"T",ACA:"T",ACG:"T",TGG:"W",TAT:"Y",TAC:"Y",GTT:"V",GTC:"V",GTA:"V",GTG:"V",ATG:"[",TAA:"]",TGA:"]",TAG:"]"};JSDraw2.RNATable={GCU:"A",GCC:"A",GCA:"A",GCG:"A",CGU:"R",CGC:"R",CGA:"R",CGG:"R",AGA:"R",AGG:"R",AAU:"N",AAC:"N",GAU:"D",GAC:"D",UGU:"C",UGC:"C",CAA:"Q",CAG:"Q",GAA:"E",GAG:"E",GGU:"G",GGC:"G",GGA:"G",GGG:"G",CAU:"H",CAC:"H",AUU:"I",AUC:"I",AUA:"I",AUG:"[",UUA:"L",UUG:"L",CUU:"L",CUC:"L",CUA:"L",CUG:"L",AAA:"K",AAG:"K",AUG:"M",UUU:"F",UUC:"F",CCU:"P",CCC:"P",CCA:"P",CCG:"P",UCU:"S",UCC:"S",UCA:"S",UCG:"S",AGU:"S",AGC:"S",ACU:"T",ACC:"T",ACA:"T",ACG:"T",UGG:"W",UAU:"Y",UAC:"Y",GUU:"V",GUC:"V",GUA:"V",GUG:"V",UAA:"]",UGA:"]",UAG:"]"};JSDraw2.Security={kEdition:"Pro",valid:false,error:"No JSDraw License Found",lic:null,__xcode:3,_check:function(){if(this.lic==null&&JSDraw2.licensecode!=null){this._verify(JSDraw2.licensecode)}return this.valid},_verify:function(h){this.error="No JSDraw License Found";if(h==null||h==""){return}try{var q=this.dec(h,scilligence.Utils.__xcode+90+JSDraw2.Editor.__xcode+this.__xcode+JSDraw2.PT.He.a);var n=q.indexOf(".");var c=q.substr(0,n);var l=parseInt(q.substr(n+1,2),10);var f=parseInt(q.substr(n+3,2),10);var t=parseInt(q.substr(n+5,2),10);var j=q.substr(n+7);this.lic={licensor:j,expiration:new Date(2000+t,l-1,f),app:c};if(this.lic.app!="JSDraw"){return}if(this.lic.expiration<new Date()){this.error="JSDraw License Expired";return}this.error=null;this.valid=true}catch(g){this.error="Invalid JSDraw License"}},dec:function(j,g){var h="";var n=j.substr(0,j.length/3);var l=j.substr(j.length/3);j="";for(var f=0;f<n.length;++f){j+=l.substr(f*2,1);j+=9-parseInt(n.substr(f,1),10);j+=l.substr(f*2+1,1)}j=j.substr(j.length-13)+j.substr(0,j.length-13);for(var f=0;f<j.length;f+=3){var d;if(j.substr(f,1)=="-"){d=parseInt(j.substr(f+1,5),10);f+=3}else{d=parseInt(j.substr(f,3),10)}h+=String.fromCharCode(g^d)}return h}};JSDraw2.PT={commonUsed:{C:"C",N:"N",O:"O",S:"S",P:"P",F:"F",Cl:"L",Br:"B",I:"I",H:"H,D,T",Si:null,R:"R"},getCommonUsedElements:function(d){var f=[];if(d=="menu"){for(var c in JSDraw2.PT.commonUsed){f.push({caption:c,shortcut:JSDraw2.PT.commonUsed[c]})}f.push("-")}else{for(var c in this.commonUsed){f.push(c)}}f.push("...");return f},"*":{a:0},"@":{a:0},A:{a:0},X:{a:0},R:{a:0},L:{a:0},Q:{a:0},M:{a:0},"#":{a:0},H:{a:1,c:"909090",m:1.0079,em:1.0078250321,e:1,v:[1],iso:{1:1.0078250321,2:2.014101778,3:3.0160492675}},He:{a:2,c:"D9FFFF",m:4.0026,em:4.0026032497,v:[0],iso:{3:3.0160293097,4:4.0026032497}},Li:{a:3,c:"CC80FF",m:6.941,em:7.016004,v:[0,1],iso:{6:6.0151223,7:7.016004}},Be:{a:4,c:"C2FF00",m:9.012180000000001,em:9.0121821,v:[0,2],iso:{9:9.0121821}},B:{a:5,c:"FFB5B5",m:10.811,em:11.0093055,e:3,v:[3],iso:{10:10.012937,11:11.0093055}},C:{a:6,c:"000000",m:12.0107,em:12,e:4,v:[4],iso:{12:12,13:13.0033548378}},N:{a:7,c:"3050F8",m:14.0067,em:14.0030740052,e:5,v:[3],iso:{14:14.0030740052,15:15.0001088984}},O:{a:8,c:"FF0D0D",m:15.9994,em:15.9949146221,e:6,v:[2],iso:{16:15.9949146221,17:16.9991315,18:17.9991604}},F:{a:9,c:"90E050",m:18.9984,em:18.9984032,e:7,v:[1],iso:{19:18.9984032}},Ne:{a:10,c:"B3E3F5",m:20.1797,em:19.9924401759,v:[0],iso:{20:19.9924401759,21:20.99384674,22:21.99138551}},Na:{a:11,c:"AB5CF2",m:22.9898,em:22.98976967,v:[0,1],iso:{23:22.98976967}},Mg:{a:12,c:"8AFF00",m:24.305,em:23.9850419,v:[0,2],iso:{24:23.9850419,25:24.98583702,26:25.98259304}},Al:{a:13,c:"BFA6A6",m:26.9815,em:26.98153844,v:[3],iso:{27:26.98153844}},Si:{a:14,c:"F0C8A0",m:28.0855,em:27.9769265327,e:4,v:[4],iso:{28:27.9769265327,29:28.97649472,30:29.97377022}},P:{a:15,c:"FF8000",m:30.9738,em:30.97376151,e:5,v:[3,5],iso:{31:30.97376151}},S:{a:16,c:"C0C000",m:32.065,em:31.97207069,e:6,v:[2,4,6],iso:{32:31.97207069,33:32.9714585,34:33.96786683,36:35.96708088}},Cl:{a:17,c:"1FF01F",m:35.453,em:34.96885271,e:7,v:[1,3,5,7],iso:{35:34.96885271,37:36.9659026}},Ar:{a:18,c:"80D1E3",m:39.948,em:39.962383123,v:[0],iso:{36:35.96754628,38:37.9627322,40:39.962383123}},K:{a:19,c:"8F40D4",m:39.0983,em:38.9637069,v:[0,1],iso:{39:38.9637069,40:39.96399867,41:40.96182597}},Ca:{a:20,c:"3DFF00",m:40.078,em:39.9625912,v:[0,2],iso:{40:39.9625912,42:41.9586183,43:42.9587668,44:43.9554811,46:45.9536928,48:47.952534}},Sc:{a:21,c:"E6E6E6",m:44.9559,em:44.9559102,iso:{45:44.9559102}},Ti:{a:22,c:"BFC2C7",m:47.867,em:47.9479471,iso:{46:45.9526295,47:46.9517638,48:47.9479471,49:48.9478708,50:49.9447921}},V:{a:23,c:"A6A6AB",m:50.9415,em:50.9439637,iso:{50:49.9471628,51:50.9439637}},Cr:{a:24,c:"8A99C7",m:51.9961,em:51.9405119,iso:{50:49.9460496,52:51.9405119,53:52.9406538,54:53.9388849}},Mn:{a:25,c:"9C7AC7",m:54.938,em:54.9380496,iso:{55:54.9380496}},Fe:{a:26,c:"E06633",m:55.845,em:55.9349421,iso:{54:53.9396148,56:55.9349421,57:56.9353987,58:57.9332805}},Co:{a:27,c:"F090A0",m:58.9332,em:58.9332002,iso:{59:58.9332002}},Ni:{a:28,c:"50D050",m:58.6934,em:57.9353479,iso:{58:57.9353479,60:59.9307906,61:60.9310604,62:61.9283488,64:63.9279696}},Cu:{a:29,c:"C88033",m:63.546,em:62.9296011,iso:{63:62.9296011,65:64.9277937}},Zn:{a:30,c:"7D80B0",m:65.39,em:63.9291466,iso:{64:63.9291466,66:65.92603680000001,67:66.9271309,68:67.92484760000001,70:69.925325}},Ga:{a:31,c:"C28F8F",m:69.723,em:68.92558099999999,v:[2,3],iso:{69:68.92558099999999,71:70.924705}},Ge:{a:32,c:"668F8F",m:72.64,em:73.9211782,v:[4,2],iso:{70:69.92425040000001,72:71.92207620000001,73:72.9234594,74:73.9211782,76:75.9214027}},As:{a:33,c:"BD80E3",m:74.9216,em:74.9215964,e:5,v:[3,5],iso:{75:74.9215964}},Se:{a:34,c:"FFA100",m:78.95999999999999,em:79.9165218,e:6,v:[2,4,6],iso:{74:73.9224766,76:75.91921410000001,77:76.9199146,78:77.9173095,80:79.9165218,82:81.91670000000001}},Br:{a:35,c:"A62929",m:79.904,em:78.9183376,e:7,v:[1,3,5,7],iso:{79:78.9183376,81:80.916291}},Kr:{a:36,c:"5CB8D1",m:83.8,em:83.911507,v:[0,2],iso:{78:77.92038599999999,80:79.916378,82:81.9134846,83:82.914136,84:83.911507,86:85.9106103}},Rb:{a:37,c:"702EB0",m:85.4678,em:84.9117893,v:[0,1],iso:{85:84.9117893,87:86.9091835}},Sr:{a:38,c:"00FF00",m:87.62000000000001,em:87.9056143,v:[0,2],iso:{84:83.913425,86:85.9092624,87:86.9088793,88:87.9056143}},Y:{a:39,c:"94FFFF",m:88.9059,em:88.9058479,iso:{89:88.9058479}},Zr:{a:40,c:"94E0E0",m:91.224,em:89.90470000000001,iso:{90:89.90470000000001,91:90.90560000000001,92:91.905,94:93.9063,96:95.9083}},Nb:{a:41,c:"73C2C9",m:92.90640000000001,em:92.90640000000001,iso:{93:92.90640000000001}},Mo:{a:42,c:"54B5B5",m:95.94,em:97.9054,iso:{92:91.9068,94:93.9051,95:94.9058,96:95.90470000000001,97:96.90600000000001,98:97.9054,100:99.9075}},Tc:{a:43,c:"3B9E9E",m:98.9063,em:98.9063},Ru:{a:44,c:"248F8F",m:101.07,em:101.904,iso:{96:95.9076,98:97.9053,99:98.9059,100:99.9042,101:100.906,102:101.904,104:103.905}},Rh:{a:45,c:"0A7D8C",m:102.906,em:102.906,iso:{103:102.906}},Pd:{a:46,c:"006985",m:106.42,em:105.903,iso:{102:101.906,104:103.904,105:104.905,106:105.903,108:107.904,110:109.905}},Ag:{a:47,c:"C0C0C0",m:107.868,em:106.905,iso:{107:106.905,109:108.905}},Cd:{a:48,c:"FFD98F",m:112.411,em:113.903,iso:{106:105.906,108:107.904,110:109.903,111:110.904,112:111.903,113:112.904,114:113.903,116:115.905}},In:{a:49,c:"A67573",m:114.818,em:114.904,v:[1,2,3],iso:{113:112.904,115:114.904}},Sn:{a:50,c:"668080",m:118.71,em:119.902,v:[4,2],iso:{112:111.905,114:113.903,115:114.903,116:115.902,117:116.903,118:117.902,119:118.903,120:119.902,122:121.903,124:123.905}},Sb:{a:51,c:"9E63B5",m:121.76,em:120.904,v:[3,5],iso:{121:120.904,123:122.904}},Te:{a:52,c:"D47A00",m:127.6,em:129.906,e:6,v:[2,4,6],iso:{120:119.904,122:121.903,123:122.904,124:123.903,125:124.904,126:125.903,128:127.904,130:129.906}},I:{a:53,c:"940094",m:126.904,em:126.904468,e:7,v:[1,3,5,7],iso:{127:126.904468}},Xe:{a:54,c:"429EB0",m:131.293,em:131.904,v:[0,2,4,6],iso:{124:123.906,126:125.904,128:127.904,129:128.905,130:129.904,131:130.905,132:131.904,134:133.905,136:135.907}},Cs:{a:55,c:"57178F",m:132.905,em:132.905,v:[0,1],iso:{133:132.905}},Ba:{a:56,c:"00C900",m:137.327,em:137.905,v:[0,2],iso:{130:129.906,132:131.905,134:133.905,135:134.906,136:135.905,137:136.906,138:137.905}},La:{a:57,c:"70D4FF",m:138.905,em:138.906,iso:{138:137.907,139:138.906}},Ce:{a:58,c:"FFFFC7",m:140.116,em:139.905,iso:{136:135.907,138:137.906,140:139.905,142:141.909}},Pr:{a:59,c:"D9FFC7",m:140.908,em:140.908,iso:{141:140.908}},Nd:{a:60,c:"C7FFC7",m:144.24,em:141.908,iso:{142:141.908,143:142.91,144:143.91,145:144.913,146:145.913,148:147.917,150:149.921}},Pm:{a:61,c:"A3FFC7",m:145,em:145},Sm:{a:62,c:"8FFFC7",m:150.36,em:151.92,iso:{144:143.912,147:146.915,148:147.915,149:148.917,150:149.917,152:151.92,154:153.922}},Eu:{a:63,c:"61FFC7",m:151.964,em:152.921,iso:{151:150.92,153:152.921}},Gd:{a:64,c:"45FFC7",m:157.25,em:157.924,iso:{152:151.92,154:153.921,155:154.923,156:155.922,157:156.924,158:157.924,160:159.927}},Tb:{a:65,c:"30FFC7",m:158.925,em:158.925,iso:{159:158.925}},Dy:{a:66,c:"1FFFC7",m:162.5,em:163.929,iso:{156:155.924,158:157.924,160:159.925,161:160.927,162:161.927,163:162.929,164:163.929}},Ho:{a:67,c:"00E675",m:164.93,em:164.93,iso:{165:164.93}},Er:{a:68,c:"00E675",m:167.259,em:165.93,iso:{162:161.929,164:163.929,166:165.93,167:166.932,168:167.932,170:169.935}},Tm:{a:69,c:"00D452",m:168.934,em:168.934,iso:{169:168.934}},Yb:{a:70,c:"00BF38",m:173.04,em:173.939,iso:{168:167.934,170:169.935,171:170.936,172:171.936,173:172.938,174:173.939,176:175.943}},Lu:{a:71,c:"00AB24",m:174.967,em:174.941,iso:{175:174.941,176:175.943}},Hf:{a:72,c:"4DC2FF",m:178.49,em:179.947,iso:{174:173.94,176:175.941,177:176.943,178:177.944,179:178.946,180:179.947}},Ta:{a:73,c:"4DA6FF",m:180.948,em:180.948,iso:{180:179.947,181:180.948}},W:{a:74,c:"2194D6",m:183.84,em:183.951,iso:{180:179.947,182:181.948,183:182.95,184:183.951,186:185.954}},Re:{a:75,c:"267DAB",m:186.207,em:186.956,iso:{185:184.953,187:186.956}},Os:{a:76,c:"266696",m:190.23,em:191.961,iso:{184:183.952,186:185.954,187:186.956,188:187.956,189:188.958,190:189.958,192:191.961}},Ir:{a:77,c:"175487",m:192.217,em:192.963,iso:{191:190.961,193:192.963}},Pt:{a:78,c:"D0D0E0",m:195.078,em:194.965,iso:{190:189.96,192:191.961,194:193.963,195:194.965,196:195.965,198:197.968}},Au:{a:79,c:"FFD123",m:196.967,em:196.967,iso:{197:196.967}},Hg:{a:80,c:"B8B8D0",m:200.59,em:201.971,iso:{196:195.966,198:197.967,199:198.968,200:199.968,201:200.97,202:201.971,204:203.973}},Tl:{a:81,c:"A6544D",m:204.383,em:204.974,v:[1,3],iso:{203:202.972,205:204.974}},Pb:{a:82,c:"575961",m:207.2,em:207.977,v:[4,2],iso:{204:203.973,206:205.974,207:206.976,208:207.977}},Bi:{a:83,c:"9E4FB5",m:208.98,em:208.98,v:[3,5],iso:{209:208.98}},Po:{a:84,c:"AB5C00",m:209,em:209,v:[2,3,4,6]},At:{a:85,c:"754F45",m:210,em:210,e:7,v:[1,3,5,7]},Rn:{a:86,c:"428296",m:222,em:222,v:[0]},Fr:{a:87,c:"420066",m:223,em:223,v:[0,1]},Ra:{a:88,c:"007D00",m:226,em:226,v:[0,2]},Ac:{a:89,c:"70ABFA",m:227,em:227},Th:{a:90,c:"00BAFF",m:232.038,em:232.038},Pa:{a:91,c:"00A1FF",m:231.036,em:231.036,iso:{231:231.036}},U:{a:92,c:"008FFF",m:238.029,em:238.051,iso:{234:234.041,235:235.044,238:238.051}},Np:{a:93,c:"0080FF",m:237,em:237},Pu:{a:94,c:"006BFF",m:244,em:244},Am:{a:95,c:"545CF2",m:243,em:243},Cm:{a:96,c:"785CE3",m:247,em:247},Bk:{a:97,c:"000000",m:247,em:247},Cf:{a:98,c:"8A4FE3",m:251,em:251},Es:{a:99,c:"B31FD4",m:252,em:252},Fm:{a:100,c:"B31FBA",m:257,em:257},Md:{a:101,c:"B30DA6",m:258,em:258},No:{a:102,c:"BD0D87",m:259,em:259},Lr:{a:103,c:"C70066",m:262,em:262},Rf:{a:104,c:"CC0059",m:261,em:261},Db:{a:105,c:"D1004F",m:262,em:262},Sg:{a:106,c:"D90045",m:266,em:266},Bh:{a:107,c:"E00038",m:277,em:277},Hs:{a:108,c:"E6002E",m:269,em:269},Mt:{a:109,c:"EB0026",m:268,em:268},Ds:{a:110,c:"000000",m:271,em:271},Rg:{a:111,c:"000000",m:272,em:272},isElectronAcceptor:function(d){var c=d.a;return c>=6&&c<=9||c>=15&&c<=17||c>=33&&c<=35||c>=50&&c<=53||c>=83&&c<=85},html:function(q){var l=[",,D,T"+(JSDraw2.defaultoptions.query==false?"":",,.*-Wildcard,.A-Not Hydrogen,.Q-Not H or C,.X-Halide,.M-Metal,,.R,.R1,.R2,.R3,.R4"),"H,,,,,,,,,,,,,,,,,He","Li,Be,,,,,,,,,,,B,C,N,O,F,Ne","Na,Mg,,,,,,,,,,,Al,Si,P,S,Cl,Ar","K,Ca,Sc,Ti,V,Cr,Mn,Fe,Co,Ni,Cu,Zn,Ga,Ge,As,Se,Br,Kr","Rb,Sr,Y,Zr,Nb,Mo,Tc,Ru,Rh,Pd,Ag,Cd,In,Sn,Sb,Te,I,Xe","Cs,Ba,La,Hf,Ta,W,Re,Os,Ir,Pt,Au,Hg,Tl,Pb,Bi,Po,At,Rn","Fr,Ra,Ac,Rf,Ha",",,Ce,Pr,Nd,Pm,Sm,Eu,Gd,Tb,Dy,Ho,Er,Tm,Yb,Lu",",,Th,Pa,U,Np,Pu,Am,Cm,Bk,Cf,Es,Fm,Md,No,Lr"];var d=Math.round(20*q);var u={width:Math.round(d*3/2)+"px",height:Math.round(d)+"px",fontSize:Math.round(d*2/3)+"px",textAlign:"center",padding:"0"};var w=scilligence.Utils.createTable();var f=function(j){var z=j.target||j.srcElement;if(z.tagName!="BUTTON"){return}if(JSDraw2.Editor.periodictable.callback==null){JSDraw2.Editor.onClickPT(z.innerHTML,JSDraw2.Editor.periodictable.jsdid)}else{JSDraw2.Editor.periodictable.callback(z.innerHTML)}JSDraw2.Editor.periodictable.hide();j.preventDefault()};dojo.connect(w.parentNode,"onclick",function(j){f(j);j.preventDefault()});for(var g=0;g<l.length;++g){var t=l[g].split(",");var y=scilligence.Utils.createElement(w,"tr");for(var h=0;h<t.length;++h){var x=scilligence.Utils.createElement(y,"td");if(t[h].length>0){var q=t[h];var c={jsdrawactivate:"false"};if(q.substr(0,1)=="."){q=q.substr(1);var n=q.indexOf("-");if(n>0){c.title=q.substr(n+1);q=q.substr(0,n)}}scilligence.Utils.createElement(x,"button",q,u,c)}}}return w.parentNode},showQueryAtoms:function(h,d){var c=h.getElementsByTagName("button");for(var g=0;g<c.length;++g){if(c[g].getAttribute("r")=="1"){c[g].style.display=d?"":"none"}}},makeAtomList:function(h,d){if(h==null||h==""){return null}var c=[];var l=h.split(",");for(var g=0;g<l.length;++g){var j=scilligence.Utils.trim(l[g]);if(this.isValidAtomList(j)){c.push(j)}}return c.length==0?null:{atoms:c,t:!scilligence.Utils.isFalse(d)}},isMetal:function(c){return c==JSDraw2.PT.Li.a||c==JSDraw2.PT.Be.a||c>=JSDraw2.PT.Na.a&&c<=JSDraw2.PT.Al.a||c>=JSDraw2.PT.K.a&&c<=JSDraw2.PT.Ge.a||c>=JSDraw2.PT.Rb.a&&c<=JSDraw2.PT.Sb.a||c>=JSDraw2.PT.Cs.a&&c<=JSDraw2.PT.Po.a||c>=JSDraw2.PT.Fr.a},isValidAtomList:function(d){var c=JSDraw2.PT[d];return c!=null&&c.a>0||d=="*"||d=="A"||d=="a"||d=="c"||this.isArAtom(d.toUpperCase())},isArAtom:function(c){return c=="C"||c=="N"||c=="S"||c=="P"||c=="O"}};JSDraw2.Atom=scil.extend(scil._base,{constructor:function(f,d,c){this.T="ATOM";this.p=f;this.charge=0;this.isotope=null;this.radical=null;this.group=null;this.alias=null;this.superatom=null;this.attachpoints=[];this.rgroup=null;this.bio=c;this.locked=false;this.hidden=null;this._rect=null;if(c==null){if(d==null||d.length==0){this.elem="C"}else{if(d=="D"){this.elem="H";this.isotope=2}else{if(d=="T"){this.elem="H";this.isotope=3}else{this.elem=d}}}}else{this.elem=d}this.color=null;this.hcount=null;this.selected=false;this.f=null;this.bonds=null;this.id=null;this.atommapid=null;this.query=null;this.hasError=null;this.hs=null;this.val=null;this.tag=null},clone:function(d){var c=new JSDraw2.Atom(this.p.clone(),this.elem,dojo.clone(this.bio));c.charge=this.charge;c.isotope=this.isotope;c.radical=this.radical;c.hcount=this.hcount;c.id=this.id;c.color=this.color;c.tag=this.tag;c.alias=this.alias;c.superatom=this.superatom==null?null:this.superatom.clone();c.attachpoints=scil.clone(this.attachpoints);c.rgroup=this.rgroup==null?null:this.rgroup.clone(d);c.atommapid=this.atommapid;c.hasError=this.hasError;c.hs=this.hs;c.val=this.val;if(this.query!=null){c.query=scil.clone(this.query)}if(this.bio!=null){c.bio=scil.clone(this.bio)}c.locked=this.locked;c.hidden=this.hidden;c.ratio=this.ratio;c.selected=this.selected;return c},biotype:function(){return this.bio==null?null:this.bio.type},isMarkedStereo:function(){var c=this.bonds;if(c==null||c.length!=3&&c.length!=4){return false}for(var d=0;d<c.length;++d){if(c[d].a1==this&&(c[d].type==JSDraw2.BONDTYPES.WEDGE||c[d].type==JSDraw2.BONDTYPES.HASH)){return true}}return false},updateRGroup:function(){if(this.rgroup!=null){this.rgroup.text=(this.alias==null||this.alias==""?this.elem:this.alias)+"="}},getLabel:function(){if(this.alias!=null&&this.alias!=""){return this.alias}return this.elem},html:function(n,g){var h="<a i='"+this.id+"' e='"+scil.Utils.escXmlValue(this.elem)+"' p='"+this.p.toString(n)+"'";if(this.bio==null){if(this.charge!=0){h+=" c='"+this.charge+"'"}if(this.radical>=1&&this.radical<=3){h+=" rad='"+this.radical+"'"}if(this.isotope>0){h+=" iso='"+this.isotope+"'"}if(this.tag!=null&&this.tag!=""){h+=" tag='"+scil.Utils.escXmlValue(this.tag)+"'"}if(this.alias!=null&&this.alias!=""){h+=" alias='"+scil.Utils.escXmlValue(this.alias)+"'"}if(this.color!=null){h+=" clr='"+this.color+"'"}if(this.atommapid>0){h+=" ami='"+this.atommapid+"'"}if(this.locked){h+=" locked='1'"}if(this.attachpoints.length>0){var c="";for(var d=0;d<this.attachpoints.length;++d){c+=(d>0?",":"")+this.attachpoints[d]}h+=" apo='"+c+"'"}if(this.hs>0){h+=" hs='"+this.hs+"'"}if(this.val>0){h+=" val='"+this.val+"'"}if(this.group!=null){h+=" g='"+this.group.id+"'"}if(this.query!=null){if(this.query.sub!=null){h+=" sub='"+this.query.sub+"'"}if(this.query.uns!=null){h+=" uns='"+(this.query.uns?1:0)+"'"}if(this.query.rbc!=null){h+=" rbc='"+this.query.rbc+"'"}if(this.query.als!=null&&this.query.t!=null){h+=" als='"+this.query.als.join(",")+"'";h+=" als_t='"+(this.query.t==false?0:1)+"'"}}}else{h+=" bio='"+this.bio.type+"'";if(!scil.Utils.isNullOrEmpty(this.bio.subtype)){h+=" subtype='"+this.bio.subtype+"'"}if(!scil.Utils.isNullOrEmpty(this.bio.sequences)){h+=" seq='"+scil.Utils.escXmlValue(this.bio.sequences)+"'"}if(this.bio.id>0){h+=" bioid='"+scil.Utils.escXmlValue(this.bio.id)+"'"}if(!scil.Utils.isNullOrEmpty(this.bio.annotation)){h+=" ann='"+scil.Utils.escXmlValue(this.bio.annotation)+"'"}if(this.elem=="?"&&!scil.Utils.isNullOrEmpty(this.bio.ambiguity)){h+=" amb='"+scil.Utils.escXmlValue(this.bio.ambiguity)+"'"}if(this.biotype()==scil.helm.HELM.BLOB&&!scil.Utils.isNullOrEmpty(this.bio.blobtype)){h+=" blobtype='"+scil.Utils.escXmlValue(this.bio.blobtype)+"'"}if(scil.helm.isInlineSmilesNode(this)){var q=scil.helm.Monomers.getMonomerSmiles(this.elem);if(!scil.Utils.isNullOrEmpty(q)){h+=" smiles='"+scil.Utils.escXmlValue(q)+"'"}}}if(this.rgroup==null&&this.superatom==null){h+="/>"}else{h+=">\n";if(this.rgroup!=null){h+="<rgroup>\n";h+=this.rgroup.html(n)+"\n";for(var f=0;f<this.rgroup.mols.length;++f){var l=this.rgroup.mols[f]._getXml(null,null,null,null,g,true);if(l!=null){h+=l}}h+="</rgroup>"}if(this.superatom!=null){h+="<superatom>\n";h+=this.superatom._getXml(null,null,null,null,g,true);h+="</superatom>"}h+="</a>"}return h},readHtml:function(x){var q=x.getAttribute("c");if(q!=null){this.charge=parseInt(q)}var D=x.getAttribute("clr");if(D!=null){this.color=D}var E=x.getAttribute("rad");if(E!=null&&E!=""){this.radical=parseInt(E)}var A=x.getAttribute("iso");if(A!=null&&A!=""){this.isotope=parseInt(A)}var y=x.getAttribute("hs");if(y!=null&&y!=""){this.hs=parseInt(y)}var P=x.getAttribute("val");if(P!=null&&P!=""){this.val=parseInt(P)}var N=x.getAttribute("tag");if(N!=null&&N!=""){this.tag=N}var d=x.getAttribute("alias");if(d!=null&&d!=""){this.alias=d}var h=x.getAttribute("ami");if(h!=null&&!isNaN(h)){this.atommapid=parseInt(h)}var l=x.getAttribute("apo");if(l!=null&&l!=""){var J=l.split(",");for(var z=0;z<J.length;++z){var H=J[z];var l=isNaN(H)?0:parseInt(H);if(l>0){this.attachpoints.push(l)}}}var F=x.getAttribute("rbc");if(F!=null){if(this.query==null){this.query={}}this.query.rbc=parseInt(F)}var K=x.getAttribute("sub");if(K!=null){if(this.query==null){this.query={}}this.query.sub=K=="*"?"*":parseInt(K)}var O=x.getAttribute("uns");if(O=="1"||O=="0"){if(this.query==null){this.query={}}this.query.uns=O=="1"}var f=JSDraw2.PT.makeAtomList(x.getAttribute("als"),x.getAttribute("als_t"));if(f!=null){if(this.query==null){this.query={}}this.query.als=f.atoms;this.query.t=f.t}if(this.bio!=null){this.bio.subtype=x.getAttribute("subtype");this.bio.sequences=x.getAttribute("seq");bioid=parseInt(x.getAttribute("bioid"));if(bioid>0){this.bio.id=bioid}var j=x.getAttribute("ann");if(!scil.Utils.isNullOrEmpty(j)){this.bio.annotation=j}var g=x.getAttribute("amb");if(this.elem=="?"&&!scil.Utils.isNullOrEmpty(g)){this.bio.ambiguity=g}var n=x.getAttribute("blobtype");if(this.biotype()==scil.helm.HELM.BLOB&&!scil.Utils.isNullOrEmpty(n)){this.bio.blobtype=n}if(scil.helm.isInlineSmilesNode(this)){var I=x.getAttribute("smiles");if(!scil.Utils.isNullOrEmpty(I)){var C=scil.helm.Monomers.addSmilesMonomer(this.biotype(),I);scil.helm.setNodeType(this,this.biotype(),C.id)}}}if(this.elem!=null){var G=scil.Utils.getFirstElement(x,"rgroup");if(G){var M=scil.Utils.getFirstElement(G,"i");if(M!=null){var D=new JSDraw2.RGroup();if(D.readHtml(M,null)){this.rgroup=D;D.position=JSDraw2.Point.fromString(x.getAttribute("p"));var w=scil.Utils.getElements(G,"div");for(var z=0;z<w.length;++z){var B=new JSDraw2.Mol();if(B.setXml(w[z])!=null){D.mols.push(B)}}}}}}if(this.alias!=null||this.bio!=null){var L=scil.Utils.getFirstElement(x,"superatom");var u=L==null?null:scil.Utils.getFirstElement(L,"div");if(u!=null){var B=new JSDraw2.Mol();if(B.setXml(u)!=null){if(B.atoms.length==1&&B.atoms[0].elem==this.alias){this.elem=this.alias;this.alias=null}else{this.superatom=B}}}}},toggle:function(c,d){if(this._rect!=null){return this._rect.contains(c)}return this.p.distTo(c)<=d},drawCur:function(q,n,g,l){var f=this._rect==null?this.p:this._rect.center();q.createCircle({cx:f.x,cy:f.y,r:n}).setFill(g);if(this.elem=="@"&&l!=null){var j=l.getAllBonds(this);for(var h=0;h<j.length;++h){var d=j[h];if(d.type==JSDraw2.BONDTYPES.DUMMY){d.otherAtom(this).drawCur(q,n*0.75,g)}}}},needShowAtomLabel:function(){return this.elem!="C"||this.charge!=0||this.isotope!=null||this.hcount==4},showLabel:function(){return a.elem!="C"||a.charge!=0||a.isotope!=null||a.hcount==4},drawBio:function(t,n,l,f){var c=this;var d=this.biotype();var q=c.p.clone();if(d==JSDraw2.BIO.ANTIBODY){f="#00f";var g=c.bio.subtype==JSDraw2.ANTIBODY.ScFv?"#bbb":f;var h=c.bio.subtype==JSDraw2.ANTIBODY.ScFv||c.bio.subtype==JSDraw2.ANTIBODY.Fab?"#bbb":f;t.createCircle({cx:q.x,cy:q.y,r:l}).setFill("white").setStroke({color:f,width:n/2});l/=2;q.offset(0,-n);JSDraw2.Drawer.drawLine(t,new JSDraw2.Point(q.x-n,q.y),new JSDraw2.Point(q.x-n-l,q.y-l),g,n);JSDraw2.Drawer.drawLine(t,new JSDraw2.Point(q.x+n,q.y),new JSDraw2.Point(q.x+n+l,q.y-l),f,n);JSDraw2.Drawer.drawLine(t,new JSDraw2.Point(q.x-2*n,q.y+l/1.5),new JSDraw2.Point(q.x-2*n-l,q.y-l+l/1.5),g,n);JSDraw2.Drawer.drawLine(t,new JSDraw2.Point(q.x+2*n,q.y+l/1.5),new JSDraw2.Point(q.x+2*n+l,q.y-l+l/1.5),f,n);JSDraw2.Drawer.drawLine(t,new JSDraw2.Point(q.x-n,q.y),new JSDraw2.Point(q.x-n,q.y+l*2),h,n);JSDraw2.Drawer.drawLine(t,new JSDraw2.Point(q.x+n,q.y),new JSDraw2.Point(q.x+n,q.y+l*2),h,n)}else{if(d==JSDraw2.BIO.PROTEIN){var j=[{offset:0,color:"#4ea1fc"},{offset:n/20,color:"#0072e5"},{offset:n/10,color:"#003b80"}];t.createCircle({cx:this.p.x,cy:this.p.y,r:l}).setFill({type:"radial",cx:this.p.x+l/4,cy:this.p.y+l/4,colors:j})}else{if(d==JSDraw2.BIO.GENE||d==JSDraw2.BIO.DNA||d==JSDraw2.BIO.RNA){f="#00f";var g=c.bio.subtype==JSDraw2.ANTIBODY.ScFv?"#bbb":f;var h=c.bio.subtype==JSDraw2.ANTIBODY.ScFv||c.bio.subtype==JSDraw2.ANTIBODY.Fab?"#bbb":f;t.createCircle({cx:q.x,cy:q.y,r:l}).setFill("white").setStroke({color:f,width:n/2});this.drawEllipse(t,q.x+l/6,q.y+l/3,l/6,l/2,f,-20);this.drawEllipse(t,q.x+l/6,q.y-l/3,l/6,l/2,f,+20);this.drawEllipse(t,q.x-l/6,q.y+l/3,l/6,l/2,f,+20);this.drawEllipse(t,q.x-l/6,q.y-l/3,l/6,l/2,f,-20)}else{if(scil.helm.isHelmNode(c)){scil.helm.Interface.drawMonomer(t,c,q,l,n,f)}else{if(f==null){f=c.bio.type==JSDraw2.BIO.AA?"#00F":(c.bio.type==JSDraw2.BIO.BASE_RNA?"#278925":"#FFAA00")}this.drawDiamond(t,q.x,q.y,l*0.55,f,n);q.offset(0,-1);JSDraw2.Drawer.drawLabel(t,q,c.elem,f,l*(c.elem.length>1?2/c.elem.length:1),null,null,null,false)}}}}},drawDiamond:function(f,h,j,g,c,d){f.createRect({x:h-g,y:j-g,width:2*g,height:2*g}).setTransform([dojox.gfx.matrix.rotategAt(45,h,j)]).setFill("white").setStroke({color:c,width:d/2})},drawEllipse:function(h,j,l,f,g,c,d){h.createEllipse({cx:j,cy:l,rx:f,ry:g}).setFill(c).setTransform([dojox.gfx.matrix.rotategAt(d,j,l)])},hasLabel:function(d,f){var c=this;return c.bio==null&&(c.elem!="C"||c.charge!=0||c.radical!=null||c.elem=="C"&&(f=="all"||f=="terminal"&&d.getNeighborAtoms(c).length==1)||c.isotope!=null||c.hcount==4||c.hs>0||c.val>0||c.alias!=null&&c.alias!=""||c.query!=null&&(c.query.sub!=null||c.query.uns!=null||c.query.rbc!=null||c.query.als!=null&&c.query.t!=null))},hasErr:function(){var c=this;var d=c.bio?null:JSDraw2.PT[c.elem];return(!c.bio&&(d==null||d.a>=0&&c.hasError))&&c.elem!="3'"&&c.elem!="5'"},draw:function(N,F,G,y,M){var d=this;this._rect=null;var q=d.bio?null:JSDraw2.PT[d.elem];var A=M&&this.hasErr();var j=d.color;if(d.bio!=null){this.drawBio(N,F,y,j);return}var f=j;if(j==null){if(N.monocolor){j="black"}else{j=q==null||q.c==null?"#000":"#"+q.c}f=j;if(A){f=q==null||q.c==null?"#000":"#fff"}}if(d.attachpoints.length>0){this.drawApo(d,G,N,F,y,j)}if(d.alias!=null&&d.alias!=""){this._rect=JSDraw2.Atom.drawAlias(G.calcHDir(d,4*F,true),N,d.p,d.alias,A?"red":f,y)}else{var u=d.elem;var D=d.isotope;if(u=="H"){if(D==2){u="D";D=null}else{if(D==3){u="T";D=null}}}else{if(d.query!=null){var Q="";var R="";if(d.query.als!=null){Q=(d.query.t==false?"!":"")+"["+d.query.als.join(",")+"]"}if(d.query.rbc!=null){R+=(R==""?"":",")+"r"+d.query.rbc}if(d.query.sub!=null){R+=(R==""?"":",")+"s"+d.query.sub}if(d.query.uns){R+=(R==""?"":",")+"u"}if(Q!=""||R!=""){u=(Q==""?u:Q)+(R==""?"":"("+R+")")}}}var R=0;var S=0;if(A||this._haslabel){var O=JSDraw2.Drawer.drawLabel(N,d.p,u,f,y,A?"#f00":false);var g=null;var z=null;var H=null;var C=null;var L="";if(d.charge!=0){L+=(Math.abs(d.charge)==1?"":Math.abs(d.charge)+"")+(d.charge>0?"+":"-")}switch(d.radical){case 1:L+=":";break;case 2:L+="^";break;case 3:L+="^^";break}if(L!=""){g=JSDraw2.Drawer.drawLabel(N,d.p,L,j,y/1.2,false)}if(D!=null){C=JSDraw2.Drawer.drawLabel(N,d.p,D+"",j,y/1.1,false)}if(d.query==null&&d.hcount>0&&(this._haslabel||u!="C"||d.charge!=0||d.hcount==4)){z=JSDraw2.Drawer.drawLabel(N,d.p,"H",j,y,false);H=d.hcount==1?null:JSDraw2.Drawer.drawLabel(N,d.p,d.hcount+"",j,y/1.4,false)}var P=O.getTextWidth();if(g!=null||z!=null||H!=null||C!=null){var w=scil.Utils.isOpera?Math.round(y/4):0;var B=z==null?0:z.getTextWidth()+w;var J=H==null?0:H.getTextWidth()+w;var l=g==null?0:g.getTextWidth()+w;var E=C==null?0:C.getTextWidth()+w;var I=true;switch(G.calcHDir(d,4*F)){case JSDraw2.ALIGN.RIGHT:if(C!=null){C.setTransform([dojox.gfx.matrix.translate(-(P/2+E/2+(I?0:2)),-4)])}if(z!=null){z.setTransform([dojox.gfx.matrix.translate(P/2+B/2+(I?0:2),0)])}if(H!=null){H.setTransform([dojox.gfx.matrix.translate(P/2+B+J/2+(I?0:4),4)])}if(g!=null){g.setTransform([dojox.gfx.matrix.translate(P/2+B+J+l/2+(I?0:2),-4)])}R=P/2+B+J+l+(I?0:2);break;case JSDraw2.ALIGN.LEFT:if(C!=null){C.setTransform([dojox.gfx.matrix.translate(-(P/2+E/2+(I?0:2)),-4)])}if(H!=null){H.setTransform([dojox.gfx.matrix.translate(-(P/2+E+J/2+(I?0:4)),4)])}if(z!=null){z.setTransform([dojox.gfx.matrix.translate(-(P/2+E+J+B/2+(I?0:6)),0)])}if(g!=null){g.setTransform([dojox.gfx.matrix.translate(-(P/2+E+J+B+l/2+(I==0?0:0)),-4)])}R=P/2;break;case JSDraw2.ALIGN.BOTTOM:if(C!=null){C.setTransform([dojox.gfx.matrix.translate(-(P/2+E/2+(I?0:2)),-4)])}if(z!=null){z.setTransform([dojox.gfx.matrix.translate(0,y)])}if(H!=null){H.setTransform([dojox.gfx.matrix.translate(B/2+J/2+(I?0:2),y+4)])}if(g!=null){g.setTransform([dojox.gfx.matrix.translate((z==null?P/2:B/2+J)+l/2+(I?0:4),(z==null?0:y)-4)])}R=(z==null?P/2:B/2+J)+l+(I?0:4);break;case JSDraw2.ALIGN.TOP:if(C!=null){C.setTransform([dojox.gfx.matrix.translate(-(P/2+E/2+(I?0:2)),-4)])}if(z!=null){z.setTransform([dojox.gfx.matrix.translate(0,-y)])}if(H!=null){H.setTransform([dojox.gfx.matrix.translate(B/2+J/2+(I?0:2),-y+4)])}if(g!=null){g.setTransform([dojox.gfx.matrix.translate((z==null?P/2:B/2+J)+l/2+(I?0:4),(z==null?0:-y)-4)])}R=(z==null?P/2:B/2+J)+l+(I?0:4);S=(z==null?0:-y)-4;break}}else{R=P/2}}if(d.atommapid!=null){var K=d.p.clone();var O=JSDraw2.Drawer.drawText(N,K.offset(R,S-y-2),"("+d.atommapid+")","#f55",y/1.4);R+=O.getTextWidth()}if(d.val>0){var K=d.p.clone();var O=JSDraw2.Drawer.drawText(N,K.offset(R,S-y-2),"("+(d.val==15?0:d.val)+")","#000",y/1.2);R+=O.getTextWidth()}if(d.tag!=null&&d.tag!=""){var K=d.p.clone();var O=JSDraw2.Drawer.drawText(N,K.offset(R,S-y-2),"<"+d.tag+">","#000",y/1.2);R+=O.getTextWidth()}}if(d.locked){N.createCircle({cx:d.p.x,cy:d.p.y,r:y*0.6}).setStroke({color:"#0ff",width:F})}},drawApo:function(c,u,z,t,n,j){var h=c.attachpoints;for(var q=0;q<h.length;++q){var g=h[q];var l=n*1.5;var w=u.guessBond(c,l,q);if(w==null){w=c.p.clone();w.offset(l,0)}var f=c.p.clone();if(c._haslabel){f.shrink(w,n*0.6)}JSDraw2.Drawer.drawLine(z,f,w,j,t/2,g==99?2:0);if(g==99||g==98){var A=new JSDraw2.Point(f.x-w.x,f.y-w.y).rotate(90).setLength(n);var x=w.clone().offset(A.x,A.y);var y=w.clone().offset(-A.x,-A.y);if(g==99){JSDraw2.Drawer.drawBasis(z,x,y,j,t/2)}else{JSDraw2.Drawer.drawCurves(z,x,y,j,t/2)}}else{this.drawDiamond(z,w.x,w.y,n*0.3,j,t/3);JSDraw2.Drawer.drawText(z,w.offset(-n*0.2,-n*0.6),g+"",j,n*0.7)}}},drawSelect:function(f){var d=this._rect==null?this.p:this._rect.center();f.draw(this,d)}});JSDraw2.Atom.cast=function(c){return c!=null&&c.T=="ATOM"?c:null};scil.apply(JSDraw2.Atom,{match:function(z,A,t){if(!scil.Utils.areListEq(z.attachpoints,A.attachpoints)){return false}if(t){if(z._enhancedstereochemistry!=A._enhancedstereochemistry){return false}}var c=z.elem;var d=A.elem;var g=z.bio==null&&A.bio==null&&JSDraw2.Atom.match2(c,d);if(g){return true}if(z.isotope!=A.isotype||z.charge!=A.charge){return false}if(z.bio!=null||A.bio!=null){if(z.bio==null||A.bio==null){return false}return z.bio.type==A.bio.type&&c==d}if(c!="L"&&d!="L"){return false}var n=[];var q=[];var u=true;var w=true;if(c=="L"){if(z.query!=null&&z.query.als!=null){for(var h=0;h<z.query.als.length;++h){n.push(z.query.als[h])}if(z.query.t==false){u=false}}}else{list.push(c)}if(d=="L"){if(A.query!=null&&A.query.als!=null){for(var h=0;h<A.query.als.length;++h){q.push(A.query.als[h])}if(A.query.t==false){w=false}}}else{q.push(d)}for(var h=0;h<n.length;++h){for(var l=0;l<q.length;++l){g=JSDraw2.Atom.match(n[h],q[l]);if(g&&u==w){return true}}}return u!=w},match2:function(c,d){return c==d||c=="*"||c=="A"||d=="*"||d=="A"||c=="X"&&(d=="F"||d=="Cl"||d=="Br"||d=="I")||d=="X"&&(c=="F"||c=="Cl"||c=="Br"||c=="I")||c=="Q"&&(d!="H"&&d!="C")||d=="Q"&&(c!="H"&&c!="C")},drawAlias:function(d,j,g,h,c,f){return JSDraw2.Drawer.drawFormula(j,g,d==JSDraw2.ALIGN.LEFT,h,c,f)},isValidChiral:function(d){if(d==null){return false}return/^R|S|(abs)|(\&[0-9]+)|(and[0-9]+)|(or[0-9]+)$/.test(d)},isStereo:function(c){return c!=null&&/^((abs)|(or[0-9]+)|(and[0-9]+))$/.test(c)}});JSDraw2.BA=scilligence.extend(scilligence._base,{constructor:function(d,c,f){this.b=d;this.a=c;this.ringclosure=f;this.next=[];this.f=null;this.parent=null;this.depth=null},find:function(c){var g=new JSDraw2.Stack();g.push(this);while(g.length()>0){var d=g.pop();if(d.a==c){return d}for(var f=0;f<d.next.length;++f){g.push(d.next[f])}}return null},list:function(g,h){var j=new JSDraw2.Stack();j.push(this);var d=h=="depthfirst";while(j.length()>0){var c=d?j.pop():j.popHead();g.push(c);for(var f=0;f<c.next.length;++f){j.push(c.next[f])}}},startAtom:function(){return this.b==null?null:this.b.otherAtom(this.a)},addNext:function(c){this.next.push(c);c.parent=this;c.depth=this.depth+1},stereo:function(){if(this.b==null||!this.a.isMarkedStereo()){return null}var d=this._getOrderedBonds(this.a.bonds);var h=[this.b];for(var f=0;f<d.length;++f){h.push(d[f].b)}if(d==null){return null}this.next=d;var j=false;if(h.length==3){var l=[];for(var f=0;f<h.length;++f){if(h[f].type==JSDraw2.BONDTYPES.WEDGE||h[f].type==JSDraw2.BONDTYPES.HASH){l.push(h[f])}}if(l.length==1){var c;var g=scil.Utils.indexOf(h,l[0]);if(g==0){c=this.a.p.angleAsOrigin(h[1].otherAtom(this.a).p,h[2].otherAtom(this.a).p)}else{if(g==1){c=this.a.p.angleAsOrigin(h[2].otherAtom(this.a).p,h[0].otherAtom(this.a).p)}else{c=this.a.p.angleAsOrigin(h[0].otherAtom(this.a).p,h[1].otherAtom(this.a).p)}}if(c>180){j=true}}}return JSDraw2.BA.getStereoPattern(h,null,this.a,j)},_getOrderedBonds:function(n){var j=[];var l=[];var c=this.a;var h=this.b.otherAtom(c).p.angleTo(c.p);for(var q=0;q<n.length;++q){if(n[q]==this.b){continue}var d=n[q].otherAtom(c);var f=d.p.angleTo(c.p);var g=f-h;if(g<0){g+=360}var w=j.length;for(var t=0;t<j.length;++t){if(g<j[t]){w=t;break}}var u=this._findNext(n[q]);if(u==null&&this.a.ringclosures!=null){for(var t=0;t<this.a.ringclosures.length;++t){if(this.a.ringclosures[t].next.b==n[q]){u=this.a.ringclosures[t].next;this.a.ringclosures.splice(t,1);break}}}if(u==null){return null}j.splice(w,0,g);l.splice(w,0,u)}return l},_findNext:function(c){for(var d=0;d<this.next.length;++d){if(this.next[d].b==c){return this.next[d]}}return null},renderSmiles:function(){var l="";if(this.b!=null){var j="";if(this.b.ring!=null){j=this.b.ring?"@":"!@"}switch(this.b.type){case JSDraw2.BONDTYPES.DOUBLE:l+=j+"=";break;case JSDraw2.BONDTYPES.TRIPLE:l+=j+"#";break;case JSDraw2.BONDTYPES.SINGLEORDOUBLE:l+=j+"-,"+j+"=";break;case JSDraw2.BONDTYPES.SINGLEORAROMATIC:l+=j+"-,"+j+":";break;case JSDraw2.BONDTYPES.DOUBLEORAROMATIC:l+=j+"=,"+j+":";break;case JSDraw2.BONDTYPES.UNKNOWN:l+=j+"~";break;case JSDraw2.BONDTYPES.DUMMY:l+=j+"..";break;default:if(this.b.ring!=null){l+=j+"-"}break}}if(this.ringclosure==null){var n=this.stereo();var c=JSDraw2.PT.isArAtom(this.a.elem);if(this.a.elem=="5'"||this.a.elem=="3'"){}else{if(this.a.bio){l+="[["+this.a.elem+"]]"}else{if((c||this.a.elem=="Cl"||this.a.elem=="F"||this.a.elem=="Br"||this.a.elem=="I"||this.a.elem=="B")&&this.a.charge==0&&this.a.isotope==null&&n==null&&this.a.query==null&&!this.a.locked){if(this.a.aromatic&&c){l+=this.a.elem.toLowerCase()}else{l+=this.a.elem}}else{l+="[";if(this.a.query!=null&&this.a.query.als!=null){for(var g=0;g<this.a.query.als.length;++g){if(g>0){l+=","}if(this.a.query.t==false){l+="!"}l+=this.a.query.als[g]}}else{if(this.a.isotope!=null){l+=this.a.isotope}l+=this.a.elem}if(this.a.isotope!=null||this.a.charge!=0){if(this.a.hcount>0){l+="H"+(this.a.hcount>1?this.a.hcount:"")}}if(this.a.charge!=0){if(this.a.charge==1){l+="+"}else{if(this.a.charge==-1){l+="-"}else{l+=(this.a.charge>0?"+":"-")+Math.abs(this.a.charge)}}}if(n!=null){l+=n+(this.a.hcount==1?"H":"")}if(this.a.query!=null&&this.a.query.rbc!=null){l+=";R"+this.a.query.rbc}if(this.a.query!=null&&this.a.query.sub!=null){l+=";X"+this.a.query.sub}if(this.a.locked){l+=";0"}l+="]"}}}if(this.a.ringclosures!=null){var h=this.a.ringclosures;for(var g=0;g<h.length;++g){l+=(h[g].ri<10?"":"%")+h[g].ri}}}else{l+=(this.ringclosure<10?"":"%")+this.ringclosure}if(this.next.length>0){for(var f=0;f<this.next.length-1;++f){var d=this.next[f].renderSmiles();if(d==null||d.length==0){continue}if(/^[0-9|\=|\#]+$/.test(d)){l+=d}else{l+="("+d+")"}}l+=this.next[this.next.length-1].renderSmiles()}return l}});JSDraw2.BA.getStereoPattern=function(h,g,c,l){var j="";for(var f=0;f<h.length;++f){var d=g==null?h[f]:h[f][g];if(d.type==JSDraw2.BONDTYPES.WEDGE&&d.a1==c){j+="U"}else{if(d.type==JSDraw2.BONDTYPES.HASH&&d.a1==c){j+="D"}else{j+="-"}}}switch(j){case"D--":case"DD-":case"DDD":case"--D":case"-D-":case"-DD":case"D---":case"-U--":case"--D-":case"---U":case"DU--":case"-DU-":case"--DU":case"U--D":return l?"@@":"@";case"U--":case"UU-":case"UUU":case"--U":case"-U-":case"-UU":case"U---":case"-D--":case"--U-":case"---D":case"UD--":case"-UD-":case"--UD":case"D--U":return l?"@":"@@";default:return null}};JSDraw2.Base64={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode:function(q){if(q==null){return null}var t="";var c,d,f,g,h,j,l;var n=0;q=JSDraw2.Base64._utf8_encode(q);while(n<q.length){c=q.charCodeAt(n++);d=q.charCodeAt(n++);f=q.charCodeAt(n++);g=c>>2;h=((c&3)<<4)|(d>>4);j=((d&15)<<2)|(f>>6);l=f&63;if(isNaN(d)){j=l=64}else{if(isNaN(f)){l=64}}t=t+this._keyStr.charAt(g)+this._keyStr.charAt(h)+this._keyStr.charAt(j)+this._keyStr.charAt(l)}return t},decode:function(q){if(q==null){return null}var t="";var c,d,f;var g,h,j,l;var n=0;q=q.replace(/[^A-Za-z0-9\+\/\=]/g,"");while(n<q.length){g=this._keyStr.indexOf(q.charAt(n++));h=this._keyStr.indexOf(q.charAt(n++));j=this._keyStr.indexOf(q.charAt(n++));l=this._keyStr.indexOf(q.charAt(n++));c=(g<<2)|(h>>4);d=((h&15)<<4)|(j>>2);f=((j&3)<<6)|l;t=t+String.fromCharCode(c);if(j!=64){t=t+String.fromCharCode(d)}if(l!=64){t=t+String.fromCharCode(f)}}t=JSDraw2.Base64._utf8_decode(t);return t},_utf8_encode:function(g){g=g.replace(/\r\n/g,"\n");var h="";for(var f=0;f<g.length;f++){var d=g.charCodeAt(f);if(d<128){h+=String.fromCharCode(d)}else{if((d>127)&&(d<2048)){h+=String.fromCharCode((d>>6)|192);h+=String.fromCharCode((d&63)|128)}else{h+=String.fromCharCode((d>>12)|224);h+=String.fromCharCode(((d>>6)&63)|128);h+=String.fromCharCode((d&63)|128)}}}return h},_utf8_decode:function(h){var g="";var f=0;var d=c1=c2=0;while(f<h.length){d=h.charCodeAt(f);if(d<128){g+=String.fromCharCode(d);f++}else{if((d>191)&&(d<224)){c2=h.charCodeAt(f+1);g+=String.fromCharCode(((d&31)<<6)|(c2&63));f+=2}else{c2=h.charCodeAt(f+1);c3=h.charCodeAt(f+2);g+=String.fromCharCode(((d&15)<<12)|((c2&63)<<6)|(c3&63));f+=3}}}return g}};JSDraw2.Bond=scilligence.extend(scilligence._base,{constructor:function(c,d,f){this.T="BOND";this.a1=c;this.a2=d;this.apo1=null;this.apo2=null;this.color=null;this.ring=null;this.order=null;this.rcenter=null;this.selected=false;this.tag=null;this.f=null;this.r1=null;this.r2=null;this.ratio1=null;this.ratio2=null;this.type=f==null?JSDraw2.BONDTYPES.SINGLE:f;this.shape=null},clone:function(){var c=new JSDraw2.Bond(this.a1,this.a2,this.type);c.id=this.id;c.color=this.color;c.order=this.order;c.apo1=this.apo1;c.apo2=this.apo2;c.ring=this.ring;c.rcenter=this.rcenter;c._parent=this.parent;c.r1=this.r1;c.r2=this.r2;c.ratio1=this.ratio1;c.ratio2=this.ratio2;c.shape=this.shape;c.ushift=this.ushift;c.tag=this.tag;c.selected=this.selected;return c},replaceAtom:function(d,c){if(this.a1==d){this.a1=c}else{if(this.a2==d){this.a2=c}else{return false}}return true},isBio:function(){return this.type==JSDraw2.BONDTYPES.PEPTIDE||this.type==JSDraw2.BONDTYPES.NUCLEOTIDE},bondLength:function(){return this.a1.p.distTo(this.a2.p)},center:function(){return new JSDraw2.Point((this.a1.p.x+this.a2.p.x)/2,(this.a1.p.y+this.a2.p.y)/2)},angle:function(){return this.vector().angle()},vector:function(){return new JSDraw2.Point(this.a2.p.x-this.a1.p.x,this.a2.p.y-this.a1.p.y)},otherAtom:function(c){if(this.a1==c){return this.a2}else{if(this.a2==c){return this.a1}}return null},reverse:function(){var c=this.a1;this.a1=this.a2;this.a2=c;var d=this.apo1;this.apo1=this.apo2;this.apo2=d},valence:function(){switch(this.type){case JSDraw2.BONDTYPES.SINGLE:case JSDraw2.BONDTYPES.WEDGE:case JSDraw2.BONDTYPES.HASH:case JSDraw2.BONDTYPES.WIGGLY:case JSDraw2.BONDTYPES.PEPTIDE:case JSDraw2.BONDTYPES.NUCLEOTIDE:case JSDraw2.BONDTYPES.DISULFIDE:case JSDraw2.BONDTYPES.AMIDE:case JSDraw2.BONDTYPES.BOLD:case JSDraw2.BONDTYPES.BOLDHASH:return 1;case JSDraw2.BONDTYPES.DELOCALIZED:return 1.5;case JSDraw2.BONDTYPES.DOUBLE:case JSDraw2.BONDTYPES.EITHER:return 2;case JSDraw2.BONDTYPES.TRIPLE:return 3;case JSDraw2.BONDTYPES.UNKNOWN:case JSDraw2.BONDTYPES.DUMMY:return 0;default:return null}},_centerDoubleBond:function(g,f){var c=g.getNeighborAtoms(f.a1,f.a2);var d=g.getNeighborAtoms(f.a2,f.a1);return c.length==0&&d.length==2||d.length==0&&c.length==2},_shirftDirection:function(l,j){var c=null;var d=null;var g=l.getNeighborAtoms(j.a1,j.a2,true);if(g.length==1){c=g[0]}if(c==null){var h=l.getNeighborAtoms(j.a2,j.a1,true);if(h.length==1){d=h[0]}if(d==null){if(g.length>=2&&h.length>=2){if(l._hasDoubleBonds(g[0])){c=g[0]}else{if(l._hasDoubleBonds(g[1])){c=g[1]}}if(l._hasDoubleBonds(h[0])){d=h[0]}else{if(l._hasDoubleBonds(h[1])){d=h[1]}}}}}if(c!=null){var f=j.p1.angleAsOrigin(j.p2,c.p);return f<=180}if(d!=null){var f=j.p2.angleAsOrigin(d.p,j.p1);return f<=180}},html:function(){var c="<b i='"+this.id+"' a1='"+this.a1.id+"' a2='"+this.a2.id+"' t='"+this.type+"'";if(this.ring!=null){c+=" ring='"+(this.ring?1:0)+"'"}if(this.rcenter!=null){c+=" rcenter='"+this.rcenter+"'"}if(this.color!=null){c+=" clr='"+this.color+"'"}if(!scil.Utils.isNullOrEmpty(this.r1)){c+=" r1='"+scil.Utils.escXmlValue(this.r1)+"'"}if(!scil.Utils.isNullOrEmpty(this.r2)){c+=" r2='"+scil.Utils.escXmlValue(this.r2)+"'"}if(this.apo1>0&&this.a1.superatom!=null){c+=" apo1='"+this.apo1+"'"}if(this.apo2>0&&this.a2.superatom!=null){c+=" apo2='"+this.apo2+"'"}if(this.ratio1>0){c+=" ratio1='"+this.ratio1+"'"}if(this.ratio2){c+=" ratio2='"+this.ratio2+"'"}if(this.tag!=null){c+=" tag='"+scil.Utils.escXmlValue(this.tag)+"'"}if(!scil.Utils.isNullOrEmpty(this.shape)){c+=" shape='"+this.shape+"'"}if(this.ushift>0){c+=" ushift='"+this.ushift+"'"}c+="/>";return c},readHtml:function(c){var d=c.getAttribute("clr");if(d!=null){this.color=d}this.r1=c.getAttribute("r1");this.r2=c.getAttribute("r2");this.ratio1=parseFloat(c.getAttribute("ratio1"));this.ratio2=parseFloat(c.getAttribute("ratio2"));if(isNaN(this.ratio1)){this.ratio1=null}if(isNaN(this.ratio2)){this.ratio2=null}var f=c.getAttribute("tag");if(f!=null&&f!=""){this.tag=f}this.shape=c.getAttribute("shape");this.ushift=parseInt(c.getAttribute("ushift"));if(!(this.ushift>0)){this.ushift=null}},toggle:function(d,h,c){switch(this.shape){case"U":case"D":var j=this.ushapeY(c);var f=new JSDraw2.Point(this.a1.p.x,j);var g=new JSDraw2.Point(this.a2.p.x,j);return d.onLine(f,g,h/5);case"Z":var j=(this.a1.p.y+this.a2.p.y)/2;var f=new JSDraw2.Point(this.a1.p.x,j);var g=new JSDraw2.Point(this.a2.p.x,j);return d.onLine(f,g,h/5);default:return d.onLine(this.a1.p,this.a2.p,h/5);break}},ushapeY:function(c){var d=this.ushift>0?this.ushift:1;if(this.shape=="U"){return Math.min(this.a1.p.y,this.a2.p.y)-(c+d*c)}else{if(this.shape=="D"){return Math.max(this.a1.p.y,this.a2.p.y)+(c+d*c)}else{return(this.a1.p.y+this.a2.p.y)/2}}},drawCur:function(j,h,d,g,c,f){var l=(this.a1.p.x+this.a2.p.x)/2;var n=this.ushapeY(f);j.createCircle({cx:l,cy:n,r:h}).setFill(d)},_drawBond:function(u,c,g,n,t,q,j,l,f){if(t==null||t==0){JSDraw2.Drawer.drawLine(u,c.p1,c.p2,g,n,j,f)}else{var h=q==0?new JSDraw2.Point(0,0):c.vector().scale(1/Math.abs(q));var w=c.vector().rotate(t>0?90:-90).setLength(l==null?n*2:l);JSDraw2.Drawer.drawLine(u,c.p1.clone().offset(h.x+w.x,h.y+w.y),c.p2.clone().offset(-h.x+w.x,-h.y+w.y),g,n,j,f)}},getRColor:function(d,f){if(!scil.Utils.isNullOrEmpty(this.color)){return d}switch(f){case 1:return"#641E16";case 2:return"#0000ff";case 3:return"#aaaaaa"}return"black"},splitPosR:function(g){if(!scil.Utils.isNullOrEmpty(g)){var h=g=="?"?"?:?":g+"";var c=h.indexOf(":");if(c>=0){var d=h.substr(0,c);var f=h.substr(c+1);return{pos:(d==""?"?":d),r:(f==""?"?":f)}}}return{pos:"?",r:"?"}},_fmtBondAnn:function(){var j="";var l="";var d=this.splitPosR(this.r1);var f=this.splitPosR(this.r2);if(d.pos!="?"){j+=(j==""?"":"/")+"Pos: "+d.pos}if(f.pos!="?"){l+=(l==""?"":"/")+"Pos: "+f.pos}if(d.r!="?"){j+=(j==""?"":"/")+"R#: "+d.r}if(f.r!="?"){l+=(l==""?"":"/")+"R#: "+f.r}var c=scil.helm.defaultbondratio==null?"":scil.helm.defaultbondratio;var g=scil.Utils.isNullOrEmpty(this.ratio1)?c:this.ratio1;var h=scil.Utils.isNullOrEmpty(this.ratio2)?c:this.ratio2;if(g!=c){j+=(j==""?"":"/")+"Ratio: "+g}if(h!=c){l+=(l==""?"":"/")+"Ratio: "+h}return{ba1:j,ba2:l}},drawBondAnnotation:function(t,n,c){var q=this._fmtBondAnn();var d=q.ba1;var f=q.ba2;if(d==""&&f==""){return}var j=(c.p1.x-c.p2.x)/90;var l=(c.p1.y-c.p2.y)/90;var g=new JSDraw2.Point((c.p1.x+c.p2.x)/2,(c.p1.y+c.p2.y)/2);var h=g.clone();if(Math.abs(c.a1.p.x-c.a2.p.x)<n){g.offset(n*j+n*0.2,n*l-n*0.5);h.offset(-n*j+n*0.2,-n*l-n*0.5);if(!scil.Utils.isNullOrEmpty(d)){JSDraw2.Drawer.drawText(t,g,d,"green",n)}if(!scil.Utils.isNullOrEmpty(f)){JSDraw2.Drawer.drawText(t,h,f,"green",n)}}else{if(Math.abs(c.a1.p.y-c.a2.p.y)<n){g.offset(n*j,n*l-n*0.9);h.offset(-n*j,-n*l+n*0.6);if(!scil.Utils.isNullOrEmpty(d)){JSDraw2.Drawer.drawLabel(t,g,d,"green",n,null,null,null,false)}if(!scil.Utils.isNullOrEmpty(f)){JSDraw2.Drawer.drawLabel(t,h,f,"green",n,null,null,null,false)}}else{g.offset(n*j,n*l);h.offset(-n*j,-n*l);if(!scil.Utils.isNullOrEmpty(d)){JSDraw2.Drawer.drawLabel(t,g,d,"green",n,null,null,null,false)}if(!scil.Utils.isNullOrEmpty(f)){JSDraw2.Drawer.drawLabel(t,h,f,"green",n,null,null,null,false)}}}},draw:function(I,B,C,x,H){if(this.type==JSDraw2.BONDTYPES.DUMMY){if((this.a1.elem=="@"||this.a2.elem=="@")&&!this.a1.p.equalsTo(this.a2.p)){JSDraw2.Drawer.drawLine(I,this.a1.p,this.a2.p,"#eee",B/2)}return}if(this.a1.p.equalsTo(this.a2.p)){return}var f=new JSDraw2.Bond.B(this);if(!H){if(f.a1._haslabel){f.p1.shrink(f.p2,x*0.6)}if(f.a2._haslabel){f.p2.shrink(f.p1,x*0.6)}}var l=scil.Utils.isNullOrEmpty(this.color)?"black":this.color;if(H||f.type==JSDraw2.BONDTYPES.PEPTIDE||f.type==JSDraw2.BONDTYPES.AMIDE){JSDraw2.Drawer.drawLine(I,f.p1,f.p2,l,B);return}else{if(f.type==JSDraw2.BONDTYPES.DISULFIDE){JSDraw2.Drawer.drawLine(I,f.p1,f.p2,l,B);return}else{if(f.type==JSDraw2.BONDTYPES.NUCLEOTIDE){JSDraw2.Drawer.drawLine(I,f.p1,f.p2,l,B);return}}}if(!H){this.drawBondAnnotation(I,x,f)}if(this.r1>0||this.r2>0){var g=new JSDraw2.Point((f.p1.x+f.p2.x)/2,(f.p1.y+f.p2.y)/2);var q=this.getRColor(this.color,this.r1);var t=this.getRColor(this.color,this.r2);if(this.shape=="U"||this.shape=="D"){var M=this.ushapeY(x);var h=new JSDraw2.Point(f.p1.x,M);g.y=M;var j=new JSDraw2.Point(f.p2.x,M);JSDraw2.Drawer.drawLine(I,f.p1,h,q,B,null,"butt");JSDraw2.Drawer.drawLine(I,h,g,q,B,null,"butt");JSDraw2.Drawer.drawLine(I,g,j,t,B,null,"butt");JSDraw2.Drawer.drawLine(I,j,f.p2,t,B,null,"butt")}else{if(this.shape=="Z"){var F=new JSDraw2.Point(f.p1.x,g.y);var G=new JSDraw2.Point(f.p2.x,g.y);JSDraw2.Drawer.drawLine(I,f.p1,F,q,B,null,"butt");JSDraw2.Drawer.drawLine(I,F,g,q,B,null,"butt");JSDraw2.Drawer.drawLine(I,g,G,t,B,null,"butt");JSDraw2.Drawer.drawLine(I,G,f.p2,t,B,null,"butt")}else{JSDraw2.Drawer.drawLine(I,f.p1,g,q,B,null,"butt");JSDraw2.Drawer.drawLine(I,g,f.p2,t,B,null,"butt");if(this.r1==1&&this.r2==2||this.r1==2&&this.r2==1){JSDraw2.Bond.showHelmAnnotation(this.a1,this.a2,this.r1);JSDraw2.Bond.showHelmAnnotation(this.a2,this.a1,this.r2)}}}return}var w=8;if(f.type==JSDraw2.BONDTYPES.DOUBLE||f.type==JSDraw2.BONDTYPES.DELOCALIZED||f.type==JSDraw2.BONDTYPES.EITHER||f.type==JSDraw2.BONDTYPES.DOUBLEORAROMATIC){w=this._shirftDirection(C,f)?8:-8}if(f.type==JSDraw2.BONDTYPES.DOUBLE&&this._centerDoubleBond(C,f)){this._drawBond(I,f,l,B,-w,0,null,B);this._drawBond(I,f,l,B,w,0,null,B)}else{if(f.type==JSDraw2.BONDTYPES.SINGLE||f.type==JSDraw2.BONDTYPES.BOLD||f.type==JSDraw2.BONDTYPES.DOUBLE||f.type==JSDraw2.BONDTYPES.TRIPLE||f.type==JSDraw2.BONDTYPES.DELOCALIZED){this._drawBond(I,f,l,f.type==JSDraw2.BONDTYPES.BOLD?3*B:B,null,null,null,null,f.type==JSDraw2.BONDTYPES.BOLD?"butt":"round");if(f.type==JSDraw2.BONDTYPES.DOUBLE||f.type==JSDraw2.BONDTYPES.TRIPLE){this._drawBond(I,f,l,B,w,w)}if(f.type==JSDraw2.BONDTYPES.TRIPLE){this._drawBond(I,f,l,B,-w,-w)}if(f.type==JSDraw2.BONDTYPES.DELOCALIZED){this._drawBond(I,f,l,B,w,w,4)}}}if(f.type==JSDraw2.BONDTYPES.WEDGE){var J=f.vector().rotate(90).setLength(B*2);I.createPolyline([f.p1.x,f.p1.y,f.p2.x+J.x,f.p2.y+J.y,f.p2.x-J.x,f.p2.y-J.y]).setStroke({width:2}).setFill(l)}if(f.type==JSDraw2.BONDTYPES.HASH||f.type==JSDraw2.BONDTYPES.BOLDHASH){var A=f.bondLength();var D=Math.floor(A/(B*2));var u=f.vector().scale(1/D);var J=f.vector().rotate(90);for(var z=1;z<=D;++z){var E=f.p1.clone().offset(u.x*z,u.y*z);var L=B*2;if(f.type==JSDraw2.BONDTYPES.HASH){L*=z/D}else{L*=0.6}var K=J.clone().setLength(L);JSDraw2.Drawer.drawLine(I,E.clone().offset(K.x,K.y),E.clone().offset(-K.x,-K.y),l,B)}}if(f.type==JSDraw2.BONDTYPES.WIGGLY){JSDraw2.Drawer.drawCurves(I,f.p1,f.p2,l,B)}if(f.type==JSDraw2.BONDTYPES.EITHER){var u=f.vector().scale(1/Math.abs(w));var J=f.vector().rotate(w>0?90:-90).setLength(B*2);var F=f.p1.clone().offset(u.x+J.x,u.y+J.y);var G=f.p2.clone().offset(-u.x+J.x,-u.y+J.y);JSDraw2.Drawer.drawLine(I,f.p1,G,l,B);JSDraw2.Drawer.drawLine(I,f.p2,F,l,B)}if(f.type==JSDraw2.BONDTYPES.DOUBLEORAROMATIC){this._drawBond(I,f,l,B);this._drawBond(I,f,l,B,w,w,2)}if(f.type==JSDraw2.BONDTYPES.SINGLEORDOUBLE||f.type==JSDraw2.BONDTYPES.SINGLEORAROMATIC){this._drawBond(I,f,l,B,0,0,2);this._drawBond(I,f,l,B,w/2,w/2,null,B*1.5);this._drawBond(I,f,l,B,-w/2,-w/2,f.type==JSDraw2.BONDTYPES.SINGLEORAROMATIC?2:null,B*1.5)}if(f.type==JSDraw2.BONDTYPES.UNKNOWN){this._drawBond(I,f,l,B,null,null,B*1.2)}if(f.b.ring!=null){var E=this.center();I.createCircle({cx:E.x,cy:E.y,r:B*3}).setStroke({color:l,width:B/2,style:f.b.ring?"Solid":"Dash"})}if(f.b.rcenter!=null){var E=this.center();var u=f.vector().rotate(90).setLength(B*3);var J=f.vector().setLength(B*(f.b.rcenter==JSDraw2.RXNCENTER.BREAKANDCHANGE?1.5:1));if(f.b.rcenter==JSDraw2.RXNCENTER.CENTER){JSDraw2.Drawer.drawLine(I,E.clone().offset(u.x+J.x,u.y+J.y),E.clone().offset(-u.x+J.x,-u.y+J.y),l,B/2);JSDraw2.Drawer.drawLine(I,E.clone().offset(u.x-J.x,u.y-J.y),E.clone().offset(-u.x-J.x,-u.y-J.y),l,B/2);u=f.vector().rotate(90).setLength(B*1.6);J=f.vector().setLength(B*2);JSDraw2.Drawer.drawLine(I,E.clone().offset(u.x+J.x,u.y+J.y),E.clone().offset(u.x-J.x,u.y-J.y),l,B/2);JSDraw2.Drawer.drawLine(I,E.clone().offset(-u.x+J.x,-u.y+J.y),E.clone().offset(-u.x-J.x,-u.y-J.y),l,B/2)}else{if(f.b.rcenter==JSDraw2.RXNCENTER.NOTCENTER){JSDraw2.Drawer.drawLine(I,E.clone().offset(u.x+J.x,u.y+J.y),E.clone().offset(-u.x-J.x,-u.y-J.y),l,B/2);JSDraw2.Drawer.drawLine(I,E.clone().offset(u.x-J.x,u.y-J.y),E.clone().offset(-u.x+J.x,-u.y+J.y),l,B/2)}else{if(f.b.rcenter==JSDraw2.RXNCENTER.BREAK){JSDraw2.Drawer.drawLine(I,E.clone().offset(u.x+J.x,u.y+J.y),E.clone().offset(-u.x+J.x,-u.y+J.y),l,B/2);JSDraw2.Drawer.drawLine(I,E.clone().offset(u.x-J.x,u.y-J.y),E.clone().offset(-u.x-J.x,-u.y-J.y),l,B/2)}else{if(f.b.rcenter==JSDraw2.RXNCENTER.CHANGE){JSDraw2.Drawer.drawLine(I,E.clone().offset(u.x,u.y),E.clone().offset(-u.x,-u.y),l,B/2)}else{if(f.b.rcenter==JSDraw2.RXNCENTER.BREAKANDCHANGE){JSDraw2.Drawer.drawLine(I,E.clone().offset(u.x,u.y),E.clone().offset(-u.x,-u.y),l,B/2);JSDraw2.Drawer.drawLine(I,E.clone().offset(u.x+J.x,u.y+J.y),E.clone().offset(-u.x+J.x,-u.y+J.y),l,B/2);JSDraw2.Drawer.drawLine(I,E.clone().offset(u.x-J.x,u.y-J.y),E.clone().offset(-u.x-J.x,-u.y-J.y),l,B/2)}}}}}}},drawSelect:function(d,c){var f=(this.a1.p.x+this.a2.p.x)/2;var g=this.ushapeY(c);d.draw(this,new JSDraw2.Point(f,g))}});scil.apply(JSDraw2.Bond,{cast:function(c){return c!=null&&c.T=="BOND"?c:null},B:scilligence.extend(scilligence._base,{constructor:function(c){this.b=c;this.a1=c.a1;this.a2=c.a2;this.type=c.type;this.p1=c.a1.p.clone();this.p2=c.a2.p.clone()},vector:function(){return new JSDraw2.Point(this.p2.x-this.p1.x,this.p2.y-this.p1.y)},bondLength:function(){return this.p1.distTo(this.p2)}}),showHelmAnnotation:function(c,d,f){if(c.bio==null||scil.Utils.isNullOrEmpty(c.bio.annotation)){return}if(f==2&&c.p.x>d.p.x||f==1&&c.p.x<d.p.x){c.bio.annotationshowright=true}else{c.bio.annotationshowright=null}}});JSDraw2.JSDrawIO={kDefaultStructureColumn:"",downloaddlg:null,jsdsavedlg:null,jsdFiles:{jsdraw:"JSDraw2 XML",mol:"Mol File",rxn:"Reaction File",inchi:"InChI",helm:"HELM",xhelm:"xHELM",smiles:"SMILES",cml:"Chemical Markup Language",cdxml:"ChemDraw CDXML",cdx:"ChemDraw CDX",png:"PNG Picture"},jsdFiles2:{jsd:"JSDraw XML",png:"PNG Picture"},jsdFiles3:{helm:"HELM",xhelm:"xHELM"},jsssavedlg:null,jssFiles:{sdf:"SDF File",csv:"CSV File",xlsx:"Excel File",jssdf:"Xml File"},callWebservice:function(d,f,c,g){if(JSDrawServices.url==null||JSDrawServices.url==""){scil.Utils.alert("JSDraw web service is not available")}else{scil.Utils.ajax(JSDrawServices.url+"?cmd="+d,c,f,g)}},needCrossdomain:function(){if(JSDrawServices.xdomain){var g=window.location+"";var d=g.indexOf("://");var f=g.indexOf("/",d+3);var c=g.substr(0,f+1);if(!scil.Utils.startswith(JSDrawServices.url.toLowerCase(),c.toLowerCase())){return true}}return false},jsdFileOpen:function(d){var g=this.res("Please select a chemistry file")+" (*.mol, *.rxn, *.cdx, *.skc, *.helm, *.xhelm, *.smiles etc.):";if(this.needCrossdomain()){var h=JSDrawServices.url+"?cmd=";scil.Utils.uploadFile("<img src='"+scil.App.imgSmall("open.png")+"'>"+this.res("Import File"),g,h+"xdomain.post",function(j){scil.Utils.jsonp(h+"openjsd",function(l){JSDraw2.JSDrawIO.jsdFileOpen2(d,l)},{_xfilename:j})},null,null,null,null,true)}else{if(this.jsdFileOpenDlg==null){var c={note:{type:"html",template:"<div style='white-space:nowrap'>"+g+"</div>"},file:{type:"postfile",attributes:{name:"file"}},importas:{type:"select",items:{"":"",reactant:"Import as Reactant",product:"Import as Product"}}};var f=this;this.jsdFileOpenDlg=scil.Form.createDlgForm("Load File",c,{src:scil.App.imgSmall("open.png"),label:"Load File",onclick:function(){f.jsdFileOpen1()}},{usepostform:true,hidelabel:true})}this.jsdFileOpenDlg.show();this.jsdFileOpenDlg.jsd=d;this.jsdFileOpenDlg.form.postform.reset()}},jsdFileOpen1:function(){var c=this;this.jsdFileOpenDlg.form.post(JSDrawServices.url+"?cmd=openjsd",null,function(f){var d=c.jsdFileOpenDlg.form.fields.importas==null?null:c.jsdFileOpenDlg.form.fields.importas.value;c.jsdFileOpen2(c.jsdFileOpenDlg.jsd,f,d);c.jsdFileOpenDlg.hide()})},jsdFileOpen2:function(j,n,h){var c=n.base64!=null?JSDraw2.Base64.decode(n.base64):n.contents;if(h=="reactant"||h=="product"){var l=new JSDraw2.Mol();if(n.format=="molfile"){l.setMolfile(c)}else{if(n.format=="rxn"){l.setRxnfile(c)}else{l.setXml(c)}}if(l.atoms.length>0){var q=l.parseRxn(true);var d=false;if(q==null){if(j.pasteMol(l,null,h)){d=true}}else{if(q.arrow==null&&q.products.length==0){for(var g=0;g<q.reactants.length;++g){if(j.pasteMol(q.reactants[g],null,h)){d=true}}}else{if(h=="reactant"&&q.reactants!=null){for(var g=0;g<q.reactants.length;++g){if(j.pasteMol(q.reactants[g],null,h)){d=true}}}else{if(h=="product"&&q.products!=null){for(var g=0;g<q.products.length;++g){if(j.pasteMol(q.products[g],null,h)){d=true}}}}}}if(d){j.refresh(true)}else{scil.Utils.alert("No structure imported")}}}else{if(n.format=="molfile"||scil.Utils.endswith(n.filename,".mol")){j.setMolfile(c)}else{if(n.format=="rxn"||scil.Utils.endswith(n.filename,".rxn")){j.setRxnfile(c)}else{if(n.format=="xhelm"||scil.Utils.endswith(n.filename,".xhelm")){j.setXHelm(c)}else{if(n.format=="helm"||scil.Utils.endswith(n.filename,".helm")){j.setHelm(c)}else{j.setXml(c)}}}}j.activate(true);j.setModified(true)}},jsdFileSave:function(d){if(JSDraw2.JSDrawIO.jsdsavedlg==null){var c=scil.Utils.createElement(null,"div",this.res("Please select the file format to be saved: "),{width:"420px",margin:"10px"});var g=scil.Utils.createElement(c,"select");scil.Utils.createElement(g,"option");if(d.options.toolbarmode=="tlc"){scil.Utils.listOptions(g,JSDraw2.JSDrawIO.jsdFiles2,null,false)}else{scil.Utils.listOptions(g,JSDraw2.JSDrawIO.jsdFiles,null,false)}var f=scil.Utils.createElement(c,"div",null,{marginTop:"20px",textAlign:"center"});scil.Utils.createButton(f,{src:scil.App.imgSmall("submit.png"),label:"Save File",onclick:function(h){JSDraw2.JSDrawIO.jsdFileSave2();h.preventDefault()}});scil.Utils.createButton(f,"&nbsp;");scil.Utils.createButton(f,{src:scil.App.imgSmall("cancel.png"),label:"Cancel",onclick:function(h){JSDraw2.JSDrawIO.jsdsavedlg.hide();h.preventDefault()}});JSDraw2.JSDrawIO.jsdsavedlg=new JSDraw2.Dialog("<img src='"+scil.App.imgSmall("save.png")+"'>"+this.res("Save File"),c);JSDraw2.JSDrawIO.jsdsavedlg.sel=g}JSDraw2.JSDrawIO.jsdsavedlg.jsd=d;JSDraw2.JSDrawIO.jsdsavedlg.show();JSDraw2.JSDrawIO.jsdsavedlg.sel.selectedIndex=0},jsdFileSave2:function(){this.jsdFileSave3(JSDraw2.JSDrawIO.jsdsavedlg.sel.value,JSDraw2.JSDrawIO.jsdsavedlg.jsd);this.jsdsavedlg.hide()},jsdFileSave3:function(f,h){var l;if(f=="helm"){l=h.getHelm()}else{if(f=="xhelm"){l=h.getXHelm()}else{l=h.getXml()}}var d=new Date();var j="JSDraw";var g=j+d.getFullYear()+"-"+(d.getMonth()+1)+"-"+d.getDate()+"."+f;var c={client:"jsdraw",wrapper:"none",filename:g,contents:l};scil.Utils.post(JSDrawServices.url+"?cmd=savefile",c,"_blank")},cleanup:function(g){var t=g.m.clone(true);if(t!=null&&t.atoms.length==0){t=null}var u=t!=null?t.getSmiles():g.getSmiles();if(u==null||u==""){return}var w=JSDrawServices.url;if(w==null){scil.Utils.alert("JSDraw Web Service is not configured yet.");return}var h=window.location;var q=h.protocol+"//"+h.host+"/";var d=null;if(scil.Utils.startswith(w.toLowerCase(),q.toLowerCase())){d=scil.Utils.ajax;u=t!=null?t.getXml():g.getXml()}else{d=scil.Utils.jsonp}var n=[];if(t!=null){for(var f=0;f<g.m.bonds.length;++f){var c=g.m.bonds[f];if(c.a1.selected!=c.a2.selected){n.push(c)}}}var j=this;d(w+"?cmd=cleanup",function(y){if(t!=null){var z=j._data2Mol(y);if(z!=null&&!z.isEmpty()){z.setBondLength(g.bondlength);if(!j._connectOpenBonds(g.m,z,n,g.bondlength)){var l=t.rect().center();var x=z.rect().center();z.offset(l.x-x.x,l.y-x.y)}g.pushundo();g.delSelected();z.setSelected(true);g.m.mergeMol(z);g.refresh(true)}}else{j._setMolData(g,y,null,true)}},{input:u,inputformat:"jsdraw"})},_connectOpenBonds:function(n,t,j,h){if(j.length==0){return false}if(j.length>1){for(var q=0;q<j.length;++q){var g=j[q];var u=g.a1.selected?g.a1:g.a2;var l=g.a1.selected?g.a2:g.a1;var c=t.getObjectById(u.id);if(c==null){continue}var w=g.clone();w.replaceAtom(u,c);t.addBond(w)}return false}var g=j[0];var u=g.a1.selected?g.a1:g.a2;var l=g.a1.selected?g.a2:g.a1;var c=t.getObjectById(u.id);if(c==null){return false}var x;if(g.selected){var q=scil.Utils.indexOf(n.bonds,g);n.bonds.splice(q,1);x=n.guessBond(l,h);n.bonds.splice(q,0,g)}else{x=u.p}t.offset(x.x-c.p.x,x.y-c.p.y);var y=t.guessBond(c,h);var d=l.p.angleTo(x);var f=y.angleTo(x);t.rotate(x,d-f);var w=g.clone();w.replaceAtom(u,c);t.addBond(w);return true},_data2Mol:function(c){var d=new JSDraw2.Mol();if(typeof(c)=="string"){d=d.setXml(c)}else{d=d.setXml(c.output)}return d},_setMolData:function(f,d,h,c){var g=this._data2Mol(d);if(g==null||g.isEmpty()){return}f.pushundo();if(f.setXml(g.getXml())!=null){f.refresh(true)}},name2structure:function(d,g){var c=function(h){var j;if(JSDrawServices.id2s!=null&&JSDrawServices.id2s.url!=null&&JSDrawServices.id2s.regex!=null&&h.match(JSDrawServices.id2s.regex)!=null){j=JSDrawServices.id2s.url}else{if(JSDrawServices.n2s!=null&&JSDrawServices.n2s.url!=null){j=JSDrawServices.n2s.url}}if(j==null){scil.Utils.alert("Name-to-structure is not configured yet.");return}scil.Utils.jsonp(j,function(l){JSDraw2.JSDrawIO._setMolData(d,l,h)},{q:h,fmt:"jsdraw"},{showprogress:true})};var f=JSDrawServices.n2s!=null&&JSDrawServices.url.msg!=null?JSDrawServices.n2s.msg:this.res("Please type chemical name, CAS, SMILES etc.")+":";scil.Utils.prompt2({caption:"<img src='"+scil.Utils.imgSrc("img/n2s.gif")+"'>"+this.res("Name to Structure"),message:f,button:this.res("Convert"),defaultvalue:g,callback:c,autosuggesturl:(JSDrawServices.n2s!=null?JSDrawServices.n2s.suggest:null),iconurl:scil.Utils.imgSrc("img/name2s.gif"),owner:d})},res:function(c){return JSDraw2.Language.res(c)},jssFileOpen:function(f){var c=f.options.appendingmode;var d={note:{type:"html",template:"(*.sdf,*.rdf,*.xlsx,*.csv,*.smiles)"},structurecolumn:{label:"Structure Column",value:f.options.defaultstructurecolumn},appendingmode:{label:"Appending Mode",type:"checkbox",attributes:{disabled:c=="always"},value:c=="always"||scil.Utils.isTrue(c)}};scil.FileUploader.upload({caption:this.res("Open File"),fields:d,url:JSDrawServices.url+"?cmd=openjss",callback:function(h,g){JSDraw2.JSDrawIO.jssFileOpen2(f,h,g)}})},jssFileOpen2:function(h,j,f){var g=f.dlg.form.getData();var c=g==null?null:g.appendingmode;if(scil.Utils.endswith(j.filename,".rdf")){h.setRdf(j.base64!=null?JSDraw2.Base64.decode(j.base64):j.contents,null,c?false:null,c)}else{h.setXml(j.base64!=null?JSDraw2.Base64.decode(j.base64):j.contents,null,c?false:null,c,true)}if(h.options.onafterimport!=null){h.options.onafterimport(j,f,h)}},jssFileSave:function(f){if(JSDraw2.JSDrawIO.jsssavedlg==null){var d=scil.Utils.createElement(null,"div",this.res("Please select a file type")+":",{width:"350px",margin:"10px"});var h=scil.Utils.createElement(d,"select");scil.Utils.createElement(h,"option");scil.Utils.listOptions(h,JSDraw2.JSDrawIO.jssFiles,null,false);var g=scil.Utils.createElement(d,"div",null,{marginTop:"20px",textAlign:"center"});var c=scil.Utils.createElement(g,"button","<img src='"+scil.App.imgSmall("submit.png")+"'>"+this.res("Save"));dojo.connect(c,"onclick",function(j){JSDraw2.JSDrawIO.jssFileSave2();j.preventDefault()});JSDraw2.JSDrawIO.jsssavedlg=new JSDraw2.Dialog("<img src='"+scil.App.imgSmall("save.png")+"'>"+this.res("Save File"),d);JSDraw2.JSDrawIO.jsssavedlg.sel=h}JSDraw2.JSDrawIO.jsssavedlg.jss=f;JSDraw2.JSDrawIO.jsssavedlg.show();JSDraw2.JSDrawIO.jsssavedlg.sel.selectedIndex=0},jssFileSave2:function(){var f=JSDraw2.JSDrawIO.jsssavedlg.sel.value;var d=new Date();var g="JSDrawTable"+d.getFullYear()+"-"+(d.getMonth()+1)+"-"+d.getDate()+"."+f;var c={client:"jssdf",wrapper:"none",filename:g};switch(f){case"sdf":c.contents=JSDraw2.JSDrawIO.jsssavedlg.jss.getSdf();break;case"jssdf":c.contents=JSDraw2.JSDrawIO.jsssavedlg.jss.getXml();break;case"xlsx":c.contents=JSDraw2.JSDrawIO.jsssavedlg.jss.getXml(null,true);break;case"json":c.contents=scil.Utils.json2str(JSDraw2.JSDrawIO.jsssavedlg.jss.getJson());break;case"csv":c.contents=JSDraw2.JSDrawIO.jsssavedlg.jss.getCsv();break}scil.Utils.post(JSDrawServices.url+"?cmd=savefile",c,"_blank");JSDraw2.JSDrawIO.jsssavedlg.hide()}};JSDraw2.Mol=scil.extend(scil._base,{constructor:function(c){this.T="MOL";this.name=null;this.atoms=[];this.bonds=[];this.graphics=[];this.stats=null;this.showimplicithydrogens=c!=false;this.props=null},_addAtom:function(c,d){this.atoms.push(c);c._parent=d!=null?d:this},_addBond:function(c,d){this.bonds.push(c);c._parent=d!=null?d:this},_addGraphics:function(c,d){this.graphics.push(c);c._parent=d!=null?d:this},resetIds:function(g){var f=new JSDraw2.IDGenerator(g?this._getMaxID():0);for(var d=0;d<this.atoms.length;++d){var c=this.atoms[d];c.id=f.next(c.id);c.atomid=d+1}for(var d=0;d<this.bonds.length;++d){var c=this.bonds[d];c.id=f.next(c.id);c.bondid=d+1}for(var d=0;d<this.graphics.length;++d){var c=this.graphics[d];c.id=f.next(c.id);c.graphicsid=d+1}for(var d=0;d<this.atoms.length;++d){var c=this.atoms[d];if(c.rgroup!=null){c.rgroup.id=f.next(c.rgroup.id)}}},_getMaxID:function(){var f=0;for(var d=0;d<this.atoms.length;++d){var c=this.atoms[d];if(c.id>f){f=c.id}}for(var d=0;d<this.bonds.length;++d){var c=this.bonds[d];if(c.id>f){f=c.id}}for(var d=0;d<this.graphics.length;++d){var c=this.graphics[d];if(c.id>f){f=c.id}}for(var d=0;d<this.atoms.length;++d){var c=this.atoms[d];if(c.rgroup!=null){if(c.rgroup.id>f){f=c.rgroup.id}}}return f},getObjectById:function(d){for(var c=0;c<this.atoms.length;++c){if(this.atoms[c].id==d){return this.atoms[c]}}for(var c=0;c<this.bonds.length;++c){if(this.bonds[c].id==d){return this.bonds[c]}}for(var c=0;c<this.graphics.length;++c){if(this.graphics[c].id==d){return this.graphics[c]}}},clone:function(x){var u=new JSDraw2.Mol();u.bondlength=this.bondlength;u.name=this.name;u.chiral=this.chiral;u.props=scil.clone(this.props);u.showimplicithydrogens=this.showimplicithydrogens;u.mw=this.mw;u.attachpoints=this.attachpoints;var w=[];this.resetIds(true);for(var q=0;q<this.atoms.length;++q){var c=this.atoms[q];if(x&&!c.selected){continue}var d=c.clone(x);if(x){d.atommapid=null}u._addAtom(d);w[c.id]=d}for(var q=0;q<this.bonds.length;++q){var f=this.bonds[q];if(x&&!(f.selected&&f.a1.selected&&f.a2.selected)){continue}var h=f.clone();u._addBond(h);w[f.id]=h}for(var q=0;q<this.graphics.length;++q){var l=this.graphics[q];if(x&&!l.selected){continue}var n=l.clone(w);u._addGraphics(n);w[l.id]=n}for(var q=0;q<this.bonds.length;++q){var f=this.bonds[q];var h=w[f.id];if(h==null){continue}h.a1=w[f.a1.id];h.a2=w[f.a2.id];if(h.a1==null||f.a2==null){q=q}}for(var q=0;q<this.graphics.length;++q){var l=this.graphics[q];var n=w[l.id];if(n==null){continue}if(JSDraw2.Group.cast(l)!=null){for(var t=0;t<this.atoms.length;++t){var c=this.atoms[t];if(c.group==l){w[c.id].group=n}}if(l.a!=null){n.a=w[l.a.id]}if(l.group!=null){n.group=w[l.group.id]}}else{if(JSDraw2.Bracket.cast(l)!=null){n.atoms=this._getMappedArray(l.atoms,w)}else{if(JSDraw2.Text.cast(l)!=null){n.anchors=this._getMappedArray(l.anchors,w)}else{if(JSDraw2.Shape.cast(l)!=null){n.froms=this._getMappedArray(l.froms,w);if(n.reject!=null){n.reject=w[n.reject.id]}}}}}}u._setParent(u);return u},_getMappedArray:function(g,h){var j=[];for(var f=0;f<g.length;++f){var c=g[f];if(c!=null&&h[c.id]!=null){j.push(h[c.id])}}return j},guessBond:function(c,n,l){var q=c.p.clone();var j=this.getAllBonds(c);switch(j.length){case 0:q.offset(1,0);break;case 1:q=j[0].otherAtom(c).p.clone().rotateAround(c.p,120);break;case 2:var t=j[0].otherAtom(c).p;var u=j[1].otherAtom(c).p;var h=c.p.angleAsOrigin(t,u);if(Math.abs(h-180)<=1){q=t.clone();q.rotateAround(c.p,90)}else{q.x=(t.x+u.x)/2;q.y=(t.y+u.y)/2;q.rotateAround(c.p,180)}break;case 3:var t=j[0].otherAtom(c).p;var u=j[1].otherAtom(c).p;var w=j[2].otherAtom(c).p;var d=q.angleAsOrigin(t,u);var f=q.angleAsOrigin(u,w);var g=q.angleAsOrigin(w,t);if(d>180){d=360-d}if(f>180){f=360-f}if(g>180){g=360-g}if(d>f&&d>g){q=w.clone()}else{if(f>d&&f>g){q=t.clone()}else{q=u.clone()}}q.rotateAround(c.p,180);break;default:return null}if(l>0){if(l==1&&j.length==1){q.rotateAround(c.p,120)}else{q.rotateAround(c.p,l*30)}}q.setLength(n,c.p);return q},getMaxRIndex:function(f){if(f==null){f=0}for(var d=0;d<this.atoms.length;++d){var c=this.atoms[d];if(c.elem!="R"){continue}var h=scil.Utils.parseIndex(c.alias);if(h==null||h.index==null){continue}if(h.index>f){f=h.index}if(c.rgroup!=null){for(var g=0;g<c.rgroup.mols.length;++g){var h=c.rgroup.mols[g].getMaxRIndex(f);if(h>f){f=h}}}}return f},setColor:function(f,u){var t=0;for(var l=0;l<this.atoms.length;++l){var c=this.atoms[l];if(c.color!=f&&(!u||c.selected)){c.color=f;++t}if(c.rgroup!=null){if(c.rgroup.color!=f&&(!u||c.rgroup.selected)){c.rgroup.color=f;++t}for(var q=0;q<c.rgroup.mols.length;++q){t+=c.rgroup.mols[q].setColor(f,u)}}}for(var l=0;l<this.bonds.length;++l){var d=this.bonds[l];if(d.color!=f&&(!u||d.selected)){d.color=f;++t}}for(var l=0;l<this.graphics.length;++l){var h=this.graphics[l];if(h.color!=f&&(!u||h.selected)){h.color=f;++t}}return t},clear:function(){this.name=null;this.chiral=null;this.atoms=[];this.bonds=[];this.graphics=[]},isEmpty:function(){return this.atoms.length==0&&this.bonds.length==0&&this.graphics.length==0},setSelected:function(h){if(h==null){h=false}var u=0;for(var q=0;q<this.atoms.length;++q){var c=this.atoms[q];if(c.selected!=h){c.selected=h;++u}if(c.rgroup!=null){if(c.rgroup.selected!=h){c.rgroup.selected=h;++u}for(var t=0;t<c.rgroup.mols.length;++t){u+=c.rgroup.mols[t].setSelected(h)}}}for(var q=0;q<this.bonds.length;++q){var d=this.bonds[q];if(d.selected!=h){d.selected=h;++u}}for(var q=0;q<this.graphics.length;++q){var l=this.graphics[q];if(l.selected!=h){l.selected=h;++u}}return u},lassoSelect:function(h,x,f,t,u,y){for(var n=0;n<this.atoms.length;++n){var c=this.atoms[n];if(c.p.inTriangle(x,f,t)){h.lasso.hit(c)}if(c.rgroup!=null){var l=c.rgroup;var w=l.rect();if(w.center().inTriangle(x,f,t)){h.lasso.hit(l)}for(var q=0;q<c.rgroup.mols.length;++q){c.rgroup.mols[q].lassoSelect(h,x,f,t,u,y)}}}for(var n=0;n<this.bonds.length;++n){var d=this.bonds[n];if(d.center().inTriangle(x,f,t)){h.lasso.hit(d)}}for(var n=0;n<this.graphics.length;++n){var l=this.graphics[n];var w=l.rect();if(w.center().inTriangle(x,f,t)){h.lasso.hit(l)}}h.lasso.endHits(x,f)},getSelectedAtomInMol:function(){var g=[];for(var d=0;d<this.atoms.length;++d){var c=this.atoms[d];if(c.selected){g.push(c)}else{if(c.rgroup!=null){for(var f=0;f<c.rgroup.mols.length;++f){var h=c.rgroup.mols[f].getSelectedAtomInMol();if(h.length>0){return h}}}}}return g},bracketSelect:function(q){var t=[];for(var l=0;l<this.atoms.length;++l){var c=this.atoms[l];if(q.contains(c.p)){t.push(c)}}var u=[];var f=scil.clone(this.bonds);for(var l=this.bonds.length-1;l>=0;--l){var d=this.bonds[l];var g=scil.Utils.indexOf(t,d.a1)>=0;var h=scil.Utils.indexOf(t,d.a2)>=0;if(g!=h){if(JSDraw2.Point.intersect(d.a1.p,d.a2.p,q.topleft(),q.bottomleft())||JSDraw2.Point.intersect(d.a1.p,d.a2.p,q.topright(),q.bottomright())){u.push({b:d,a:h?d.a1:d.a2});f.splice(l,1)}}}if(u.length==2||u.length==1){var n=this.bonds;this.bonds=f;var j=this.splitFragments();this.bonds=n;if(j.length>1){for(var l=0;l<j.length;++l){if(scil.Utils.arrayContainsArray(j[l].atoms,t)){if(u.length==1&&scil.Utils.indexOf(j[l].atoms,u[0].a)<0||u.length==2&&scil.Utils.indexOf(j[l].atoms,u[0].a)<0&&scil.Utils.indexOf(j[l].atoms,u[1].a)<0){t=j[l].atoms;break}}}}}for(var l=0;l<t.length;++l){t[l].selected=true}return t},selectInRect:function(t){var q=0;for(var h=0;h<this.atoms.length;++h){var c=this.atoms[h];if(t.contains(c.p)){c.selected=true;++q}if(c.rgroup!=null){var f=c.rgroup;var u=f.rect();if(u!=null&&t.contains(u.center())){f.selected=true;++q}for(var l=0;l<c.rgroup.mols.length;++l){q+=c.rgroup.mols[l].selectInRect(t)}}}for(var h=0;h<this.bonds.length;++h){var d=this.bonds[h];if(t.contains(d.center())){d.selected=true;++q}}for(var h=0;h<this.graphics.length;++h){var f=this.graphics[h];var u=f.rect();if(u!=null&&t.contains(u.center())){f.selected=true;++q}}return q},hasAtom:function(c){for(var d=0;d<this.atoms.length;++d){if(this.atoms[d]==c){return true}}return false},hasGraphics:function(c){for(var d=0;d<this.graphics.length;++d){if(this.graphics[d]==c){return true}}return false},hasBond:function(c){for(var d=0;d<this.bonds.length;++d){if(this.bonds[d]==c){return true}}return false},calcHCount:function(g){for(var d=0;d<this.atoms.length;++d){var c=this.atoms[d];if(g||c.hcount==null){this.setHCount(c)}if(c.rgroup!=null){for(var f=0;f<c.rgroup.mols.length;++f){c.rgroup.mols[f].calcHCount(g)}}}},setHCount:function(c){c.hcount=null;if(this.showimplicithydrogens==false||c.bio){return}var g=false;var w=null;if(c.elem!="R"&&c.alias!=null&&c.alias!=""){if(c.superatom==null){if(c.elem!="#"){g=true}}else{if(c.superatom!=null){var d=this.getNeighborBonds(c,true);if(d.length>c.superatom.attachpoints){if(c.superatom.atoms.length>0){g=true}}else{for(var j=0;j<d.length;++j){if(d[j].valence()!=1){g=true;break}}}}}}else{if(c.hs>0){w=c.hs-1}else{var f=JSDraw2.PT[c.elem];if(f!=null&&f.v!=null&&f.e!=null){var d=this.getNeighborBonds(c);var u=0;var l=0;for(var j=0;j<d.length;++j){var x=d[j].valence();if(x==null){return}if(x==1.5){++l;if(l>2){u+=1}else{u+=1.5}}else{u+=d[j].valence()}}if(d.length==2&&(c.elem=="O"||c.elem=="S")&&d[0].type==JSDraw2.BONDTYPES.DELOCALIZED&&d[1].type==JSDraw2.BONDTYPES.DELOCALIZED){--u}var h=0;var n=f.e<=4?0:f.e%4;var t=f.e<=4?f.e:4-(f.e%4);if(c.charge>0){if(n>0){if(n>=c.charge){h=c.charge}else{return}}else{if(t>0){if(t>=c.charge){h-=c.charge}else{return}}}}else{if(c.charge<0){if(t>0){if(t>-c.charge){h=c.elem=="B"||c.elem=="P"||c.elem=="Si"?-c.charge:c.charge}else{return}}}}if(c.radical==1||c.radical==3){u+=2}else{if(c.radical==2){++u}}if(c.attachpoints!=null){for(var j=0;j<c.attachpoints.length;++j){if(c.attachpoints[j]!=99){++u}}}u=Math.ceil(u);g=true;for(var j=0;j<f.v.length;++j){if(u<=f.v[j]+h){w=f.v[j]+h-u;g=false;break}}}}}c.hasError=g;var q=c.__repeat>0?c.__repeat:1;return c.hcount=w*q},hasError:function(){for(var d=0;d<this.atoms.length;++d){var c=this.atoms[d];if(c.hasError){return true}}return false},hasGenericAtom:function(){for(var d=0;d<this.atoms.length;++d){var c=this.atoms[d];if(c.elem=="R"&&c.bio==null||c.superatom!=null&&c.superatom.atoms.length==0){return true}}return false},findBond:function(c,d){for(var g=0;g<this.bonds.length;++g){var f=this.bonds[g];if(f.a1==c&&f.a2==d||f.a1==d&&f.a2==c){return f}}return null},moveCenter:function(f,d){if(this.isEmpty()){return}var c=this.center();this.offset(f>0?(f/2-c.x):0,d>0?(d/2-c.y):0)},cleanupRxn:function(d){var f=this.parseRxn(true);if(f==null||f.reactants.length==1&&f.products.length==0&&f.arrow==null){return false}var c=this.medBondLength();if(!(c>0)){c=d>0?d:JSDraw2.Editor.BONDLENGTH}return this._layoutRxn(f,c)},_layoutRxn:function(z,g){var q=[];for(var l=0;l<this.graphics.length;++l){if(this.graphics[l].T=="PLUS"){q.push(this.graphics[l])}}var D=null;var E=null;for(var l=0;l<z.reactants.length;++l){var u=z.reactants[l].rect();if(u.width==0){u.inflate(g,0)}if(u.height==0){u.inflate(0,g)}if(D==null){D=u.right();E=u.center().y}else{D+=g;if(q.length>0){var n=q.pop();n.p=new JSDraw2.Point(D,E)}else{var n=new JSDraw2.Plus(new JSDraw2.Point(D,E));this._addGraphics(n)}D+=g;z.reactants[l].offset(D-u.left,E-u.center().y);D+=u.width}}var f=z.arrow;if(f!=null){var c=f.p2.angleTo(f.p1);f.p2.rotateAround(f.p1,-c);var u=f.rect();if(D==null){D=u.right();E=u.center().y}else{D+=g;f.offset(D-u.left,E-u.center().y);D+=u.width}var C=0;if(z.above!=null){for(var l=0;l<z.above.length;++l){var B=z.above[l]._rect.width;if(B>C){C=B}}}if(z.below!=null){for(var l=0;l<z.below.length;++l){var B=z.below[l]._rect.width;if(B>C){C=B}}}if(C>0&&C+g>u.width){var j=C+g-u.width;f.p2.offset(j,0);D+=j}var j=g/10;var h=f.rect().center();if(z.above!=null){var F=h.y-j*2;for(var l=z.above.length-1;l>=0;--l){var A=z.above[l];A.offset(h.x-A._rect.center().x,F-A._rect.bottom());F=A._rect.top-j}}if(z.below!=null){var G=h.y+j*2;for(var l=0;l<z.below.length;++l){var A=z.below[l];A.offset(h.x-A._rect.center().x,G-A._rect.top);G=A._rect.bottom()+j}}}for(var l=0;l<z.products.length;++l){var u=z.products[l].rect();if(u.width==0){u.inflate(g,0)}if(u.height==0){u.inflate(0,g)}if(D==null){D=u.right();E=u.center().y}else{if(l>0){D+=g;if(q.length>0){var n=q.pop();n.p=new JSDraw2.Point(D,E)}else{var n=new JSDraw2.Plus(new JSDraw2.Point(D,E));this._addGraphics(n)}}D+=g;z.products[l].offset(D-u.left,E-u.center().y);D+=u.width}}for(var l=0;l<q.length;++l){this.delObject(q[l])}return true},center:function(){return this.rect().center()},getGroupRect:function(f,d){var n=null;for(var j=0;j<this.atoms.length;++j){var c=this.atoms[j];if(c.group!=f||c.hidden){continue}var l=c.p;if(n==null){n=new JSDraw2.Rect(l.x,l.y,0,0)}else{n.unionPoint(l)}}for(var j=0;j<this.graphics.length;++j){var h=this.graphics[j];if(h.group!=f){continue}var q=JSDraw2.Group.cast(h)!=null?this.getGroupRect(h,d):h.rect();if(n==null){n=q.clone()}else{n.union(q)}}if(n!=null&&f.gap>0){n.inflate(f.gap*d/15,f.gap*d/15)}return n},getSelectedRect:function(){var f=null;for(var c=0;c<this.atoms.length;++c){if(!this.atoms[c].selected){continue}var d=this.atoms[c].p;if(f==null){f=new JSDraw2.Rect(d.x,d.y,0,0)}else{f.unionPoint(d)}}return f},rect:function(q){if(this.atoms.length==0){if(this.graphics.length==0){return null}var n=this.graphics[0].rect();for(var f=1;f<this.graphics.length;++f){n.union(this.graphics[f].rect())}return n}var t=null;var w=null;var u=null;var x=null;for(var f=0;f<this.atoms.length;++f){var c=this.atoms[f];if(c.hidden){continue}var l=c.p;if(t==null){t=u=l.x;w=x=l.y;continue}if(l.x<t){t=l.x}else{if(l.x>u){u=l.x}}if(l.y<w){w=l.y}else{if(l.y>x){x=l.y}}}var n=new JSDraw2.Rect(t,w,u-t,x-w);for(var f=0;f<this.graphics.length;++f){var d=this.graphics[f];if(JSDraw2.Group.cast(d)!=null){continue}n.union(d.rect())}if(!q){for(var f=0;f<this.atoms.length;++f){var c=this.atoms[f];if(c.rgroup==null){continue}n.union(c.rgroup.rect());for(var h=0;h<c.rgroup.mols.length;++h){n.union(c.rgroup.mols[h].rect())}}}return n},offset:function(f,h,u){for(var n=0;n<this.atoms.length;++n){var c=this.atoms[n];if(u!=true||c.selected){c.p.offset(f,h)}if(c.rgroup!=null){if(u!=true||c.rgroup.selected){c.rgroup.offset(f,h)}for(var q=0;q<c.rgroup.mols.length;++q){c.rgroup.mols[q].offset(f,h,u)}}}for(var n=0;n<this.graphics.length;++n){var l=this.graphics[n];if(u!=true||l.selected){this.graphics[n].offset(f,h)}else{if(u&&!l.selected){var w=JSDraw2.Text.cast(l);if(w!=null&&w.anchors.length>0){var d=true;for(var q=0;q<w.anchors.length;++q){if(!w.anchors[q].selected){d=false;break}}if(d){w.selected=true;w.offset(f,h)}}}}}},rotate:function(f,c){for(var d=0;d<this.atoms.length;++d){this.atoms[d].p.rotateAround(f,c)}},delObject:function(f){if(f==null){return}var c=JSDraw2.Atom.cast(f);if(c!=null){return this.delAtom(c)}var d=JSDraw2.Bond.cast(f);if(d!=null){return this.delBond(d)}return this.delGraphics(f)},delGraphics:function(f){var c=JSDraw2.Group.cast(f);if(c!=null){for(var d=0;d<this.atoms.length;++d){if(this.atoms[d].group==c){this.atoms[d].group=null}}for(var d=0;d<this.graphics.length;++d){if(this.graphics[d].group==c){this.graphics[d].group=null}}}for(var d=0;d<this.graphics.length;++d){if(this.graphics[d]==f){this.graphics.splice(d,1);this.objectRemoved(f);return true}}return false},delAtom:function(c,h){var f=[];f.push(c);if(h!=false){for(var j=this.bonds.length-1;j>=0;--j){var g=this.bonds[j];if(g.a1==c||g.a2==c){this.bonds.splice(j,1);this.objectRemoved(g);f.push(g.otherAtom(c));if(c.atommapid!=null){this.clearAtomMap(c.atommapid)}}}}var l=0;for(var j=0;j<f.length;++j){var d=f[j];if(c==d||!d.bio){if(this.delLoneAtom(f[j])){++l}}}return l>0},delBond:function(c,d){for(var f=0;f<this.bonds.length;++f){if(this.bonds[f]==c){this.bonds.splice(f,1);if(d!=false){if(!c.a1.bio){this.delLoneAtom(c.a1)}if(!c.a2.bio){this.delLoneAtom(c.a2)}}this.objectRemoved(c);return true}}return false},delLoneAtom:function(c){if(!this.isLoneAtom(c)){this.setHCount(c);return false}for(var d=0;d<this.atoms.length;++d){if(this.atoms[d]==c){this.atoms.splice(d,1);if(c.atommapid!=null){this.clearAtomMap(c.atommapid)}this.objectRemoved(c);return true}}return false},objectRemoved:function(f){for(var d=0;d<this.graphics.length;++d){var c=this.graphics[d];if(c.removeObject!=null){c.removeObject(f)}}},hasSelected:function(){for(var d=0;d<this.atoms.length;++d){var c=this.atoms[d];if(this.atoms[d].selected){return true}if(c.rgroup!=null){if(c.rgroup.selected){return true}else{for(var f=0;f<c.rgroup.mols.length;++f){if(c.rgroup.mols[f].hasSelected()){return true}}}}}for(var d=0;d<this.bonds.length;++d){if(this.bonds[d].selected){return true}}for(var d=0;d<this.graphics.length;++d){if(this.graphics[d].selected){return true}}return false},delSelected:function(){var q=0;var d=scil.clone(this.atoms);for(var h=0;h<d.length;++h){var c=d[h];if(c.selected){this.delAtom(d[h]);++q}if(c.rgroup!=null){if(c.rgroup.selected){c.rgroup=null;++q}else{for(var l=0;l<c.rgroup.mols.length;++l){q+=c.rgroup.mols[l].delSelected()}}}}var f=scil.clone(this.bonds);for(var h=0;h<f.length;++h){if(f[h].selected){this.delBond(f[h]);++q}}var g=scil.clone(this.graphics);for(var h=0;h<g.length;++h){if(g[h].selected){this.delObject(g[h]);++q}}return q},setBondLength:function(c){var f=c/this.medBondLength();if(isNaN(f)){return false}this.scale(f)},getSketchType:function(){for(var c=0;c<this.atoms.length;++c){if(this.atoms[c].bio!=null){return"biologics"}}return this.isRxn()?"reaction":"molecule"},mergeMol:function(h,c,f){for(var g=0;g<h.atoms.length;++g){this.addAtom(h.atoms[g]);if(f!=null){h.atoms[g].group=f}}for(var g=0;g<h.bonds.length;++g){var d=h.bonds[g];if(this.findBond(d.a1,d.a2)==null){this.addBond(d,false)}}for(var g=0;g<h.graphics.length;++g){this.addGraphics(h.graphics[g])}this._setParent(this)},replaceAtom:function(g,f){for(var d=0;d<this.atoms.length;++d){if(this.atoms[d]==g){this.atoms[d]=f;break}}for(var d=0;d<this.bonds.length;++d){var c=this.bonds[d];if(c.a1==g){c.a1=f}if(c.a2==g){c.a2=f}}this.setHCount(f)},replaceBond:function(f,d){for(var c=0;c<this.bonds.length;++c){if(this.bonds[c]==f){this.bonds[c]=d;break}}this.replaceAtom(f.a1,d.a1);this.replaceAtom(f.a2,d.a2)},addGraphics:function(c){if(this.hasGraphics(c)){return null}this._addGraphics(c);return c},addAtom:function(c){if(this.hasAtom(c)){return null}this._addAtom(c);return c},addBond:function(d,f,c){if(this.hasBond(d)){return null}if(d.a1.mol!=d.a2.mol){if(c){this._addBond2RGroupMol(d)}else{scil.Utils.alert("Cannot create this bond");return null}}this._addBond(d);if(f!=false&&d.type!=JSDraw2.BONDTYPES.DUMMY){d.a1.charge=d.a2.charge=0}if(d.a1.alias=="Me"){d.a1.alias=null}if(d.a2.alias=="Me"){d.a2.alias=null}this.setHCount(d.a1);this.setHCount(d.a2);return d},_addBond2RGroupMol:function(c){var d=c.a1._parent||c.a2._parent;if(d==null||c.a1._parent==c._parent&&c.a2._parent==c.a1._parent){return}if(c.a1._parent==null){d.addAtom(c.a1);c.a1._parent=d}if(c.a2._parent==null){d.addAtom(c.a2);c.a2._parent=d}d.addBond(c);c._parent=d},setAtomAlias:function(c,d,j){if(d==null||d==""){return this.setAtomType(c,d)}if(c.alias==d){return false}var h="*";var n=JSDraw2.SuperAtoms.get(d);if(n==null){var f=d.replace(/^[\+|\-]/,"").replace(/[\+|\-]$/,"");if(JSDraw2.PT[f]!=null||(/^R[0-9]+$/).test(d)){return this.setAtomType(c,d)}var t=JSDraw2.SuperAtoms.guessOne(d);if(t!=null){d=t;n=JSDraw2.SuperAtoms.get(d)}else{var l=this.getNeighborBonds(c);var q=l==null||l.length==0||l.length==1&&l[0].type==JSDraw2.BONDTYPES.DUMMY;n=JSDraw2.FormulaParser.parse(d,q,l.length);if(n!=null&&n.atoms.length==0){return this.setAtomType(c,n.atoms[0].elem)}if(q){var u=JSDraw2.FormulaParser.parseSalt(d);if(u!=null){h="#"}}}}c.isotope=null;c.query=null;c.hcount=null;c.radical=null;c.charge=0;c.alias=d;if(n!=null){var g=JSDraw2.SuperAtoms._getFirstAttachAtom(n);if(g!=null){JSDraw2.SuperAtoms._alignMol(c._parent,c,n,g,j!=null?j:this.medBondLength(1.56))}c.superatom=n;c.rgroup=null;c.elem=h}else{if(!scil.Utils.isNullOrEmpty(d)){c.elem=h}if(c.elem=="R"){c.updateRGroup()}else{c.rgroup==null}c.superatom=null}this.setHCount(c);return true},setAttachPoint:function(c,d){if(d>0&&!(c.attachpoints.length==1&&c.attachpoints[0]==d)){c.attachpoints=[d];c._parent.setHCount(c);return true}return false},setAtomType:function(c,l,w){if(l=="antibody"||l=="protein"||l=="gene"||l=="dna"||l=="rna"){if(c.biotype()==JSDraw2.BIO.ANTIBODY||c.biotype()==JSDraw2.BIO.PROTEIN||c.biotype()==JSDraw2.BIO.GENE||c.biotype()==JSDraw2.BIO.DNA||c.biotype()==JSDraw2.BIO.RNA){return false}switch(l){case"antibody":c.bio={type:JSDraw2.BIO.ANTIBODY};break;case"protein":c.bio={type:JSDraw2.BIO.PROTEIN};break;case"gene":c.bio={type:JSDraw2.BIO.GENE};break;case"dna":c.bio={type:JSDraw2.BIO.DNA};break;case"rna":c.bio={type:JSDraw2.BIO.RNA};break}c.elem="X";c.isotope=null;c.query=null;c.hcount=null;c.radical=null;c.charge=0;return true}var g=null;if(l.length>1&&/[\+|\-][0-9]?$/.test(l)){var u=l.replace(/[\+|\-][0-9]?$/,"");var h=l.substr(u.length);l=u;if(h=="+"){g=1}else{if(h=="-"){g=-1}else{g=parseInt(h)}}}if(c.elem==l&&(l=="H"&&c.isotope==null)||c.bio){return false}var d=null;var j=l=="D"||l=="T"?"H":l;if((/^R[0-9]+$/).test(l)){j="R";d=l}if(JSDraw2.PT[j]==null){return false}var t=c.elem;c.elem=j;if(j!="R"){c.rgroup=null}c.alias=d;c.superatom=null;if(l=="D"){c.isotope=2}else{if(l=="T"){c.isotope=3}else{c.isotope=null}}c.query=null;if(g>0||g<0){c.charge=g}else{if(w){c.charge=0}}if(t=="@"){c.alias=null;c.bio=null;var q=this.getAllBonds(c);for(var n=0;n<q.length;++n){var f=q[n];if(f.type==JSDraw2.BONDTYPES.DUMMY){scil.Utils.removeArrayItem(this.bonds,f)}}}c._parent.setHCount(c);if(j=="R"){c.updateRGroup()}return true},setAtomCharge:function(c,d){if(d==null||isNaN(d)||c.bio){return false}d=Math.round(d);if(c.charge==d){return false}c.charge=d;c._parent.setHCount(c);return true},setBondType:function(c,d){if(c.a1.biotype()==JSDraw2.BIO.AA&&c.a2.biotype()==JSDraw2.BIO.AA){if(c.type==JSDraw2.BONDTYPES.DISULFIDE&&d==JSDraw2.BONDTYPES.PEPTIDE||c.type==JSDraw2.BONDTYPES.PEPTIDE&&d==JSDraw2.BONDTYPES.DISULFIDE){c.type=d;return true}}else{if(d<JSDraw2.BONDTYPES.UNKNOWN&&d>JSDraw2.BONDTYPES.DOUBLEORAROMATIC||c.a1.bio||c.a2.bio){return false}c.type=d;c._parent.setHCount(c.a1);c._parent.setHCount(c.a2);return true}},isLoneAtom:function(c){for(var f=0;f<this.bonds.length;++f){var d=this.bonds[f];if(d.a1==c||d.a2==c){return false}}return true},medBondLength:function(g){if(this.bonds.length==0){return g}var l=Math.floor(this.bonds.length/10);if(l==0){l=1}var j=[];for(var h=0;h<this.bonds.length;h+=l){var c=this.bonds[h];j.push(c.a1.p.distTo(c.a2.p))}if(j.length==0){return 1.5}if(j.length==1){return j[0]<=0?1.5:j[0]}j.sort();var f=j[Math.round(j.length/2)];return f<=0?1.5:f},_hasDoubleBonds:function(c){for(var f=0;f<this.bonds.length;++f){var d=this.bonds[f];if(d.type==JSDraw2.BONDTYPES.DOUBLE&&(d.a1==c||d.a2==c)){return true}}return false},getNeighborAtoms:function(c,j,f){var h=[];for(var g=0;g<this.bonds.length;++g){var d=this.bonds[g];if(f&&d.type==JSDraw2.BONDTYPES.DUMMY){continue}if(d.a1==c){if(d.a2!=j){h.push(d.a2)}}else{if(d.a2==c){if(d.a1!=j){h.push(d.a1)}}}}return h},getNeighborBonds:function(c,f){var h=[];for(var g=0;g<this.bonds.length;++g){var d=this.bonds[g];if((d.a1==c||d.a2==c)&&(!f||d.type!=JSDraw2.BONDTYPES.DUMMY&&d.type!=JSDraw2.BONDTYPES.UNKNOWN)){h.push(d)}}return h},removeHydrogens:function(){var f=[];for(var g=0;g<this.atoms.length;++g){var c=this.atoms[g];if(c.elem=="H"&&c.isotope==null){f.push(g)}}for(var h=f.length-1;h>=0;--h){var c=this.atoms[f[h]];for(var g=this.bonds.length-1;g>=0;--g){var d=this.bonds[g];if(d.a1==c||d.a2==c){this.bonds.splice(g,1)}}this.atoms.splice(f[h],1)}return f.length},draw:function(C,x,l,D,h,n,A,B){if(x==null){x=2}if(l==null){l=14}if(D){for(var q=0;q<this.graphics.length;++q){if(this.graphics[q].T=="TEXT"){this.graphics[q].draw(C,x,this,l)}}}else{for(var q=0;q<this.atoms.length;++q){var c=this.atoms[q];c._outside=c.p.x<-JSDraw2.speedup.gap||c.p.x>h.x+JSDraw2.speedup.gap||c.p.y<-JSDraw2.speedup.gap||c.p.y>h.y+JSDraw2.speedup.gap;c._haslabel=c.hasLabel(this,A)}var g=[];for(var q=0;q<this.bonds.length;++q){var f=this.bonds[q];if(f.a1._outside&&f.a2._outside&&!f.a1.hidden&&!f.a2.hidden){continue}if(!B||!f.selected){if(this.moveHiddenAtomToGroupBorder(f.a1,f.a2)||this.moveHiddenAtomToGroupBorder(f.a2,f.a1)){f.draw(C,x,this,l,B)}else{g.push(f)}}}for(var q=0;q<this.graphics.length;++q){this.graphics[q].draw(C,x,this,l)}for(var q=0;q<g.length;++q){g[q].draw(C,x,this,l,B)}var E=x*2;if(B){for(var q=0;q<this.atoms.length;++q){var c=this.atoms[q];if(c._outside||!c.hasErr()){continue}var F=8;var y=new JSDraw2.Rect(c.p.x-F/2,c.p.y-F/2,F,F);JSDraw2.Drawer.drawRect(C,y,"red",x).setFill("red")}}else{for(var q=0;q<this.atoms.length;++q){var c=this.atoms[q];if(c._outside){continue}for(var u=q+1;u<this.atoms.length;++u){var d=this.atoms[u];if(Math.abs(c.p.x-d.p.x)<E&&Math.abs(c.p.y-d.p.y)<E){var y=new JSDraw2.Rect(c.p.x-l/2,c.p.y-l/2,l,l);JSDraw2.Drawer.drawRect(C,y,"red",x);break}}c.draw(C,x,this,l,n);if(c.rgroup!=null){if(c.rgroup.text!=null){c.rgroup.draw(C,x,this,l)}for(var t=0;t<c.rgroup.mols.length;++t){c.rgroup.mols[t].draw(C,x,l,D,h,n)}}}}this.drawSelect(new JSDraw2.Lasso(C,x*(B?5:1),false),B,l);var z=null;if(this.chiral=="and"){z="[AND Enantiomer]"}else{if(this.chiral=="or"){z="[OR Enantiomer]"}else{if(this.chiral==true){z="Chiral"}else{if(this.chiral=="rac"){z="Racemic"}else{if(this.chiral=="ena"){z="Single Enantiomer"}else{if(this.chiral=="unk"){z="Unknown Chiral"}}}}}}if(z!=null){JSDraw2.Drawer.drawText(C,new JSDraw2.Point(h.x-l*4,l*1),z,"gray",l,"right")}}},moveHiddenAtomToGroupBorder:function(c,d){if(!c.hidden){return false}var f=this._findGroup(c);if(f==null){return false}var l=f.rect();if(!d.hidden){var j=d.p;if(j.x<l.left){c.p.x=l.left}else{if(j.x>l.right()){c.p.x=l.right()}else{c.p.x=j.x}}if(j.y<l.top){c.p.y=l.top}else{if(j.y>l.bottom()){c.p.y=l.bottom()}else{c.p.y=j.y}}c._outside=false}else{var h=this._findGroup(d);if(h==null){return false}var n=h.rect();if(l.left>=n.left&&l.left<=n.right()||l.right()>=n.left&&l.right()<=n.right()||n.left>=l.left&&n.left<=l.right()||n.right()>=l.left&&n.right()<=l.right()){var q=(Math.max(l.left,n.left)+Math.min(l.right(),n.right()))/2;c.p.x=d.p.x=q;c.p.y=l.bottom()<n.top?l.bottom():l.top;d.p.y=n.top>l.bottom()?n.top:n.bottom()}else{if(l.top>=n.top&&l.top<=n.bottom()||l.bottom()>=n.top&&l.bottom()<=n.bottom()||n.top>=l.top&&n.top<=l.bottom()||n.bottom()>=l.top&&n.bottom()<=l.bottom()){var t=(Math.max(l.top,n.top)+Math.min(l.bottom(),n.bottom()))/2;c.p.y=d.p.y=t;c.p.x=l.right()<n.left?l.right():l.left;d.p.x=n.left>l.right()?n.left:n.right()}else{if(l.right()<n.left){if(l.bottom()<n.top){c.p=l.bottomright();d.p=n.topleft()}else{c.p=l.topright();d.p=n.bottomleft()}}else{if(l.bottom()<n.top){c.p=l.bottomleft();d.p=n.topright()}else{c.p=l.topleft();d.p=n.bottomright()}}}}c._outside=false;d._outside=false}return true},_findGroup:function(c){for(var f=0;f<this.graphics.length;++f){var d=JSDraw2.Group.cast(this.graphics[f]);if(d!=null&&d.a==c){return d}}return null},drawSelect:function(l,n,f){for(var g=0;g<this.graphics.length;++g){if(this.graphics[g].selected){this.graphics[g].drawSelect(l)}}for(var g=0;g<this.atoms.length;++g){this.atoms[g].__drawselect=false}for(var g=0;g<this.bonds.length;++g){var d=this.bonds[g];if(d.selected){d.drawSelect(l,f);if(n){d.a1.__drawselect=true;d.a2.__drawselect=true}}}for(var g=0;g<this.atoms.length;++g){var c=this.atoms[g];if(c.selected&&!c.__drawselect){c.drawSelect(l)}if(c.rgroup!=null){for(var h=0;h<c.rgroup.mols.length;++h){c.rgroup.mols[h].drawSelect(l,n)}}}},setZOrder:function(c,f){var d=scil.Utils.indexOf(this.graphics,c);if(d<0||this.graphics.length==1){return false}if(f==0){if(f!=d){this.graphics.splice(d,1);this.graphics.splice(0,0,c)}}else{if(f==-1){if(d!=this.graphics.length-1){this.graphics.splice(d,1);this.graphics.push(c)}}}return true},calcHDir:function(c,y,g){var d=this.getNeighborAtoms(c);if(d.length==0&&c.charge==0){return g?JSDraw2.ALIGN.RIGHT:JSDraw2.ALIGN.LEFT}var w=false,f=false,q=false,x=false;for(var n=0;n<d.length;++n){var u=d[n];var h=u.p.x-c.p.x;var j=u.p.y-c.p.y;if(h>y){w=true}else{if(h<-y){q=true}}if(j>y){f=true}else{if(j<-y){x=true}}}if(!w){return JSDraw2.ALIGN.RIGHT}else{if(!q){return JSDraw2.ALIGN.LEFT}else{if(!f){return JSDraw2.ALIGN.BOTTOM}else{if(!x){return JSDraw2.ALIGN.TOP}}}}return JSDraw2.ALIGN.RIGHT},setMolfile:function(d,f){var c=this.setMolfile2(d,f);if(c!=null){this.guessSuperAtoms()}return c},guessSuperAtoms:function(){return 0},setMolfile2:function(f,g){if(f!=null&&f.length>4){if(f.substr(0,4)=="$RXN"){return this.setRxnfile(f)}if(f.substr(0,4)=="$MDL"){return this.setRgfile(f)}}this.clear();if(f==null||f.length==0){return null}var d=null;if(f.indexOf("\n")>=0){d=f.replace(/[\r]/g,"").split("\n")}else{d=f.split("|")}for(var c=0;c<=Math.min(3,d.length-1);++c){if(d[c].toUpperCase().indexOf(" V2000")>0){this.setMolV2000(d,c,g);if(c==3){this.name=scil.Utils.trim(d[0])}return this}else{if(d[c].toUpperCase().indexOf(" V3000")>0){this.setMolV3000(d,c+1,g);if(c+1==3){this.name=scil.Utils.trim(d[0])}return this}}}return null},setMolV2000:function(L,ah,aa,W){var O=parseFloat(L[ah].substr(0,3));var P=parseFloat(L[ah].substr(3,3));var B=L[ah].substr(12,3);if(!JSDraw2.defaultoptions.and_enantiomer){this.chiral=B=="  1"}if(isNaN(O)||isNaN(P)){return null}++ah;for(var I=ah;I<O+ah;I++){var ab=L[I];var ao=parseFloat(ab.substr(0,10));var ap=-parseFloat(ab.substr(10,10));var E=scil.Utils.trim(ab.substr(31,3));var A=ab.length>=39?parseInt(ab.substr(36,3)):0;var q=aa&&ab.length>=63?parseInt(ab.substr(60,3)):0;var H=ab.length>=45?parseInt(ab.substr(42,3)):0;var an=ab.length>=51?parseInt(ab.substr(48,3)):0;if(isNaN(ao)||isNaN(ap)||isNaN(A)){return null}var l=null;if((/^R[0-9]+$/).test(E)){l=E;E="R"}var d=new JSDraw2.Atom(new JSDraw2.Point(ao,ap),E=="R#"?"R":E);d.alias=l;if(q>0){d.atommapid=q}if(H>0&&H<=5){d.hs=H}if(an>0&&an<=15){d.val=an}this._addAtom(d);switch(A){case 1:d.charge=3;break;case 2:d.charge=2;break;case 3:d.charge=1;break;case 5:d.charge=-1;break;case 6:d.charge=-2;break;case 7:d.charge=-3;break}}ah+=O;for(I=ah;I<(P+ah);I++){var K=L[I];var ab=parseFloat(K.substr(0,3))-1;var E=parseFloat(K.substr(3,3))-1;var R=parseInt(K.substr(6,3));var ai=parseInt(K.substr(9,3));var Y=K.length>=18?parseInt(K.substr(15,3)):null;var X=K.length>=21?K.substr(18,3):null;if(isNaN(ab)||isNaN(E)||isNaN(R)){return null}var g=this.atoms[ab];var h=this.atoms[E];var t;switch(R){case 0:t=JSDraw2.BONDTYPES.UNKNOWN;break;case 1:switch(ai){case 1:t=JSDraw2.BONDTYPES.WEDGE;break;case 4:t=JSDraw2.BONDTYPES.WIGGLY;break;case 6:t=JSDraw2.BONDTYPES.HASH;break;default:t=JSDraw2.BONDTYPES.SINGLE;break}break;case 2:t=ai==3?JSDraw2.BONDTYPES.EITHER:JSDraw2.BONDTYPES.DOUBLE;break;case 3:t=JSDraw2.BONDTYPES.TRIPLE;break;case 4:t=JSDraw2.BONDTYPES.DELOCALIZED;break;case 5:t=JSDraw2.BONDTYPES.SINGLEORDOUBLE;break;case 6:t=JSDraw2.BONDTYPES.SINGLEORAROMATIC;break;case 7:t=JSDraw2.BONDTYPES.DOUBLEORAROMATIC;break;case 8:t=JSDraw2.BONDTYPES.UNKNOWN;break;case 9:t=JSDraw2.BONDTYPES.DUMMY;break}var w=new JSDraw2.Bond(g,h,t);if(Y==1){w.ring=true}else{if(Y==2){w.ring=false}}if(aa){this.readRxnCenter(w,X)}this._addBond(w)}var ae=[];ah+=P;for(var I=ah;I<L.length;++I){var ab=scil.Utils.rtrim(L[I]);var aj=ab.length>=6?ab.substr(0,6):null;var ak=ab.length>=6?ab.substr(0,3):null;if(aj=="M  ISO"){var N=parseInt(ab.substr(6,3));for(var J=0;J<N;++J){var j=parseInt(ab.substr(10+J*8,3));var am=parseInt(ab.substr(14+J*8,3));if(isNaN(j)||isNaN(am)){return null}this.atoms[j-1].isotope=am}}else{if(aj=="M  RAD"){var N=parseInt(ab.substr(6,3));for(var J=0;J<N;++J){var j=parseInt(ab.substr(10+J*8,3));var am=parseInt(ab.substr(14+J*8,3));if(isNaN(j)||isNaN(am)){return null}if(am>=1&&am<=3){this.atoms[j-1].radical=am}}}else{if(aj=="M  CHG"){var N=parseInt(ab.substr(6,3));for(var J=0;J<N;++J){var j=parseInt(ab.substr(10+J*8,3));var am=parseInt(ab.substr(14+J*8,3));if(isNaN(j)||isNaN(am)){return null}this.atoms[j-1].charge=am}}else{if(aj=="M  ALS"){var j=parseInt(ab.substr(7,3));var N=parseInt(ab.substr(10,3));var G=ab.substr(14,1)=="F";var M=[];for(var J=0;J<N;++J){var F=scil.Utils.trim(ab.substr(16+J*4,4));if(JSDraw2.PT.isValidAtomList(F)){M.push(F)}}var d=this.atoms[j-1];if(d.query==null){d.query={}}d.query.t=G;d.query.als=M}else{if(aj=="M  SUB"){var N=parseInt(ab.substr(6,3));for(var J=0;J<N;++J){var j=ab.substr(9+8*J+1,3);var am=parseInt(ab.substr(9+8*J+5,3));var d=this.atoms[j-1];if(d.query==null){d.query={}}if(am==-1){d.query.sub=0}else{if(am==-2){d.query.sub="*"}else{d.query.v=am}}}}else{if(aj=="M  UNS"){var N=parseInt(ab.substr(6,3));for(var J=0;J<N;++J){var j=ab.substr(9+8*J+1,3);var am=parseInt(ab.substr(9+8*J+5,3));var d=this.atoms[j-1];if(d.query==null){d.query={}}d.query.uns=am==1}}else{if(aj=="M  RBC"){var N=parseInt(ab.substr(6,3));for(var J=0;J<N;++J){var j=ab.substr(9+8*J+1,3);var am=parseInt(ab.substr(9+8*J+5,3));var d=this.atoms[j-1];if(am==-1||am>0){if(d.query==null){d.query={}}d.query.rbc=am==-1?0:am}}}else{if(aj=="M  RGP"){var N=parseInt(ab.substr(6,3));for(var J=0;J<N;++J){var j=parseInt(ab.substr(10+J*8,3));var Z=parseInt(ab.substr(14+J*8,3));if(isNaN(j)||isNaN(Z)){return null}if(this.atoms[j-1].elem=="R"){var d=this.atoms[j-1];if(d.alias==null||d.alias==""){d.alias="R"+Z}if(W!=null){W[Z]=d}}}}else{if(aj=="M  APO"){var N=parseInt(ab.substr(6,3));for(var J=0;J<N;++J){var j=parseInt(ab.substr(10+J*8,3));var Z=parseInt(ab.substr(14+J*8,3));if(!isNaN(j)&&!isNaN(Z)&&this.atoms[j-1]!=null){this.atoms[j-1].attachpoints.push(Z)}}}else{if(aj=="M  STY"){var N=parseInt(ab.substr(6,3));for(var J=0;J<N;++J){var af=parseInt(ab.substr(10+J*8,3));var ag=ab.substr(14+J*8,3);var z=null;if(ag=="DAT"){z=new JSDraw2.Text()}else{if(ag=="SUP"){z={type:"SUPERATOM",atoms:[]}}else{for(var al in JSDraw2.SGroup.stys){if(JSDraw2.SGroup.stys[al]==ag){z=new JSDraw2.Bracket(al==""?null:al,null);break}}if(z==null){z=new JSDraw2.Bracket(null,null)}}}if(z!=null){ae[af]=z}}}else{if(aj=="M  SMT"){var af=parseInt(ab.substr(7,3));var ac=ab.substr(11);if(ac.length>0&&ac.substr(0,1)=="^"){ac=ac.substr(1)}ae[af].subscript=ac}else{if(aj=="M  SCL"){var af=parseInt(ab.substr(7,3));ae[af].cls=ab.substr(11)}else{if(aj=="M  SPL"){var N=parseInt(ab.substr(6,3));for(var J=0;J<N;++J){var C=parseInt(ab.substr(10+J*8,3));var V=parseInt(ab.substr(14+J*8,3));if(JSDraw2.Text.cast(ae[C])!=null&&JSDraw2.Bracket.cast(ae[V])!=null){ae[C].anchors=[ae[V]]}}}else{if(aj=="M  SCN"){var N=parseInt(ab.substr(6,3));for(var J=0;J<N;++J){var af=parseInt(ab.substr(10+J*8,3));var D=ab.substr(14+J*8,2);if(JSDraw2.Bracket.cast(ae[af])!=null){ae[af].conn=D}}}else{if(aj=="M  SNC"){var N=parseInt(ab.substr(6,3));for(var J=0;J<N;++J){var af=parseInt(ab.substr(10+J*8,3));var Q=scil.Utils.trim(ab.substr(14+J*8,2));if(JSDraw2.Bracket.cast(ae[af])!=null){if(ae[af].type=="c"){ae[af].type="c"+Q}else{if(ae[af].type=="mul"){ae[af].type=Q+""}}}}}else{if(aj=="M  SAL"){var af=parseInt(ab.substr(7,3));var ad=ae[af];if(ad!=null){var N=parseInt(ab.substr(10,3));for(var J=0;J<N;++J){var j=parseInt(ab.substr(14+J*4,3));var d=this.atoms[j-1];if(d!=null){if(ad.type=="SUPERATOM"){ad.atoms.push(d)}else{if(JSDraw2.Bracket.cast(ad)!=null){ad.atoms.push(d)}else{if(JSDraw2.Text.cast(ad)!=null){ad.anchors.push(d)}}}}}}}else{if(aj=="M  SPA"){var af=parseInt(ab.substr(7,3));var ad=ae[af];if(JSDraw2.Bracket.cast(ad)!=null&&ad.type=="mul"){var N=parseInt(ab.substr(10,3));for(var J=0;J<N;++J){var j=parseInt(ab.substr(14+J*4,3));var d=this.atoms[j-1];if(d!=null){if(ad.spa==null){ad.spa=[]}ad.spa.push(d)}}}}else{if(aj=="M  SBL"){var af=parseInt(ab.substr(7,3));var ad=ae[af];var N=parseInt(ab.substr(10,3));for(var J=0;J<N;++J){var u=parseInt(ab.substr(14+J*4,3));var t=this.bonds[u-1];if(t!=null&&JSDraw2.Text.cast(ad)!=null){ad.anchors.push(t)}}}else{if(aj=="M  SDI"){var af=parseInt(ab.substr(7,3));var ad=ae[af];var N=parseInt(ab.substr(10,3));if(ad!=null&&N==4){var T=new JSDraw2.Point(parseFloat(ab.substr(13,10)),-parseFloat(ab.substr(23,10)));var U=new JSDraw2.Point(parseFloat(ab.substr(33,10)),-parseFloat(ab.substr(43,10)));if(T.isValid()&&U.isValid()){if(ad._rect==null){ad._rect=new JSDraw2.Rect().set(T,U)}else{ad._rect.unionPoint(T).unionPoint(U)}}}}else{if(aj=="M  SDT"){var af=parseInt(ab.substr(7,3));var ad=ae[af];if(JSDraw2.Text.cast(ad)!=null){ad.fieldtype=scil.Utils.trim(ab.substr(11,30))}}else{if(aj=="M  SDD"){var af=parseInt(ab.substr(7,3));var ad=ae[af];if(JSDraw2.Text.cast(ad)!=null){var S=new JSDraw2.Point(parseFloat(ab.substr(11,10)),-parseFloat(ab.substr(21,10)));if(S.isValid()){ad._rect=new JSDraw2.Rect(S.x,S.y,0,0)}}}else{if(aj=="M  SED"){var af=parseInt(ab.substr(7,3));var ad=ae[af];if(JSDraw2.Text.cast(ad)!=null){ad.text=scil.Utils.trim(ab.substr(11))}}else{if(ak=="A  "){var j=parseInt(ab.substr(3,3));++I;this.atoms[j-1].alias=scil.Utils.trim(L[I])}else{if(ak=="V  "){var j=parseInt(ab.substr(3,3));var am=scil.Utils.trim(ab.substr(7));this.atoms[j-1].tag=am}else{if(aj=="M  END"){break}}}}}}}}}}}}}}}}}}}}}}}}}}this.readSgroups(ae,B);return this},readSgroups:function(F,n){var G=[];var l=[];var w=this.medBondLength(1.56)/2;var D=this.getParentBrackets(F);for(var x=0;x<F.length;++x){var E=F[x];if(E==null){continue}var h=JSDraw2.Bracket.cast(E);if(E._rect!=null&&(h!=null||E.text!=null&&E.text!="")){this.addGraphics(E);if(h!=null){if(h.getType()!=""){this.setSgroup(h,"BRACKET_TYPE",h.subscript||h.getType(),h._rect.right()+w/4,h._rect.bottom()-w)}else{l.push(h)}if(h.conn!=null&&h.conn!=""){this.setSgroup(h,"BRACKET_CONN",h.conn.toLowerCase(),h._rect.right()+w/4,h._rect.top-w/4)}JSDraw2.SuperAtoms.collapseRepeat(this,h)}else{if(scil.Utils.endswith(E.fieldtype,"_TYPE")&&E.fieldtype!="BRACKET_TYPE"){E.fieldtype="BRACKET_SUBTYPE"}else{if(scil.Utils.endswith(E.fieldtype,"_MOD")){E.fieldtype="BRACKET_MOD"}}}}else{if(E.type=="SUPERATOM"){var B=new JSDraw2.Atom(null,"C");var A=new JSDraw2.Mol();G.push({a:B,m:A});A.atoms=E.atoms;for(var z=0;z<A.atoms.length;++z){scil.Utils.removeArrayItem(this.atoms,A.atoms[z])}var C=null;var f=0;for(var y=this.bonds.length-1;y>=0;--y){var g=this.bonds[y];var q=scil.Utils.indexOf(A.atoms,g.a1);var u=scil.Utils.indexOf(A.atoms,g.a2);if(q>=0&&u>=0){A.bonds.splice(0,0,g);this.bonds.splice(y,1)}else{if(q>=0){if(C==null){C=g.a1.p.clone()}g.a1.attachpoints.push(++f);g.apo1=f;g.a1=B}else{if(u>=0){if(C==null){C=g.a2.p.clone()}g.a2.attachpoints.push(++f);g.apo2=f;g.a2=B}}}}B.p=C!=null?C:A.atoms[0].p.clone();B.superatom=A;B.alias=E.subscript;switch(E.cls){case"AminoAcid":case"AA":B.bio={type:JSDraw2.BIO.AA};B.elem=B.alias;B.alias=null;break;case"BASE":case"DNA":B.bio={type:JSDraw2.BIO.BASE_DNA};B.elem=B.alias;B.alias=null;break;case"RNA":B.bio={type:JSDraw2.BIO.BASE_RNA};B.elem=B.alias;B.alias=null;break}this._addAtom(B)}}}if(D!=null){for(var x=0;x<D.length;++x){this.delBracketInBracketAtoms(D[x])}}for(var x=0;x<l.length;++x){var h=l[x];var H=this.getSgroupText(h,"BRACKET_TYPE");if(H!=null){l[x].type=H.text}if(h.atoms!=null){for(var z=0;z<G.length;++z){var c=G[z].a;var A=G[z].m;if(scil.Utils.removeArrayItems(h.atoms,A.atoms)>0){h.atoms.push(c)}}}}for(var x=0;x<this.atoms.length;++x){var c=this.atoms[x];if(c.elem=="C"&&c.alias!=null&&(/^R[0-9]+$/).test(c.alias)){var d=c.alias;c.alias=null;this.setAtomAlias(c,d)}}if(JSDraw2.defaultoptions.and_enantiomer){if(this.hasStereoCenter()&&n=="  0"){this.chiral="and"}}},delBracketInBracketAtoms:function(f){if(f.children==null||f.children.length==0||f.expandedatoms==null){return}for(var h=0;h<f.children.length;++h){var g=f.children[h];if(g.expandedatoms==null){continue}for(var j=0;j<g.expandedatoms.length;++j){var d=g.expandedatoms[j];if(scil.Utils.indexOf(g.atoms,d)<0){var l=scil.Utils.indexOf(f.atoms,d);if(l>=0){f.atoms.splice(l,1)}}}}},hasRGroup:function(){for(var d=0;d<this.atoms.length;++d){var c=this.atoms[d];if(c.elem=="R"){return true}}return false},getMolfile:function(d,f,c){if(f==null){if(this.needV3000()){f=true}}if(f){return this.getMolV3000(d)}else{return this.getMolV2000(d,c)}},needV3000:function(){return this.atoms.length>999||this.bonds.length>999||this.hasEnhancedStereochemistry()},getRgfile:function(d,c,f){return null},_getRgroups:function(f){if(f==null){f={n:0,list:[]}}for(var d=0;d<this.atoms.length;++d){var c=this.atoms[d];c.iR=null;if(c.elem=="R"&&(c.alias!=null&&c.alias!=""||c.rgroup!=null)){c.iR=++f.n;if(c.rgroup!=null&&c.rgroup.mols.length>0){f.list.push(c)}}}return f},getSubMol:function(c){var l=this;var n={atoms:scil.clone(c),bonds:[],openbonds:[]};for(var h=0;h<l.bonds.length;++h){var d=l.bonds[h];var f=scil.Utils.indexOf(c,d.a1)>=0;var g=scil.Utils.indexOf(c,d.a2)>=0;if(f&&g){n.bonds.push(d)}else{if(f){n.openbonds.push({b:d,oa:d.a2})}else{if(g){n.openbonds.push({b:d,oa:d.a1})}}}}return n},_addBracketChildren:function(f,c){var d=false;for(var g=0;g<f.children.length;++g){if(scil.Utils.arrayContainsArray(f.children[g].atoms,c.atoms)){this._addBracketChildren(f.children[g],c);d=true;break}}if(!d){f.children.push(c)}},_expandBracketAtoms:function(d,l,q){for(var f=0;f<d.children.length;++f){this._expandBracketAtoms(d.children[f],l,q)}if(d.atoms!=null&&q!=null){var c=[];var n=null;for(var h=0;h<d.atoms.length;++h){for(var g=0;g<q.length;++g){if(d.atoms[h]==q[g].a){n=q[g].m;break}}if(n==null){c.push(d.atoms[h])}else{for(var g=0;g<n.atoms.length;++g){c.push(n.atoms[g])}}}d.atoms=c}JSDraw2.SuperAtoms.expandRepeat(l,d)},getParentBrackets:function(g){var l=[];for(var h=0;h<g.length;++h){var f=JSDraw2.Bracket.cast(g[h]);if(f==null){continue}f.children=[];l.push(f)}if(l.length<=1){return l}l.sort(function(q,t){if(scil.Utils.arrayContainsArray(q.atoms,t.atoms)){return -1}else{if(scil.Utils.arrayContainsArray(t.atoms,q.atoms)){return +1}}return 0});for(var h=0;h<l.length-1;++h){var c=l[h];if(c==null){continue}for(var j=h+1;j<l.length;++j){var d=l[j];if(d==null){continue}if(scil.Utils.arrayContainsArray(c.atoms,d.atoms)){this._addBracketChildren(c,d);l[j]=null}}}var n=[];for(var h=0;h<l.length;++h){if(l[h]!=null){n.push(l[h])}}return n},expandSuperAtoms:function(l){superatoms=[];var h=this.clone(null);var g=scil.clone(h.atoms);for(var f=0;f<g.length;++f){var c=g[f];c.__repeat=null;if(c.superatom!=null){var j=JSDraw2.SuperAtoms.addToMol(h,c,c.superatom);superatoms.push({a:c,m:j});if(l!=null){l.push({a:c,m:j})}}else{if(c.elem=="5'"){h.setAtomType(c,"H")}else{if(c.elem=="3'"){h.setAtomType(c,"O")}}}}var d=this.getParentBrackets(h.graphics);for(var f=0;f<d.length;++f){this._expandBracketAtoms(d[f],h,superatoms)}h.calcHCount(true);return h},getMolV2000:function(l,d){var q=[];var h=this.expandSuperAtoms(q);h.chiral=this.chiral;if(d){for(var g=h.bonds.length-1;g>=0;--g){var c=h.bonds[g];if(c.type==JSDraw2.BONDTYPES.DUMMY){h.bonds.splice(g,1)}}}var f=false;var j=h._getRgroups();if(j.list.length>0){return h.getRgfile(l,j,q)}var n=(scil.Utils.isNullOrEmpty(h.name)?"-":h.name)+"\n";n+=h._getMolHeader();n+="\n";n+=h._getMolV2000(l,null,q);return n},allAtoms:function(g){if(g==null){g=[]}for(var d=0;d<this.atoms.length;++d){var c=this.atoms[d];g.push(c);if(c.rgroup!=null){for(var f=0;f<c.rgroup.mols.length;++f){c.rgroup.mols[f].allAtoms(g)}}}return g},allBonds:function(g){if(g==null){g=[]}for(var d=0;d<this.bonds.length;++d){g.push(this.bonds[d])}for(var d=0;d<this.atoms.length;++d){var c=this.atoms[d];if(c.rgroup!=null){for(var f=0;f<c.rgroup.mols.length;++f){c.rgroup.mols[f].allBonds(g)}}}return g},_getMolTime:function(){var c=new Date();var d=c.getFullYear()+"";return scil.Utils.formatStr(c.getMonth()+1,2,0).replace(" ","0")+scil.Utils.formatStr(c.getDate(),2,0).replace(" ","0")+d.substr(2)+scil.Utils.formatStr(c.getHours(),2,0).replace(" ","0")+scil.Utils.formatStr(c.getMinutes(),2,0).replace(" ","0")},_getMolHeader:function(){var c=new Date();var d=c.getFullYear()+"";return"   JSDraw2"+this._getMolTime()+"2D\n"},_getMolV2000:function(S,R,ad){if(R!=null){this._getRgroups(R)}var J=this.bondlength>0?this.bondlength:this.medBondLength();var W=J>0?(1.56/J):1;var T="";T+=scil.Utils.formatStr(this.atoms.length,3,0);T+=scil.Utils.formatStr(this.bonds.length,3,0);T+="  0  0";var D=this.hasStereoCenter();if(D&&(this.chiral!="and"||JSDraw2.defaultoptions.simplechiral&&this.chiral=="1")){T+="  1"}else{T+="  0"}T+="  0              0 V2000\n";var G="";var P="";var af="";var N="";var Q="";var f="";var g="";var x="";this.resetIds();for(var E=0;E<this.atoms.length;++E){var d=this.atoms[E];if(d.isotope!=null){G+="M  ISO  1"+scil.Utils.formatStr(E+1,4,0)+scil.Utils.formatStr(d.isotope,4,0)+"\n"}if(d.radical>=1&&d.radical<=3){P+="M  RAD  1"+scil.Utils.formatStr(E+1,4,0)+scil.Utils.formatStr(d.radical,4,0)+"\n"}if(d.tag!=null&&d.tag!=""){af+="V  "+scil.Utils.formatStr(E+1,3,0)+" "+d.tag+"\n"}if(d.alias!=null&&d.alias!=""){g+="A  "+scil.Utils.formatStr(E+1,3,0)+"\n"+d.alias+"\n"}for(var I=0;I<d.attachpoints.length;++I){f+="M  APO  1"+scil.Utils.formatStr(E+1,4,0)+scil.Utils.formatStr(d.attachpoints[I],4,0)+"\n"}if(d.query!=null){if(d.query.als!=null&&d.query.als.length>0){N+="M  ALS "+scil.Utils.formatStr(E+1,3,0)+scil.Utils.formatStr(d.query.als.length,3,0)+(d.query.t==false?" T ":" F ");for(var I=0;I<d.query.als.length;++I){N+=scil.Utils.padright(d.query.als[I],4," ")}N+="\n"}if(d.query.rbc!=null){N+="M  RBC  1"+scil.Utils.formatStr(E+1,4,0)+scil.Utils.formatStr(d.query.rbc==0?-1:d.query.rbc,4,0)+"\n"}if(d.query.uns!=null){N+="M  UNS  1"+scil.Utils.formatStr(E+1,4,0)+scil.Utils.formatStr(d.query.uns?1:0,4,0)+"\n"}if(d.query.sub!=null){N+="M  SUB  1"+scil.Utils.formatStr(E+1,4,0)+scil.Utils.formatStr(d.query.sub==0?-1:(d.query.sub=="*"?-2:d.query.sub),4,0)+"\n"}}var A=d.elem;if(d.elem=="R"){if(d.iR>0){A="R#";Q+="M  RGP  1"+scil.Utils.formatStr(E+1,4,0)+scil.Utils.formatStr(parseInt(d.iR),4,0)+"\n"}else{A="R"}}else{if(A=="H"){if(d.isotope==2){A="D"}else{if(d.isotope==3){element="T"}}}}T+=scil.Utils.formatStr(d.p.x*W,10,4);T+=scil.Utils.formatStr(-d.p.y*W,10,4);T+=scil.Utils.formatStr(0,10,4);T+=" ";T+=scil.Utils.padright(A,2," ");T+="  0";var w=0;switch(d.charge){case 1:w=3;break;case 2:w=2;break;case 3:w=1;break;case -1:w=5;break;case -2:w=6;break;case -3:w=7;break}T+=scil.Utils.formatStr(w,3,0);if(d.charge!=0&&typeof(d.charge)=="number"){x+=scil.Utils.formatStr(d.atomid,4,0)+scil.Utils.formatStr(d.charge,4,0)}T+="  0";if(d.hs>0){T+=scil.Utils.formatStr(d.hs,3,0)}else{T+="  0"}T+="  0  0";if(d.val>0){T+=scil.Utils.formatStr(d.val,3,0)}else{T+="  0"}T+="  0  0";if(S&&d.atommapid>0){T+=scil.Utils.formatStr(d.atommapid,3,0)}else{T+="  0"}T+="  0  0\n"}for(var E=0;E<this.bonds.length;++E){var h=this.bonds[E];T+=scil.Utils.formatStr(h.a1.id,3,0);T+=scil.Utils.formatStr(h.a2.id,3,0);var M=0;var aa=0;switch(h.type){case JSDraw2.BONDTYPES.UNKNOWN:M=8;break;case JSDraw2.BONDTYPES.DUMMY:M=9;break;case JSDraw2.BONDTYPES.DOUBLEORAROMATIC:M=7;break;case JSDraw2.BONDTYPES.SINGLEORAROMATIC:M=6;break;case JSDraw2.BONDTYPES.SINGLEORDOUBLE:M=5;break;case JSDraw2.BONDTYPES.SINGLE:case JSDraw2.BONDTYPES.DOUBLE:case JSDraw2.BONDTYPES.TRIPLE:case JSDraw2.BONDTYPES.DELOCALIZED:M=h.type;aa=0;break;case JSDraw2.BONDTYPES.PEPTIDE:case JSDraw2.BONDTYPES.NUCLEOTIDE:case JSDraw2.BONDTYPES.DISULFIDE:case JSDraw2.BONDTYPES.AMIDE:M=1;aa=0;break;case JSDraw2.BONDTYPES.WEDGE:case JSDraw2.BONDTYPES.BOLD:M=1;aa=1;break;case JSDraw2.BONDTYPES.HASH:case JSDraw2.BONDTYPES.BOLDHASH:M=1;aa=6;break;case JSDraw2.BONDTYPES.WIGGLY:M=1;aa=4;break;case JSDraw2.BONDTYPES.EITHER:M=2;aa=3;break}T+=scil.Utils.formatStr(M,3,0);T+=scil.Utils.formatStr(aa,3,0);T+=scil.Utils.formatStr(0,3,0);if(h.ring!=null){T+=scil.Utils.formatStr(h.ring?1:2,3,0)}else{T+=scil.Utils.formatStr(0,3,0)}T+=scil.Utils.formatStr(h.rcenter==null?0:h.rcenter,3,0);T+="\n"}T+=G;T+=P;T+=af;T+=g;T+=N;T+=Q;T+=f;var L=0;if(ad!=null){for(var E=0;E<ad.length;++E){var d=ad[E].a;var K=ad[E].m;if(K==null){continue}++L;var ab=scil.Utils.formatStr(L,3,0);T+="M  STY  1 "+ab+" SUP\n";T+=this.writeList("M  SAL "+ab,K.atoms,"id",4,10);T+=this.writeList("M  SBL "+ab,K.bonds,"bondid",4,10);T+="M  SMT "+ab+" "+(d.alias==null?d.elem:d.alias)+"\n";if(d.bio!=null){T+="M  SCL "+ab+" "+d.biotype()+"\n"}}}var ag=[];for(var E=0;E<this.graphics.length;++E){var ae=JSDraw2.Text.cast(this.graphics[E]);if(ae!=null){ag.push(ae)}}var Y="";var F={k:L};var u=[];for(var E=0;E<this.graphics.length;++E){var l=JSDraw2.Bracket.cast(this.graphics[E]);if(l==null){continue}u.push(l);var O=l._rect;var n=null;var q=null;if(l.atoms.length>0){n=this.getExpandedAtoms(l.expandedatoms==null?l.atoms:l.expandedatoms);q=l.getXbonds(this)}var I=++F.k;var y=null;var X={sty:"",spl:"",data:"",id:F};var ah=l.getType();var Z=l.getTypeNum();X.subscript=ah;var ai=JSDraw2.SGroup.stys[ah];if(ai==null){if(q!=null&&q.length==2){ai="SRU"}else{ai="GEN"}}X.sty+=" "+scil.Utils.formatStr(I,3,0)+" "+ai;var B=JSDraw2.SGroup.fieldtypes[ah];if(B==null){B="BRACKET"}var z=ai==null;var ac=null;for(var H=0;H<ag.length;++H){var ae=ag[H];if(ae!=null&&ae.anchors.length==1&&ae.anchors[0]==l){if(ae.fieldtype=="BRACKET_CONN"){y=ae.text}else{if(ae.fieldtype!="BRACKET_TYPE"||ae.text!=ah&&ah!="mul"||z){var C=ae.fieldtype;if(B!=null&&C!=null&&C.length>8&&C.substr(0,8)=="BRACKET_"){if(C=="BRACKET_SUBTYPE"){C=B+"_TYPE"}else{C=B+C.substr(7)}}if(ai=="SRU"){X.subscript=ae.text}else{this.getDataGroup(ae.text,C,ae._rect.left*W,-ae._rect.top*W,I,X)}}else{if(ae.fieldtype=="BRACKET_TYPE"&&ah=="mul"){ac=ae.text}}}ag[H]=null}}Y+="M  STY"+scil.Utils.formatStr(X.sty.length/8,3,0)+X.sty+"\n";if(y=="ht"||y=="hh"||y=="eu"){Y+="M  SCN"+scil.Utils.formatStr(1,3,0)+" "+scil.Utils.formatStr(I,3,0)+" "+y.toUpperCase()+" \n"}if(Z!=null){Y+="M  SNC"+scil.Utils.formatStr(1,3,0)+" "+scil.Utils.formatStr(I,3,0)+" "+scil.Utils.padLeft(Z,3," ")+" \n"}if(X.spl!=""){Y+="M  SPL"+scil.Utils.formatStr(X.spl.length/8,3,0)+X.spl+"\n"}if(l.atoms.length>0){Y+=this.writeList("M  SAL "+scil.Utils.formatStr(I,3,0),n,"atomid",4,10);Y+=this.writeList("M  SBL "+scil.Utils.formatStr(I,3,0),q,"bondid",4,10);if(!scil.Utils.isNullOrEmpty(X.subscript)&&!(ai=="MUL"&&X.subscript=="mul")){Y+="M  SMT   1 "+X.subscript+"\n"}atoms=l.atoms;if(l.type!="n"||ai=="SRU"){Y+=this.writeList("M  SPA "+scil.Utils.formatStr(I,3,0),atoms,"id",4,10)}}Y+="M  SDI "+scil.Utils.formatStr(I,3,0)+"  4";Y+=scil.Utils.formatStr(l._rect.left*W,10,4);Y+=scil.Utils.formatStr(-l._rect.bottom()*W,10,4);Y+=scil.Utils.formatStr(l._rect.left*W,10,4);Y+=scil.Utils.formatStr(-l._rect.top*W,10,4);Y+="\n";Y+="M  SDI "+scil.Utils.formatStr(I,3,0)+"  4";Y+=scil.Utils.formatStr(l._rect.right()*W,10,4);Y+=scil.Utils.formatStr(-l._rect.top*W,10,4);Y+=scil.Utils.formatStr(l._rect.right()*W,10,4);Y+=scil.Utils.formatStr(-l._rect.bottom()*W,10,4);Y+="\n";if(ac!=null&&ac!=""){Y+="M  SMT "+scil.Utils.formatStr(I,3,0)+" "+ac;Y+="\n"}Y+=X.data}for(var E=0;E<ag.length;++E){var ae=ag[E];if(ae==null){continue}var I=F.k;var X={sty:"",spl:"",data:"",id:F};this.getDataGroup(ae.text,ae.fieldtype,ae._rect.left*W,-ae._rect.top*W,null,X);Y+="M  STY"+scil.Utils.formatStr(X.sty.length/8,3,0)+X.sty+"\n";if(F.k==I){++F.k}I=F.k;var U="";var V="";for(var H=0;H<ae.anchors.length;++H){var d=ae.anchors[H];if(JSDraw2.Atom.cast(d)!=null){U+=" "+scil.Utils.formatStr(d.atomid,3,0)}else{if(JSDraw2.Bond.cast(d)!=null){V+=" "+scil.Utils.formatStr(d.bondid,3,0)}}}if(U!=""){Y+="M  SAL "+scil.Utils.formatStr(I,3,0)+scil.Utils.formatStr(U.length/4,3,0)+U+"\n"}if(V!=""){Y+="M  SBL "+scil.Utils.formatStr(I,3,0)+scil.Utils.formatStr(V.length/4,3,0)+V+"\n"}Y+=X.data}T+=Y;if(x!=""){T+="M  CHG"+scil.Utils.formatStr(x.length/8,3,0)+x+"\n"}T+="M  END\n";return T},getExpandedAtoms:function(d){var h=[];for(var f=0;f<d.length;++f){var c=d[f];if(c.superatom==null){h.push(c)}else{for(var g=0;g<c.superatom.atoms.length;++g){h.push(c.superatom.atoms[f])}}}return h},writeList:function(q,n,l,c,d){if(n==null||n.Length==0){return""}var t="";countlastline=n.length%d;if(countlastline==0){countlastline=d}lines=(n.length-countlastline)/d+1;for(var g=0;g<lines;++g){var f=g+1==lines?countlastline:d;t+=q;t+=scil.Utils.formatStr(f,3);for(var h=0;h<f;++h){t+=scil.Utils.formatStr(n[g*d+h][l],c)}t+="\n"}return t},getMolV3000:function(d){var f=[];var c=this.expandSuperAtoms(f);c.chiral=this.chiral;return c._getMolV3000()},_getMolV3000:function(c){return null},hasStereoCenter:function(){for(var d=0;d<this.bonds.length;++d){var c=this.bonds[d];if(c.type==JSDraw2.BONDTYPES.WEDGE||c.type==JSDraw2.BONDTYPES.HASH){return true}}return false},hasEnhancedStereochemistry:function(){return false},getEnhancedStereochemistry:function(){return""},setMolV3000:function(d,h,g,f,c){return this},readV30Collections:function(f,d,c){},readV30Bonds:function(f,d,c,g){},getChiralAtom:function(d){if(d==null||d.anchors==null||d.anchors.length!=1||d.fieldtype!="CHIRAL"){return null}var c=JSDraw2.Atom.cast(d.anchors[0]);if(c==null){return null}return JSDraw2.Atom.isValidChiral(d.text)?c:null},markChirality:function(d,g,f){return false},findBestPostion:function(c,f){var d=c._parent.getNeighborAtoms(c);var h=c.p.clone();if(d!=null&&d.length>0){var g=d[0].p.angleTo(c.p);h.offset(f*0.37,0);h.rotateAround(c.p,g-60);h.x-=f*0.25;h.y-=f*0.25}else{h.x-=f*0.25;h.y-=f*0.75}return h},readRxnCenter:function(c,f){var d=f==null?null:parseInt(f);switch(d){case -1:c.rcenter=JSDraw2.RXNCENTER.NOTCENTER;break;case 1:c.rcenter=JSDraw2.RXNCENTER.CENTER;break;case 12:case 13:c.rcenter=JSDraw2.RXNCENTER.BREAKANDCHANGE;break;case 4:case 5:c.rcenter=JSDraw2.RXNCENTER.BREAK;break;case 8:case 9:c.rcenter=JSDraw2.RXNCENTER.CHANGE;break}},readV30Atoms:function(f,d,c,g){},readV30Counts:function(f,d,c){},parseV30Attributes:function(c,d){return null},getDataGroup:function(c,f,h,j,d,g){},containsWord:function(f){f=f.toLowerCase();for(var c=0;c<this.graphics.length;++c){var d=JSDraw2.Text.cast(this.graphics[c]);if(d!=null&&scil.Utils.containsWord(d.text,f,true)){return true}}return false},containsText:function(d){d=d.toLowerCase();for(var c=0;c<this.graphics.length;++c){var f=JSDraw2.Text.cast(this.graphics[c]);if(f!=null&&f.text!=null&&f.text.toLowerCase().indexOf(d)>=0){return true}}return false},getProp:function(c){return this.props==null?null:this.props[c]},setProp:function(c,d){if(d==null){if(this.props!=null){delete this.props[c]}}else{if(this.props==null){this.props={}}this.props[c]=d+""}},setRgfile:function(c){return null},_setParent:function(d){for(var c=0;c<this.atoms.length;++c){this.atoms[c]._parent=d}for(var c=0;c<this.bonds.length;++c){this.bonds[c]._parent=d}for(var c=0;c<this.graphics.length;++c){this.graphics[c]._parent=d}},_setGroup:function(c){for(var d=0;d<this.atoms.length;++d){this.atoms[d].group=c}for(var d=0;d<this.bonds.length;++d){this.bonds[d].group=c}},toggleAtom:function(h,n){for(var d=0;d<this.atoms.length;++d){var c=this.atoms[d];if(c.toggle(h,n)){return c}if(c.rgroup!=null){var g=c.rgroup.mols;for(var f=0;f<g.length;++f){var l=g[f].toggleAtom(h,n);if(l!=null){return l}}}}return null},toggle:function(t,w,f){for(var l=0;l<this.atoms.length;++l){var c=this.atoms[l];if(c.toggle(t,w)){return c}if(c.rgroup==null){continue}if(c.rgroup.toggle(t,w)){return c.rgroup}var q=c.rgroup.mols;for(var n=0;n<q.length;++n){var u=q[n].toggle(t,w);if(u!=null){return u}}}for(var l=0;l<this.bonds.length;++l){var d=this.bonds[l];if(d.toggle(t,w,f)){return this.bonds[l]}}for(var l=this.graphics.length-1;l>=0;--l){var h=this.graphics[l];if(h.toggle(t,w)){return this.graphics[l]}}return null},setRxnfile:function(c){return this},setRxnV3000:function(c){return this},readCtabs:function(g,d,l,h,c){for(var f=0;f<l;++f){var j=new JSDraw2.Mol();var q={};j.setMolV3000(g,d,true,q,c);d=q.i;if(!j.isEmpty()){h.push(j)}}return d},setRxnV2000:function(c){return this},setRxn:function(d,c){return this},getRxnfile:function(c,f){var d=this.parseRxn(true,c);if(d==null){return null}if(f){return this.getRxnV3000(d)}else{return this.getRxnV2000(d)}},getAllBrackets:function(){var f=[];for(var d=0;d<this.graphics.length;++d){var c=this.graphics[d];if(JSDraw2.Bracket.cast(c)!=null){f.push(c)}}return f},getAllTexts:function(){var f=[];for(var d=0;d<this.graphics.length;++d){var c=this.graphics[d];if(JSDraw2.Text.cast(c)!=null){f.push(c)}}return f},getRxnV2000:function(c){return null},getRxnV3000:function(d,c){return null},getXml:function(h,c,g,f,d){return this._getXml(h,c,g,f,d)},getHtml:function(h,c,g,f,d){return this.getXml(h,c,g,f,d)},_getXml:function(j,c,h,g,f,d){return null},setJdx:function(d,c){return this},setXml:function(c){return this},setHtml:function(c){return this.setXml(c)},toScreen:function(f){var c=this.medBondLength();if(!(c>0)){c=1.56}var d=f/c;this.scale(d);return d},scale:function(h,g){if(!(h>0)){return}for(var d=0;d<this.atoms.length;++d){var c=this.atoms[d];c.p.scale(h,g);if(c.rgroup!=null){if(c.rgroup!=null){c.rgroup.scale(h,g)}for(var f=0;f<c.rgroup.mols.length;++f){c.rgroup.mols[f].scale(h,g)}}}for(var d=0;d<this.graphics.length;++d){this.graphics[d].scale(h,g)}},flipX:function(g){for(var d=0;d<this.atoms.length;++d){var f=this.atoms[d].p;f.x=g-(f.x-g)}for(var d=0;d<this.bonds.length;++d){var c=this.bonds[d];if(c.type==JSDraw2.BONDTYPES.WEDGE||c.type==JSDraw2.BONDTYPES.HASH){c.type=c.type==JSDraw2.BONDTYPES.WEDGE?JSDraw2.BONDTYPES.HASH:JSDraw2.BONDTYPES.WEDGE}}for(var d=0;d<this.graphics.length;++d){this.graphics[d].flipX(g)}},flipY:function(g){for(var d=0;d<this.atoms.length;++d){var f=this.atoms[d].p;f.y=g-(f.y-g)}for(var d=0;d<this.bonds.length;++d){var c=this.bonds[d];if(c.type==JSDraw2.BONDTYPES.WEDGE||c.type==JSDraw2.BONDTYPES.HASH){c.type=c.type==JSDraw2.BONDTYPES.WEDGE?JSDraw2.BONDTYPES.HASH:JSDraw2.BONDTYPES.WEDGE}}for(var d=0;d<this.graphics.length;++d){this.graphics[d].flipY(g)}},clearFlag:function(){for(var c=0;c<this.atoms.length;++c){this.atoms[c].f=null;this.atoms[c].ringclosures=null}for(var c=0;c<this.bonds.length;++c){this.bonds[c].f=null}},_connectFragsByPlus:function(d,c){return null},_splitFrags:function(c){for(var d=0;d<c.length;++d){var g=c[d].splitFragments();if(g.length>0){c.splice(d,1);for(var f=0;f<g.length;++f){c.splice(d,0,g[f])}d+=g.length-1}}},_connectNextLine:function(g,h,c,d,f){return null},detectRxn:function(c){return null},_findCloseTexts:function(l,n,c,j){for(var d=0;d<n.length;++d){var q=n[d];if(q==null){continue}var g=l.rect();var h=q.rect();if(Math.abs(g.top-h.top)<c||Math.abs(g.top-h.bottom())<c||Math.abs(g.bottom()-h.top)<c||Math.abs(g.bottom()-h.bottom())<c){var f=Math.min(g.right(),h.right())-Math.max(g.left,h.left);if(f>=Math.min(g.width,h.width)/2){j.push(q);n[d]=null}}}},parseRxn2:function(){return null},isRxn:function(){return null},_groupByPlus:function(h){if(h==null){return h}var g=[];for(var c=0;c<this.graphics.length;++c){if(this.graphics[c].T=="PLUS"){g.push(this.graphics[c])}}if(g.length==0){if(h.reactants.length>1){for(var c=1;c<h.reactants.length;++c){h.reactants[0].mergeMol(h.reactants[c])}h.reactants=[h.reactants[0]]}if(h.products.length>1){for(var c=1;c<h.products.length;++c){h.products[0].mergeMol(h.products[c])}h.products=[h.products[0]]}}else{var l=[];for(var c=0;c<g.length;++c){var j=g[c].p.x;var f=l.length;for(var d=0;d<l.length;++d){if(j<l[d]){f=d;break}}l.splice(f,0,j)}h.reactants=this._groupByPlus2(l,h.reactants);h.products=this._groupByPlus2(l,h.products)}return h},_groupByPlus2:function(u,q){var j=[];var t=u.length;for(var g=0;g<q.length;++g){var l=q[g];var c=q[g].center().x;var d=false;for(var h=0;h<t;++h){if(c<u[h]){if(j[h]==null){j[h]=l}else{j[h].mergeMol(l)}d=true;break}}if(!d){if(j[t]==null){j[t]=l}else{j[t].mergeMol(l)}}}var w=[];for(var g=0;g<j.length;++g){if(j[g]!=null){w.push(j[g])}}return w},parseRxn:function(c,d){var f=this._parseRxn();if(d){f=this._groupByPlus(f)}return f},_addGraphicsRxnMol:function(j,d,l){for(var f=0;f<j.length;++f){var h=j[f];for(var g=0;g<d.length;++g){var c=d[g];if(c!=null&&c.allAtomsIn(h)){h.graphics.push(c);d[g]=null}}for(var g=0;g<l.length;++g){var c=l[g];if(c!=null&&c.allAnchorsIn(h)){h.graphics.push(c);d[g]=null}}}},_parseRxn:function(){return null},_hasOverlap:function(d,h,g){var c=g.left;var f=g.right();return c<h&&f>d},_sortTextByTop:function(h){if(h==null||h.length==0){return h}var l=[];var g=[];for(var c=0;c<h.length;++c){var j=h[c]._rect.top;var f=l.length;for(var d=0;d<l.length;++d){if(j<l[d]){f=d;break}}l.splice(f,0,j);g.splice(f,0,h[c])}return g},getFragment:function(c,h){this.setAtomBonds();this.clearFlag();var l=this._getTree(c).tree;var j=[];l.list(j,"breadthfirst");var g=new JSDraw2.Mol();for(var f=0;f<j.length;++f){var d=j[f];if(d.a!=null&&d.ringclosure==null){g._addAtom(d.a,h)}if(d.b!=null){g._addBond(d.b,h)}}return g},splitFragments:function(B){this.clearFlag();var l=-1;var d=scil.Utils.cloneArray(this.bonds);while(d.length>0){var c=d[0];if(B){if(c.a1.hidden||c.a2.hidden){d.splice(0,1);continue}}c.f=c.a1.f=c.a2.f=++l;d.splice(0,1);while(true){var A=0;for(var w=d.length-1;w>=0;--w){var c=d[w];if(c.a1.hidden||c.a2.hidden){d.splice(w,1);continue}if(c.f==null&&(c.a1.f==l||c.a2.f==l)){c.f=c.a1.f=c.a2.f=l;d.splice(w,1);++A}}if(A==0){break}}}var q=[];for(var y=0;y<=l;++y){var z=new JSDraw2.Mol();q.push(z);for(var w=0;w<this.atoms.length;++w){if(this.atoms[w].f==y){z._addAtom(this.atoms[w],this)}}for(var w=0;w<this.bonds.length;++w){if(this.bonds[w].f==y){z._addBond(this.bonds[w],this)}}}for(var w=0;w<this.atoms.length;++w){if(this.atoms[w].f==null){if(B&&this.atoms[w].hidden){continue}var z=new JSDraw2.Mol();q.push(z);z._addAtom(this.atoms[w],this)}}for(var w=0;w<this.graphics.length;++w){var f=JSDraw2.Bracket.cast(this.graphics[w]);if(f==null){continue}for(var y=0;y<q.length;++y){if(f.atoms==null||f.atoms.length==0){continue}if(q[y].containsAllAtoms(f.atoms)){q[y].graphics.push(f);for(var x=0;x<this.graphics.length;++x){var C=JSDraw2.Text.cast(this.graphics[x]);if(C!=null&&C.anchors!=null&&C.anchors.length==1&&C.anchors[0]==f){q[y].graphics.push(C)}}}}}for(var w=0;w<this.graphics.length;++w){var C=JSDraw2.Text.cast(this.graphics[w]);if(C==null||C.anchors==null||C.anchors.length==0){continue}for(var y=0;y<q.length;++y){if(q[y].containsAllAtoms(C.anchors)){q[y].graphics.push(C)}}}for(var w=0;w<q.length;++w){var h=q[w];for(var x=0;x<h.atoms.length;++x){var u=h.atoms[x].group;if(u!=null&&u.type=="chiral"){h.chiral=true;break}}}for(var w=0;w<q.length;++w){q[w].bondlength=this.bondlength}return q},containsAllAtoms:function(c){if(c==null||c.length==0){return false}for(var d=0;d<c.length;++d){if(scil.Utils.indexOf(this.atoms,c[d])<0){return false}}return true},containsAtom:function(c){for(var d=0;d<this.atoms.length;++d){if(this.atoms[d]==c){return true}}return false},setAtomBonds:function(d){for(var f=0;f<this.atoms.length;++f){this.atoms[f].bonds=null}if(d){return}for(var f=0;f<this.bonds.length;++f){var c=this.bonds[f];if(c.a1.bonds==null){c.a1.bonds=[]}c.a1.bonds.push(c);if(c.a2.bonds==null){c.a2.bonds=[]}c.a2.bonds.push(c)}},setBondOrders:function(){for(var f=0;f<this.bonds.length;++f){var d=this.bonds[f];d.order=d.valence()}if(DEBUG.enable){for(var f=0;f<this.bonds.length;++f){var d=this.bonds[f];DEBUG.print(d.a1.id+"-"+d.a2.id+" "+d.order)}}var l=this._getRings();var c=[];while(l.length>0){var h=0;for(var f=l.length-1;f>=0;--f){var j=l[f];if(this.isAromaticRing(j)){++h;c.push(j);l.splice(f,1);for(var g=0;g<j.length;++g){j[g].order=1.5}}}if(h==0){break}}return{arrings:c,rings:l}},isAromaticRing:function(j){if(j.length==6){var c=j[0];for(var g=1;g<=j.length;++g){var d=j[g==j.length?0:g];if(!(c.order==1&&d.order==2||c.order==2&&d.order==1||c.order==1.5&&d.order>=1&&d.order<=2||d.order==1.5&&c.order>=1&&c.order<=2)){return false}c=d}return true}if(j.length==5){var c=j[0];for(var g=1;g<=j.length;++g){var d=j[g==j.length?0:g];if(c.order==1&&d.order==1){if(c.a1==d.a1||c.a1==d.a2){v=c.a1}else{if(c.a2==d.a1||c.a2==d.a2){v=c.a2}}if(v!=null&&(j[(g+1)%5].order==2||j[(g+1)%5].order==1.5)&&j[(g+2)%5].order==1&&(j[(g+3)%5].order==2||j[(g+3)%5].order==1.5)){if(v.elem=="N"||v.elem=="O"||v.elem=="S"||v.elem=="P"){return true}else{if(v.elem=="C"){for(var f=0;f<v.bonds.length;++f){var h=v.bonds[f].order;if(h==1.5||h==2){return true}}}}}return false}c=d}return false}return false},prepareScreen:function(){var d=JSDraw2.FormulaParser.getAtomStats(this).elements;var c=this.setBondOrders();var f={0:0,1:0,1.5:0,2:0,3:0};for(var g=0;g<this.bonds.length;++g){++f[this.bonds[g].order]}var h={n5:0,a5:0,n6:0,a6:0};for(var g=0;g<c.arrings.length;++g){if(c.arrings[g].length==5){++h.a5}else{if(c.arrings[g].length==6){++h.a6}}}for(var g=0;g<c.rings.length;++g){if(c.rings[g].length==5){++h.n5}else{if(c.rings[g].length==6){++h.n6}}}return{atoms:d,bonds:f,rings:h}},clearAtomMap:function(c){var f=0;if(c==null){for(var d=0;d<this.atoms.length;++d){if(this.atoms[d].atommapid!=null){++f;this.atoms[d].atommapid=null}}}else{for(var d=0;d<this.atoms.length;++d){if(c==this.atoms[d].atommapid){++f;this.atoms[d].atommapid=null}}}return f},getMaxMapId:function(){var f=0;var d=this.atoms;for(var c=0;c<d.length;++c){if(d[c].atommapid!=null&&d[c].atommapid>=f){f=d[c].atommapid}}return f+1},screen:function(n,l){if(this.stats==null){this.stats=this.prepareScreen()}if(n.stats==null){n.stats=n.prepareScreen()}var d=this.stats.atoms;var f=n.stats.atoms;var c=f["*"]==null?0:f["*"];c+=f.A==null?0:f.A;c+=f.X==null?0:f.X;c+=f.Q==null?0:f.Q;c+=f.L==null?0:f.L;for(var j in d){if(j=="H"||j=="*"||j=="A"||j=="X"||j=="Q"||j=="L"){continue}if(l&&!(d[j]==f[j])||!l&&!(d[j]<=f[j]+c)){return false}}var g=this.stats.bonds;var h=n.stats.bonds;for(var j in g){if(l&&!(g[j]==h[j])||!l&&!(g[j]<=h[j])){return false}}return l&&this.stats.rings.a5==n.stats.rings.a5&&this.stats.rings.n5==n.stats.rings.n5&&this.stats.rings.a6==n.stats.rings.a6&&this.stats.rings.n6==n.stats.rings.n6||!l&&this.stats.rings.a5<=n.stats.rings.a5&&this.stats.rings.n5<=n.stats.rings.n5&&this.stats.rings.a6<=n.stats.rings.a6&&this.stats.rings.n6<=n.stats.rings.n6},fullstructureMatch:function(d,c){if(d==null||this.atoms.length!=d.atoms.length||this.bonds.length!=d.bonds.length||this.getMolWeight()!=d.getMolWeight()){return false}return this.aamap(d,true,null,c)!=null},getBrackets:function(){var f=[];for(var d=0;d<this.graphics.length;++d){var c=JSDraw2.Bracket.cast(this.graphics[d]);if(c!=null){f.push(c);c.sgrouptexts=this.getSgroupTexts(c)}}return f},matchBrackets:function(l){var h=this.getBrackets();var j=l==null?[]:l.getBrackets();if(h.length!=j.length){return false}for(var d=0;d<h.length;++d){var c=false;for(var g=0;g<j.length;++g){if(h[d].sgrouptexts==j[g].sgrouptexts){c=true;break}}if(c!=null){return false}}return true},substructureMatch:function(c){return this.aamap(c,false)!=null},aamap:function(j,c,d,h){var g=this.aamap2(j,c,h);if(d){j.setColor(g==null?null:"black");if(g!=null){for(var f=0;f<g.atoms.length;++f){g.atoms[f].t.color="red"}for(var f=0;f<g.bonds.length;++f){g.bonds[f].t.color="red"}}}return g},_setAtomEnhancedStereo:function(f){for(var d=0;d<f.atoms.length;++d){f.atoms[d]._enhancedstereochemistry=null}for(var d=0;d<f.graphics.length;++d){var g=JSDraw2.Text.cast(f.graphics[d]);if(g!=null){var c=f.getChiralAtom(g);if(c!=null){c._enhancedstereochemistry=g.text}}}},aamap2:function(E,l,x){if(DEBUG.enable){DEBUG.clear()}if(!this.screen(E,l)){if(DEBUG.enable){DEBUG.print("screen failed")}return null}var A=this._bfPath();E.setAtomBonds();E.clearFlag();this.clearFlag();this._setAtomEnhancedStereo(this);this._setAtomEnhancedStereo(E);var q=0;while(q<A.length){var h=false;var y=A[q];if(y.b==null){for(var u=(y.f==null?0:(y.f+1));u<E.atoms.length;++u){var D=E.atoms[u];y.f=u;if(D.f==null&&JSDraw2.Atom.match(D,y.a,x)){h=true;y.a.f=D;D.f=y.a;break}}}else{if(y.ringclosure!=null){var d=E.findBond(y.b.a1.f,y.b.a2.f);if(d!=null&&y.b.order==d.order&&(!x||y.b.type==d.type)){h=true;d.f=y.b;y.b.f=d}}else{var C=y.f==null?0:y.f+1;var D=y.startAtom().f;for(var w=C;w<D.bonds.length;++w){y.f=w;var d=D.bonds[w];var z=d.otherAtom(D);if(d.f==null&&z.f==null&&y.b.order==d.order&&(!x||y.b.type==d.type)&&JSDraw2.Atom.match(y.a,z,x)){h=true;y.a.f=z;z.f=y.a;y.b.f=d;d.f=y.b;break}}}}if(h){++q;if(DEBUG.enable){var B="";if(y.a!=null){B+=y.a.id+" -> "+y.a.f.id+" "}if(y.b!=null){B+=y.b.a1.id+"-"+y.b.a2.id+" -> "+y.b.f.a1.id+"-"+y.b.f.a2.id}DEBUG.print(B)}}else{if(y.b!=null&&y.b.f!=null){y.b.f.f=null;y.b.f=null}if(y.a!=null&&y.a.f!=null){y.a.f.f=null;y.a.f=null}y.f=null;if(--q<0){if(DEBUG.enable){DEBUG.print("failed")}return null}y=A[q];if(y.b!=null&&y.b.f!=null){y.b.f.f=null;y.b.f=null}if(y.a!=null&&y.a.f!=null){y.a.f.f=null;y.a.f=null}if(DEBUG.enable){DEBUG.print("trace back")}}}if(DEBUG.enable){DEBUG.print("succeed")}var c=[];for(var q=0;q<this.atoms.length;++q){c.push({q:this.atoms[q],t:this.atoms[q].f})}var g=[];for(var q=0;q<this.bonds.length;++q){g.push({q:this.bonds[q],t:this.bonds[q].f})}return{atoms:c,bonds:g}},_setAromaticFlag:function(){for(var d=0;d<this.atoms.length;++d){this.atoms[d].aromatic=false}for(var d=0;d<this.bonds.length;++d){var c=this.bonds[d];if(c.type==JSDraw2.BONDTYPES.DELOCALIZED){c.a1.aromatic=c.a2.aromatic=true}}},getSmiles:function(){return null},_getSmiles:function(){return null},_getRings:function(){var x=[];this.setAtomBonds();this.clearFlag();for(var f=0;f<this.atoms.length;++f){this.clearFlag();for(var g=0;g<f;++g){this.atoms[g].f="ex"}var y=this.atoms[f];var u=this._getTree(y);if(u.ri==0){continue}var q=[];u.tree.list(q,"breadthfirst");for(var h=0;h<q.length;++h){var d=q[h];if(d.depth>3){break}if(d.ringclosure!=null){var w=[d.b];x.push(w);var c=d.startAtom();var l=h;while(c!=y){for(var g=l-1;g>0;--g){var z=q[g];if(z.a==c){w.push(z.b);c=z.startAtom();l=g;break}}}c=d.a;l=h;while(c!=y){for(var g=l-1;g>0;--g){var z=q[g];if(z.a==c){w.splice(0,0,z.b);c=z.startAtom();l=g;break}}}}}}return x},_bfPath:function(){var d=[];var f=this._getTrees();for(var c=0;c<f.length;++c){f[c].list(d,"breadthfirst")}return d},_getTrees:function(){this.setAtomBonds();this.clearFlag();var j=[];var g=0;while(true){var h=null;for(var d=0;d<this.atoms.length;++d){var c=this.atoms[d];if(c.f==null&&!c.isMarkedStereo()){h=c;break}}if(h==null){for(var d=0;d<this.atoms.length;++d){var c=this.atoms[d];if(c.f==null){h=c;break}}}if(h==null){break}var f=this._getTree(h,g);j.push(f.tree);g=f.ri}return j},_getTree:function(c,n){if(n==null){n=0}var t=new JSDraw2.BA(null,c,null);t.depth=0;t.a.f=true;var q=new JSDraw2.Stack();q.push(t);var f;while((f=q.popHead())!=null){var g=f.a.bonds;if(g==null){continue}for(var h=0;h<g.length;++h){var d=g[h];if(d.f){continue}d.f=true;var j=null;var l=d.otherAtom(f.a);if(l.f=="ex"){continue}if(l.f==null){l.f=true;j=new JSDraw2.BA(d,l,null);q.push(j)}else{++n;if(l.f==true&&l.ringclosures==null){l.ringclosures=[]}l.ringclosures.push({ri:n,next:new JSDraw2.BA(d,f.a,n)});j=new JSDraw2.BA(d,l,n)}f.addNext(j)}}return{tree:t,ri:n}},_getPath:function(c){var h=new JSDraw2.Stack();h.push({b:c,a:c.a1.bonds.length>c.a2.bonds.length?c.a1:c.a2});c.a1.f=true;var g=[];while((c=h.pop())!=null){if(c.b.f){continue}g.push(c);if(c.a.f){c.ringclosure=true}c.b.f=c.a.f=true;var d=c.a.bonds;for(var f=d.length-1;f>=0;--f){if(!d[f].f){h.push({b:d[f],a:d[f].otherAtom(c.a)})}}}return g},getFormula:function(c){var f=this.parseRxn();if(f==null){return this._getFormula(c)}var g="";if(f.arrow!=null){for(var d=0;d<f.reactants.length;++d){g+=(d>0?" + ":"")+f.reactants[d]._getFormula(c)}g+=c?" &rarr; ":" ---> ";for(var d=0;d<f.products.length;++d){g+=(d>0?" + ":"")+f.products[d]._getFormula(c)}return g}else{for(var d=0;d<f.reactants.length;++d){g+=(d>0?" + ":"")+f.reactants[d]._getFormula(c)}}return g},_getFormula:function(c){var d=this.expandSuperAtoms();var f=JSDraw2.FormulaParser.getAtomStats(d);return JSDraw2.FormulaParser.stats2mf(f,c)},getMolWeight:function(){var d=this.getMixtureMW();if(d>0){return d}if(this.hasGenericAtom()){return null}var c=this.expandSuperAtoms();var f=JSDraw2.FormulaParser.getAtomStats(c);var g=JSDraw2.FormulaParser.stats2mw(f);return g==null?null:Math.round(g*10000)/10000},getMixtureMW:function(){for(var d=0;d<this.graphics.length;++d){var c=JSDraw2.Bracket.cast(this.graphics[d]);if(c==null||!(c.type==""||c.type==null)){continue}var h=this.getSgroupText(c,"POLYMER_MW");if(h==null){continue}var g=scil.Utils.trim(h.text);if(g!=null&&scil.Utils.startswith(g,"mw=")){var f=g.substr(3);return parseFloat(f)}}return null},getExactMass:function(){if(this.hasGenericAtom()){return null}var c=this.expandSuperAtoms();var d=JSDraw2.FormulaParser.getAtomStats(c);var f=JSDraw2.FormulaParser.stats2em(d);return f==null?null:Math.round(f*10000)/10000},getAllBonds:function(c){var g=[];var d=this.bonds;for(var f=0;f<d.length;++f){if(d[f].a1==c||d[f].a2==c){g.push(d[f])}}return g},getAllBondAtoms:function(c){var g=[];var d=this.bonds;for(var f=0;f<d.length;++f){if(d[f].a1==c){g.push(d[f].a2)}else{if(d[f].a2==c){g.push(d[f].a1)}}}return g},countSelected:function(){var d=0;for(var c=0;c<this.atoms.length;++c){if(this.atoms[c].selected){++d}}for(var c=0;c<this.bonds.length;++c){if(this.bonds[c].selected){++d}}for(var c=0;c<this.graphics.length;++c){if(this.graphics[c].selected){++d}}return d},setSgroup:function(c,d,h,j,l){if(h==""){h=null}if(d=="BRACKET_TYPE"&&h=="mul"&&c.subscript!=null&&c.subscript!=""){h=c.subscript;c.subscript=null}var g=this.getSgroupText(c,d);if(h==null){if(g!=null){this.delGraphics(g);return g}}else{if(g!=null){if(g.text!=h){g.text=h;return g}}else{var f=new JSDraw2.Rect(j,l,0,0);g=new JSDraw2.Text(f,h);g.fieldtype=d;g.anchors.push(c);c._parent.addGraphics(g);return g}}return null},getSgroupText:function(c,d){for(var f=0;f<this.graphics.length;++f){var g=JSDraw2.Text.cast(this.graphics[f]);if(g!=null&&g.fieldtype==d&&g.anchors.length==1&&g.anchors[0]==c){return g}}return null},getSgroupTexts:function(c){var f=[];for(var d=0;d<this.graphics.length;++d){var g=JSDraw2.Text.cast(this.graphics[d]);if(g!=null&&g.anchors.length==1&&g.anchors[0]==c){f.push(g.text)}}if(f.length==0){return null}f.sort();return scil.Utils.array2str(f,"; ")},removeTags:function(c,d){var g=0;for(var f=this.graphics.length-1;f>=0;--f){var h=JSDraw2.Text.cast(this.graphics[f]);if(h!=null&&h.anchors.length==1&&h.anchors[0]==c&&d.indexOf(h.fieldtype+",")>=0){this.delGraphics(h);++g}}return g}});JsMol=JSDraw2.Mol;JSDraw2.Point=scilligence.extend(scilligence._base,{constructor:function(c,d){this.x=isNaN(c)?0:c;this.y=isNaN(d)?0:d},isValid:function(){return !isNaN(this.x)&&!isNaN(this.y)},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},distTo:function(f){var c=this.x-f.x;var d=this.y-f.y;return Math.sqrt(c*c+d*d)},onLine:function(g,h,j){var f=g.distTo(h);var c=g.distTo(this)+h.distTo(this)-f;return Math.abs(c)<=j*(50/f)},inTriangle:function(g,h,j){var c=JSDraw2.Point.sign(this,g,h)<0;var d=JSDraw2.Point.sign(this,h,j)<0;var f=JSDraw2.Point.sign(this,j,g)<0;return c==d&&d==f},flip:function(f,g){var d=g.angleTo(f);var c=this.angleTo(f)-d;return this.rotateAround(f,-2*c)},offset:function(c,d){this.x+=c;this.y+=d;return this},offset2:function(c){this.x+=c.x;this.y+=c.y;return this},scale:function(d,c){if(c!=null){this.x=(this.x-c.x)*d+c.x;this.y=(this.y-c.y)*d+c.y}else{this.x*=d;this.y*=d}return this},reverse:function(){this.x=-this.x;this.y=-this.y;return this},clone:function(){return new JSDraw2.Point(this.x,this.y)},equalsTo:function(c){return c!=null&&this.x==c.x&&this.y==c.y},angle:function(){var c=Math.atan2(this.y,this.x)*180/Math.PI;return c<0?(c+360):c},angleTo:function(d){var c=Math.atan2(this.y-d.y,this.x-d.x)*180/Math.PI;return c<0?(c+360):c},angleAsOrigin:function(d,f){var g=d.clone().offset(-this.x,-this.y);var h=f.clone().offset(-this.x,-this.y);var c=h.angle()-g.angle();return c<0?(c+360):c},middleAngle:function(g,h){var c=g.angleTo(this);var d=h.angleTo(this);var f=(c+d)/2;if(Math.abs(c-d)>180){f+=180;if(f>=360){f-=360}}return f},rotate:function(g){var f=this.length();if(f==0){return this}var c=this.angle();this.x=f*Math.cos((c+g)*Math.PI/180);this.y=f*Math.sin((c+g)*Math.PI/180);return this},rotateAround:function(f,c,d){this.offset(-f.x,-f.y).rotate(c).offset(f.x,f.y);if(d>0){this.setLength(d,f)}return this},setLength:function(c,d){if(d==null){return this.scale(c/this.length())}this.offset(-d.x,-d.y);this.scale(c/this.length());return this.offset(d.x,d.y)},toString:function(c){if(!(c>0)){c=1}return(this.x*c).toFixed(3)+" "+(-this.y*c).toFixed(3)},shrink:function(g,f){var c=this.distTo(g);var h=(c-f)/c;this.x=(this.x-g.x)*h+g.x;this.y=(this.y-g.y)*h+g.y;return this},equalMove:function(f){var c=Math.abs(this.x-f.x);if(this.y>f.y){this.y=f.y+c}else{this.y=f.y-c}}});scil.apply(JSDraw2.Point,{fromString:function(c){var d=c.split(" ");if(d.length!=2){return null}var f=parseFloat(d[0]);var g=-parseFloat(d[1]);if(isNaN(f)||isNaN(g)){return null}return new JSDraw2.Point(f,g)},centerOf:function(c,d){return new JSDraw2.Point((c.x+d.x)/2,(c.y+d.y)/2)},sign:function(c,d,f){return(c.x-f.x)*(d.y-f.y)-(d.x-f.x)*(c.y-f.y)},_onSegment:function(c,d,f){if(d.x<=Math.max(c.x,f.x)&&d.x>=Math.min(c.x,f.x)&&d.y<=Math.max(c.y,f.y)&&d.y>=Math.min(c.y,f.y)){return true}return false},_orientation:function(c,d,f){var g=(d.y-c.y)*(f.x-d.x)-(d.x-c.x)*(f.y-d.y);if(g==0){return 0}return(g>0)?1:2},intersect:function(h,l,j,n){var c=this._orientation(h,l,j);var d=this._orientation(h,l,n);var f=this._orientation(j,n,h);var g=this._orientation(j,n,l);if(c!=d&&f!=g){return true}if(c==0&&this._onSegment(h,j,l)){return true}if(d==0&&this._onSegment(h,n,l)){return true}if(f==0&&this._onSegment(j,h,n)){return true}if(g==0&&this._onSegment(j,l,n)){return true}return false}});JSDraw2.Rect=scilligence.extend(scilligence._base,{constructor:function(d,f,g,c){this.left=isNaN(d)?0:d;this.top=isNaN(f)?0:f;this.width=isNaN(g)?0:g;this.height=isNaN(c)?0:c},set:function(c,d){this.left=Math.min(c.x,d.x);this.top=Math.min(c.y,d.y);this.width=Math.abs(c.x-d.x);this.height=Math.abs(c.y-d.y);return this},topleft:function(){return new JSDraw2.Point(this.left,this.top)},topright:function(){return new JSDraw2.Point(this.right(),this.top)},bottomleft:function(){return new JSDraw2.Point(this.left,this.bottom())},bottomright:function(){return new JSDraw2.Point(this.right(),this.bottom())},fourPoints:function(){return[this.topleft(),this.topright(),this.bottomleft(),this.bottomright()]},clone:function(){return new JSDraw2.Rect(this.left,this.top,this.width,this.height)},isEmpty:function(){return !(this.width>0&&this.height>0)},contains:function(c){return c.x>=this.left&&c.x<=this.right()&&c.y>=this.top&&c.y<=this.bottom()},right:function(){return this.left+this.width},bottom:function(){return this.top+this.height},center:function(){return new JSDraw2.Point(this.left+this.width/2,this.top+this.height/2)},centerLeft:function(){return new JSDraw2.Point(this.left,this.top+this.height/2)},centerRight:function(){return new JSDraw2.Point(this.right(),this.top+this.height/2)},centerTop:function(){return new JSDraw2.Point(this.left+this.width/2,this.top)},centerBottom:function(){return new JSDraw2.Point(this.left+this.width/2,this.bottom())},offset:function(c,d){this.left+=c;this.top+=d;return this},scale:function(d,c){if(c!=null){this.left=(this.left-c.x)*d+c.x;this.top=(this.top-c.y)*d+c.y}else{this.left*=d;this.top*=d}this.width*=d;this.height*=d;return this},unionPoint:function(c){if(c.x<this.left){this.width+=this.left-c.x;this.left=c.x}else{if(c.x>this.right()){this.width+=c.x-this.right()}}if(c.y<this.top){this.height+=this.top-c.y;this.top=c.y}else{if(c.y>this.bottom()){this.height+=c.y-this.bottom()}}return this},union:function(d){if(d==null){return}var f=this.right();var c=this.bottom();if(d.left<this.left){this.left=d.left}if(d.top<this.top){this.top=d.top}this.width=Math.max(f,d.right())-this.left;this.height=Math.max(c,d.bottom())-this.top;return this},inflate:function(c,d){if(d==null){c=d}if(this.width+2*c<0){c=-this.width/2}if(this.height+2*d<0){d=-this.height/2}this.offset(-c,-d);this.width+=2*c;this.height+=2*d;return this},distance2Point:function(g){var h=this.right();var c=this.bottom();var f=new JSDraw2.Point(this.left,this.top).distTo(g);f=this._minDist(f,g,this.left+this.width/2,this.top);f=this._minDist(f,g,h,this.top);f=this._minDist(f,g,h,this.top+this.height/2);f=this._minDist(f,g,h,c);f=this._minDist(f,g,this.left+this.width/2,c);f=this._minDist(f,g,this.left,c);f=this._minDist(f,g,this.left,this.height/2);return f},_minDist:function(c,f,g,h){return Math.min(c,new JSDraw2.Point(g,h).distTo(f))},cross:function(j,l){var f=this.contains(j);var g=this.contains(l);if(f&&g){return 0}else{if(f&&!g){return -2}else{if(!f&&g){return 2}}}var c=l.angleTo(j);var d=[];d[0]=new JSDraw2.Point(this.left,this.top).angleTo(j)-c;d[1]=new JSDraw2.Point(this.right(),this.top).angleTo(j)-c;d[2]=new JSDraw2.Point(this.right(),this.bottom()).angleTo(j)-c;d[3]=new JSDraw2.Point(this.left,this.bottom()).angleTo(j)-c;for(var h=0;h<d.length;++h){if(d[h]<0){d[h]+=360}}d.sort(function(n,q){return n-q});if(d[0]<90&&d[3]>270){return 1}if(d[0]>90&&d[0]<180&&d[3]>180&&d[3]<270){return -1}return 0},toString:function(c){if(!(c>0)){c=1}return(this.left*c).toFixed(3)+" "+(-this.bottom()*c).toFixed(3)+" "+(this.width*c).toFixed(3)+" "+(this.height*c).toFixed(3)},cornerTest:function(c,d){if(Math.abs(c.x-this.left)<d&&Math.abs(c.y-this.top)<d){return"topleft"}if(Math.abs(c.x-this.right())<d&&Math.abs(c.y-this.top)<d){return"topright"}if(Math.abs(c.x-this.left)<d&&Math.abs(c.y-this.bottom())<d){return"bottomleft"}if(Math.abs(c.x-this.right())<d&&Math.abs(c.y-this.bottom())<d){return"bottomright"}return null},moveCorner:function(c,f){switch(c){case"topleft":this.set(this.topleft().offset(f.x,f.y),this.bottomright());break;case"topright":this.set(this.topright().offset(f.x,f.y),this.bottomleft());break;case"bottomleft":this.set(this.bottomleft().offset(f.x,f.y),this.topright());break;case"bottomright":this.set(this.bottomright().offset(f.x,f.y),this.topleft());break}}});JSDraw2.Rect.fromString=function(f){if(f==null){return null}var g=f.split(" ");if(g.length!=4){return null}var d=parseFloat(g[0]);var h=parseFloat(g[1]);var j=parseFloat(g[2]);var c=parseFloat(g[3]);if(isNaN(d)||isNaN(h)||isNaN(j)||isNaN(c)){return null}return new JSDraw2.Rect(d,-h-c,j,c)};JSDraw2.Stack=scilligence.extend(scilligence._base,{constructor:function(c){this._items=[];this._capacity=c},item:function(c){return this._items[c]},clear:function(){this._items=[]},length:function(){return this._items.length},isEmpty:function(){return this._items.length==0},push:function(c){if(this._items.length>this._capacity){this._items.splice(0,1)}this._items.push(c)},pop:function(){if(this._items.length==0){return null}return this._items.pop()},popHead:function(){if(this._items.length==0){return null}var c=this._items[0];this._items.splice(0,1);return c}});scil.Deque=scil.apply(scil._base,{constructor:function(){this.items=[]},pushRange:function(d){if(d==null){return}for(var c=0;c<d.length;++c){this.push(d[c])}},push:function(c){this.items.push(c)},pop:function(){if(this.items.length==0){return null}var c=this.items[0];this.items.splice(0,1);return c},length:function(){return this.items.length},clear:function(){this.items=[]}});JSDraw2.SuperAtoms={sdf:"\nMolEngine02241412152D\n\n  6  6  0  0  0  0            999 V2000\n    1.3510    0.0000    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    0.0000    0.7800    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    0.0000    2.3400    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    2.7020    0.7800    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    2.7020    2.3400    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    1.3510    3.1200    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n  1  2  2  0  0  0  0\n  2  3  1  0  0  0  0\n  1  4  1  0  0  0  0\n  4  5  2  0  0  0  0\n  5  6  1  0  0  0  0\n  6  3  2  0  0  0  0\nM  END\n> <T>\nBenzene\n\n$$$$\n\nMolEngine02241412152D\n\n  6  6  0  0  0  0            999 V2000\n    1.3510    0.0000    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    0.0000    0.7800    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    0.0000    2.3400    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    1.3510    3.1200    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    2.7020    2.3400    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    2.7020    0.7800    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n  1  2  1  0  0  0  0\n  2  3  1  0  0  0  0\n  3  4  1  0  0  0  0\n  4  5  1  0  0  0  0\n  5  6  1  0  0  0  0\n  6  1  1  0  0  0  0\nM  END\n> <T>\nHexane\n\n$$$$\n\nMolEngine02241412152D\n\n  5  5  0  0  0  0            999 V2000\n    0.0000    0.4821    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    1.4836    0.0000    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    2.4006    1.2621    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    1.4836    2.5242    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    0.0000    2.0421    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n  1  2  1  0  0  0  0\n  2  3  1  0  0  0  0\n  3  4  1  0  0  0  0\n  4  5  1  0  0  0  0\n  5  1  1  0  0  0  0\nM  END\n> <T>\nPentane\n\n$$$$\n\nMolEngine02241412152D\n\n  3  3  0  0  0  0            999 V2000\n    0.7800    0.0000    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    0.0000    1.3510    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    1.5600    1.3510    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n  1  2  1  0  0  0  0\n  1  3  1  0  0  0  0\n  2  3  1  0  0  0  0\nM  END\n> <T>\nPropane\n\n$$$$\n\nMolEngine02241412152D\n\n  4  4  0  0  0  0            999 V2000\n    0.0000    0.0000    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    0.0000    1.5600    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    1.5600    1.5600    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    1.5600    0.0000    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n  1  2  1  0  0  0  0\n  2  3  1  0  0  0  0\n  3  4  1  0  0  0  0\n  4  1  1  0  0  0  0\nM  END\n> <T>\nButane\n\n$$$$\n\nMolEngine02241412152D\n\n  7  7  0  0  0  0            999 V2000\n    0.0000    0.9727    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    1.2196    0.0000    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    2.7405    0.3471    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    3.4174    1.7527    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    2.7405    3.1581    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    1.2196    3.5054    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    0.0000    2.5327    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n  1  2  1  0  0  0  0\n  2  3  1  0  0  0  0\n  3  4  1  0  0  0  0\n  4  5  1  0  0  0  0\n  5  6  1  0  0  0  0\n  6  7  1  0  0  0  0\n  7  1  1  0  0  0  0\nM  END\n> <T>\nHeptane\n\n$$$$\n\nMolEngine02241412152D\n\n  8  8  0  0  0  0            999 V2000\n    0.0000    1.1031    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    1.1031    0.0000    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    2.6631    0.0000    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    3.7660    1.1031    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    3.7660    2.6631    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    2.6631    3.7662    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    1.1031    3.7662    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    0.0000    2.6631    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n  1  2  1  0  0  0  0\n  2  3  1  0  0  0  0\n  3  4  1  0  0  0  0\n  4  5  1  0  0  0  0\n  5  6  1  0  0  0  0\n  6  7  1  0  0  0  0\n  7  8  1  0  0  0  0\n  8  1  1  0  0  0  0\nM  END\n> <T>\nOctane\n\n$$$$\n",dict:null,reversible:{},AminoAcids:{},DNAs:{},RNAs:{},templates:{},nterminals:{},cterminals:{},customtemplates:{},listFunctionalGroups:function(h){this.read();var c=[{key:"name",caption:"Name",width:200},{key:"molfile",type:"structure",caption:"Structure"}];var d=new JSDraw2.Table(null,{columns:c,toolbar:["search"]},h);var f=[];for(var g in this.dict){f.push({name:g,molfile:this.dict[g]==null?null:this.dict[g].getMolfile()})}d.setJson({rows:f})},filter:function(g,f){if(g==null||g==""){return null}var h=[];g=g.toLowerCase();var d=g.length;for(var c in this.dict){if(c.length>=d&&c.substr(0,d).toLowerCase()==g){h.push(c);if(h.length>=f){break}}}return h},get:function(d){this.read();var c=this.dict[d];if(c==null){c=this.nterminals[d]}if(c==null){c=this.cterminals[d]}return c==null?null:c.clone()},getDNA:function(c){this.read();return this.DNAs[c]},getRNA:function(c){this.read();return this.RNAs[c]},getAA:function(c){this.read();return this.AminoAcids[c]},getTemplate:function(c){this.read();return this.templates[c]},hasCustomTemplates:function(d){this.read();for(var c in this.customtemplates){return true}return false},getCustomTemplate:function(c){this.read();return this.customtemplates[c]},reverseLabel:function(f){this.read();if(this.get(f)!=null){return this.reverseLabel2(f)}var d=f.substr(0,1);var g=f.substr(1);if((d=="O"||d=="S")&&this.get(g)!=null){return this.reverseLabel2(g)+d}return f},reverseLabel2:function(q){if(this.reversible[q]==null){return q}var l="";for(var f=q.length-1;f>=0;--f){var h=1;for(var g=f;g>=0;--g){var d=q.charCodeAt(g);if(d>=65&&d<=90){break}else{++h}}f-=h-1;l+=q.substr(f,h)}return l},guessOne:function(d){this.read();d=d.toLowerCase();for(var c in this.dict){if(c.toLowerCase()==d){return c}}return null},read:function(){if(this.dict!=null){return}this.dict={};this.addSdf(this.sdf);if(JSDraw2.defaultoptions!=null){this.addSdf(JSDraw2.defaultoptions.abbreviations)}this.addSdf(JSDraw2.abbreviations);if(this.onAfterRead!=null){this.onAfterRead()}},addSdf:function(h){if(h==null||h==""){return}var q=0;var j=h.split("$$$$");for(var d=0;d<j.length;++d){var g=JSDraw2.Table.readSdfRecord(j[d],true);if(g==null){break}var n=g.props.T;var c=g.props.CT;var l=g.props.Name;var f=new JSDraw2.Mol();f.setMolfile(g.molfile);if(n!=null){this.templates[n]=f}else{if(c!=null){this.customtemplates[c]=f}}}},_getAttachAtoms:function(h){var g=[];if(h!=null){for(var d=0;d<h.atoms.length;++d){var c=h.atoms[d];for(var f=0;f<c.attachpoints.length;++f){g[c.attachpoints[f]-1]={apo:c.attachpoints[f],a:c}}}}return g},_alignMol:function(j,c,n,d,l){if(l>0){n.setBondLength(l)}var f=j.getNeighborBonds(c);if(f.length==0){n.offset(c.p.x-d.p.x,c.p.y-d.p.y)}else{if(f.length==1){n.offset(c.p.x-d.p.x,c.p.y-d.p.y);b=f[0];var h=b.otherAtom(c).p.angleTo(c.p);var g=n.getNeighborBonds(d);if(g.length==1){n.rotate(c.p,h+60-d.p.angleTo(g[0].otherAtom(d).p))}else{if(g.length==2){n.rotate(c.p,h+180-d.p.middleAngle(g[0].otherAtom(d).p,g[1].otherAtom(d).p))}}}else{if(f.length==2){n.offset(c.p.x-d.p.x,c.p.y-d.p.y);var h=c.p.middleAngle(f[0].otherAtom(c).p,f[1].otherAtom(c).p);var g=n.getNeighborBonds(d);if(g.length==1){n.rotate(c.p,h+60-d.p.angleTo(g[0].otherAtom(d).p))}else{if(g.length==2){n.rotate(c.p,h+180-d.p.middleAngle(g[0].otherAtom(d).p,g[1].otherAtom(d).p))}}}else{return false}}}return true}};JSDraw2.FormulaStats=scil.extend(scil._base,{constructor:function(){this.elements={};this.charges=0;this.isotopes={};this.bios=[]},add:function(c,d){if(this.elements[c]==null){this.elements[c]=d}else{this.elements[c]+=d}if(this.elements[c]==0){delete this.elements[c]}},mergeFrom:function(g,d){if(g==null){return}if(d==null){d=1}for(var f in g.elements){if(this.elements[f]==null){this.elements[f]=g.elements[f]*d}else{this.elements[f]+=g.elements[f]*d}}for(var f in g.isotopes){if(this.isotopes[f]==null){this.isotopes[f]={}}var j=this.isotopes[f];var l=g.isotopes[f];for(var h in l){if(j[h]==null){j[h]=l[h]*d}else{j[h]+=l[h]*d}}}if(g.charges!=null){if(g.issalt){var c=d*g.charges;if(c>0){if(this.charges<0){var n=Math.min(-this.charges,c);this.charges+=n;c-=n}if(this.elements.H>=c){this.elements.H-=c;g.charges=0}}else{if(c<0){if(this.charges>0){var n=Math.min(this.charges,-c);this.charges-=n;c+=n}if(this.elements.H==null){this.elements.H=0}this.elements.H-=c;g.charges=0}}}else{this.charges+=g.charges*d}}}});scil.apply(JSDraw2.FormulaStats,{kHandleProton:true,calcMWMF:function(f,j,l){var c=false;var g=f.expandSuperAtoms();for(var d=0;d<g.atoms.length;++d){if(scil.helm.isHelmNode(g.atoms[d])){c=true;break}}var n;if(c){n=scil.helm.Formula.getAtomStats(g)}else{n=JSDraw2.FormulaParser.getAtomStats(g)}var h=null;h=JSDraw2.FormulaParser.parseSalt(j);if(h!=null&&h.stats!=null){if(scil.Utils.isNullOrEmpty(l)){l=h.coef}n.mergeFrom(h.stats,l>1?l:1)}return{mw:JSDraw2.FormulaParser.stats2mw(n),mf:JSDraw2.FormulaParser.stats2mf(n)}}});JSDraw2.FormulaParser={parse:function(q,l,g){if(scil.Utils.isNullOrEmpty(q)){return null}var t=null;var n=q.indexOf(".");if(n>0){t=q.substr(n+1);q=q.substr(0,n)}var h=this._parse(q,l,g);if(h==null&&l){h=this.pareFormulaAsSalt(q)}if(h==null||h.atoms.length==0){return null}if(!scil.Utils.isNullOrEmpty(t)){var j=this.pareFormulaAsSalt(t);if(j==null||j.atoms.length==0){return null}var c=h.atoms[h.atoms.length-1];var d=j.atoms[0];h.mergeMol(j);var f=new JSDraw2.Bond(c,d);f.type=JSDraw2.BONDTYPES.DUMMY;h.addBond(f)}JSDraw2.SuperAtoms.normalize(h);return h},pareFormulaAsSalt:function(x){if(scil.Utils.isNullOrEmpty(x)){return null}var j=1;var w=x.replace(/^[0-9]+/,"");if(w.length<x.length){j=parseInt(x.substr(0,x.length-w.length));x=w}if(j<1){return null}var q=null;var y=x.replace(/[+|-][1-9]?$/,"");var h=this.parseCharge(x.substr(y.length));x=y;var l=x.replace(/[H][0-9]{0,10}/g,"");q=this.molFromAtom(l,false,h);if(q==null){var w=x.replace(/^[A-Z][a-z]?/,"");if(w.length<x.length){l=x.substr(0,x.length-w.length);q=this._parse(w);if(q==null){return null}var f=JSDraw2.SuperAtoms._getAttachAtoms(q);if(f==null||f.length!=1){return null}var c=f[0].a;c.attachpoints=[];if(l!="H"){var d=new JSDraw2.Atom(f[0].a.p.clone(),l);var g=new JSDraw2.Bond(c,d);q.addAtom(d);q.addBond(g)}}}if(q==null||q.atoms.length==0){return null}var t=q.clone();for(var n=1;n<j;++n){var c=q.atoms[q.atoms.length-1];var u=t.clone();var d=u.atoms[0];q.mergeMol(u);var g=new JSDraw2.Bond(c,d);g.type=JSDraw2.BONDTYPES.DUMMY;q.addBond(g)}return q},parseSalt:function(j){if(scil.Utils.isNullOrEmpty(j)){return null}var c=j;var n=JSDraw2.defaultoptions.salts||JSDraw2.salts;if(n!=null&&n[c]!=null){if(n[c]==""){return{coef:1,mf:null,mw:0,s:j}}}var l="";if(!JSDraw2.FormulaParser.ignoresaltcoef){var h=/^[0-9]{0,10}[\.]?[0-9]{0,9}[ ]?/;var l=h.exec(j)+"";if(l.length==j.length){return null}}var d=1;if(l!=""){d=parseFloat(l);if(isNaN(d)){d=1}}j=j.substr(l.length);c=j;var f=null;var g=null;var n=JSDraw2.defaultoptions.salts||JSDraw2.salts;if(n!=null&&n[c]!=null){f=n[c];g=this.mf2mw(f,true)}else{f=j;g=this.mf2mw(f,true);if(g==null||g==0){return null}}return{coef:d,mf:d==1?f:d+"("+f+")",mw:Math.round(g*(d>0?d:1)*1000)/1000,s:d==1?j:d+j,stats:this.mf2Stats(f,true)}},parseCharge:function(c){if(c!=null){c=scil.Utils.trim(c)}if(scil.Utils.isNullOrEmpty(c)){return 0}if(c=="+"||c=="++"||c=="+++"){return c.length}else{if(c=="-"||c=="--"||c=="---"){return -c.length}}if(c.length>1&&(c.substr(c.length-1)=="+"||c.substr(c.length-1)=="-")){c=c.substr(c.length-1)+c.substr(0,c.length-1)}return parseInt(c)},stripHs:function(g){if(g==null||g.length<=1){return g}var h=g.replace(/[+|-][1-9]?$/,"");var c=g.substr(h.length);if(/^[A-Z][a-z]?[H][0-9]{0,2}$/.test(h)){var f=/^[A-z][a-z]?/.exec(g);var d=JSDraw2.PT[f];if(d!=null&&d.m!=null){return f+c}}else{if(/^[H][0-9]{0,2}[A-Z][a-z]?$/.test(h)){var f=/[A-z][a-z]?$/.exec(g);var d=JSDraw2.PT[f];if(d!=null&&d.m!=null){return f+c}}}return g},getAtomStats:function(t){if(t==null){return null}var y=new JSDraw2.FormulaStats();var g=0;var u=0;for(var h=0;h<t.atoms.length;++h){var c=t.atoms[h];if(c.elem=="5'"){if(y.elements.H==null){y.elements.H=1}else{++y.elements.H}}else{if(c.elem=="3'"){if(y.elements.H==null){y.elements.H=1}else{++y.elements.H}if(y.elements.O==null){y.elements.O=1}else{++y.elements.O}}else{if(c.bio!=null){switch(c.bio.type){case JSDraw2.BIO.ANTIBODY:case JSDraw2.BIO.PROTEIN:case JSDraw2.BIO.GENE:case JSDraw2.BIO.DNA:case JSDraw2.BIO.RNA:var A=new JSDraw2.SequenceEditor();A.setXml(c.bio.sequences);y.bios.push({mw:A.getMolWeight()});break}}else{if(c.elem=="@"){var q=t.getAllBonds(c);var d=0;var B=0;for(var l=0;l<q.length;++l){if(q[l].type==JSDraw2.BONDTYPES.DUMMY){++d}else{var C=q[l].valence();if(C>0){B+=Math.floor(C)}}}if(d>0){u+=B}}else{if(c.elem=="#"){var z=this.parseSalt(c.alias);if(z!=null){y.mergeFrom(z.stats,z.coef)}}else{var f=c.elem;var x=c.__repeat>0?c.__repeat:1;if(c.isotope>0){var w=y.isotopes[f];if(w==null){y.isotopes[f]={}}var j=y.isotopes[f];if(j[c.isotope]==null){j[c.isotope]=x}else{j[c.isotope]=j[c.isotope]+x}}else{var w=y.elements[f];if(w==null){y.elements[f]=x}else{y.elements[f]=w+x}}g+=c.hcount}}}}}y.charges+=c.charge}g-=u;if(g>0){if(y.elements.H!=null){y.elements.H=g+y.elements.H}else{y.elements.H=g}}return y},stats2mw:function(g){if(g==null){return null}var h=0;for(var f in g.elements){if(f=="D"){h+=JSDraw2.PT.H.iso[2]*g.elements[f]}else{if(f=="T"){h+=JSDraw2.PT.H.iso[3]*g.elements[f]}else{var c=JSDraw2.PT[f];if(c==null||c.m==null){return null}h+=c.m*g.elements[f]}}}if(g.bios!=null){for(var d=0;d<g.bios.length;++d){h+=g.bios[d].mw}}h+=this._isotopemass(g.isotopes);if(h>0){h=scil.Utils.round(h,4)}return h},stats2em:function(f){if(f==null){return null}var g=0;for(var d in f.elements){var c=JSDraw2.PT[d];if(c==null||c.em==null){return null}g+=c.em*f.elements[d]}g+=this._isotopemass(f.isotopes);return g},_isotopemass:function(g){if(g==null){return 0}var l=0;for(var h in g){var c=JSDraw2.PT[h];if(c==null||c.m==null){continue}var f=g[h];for(var d in f){var j=c.iso[d];l+=(j==null?c.m:j)*f[d]}}return l},stats2mf:function(q,g){if(q==null){return}var n="";if(q.elements.C!=null){n+="C";if(q.elements.C>1){n+=(g?"<sub>"+q.elements.C+"</sub>":q.elements.C)}}if(q.elements.H!=null){n+="H";if(q.elements.H>1){n+=(g?"<sub>"+q.elements.H+"</sub>":q.elements.H)}}for(var f in q.elements){if(f!="C"&&f!="H"&&f!="R"){n+=f;if(q.elements[f]>1){n+=(g?"<sub>"+q.elements[f]+"</sub>":q.elements[f])}}}for(var f in q.isotopes){var j=q.isotopes[f];for(var h in j){if(f=="H"&&h==2){n+="D"}else{if(f=="H"&&h==3){n+="T"}else{if(g){n+="<sup>"+h+"</sup>"+f}else{n+="{"+h+"}"+f}}}if(j[h]>1){n+=(g?"<sub>"+j[h]+"</sub>":j[h])}}}var l=q.elements.R;if(l>0){n+="R";if(l>1){n+=(g?"<sub>"+l+"</sub>":l)}}if(q.charges>0||q.charges<0){var d=Math.abs(q.charges);var u=(q.charges>0?"+":"-")+(d>1?d:"");if(g){n+="<sup>"+u+"</sup>"}else{n+=u}}return n},mf2mw:function(d,c){var f=this.mf2Stats(d,c);return this.stats2mw(f)},normMF:function(d,c){var f=this.mf2Stats(d);return this.stats2mf(f,c)},mf2Stats:function(f,d){if(f==null||f==""){return null}var c=0;var g=f.replace(/(([+|-][0-9]{0,2})|([ ][0-9]{0,2}[+|-]))$/,"");if(g.length<f.length){c=this.parseCharge(f.substr(g.length))}var h=this.mf2Stats2(g);if(h!=null&&c!=0){if(d){h.issalt=true}h.charges+=c}return h},calcSaltCharges:function(d,c){if(JSDraw2.defaultoptions.calcsaltcharges!=true){return c}if(c>0||c<0){if(d.elements.H==null){d.elements.H=0}d.elements.H-=c;c=0}return c},mf2Stats2:function(y){var q=JSDraw2.SuperAtoms.get(y);if(q!=null){return this.getAtomStats(q)}var x=new JSDraw2.FormulaStats();var u=/^[0-9]+/;var B=0;var w;while((w=y.indexOf("("))>=0){if(w>0){var z=this._mf2Stats(y.substr(0,w));if(z==null){return null}x.mergeFrom(z)}y=y.substr(w);var h=false;var t=0;for(var j=1;j<y.length;++j){var g=y.charCodeAt(j);if(g==40){++t}else{if(g==41){if(t==0){var d=y.substr(1,j-1);y=y.substr(j+1);var A=y.match(u);var l=1;if(A!=null&&A.length==1){y=y.substr(A[0].length);l=parseInt(A[0])}var z=this.mf2Stats2(d);if(z==null){return null}x.mergeFrom(z,l);h=true;break}else{--t}}}}if(!h){return null}}var z=this._mf2Stats(y);if(z==null){return null}x.mergeFrom(z);return x},_mf2Stats:function(y){var q=/^([{][0-9]+[}])?[A-Z][a-z]?[0-9]{0,9}/;var u=/^[A-Z][a-z]?/;var w=/^[{][0-9]+[}]/;var x=new JSDraw2.FormulaStats();while(y!=""){var d=q.exec(y);if(d==null){return null}var z=d[0];if(z==""){return null}y=y.substr(z.length);var h=null;var g=w.exec(z);if(g!=null){var C=g[0];z=z.substr(C.length);h=parseInt(C.substr(1,C.length-2))}var B=u.exec(z)[0];if(B=="D"){B="H";h=2}else{if(B=="T"){B="H";h=3}}var f=JSDraw2.PT[B];var l=B.length==z.length?1:parseInt(z.substr(B.length));var A=new JSDraw2.FormulaStats();if(f==null){var j=JSDraw2.SuperAtoms.get(B);if(j==null||!(j.mw>0)){return null}A=this.getAtomStats(j)}else{if(!(f.m>null)){return null}else{if(h>0){A.isotopes[B]={};A.isotopes[B][h]=1}else{A.elements[B]=1}}}x.mergeFrom(A,l)}return x},molFromAtom:function(h,d,f){var j=h.replace(/[+|-][1-9]?$/,"");if(j.length<h.length){f=this.parseCharge(h.substr(j.length));h=j}var g=JSDraw2.PT[h];if(g!=null&&g.a>0){m=new JSDraw2.Mol();var c=new JSDraw2.Atom(new JSDraw2.Point(0,0),h);if(f!=null){c.charge=f}m.addAtom(c);if(d){c.attachpoints=[1]}return m}return null},_parse:function(E,z,h){if(scil.Utils.isNullOrEmpty(E)){return null}if(new RegExp("^[(][^()]+[)]$").test(E)){E=E.substr(1,E.length-2)}var G=this.stripHs(E);var x=this.molFromAtom(G,true);if(x!=null){return x}var I={O:["O"],S:["S"],Se:["Se"],Te:["Te"],Y:["Y"],NH:["N"],PH:["P"],CO:["C","^=O"],CO2:["C","^=O","O"],CH2:["C"],C2H4:["C","C"],C3H6:["C","C","C"],C4H8:["C","C","C","C"],C5H10:["C","C","C","C","C"]};if(z){I.H=[]}if(scil.Utils.startswith(E,"(")){var A=E.indexOf(")");if(A>0){var F=E.substr(1,A-1);var H=E.substr(A+1);var G=H.replace(/^[0-9]+/,"");var C=1;if(G.length<H.length){C=parseInt(H.substr(0,H.length-G.length))}var D=this._parseConnectors(F,z);if(D!=null&&D.remained==""){var f=[];for(var u=0;u<C;++u){f=f.concat(D.atoms)}x=this._connect(f,G);if(x!=null){return x}}}}x=JSDraw2.SuperAtoms.get(E);if(x!=null){return x}x=this.molFromAtom(E,true);if(x!=null){return x}for(var w in I){var x=this._tryFormula(w,I[w],E);if(x!=null){return x}}if(E.length>=3){var n=E.substr(0,2);var l=JSDraw2.PT[n];if(l!=null&&JSDraw2.PT.isMetal(l.a)&&(l!=JSDraw2.PT.K&&l!=JSDraw2.PT.Na&&l!=JSDraw2.PT.Rb&&l!=JSDraw2.PT.Cs&&l!=JSDraw2.PT.Fr&&l!=JSDraw2.PT.Sb)){return this._tryFormula(n,[n],E)}}if(h==1||h==2){var B=/^C[0-9]+H[0-9]+$/;if(B.test(E)){var A=E.indexOf("H");var j=parseInt(E.substr(1,A-1));var q=parseInt(E.substr(A+1));if(j>0&&(h==2&&j*2==q||h==1&&(j*2+1==q||j*2-1==q||j*2-3==q))){var x=new JSDraw2.Mol();var c=new JSDraw2.Atom(new JSDraw2.Point(0,0),"C");var d=null;c.attachpoints=[1];x.addAtom(c);for(var u=1;u<j;++u){var J=u%2==1?0.5:0;d=new JSDraw2.Atom(new JSDraw2.Point(c.p.x+1,J),"C");x.addAtom(d);var g=new JSDraw2.Bond(c,d);if(u==j-1){if(j*2-1==q){g.type=JSDraw2.BONDTYPES.DOUBLE}else{if(j*2-3==q){g.type=JSDraw2.BONDTYPES.TRIPLE}}}x.addBond(g);c=d}if(h==2){(d==null?c:d).attachpoints=[2]}return x}}}return null},_parseConnectors:function(h,g){var j={O:["O"],S:["S"],Se:["Se"],Te:["Te"],Y:["Y"],NH:["N"],PH:["P"],CO:["C","=O"],CO2:["C","=O","O"],CH2:["C"],C2H4:["C","C"],C3H6:["C","C","C"],C4H8:["C","C","C","C"],C5H10:["C","C","C","C","C"]};if(g){j.H=[]}var c=[];while(h.length>0){var d=false;for(var f in j){if(scil.Utils.startswith(h,f)){c=c.concat(j[f]);h=h.substr(f.length);d=true;break}}if(!d){break}}return c.length==0?null:{atoms:c,remained:h}},_tryFormula:function(d,c,f){if(!scil.Utils.startswith(f,d,true)){return null}return this._connect(c,f.substr(d.length))},_connect:function(g,t){var q=JSDraw2.SuperAtoms.get(t);if(q==null){q=this._parse(t,null,1);if(q==null){q=this.molFromAtom(t,false)}}if(q==null){return}q=q.clone();var h=JSDraw2.SuperAtoms._getAttachAtoms(q);if(h==null||h.length!=1){return null}var d=h[0].a;var f=null;var j=null;d.attachpoints=[];for(var n=g.length-1;n>=0;--n){var l=g[n];if(l.substr(0,1)=="^"){j=l.substr(1);continue}d=this._connectAtom(d,l,q);if(j!=null){this._connectAtom(d,j,q);j=null}}d.attachpoints=[1];return q},_connectAtom:function(d,h,l){var j=false;if(h.substr(0,1)=="="){h=h.substr(1);j=true}var n=d.p.clone();n.offset(1,0);var f=new JSDraw2.Atom(n,h);var g=new JSDraw2.Bond(d,f);if(j){g.type=JSDraw2.BONDTYPES.DOUBLE}l.addAtom(f);l.addBond(g);return f}};JSDraw2.Toolbar=scil.extend(scil._base,{constructor:function(c){this.toolbar=null;this.editor=c;this.options=c.options;this.toptoolbarTbody=null;this.BORDERSTYLE="solid 1px #ccc";this.toolbarbkcolor="#fcfcfc"},destroy:function(){},getButtons:function(){return this.toolbar.getElementsByTagName("img")},show:function(c){this.toolbarrow.style.display=c?"":"none"},createToolbars:function(g){var h=["H","C","N","O","S","P","F","Cl","Br","..."];if(this.options.query){h.push("&#9679;")}var u={border:this.BORDERSTYLE,background:JSDraw2.Skin.jsdraw.bkcolor};var n=this.editor;var l=scil.Utils.createTable(null,0,0,u);this.toolbar=l;dojo.connect(l.parentNode,"onclick",function(d){n.onSelBtn(d==null?window.event:d);d.preventDefault()});scil.Utils.unselectable(l.parentNode);var c=JSDraw2.Skin.jsdraw.bkcolor;if(this.options.skin=="si"){c+=" url("+JSDraw2.Skin.jsdraw.toolbarbk+") repeat-x "}else{if(JSDraw2.Skin.jsdraw.bkimg!=null){c+=" url("+JSDraw2.Skin.jsdraw.bkimg+") repeat-x "}}var x=scilligence.Utils.createElement(l,"tr",null,{background:c});this.toolbarrow=x;var t=scilligence.Utils.imgTag("jsdraw.gif",null,"title='"+this.res("About JSDraw")+"' style='width:"+this.options.btnsize+"px;height:"+this.options.btnsize+"px;' cmd='jsdraw'");if(!this.isSkinW8()){scilligence.Utils.createElement(x,"td",t,{paddingLeft:"3px"})}var w=scilligence.Utils.createTable(scilligence.Utils.createElement(x,"td"),0,0,{marginTop:(this.options.skin=="si"?"8px":"2px"),marginBottom:"1px"});if(scilligence.Utils.isTouch&&!scilligence.Utils.isIE){dojo.connect(w.parentNode,"ontouchmove",function(d){d.preventDefault()})}if(this.isSkinW8()){w.parentNode.align=this.options.toolbaralign==null?"center":this.options.toolbaralign;if(this.options.toolbarleftmargin!=null){w.parentNode.style.marginLeft=this.options.toolbarleftmargin}}this.toptoolbarTbody=w;this.recreateTopToolbar();x=scilligence.Utils.createElement(l,"tr");if(!this.isSkinW8()){td=scilligence.Utils.createElement(x,"td",null,{verticalAlign:"top",backgroundPosition:"left"});w=scilligence.Utils.createTable(td,1,null,{color:"#000"});var u={width:this.options.btnsize+"px",height:this.options.btnsize+"px",fontWeight:"bold",cursor:"default",textAlign:"center",verticalAlign:"middle",padding:"2px"};if(this.options.scale!=1){u.fontSize=(this.options.scale*100)+"%"}for(var j=0;j<h.length;++j){var q=scilligence.Utils.createElement(w,"tr");var f=scilligence.Utils.createElement(q,"td",h[j],u,{cmd:h[j]});if(h[j]=="..."){f.setAttribute("title",this.res("Element Periodic Table"))}else{if(h[j]=="&#9679;"){f.setAttribute("title",this.res("Atom Properties"))}}this.editor.connectHandlers.push(dojo.connect(f,"onmouseover",function(){this.style.backgroundColor=JSDraw2.Skin.jsdraw.hovercolor}));this.editor.connectHandlers.push(dojo.connect(f,"onmouseout",function(){this.style.backgroundColor=""}))}}td=scilligence.Utils.createElement(x,"td",null,{borderTop:this.BORDERSTYLE,borderLeft:this.BORDERSTYLE});if(this.isSkinW8()){td.colSpan=2;td.style.borderLeft=""}g.parentNode.insertBefore(l.parentNode,g);td.appendChild(g);g.style.border="";this.editor.maintable=l.parentNode},_makePluginFun:function(c){var d=this.editor;return function(f){c(d);(f.srcElement||f.target).setAttribute("jsdrawactivate","false");f.preventDefault()}},recreateTopToolbar:function(){var z=this.editor.dimension.x;var t=this.toptoolbarTbody;var d=this.createButtons(z);var g="__jsd_tb_"+this.editor.id;var h=this;scilligence.Utils.removeAll(t);var u=scilligence.Utils.createElement(t,"tr");var x=null;if(this.isSkinW8()){x=scilligence.Utils.createElement(t,"tr",null,{height:"6px",fontsize:"1px"})}for(var f=0;f<d.length;++f){var c=d[f];this.createButton(u,x,c,g)}var q=JSDraw2.defaultoptions.plugins;if(this.options.plugins!=null){if(q==null){q=this.options.plugins}else{q=q.concat(this.options.plugins)}}if(q!=null){var y=Math.round(2*this.options.btnsize/20);var j=0;var l=0;for(var f=0;f<q.length;++f){var n=q[f];if(n.location=="left"){if(j++==0){td=scilligence.Utils.createElement(null,"td","<img src='"+scil.Utils.imgSrc("img/sep.gif")+"' alt='separator' style='margin:0 "+y+"px 0 "+y+"px;'>");u.insertBefore(td,u.firstChild);x.insertBefore(scilligence.Utils.createElement(null,"td"),x.firstChild)}td=scilligence.Utils.createElement(null,"td");u.insertBefore(td,u.firstChild);x.insertBefore(scilligence.Utils.createElement(null,"td"),x.firstChild)}else{if(j++==0){td=scilligence.Utils.createElement(u,"td","<img src='"+scil.Utils.imgSrc("img/sep.gif")+"' alt='separator' style='margin:0 "+y+"px 0 "+y+"px;'>");scilligence.Utils.createElement(x,"td")}td=scilligence.Utils.createElement(u,"td");scilligence.Utils.createElement(x,"td")}this.createBtnImg(td,q[f].iconurl,null,null,q[f].tooltips,null,q[f].width,q[f].label);this.editor.connectHandlers.push(dojo.connect(td,"onclick",this._makePluginFun(q[f].onclick)))}}},createButtons:function(z){var g=[];var f=[{c:"triple",t:"Triple bond",label:"Triple"},{c:"up",t:"Wedge bond",label:"Up"},{c:"down",t:"Hash bond",label:"Down"},{c:"wiggly",t:"Wiggle bond",label:"Wiggle"},{c:"delocalized",t:"Delocalized bond",label:"Delocalized"},{c:"either",t:"Either double bond",label:"Either"},{c:"boldhash",t:"Hashed bond",label:"Hashed"},{c:"bold",t:"Bold bond",label:"Bold"},{c:"dummy",t:"Ionic bond",label:"Ionic"},{c:"unknown",t:"Dotted bond",label:"Dotted"}];if(this.options.query){f.concat([{c:"singledouble",t:"Single or Double",label:"Single"},{c:"singlearomatic",t:"Single or Aromatic"},{c:"doublearomatic",t:"Double or Aromatic"}])}var x=this.isSkinW8()&&z<=400;var l=[];if(this.options.showfilemenu!=false){l.push({c:"save",t:"Export",label:"Export"});l.push({c:"open",t:"Import",label:"Import"})}var w=[{c:"lasso",t:"Lasso Selection",label:"Lasso"},{c:"selfrag",t:"Select Fragment",label:"Fragment"},{c:"selectall",t:"Select All",label:"All"}];var d=false;if(this.options.toolbarmode=="tlc"){g.push({c:"new",t:"New",label:"New",sub:l});g.push({c:"tlctemplate",t:"Template",label:"Template"});g.push({c:"|"});g.push({c:"spot-circle",t:"Circle Spot",label:"Circle",sub:[{c:"spot-hellipse",t:"Horizontal Ellipse Spot",label:"Ellipse"},{c:"spot-vellipse",t:"Vertical Ellipse Spot",label:"Ellipse"},{c:"spot-halfellipseup",t:"Half-Ellipse Spot",label:"Ellipse"},{c:"spot-halfellipsedown",t:"Half-Ellipse Spot",label:"Ellipse"},{c:"spot-blowingup",t:"Blowing-up Spot",label:"Blowing"},{c:"spot-blowingdown",t:"Blowing-down Spot",label:"Blowing"},{c:"spot-crescentup",t:"Crescent Spot",label:"Crescent"},{c:"spot-crescentdown",t:"Crescent Spot",label:"Crescent"}]});g.push({c:"eraser",t:"Eraser",label:"Eraser"});g.push({c:"|"});g.push({c:"tlc",t:"TLC Plate",label:"TLC"});g.push({c:"tlcnumber",t:"Number Plate",label:"Number"});g.push({c:"electrophoresis",t:"Electrophoresis Gel Plate",label:"Electrophoresis"});g.push({c:"|"});g.push({c:"text",t:"Text/Atom Label",label:"Text"});g.push({c:"|"});g.push({c:"undo",t:"Undo",label:"Undo"});g.push({c:"redo",t:"Redo",label:"Redo"});g.push({c:"|"});g.push({c:"center",t:"Move to center",label:"Center"});g.push({c:"zoomin",t:"Zoom in",label:"Zoom"});g.push({c:"zoomout",t:"Zoom out",label:"Zoom"});d=true}else{if(this.options.toolbarmode=="spectrum"){g.push({c:"new",t:"New",label:"New",sub:l});g.push({c:"|"});g.push({c:"assaycurve",t:"Assay Curve",label:"Assay"});g.push({c:"spectrum",t:"Spectrum",label:"Spectrum"});g.push({c:"|"});g.push({c:"eraser",t:"Eraser",label:"Eraser"});g.push({c:"|"});g.push({c:"select",t:"Box Selection",label:"Box",sub:w});g.push({c:"|"});g.push({c:"undo",t:"Undo",label:"Undo"});g.push({c:"redo",t:"Redo",label:"Redo"});g.push({c:"|"});g.push({c:"center",t:"Move to center",label:"Center"});g.push({c:"zoomin",t:"Zoom in",label:"Zoom"});g.push({c:"zoomout",t:"Zoom out",label:"Zoom"});d=true}else{if(this.options.toolbarmode=="workflow"){g.push({c:"new",t:"New",label:"New",sub:l});g.push({c:"|"});g.push({c:"select",t:"Box Selection",label:"Box",sub:w});g.push({c:"moveview",t:"Move/View",label:"Move"});g.push({c:"zoombox",t:"Zoom Box",label:"Zoom"});g.push({c:"|"});g.push({c:"rectangle",t:"Rectangle",label:"Rectangle"});g.push({c:"diamond",t:"Diamond",label:"Diamond"});g.push({c:"ellipse",t:"Ellipse",label:"Ellipse"});g.push({c:"dreversed",t:"D Reversed",label:"D Reversed"});g.push({c:"dshape",t:"D Shapre",label:"D Shapre"});g.push({c:"|"});g.push({c:"arrow",t:"Reaction arrow",label:"Reaction"});g.push({c:"text",t:"Text/Atom Label",label:"Text"});g.push({c:"|"});g.push({c:"eraser",t:"Eraser",label:"Eraser"});g.push({c:"|"});g.push({c:"undo",t:"Undo",label:"Undo"});g.push({c:"redo",t:"Redo",label:"Redo"});g.push({c:"|"});g.push({c:"center",t:"Move to center",label:"Center"});g.push({c:"zoomin",t:"Zoom in",label:"Zoom"});g.push({c:"zoomout",t:"Zoom out",label:"Zoom"});d=true}else{if(this.options.toolbarmode=="helm"){scil.helm.Interface.getHelmToolbar(g,l,w,this.options);if(this.options.showabout!=false){d=true}}else{if(this.options.pastechemdraw){l.push({c:"pastechemdraw",t:"Paste ChemDraw, ISIS/Draw...",label:"Paste"});l.push({c:"copychemdraw",t:"Copy ChemDraw, ISIS/Draw, Word...",label:"Copy"})}if(this.isSkinW8()){l.push({c:"about",t:"About JSDraw",label:"About"});g.push({c:"new",t:"New",label:"New",sub:l})}else{g.push({c:"new",t:"New",sub:l,label:"New"})}if(scilligence.Utils.serviceAvailable()){g.push({c:"n2s",t:"Name to Structure",label:"N2S",sub:[{c:"cleanup",t:"Clean up",label:"Clean"}]});if(this.options.scifinder!=false&&scil.SciFinder.enabled){g.push({c:"scifinder",t:"Search SciFinder",label:"SciFinder"})}}if(g.length>0){g.push({c:"|"})}if(!this.options.appmode){w.push({c:"copy",t:"Copy",label:"Copy"});w.push({c:"cut",t:"Cut",label:"Cut"});w.push({c:"paste",t:"Paste",label:"Paste"})}g.push({c:"select",t:"Box Selection",label:"Box",sub:w});g.push({c:"center",t:"Move to center",label:"Center",sub:x?null:[{c:"zoomin",t:"Zoom in",label:"Zoom"},{c:"zoomout",t:"Zoom out",label:"Zoom"},{c:"rotate",t:"Rotate",label:"Rotate"},{c:"fliph",t:"Flip Horizontal",label:"Flip"},{c:"flipv",t:"Flip Vertical",label:"Flip"}]});g.push({c:"moveview",t:"Move/View",label:"Move",sub:[{c:"zoombox",t:"Zoom Box",label:"Zoom"}]});g.push({c:"|"});g.push({c:"eraser",t:"Eraser",label:"Eraser"});if(!this.options.appmode){g.push({c:"undo",t:"Undo",label:"Undo",sub:[{c:"redo",t:"Redo",label:"Redo"}]})}g.push({c:"|"});g.push({c:"single",t:"Single bond",label:"Single"});g.push({c:"double",t:"Double bond",label:"Double",sub:f});g.push({c:"chain",t:"Chain Tool",label:"Chain"});g.push({c:"|"});var n=0;var t=null;JSDraw2.SuperAtoms.read();var y={benzene:1,hexane:1,pentane:1,propane:1,butane:1,heptane:1,octane:1};for(var q in JSDraw2.SuperAtoms.templates){++n;var u=q;var h=y[q.toLowerCase()]?q.toLowerCase():"template";if(n<=3){t={c:h,cmd:"template."+q,label:u,t:u};g.push(t)}else{if(t.sub==null){t.sub=[]}t.sub.push({c:h,cmd:"template."+q,label:u,t:u})}}if(JSDraw2.SuperAtoms.hasCustomTemplates()&&this.options.showcustomtemplates!=false){t.sub.push({c:"templates",cmd:"template.[custom]",label:"Templates",t:"Custom Templates"})}g.push({c:"|"});if(this.isSkinW8()){var j=[{c:"e-H",t:"Element H",label:"Hydrogen"},{c:"e-O",t:"Element O",label:"Oxygen"},{c:"e-N",t:"Element N",label:"Nitrogen"},{c:"e-S",t:"Element S",label:"Sulfur"},{c:"e-P",t:"Element P",label:"Phosphorus"},{c:"e-F",t:"Element F",label:"Fluorine"},{c:"e-Cl",t:"Element Cl",label:"Chlorine"},{c:"e-Br",t:"Element Br",label:"Bromine"},{c:"e-more",t:"Element Periodic Table",label:"P.T."}];g.push({c:"e-C",t:"Element C",label:"Carbon",sub:j})}g.push({c:"text",t:"Text/Atom Label",label:"Text",sub:x?null:[{c:"sgroup",t:"SGroup - Tag Atom/Bond/Bracket",label:"SGroup"},{c:"bracket",t:"Bracket",label:"Bracket"},{c:"symbol",t:"Symbol",label:"Symbol"}]});g.push({c:"rectangle",t:"Rectangle",label:"Rectangle",sub:[{c:"diamond",t:"Diamond",label:"Diamond"},{c:"ellipse",t:"Ellipse",label:"Ellipse"},{c:"dreversed",t:"D Reversed",label:"D Reversed"},{c:"dshape",t:"D Shapre",label:"D Shapre"},{c:"curve",t:"Curve",label:"Curve"},{c:"tlc",t:"TLC Plate",label:"TLC"},{c:"tlctemplate",t:"Template",label:"Template"},{c:"electrophoresis",t:"Electrophoresis Gel Plate",label:"Electrophoresis"},{c:"assaycurve",t:"Assay Curve",label:"Assay"},{c:"spectrum",t:"Spectrum",label:"Spectrum"}]});g.push({c:"chargep",t:"Increase charges",label:"Charge",sub:[{c:"chargen",t:"Descrease charges",label:"Charge"}]});if(this.options.rxn!=false){g.push({c:"|"});g.push({c:"arrow",t:"Reaction arrow",label:"Reaction",sub:[{c:"plus",t:"Reaction Plus",label:"Plus"},{c:"rxn",t:"Clean up reaction",label:"Clean"},{c:"copyprod",t:"Copy reactants to products",label:"R->P"},{c:"rxnmap",t:"Map reaction",label:"Map"},{c:"rxnmap2",t:"Clear reaction map",label:"Clear"}]})}if(this.options.biology){if(this.editor.helm!=null){scil.helm.Interface.addToolbar(g,null,null,this.options)}}if(this.isSkinW8()&&this.options.inktools&&!x){g.push({c:"|"});g.push({c:"inkred",t:"Ink - Red",label:"Ink",sub:[{c:"inkblue",t:"Ink - Blue",label:"Ink"},{c:"inkgreen",t:"Ink - Green",label:"Ink"},{c:"inkclear",t:"Clear Ink",label:"Clear1"},{c:"inkclearall",t:"Clear All Inks",label:"Clear"}]})}if(this.options.usechemdraw){g.push({c:"chemdraw",t:"ChemDraw Editor",label:"ChemDraw"})}}}}}if(JSDraw2.Fullscreen!=null){if(this.options.exitfullscreen){g.push({c:"|"});g.push({c:"fullscreen2",t:"Regular Size",label:"Fullscreen"})}else{if(this.options.fullscreen){g.push({c:"|"});g.push({c:"fullscreen",t:"Fullscreen Size",label:"Fullscreen"})}}}if(d){g.push({c:"|"});g.push({c:"about",t:"About JSDraw",label:"About"})}if(this.isSkinW8()){this.relayoutButtonsByWidth(g,z,this.options.plugins==null?0:this.options.plugins.length)}return g},relayoutButtonsByWidth:function(c,x,q){var l=Math.round(x/(this.options.skin=="w8"?50:60))-c.length-q;if(l<0&&l<-8){for(var d=c.length-1;d>=0;--d){if(c[d].c=="|"){c.splice(d,1)}}l=Math.round(x/(this.options.skin=="w8"?50:60))-c.length-q}if(l==0){return}if(l>0){for(var d=0;d<c.length;++d){if(c[d].c=="ring5"){var w=c[d].sub;for(var f=0;f<l;++f){c.splice(d+f+1,0,w[0]);w.splice(0,1);c[d+f].sub=null;if(w.length==0){break}else{c[d+f+1].sub=w}}break}}}else{if(l<0){l=-l;var u;if(this.options.toolbarmode=="workflow"){u=["zoomout","zoombox","redo","zoomin","eraser","moveview"]}else{if(this.options.toolbarmode=="helm"){u=["zoombox","zoomout","zoomin","redo","eraser"]}else{u=["double","chain","pubchem","pentane","hexane","zoombox","moveview","zoomout","zoomin","redo","n2s","eraser","seq","chemdraw","chargep","rectangle","arrow","text"]}}for(var d=c.length-1;d>0;--d){if(x<500&&c[d].c=="|"){c.splice(d,1);continue}var t=scil.Utils.indexOf(u,c[d].c);if(t>=0&&t+1<=l){while(d>0&&c[d-1].c=="|"){c.splice(d-1,1);--d}if(c[d-1].sub==null){c[d-1].sub=[]}var w=c[d-1].sub;if(this.options.skin=="si"&&w.length>0){w.push("|")}w.push(c[d]);var h=c[d].sub;c[d].sub=null;if(h!=null){for(var g=0;g<h.length;++g){w.push(h[g])}}c.splice(d,1)}}}}},res:function(c){return JSDraw2.Language.res(c)},isSkinW8:function(){return this.options.skin=="w8"||this.options.skin=="si"},setHoverable:function(c){this.editor.connectHandlers.push(dojo.connect(c,"onmouseover",function(){this.style.background=JSDraw2.Skin.jsdraw.hovercolor}));this.editor.connectHandlers.push(dojo.connect(c,"onmouseout",function(){this.style.background=this.getAttribute("pushed")==null?"":JSDraw2.Skin.jsdraw.btnselcolor}))},exchangeButton:function(g,l){if(this.options.skin=="si"){var d=g.childNodes[0];var t=d.nextSibling;var n=l.childNodes[0].getElementsByTagName("td");var f=n[0].childNodes[0];var u=n[1].childNodes[0];var h=d.src;var j=t.innerHTML;var c=dojo.attr(g,"cmd");var q=dojo.attr(g,"title");d.src=f.src;t.innerHTML=u.innerHTML;dojo.attr(g,"cmd",dojo.attr(l,"cmd"));dojo.attr(g,"title",dojo.attr(l,"title"));f.src=h;u.innerHTML=j;dojo.attr(l,"cmd",c);dojo.attr(l,"title",q)}else{var h=g.src;var c=dojo.attr(g,"cmd");var q=dojo.attr(g,"title");var j=g.nextSibling!=null?g.nextSibling.innerHTML:null;g.src=l.src;dojo.attr(g,"cmd",dojo.attr(l,"cmd"));dojo.attr(g,"title",dojo.attr(l,"title"));if(l.nextSibling!=null){g.nextSibling.innerHTML=l.nextSibling.innerHTML}l.src=h;dojo.attr(l,"cmd",c);dojo.attr(l,"title",q);if(l.nextSibling!=null){l.nextSibling.innerHTML=j}}},createButton:function(B,C,c,l){var z;var g;var D=Math.round(2*this.options.btnsize/20);var x=l+"_"+c.c;if(c.c=="|"){z=scilligence.Utils.createElement(B,"td","<img src='"+scil.Utils.imgSrc("img/sep.gif")+"' style='margin:0 "+2*D+"px 0 "+2*D+"px;width:"+D+"px;vertical-align:middle;'>")}else{z=scilligence.Utils.createElement(B,"td");var t=null;if(this.isSkinW8()){t="w8/"+c.c+".png"}else{t="img/"+c.c+".gif"}g=this.createBtnImg(z,(c.img!=null?c.img:scil.Utils.imgSrc(t)),x,c.cmd!=null?c.cmd:c.c,this.res(c.t),null,null,this.res(c.label))}if(c.hidden){z.style.display="none"}if(c.sub==null){if(C!=null){var A=scilligence.Utils.createElement(C,"td");if(c.hidden){A.style.display="none"}}return z}var A;if(this.options.skin=="si"){A=scil.Utils.createElement(g.parentNode.parentNode,"td","&#9660;",{fontSize:"10px",color:"gray",borderTop:"solid 1px #ccc",borderRight:"solid 1px #ccc",borderBottom:"solid 1px #ccc"});this.setHoverable(A)}else{if(C==null){A=scilligence.Utils.createElement(B,"td","&#9660;",{fontSize:(this.options.btnsize/2)+"px",verticalAlign:"bottom",color:"gray"})}else{A=scilligence.Utils.createElement(C,"td",null,{height:"10px",background:scil.Utils.imgSrc("w8/handle.png",true)+" no-repeat center center"})}}if(c.hidden){A.style.display="none"}if(scilligence.Utils.isTouch){dojo.connect(z,"ontouchmove",function(){JSDraw2.Menu.open(x+"_sub",A)});dojo.connect(A,"onclick",function(){JSDraw2.Menu.open(x+"_sub",A)})}else{if(window.navigator.msPointerEnabled){dojo.connect(z,"onMSPointerMove",function(j){if(j.buttons==1){JSDraw2.Menu.open(x+"_sub",A)}},false)}if(this.isSkinW8()){dojo.connect(A,"onclick",function(){JSDraw2.Menu.open(x+"_sub",A)});A.setAttribute("title",this.res("click to expand"));dojo.connect(A,"onmouseover",function(j){(j.target||j.srcElement).style.backgroundImage=scil.Utils.imgSrc("w8/handle2.png",true)});dojo.connect(A,"onmouseout",function(j){(j.target||j.srcElement).style.backgroundImage=scil.Utils.imgSrc("w8/handle.png",true)})}else{dojo.connect(A,"onmouseover",function(){JSDraw2.Menu.open(x+"_sub")});dojo.connect(A,"onmouseout",function(){JSDraw2.Menu.closetime()});dojo.connect(A,"onclick",function(){JSDraw2.Menu.close()})}}var y=scil.Utils.createTable(z,0,0,{display:"none",zIndex:99999999,borderRadius:Math.round((this.options.skin=="si"?3:4)*this.options.btnsize/40)+"px",position:"absolute",backgroundColor:this.options.skin=="si"?this.toolbarbkcolor:JSDraw2.Skin.jsdraw.bkcolor,border:this.BORDERSTYLE,padding:"2px"});var u=y.parentNode;u.id=x+"_sub";u.onmouseover=JSDraw2.Menu.cancelclosetime;u.onmouseout=JSDraw2.Menu.closetime;var f=c.sub;var n=0;var q=this.options.skin!="w8"||f.length<=5;if(!q){n=-(this.options.btnsize/2+4);u.style.marginLeft=n+"px"}if(scilligence.Utils.isIE&&scilligence.Utils.isIE<8&&!this.isSkinW8()){u.style.margin=(this.options.btnsize+4)+"px 0 0 "+(n-this.options.btnsize-2)+"px"}var B=null;for(var h=0;h<f.length;++h){var d=f[h];if(q||h%2==0){B=scilligence.Utils.createElement(y,"tr")}z=scilligence.Utils.createElement(B,"td");if(d=="|"){scil.Utils.createElement(z,"hr",null,{margin:"5px 0 0 0",padding:0});continue}if(h>0&&this.isSkinW8()){z.style.paddingTop=D+"px"}var t=null;if(this.isSkinW8()){t="w8/"+d.c+".png"}else{t="img/"+d.c+".gif"}this.createBtnImg(z,(d.img!=null?d.img:scil.Utils.imgSrc(t)),null,d.cmd!=null?d.cmd:d.c,this.res(d.t),x,null,this.res(d.label),true)}return z},createBtnImg:function(y,l,x,d,B,j,E,g,t){if(E==null){E=this.options.btnsize}var D=Math.round(2*E/20);if(this.options.skin=="si"){if(t){y=scil.Utils.createElement(y,"div",null,{height:"32px"})}var u=scil.Utils.createTable(y,0,0,t?null:{margin:"0 2px 0 2px",backgroundColor:this.toolbarbkcolor});var C=scil.Utils.createElement(u,"tr");var z=scil.Utils.createElement(C,"td",null,t?null:{border:"solid 1px "+JSDraw2.Skin.jsdraw.bkcolor});var A=null;var f=scilligence.Utils.createElement(z,"img",null,{marginTop:"-5px"},{src:l,alt:B});var q={marginTop:"-11px",width:E+"px",fontSize:"9px",textAlign:"center",color:"gray",whiteSpace:"nowrap",overflow:"hidden"};if(t){var A=scil.Utils.createElement(C,"td");if(scil.Utils.isIE&&scil.Utils.isIE<8){q.fontSize=q.marginTop=q.width=null}q.textAlign="left";scil.Utils.createElement(A,"div",g==null||g==""?"&nbsp;":g,q)}else{scil.Utils.createElement(z,"div",g==null||g==""?"&nbsp;":g,q)}this.setHoverable(t?y:z);if(B!=null){(t?y:z).setAttribute("title",B)}if(d!=null){(t?y:z).setAttribute("cmd",d)}if(j!=null){(t?y:z).setAttribute("parent",j)}if(x!=null){(t?y:z).id=x}return f}var n={textAlign:"center",padding:this.isSkinW8()?"2px 2px 0 2px":"2px",verticalAlign:"middle",width:E+"px",height:this.options.btnsize+"px"};var f;if(this.isSkinW8()){var c=this.options.buttonshape+".png";n.background="url("+scil.Utils.imgSrc("w8/"+c)+") center center no-repeat";f=scilligence.Utils.createElement(y,"img",null,n,{src:l,alt:B});scil.Utils.createElement(y,"div",g==null||g==""?"&nbsp;":g,{width:E+"px",fontSize:"9px",textAlign:"center",color:"gray",whiteSpace:"nowrap",overflow:"hidden"})}else{f=scilligence.Utils.createElement(y,"img",null,n,{src:l,alt:B})}if(d!=null){f.setAttribute("cmd",d)}if(B!=null){f.setAttribute("title",B)}if(j!=null){f.setAttribute("parent",j)}if(x!=null){f.id=x}if(this.isSkinW8()){var h=this;this.editor.connectHandlers.push(dojo.connect(f,"onmouseover",function(){this.style.backgroundImage=scil.Utils.imgSrc("w8/"+h.options.buttonshape+"1.png",true)}));this.editor.connectHandlers.push(dojo.connect(f,"onmouseout",function(){this.style.backgroundImage=scil.Utils.imgSrc("w8/"+h.options.buttonshape+(this.getAttribute("pushed")==null?"":"0")+".png",true)}))}else{this.setHoverable(f)}return f}});JSDraw2.Lasso=scilligence.extend(scilligence._base,{constructor:function(c,d,f){this.surface=c;this.linewidth=d;this.list=f?[]:null;this.lasthits=[];this.curhits=[];this.line=null},hit:function(c){if(scil.Utils.indexOf(this.lasthits,c)>=0){return}c.selected=!c.selected;if(c.selected){c.drawSelect(this)}else{this.remove(c)}this.curhits.push(c)},endHits:function(d,c){this.lasthits=this.curhits;this.curhits=[];if(this.line!=null){this.surface.remove(this.line)}this.line=JSDraw2.Drawer.drawLine(this.surface,d,c,"#aaf",this.linewidth/2)},draw:function(d,l){if(l.x!=null){l=[l]}var h=[];for(var g=0;g<l.length;++g){var j=l[g];var f=this.surface.createCircle({cx:j.x,cy:j.y,r:this.linewidth*2}).setFill(JSDraw2.Editor.COLORSELECTED);h.push(f)}if(this.list!=null){this.list.push({a:d,nodes:h})}},remove:function(c){var f=null;for(var d=0;d<this.list.length;++d){if(this.list[d].a==c){f=this.list[d].nodes;this.list.splice(d,1);break}}if(f==null){return}for(var d=0;d<f.length;++d){this.surface.remove(f[d])}}});JSDraw2.Drawer={kMinFontSize:4,drawFormula:function(w,j,q,t,f,g){if(q){var d=t.charAt(0);if(d>="0"&&d<="9"){q=false}}var n=new JSDraw2.Rect();var u=this.splitFormula(t);for(var h=0;h<u.length;++h){if(q){if(u[h].num!=null){var l=this.drawWord(w,n,j,f,g,u[h].num,q,true);if(n.isEmpty()){n=l}else{n.union(l)}}}var l=this.drawWord(w,n,j,f,g,u[h].str,q,false);if(n.isEmpty()){n=l}else{n.union(l)}if(!q){if(u[h].num!=null){l=this.drawWord(w,n,j,f,g,u[h].num,q,true);if(n.isEmpty()){n=l}else{n.union(l)}}}}return n},drawWord:function(y,u,q,c,g,z,x,h){if(h){g/=1.4}var j=this.drawLabel(y,q,z,c,g,false,x?"end-anchor":"start-anchor");var t=j._rect.clone();var l=t.width/2;var d=0;var f=h?g/4:0;if(u.isEmpty()){}else{if(x){d=-u.width}else{d=u.width}}j.setTransform([dojox.gfx.matrix.translate(d,f)]);t.left+=d;t.top+=f;return t},splitFormula:function(l){if((/^[A-Z]+$/.test(l)||/^[\(][^\(\)]+[\)]$/.test(l)||/^[\[][^\[\]]+[\]]$/.test(l))&&l!="COOH"){return[{str:l}]}var j=[];var d=0;var h=false;var n="";for(var g=0;g<l.length;++g){var f=l.charAt(g);if(d>0||f=="("){if(f=="("){if(d==0){if(n!=""){if(h&&j.length>0){j[j.length-1].num=n}else{j.push({str:n})}}h=false;n=""}++d}else{if(f==")"){--d}}n+=f;if(d==0){j.push({str:n});n=""}}else{if(f>="A"&&f<="Z"){if(n!=""){if(h&&j.length>0){j[j.length-1].num=n}else{j.push({str:n})}}h=false;n=""}else{if(f>="0"&&f<="9"&&!h){if(n!=""){j.push({str:n})}h=true;n=""}}n+=f}}if(n!=""){if(h&&j.length>0){j[j.length-1].num=n}else{j.push({str:n})}}return j},drawCurveArrow:function(n,g,j,h,l,d,f){if(h==null||l==null){var c=JSDraw2.Curve.calcAnchors(g,j);h=c.p1a;l=c.p2a}n.createPath("").moveTo(g.x,g.y).curveTo(h.x,h.y,l.x,l.y,j.x,j.y).setStroke({color:d,width:f,cap:"round"});JSDraw2.Drawer.drawArrowhead(n,l,j,d,f)},drawCurve:function(t,h,l,f,q,d,g){var c=JSDraw2.Curve.calcAnchors(h,l,f,q);var j=c.p1a;var n=c.p2a;t.createPath("").moveTo(h.x,h.y).curveTo(j.x,j.y,n.x,n.y,l.x,l.y).setStroke({color:d,width:g,cap:"round"})},drawArrow:function(q,l,n,f,j,h,c){if(c=="dual"){var g=new JSDraw2.Point(n.x-l.x,n.y-l.y);var w=g.clone().rotate(90).setLength(j);var t=l.clone().offset(g.x+w.x,g.y+w.y);var u=n.clone().offset(-g.x+w.x,-g.y+w.y);JSDraw2.Drawer.drawLine(q,t,u,f,j,h);JSDraw2.Drawer.drawArrowhead2(q,t,u,f,j,"top");w=g.clone().rotate(-90).setLength(j);t=l.clone().offset(g.x+w.x,g.y+w.y);u=n.clone().offset(-g.x+w.x,-g.y+w.y);JSDraw2.Drawer.drawLine(q,t,u,f,j,h);JSDraw2.Drawer.drawArrowhead2(q,u,t,f,j,"top")}else{if(c=="reversible"){var g=new JSDraw2.Point(n.x-l.x,n.y-l.y);var w=g.clone().rotate(90).setLength(j);var t=l.clone().offset(g.x*0.6+w.x,g.y*0.6+w.y);var u=n.clone().offset(-g.x+w.x,-g.y+w.y);JSDraw2.Drawer.drawLine(q,t,u,f,j,h);JSDraw2.Drawer.drawArrowhead2(q,t,u,f,j,"top");w=g.clone().rotate(-90).setLength(j);t=l.clone().offset(g.x+w.x,g.y+w.y);u=n.clone().offset(-g.x+w.x,-g.y+w.y);JSDraw2.Drawer.drawLine(q,t,u,f,j,h);JSDraw2.Drawer.drawArrowhead2(q,u,t,f,j,"top")}else{if(c=="solid"){var w=new JSDraw2.Point(n.x-l.x,n.y-l.y).setLength(j*4);JSDraw2.Drawer.drawLine(q,l,n.clone().offset(-w.x,-w.y),f,j,h)}else{JSDraw2.Drawer.drawLine(q,l,n,f,j,h)}JSDraw2.Drawer.drawArrowhead(q,l,n,f,j,c)}}},drawArrowhead:function(j,g,h,d,f,c){if(c=="solid"){this.drawArrowhead2(j,g,h,d,f,c)}else{if(c=="double"){this.drawArrowhead2(j,g,h,d,f);this.drawArrowhead2(j,h,g,d,f)}else{if(c=="none"){}else{this.drawArrowhead2(j,g,h,d,f)}}}},drawArrowhead2:function(q,l,n,g,j,f){var t=l.clone().offset(-n.x,-n.y).setLength(j*7);var h=t.angle();var u=t.clone().rotate(25);var w=t.clone().rotate(-25);var c=n.clone().offset(u.x,u.y);var d=n.clone().offset(w.x,w.y);if(f=="solid"){JSDraw2.Drawer.drawTriangle(q,c,n,d,g)}else{if(f=="top"){JSDraw2.Drawer.drawLine(q,c,n,g,j)}else{if(f=="bottom"){JSDraw2.Drawer.drawLine(q,d,n,g,j)}else{JSDraw2.Drawer.drawLine(q,c,n,g,j);JSDraw2.Drawer.drawLine(q,d,n,g,j)}}}},drawTriangle:function(h,d,f,g,c){return this.drawPolygon(h,[d,f,g],c,null,c)},drawBracket:function(j,g,c,d,h){var f=d*3;var l=d;switch(h){case"round":this.drawCurve(j,g.topleft(),g.bottomleft(),-30,0.3,c,d);this.drawCurve(j,g.topright(),g.bottomright(),30,0.3,c,d);break;case"curly":break;default:JSDraw2.Drawer.drawLine(j,g.topleft(),g.topleft().offset(f,0),c,l);JSDraw2.Drawer.drawLine(j,g.topleft(),g.bottomleft(),c,l);JSDraw2.Drawer.drawLine(j,g.bottomleft(),g.bottomleft().offset(f,0),c,l);JSDraw2.Drawer.drawLine(j,g.topright(),g.topright().offset(-f,0),c,l);JSDraw2.Drawer.drawLine(j,g.topright(),g.bottomright(),c,l);JSDraw2.Drawer.drawLine(j,g.bottomright(),g.bottomright().offset(-f,0),c,l);break}},drawDoubleArrow:function(h,g,c,d){var f=d*3;var j=d;this.drawLine(h,g.topleft(),g.topright(),c,j);this.drawArrow(h,g.topleft(),g.bottomleft(),c,j);this.drawArrow(h,g.topright(),g.bottomright(),c,j)},drawLabel:function(z,l,q,f,g,j,c,h,u){var B=g+2;if(j){var n=new JSDraw2.Rect(l.x-B/2,l.y-B/2,B,B);z.createRect({x:n.left,y:n.top,width:n.width,height:n.height}).setFill(j==true?"#fff":j)}var C=l.x+(h==null?0:h);var D=l.y+B/2-2;if(c=="start-anchor"){c="start";C-=g*0.4}if(c=="end-anchor"){c="end";C+=g*0.4}var d={x:C,y:D,text:q,align:c==null?"middle":c};var A=null;if(dojox.gfx.renderer=="canvas"){A=z.createText(d);A.shape.fontStyle="bold "+(g<this.kMinFontSize?this.kMinFontSize:g)+"px Arial";A.shape.fillStyle=f;A.shape.align="center";A.mwidth=this.getTextWidth(z,A);A.getTextWidth=function(){return A.mwidth}}else{A=z.createText(d).setFont({family:"Arial",size:(g<this.kMinFontSize?this.kMinFontSize:g)+"px",weight:"normal"}).setFill(f);if(u!=false){A.setStroke(f)}}if(/^[ ]+$/.test(q)){A._rect=new JSDraw2.Rect(C,D,q.length*g/2,g+4)}else{A._rect=new JSDraw2.Rect(C,D,A.getTextWidth(),g+4)}A._rect.top-=A._rect.height*0.8;if(c=="end"){A._rect.left-=A._rect.width}return A},drawText2:function(j,f,h,c,d,g){var n=d+2;var l=null;if(dojox.gfx.renderer=="canvas"){l=j.createText({x:f.x,y:f.y+n/2-2,text:h});l.shape.fontStyle="bold "+(d<this.kMinFontSize?this.kMinFontSize:d)+"px Arial";l.shape.fillStyle=c;l.shape.align="center";l.mwidth=this.getTextWidth(j,l);l.getTextWidth=function(){return l.mwidth}}else{l=j.createText({x:f.x,y:f.y+n/2-2,text:h,align:"middle"}).setFont({family:"Arial",size:(d<this.kMinFontSize?this.kMinFontSize:d)+"px",weight:"normal"}).setFill(c)}if(g!=null){l.setTransform([dojox.gfx.matrix.rotateAt(g,f.x,f.y)])}return l},drawText:function(n,j,l,f,g,c,h){if(c==null){c="left"}var q=null;if(dojox.gfx.renderer=="canvas"){q=n.createText({x:j.x,y:j.y+g+2,text:l});q.shape.fontStyle=(g<this.kMinFontSize?this.kMinFontSize:g)+"px Arial";q.shape.fillStyle=f;q.shape.align=c;q.mwidth=this.getTextWidth(n,q);q.getTextWidth=function(){return q.mwidth}}else{var d={family:"Arial",size:(g<this.kMinFontSize?this.kMinFontSize:g)+"px",weight:"normal"};if(h){d.style="italic"}q=n.createText({x:j.x,y:j.y+g+2,text:l,align:c}).setFont(d).setFill(f)}if(c=="right"){var u=q.getTextWidth();q.setTransform([dojox.gfx.matrix.translate(-u,0)])}return q},getTextWidth:function(f,d){var c=f.surface.rawNode.getContext("2d");c.save();c.fillStyle=d.fillStyle;c.strokeStyle=d.fillStyle;c.font=d.fontStyle;c.textAlign="center";var g=c.measureText(d.text).width/6;c.restore();return g},drawBasis:function(q,l,n,c,h){this.drawLine(q,l,n,c,h);var f=new JSDraw2.Point(n.x-l.x,n.y-l.y).scale(1/6);var j=l.clone().offset(-f.x*0.5,-f.y*0.5);for(var g=0;g<5;++g){j.offset(f.x,f.y);var u=j.clone().offset(f.x*1.25,f.y*1.25);u.rotateAround(j,-45);this.drawLine(q,j,u,c,h)}},drawCurves:function(x,t,u,c,j){var w=x.createPath();w.moveTo(t.x,t.y);var h=t.distTo(u);var l=Math.floor(h/j);var f=new JSDraw2.Point(u.x-t.x,u.y-t.y).scale(1/l);var z=new JSDraw2.Point(u.x-t.x,u.y-t.y).rotate(90).setLength(j*2);for(var g=1;g<=l;g+=2){var q=t.clone().offset(f.x*g,f.y*g);var y=q.clone().offset(f.x,f.y);if(((g-1)/2)%2==1){q.offset(z.x,z.y)}else{q.offset(-z.x,-z.y)}w.qCurveTo(q.x,q.y,y.x,y.y)}w.setStroke({color:c,width:j})},drawLine:function(z,w,x,f,t,j,c){if(t==null){t=1}if(j==null||j<=1){return z.createLine({x1:w.x,y1:w.y,x2:x.x,y2:x.y}).setStroke({color:f,width:t,cap:c==null?"round":c})}else{var q=w.distTo(x);var u=Math.floor(q/j);if(u%2==0){--u}var g=x.clone().offset(-w.x,-w.y).scale(1/u);var h=g.clone().scale(0.3);var y=new JSDraw2.Point(((x.x-w.x)-g.x*u)/2,((x.y-w.y)-g.y*u)/2);for(var l=0;l<u;l+=2){var A=w.clone().offset(y.x+g.x*l+h.x,y.y+g.y*l+h.y);var B=A.clone().offset(g.x-h.x,g.y-h.y);z.createLine({x1:A.x,y1:A.y,x2:B.x,y2:B.y}).setStroke({color:f,width:t,cap:c==null?"round":c})}}},drawRect:function(l,g,c,d,h,j){if(g==null||g.isEmpty()){return}var f={x:g.left,y:g.top,width:g.width,height:g.height};if(h!=null){f.r=h}if(j!=null){f.style=j}return l.createRect(f).setStroke({color:c,width:d})},drawDShape:function(l,g,c,d,j){var h=g.height/2;var n=g.right()-h;var q=g.center().y;var f=l.createPath().moveTo({x:n,y:g.top}).arcTo(h,h,0,false,true,this._calcPoint(n,q,h,180/2)).arcTo(h,h,0,false,true,this._calcPoint(n,q,h,180)).lineTo({x:g.left,y:g.bottom()}).lineTo({x:g.left,y:g.top}).lineTo({x:n,y:g.top}).closePath().setStroke({color:c,width:d});if(j){f.setTransform([dojox.gfx.matrix.rotateAt(Math.PI,g.center().x,q)])}return f},_calcPoint:function(f,g,d,c){c=(Math.PI/180)*(360-c);return{x:Math.round((d*-Math.sin(c))+f),y:Math.round(g-(d*Math.cos(c)))}},drawEllipse:function(j,h,f,g){var d=h.center();return j.createEllipse({cx:d.x,cy:d.y,rx:h.width/2,ry:h.height/2}).setStroke({color:f,width:g})},drawPie:function(q,t,u,j,d,f,g,n,h){var c=function(w,x){w=(Math.PI/180)*(360-w);return{x:Math.round((j*-Math.sin(w))+t),y:Math.round(u-(j*Math.cos(w)))}};var l=q.createPath();l.moveTo({x:t,y:u});if(g!=null){l.lineTo(c(d))}else{l.moveTo(c(d))}l.arcTo(j,j,0,false,true,c(f/2));l.arcTo(j,j,0,false,true,c(f));if(g!=null){l.lineTo({x:t,y:u})}else{l.moveTo({x:t,y:u})}l.closePath();if(g!=null){l.setFill(g)}if(n!=null){l.setStroke({width:h>0?h:1,color:n})}return l},drawDiamond:function(l,j,f,g){var d=j.center();var h=[{x:d.x,y:j.top},{x:j.right(),y:d.y},{x:d.x,y:j.bottom()},{x:j.left,y:d.y},{x:d.x,y:j.top}];return l.createPolyline(h).setStroke({color:f,width:g})},drawPolygon:function(n,l,c,j,g){var q=n.createPath("").moveTo(l[0].x,l[0].y);for(var h=1;h<l.length;++h){q.lineTo(l[h].x,l[h].y)}q.lineTo(l[0].x,l[0].y);var f={color:c};if(j>0){f.width=j}q.setStroke(f);if(g!=null){q.setFill(g)}return q},drawHexgon:function(q,n,g,j){var f=n.center();var h=new JSDraw2.Point(0,n.width/2);h.rotate(-30);var l=[{x:n.right(),y:f.y},{x:f.x+h.x,y:f.y-h.y},{x:f.x-h.x,y:f.y-h.y},{x:n.left,y:f.y},{x:f.x-h.x,y:f.y+h.y},{x:f.x+h.x,y:f.y+h.y},{x:n.right(),y:f.y}];return q.createPolyline(l).setStroke({color:g,width:j})},drawPentagon:function(w,u,f,g){var d=u.center();var h=d.clone().offset(0,-u.width/2);var j=h.clone().rotateAround(d,72);var l=j.clone().rotateAround(d,72);var n=l.clone().rotateAround(d,72);var q=n.clone().rotateAround(d,72);var t=[{x:h.x,y:h.y},{x:j.x,y:j.y},{x:l.x,y:l.y},{x:n.x,y:n.y},{x:q.x,y:q.y},{x:h.x,y:h.y},];return w.createPolyline(t).setStroke({color:f,width:g})}};JSDraw2.Language={current:null,use:function(c){},res:function(c){return c}};var CryptoJS=CryptoJS||function(C,j){var f={},g=f.lib={},A=function(){},B=g.Base={extend:function(d){A.prototype=this;var l=new A;d&&l.mixIn(d);l.hasOwnProperty("init")||(l.init=function(){l.$super.init.apply(this,arguments)});l.init.prototype=l;l.$super=this;return l},create:function(){var d=this.extend();d.init.apply(d,arguments);return d},init:function(){},mixIn:function(d){for(var l in d){d.hasOwnProperty(l)&&(this[l]=d[l])}d.hasOwnProperty("toString")&&(this.toString=d.toString)},clone:function(){return this.init.prototype.extend(this)}},z=g.WordArray=B.extend({init:function(d,l){d=this.words=d||[];this.sigBytes=l!=j?l:4*d.length},toString:function(d){return(d||D).stringify(this)},concat:function(d){var l=this.words,n=d.words,q=this.sigBytes;d=d.sigBytes;this.clamp();if(q%4){for(var t=0;t<d;t++){l[q+t>>>2]|=(n[t>>>2]>>>24-8*(t%4)&255)<<24-8*((q+t)%4)}}else{if(65535<n.length){for(t=0;t<d;t+=4){l[q+t>>>2]=n[t>>>2]}}else{l.push.apply(l,n)}}this.sigBytes+=d;return this},clamp:function(){var d=this.words,l=this.sigBytes;d[l>>>2]&=4294967295<<32-8*(l%4);d.length=C.ceil(l/4)},clone:function(){var d=B.clone.call(this);d.words=this.words.slice(0);return d},random:function(d){for(var l=[],n=0;n<d;n+=4){l.push(4294967296*C.random()|0)}return new z.init(l,d)}}),E=f.enc={},D=E.Hex={stringify:function(d){var l=d.words;d=d.sigBytes;for(var n=[],q=0;q<d;q++){var t=l[q>>>2]>>>24-8*(q%4)&255;n.push((t>>>4).toString(16));n.push((t&15).toString(16))}return n.join("")},parse:function(d){for(var l=d.length,n=[],q=0;q<l;q+=2){n[q>>>3]|=parseInt(d.substr(q,2),16)<<24-4*(q%8)}return new z.init(n,l/2)}},c=E.Latin1={stringify:function(d){var l=d.words;d=d.sigBytes;for(var n=[],q=0;q<d;q++){n.push(String.fromCharCode(l[q>>>2]>>>24-8*(q%4)&255))}return n.join("")},parse:function(d){for(var l=d.length,n=[],q=0;q<l;q++){n[q>>>2]|=(d.charCodeAt(q)&255)<<24-8*(q%4)}return new z.init(n,l)}},F=E.Utf8={stringify:function(d){try{return decodeURIComponent(escape(c.stringify(d)))}catch(l){throw Error("Malformed UTF-8 data")}},parse:function(d){return c.parse(unescape(encodeURIComponent(d)))}},y=g.BufferedBlockAlgorithm=B.extend({reset:function(){this._data=new z.init;this._nDataBytes=0},_append:function(d){"string"==typeof d&&(d=F.parse(d));this._data.concat(d);this._nDataBytes+=d.sigBytes},_process:function(d){var n=this._data,t=n.words,u=n.sigBytes,w=this.blockSize,l=u/(4*w),l=d?C.ceil(l):C.max((l|0)-this._minBufferSize,0);d=l*w;u=C.min(4*d,u);if(d){for(var x=0;x<d;x+=w){this._doProcessBlock(t,x)}x=t.splice(0,d);n.sigBytes-=u}return new z.init(x,u)},clone:function(){var d=B.clone.call(this);d._data=this._data.clone();return d},_minBufferSize:0});g.Hasher=y.extend({cfg:B.extend(),init:function(d){this.cfg=this.cfg.extend(d);this.reset()},reset:function(){y.reset.call(this);this._doReset()},update:function(d){this._append(d);this._process();return this},finalize:function(d){d&&this._append(d);return this._doFinalize()},blockSize:16,_createHelper:function(d){return function(l,n){return(new d.init(n)).finalize(l)}},_createHmacHelper:function(d){return function(l,n){return(new h.HMAC.init(d,n)).finalize(l)}}});var h=f.algo={};return f}(Math);(function(){var d=CryptoJS,c=d.lib.WordArray;d.enc.Base64={stringify:function(f){var g=f.words,h=f.sigBytes,n=this._map;f.clamp();f=[];for(var j=0;j<h;j+=3){for(var u=(g[j>>>2]>>>24-8*(j%4)&255)<<16|(g[j+1>>>2]>>>24-8*((j+1)%4)&255)<<8|g[j+2>>>2]>>>24-8*((j+2)%4)&255,q=0;4>q&&j+0.75*q<h;q++){f.push(n.charAt(u>>>6*(3-q)&63))}}if(g=n.charAt(64)){for(;f.length%4;){f.push(g)}}return f.join("")},parse:function(g){var h=g.length,n=this._map,q=n.charAt(64);q&&(q=g.indexOf(q),-1!=q&&(h=q));for(var q=[],j=0,x=0;x<h;x++){if(x%4){var u=n.indexOf(g.charAt(x-1))<<2*(x%4),f=n.indexOf(g.charAt(x))>>>6-2*(x%4);q[j>>>2]|=(u|f)<<24-8*(j%4);j++}}return c.create(q,j)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="}})();(function(y){function h(l,C,d,t,u,w,x){l=l+(C&d|~C&t)+u+x;return(l<<w|l>>>32-w)+C}function f(l,C,d,t,u,w,x){l=l+(C&t|d&~t)+u+x;return(l<<w|l>>>32-w)+C}function g(l,C,d,t,u,w,x){l=l+(C^d^t)+u+x;return(l<<w|l>>>32-w)+C}function n(l,C,d,t,u,w,x){l=l+(d^(C|~t))+u+x;return(l<<w|l>>>32-w)+C}for(var q=CryptoJS,j=q.lib,A=j.WordArray,z=j.Hasher,j=q.algo,c=[],B=0;64>B;B++){c[B]=4294967296*y.abs(y.sin(B+1))|0}j=j.MD5=z.extend({_doReset:function(){this._hash=new A.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(S,R){for(var d=0;16>d;d++){var G=R+d,J=S[G];S[G]=(J<<8|J>>>24)&16711935|(J<<24|J>>>8)&4278255360}var d=this._hash.words,G=S[R+0],J=S[R+1],O=S[R+2],P=S[R+3],Z=S[R+4],T=S[R+5],U=S[R+6],X=S[R+7],W=S[R+8],l=S[R+9],F=S[R+10],H=S[R+11],V=S[R+12],I=S[R+13],K=S[R+14],Y=S[R+15],L=d[0],Q=d[1],M=d[2],N=d[3],L=h(L,Q,M,N,G,7,c[0]),N=h(N,L,Q,M,J,12,c[1]),M=h(M,N,L,Q,O,17,c[2]),Q=h(Q,M,N,L,P,22,c[3]),L=h(L,Q,M,N,Z,7,c[4]),N=h(N,L,Q,M,T,12,c[5]),M=h(M,N,L,Q,U,17,c[6]),Q=h(Q,M,N,L,X,22,c[7]),L=h(L,Q,M,N,W,7,c[8]),N=h(N,L,Q,M,l,12,c[9]),M=h(M,N,L,Q,F,17,c[10]),Q=h(Q,M,N,L,H,22,c[11]),L=h(L,Q,M,N,V,7,c[12]),N=h(N,L,Q,M,I,12,c[13]),M=h(M,N,L,Q,K,17,c[14]),Q=h(Q,M,N,L,Y,22,c[15]),L=f(L,Q,M,N,J,5,c[16]),N=f(N,L,Q,M,U,9,c[17]),M=f(M,N,L,Q,H,14,c[18]),Q=f(Q,M,N,L,G,20,c[19]),L=f(L,Q,M,N,T,5,c[20]),N=f(N,L,Q,M,F,9,c[21]),M=f(M,N,L,Q,Y,14,c[22]),Q=f(Q,M,N,L,Z,20,c[23]),L=f(L,Q,M,N,l,5,c[24]),N=f(N,L,Q,M,K,9,c[25]),M=f(M,N,L,Q,P,14,c[26]),Q=f(Q,M,N,L,W,20,c[27]),L=f(L,Q,M,N,I,5,c[28]),N=f(N,L,Q,M,O,9,c[29]),M=f(M,N,L,Q,X,14,c[30]),Q=f(Q,M,N,L,V,20,c[31]),L=g(L,Q,M,N,T,4,c[32]),N=g(N,L,Q,M,W,11,c[33]),M=g(M,N,L,Q,H,16,c[34]),Q=g(Q,M,N,L,K,23,c[35]),L=g(L,Q,M,N,J,4,c[36]),N=g(N,L,Q,M,Z,11,c[37]),M=g(M,N,L,Q,X,16,c[38]),Q=g(Q,M,N,L,F,23,c[39]),L=g(L,Q,M,N,I,4,c[40]),N=g(N,L,Q,M,G,11,c[41]),M=g(M,N,L,Q,P,16,c[42]),Q=g(Q,M,N,L,U,23,c[43]),L=g(L,Q,M,N,l,4,c[44]),N=g(N,L,Q,M,V,11,c[45]),M=g(M,N,L,Q,Y,16,c[46]),Q=g(Q,M,N,L,O,23,c[47]),L=n(L,Q,M,N,G,6,c[48]),N=n(N,L,Q,M,X,10,c[49]),M=n(M,N,L,Q,K,15,c[50]),Q=n(Q,M,N,L,T,21,c[51]),L=n(L,Q,M,N,V,6,c[52]),N=n(N,L,Q,M,P,10,c[53]),M=n(M,N,L,Q,F,15,c[54]),Q=n(Q,M,N,L,J,21,c[55]),L=n(L,Q,M,N,W,6,c[56]),N=n(N,L,Q,M,Y,10,c[57]),M=n(M,N,L,Q,U,15,c[58]),Q=n(Q,M,N,L,I,21,c[59]),L=n(L,Q,M,N,Z,6,c[60]),N=n(N,L,Q,M,H,10,c[61]),M=n(M,N,L,Q,O,15,c[62]),Q=n(Q,M,N,L,l,21,c[63]);d[0]=d[0]+L|0;d[1]=d[1]+Q|0;d[2]=d[2]+M|0;d[3]=d[3]+N|0},_doFinalize:function(){var l=this._data,w=l.words,d=8*this._nDataBytes,t=8*l.sigBytes;w[t>>>5]|=128<<24-t%32;var u=y.floor(d/4294967296);w[(t+64>>>9<<4)+15]=(u<<8|u>>>24)&16711935|(u<<24|u>>>8)&4278255360;w[(t+64>>>9<<4)+14]=(d<<8|d>>>24)&16711935|(d<<24|d>>>8)&4278255360;l.sigBytes=4*(w.length+1);this._process();l=this._hash;w=l.words;for(d=0;4>d;d++){t=w[d],w[d]=(t<<8|t>>>24)&16711935|(t<<24|t>>>8)&4278255360}return l},clone:function(){var d=z.clone.call(this);d._hash=this._hash.clone();return d}});q.MD5=z._createHelper(j);q.HmacMD5=z._createHmacHelper(j)})(Math);(function(){var j=CryptoJS,g=j.lib,c=g.Base,f=g.WordArray,g=j.algo,h=g.EvpKDF=c.extend({cfg:c.extend({keySize:4,hasher:g.MD5,iterations:1}),init:function(l){this.cfg=this.cfg.extend(l)},compute:function(w,A){for(var y=this.cfg,B=y.hasher.create(),t=f.create(),C=t.words,z=y.keySize,y=y.iterations;C.length<z;){x&&B.update(x);var x=B.update(w).finalize(A);B.reset();for(var l=1;l<y;l++){x=B.finalize(x),B.reset()}t.concat(x)}t.sigBytes=4*z;return t}});j.EvpKDF=function(n,q,t){return h.create(t).compute(n,q)}})();CryptoJS.lib.Cipher||function(F){var A=CryptoJS,j=A.lib,y=j.Base,D=j.WordArray,E=j.BufferedBlockAlgorithm,C=A.enc.Base64,H=A.algo.EvpKDF,G=j.Cipher=E.extend({cfg:y.extend(),createEncryptor:function(d,c){return this.create(this._ENC_XFORM_MODE,d,c)},createDecryptor:function(d,c){return this.create(this._DEC_XFORM_MODE,d,c)},init:function(l,c,d){this.cfg=this.cfg.extend(d);this._xformMode=l;this._key=c;this.reset()},reset:function(){E.reset.call(this);this._doReset()},process:function(c){this._append(c);return this._process()},finalize:function(c){c&&this._append(c);return this._doFinalize()},keySize:4,ivSize:4,_ENC_XFORM_MODE:1,_DEC_XFORM_MODE:2,_createHelper:function(c){return{encrypt:function(l,q,n){return("string"==typeof q?h:f).encrypt(c,l,q,n)},decrypt:function(l,q,n){return("string"==typeof q?h:f).decrypt(c,l,q,n)}}}});j.StreamCipher=G.extend({_doFinalize:function(){return this._process(!0)},blockSize:1});var g=A.mode={},I=function(u,l,n){var q=this._iv;q?this._iv=F:q=this._prevBlock;for(var t=0;t<n;t++){u[l+t]^=q[t]}},B=(j.BlockCipherMode=y.extend({createEncryptor:function(d,c){return this.Encryptor.create(d,c)},createDecryptor:function(d,c){return this.Decryptor.create(d,c)},init:function(d,c){this._cipher=d;this._iv=c}})).extend();B.Encryptor=B.extend({processBlock:function(q,d){var l=this._cipher,n=l.blockSize;I.call(this,q,d,n);l.encryptBlock(q,d);this._prevBlock=q.slice(d,d+n)}});B.Decryptor=B.extend({processBlock:function(u,l){var n=this._cipher,q=n.blockSize,t=u.slice(l,l+q);n.decryptBlock(u,l);I.call(this,u,l,q);this._prevBlock=t}});g=g.CBC=B;B=(A.pad={}).Pkcs7={pad:function(q,t){for(var u=4*t,u=u-q.sigBytes%u,w=u<<24|u<<16|u<<8|u,x=[],J=0;J<u;J+=4){x.push(w)}u=D.create(x,u);q.concat(u)},unpad:function(c){c.sigBytes-=c.words[c.sigBytes-1>>>2]&255}};j.BlockCipher=G.extend({cfg:G.cfg.extend({mode:g,padding:B}),reset:function(){G.reset.call(this);var d=this.cfg,l=d.iv,d=d.mode;if(this._xformMode==this._ENC_XFORM_MODE){var n=d.createEncryptor}else{n=d.createDecryptor,this._minBufferSize=1}this._mode=n.call(d,this,l&&l.words)},_doProcessBlock:function(c,d){this._mode.processBlock(c,d)},_doFinalize:function(){var c=this.cfg.padding;if(this._xformMode==this._ENC_XFORM_MODE){c.pad(this._data,this.blockSize);var d=this._process(!0)}else{d=this._process(!0),c.unpad(d)}return d},blockSize:4});var z=j.CipherParams=y.extend({init:function(c){this.mixIn(c)},toString:function(c){return(c||this.formatter).stringify(this)}}),g=(A.format={}).OpenSSL={stringify:function(c){var d=c.ciphertext;c=c.salt;return(c?D.create([1398893684,1701076831]).concat(c).concat(d):d).toString(C)},parse:function(d){d=C.parse(d);var l=d.words;if(1398893684==l[0]&&1701076831==l[1]){var n=D.create(l.slice(2,4));l.splice(0,4);d.sigBytes-=16}return z.create({ciphertext:d,salt:n})}},f=j.SerializableCipher=y.extend({cfg:y.extend({format:g}),encrypt:function(n,q,t,u){u=this.cfg.extend(u);var w=n.createEncryptor(t,u);q=w.finalize(q);w=w.cfg;return z.create({ciphertext:q,key:t,iv:w.iv,algorithm:n,mode:w.mode,padding:w.padding,blockSize:n.blockSize,formatter:u.format})},decrypt:function(l,n,q,t){t=this.cfg.extend(t);n=this._parse(n,t.format);return l.createDecryptor(q,t).finalize(n.ciphertext)},_parse:function(c,d){return"string"==typeof c?d.parse(c,this):c}}),A=(A.kdf={}).OpenSSL={execute:function(l,n,q,t){t||(t=D.random(8));l=H.create({keySize:n+q}).compute(l,t);q=D.create(l.words.slice(n),4*q);l.sigBytes=4*n;return z.create({key:l,iv:q,salt:t})}},h=j.PasswordBasedCipher=f.extend({cfg:f.cfg.extend({kdf:A}),encrypt:function(n,q,t,u){u=this.cfg.extend(u);t=u.kdf.execute(t,n.keySize,n.ivSize);u.iv=t.iv;n=f.encrypt.call(this,n,q,t.key,u);n.mixIn(t);return n},decrypt:function(n,q,t,u){u=this.cfg.extend(u);q=this._parse(q,u.format);t=u.kdf.execute(t,n.keySize,n.ivSize,q.salt);u.iv=t.iv;return f.decrypt.call(this,n,q,t.key,u)}})}();(function(){for(var R=CryptoJS,M=R.lib.BlockCipher,A=R.algo,K=[],P=[],Q=[],O=[],T=[],S=[],g=[],U=[],N=[],L=[],f=[],h=0;256>h;h++){f[h]=128>h?h<<1:h<<1^283}for(var B=0,I=0,h=0;256>h;h++){var J=I^I<<1^I<<2^I<<3^I<<4,J=J>>>8^J&255^99;K[B]=J;P[J]=B;var W=f[B],C=f[W],D=f[C],V=257*f[J]^16843008*J;Q[B]=V<<24|V>>>8;O[B]=V<<16|V>>>16;T[B]=V<<8|V>>>24;S[B]=V;V=16843009*D^65537*C^257*W^16843008*B;g[J]=V<<24|V>>>8;U[J]=V<<16|V>>>16;N[J]=V<<8|V>>>24;L[J]=V;B?(B=W^f[f[f[D^W]]],I^=f[f[I]]):B=I=1}var E=[0,1,2,4,8,16,32,64,128,27,54],A=A.AES=M.extend({_doReset:function(){for(var l=this._key,n=l.words,q=l.sigBytes/4,l=4*((this._nRounds=q+6)+1),t=this._keySchedule=[],u=0;u<l;u++){if(u<q){t[u]=n[u]}else{var w=t[u-1];u%q?6<q&&4==u%q&&(w=K[w>>>24]<<24|K[w>>>16&255]<<16|K[w>>>8&255]<<8|K[w&255]):(w=w<<8|w>>>24,w=K[w>>>24]<<24|K[w>>>16&255]<<16|K[w>>>8&255]<<8|K[w&255],w^=E[u/q|0]<<24);t[u]=t[u-q]^w}}n=this._invKeySchedule=[];for(q=0;q<l;q++){u=l-q,w=q%4?t[u]:t[u-4],n[q]=4>q||4>=u?w:g[K[w>>>24]]^U[K[w>>>16&255]]^N[K[w>>>8&255]]^L[K[w&255]]}},encryptBlock:function(c,d){this._doCryptBlock(c,d,this._keySchedule,Q,O,T,S,K)},decryptBlock:function(j,l){var n=j[l+1];j[l+1]=j[l+3];j[l+3]=n;this._doCryptBlock(j,l,this._invKeySchedule,g,U,N,L,P);n=j[l+1];j[l+1]=j[l+3];j[l+3]=n},_doCryptBlock:function(u,w,x,y,z,X,Z,F){for(var aa=this._nRounds,G=u[w]^x[0],H=u[w+1]^x[1],Y=u[w+2]^x[2],ab=u[w+3]^x[3],ac=4,ae=1;ae<aa;ae++){var ad=y[G>>>24]^z[H>>>16&255]^X[Y>>>8&255]^Z[ab&255]^x[ac++],af=y[H>>>24]^z[Y>>>16&255]^X[ab>>>8&255]^Z[G&255]^x[ac++],ag=y[Y>>>24]^z[ab>>>16&255]^X[G>>>8&255]^Z[H&255]^x[ac++],ab=y[ab>>>24]^z[G>>>16&255]^X[H>>>8&255]^Z[Y&255]^x[ac++],G=ad,H=af,Y=ag}ad=(F[G>>>24]<<24|F[H>>>16&255]<<16|F[Y>>>8&255]<<8|F[ab&255])^x[ac++];af=(F[H>>>24]<<24|F[Y>>>16&255]<<16|F[ab>>>8&255]<<8|F[G&255])^x[ac++];ag=(F[Y>>>24]<<24|F[ab>>>16&255]<<16|F[G>>>8&255]<<8|F[H&255])^x[ac++];ab=(F[ab>>>24]<<24|F[G>>>16&255]<<16|F[H>>>8&255]<<8|F[Y&255])^x[ac++];u[w]=ad;u[w+1]=af;u[w+2]=ag;u[w+3]=ab},keySize:8});R.AES=M._createHelper(A)})();(function(l){var c=CryptoJS;var f=c.lib;var t=f.WordArray;var h=f.Hasher;var d=c.algo;var g=[];var j=[];(function(){function w(A){var B=l.sqrt(A);for(var z=2;z<=B;z++){if(!(A%z)){return false}}return true}function u(z){return((z-(z|0))*4294967296)|0}var x=2;var y=0;while(y<64){if(w(x)){if(y<8){g[y]=u(l.pow(x,1/2))}j[y]=u(l.pow(x,1/3));y++}x++}}());var q=[];var n=d.SHA256=h.extend({_doReset:function(){this._hash=new t.init(g.slice(0))},_doProcessBlock:function(L,O){var J=this._hash.words;var u=J[0];var w=J[1];var x=J[2];var z=J[3];var A=J[4];var B=J[5];var C=J[6];var I=J[7];for(var K=0;K<64;K++){if(K<16){q[K]=L[O+K]|0}else{var E=q[K-15];var D=((E<<25)|(E>>>7))^((E<<14)|(E>>>18))^(E>>>3);var G=q[K-2];var F=((G<<15)|(G>>>17))^((G<<13)|(G>>>19))^(G>>>10);q[K]=D+q[K-7]+F+q[K-16]}var y=(A&B)^(~A&C);var N=(u&w)^(u&x)^(w&x);var P=((u<<30)|(u>>>2))^((u<<19)|(u>>>13))^((u<<10)|(u>>>22));var Q=((A<<26)|(A>>>6))^((A<<21)|(A>>>11))^((A<<7)|(A>>>25));var R=I+Q+y+j[K]+q[K];var S=P+N;I=C;C=B;B=A;A=(z+R)|0;z=x;x=w;w=u;u=(R+S)|0}J[0]=(J[0]+u)|0;J[1]=(J[1]+w)|0;J[2]=(J[2]+x)|0;J[3]=(J[3]+z)|0;J[4]=(J[4]+A)|0;J[5]=(J[5]+B)|0;J[6]=(J[6]+C)|0;J[7]=(J[7]+I)|0},_doFinalize:function(){var u=this._data;var w=u.words;var y=this._nDataBytes*8;var x=u.sigBytes*8;w[x>>>5]|=128<<(24-x%32);w[(((x+64)>>>9)<<4)+14]=l.floor(y/4294967296);w[(((x+64)>>>9)<<4)+15]=y;u.sigBytes=w.length*4;this._process();return this._hash},clone:function(){var u=h.clone.call(this);u._hash=this._hash.clone();return u}});c.SHA256=h._createHelper(n);c.HmacSHA256=h._createHmacHelper(n)}(Math));JSDraw2.IDGenerator=scil.extend(scil._base,{constructor:function(c){this.i=c>0?c:0;this.used=this.i==0?null:{}},next:function(c){if(this.used==null){return ++this.i}if(c>0&&!this.used[c]){this.used[c]=true;return c}c=++this.i;while(this.used[c]){c=++this.i}this.used[c]=true;return c}});JSDraw2.Skin={jsdraw:{},jssdf:{},dialog:{},menu:{},toolbar:{autoshrink:true},kRoundish:true,kBorderRadius:"5px",kBigRadius:"2px",kPagesLocation:"bottom",kToolbarColor:"rgb(61,60,61)",reset:function(){this.jsdraw={bkcolor:"#e1e1e1",bkimg:scil.Utils.imgSrc("img/hbg.gif"),toolbarbk:scil.Utils.imgSrc("img/toolbarbk.jpg"),hovercolor:"#eef",btnselcolor:"#bbf"};this.jssdf={bgcolor:"#eee",headerimg:scil.Utils.imgSrc("img/header-bg.gif"),headercolor:"#eee",rowcolor:"#f96",oddcolor:"",evencolor:"#eee",border:"solid 1px #ccc"};scilligence.apply(this.jssdf,this.jsdraw);this.menu={boxshadow:"5px 5px 15px 5px rgba(0,0,0,0.2)"};this.dialog={bkimg:scil.Utils.imgSrc("img/dlgheader.gif"),bkcolor:"#6badf6",border:"1px solid #4f6d81",boxshadow:"5px 5px 20px 8px rgba(0,0,0,0.5)"}},red:function(){this.jsdraw={bkcolor:"#ECCDDC",bkimg:scil.Utils.imgSrc("img/hbg-red.gif"),toolbarbk:scil.Utils.imgSrc("img/toolbarbk-red.jpg"),hovercolor:"#fCdDeC"};this.jssdf={bgcolor:"#F8CEE8",headerimg:scil.Utils.imgSrc("img/header-bgred.gif"),headercolor:"#F8CEE8",rowcolor:"#FfeEf8",oddcolor:"",evencolor:"#eee",border:"solid 1px #ccc"};scilligence.apply(this.jssdf,this.jsdraw);this.dialog={bkimg:scil.Utils.imgSrc("img/dlgheader-red.gif"),bkcolor:"#E7A6DF",border:"1px solid #4f6d81"}},green:function(){this.jsdraw={bkcolor:"#C7EEDF",bkimg:scil.Utils.imgSrc("img/hbg-green.gif"),toolbarbk:scil.Utils.imgSrc("img/toolbarbk-green.jpg"),hovercolor:"#d7fEeF"};this.jssdf={bgcolor:"#CCF8E8",headerimg:scil.Utils.imgSrc("img/header-bggreen.gif"),headercolor:"#CCF8E8",rowcolor:"#dCFff8",oddcolor:"",evencolor:"#eee",border:"solid 1px #ccc"};scilligence.apply(this.jssdf,this.jsdraw);this.dialog={bkimg:scil.Utils.imgSrc("img/dlgheader-green.gif"),bkcolor:"#95D09C",border:"1px solid #4f6d81"}},blue:function(){this.jsdraw={bkcolor:"#CDD0EC",bkimg:scil.Utils.imgSrc("img/hbg-blue.gif"),toolbarbk:scil.Utils.imgSrc("img/toolbarbk-blue.jpg"),hovercolor:"#dDe0fC"};this.jssdf={bgcolor:"#DCDFF6",headerimg:scil.Utils.imgSrc("img/header-bgblue.gif"),headercolor:"#DCDFF6",rowcolor:"#eCeFFf",oddcolor:"",evencolor:"#eee",border:"solid 1px #ccc"};scilligence.apply(this.jssdf,this.jsdraw);this.dialog={bkimg:scil.Utils.imgSrc("img/dlgheader-blue.gif"),bkcolor:"#8BB6CC",border:"1px solid #4f6d81"}},yellow:function(){this.jsdraw={bkcolor:"#ECECCD",bkimg:scil.Utils.imgSrc("img/hbg-yellow.gif"),toolbarbk:scil.Utils.imgSrc("img/toolbarbk-yellow.jpg"),hovercolor:"#fCfCdD"};this.jssdf={bgcolor:"#F4F4E1",headerimg:scil.Utils.imgSrc("img/header-bgyellow.gif"),headercolor:"#F4F4E1",rowcolor:"#F4F4B8",oddcolor:"",evencolor:"#eee",border:"solid 1px #ccc"};scilligence.apply(this.jssdf,this.jsdraw);this.dialog={bkimg:scil.Utils.imgSrc("img/dlgheader-yellow.gif"),bkcolor:"#C8BA8F",border:"1px solid #4f6d81"}},menu:{highlightcolor:"#c60",color:"blue"},form:{labelstyles:{textAlign:"right",verticalAlign:"top",whiteSpace:"nowrap",color:"#666"},fieldcolor:"blue",rowselectcolor:"#aaf",spacing:5},table:{spacing:5,cell:"grid"},login:{background:"#ddd",opacity:0.8}};JSDraw2.Skin.reset();JSDraw2.Editor=scilligence.extend(scilligence._base,{constructor:function(c,h){this.disableundo=JSDraw2.speedup.disableundo;this.T="DRAW";JSDraw2.Editor.COLORCURRENT=[0,255,0,0.5];JSDraw2.Editor.COLORSELECTED=[0,0,255,0.5];this.options=h==null?{}:h;this.chiral=null;if(JSDraw2.Editor._id==null){JSDraw2.Editor._id=0;JSDraw2.Editor._allitems={}}++JSDraw2.Editor._id;if((typeof c)=="string"){c=dojo.byId(c)}if(c==null){return}this.ptElement=null;this.connectHandlers=[];this.maintable=null;this.div=c;if(this.div.id==null||this.div.id.length==0){this.div.id="__JSDraw_"+JSDraw2.Editor._id}this.id=this.div.id;JSDraw2.Editor._allitems[this.id]=this;if(JSDraw2.defaultoptions==null){JSDraw2.defaultoptions={}}if(this.options.popup==null){this.options.popup=scil.Utils.isAttTrue(this.div,"popup")}if(this.options.viewonly==null){this.options.viewonly=scil.Utils.isAttTrue(this.div,"viewonly")}if(this.options.removehydrogens==null){this.options.removehydrogens=JSDraw2.defaultoptions.removehydrogens!=null?JSDraw2.defaultoptions.removehydrogens:scil.Utils.isAttTrue(this.div,"removehydrogens")}if(this.options.query==null){this.options.query=JSDraw2.defaultoptions.query!=null?JSDraw2.defaultoptions.query:!scil.Utils.isAttFalse(this.div,"query")}if(this.options.rxn==null){this.options.rxn=JSDraw2.defaultoptions.rxn!=null?JSDraw2.defaultoptions.rxn:!scil.Utils.isAttFalse(this.div,"rxn")}if(this.options.biology==null){this.options.biology=JSDraw2.defaultoptions.biology!=null?JSDraw2.defaultoptions.biology:!scil.Utils.isAttFalse(this.div,"biology")}if(this.options.sendquery==null){this.options.sendquery=JSDraw2.defaultoptions.sendquery!=null?JSDraw2.defaultoptions.sendquery:!scil.Utils.isAttFalse(this.div,"sendquery")}if(this.options.showtoolbar==null){this.options.showtoolbar=JSDraw2.defaultoptions.showtoolbar!=null?JSDraw2.defaultoptions.showtoolbar:!scil.Utils.isAttFalse(this.div,"showtoolbar")}if(this.options.showcustomtemplates==null){this.options.showcustomtemplates=JSDraw2.defaultoptions.showcustomtemplates!=null?JSDraw2.defaultoptions.showcustomtemplates:!scil.Utils.isAttFalse(this.div,"showcustomtemplates")}if(this.options.usechemdraw==null){this.options.usechemdraw=JSDraw2.defaultoptions.usechemdraw!=null?JSDraw2.defaultoptions.usechemdraw:scil.Utils.isAttTrue(this.div,"usechemdraw")}if(this.options.showcarbon==null){this.options.showcarbon=JSDraw2.defaultoptions.showcarbon}if(this.options.pastechemdraw==null){this.options.pastechemdraw=JSDraw2.defaultoptions.pastechemdraw}if(this.options.width>0){this.div.style.width=this.options.width+"px"}if(this.options.height>0){this.div.style.height=this.options.height+"px"}if(this.options.ondatachange==null){this.options.ondatachange=dojo.attr(this.div,"ondatachange")}if(this.options.data==null){this.options.data=dojo.attr(this.div,"data")}if(this.options.dataformat==null){this.options.dataformat=dojo.attr(this.div,"dataformat")}if(this.options.showimplicithydrogens==null){this.options.showimplicithydrogens=JSDraw2.defaultoptions.showimplicithydrogens!=null?JSDraw2.defaultoptions.showimplicithydrogens:!scil.Utils.isAttFalse(this.div,"showimplicithydrogens")}if(this.options.inktools==null){this.options.inktools=JSDraw2.defaultoptions.inktools!=null?JSDraw2.defaultoptions.inktools:!scil.Utils.isAttFalse(this.div,"inktools")}if(this.options.highlighterrors==null){this.options.highlighterrors=JSDraw2.defaultoptions.highlighterrors!=null?JSDraw2.defaultoptions.highlighterrors:!scil.Utils.isAttFalse(this.div,"highlighterrors")}if(this.options.skin==null){this.options.skin=JSDraw2.defaultoptions.skin!=null?JSDraw2.defaultoptions.skin:dojo.attr(this.div,"skin");if(this.options.skin==null){this.options.skin="w8"}}if(this.options.monocolor==null){this.options.monocolor=scil.Utils.isAttTrue(this.div,"monocolor")}if(this.options.fullscreen==null){this.options.fullscreen=JSDraw2.defaultoptions.fullscreen!=null?JSDraw2.defaultoptions.fullscreen:scil.Utils.isAttTrue(this.div,"fullscreen")}if(this.options.buttonshape==null){this.options.buttonshape=JSDraw2.defaultoptions.buttonshape!=null?JSDraw2.defaultoptions.buttonshape:dojo.attr(this.div,"buttonshape")}if(this.options.buttonshape==null||this.options.buttonshape==""){this.options.buttonshape=scil.Utils.isIE?"circle":"square"}this.options.buttonshape="btnrec";if(this.options.tlcplate){this.options.toolbarmode="tlc"}else{if(this.options.helmtoolbar){this.options.toolbarmode="helm"}else{if(this.options.workflow){this.options.toolbarmode="workflow"}}}if(!(this.options.scale>0)){if(JSDraw2.defaultoptions.scale!=null){this.options.scale=JSDraw2.defaultoptions.scale}else{var q=dojo.attr(this.div,"scale");if(!isNaN(q)){this.options.scale=parseFloat(q)}}}this.options.btnsize=this.isSkinW8()?42:(20*this.options.scale);if(this.options.data==null){var g=dojo.attr(this.div,"molfile");if(g!=null){this.options.data=g;this.options.dataformat="molfile"}}if(this.options.data==null){var n=dojo.attr(this.div,"rxnfile");if(n!=null){this.options.data=n;this.options.dataformat="rxnfile"}}if(this.options.skin=="w8"){JSDraw2.Skin.jsdraw={bkcolor:"#fff"}}this.movingresolution=this.options.movingresolution>0?this.options.movingresolution:6;this.bondlength=JSDraw2.Editor.BONDLENGTH;this.tor=JSDraw2.Editor.TOR;this.linewidth=JSDraw2.Editor.LINEWIDTH;this.fontsize=JSDraw2.Editor.FONTSIZE;this.angleStop=JSDraw2.Editor.ANGLESTOP;var l=scil.Utils.styleRect(this.div);this.dimension=new JSDraw2.Point(l.width,l.height);if(!(this.dimension.x>0)){this.dimension.x=this.div.offsetWidth==0?650:this.div.offsetWidth}if(!(this.dimension.y>0)){this.dimension.y=this.div.offsetHeight==0?320:this.div.offsetHeight}this.div.style.textAlign="left";this.div.style.cursor="default";this.div.style.width=this.dimension.x+"px";this.div.style.height=this.dimension.y+"px";if(scil.helm!=null&&this.options.helm!=false){this.helm=new scil.helm.Plugin(this)}this.m=new JSDraw2.Mol(this.options.showimplicithydrogens);this.status=null;this.modified=false;this.toolbar=null;this.touching=null;this.start=null;this.lastmove=null;this.end=null;this.curObject=null;this.curButton=null;this.movingClone=null;this.resizing=null;this.texteditor={input:null,text:null,atom:null};this.rotating=null,this.mousedownPoint=null;this._lastMousedownTm=null;this.lassolast=null;this.chaintool=null;this.activated=false;this.ink=null;JSDraw2.Security._check();this.undocapacity=10;this._undostack=new JSDraw2.Stack(this.undocapacity);this._redostack=new JSDraw2.Stack(this.undocapacity);if(!this.setMol(this.options.data)){switch((this.options.dataformat+"").toLowerCase()){case"mol":case"molfile":this.setMolfile(this.options.data);break;case"molbase64":this.setMolbase64(this.options.data);break;case"rxn":case"rxnfile":this.setRxnfile(this.options.data);break;case"rxnbase64":this.setRxnbase64(this.options.data);break;case"jdx":this.setJdx(this.options.data);break;case"html":case"xml":case"jsdraw":this.setXml(this.options.data==null?this.div:this.options.data);break;case"helm":this.setHelm(this.options.data==null?this.div:this.options.data);break;case"molurl":this.download(this.options.data,"mol");break;case"rxnurl":this.download(this.options.data,"rxn");break;case"xmlurl":this.download(this.options.data,"xml");break;case"jdxurl":this.download(this.options.data,"jdx");break;default:this.setXml(this.div)}}var d=!this.options.popup&&!this.options.viewonly;this.div.innerHTML="";if(this.options.background!=null){this.div.style.background=this.options.background}else{this.div.style.background="#fff"}if(d&&this.options.showtoolbar){if(this.isSkinW8()){this.dimension.y-=70}else{this.dimension.x-=28;this.dimension.y-=24}}dojo.style(this.div,{width:this.dimension.x+"px",height:this.dimension.y+"px"});var f=this;if(!this.options.viewonly||this.options.popup==true){if(scil.Utils.serviceAvailable()&&scil.DnDFile!=null){new scil.DnDFile(this.div,{url:JSDrawServices.url+"?cmd=openjsd",onupload:function(u){if(!scil.Utils.isChemFile(scil.Utils.getFileExt(u.filename))){return false}},callback:function(u){f.activate(true);JSDraw2.JSDrawIO.jsdFileOpen2(f,u)}})}}if(d){this.toolbar=new JSDraw2.Toolbar(this);this.toolbar.createToolbars(this.div);if(!this.options.showtoolbar){this.toolbar.show(false)}if(window.navigator.msPointerEnabled){dojo.connect(this.div,"onselectstart",function(u){u.preventDefault()});dojo.connect(this.div,"onMSPointerDown",function(u){u=scilligence.mstouch.down(u);if(u!=null&&u.touches.length>1){f.touchStart(u)}else{f.resetGesture()}});dojo.connect(this.div,"onMSPointerMove",function(u){u=scilligence.mstouch.move(u);if(u!=null&&u.touches.length>1){f.touchMove(u)}});dojo.connect(this.div,"onMSPointerUp",function(u){u=scilligence.mstouch.up(u);if(u!=null&&u.touches.length>1){f.touchEnd(u)}});dojo.connect(this.div,"onMSGestureHold",function(u){f.showContextMenu(u);u.preventDefault()})}if(scil.Utils.isTouch){this.activate(false,false);this.connectHandlers.push(dojo.connect(document.body,"ontouchstart",function(u){return f.bodyTouchStart(u)}));this.connectHandlers.push(dojo.connect(this.maintable,"onclick",function(u){return f.touchClick(u)}));this.connectHandlers.push(dojo.connect(this.div,"ontouchstart",function(u){return f.touchStart(u)}));this.connectHandlers.push(dojo.connect(this.div,"ontouchmove",function(u){return f.touchMove(u)}));this.connectHandlers.push(dojo.connect(this.div,"ontouchend",function(u){return f.touchEnd(u)}))}else{this.activate(false,false);this.connectHandlers.push(dojo.connect(document,"onmousedown",function(u){return f.bodyMouseDown(u)}));this.connectHandlers.push(dojo.connect(document,"onkeydown",function(u){f.keydown(u)}));this.connectHandlers.push(dojo.connect(this.div,"onmousedown",function(u){f.mousedown(u)}));this.connectHandlers.push(dojo.connect(this.div,"onmousemove",function(u){f.mousemove(u)}));this.connectHandlers.push(dojo.connect(this.div,"onmouseup",function(u){f.mouseup(u)}));if(scil.Utils.isFirefox){this.connectHandlers.push(dojo.connect(this.div,"onwheel",function(u){f.mousewheel(u)}))}else{this.connectHandlers.push(dojo.connect(this.div,"onmousewheel",function(u){f.mousewheel(u)}))}}dojo.attr(this.div,"__ajaxform","1")}else{if(this.options.popup){if(scil.Utils.isTouch){this.connectHandlers.push(dojo.connect(this.div,"ontouchstart",function(u){if(!scil.Utils.isTouchDblClick(u)){return}f.dblclick();u.preventDefault();return false}))}else{this.connectHandlers.push(dojo.connect(this.div,"ondblclick",function(u){f.dblclick()}))}}if(!scil.Utils.isTouch){this.connectHandlers.push(dojo.connect(this.div,"onmousedown",function(u){f.mousedown(u,true)}));this.connectHandlers.push(dojo.connect(this.div,"onmousemove",function(u){f.mousemove(u,true)}));this.connectHandlers.push(dojo.connect(this.div,"onmouseup",function(u){f.mouseup(u,true)}));if(scil.Utils.isFirefox){this.connectHandlers.push(dojo.connect(this.div,"DOMMouseScroll",function(u){f.mousewheel(u)}))}else{this.connectHandlers.push(dojo.connect(this.div,"onmousewheel",function(u){f.mousewheel(u,true)}))}if(this.options.ondblclick!=null||this.options.dblclickviewlarge){this.connectHandlers.push(dojo.connect(this.div,"ondblclick",function(u){if(f.options.dblclickviewlarge){f.viewLarge()}else{f.options.ondblclick(f)}}))}}}this.connectHandlers.push(dojo.connect(this.div,"onresize",function(){if(!f._clearing){f.onResize()}}));dojo.style(this.div,{userSelect:"none",oUserSelect:"none",MozUserSelect:"none",khtmlUserSelect:"none",webkitUserSelect:"none"});var j=null;if(scil.Utils.isIE&&(scil.Utils.isIE<9||dojox.gfx.renderer!="svg")){j=this._showAllParents(this.div)}this.surface=dojox.gfx.createSurface(this.div,this.dimension.x,this.dimension.y);if(j!=null){this._hideElements(j)}if(scil.Utils.isSilverlight==null){scil.Utils.isSilverlight=this.div.firstChild!=null&&this.div.firstChild.type=="application/x-silverlight"}if(scil.Utils.isSilverlight){if(this.options.popup){this.div.style.position="relative";var t=parseInt(this.div.zIndex+"");if(isNaN(t)){t=0}scil.Utils.createElement(this.div,"div",null,{position:"absolute",left:0,top:0,background:"white",filter:"alpha(opacity=1)",width:this.dimension.x+"px",height:this.dimension.y+"px",zIndex:t+1})}else{if(d){this.surface.connect("onkeydown",function(u){f.keydown(u)})}}}if(this.options.showcontextmenu!=false){scil.Utils.disableContextMenu(this.div)}this.modified=false;if(this.options.scale>0){var q=30/this.bondlength*this.options.scale;if(q!=1){this.scale(this.options.scale)}this.fitToWindow()}this.redraw();this.loaded=true;if(d){if(this.options.toolbarmode=="tlc"){this.doCmd("tlc")}else{this.doCmd("select")}if(!this.options.appmode&&!scil.Utils.isIE){scil.connect(document,"onpaste",function(u){if(f.doPaste(u)){u.preventDefault()}})}}else{this.doCmd("moveview")}var f=this;dojo.connect(document,"onscrollinside",function(u){f.hideTextEditor()})},doPaste:function(w){if(!this.activated){return false}if(this.texteditor.ed!=null&&this.texteditor.ed.input!=null&&this.texteditor.ed.input.style.display!="none"){return false}var h=scil.Utils.getMaxZindex();var x=scil.Utils.getZindex(this.div);if(h>x){return false}var c=w;if(c!=null&&c.clipboardData!=null){w=scil.Utils.trim(c.clipboardData.getData("text/plain"))}var d=false;var g=null;if(!scil.Utils.isNullOrEmpty(w)){g=new JSDraw2.Mol();g.setXml(w);if(g.isEmpty()){g=null}if(g==null){var f={m:new JSDraw2.Mol(),bondlength:this.bondlength};var q=new scil.helm.Plugin(f);var l=scil.helm.IO.read(q,scil.Utils.trim(w),"HELM");if(l>0){g=f.m;d=true}}}var j=this;if(w.indexOf("<CDXML")>0&&scil.Utils.endswith(w,"</CDXML>")){scil.Utils.ajax(JSDrawServices.url+"?cmd=convertfile",function(z){if(z==null&&z.output==null){return}var y=new JSDraw2.Mol();if(y.setXml(z.output)==null){return}var n=j.pasteMol(y);if(n){j.refresh()}},{input:w,inputformat:"cdxml"});return false}if(g==null){g=JSDraw2.Editor.getClipboard()}if(g==null){if(c!=null&&c.clipboardData!=null&&JSDrawServices!=null&&JSDrawServices.url!=null){var u=c.clipboardData.getData("text/rtf");if(!scil.Utils.isNullOrEmpty(u)){scil.Utils.ajax(JSDrawServices.url+"?cmd=paste.rtf2jsdraw",function(z){if(z==null&&z.jsdraw==null){return}var y=new JSDraw2.Mol();if(y.setXml(JSDraw2.Base64.decode(z.jsdraw))==null){return}var n=j.pasteMol(y);if(n){j.refresh()}},{rtf:u})}}return false}var t=this.pasteMol(g);if(t){if(d){scil.helm.Layout.clean(this)}this.moveCenter();this.refresh()}return true},_showAllParents:function(c){var d={display:[],visibility:[],visvalues:[]};while(c!=null&&c.style!=null){if(c.style.display=="none"){d.display.push(c);c.style.display=""}if(c.style.visibility!=""&&c.style.visibility!=null&&c.style.visibility!="visible"){d.visibility.push(c);d.visvalues.push(c.style.visibility);c.style.visibility="visible"}c=c.parentNode}return d},_hideElements:function(d){if(d==null){return}for(var c=0;c<d.display.length;++c){d.display[c].style.display="none"}for(var c=0;c<d.visibility.length;++c){d.visibility[c].style.visibility=d.visvalues[c]}},reset:function(){this.clear(true);this._undostack.clear();this._redostack.clear();if(this.options.toolbarmode=="tlc"){this.doCmd("tlc")}else{this.doCmd("select")}},pushundo:function(d,c){if(this.disableundo){return}if(d==null&&c!=null&&this.lastaction==c){return}this.lastaction=c;this._redostack.clear();this._undostack.push(d==null?this.clone():d)},undo:function(){if(this.disableundo){return}var c=this._undostack.pop();if(c==null){return false}this._redostack.push(this.clone());this.restoreClone(c);this.setModified(true);return true},restoreClone:function(c){this._setmol(c.mol);this.resetScale(c)},redo:function(){if(this.disableundo){return}var c=this._redostack.pop();if(c==null){return false}this._undostack.push(this.clone());this._setmol(c.mol);this.resetScale(c);this.setModified(true);return true},copy:function(c){if(c==null){c=this.m.clone(true);c.bondlength=this.bondlength}JSDraw2.Editor.setClipboard(c,this.bondlength);if(scil.Clipboard!=null&&c!=null&&!c.isEmpty()){scil.Clipboard.copy(c.getXml(null,null,null,null,this.bondlength));return true}return false},cut:function(){if(!this.copy()){return false}this.pushundo();return this.delSelected()>0},paste:function(d){var c=JSDraw2.Editor.getClipboard();return this.pasteMol(c)},pasteMol:function(n,u,f){if(n==null){return false}if(typeof(n)=="string"){var q=new JSDraw2.Mol(this.options.showimplicithydrogens);q.setMolfile(n);n=q}var g=this.m.isEmpty();this.pushundo();if(f==true){this.clear(null,true)}var j=null;if(n.bondlength>0){j=this.bondlength;n.scale(this.bondlength/n.bondlength)}else{var l=n.medBondLength();if(!(l>0)){l=1.56}var j=this.m.medBondLength();if(!(j>0)){j=this.bondlength}n.scale(j/l)}if(u==null){n.moveCenter(this.dimension.x,this.dimension.y);n.offset(10,10)}else{var d=n.center();n.offset(u.x-d.x,u.y-d.y)}n.showimplicithydrogens=this.options.showimplicithydrogens;this.m.setSelected();n.setSelected(true);n.calcHCount(true);var w=null;var x=this.m.parseRxn(true);var y=n.parseRxn(true);if((f=="reactant"||f=="product")&&y!=null&&y.arrow==null){if(f=="reactant"){scil.Utils.mergeArray(x.reactants,y.reactants)}else{scil.Utils.mergeArray(x.products,y.reactants)}w=x}else{if(x!=null&&(x.reactants.length>0||x.products.length>0)){if(x.arrow!=null){if(y.arrow==null){if(x.reactants.length==0){x.reactants=y.reactants}else{scil.Utils.mergeArray(x.products,y.reactants)}w=x}}else{if(y.arrow!=null){if(x.arrow==null){if(y.reactants.length==0){y.reactants=x.reactants}else{scil.Utils.mergeArray(y.products,x.reactants)}}w=y}}}}if(w!=null){this.m.setRxn(w,j);this.fitToWindow()}else{var A=[];for(var h=n.graphics.length-1;h>=0;--h){var z=JSDraw2.TLC.cast(n.graphics[h]);if(z!=null){n.graphics.splice(h,1);A.splice(0,0,z)}}this.m.mergeMol(n);for(var h=0;h<A.length;++h){this.addTlcPlate(A[h])}if(n.chiral!=null){this.m.chiral=n.chiral}if(g){this.fitToWindow()}}this.setModified(true);return true},resetScale:function(c){this.bondlength=c==null?JSDraw2.Editor.BONDLENGTH:c.bondlength;this.tor=c==null?JSDraw2.Editor.TOR:c.tor;this.linewidth=c==null?JSDraw2.Editor.LINEWIDTH:c.linewidth;this.fontsize=c==null?JSDraw2.Editor.FONTSIZE:c.fontsize;this.angleStop=c==null?JSDraw2.Editor.ANGLESTOP:c.angleStop},clone:function(){return{mol:this.m.clone(),bondlength:this.bondlength,tor:this.tor,linewidth:this.linewidth,fontsize:this.fontsize,angleStop:this.angleStop}},showTextEditor:function(j,q,y){var B=this.texteditor.text=JSDraw2.Text.cast(j);if(B!=null&&B.readonly){return}if(this.texteditor.hidetime!=null){var C=this.texteditor.hidetime;this.texteditor.hidetime=null;if(new Date().getTime()-C<500){return}}var c=this.texteditor.atom=JSDraw2.Atom.cast(j);var A=JSDraw2.Text.cast(j);var x=this.texteditor.shape=JSDraw2.Shape.cast(j);var d=A!=null&&A.anchors!=null&&A.anchors.length==1?JSDraw2.Bracket.cast(A.anchors[0]):null;if(c!=null){q.x-=6*this.bondlength/30;q.y-=9*this.bondlength/30}else{if(x!=null){q.x=x._rect.left+x._rect.width/10;q.y=x._rect.center().y-9*this.bondlength/30}}var h=this;if(this.texteditor.ed==null){var f=scil.Utils.createElement(document.body,"input");this.texteditor.ed=new scil.DropdownInput(f,{onclickitem:function(t){return h.clickTextItem(t)}});dojo.style(this.texteditor.ed.input,{position:"absolute",display:"none",zIndex:999});this.connectHandlers.push(dojo.connect(this.texteditor.ed.input,"onkeydown",function(t){return h.txtKeypress(t)}))}var n=this.texteditor.ed.options;if(c!=null){var g=null;if(c.bio!=null&&this.helm!=null){g=scil.helm.Monomers.getMonomerList(c)}else{g=JSDraw2.defaultoptions.atomlist!=null?JSDraw2.defaultoptions.atomlist:JSDraw2.PT.getCommonUsedElements("list")}this.texteditor.ed.setItems(g);n.onSetValue=function(t,z){t.value=z};n.minautowidth=JSDraw2.defaultoptions.minautowidth1>0?JSDraw2.defaultoptions.minautowidth1:100;if(c.bio!=null){n.onFilter=null}else{n.onFilter=function(t){return h.filterAtomType(t)}}}else{if(x!=null){this.texteditor.ed.setItems(null)}else{if(d!=null){if(A.fieldtype=="BRACKET_TYPE"){this.texteditor.ed.setItems(JSDraw2.SGroup==null?null:JSDraw2.SGroup.getDisplayTypes());n.onSetValue=function(t,E){var F="";if(scil.Utils.endswith(E,")")){var z=E.lastIndexOf("(");if(z>0){F=E.substr(z+1,E.length-z-2)}}t.value=F};n.minautowidth=JSDraw2.defaultoptions.minautowidth2>0?JSDraw2.defaultoptions.minautowidth2:150;n.onFilter=null}else{if(A.fieldtype=="MOL_TYPE"){this.texteditor.ed.setItems(JSDraw2.MOLECULETYPES);n.onSetValue=function(t,z){if(scil.Utils.isNullOrEmpty(z)){this.mol.delGraphics(A)}else{t.value=z}};n.minautowidth=JSDraw2.defaultoptions.minautowidth2>0?JSDraw2.defaultoptions.minautowidth2:150;n.onFilter=null}}}else{this.texteditor.ed.setItems(JSDraw2.defaultoptions.textlist!=null?JSDraw2.defaultoptions.textlist:JSDraw2.TEXTKEYWORDS);n.onSetValue=function(t,z){if(scil.Utils.indexOf(n.items,z)>=0){t.value+=z}else{t.value=z}};n.minautowidth=JSDraw2.defaultoptions.minautowidth3>0?JSDraw2.defaultoptions.minautowidth3:300;n.autosuggest=this.options.reagentsuggest;n.onFilter=n.autosuggest!=null?null:function(){}}}}var D=scil.Utils.getZindex(this.div);this.texteditor.ed.input.style.zIndex=D>0?(D+1):1;if(B!=null){q=new JSDraw2.Point(B._rect.left,B._rect.top)}else{q.offset(-2,-2)}var l=scil.Utils.getOffset(this.div,true,true);dojo.style(this.texteditor.ed.input,{fontSize:this.fontsize+"px"});dojo.style(this.texteditor.ed.input,{left:(q.x+l.x)+"px",top:(q.y+l.y)+"px",display:""});var w=true;if(B!=null){this.texteditor.ed.input.value=y==null?B.text:y}else{if(c!=null){var u=c.getLabel();if(c.charge>0){if(c.charge>1){u+=c.charge}else{u+="+"}}else{if(c.charge<0){if(c.charge>1){u+=c.charge}else{u+="-"}}}this.texteditor.ed.input.value=u}else{if(x!=null){this.texteditor.ed.input.value=x.text}else{if(y!=null){this.texteditor.ed.input.value=y;w=false}}}}this.txtAutosize();if(w){this.texteditor.ed.input.select()}this.texteditor.ed.input.style.display="";this.texteditor.ed.input.focus();this.texteditor.showtime=new Date().getTime()},filterAtomType:function(c){if(this.texteditor.atom==null){return}return JSDraw2.SuperAtoms.filter(c,JSDraw2.defaultoptions.suggestcount>0?JSDraw2.defaultoptions.suggestcount:10)},createImageTo:function(d){if(!scil.Utils.serviceAvailable()||d==null){return}if(typeof(d)=="string"){d=scil.byId(d)}var c=this.getXml();scil.Utils.ajax(JSDrawServices.url+"?cmd=jsdraw2img",function(f){scil.Utils.createElement(d,"img",null,null,{src:f.src,jsdraw:JSDraw2.Base64.encode(c)})},{jsdraw:c})},clickTextItem:function(d){if(this.texteditor.atom!=null){if(d=="..."){this.hideTextEditor(true);this.m.setSelected(false);this.texteditor.atom.selected=true;this.refresh(false);var c=this;this.showPT(function(f){c.menuSetAtomType2(f)})}else{this.hideTextEditor()}}else{this.txtAutosize()}},insertSymbol:function(f){if(this.texteditor.ed==null||this.texteditor.ed.input.style.display=="none"){return false}this.texteditor.ed.input.focus();var c=JSDraw2.Symbol.getCaretPosition(this.texteditor.ed.input);var d=this.texteditor.ed.input.value;if(c>0&&c<d.length){this.texteditor.ed.input.value=d.substr(0,c)+f+d.substr(c);++c;JSDraw2.Symbol.setCaretPosition(this.texteditor.ed.input,c)}else{this.texteditor.ed.input.value+=f}this.txtAutosize();return false},hideTextEditor:function(c){if(this.texteditor.ed==null||this.texteditor.ed.input.style.display=="none"){return}if(this.texteditor.showtime!=null){var n=this.texteditor.showtime;this.texteditor.showtime=null;if(new Date().getTime()-n<500){return}}this.texteditor.ed.hide();this.texteditor.ed.input.style.display="none";this.texteditor.ed.input.style.display="none";this.texteditor.hidetime=new Date().getTime();var l=scil.Utils.trim(this.texteditor.ed.input.value);this.texteditor.ed.input.value="";if(c==true){return}if(this.options.onvalidatetext!=null){if(this.options.onvalidatetext(l,this.texteditor,this)==false){return}}if(JSDraw2.Symbol!=null){JSDraw2.Symbol.hide()}if(this.texteditor.atom!=null){if(l==""){l="C"}var d=this.clone();if(this.texteditor.atom.bio!=null){if(this.helm!=null&&scil.helm.isHelmNode(this.texteditor.atom)){g=this.helm.setNodeTypeFromGui(this.texteditor.atom,l)}}else{l=JSDraw2.FormulaParser.stripHs(l);var g=this.m.setAtomAlias(this.texteditor.atom,l)||this.m.setAtomType(this.texteditor.atom,l,true)}if(g){this.pushundo(d);this.refresh(true)}}else{if(this.texteditor.shape!=null){if(this.texteditor.shape.text!=l){this.pushundo();this.texteditor.shape.text=l;this.refresh(true)}}else{if(this.texteditor.text==null){if(l.length==0){return}var h=scil.Utils.getOffset(this.div,true);var j=scil.Utils.styleRect(this.texteditor.ed.input);j.offset(-h.x,-h.y);var q=new JSDraw2.Text(j,l);this.pushundo();this.m.addGraphics(q);this.refresh(true)}else{if(l==this.texteditor.text.text){return}this.pushundo();if(l.length==0){this.texteditor.text._parent.delObject(this.texteditor.text)}else{this.texteditor.text.text=l}if(this.texteditor.text.fieldtype=="BRACKET_TYPE"&&this.texteditor.text.anchors.length==1&&JSDraw2.Bracket.cast(this.texteditor.text.anchors[0])!=null){if(scil.Utils.isNumber(l)){this.texteditor.text.anchors[0].type="mul"}else{this.texteditor.text.anchors[0].type=l}}this.texteditor.text=null;this.refresh(true)}}}},showTemplatesDlg:function(){JSDraw2.CustomTemplates.show(false,this)},showSymbolDlg:function(){var c=this.texteditor==null||this.texteditor.ed==null?null:this.texteditor.ed.input;var f=c==null||c.style.display=="none"?null:{x:c.offsetLeft,y:c.offsetTop+c.offsetHeight+5};var d=this;JSDraw2.Symbol.show(false,function(g){return d.insertSymbol(g)},f)},txtKeypress:function(c){if((c.keyCode==40||c.keyCode==38)&&(c.ctrlKey||c.metaKey)&&JSDraw2.Symbol!=null){if(c.keyCode==40){this.showSymbolDlg()}else{JSDraw2.Symbol.hide()}c.preventDefault();return false}if(c.keyCode==27||c.keyCode==13){this.hideTextEditor(c.keyCode==27);c.time2=903;c.preventDefault();return false}this.txtAutosize()},txtAutosize:function(){var c=scil.Utils.textWidth(this.texteditor.ed.input.value)*this.fontsize*0.6+this.fontsize*3;this.texteditor.ed.input.style.width=(c<100?100:c)+"px";this.texteditor.ed.updateDropdownSize()},_setmol:function(c){this.m=c;this.m.showimplicithydrogens=this.options.showimplicithydrogens;this.start=null;this.end=null;this.status=null;this.curObject=null},scale:function(d,c){if(d<=0||d==1){return}if(this.bondlength*d<JSDraw2.speedup.minbondlength){d=JSDraw2.speedup.minbondlength/this.bondlength}this.m.scale(d,c);this.bondlength*=d;this.tor*=d;this.linewidth*=d;this.fontsize*=d;if(c==null){this.moveCenter()}},setModified:function(f){this.modified=f;if(f==false){return}if(this.options.ondatachange!=null&&this.loaded){if(typeof this.options.ondatachange=="function"){this.options.ondatachange(this)}else{try{eval(this.options.ondatachange)(this)}catch(e){}}}},refresh:function(c){this.m.stats=null;if(c==true||c==false){this.setModified(c)}this.redraw()},calcTextRect:function(){if(this.surface==null||scil.Utils.isIE8Lower&&this.surface.rawNode==null){return}var c=this.createGroup();this.m.draw(c,this.linewidth,this.fontsize,true,null,null,true);this.surface.remove(c)},createGroup:function(d){var c=(d==null?this.surface:d).createGroup();if(dojox.gfx.renderer=="svg"){c.rawNode.setAttribute("__surface_parentid",this.id)}return c},moveview:function(c){this.viewoffset=c;if(this.viewoffset!=null){this.surface.rootgroup.setTransform([dojox.gfx.matrix.translate(this.viewoffset.x,this.viewoffset.y)])}else{this.surface.rootgroup.setTransform([dojox.gfx.matrix.translate(0,0)])}},redraw:function(f){if(this.surface==null||scil.Utils.isIE8Lower&&this.surface.rawNode==null){return}if(this.surface.rootgroup==null){this.surface.rootgroup=this.createGroup();if(JSDraw2.Security.error!=null){this.surface.createText({x:5,y:25,text:JSDraw2.Security.error,align:"start"}).setFont({family:"Arial",size:"20px",weight:"normal"}).setFill("#ffe0e0")}}if(this.viewoffset!=null){this.surface.rootgroup.setTransform([dojox.gfx.matrix.translate(this.viewoffset.x,this.viewoffset.y)])}else{this.surface.rootgroup.setTransform(null)}this._clearing=true;if(f){if(this.surface.extra!=null){this.surface.extra.clear();this.surface.extra.lasso=null}}else{this.surface.rootgroup.clear();this.surface.extra=null;this._clearing=false;var h=this.createGroup(this.surface.rootgroup);h.monocolor=this.options.monocolor||JSDraw2.defaultoptions.monocolor;this.simpledraw=this.fontsize<=JSDraw2.speedup.fontsize;this.updateGroupRect();this.m.draw(h,this.linewidth,this.fontsize,null,this.dimension,this.options.highlighterrors,this.options.showcarbon,this.simpledraw)}var c=this.getCmd();if(this.surface.extra==null){this.surface.extra=this.createGroup(this.surface.rootgroup)}var d=this.surface.extra;if(this.curObject!=null){this.curObject.drawCur(d,this.fontsize/2+1,JSDraw2.Editor.COLORCURRENT,this.m,c,this.fontsize)}if(this.start!=null&&this.end!=null){switch(c){case"arrow":if(this.arrowtool!=null&&this.arrowtool.connector=="rejector"){JSDraw2.Drawer.drawArrow(d,this.start,this.end,"gray",this.linewidth,this.linewidth*2)}else{JSDraw2.Drawer.drawArrow(d,this.start,this.end,"gray",this.linewidth)}break;case"curve":JSDraw2.Drawer.drawCurveArrow(d,this.start,this.end,null,null,"gray",this.linewidth/2);break;case"rectangle":JSDraw2.Drawer.drawRect(d,new JSDraw2.Rect().set(this.start,this.end),"gray",this.linewidth/2,5);break;case"assaycurve":JSDraw2.Drawer.drawRect(d,new JSDraw2.Rect().set(this.start,this.end),"gray",this.linewidth/4);break;case"spectrum":JSDraw2.Drawer.drawRect(d,new JSDraw2.Rect().set(this.start,this.end),"gray",this.linewidth/4);break;case"ellipse":JSDraw2.Drawer.drawEllipse(d,new JSDraw2.Rect().set(this.start,this.end),"gray",this.linewidth/2);break;case"diamond":JSDraw2.Drawer.drawDiamond(d,new JSDraw2.Rect().set(this.start,this.end),"gray",this.linewidth/2);break;case"dreversed":JSDraw2.Drawer.drawDShape(d,new JSDraw2.Rect().set(this.start,this.end),"gray",this.linewidth/2,true);break;case"dshape":JSDraw2.Drawer.drawDShape(d,new JSDraw2.Rect().set(this.start,this.end),"gray",this.linewidth/2);break;case"doublearrow":JSDraw2.Drawer.drawDoubleArrow(d,new JSDraw2.Rect().set(this.start,this.end),"gray",this.linewidth);break;case"tlc":case"electrophoresis":if(this.movingClone==null){new JSDraw2.TLC.create(c,this.start,this.end,this.fontsize/2).draw(d,this.linewidth,null,this.fontsize)}break;case"select":case"lasso":case"selfrag":case"zoombox":if(this.movingClone==null){JSDraw2.Drawer.drawRect(d,new JSDraw2.Rect().set(this.start,this.end),"#aaaaff",1)}break;case"bracket":JSDraw2.Drawer.drawBracket(d,new JSDraw2.Rect().set(this.start,this.end),"gray",this.linewidth);break;case"chain":if(this.chaintool!=null){var l=this.chaintool.points;for(var j=1;j<l.length;++j){JSDraw2.Drawer.drawLine(d,l[j-1],l[j],"gray",this.linewidth)}}if(!(scil.Utils.isIE&&scil.Utils.isIE<9&&this.options.appmode)){JSDraw2.Drawer.drawText(d,l[l.length-1],l.length-1,"gray",this.fontsize)}break;default:if(c=="sgroup"){JSDraw2.Drawer.drawArrow(d,this.start,this.end,"red",this.linewidth/2)}else{if(c!="rotate"&&c!="eraser"&&c!="plus"&&c!="rxnmap"&&c!="text"&&c!="undo"&&c!="redo"&&c!="zoomin"&&c!="zoomout"){JSDraw2.Drawer.drawLine(d,this.start,this.end,"gray",this.linewidth)}}break}}if(this.status!=null&&this.status.length>0){var n=this.dimension.y-10;d.createText({x:5,y:n,text:this.status,align:"bottom"}).setFont({family:"Arial",size:"14px",weight:"normal"}).setFill("#000")}},fitToWindow:function(d){var f=this.m.rect();if(f==null){return}if(d==null){d=JSDraw2.Editor.BONDLENGTH;if(this.options.scale>0){d*=this.options.scale}}f.inflate(this.bondlength,this.bondlength);var c=f.width/this.dimension.x;var h=f.height/this.dimension.y;var g;if(c==0){g=h}else{if(h==0){g=c}else{g=Math.max(h,c)}}if(d>0&&this.bondlength/g>d){g=this.bondlength/d}if(g==1){this.moveCenter()}else{this.scale(1/g)}},moveCenter:function(){this.m.moveCenter(this.dimension.x,this.dimension.y)},updateGroupRect:function(){for(var d=0;d<this.m.graphics.length;++d){var c=JSDraw2.Group.cast(this.m.graphics[d]);if(c!=null){c._updateRect(this.m,this.bondlength)}}},cleanupRxn:function(){var c=this.m.cleanupRxn(this.bondlength);if(c){this.fitToWindow(this.bondlength)}return c},setRxn:function(j,g,d,c,h){this.pushundo();if(d!=null){this.bondlength=d}if(c){for(var f=0;f<j.reactants.length;++f){j.reactants[f].removeTextByFieldType("RXNLABEL")}for(var f=0;f<j.products.length;++f){j.products[f].removeTextByFieldType("RXNLABEL")}}this.m.setRxn(j,this.bondlength,h);this.calcTextRect();this.m._layoutRxn(j,this.bondlength);if(c){for(var f=0;f<j.reactants.length;++f){this.m._addRxnLabel(j.reactants[f],this.bondlength/2)}for(var f=0;f<j.products.length;++f){this.m._addRxnLabel(j.products[f],this.bondlength/2)}}this.fitToWindow(this.bondlength);if(g!=false){this.redraw()}},clear:function(f,c){var d=this.m.isEmpty();this.m.clear();this.curObject=null;if(f){this.redraw()}this.resetScale();if(this.options.scale>0){this.scale(this.options.scale)}if(this.ink!=null){this.ink.clear()}if(!d){if(c&&this.options.onClear!=null){this.options.onClear()}}},toggleAtom:function(c){return this.m.toggleAtom(c,this.simpledraw?JSDraw2.Editor.TOR:this.tor)},toggle:function(c){return this.m.toggle(c,this.simpledraw?JSDraw2.Editor.TOR:this.tor,this.fontsize)},fixWedgeDir:function(f){var c=this.m.getNeighborAtoms(f.a1,f.a2);var d=this.m.getNeighborAtoms(f.a2,f.a1);if((c.length==0||c.length==1)&&c.length<d.length){f.reverse()}},getFragment:function(c){var d=this.m.splitFragments();for(var f=0;f<d.length;++f){if(d[f].containsAtom(c)){return d[f]}}return null},getCenter:function(d){var g=0;var h=0;if(d==null){d=this.m.atoms}if(d.length==0){return null}for(var f=0;f<d.length;++f){var c=d[f];g+=c.p.x;h+=c.p.y}return new JSDraw2.Point(g/d.length,h/d.length)},rotate:function(c,g,d){if(c==null){c=this.m.atoms}if(Math.abs(d)<0.1||c.length==0){return false}for(var f=0;f<c.length;++f){c[f].p.rotateAround(g,d)}return true},startResize:function(j,l,g,d){if(j.resize==null){return}var f=j.cornerTest(l,this.tor,g,d);if(f!=null){var h=[];this.resizing={corner:f,obj:j,start:l,list:h};var c=JSDraw2.Bracket.cast(j);if(c!=null){this.resizing.texts=c.getTexts(this.m)}}},getConnectingAtomBonds:function(g){var f=[];if(g!=null&&g.length>0){var h=g[0]._parent;h.clearFlag();for(var d=0;d<g.length;++d){g[d].f=true}for(var d=0;d<h.bonds.length;++d){var c=h.bonds[d];if(c.a1.f!=c.a2.f){f.push({a:c.a1.f?c.a1:c.a2,b:c})}}}return f},mousewheel:function(f,h){if(!this.activated&&!h){return}var c=this.getCmd();if(c!="moveview"){return}var d=(f.wheelDelta||-f.detail||(Math.abs(f.deltaY)>Math.abs(f.deltaX)?f.deltaY:f.deltaX));if(scil.Utils.isFirefox){d*=20}if(d>0||d<0){var g=this.eventPoint(f);this.scale(1+d/500,g);if(!h){this.pushundo(null,"moveview");this.refresh(true)}else{this.redraw()}}if(scil.Utils.isFirefox){f.stopImmediatePropagation();f.stopPropagation()}f.preventDefault()},mousedown:function(t,F){if(!this.activated){this.mousedownPoint=new JSDraw2.Point(t.clientX,t.clientY);if(F&&t.button==0){this.start=this.eventPoint(t)}return}if(this.contextmenu!=null&&this.contextmenu.hide()){return}JSDraw2.Menu.close();this.holding.start(t,this);if(!scil.Utils.isTouch&&t.button!=(scil.Utils.isIE8Lower?1:0)){return}this.start=null;this.end=null;this.movingClone=null;this.resizing=null;this.lassolast=null;var n=this.getCmd();var D=new Date().getTime();var E=this._lastMousedownTm;this._lastMousedownTm=D;if(D-E<JSDraw2.Editor.dblclickdelay&&(n=="select"||n=="lasso"||n=="selfrag")){if(this.surface.extra!=null){this.surface.extra.lasso=null}this.mousedblclick(t);t.preventDefault();return}var C=this.eventPoint(t);if(n=="moveview"){this.start=C;this.viewoffset=null;return}if(scil.Utils.startswith(n,"spot-")){this.start=C;return}if(n=="inkred"||n=="inkblue"||n=="inkgreen"){if(this.ink==null){this.surface.ink=this.createGroup();this.ink=new JSDraw2.Ink(this.surface.ink)}this.ink.start(n.substr(3),C);return}var B=this.toggle(C);if(n=="eraser"){this.start=C;this.erasercache={count:0,cloned:this.clone(),singleton:false};if(B!=null){if(JSDraw2.TLC.cast(B)!=null){B.cornerTest(C,this.tor,false,"eraser");if(B.curspot!=null){this.erasercache.singleton=true}}this.delObject(B);++this.erasercache.count;this.redraw()}this.div.style.cursor="pointer";return}this.curObject=B;this.div.style.cursor="crosshair";if(B!=null){if(n=="select"||n=="lasso"||n=="selfrag"||(n=="tlc"||n=="electrophoresis")&&JSDraw2.TLC.cast(B)!=null){if(B.selected&&B.resize!=null&&this.m.countSelected()==1){this.startResize(B,C,t.ctrlKey||t.metaKey,n)}if(this.resizing==null&&!B.selected){var c=null;var w=null;if(n=="selfrag"){var c=JSDraw2.Atom.cast(B);var h=JSDraw2.Bond.cast(B);var w=JSDraw2.Group.cast(B);var j=JSDraw2.Bracket.cast(B);if(h!=null){c=h.a1}}if(!t.shiftKey){this.m.setSelected(false)}if(c!=null){if(c!=null){var A=c._parent.getFragment(c,c._parent);for(var x=0;x<A.atoms.length;++x){A.atoms[x].selected=true}for(var x=0;x<A.bonds.length;++x){A.bonds[x].selected=true}}if(this.options.onselectionchanged!=null){this.options.onselectionchanged(this)}this.redraw()}else{if(w!=null){for(var x=0;x<w._parent.atoms.length;++x){if(w._parent.atoms[x].group==w){w._parent.atoms[x].selected=true}}}else{if(j!=null){for(var x=0;x<j.atoms.length;++x){if(j.atoms[x].group==w){j.atoms[x].selected=true}}}else{B.selected=true;var h=JSDraw2.Bond.cast(B);if(h!=null){h.a1.selected=h.a2.selected=true}else{this.startResize(B,C,t.ctrlKey||t.metaKey,n=="tlc"||n=="electrophoresis")}}}}}if(n!="tlc"&&n!="electrophoresis"||this.resizing!=null){this.start=C;this.movingClone=this.clone();this.movingClone.startPt=C.clone();this.div.style.cursor="moveview"}if(n=="tlc"||n=="electrophoresis"){this.redraw()}return}}var d=JSDraw2.Atom.cast(B);if(d!=null){C.x=d.p.x;C.y=d.p.y;C.atom=d}this.lastmove=this.start=C;if(this.start.tm==null){this.start.tm=new Date().getTime()}if(n=="lasso"&&B==null){if(!t.shiftKey&&this.m.setSelected(false)>0){this.redraw()}this.lassolast=C;return}if(n=="chain"){this.chaintool={a:d,start:this.start,p2:null,end:null,points:[]};return}if(n=="rotate"&&d==null&&!this.m.isEmpty()){var f=this.m.atoms;var z=[];for(var x=0;x<f.length;++x){if(f[x].selected){z.push(f[x])}}if(z.length==0){var l=this.getCenter(null);if(l!=null){this.rotating={atoms:null,center:l}}}else{if(z.length==1){var l=z[0].p.clone();if(z.length==1){var u=this.getFragment(z[0]);if(u!=null){z=u.atoms}}this.rotating={atoms:z.length==1?null:z,center:l}}else{var y=this.getConnectingAtomBonds(z,false);if(y.length==1){this.rotating={atoms:z,center:y[0].a.p.clone()}}else{this.rotating={atoms:z,center:this.getCenter(z)}}}}if(this.rotating!=null){this.rotating.cloned=this.clone()}if(d!=null){this.m.setSelected();d.selected=true;this.redraw()}return}if(n=="arrow"){this.arrowtool={from:B};if(JSDraw2.Shape.cast(B)!=null){var q=B.bestConnectPoint(this.start,this.tor);this.start=q.p;this.arrowtool.connector=q.connector}}if(n!="rxnmap"&&!(t.ctrlKey||t.metaKey)){if(!t.shiftKey&&this.m.setSelected()>0){this.redraw()}}},selectCurrent:function(d,c){if(this.curObject==d){return false}this.curObject=d;if(this.options.onselectcurrent!=null){this.options.onselectcurrent(c,d,this)}if(this.options.showhelmpopup){this.onHelmSelectCurrent(c,d)}return true},onHelmSelectCurrent:function(d,g){var c=JSDraw2.Atom.cast(g);if(c==null||this.start!=null||this.contextmenu!=null&&this.contextmenu.isVisible()){scil.helm.MolViewer.hide();return}var l=c==null?null:c.biotype();if(l==null){return}var j=scil.helm.Monomers.getMonomerSet(l);var h=c==null?null:c.elem;var f=j==null?null:j[scil.helm.symbolCase(h)];scil.helm.MolViewer.show(d,l,f,h,this,c)},mousemove:function(h,t){if(!this.activated){if(t){if(this.start!=null&&!this.frozen){var q=this.eventPoint(h);this.moveview(new JSDraw2.Point(q.x-this.start.x,q.y-this.start.y));h.preventDefault()}else{if(this.options.showhelmpopup){var q=this.eventPoint(h);var n=this.toggle(q);this.onHelmSelectCurrent(h,n)}}}return}this.holding.move(h);var d=this.getCmd();var q=this.eventPoint(h);if(d=="moveview"){if(this.start!=null&&h.button==0){this.moveview(new JSDraw2.Point(q.x-this.start.x,q.y-this.start.y));h.preventDefault()}return}if(d=="inkblue"||d=="inkred"||d=="inkgreen"){if(this.ink!=null){this.ink.add(q)}return}this.lastmove=q;var j=false;var n=null;if(this.start==null||d!="select"&&d!="lasso"&&d!="selfrag"){n=this.toggle(q);j=this.selectCurrent(n,h)}if(this.start!=null){if(d=="arrow"){if(this.start!=null){this.end=this.guessArrow(this.start,q);j=true}}else{if(d=="zoombox"||d=="curve"){if(this.start!=null){this.end=q;j=true}}else{if(d=="rotate"){if(this.rotating!=null){if(this.rotating.a1==null){this.rotating.a0=this.rotating.a1=q.angleTo(this.rotating.center)}else{var c=q.angleTo(this.rotating.center);j=this.rotate(this.rotating.atoms,this.rotating.center,c-this.rotating.a1);if(j){j="all"}this.rotating.a1=c}}}else{if(d=="select"||d=="lasso"||d=="selfrag"||d=="tlc"||d=="electrophoresis"){if(this.start!=null){if(this.lassolast){this.end=q;this.lassoSelect(this.lassolast);this.lassolast=q}else{if(this.resizing!=null){if(!this.resizing.start.equalsTo(q)){var g=q.clone().offset(-this.resizing.start.x,-this.resizing.start.y);this.resizing.obj.resize(this.resizing.corner,g,this.resizing.texts);if(h.shiftKey&&JSDraw2.Shape.cast(this.resizing.obj)!=null){this.resizing.obj._rect.height=this.resizing.obj._rect.width}this.resizing.start=q;this.resizing.changed=true;j="all"}}else{if(this.movingClone!=null){if(this.end==null){this.end=this.start;if(h.ctrlKey||h.metaKey){var l=this.m.clone(true);l.showimplicithydrogens=this.options.showimplicithydrogens;if(!l.isEmpty()){this.m.setSelected();l.setSelected(true);l.calcHCount(true);this.m.mergeMol(l)}}}if(!this.end.equalsTo(q)){this.m.offset(q.x-this.end.x,q.y-this.end.y,true);this.end=q}j="all"}else{this.end=q;j=true}}}}}else{if(d=="rectangle"||d=="ellipse"||d=="diamond"||d=="dshape"||d=="dreversed"){if(h.shiftKey){q.equalMove(this.start)}this.end=q;j=true}else{if(d=="bracket"||d=="sgroup"||d=="assaycurve"||d=="spectrum"||d=="doublearrow"||d=="tlc"||d=="electrophoresis"){this.end=q;j=true}else{if(d=="chain"){this.end=q;j=this._makeChain(this.chaintool,q)}else{if(d=="eraser"){if(this.erasercache!=null&&!this.erasercache.singleton){n=this.toggle(q);if(n!=null){this.delObject(n);++this.erasercache.count;j="all"}}}else{if(scil.Utils.startswith(d,"spot-")){}else{if(JSDraw2.Atom.cast(this.curObject)!=null){this.end=this.curObject.p.clone()}else{this.end=this._guessBond(this.start,q)}j=true}}}}}}}}}}if(j!=false&&!(this.start!=null&&q.tm-this.start.tm<JSDraw2.Editor.undoGestureTime)){this.redraw(j!="all")}},mouseup:function(J,ad){this.holding.end();if(!scil.Utils.isTouch&&J.button==2){if(!ad){if(!this.activated){this.activate(true)}}if(this.touch.start1==null){this.showContextMenu(J,ad)}J.preventDefault();return}if(!this.activated){if(this.mousedownPoint!=null&&this.mousedownPoint.x==J.clientX&&this.mousedownPoint.y==J.clientY){this.activate(true)}if(ad&&J.button==0){this.endMove(J,ad);J.preventDefault()}return}var E=this.getCmd();if(E=="moveview"){this.endMove(J,ad);J.preventDefault();return}if(E=="inkred"||E=="inkblue"||E=="inkgreen"){if(this.ink!=null){this.ink.end()}return}if(this.start==null){return}this.div.style.cursor="default";var T=this.start;var U=this.lastmove==null?T.clone():this.lastmove;this.lastmove=null;this.start=null;var H=Math.abs(T.x-U.x);if((U.tm-T.tm<JSDraw2.Editor.undoGestureTime)&&Math.abs(H)>2*10&&H>5*Math.abs(T.y-U.y)&&this.toggle(T)==null&&this.toggle(U)==null){if(T.x>U.x){this.undo()}else{this.redo()}this.refresh(false);return}var K=null;if(E=="text"){this.showTextEditor(this.curObject,new JSDraw2.Point(U.x,U.y));return}if(E=="sgroup"){if(T.equalsTo(U)){this.showTextEditor(this.curObject,new JSDraw2.Point(U.x,U.y))}else{var Q=T.atom!=null?T.atom:this.toggle(T);var R=this.toggle(U);if(JSDraw2.Text.cast(Q)!=null){var D=this.clone();if(Q.attach(R)){this.pushundo(D)}}this.refresh(true)}return}if(E=="eraser"){if(this.erasercache!=null){if(this.erasercache.count>0){this.pushundo(this.erasercache.cloned);this.curObject=null;if(this.helm!=null){this.helm.resetIDs()}this.refresh(true)}this.erasercache=null}return}if(E=="plus"){if(this.curObject==null){this.pushundo();this.m.addGraphics(new JSDraw2.Plus(U));this.refresh(true)}return}if(E=="rxnmap"){this.doRxnMap(this.curObject);return}var G=T.distTo(U);if(E=="arrow"||E=="curve"){if(this.arrowtool!=null&&this.arrowtool.from!=null){var L=JSDraw2.Shape.cast(this.arrowtool.from);var ac=JSDraw2.Shape.cast(this.curObject);var F=this.arrowtool.connector;this.arrowtool=null;if(L!=null&&L!=ac){if(F=="rejector"){if(L.reject!=L){this.pushundo();if(L.reject==ac){L.reject=null}else{L.reject=ac}this.refresh(true);return}}else{this.pushundo();if(ac==null){var Y=L.rect();var H=0;var I=0;var V=U.clone();if(U.x<T.x){V.x-=Y.width}if(U.y<T.y){V.y-=Y.height}ac=this.m.addGraphics(new JSDraw2.Shape(new JSDraw2.Rect(V.x,V.y,Y.width,Y.height),"rectangle"))}if(ac!=null){this.pushundo();if(this.isShapeConnected(L,ac)){scil.Utils.delFromArray(ac.froms,L)}else{if(this.isShapeConnected(ac,L)){scil.Utils.delFromArray(L.froms,ac)}if(Math.abs(T.y-U.y)<this.tor){if(this.isIsolatedShape(ac)){var I=L._rect.center().y-ac._rect.center().y;ac._rect.offset(0,I)}else{if(this.isIsolatedShape(L)){var I=ac._rect.center().y-L._rect.center().y;L._rect.offset(0,I)}}}else{if(Math.abs(T.x-U.x)<this.tor){if(this.isIsolatedShape(ac)){var H=L._rect.center().x-ac._rect.center().x;ac._rect.offset(H,0)}else{if(this.isIsolatedShape(L)){var H=ac._rect.center().x-L._rect.center().x;L._rect.offset(H,0)}}}}ac.froms.push(L)}this.refresh(true);return}}this.refresh();return}}this.pushundo();if(G>=this.bondlength){U=this.guessArrow(T,U)}else{U=T.clone().offset(3*this.bondlength,0)}if(E=="arrow"){this.m.addGraphics(new JSDraw2.Arrow(T,U))}else{this.m.addGraphics(new JSDraw2.Curve(T,U))}this.refresh(true);return}if(E=="rectangle"||E=="ellipse"||E=="doublearrow"||E=="diamond"||E=="dshape"||E=="dreversed"){if(G<this.bondlength/8){U=new JSDraw2.Point(T.x+this.bondlength,T.y+this.bondlength)}else{if(G<this.bondlength/2){return}}this.pushundo();if(E=="rectangle"){this.m.addGraphics(new JSDraw2.Shape(new JSDraw2.Rect().set(T,U),"rectangle"))}else{if(E=="ellipse"){this.m.addGraphics(new JSDraw2.Shape(new JSDraw2.Rect().set(T,U),"ellipse"))}else{if(E=="diamond"){this.m.addGraphics(new JSDraw2.Shape(new JSDraw2.Rect().set(T,U),"diamond"))}else{if(E=="dshape"){this.m.addGraphics(new JSDraw2.Shape(new JSDraw2.Rect().set(T,U),"dshape"))}else{if(E=="dreversed"){this.m.addGraphics(new JSDraw2.Shape(new JSDraw2.Rect().set(T,U),"dreversed"))}else{if(E=="doublearrow"){this.m.addGraphics(new JSDraw2.Shape(new JSDraw2.Rect().set(T,U),"doublearrow"))}}}}}}this.refresh(true);return}if(E=="assaycurve"){if(G<this.bondlength/8&&this.m.isEmpty()){U=new JSDraw2.Point(T.x+this.bondlength*8,T.y+this.bondlength*6)}else{if(Math.abs(T.x-U.x)<this.bondlength*2||Math.abs(T.y-U.y)<this.bondlength*2){return}}this.pushundo();this.m.addGraphics(new JSDraw2.AssayCurve(new JSDraw2.Rect().set(T,U)));this.refresh(true);return}if(E=="spectrum"){if(G<this.bondlength/8&&this.m.isEmpty()){U=new JSDraw2.Point(T.x+this.bondlength*14,T.y+this.bondlength*6)}else{if(Math.abs(T.x-U.x)<this.bondlength*2||Math.abs(T.y-U.y)<this.bondlength*2){return}}this.pushundo();this.m.addGraphics(new JSDraw2.Spectrum(new JSDraw2.Rect().set(T,U)));this.refresh(true);return}if(E=="tlc"||E=="electrophoresis"){var P=false;if(this.movingClone==null){if(G<this.bondlength/2){return}this.pushundo();var ab=new JSDraw2.TLC.create(E,T,U,this.fontsize/2);if(ab.rect().height>2*this.bondlength&&ab.spots.length>0){this.addTlcPlate(ab);P=true}this.refresh(P);return}}if(scil.Utils.startswith(E,"spot-")){var ab=JSDraw2.TLC.cast(this.curObject);var C=this.clone();if(ab!=null&&ab.addSpot(E.substr(5),U,this.tor)){this.pushundo(C);this.refresh(true)}return}if(E=="rotate"&&this.rotating!=null){if(this.rotating.a1!=this.rotating.a0){this.pushundo(this.rotating.cloned);this.refresh(true)}this.rotating=null;return}if(E=="select"||E=="lasso"||E=="selfrag"||E=="rotate"||E=="tlc"||E=="electrophoresis"){if(this.lassolast!=null){this.lassolast=null}else{if(this.resizing!=null){if(this.resizing.changed){this._bracketReselectAtoms();this.pushundo(this.movingClone);this.movingClone=null;this.resizing=null;K=true}}else{if(this.movingClone!=null){if(!this.movingClone.startPt.equalsTo(U)){this._bracketReselectAtoms();this.pushundo(this.movingClone);this.mergeOverlaps();this.movingClone=null;K=true}}else{if(G<this.bondlength){if(this.curObject!=null){this.curObject.selected=true}}else{this.selectInRect(new JSDraw2.Rect().set(T,U))}}}}this.refresh(K);if(this.options.onselectionchanged!=null){this.options.onselectionchanged(this)}return}if(E=="zoombox"){var Y=new JSDraw2.Rect().set(T,U);if(Y.width>10&&Y.height>10){var Z=Math.min(this.dimension.x/Y.width,this.dimension.y/Y.height);var z=Y.center();this.pushundo();this.scale(Z*0.9,z);this.m.offset(this.dimension.x/2-z.x,this.dimension.y/2-z.y)}else{if(Y.width<5&&Y.height<5){this.fitToWindow()}}this.redraw();return}if(E=="chain"){if(this.chaintool!=null&&this.chaintool.points.length>0){K=false;var D=this.clone();var W=this.chaintool.points;var O=null;for(var M=1;M<W.length;++M){var h=this.toggleAtom(W[M-1]);var l=this.toggleAtom(W[M]);if(O==null){if(h!=null){O=h._parent}else{if(l!=null){O=l._parent}else{O=this.m}}}if(h!=null&&h._parent!=O){h=null}if(l!=null&&l._parent!=O){l=null}if(h==null){h=new JSDraw2.Atom(W[M-1]);O.addAtom(h);this._addNewAtomInExistingGroup(l,[h],true);K=true}if(l==null){l=new JSDraw2.Atom(W[M]);O.addAtom(l);this._addNewAtomInExistingGroup(h,[l],true);K=true}if(O.findBond(h,l)==null){O.addBond(new JSDraw2.Bond(h,l),null,true);K=true}}this.chaintool=null;if(K){this.pushundo(D)}this.refresh(K);return}}if(E=="bracket"){this.m.setSelected(false);var X=new JSDraw2.Rect().set(T,U);var N=this.m.bracketSelect(X);if(N.length>0){this.pushundo();var y=new JSDraw2.Bracket(null,X);y.atoms=N;N[0]._parent.addGraphics(y);K=true}this.refresh(K);if(y!=null){var aa=y.createSubscript(this.m,"#");if(aa!=null){this.showTextEditor(aa,null,"")}}else{var aa=JSDraw2.Text.cast(this.curObject);if(aa!=null&&aa.fieldtype=="BRACKET_TYPE"&&aa.anchors.length==1&&JSDraw2.Bracket.cast(aa.anchors[0])!=null){this.showTextEditor(aa,null,aa.text)}}return}if(E=="&#9679;"){var g;if((g=JSDraw2.Atom.cast(this.curObject))!=null){this.showAtomDlg(g)}else{if((g=JSDraw2.Bond.cast(this.curObject))!=null){this.showBondDlg(g)}}return}if(E=="undo"||E=="redo"||E=="zoomin"||E=="zoomout"){return}var D=this.clone();if(G<=this.tor){if(scil.Utils.startswith(E,"template.")){this.pushundo(D);this.addTemplate(E.substr(9),this.curObject,U);this.refresh(true);return}var g;if((g=JSDraw2.Atom.cast(this.curObject))!=null){var J=JSDraw2.PT[E];if(E=="antibody"||E=="protein"||E=="gene"){K=this.m.setAtomType(g,E)}else{if(J!=null){K=this.m.setAtomType(g,E)}else{if(E=="..."||E=="more"){K=this.m.setAtomType(g,this.ptElement)}else{if(E=="chargep"||E=="chargen"){K=this.increaseNum(g,E=="chargep"?+1:-1)}else{if(this.helm!=null&&this.helm!=null&&this.helm.isHelmCmd(E)){if(scil.helm.isHelmNode(g)){this.helm.changeMonomer(g,D)}}else{if(this.helm!=null&&scil.helm.isHelmNode(g)){this.helm.changeMonomer(g,D)}else{K=this._addAutoBond(g,E)}}}}}}}var w;if((w=JSDraw2.Bond.cast(this.curObject))!=null){switch(E){case"double":K=this.m.setBondType(w,JSDraw2.BONDTYPES.DOUBLE);break;case"triple":K=this.m.setBondType(w,JSDraw2.BONDTYPES.TRIPLE);break;case"unknown":K=this.m.setBondType(w,JSDraw2.BONDTYPES.UNKNOWN);break;case"dummy":K=this.m.setBondType(w,JSDraw2.BONDTYPES.DUMMY);break;case"either":K=this.m.setBondType(w,JSDraw2.BONDTYPES.EITHER);break;case"wiggly":K=this.m.setBondType(w,JSDraw2.BONDTYPES.WIGGLY);break;case"bold":K=this.m.setBondType(w,JSDraw2.BONDTYPES.BOLD);break;case"boldhash":K=this.m.setBondType(w,JSDraw2.BONDTYPES.BOLDHASH);break;case"delocalized":K=this.m.setBondType(w,JSDraw2.BONDTYPES.DELOCALIZED);break;case"singledouble":K=this.m.setBondType(w,JSDraw2.BONDTYPES.SINGLEORDOUBLE);break;case"singlearomatic":K=this.m.setBondType(w,JSDraw2.BONDTYPES.SINGLEORAROMATIC);break;case"doublearomatic":K=this.m.setBondType(w,JSDraw2.BONDTYPES.DOUBLEORAROMATIC);break;case"up":if(w.type==JSDraw2.BONDTYPES.WEDGE){w.reverse();K=true}else{K=this.m.setBondType(w,JSDraw2.BONDTYPES.WEDGE);this.fixWedgeDir(w)}break;case"down":if(w.type==JSDraw2.BONDTYPES.HASH){w.reverse();K=true}else{K=this.m.setBondType(w,JSDraw2.BONDTYPES.HASH);this.fixWedgeDir(w)}break;default:K=this.m.setBondType(w,w.type==JSDraw2.BONDTYPES.SINGLE?JSDraw2.BONDTYPES.DOUBLE:JSDraw2.BONDTYPES.SINGLE);break}}if(!K&&this.curObject==null){if(this.options.toolbarmode=="helm"&&!this.helm.isHelmCmd(E)&&E!="protein"&&E!="antibody"){return}var x=this.Cmd2BondType(E);if(x!=null){var h=this.m.addAtom(new JSDraw2.Atom(U));var S=U.clone().offset(this.bondlength,0).rotateAround(U,-30);var l=JSDraw2.Atom.cast(this.toggle(S));if(l==null){l=this.m.addAtom(new JSDraw2.Atom(S))}this.m.addBond(new JSDraw2.Bond(h,l));K=true}}if(!K&&this.curObject==null){var Z=E=="more"||E=="..."?this.ptElement:E;var J=JSDraw2.PT[Z];if(J!=null&&J.a>0||E=="antibody"||E=="protein"||E=="gene"||this.helm!=null&&this.helm.isHelmCmd(E)){var g=this.m.addAtom(new JSDraw2.Atom(U));if(E=="antibody"){g.bio={type:JSDraw2.BIO.ANTIBODY};g.elem="X"}else{if(E=="protein"){g.bio={type:JSDraw2.BIO.PROTEIN};g.elem="X"}else{if(E=="gene"){g.bio={type:JSDraw2.BIO.GENE};g.elem="X"}else{if(this.helm!=null&&this.helm.createIsolatedMonomer(E,g)){}else{this.m.setAtomType(g,Z)}}}}K=true}}if(K){this.pushundo(D);this.refresh(K)}return}var h=JSDraw2.Atom.cast(T.atom!=null?T.atom:this.toggle(T));var l=JSDraw2.Atom.cast(this.toggle(U));if(h!=null&&l!=null){if(h._parent!=l._parent){scil.Utils.alert("Cannot create bond between the two atoms");return}}if(this.options.toolbarmode=="helm"||this.helm.isHelmCmd(E)){if(this.helm.connnectGroup(T,this.curObject)){this.pushundo(D);this.redraw();return}if((h==null||l==null)&&this.helm!=null&&!this.helm.isHelmCmd(E)){if(E=="single"){if(this.helm.connnectGroup(T,this.curObject)){this.pushundo(D)}}this.redraw();return}if(this.helm!=null&&this.helm.isHelmCmd(E)){if(h!=null&&l==null){this.helm.extendChain(h,E,T,U,D);return}else{if(h==null&&l==null){this.redraw();return}}}}var j=false;var n=false;var O=h!=null?h._parent:(l!=null?l._parent:this.m);this.pushundo(D);var A=this._countAABonds(h);var q=h;if(h==null){if(A!=null){if(A.peptideN==0&&A.others==0){h=O.addAtom(new JSDraw2.Atom(T,"H"))}else{if(A.peptideC==0&&A.others==0){h=O.addAtom(new JSDraw2.Atom(T,"O"))}}}else{h=O.addAtom(new JSDraw2.Atom(T));j=true}}var B=this._countAABonds(l);var u=l;if(l==null){U=this._guessBond(T,U);if(A!=null){if(A.peptideN==0&&A.others==0){l=O.addAtom(new JSDraw2.Atom(U,"H"))}else{if(A.peptideC==0&&A.others==0){l=O.addAtom(new JSDraw2.Atom(U,"O"))}}}else{l=O.addAtom(new JSDraw2.Atom(U));n=true}}if(h!=null&&l!=null){this._addNewAtomInExistingGroup(q,[l],n);this._addNewAtomInExistingGroup(u,[h],j);var w=this.m.findBond(h,l);if(w==null){if(q!=null&&u!=null&&q._parent!=u._parent){scil.Utils.alert("Cannot create bond between the two atoms")}else{if(this.helm!=null&&(scil.helm.isHelmNode(h)||scil.helm.isHelmNode(l))){w=this.helm.connectFragment(h,l,!scil.helm.isHelmNode(h)||!scil.helm.isHelmNode(l))}else{var x=this.Cmd2BondType(E);if(x==null){x==JSDraw2.BONDTYPES.SINGLE}if(A!=null&&B!=null){if(A.peptideN==0&&B.peptideC==0){w=new JSDraw2.Bond(h,l,JSDraw2.BONDTYPES.PEPTIDE)}else{if(B.peptideN==0&&A.peptideC==0){w=new JSDraw2.Bond(l,h,JSDraw2.BONDTYPES.PEPTIDE)}else{if(q.elem=="C"&&u.elem=="C"&&A.disulfide==0&&B.disulfide==0){w=new JSDraw2.Bond(h,l,JSDraw2.BONDTYPES.DISULFIDE)}else{if(q.elem=="K"&&A.amide==0&&B.peptideC==0){w=new JSDraw2.Bond(h,l,JSDraw2.BONDTYPES.AMIDE)}else{if(u.elem=="K"&&B.amide==0&&A.peptideC==0){w=new JSDraw2.Bond(l,h,JSDraw2.BONDTYPES.AMIDE)}}}}}}else{if(A!=null){if(A.peptideN+A.peptideC+A.others<2){w=new JSDraw2.Bond(h,l,l.elem=="H"?JSDraw2.BONDTYPES.PEPTIDE:JSDraw2.BONDTYPES.SINGLE)}else{if(q.elem=="C"&&A.disulfide==0){w=new JSDraw2.Bond(h,l,JSDraw2.BONDTYPES.DISULFIDE)}else{if(q.elem=="K"&&A.amide==0){w=new JSDraw2.Bond(h,l,JSDraw2.BONDTYPES.AMIDE)}}}}else{if(B!=null){if(B.peptideN+B.peptideC+B.others<2){w=new JSDraw2.Bond(l,h,h.elem=="H"?JSDraw2.BONDTYPES.PEPTIDE:JSDraw2.BONDTYPES.SINGLE)}else{if(u.elem=="C"&&B.disulfide==0){w=new JSDraw2.Bond(l,h,JSDraw2.BONDTYPES.DISULFIDE)}else{if(u.elem=="K"&&B.amide==0){w=new JSDraw2.Bond(l,h,JSDraw2.BONDTYPES.AMIDE)}}}}else{w=new JSDraw2.Bond(h,l,x)}}}}}if(w!=null){O.addBond(w,x!=JSDraw2.BONDTYPES.DUMMY,true)}}}this.start=null;this.refresh(w!=null)},_bracketReselectAtoms:function(){var c=JSDraw2.Bracket.cast(this.curObject);if(c==null){return}var d=this.m.bracketSelect(c.rect());if(d!=null&&d.length>0){c.atoms=d}},_addNewAtomInExistingGroup:function(l,d,h){if(l==null){return}for(var j=0;j<d.length;++j){var c=d[j];if(c==null){continue}if(l.group!=null&&c.group==null){c.group=l.group}if(h){for(var g=0;g<this.m.graphics.length;++g){var f=JSDraw2.Bracket.cast(this.m.graphics[g]);if(f==null||f.atoms==null){continue}if(scil.Utils.indexOf(f.atoms,l)>=0&&scil.Utils.indexOf(f.atoms,c)<0){f.atoms.push(c)}}}}},mousedblclick:function(f){if(this.options.viewonly){return}var l=this.eventPoint(f);var j=this.toggle(l);if(j==null){return}var c=JSDraw2.Atom.cast(j);if(c==null){var d=JSDraw2.Bond.cast(j);if(d!=null){c=d.a1}}if(c==null){return}this.m.setSelected(false);var h=c._parent.getFragment(c,c._parent);for(var g=0;g<h.atoms.length;++g){h.atoms[g].selected=true}for(var g=0;g<h.bonds.length;++g){h.bonds[g].selected=true}this.refresh(false)},endMove:function(f,h){if(this.start==null){return}var g=this.eventPoint(f);var c=new JSDraw2.Point(g.x-this.start.x,g.y-this.start.y);this.start=null;this.moveview(null);if(c.x!=0||c.y!=0){if(!h){this.pushundo()}this.m.offset(c.x,c.y);if(h){this.redraw()}else{this.refresh(true)}}},isIsolatedShape:function(d){if(d.froms.length>0){return false}for(var c=0;c<this.m.graphics.length;++c){var f=JSDraw2.Shape.cast(this.m.graphics[c]);if(f!=null&&scil.Utils.indexOf(f.froms,d)>=0){return false}}return true},isShapeConnected:function(c,f){if(c==null||f==null){return false}for(var d=0;d<f.froms.length;++d){if(f.froms[d]==c){return true}}return false},_countAABonds:function(c){if(c==null||c.biotype()!=JSDraw2.BIO.AA){return null}var h={peptideN:0,peptideC:0,disulfide:0,amide:0,others:0};var f=this.m.getAllBonds(c);for(var d=0;d<f.length;++d){if(f[d].type==JSDraw2.BONDTYPES.PEPTIDE){if(f[d].a1==c){++h.peptideN}else{++h.peptideC}}else{if(f[d].type==JSDraw2.BONDTYPES.DISULFIDE){++h.disulfide}else{if(f[d].type==JSDraw2.BONDTYPES.AMIDE){++h.amide}else{if(f[d].type==JSDraw2.BONDTYPES.SINGLE){var g=f[d].otherAtom(c);if(g.bio==null){++h.others}}}}}}return h},addTlcPlate:function(h){if(h==null||!(h.spots.length>0)){return}var j=null;if(JSDraw2.defaultoptions!=null&&JSDraw2.defaultoptions.tlc!=null&&h.type!="electrophoresis"){j=JSDraw2.defaultoptions.tlc;var g=h.spotsize/(JSDraw2.Editor.FONTSIZE/2);if(j.width>0){h._rect.width=j.width*g}if(j.height>0){h._rect.height=j.height*g}var d=this.getAllTlcPlates(true);if(d!=null&&d.length>0){var f=d[d.length-1];var c=j.gap>0?j.gap:j.width/5;h._rect.left=f._rect.right()+c;h._rect.top=f._rect.top}}this.m.addGraphics(h);if(j!=null&&j.autonumbering){this.numberTlcPlates()}if(this.options.onAddTLC!=null){this.options.onAddTLC(h)}this.moveCenter()},hideChirarlities:function(f){var h=[];for(var d=0;d<this.m.graphics.length;++d){var g=JSDraw2.Text.cast(this.m.graphics[d]);if(g!=null&&g.anchors!=null&&g.anchors.length==1&&g.fieldtype=="CHIRAL"){var c=JSDraw2.Atom.cast(g.anchors[0]);if(!f||c.selected){h.push(g)}}}if(h.length>0){for(var d=0;d<h.length;++d){this.m.delGraphics(h[d])}this.pushundo();this.refresh(true)}},detectChiralities:function(d){var c=this;JSDraw2.JSDrawIO.callWebservice("mol.getchiralatoms",{mol:this.getXml(),format:"xml"},function(q){var l=0;var g=c.clone();for(var j in q){var h=parseInt(j);var f=c.m.getObjectById(h);if((!d||f.selected)&&c.m.markChirality(f,q[j],c.bondlength)){++l}}if(l>0){c.pushundo(g);c.refresh(true)}})},increaseNum:function(c,d){if(d!=1&&d!=-1){return false}var g=false;if(c.elem=="R"){var h=scil.Utils.parseIndex(c.alias);if(h==null||h.index==null){g=c._parent.setAtomAlias(c,(h==null||h.prefix==null?"R":h.prefix)+"1")}else{if(d>0){g=c._parent.setAtomAlias(c,h.prefix+(h.index+1))}else{if(h.index>1){g=c._parent.setAtomAlias(c,h.prefix+(h.index-1))}}}}else{g=c._parent.setAtomCharge(c,c.charge+d)}return g},mergeOverlaps:function(){var l=[];for(var h=0;h<this.m.atoms.length;++h){if(this.m.atoms[h].selected){var c=this.m.atoms[h];for(var j=0;j<this.m.atoms.length;++j){var d=this.m.atoms[j];if(!d.selected&&d.toggle(c.p,this.tor)){l.push({a1:c,a2:d});break}}}}var g=[];for(var j=0;j<l.length;++j){var c=l[j].a1;var d=l[j].a2;var f=this.m.findBond(c,d);if(f!=null){g.push(f);continue}for(var h=0;h<this.m.bonds.length;++h){f=this.m.bonds[h];if(f.a1==c){if(f.a2!=d){var n=this.m.findBond(f.a2,d);f.a1=d;if(n!=null){g.push(f)}}}else{if(f.a2==c){if(f.a1!=d){var n=this.m.findBond(f.a1,d);f.a2=d;if(n!=null){g.push(f)}}}}}}for(var h=0;h<g.length;++h){this.m.delBond(g[h],false)}for(var h=0;h<l.length;++h){this.m.delAtom(l[h].a1,false);this.m.setHCount(l[h].a2)}return g.length+l.length},onDel:function(){if(this.texteditor.ed!=null&&this.texteditor.ed.input.style.display!="none"){return false}var c=this.clone();if(this.delObject(this.curObject)||this.delSelected()>0){this.pushundo(c);if(this.helm!=null){this.helm.resetIDs()}this.curObject=null;this.refresh(true);return true}return false},showContextMenu:function(c,h){if(this.options.showcontextmenu==false){return}var d=scil.helm.Interface.onContextMenu(this,c,h);if(d==null||d.length==0){return}var f=this;if(this.contextmenu==null){this.contextmenu=new JSDraw2.ContextMenu(d,function(j,l){f.menuCallback(j,l)})}var g=scil.Utils.scrollOffset();this.contextmenu.show(c.clientX+g.x,c.clientY+g.y,this.curObject,d);this.contextmenu.pos=this.eventPoint(c)},menuSetStereochemistry:function(c){if(c=="abs"){c=null}this.pushundo();if(this.m.chiral==c){this.m.chiral=null}else{this.m.chiral=c}this.refresh(true)},menuCallback:function(f,h){var g=false;var d=this.clone();switch(f){case"curveline":h.setIC50CurveLine(this);break;case"icxline":h.setICxCurveLine(this);break;case"curveonly":h.setAssayCurveOnly(this);break;case"overlaycurves":this.overlayCurves2(h);break;case"setrawassaydata":h.setAssayCurveRawData(this);break;case"maskdatapoints":h.maskDataPoints(this);break;case"spectrum_setdata":h.setSpectrumData(this);break;case"spectrum_setdatafromfile":h.setSpectrumDataFromFile(this);break;case"spectrum_attributes":h.viewAttributes(this);break;case"maskassaysamplepoint":g=h.maskSamplePoint(h.curspot);break;case"pastechemdraw":JSDraw2.ChemDraw.paste(this);break;case"pastechemdrawasproduct":JSDraw2.ChemDraw.paste(this,"product");break;case"pastechemdrawasreactant":JSDraw2.ChemDraw.paste(this,"reactant");break;case"copychemdraw":JSDraw2.ChemDraw.copy(this);break;case"copymolfile":this.copyAs("molfile");break;case"copymolfile2000":this.copyAs("molfile2000");break;case"copymolfile3000":this.copyAs("molfile3000");break;case"copysmiles":this.copyAs("smiles");break;case"copyhelm":this.copyAs("helm");break;case"pastemolfile":this.pasteAs("molfile");break;case"about":JSDraw2.Editor.showAbout();break;case"abouthelm":scil.helm.about();break;case"removeatomvalues":this.removeAtomValues();break;case"viewlarge":this.viewLarge();break;case"movecenter":this.moveCenter();this.redraw();break;case"atom_prop":if((c=JSDraw2.Atom.cast(h))!=null){this.showAtomDlg(c)}break;case"atom_tag":var j=h.bio==null?"Atom "+h.elem:h.bio.type;if(h.bio!=null&&h.bio.subtype!=null){j+=" "+h.bio.subtype}this.addTag(h,h.p,j,true);break;case"helm_set_sense":if(h.bio.annotation!="5'ss"){h.bio.annotation="5'ss";g=true}break;case"helm_set_antisense":if(h.bio.annotation!="5'as"){h.bio.annotation="5'as";g=true}break;case"helm_set_clear":if(h.bio.annotation!="5'"){h.bio.annotation="5'";g=true}break;case"helm_complementary_strand":if(scil.Utils.startswith(h.bio.annotation,"5'")){g=this.helm.makeComplementaryStrand(h)!=null}break;case"helm_pair_hairpin":if(scil.Utils.startswith(h.bio.annotation,"5'")){g=this.helm.makeHairpin(h)}break;case"helm_pair_duplex":if(scil.Utils.startswith(h.bio.annotation,"5'")){g=this.helm.pairDuplex()}break;case"helm_remove_hbonds":if(scil.Utils.startswith(h.bio.annotation,"5'")){g=this.helm.removeHydrogenBonds()}break;case"helm_create_group":g=this.helm.createGroup(h,null,true)!=null;break;case"helm_group_collapse":g=this.helm.collapseGroup(h,true)!=null;break;case"helm_bond_prop":this.helm.setBondProp(h);break;case"helm_expand_node":g=this.helm.expandNode(h);break;case"helm_atom_prop":this.helm.setAtomProp(h);break;case"group_setproperties":this.setGroupProperties(h);break;case"detectstereochemistry":this.detectChiralities(true);break;case"hidestereochemistry":this.hideChirarlities(true);break;case"detectstereochemistry2":this.detectChiralities();break;case"hidestereochemistry2":this.hideChirarlities();break;case"bond_prop":if((c=JSDraw2.Bond.cast(h))!=null){this.showBondDlg(c)}break;case"bond_tag":this.addTag(h,h.center(),"[None]",true);break;case"bond_locant":this.addTag(h,h.center(),"U = Unknown Locant");break;case"bio_showsequence":this.showSequences(h);break;case"rgroup_define":g=this.rgroupDefine(h);break;case"rgroup_remove":var c=JSDraw2.Atom.cast(h);if(c!=null&&c.rgroup!=null){c.rgroup=null;g=true}break;case"rgroup_addstructure":this.addRgroupStructure(h);g=true;break;case"setbracketsubscription":this.setBracketSubscription(h);break;case"setbracketratio":this.setBracketRatio(h);break;case"setbracketmw":this.setBracketData(h,"POLYMER_MW","MW=",1);break;case"registrationparent":this.setBracketData(h,"REG_PARENT","Parent=",2);break;case"graphics_bring2front":g=this.m.setZOrder(h,-1);break;case"graphics_set2back":g=this.m.setZOrder(h,0);break;case"tlc_addlane":g=JSDraw2.TLC.cast(h)!=null&&h.addLane();break;case"tlc_duplicatespot":g=JSDraw2.TLC.cast(h)!=null&&h.duplicateSpot(h.curspot);break;case"tlc_duplicatelane":g=JSDraw2.TLC.cast(h)!=null&&h.duplicateLane(h.curspot);break;case"tlc_showlanelabel":g=JSDraw2.TLC.cast(h)!=null&&h.showLaneLabel(!h.showlanelabel);break;case"tlc_removespot":g=JSDraw2.TLC.cast(h)!=null&&h.removeSpot(h.curspot);break;case"tlc_setrfvalue":g=JSDraw2.TLC.cast(h)!=null&&h.setRfValue(h.curspot,this);break;case"tlc_setlanelabels":JSDraw2.TLC.setLaneLabels(this,h);break;case"Copy":this.copy();break;case"Select All":if(this.selectAll()){this.refresh(false)}break;case"copy-viewonly":this.copy(d==null?null:d.mol);break;case"Cut":if(this.cut()){this.refresh(false)}break;case"edit-popup":if(this.options.popup){this.dblclick()}break;case"Expand":this.expandSuperatom();break;case"Paste":if(this.paste(this.contextmenu.pos)){this.refresh(false)}break;case"Delete":g=this.delSelected()>0;break;case"multi-center":g=this.createMulticenter()!=null;break;case"Clear":this.clear(false,true);g=true;break;case"Undo":if(this.undo()){this.refresh(false)}break;case"Redo":if(this.redo()){this.refresh(false)}break;case"workflow_properties":JSDraw2.Shape.showProperties(this,JSDraw2.Shape.cast(h));break}if(g){this.pushundo(d);this.refresh(g)}},overlayCurves2:function(f){f=JSDraw2.AssayCurve.cast(f);if(f==null){return}var h=[];for(var g=0;g<this.m.graphics.length;++g){var d=JSDraw2.AssayCurve.cast(this.m.graphics[g]);if(d!=null&&d.selected){h.push(d)}}this.overlayCurves(h,f)},overlayCurves:function(f,c){if(scil.Utils.indexOf(f,c)<0){return}this.pushundo();c.setDisplayRange();for(var d=0;d<f.length;++d){f[d].curveline=false;f[d].icxline=false;if(f[d]==c){f[d].curveonly=false}else{f[d]._rect=c._rect.clone();f[d].curveonly=true;f[d].x1=c.x1;f[d].x2=c.x2;f[d].y1=c.y1;f[d].y2=c.y2}}this.refresh(true)},setGroupProperties:function(h){var d=JSDraw2.Group.cast(h);if(d==null){return}var f=this;if(this.groupPropDlg==null){var f=this;var c={ratio:{label:"Ratio",type:"number",accepts:"(and)|(or)|[*|?]",width:100},tag:{label:"Annotation",width:300}};this.groupPropDlg=scil.Form.createDlgForm("Group Properties",c,{label:"Save",onclick:function(){f.setGroupProperties2()}})}this.groupPropDlg.show();this.groupPropDlg.form.setData({ratio:d.ratio,tag:d.tag});this.groupPropDlg.g=d},setGroupProperties2:function(){var c=this.groupPropDlg.form.getData();var d=this.groupPropDlg.g;if(c.ratio!=""&&this.hasGroupBond(d)){c.ratio=""}if((d.ratio==null?"":d.ratio+"")!=c.ratio||d.tag!=c.tag){this.pushundo();d.ratio=c.ratio;d.tag=c.tag;this.groupPropDlg.hide();this.refresh(true)}},hasGroupBond:function(c){var d=c.a==null?null:this.m.getAllBonds(c.a);return d!=null&&d.length>0},copyAs:function(d){if(d!="helm"&&this.hasHelmNodes()){var c={jsdraw:this.getXml(),outputformat:d};JSDraw2.JSDrawIO.callWebservice("jsdraw.helm2mol",c,function(g){scil.Clipboard.copy(g.output)},{showprogress:true});return}var f=null;switch(d){case"molfile":f=this.getMolfile();break;case"molfile2000":f=this.getMolfile(false);break;case"molfile3000":f=this.getMolfile(true);break;case"smiles":f=this.getSmiles(true);break;case"helm":f=this.getHelm();break}if(scil.Utils.isNullOrEmpty(f)){scil.Utils.alert("Nothing placed on clipboard");return}scil.Clipboard.copy(f)},pasteAs:function(c){},rgroupDefine:function(c){JSDraw2.needPro();return false},createMulticenter:function(){JSDraw2.needPro();return null},viewLarge:function(){var c=this.options.viewonly?"Dismiss":"Save";JSDraw2.Editor.showPopup(this.options.viewonly?"View":"Edit",c,null,{value:this.clone(),format:"clone"})},removeAtomValues:function(){var d=null;for(var f=0;f<this.m.atoms.length;++f){var c=this.m.atoms[f];if(c.tag!=null&&c.tag!=""){if(d==null){d=this.clone()}c.tag=null}}if(d!=null){this.pushundo(d);this.refresh(true)}return d!=null},selectAll:function(){var c=this.m.setSelected(true)>0;if(this.options.onselectionchanged!=null){this.options.onselectionchanged(this)}return c},addRgroupStructure:function(c){JSDraw2.needPro()},menuTLCSetSpotShape:function(c,d,f){JSDraw2.needPro()},menuTLCSetSpotSize:function(c,d){JSDraw2.needPro()},menuTLCLabel:function(d,c){JSDraw2.needPro()},menuTLCSetLabel:function(d,c){JSDraw2.needPro()},menuTLCFill:function(d,c){JSDraw2.needPro()},menuShapeType:function(d,c){JSDraw2.needPro()},menuAlignShapes:function(d,c){JSDraw2.needPro()},menuShapeFill:function(d,c){JSDraw2.needPro()},menuAntiboyType:function(d,c){JSDraw2.needPro()},showSequences:function(c){JSDraw2.needPro()},menuSetFontsize:function(c,d){JSDraw2.needPro()},menuSetColor:function(c,d){JSDraw2.needPro()},addTag:function(d,f,g,c){JSDraw2.needPro()},setBracketData:function(c,d,f,g){JSDraw2.needPro()},setBracketSubscription:function(c){if(c==null){return}var d=this.m.getSgroupText(c,"BRACKET_TYPE");if(d==null){d=c.createSubscript(this.m,"#")}this.showTextEditor(d,null,d.text)},setBracketRatio:function(c){JSDraw2.needPro()},menuBracket:function(d,g,c,f){JSDraw2.needPro()},menuSetTextField:function(c,d){JSDraw2.needPro()},menuSetAttachPoint:function(c,d){JSDraw2.needPro()},lockAtomConnection:function(c){JSDraw2.needPro()},menuSetAtomQuery:function(d,g,c,f){JSDraw2.needPro()},menuSetAtomQuery2:function(c,d){JSDraw2.needPro()},menuSetAtomType:function(c,f){if(c=="..."||c=="more"){var d=this;this.showPT(function(g){d.menuSetAtomType2(g,f)})}else{this.menuSetAtomType2(c,f)}},menuSetAtomType2:function(g,l){var j=0;var f=this.clone();var c=JSDraw2.Atom.cast(l);if(c!=null&&!c.selected){if(c._parent.setAtomType(c,g)){++j}}else{var d=this.m.allAtoms();for(var h=0;h<d.length;++h){var c=d[h];if(c.selected&&c._parent.setAtomType(c,g)){++j}}}if(j>0){this.pushundo(f);this.refresh(true)}},menuSetAtomCharges:function(h){var f=parseInt(h);if(isNaN(f)){return}var l=0;var g=this.clone();var d=this.m.allAtoms();for(var j=0;j<d.length;++j){var c=d[j];if(c.selected&&c._parent.setAtomCharge(c,f)){++l}}if(l>0){this.pushundo(g);this.refresh(true)}},menuSetAtomIsotope:function(c){JSDraw2.needPro()},menuSetAtomRadical:function(c){JSDraw2.needPro()},menuSetEhnStereochemistry:function(c){JSDraw2.needPro()},menuSetBondTop:function(c){JSDraw2.needPro()},menuSetRxnCenter:function(c){JSDraw2.needPro()},menuSetBondType:function(c){JSDraw2.needPro()},getAllTlcPlates:function(c){JSDraw2.needPro()},numberTlcPlates:function(){JSDraw2.needPro()},expandSuperatom:function(){if(!this.helm.expandSuperAtom(this.curObject)){JSDraw2.needPro()}},_setSelectedBondType:function(f){var h=0;var d=this.m.allBonds();for(var g=0;g<d.length;++g){var c=d[g];if(c.selected&&c._parent.setBondType(d[g],f)){++h}}return h},doRxnMap:function(c){JSDraw2.needPro()},Cmd2BondType:function(c){switch(c){case"single":return JSDraw2.BONDTYPES.SINGLE;case"double":return JSDraw2.BONDTYPES.DOUBLE;case"triple":return JSDraw2.BONDTYPES.TRIPLE;case"unknown":return JSDraw2.BONDTYPES.UNKNOWN;case"dummy":return JSDraw2.BONDTYPES.DUMMY;case"either":return JSDraw2.BONDTYPES.EITHER;case"wiggly":return JSDraw2.BONDTYPES.WIGGLY;case"bold":return JSDraw2.BONDTYPES.BOLD;case"boldhash":return JSDraw2.BONDTYPES.BOLDHASH;case"delocalized":return JSDraw2.BONDTYPES.DELOCALIZED;case"up":return JSDraw2.BONDTYPES.WEDGE;case"down":return JSDraw2.BONDTYPES.HASH}return null},delObject:function(j){if(j==null){return false}var d=JSDraw2.Bracket.cast(j);if(d!=null){for(var h=0;h<this.m.graphics.length;++h){var n=JSDraw2.Text.cast(this.m.graphics[h]);if(n!=null&&scil.Utils.indexOf(n.anchors,d)>=0){this.m.delObject(n)}}this.m.delObject(d);return true}var q=JSDraw2.TLC.cast(j);if(q!=null){if(q.removeSpot(q.curspot)){return true}}var l=JSDraw2.RGroup.cast(j);if(l!=null){return false}var c=JSDraw2.Atom.cast(j);if(c!=null){if(this.delAA(c)){return true}if(JSDraw2.defaultoptions.delheteroatom!=false&&c.bio==null){if(c.elem!="C"||c.alias!=null&&c.alias!=""){c.elem="C";c.alias=null;c._parent.setHCount(c);return true}}}var g=j._parent.delObject(j);if(g){if(q!=null){this.numberTlcPlates()}}return g},delSelected:function(){var c=false;for(var d=0;d<this.m.graphics.length;++d){if(JSDraw2.TLC.cast(this.m.graphics[d])!=null){c=true;break}}var f=this.m.delSelected();if(f>0&&c){this.numberTlcPlates()}return f},hasSelected:function(){var d=this.m.hasSelected();if(d>0){for(var c=0;c<this.m.graphics.length;++c){if(JSDraw2.TLC.cast(this.m.graphics[c])!=null){this.numberTlcPlates();break}}}return d},lassoSelect:function(d){if(this.start==null||this.end==null){return}var c=this.surface.extra;if(c.lasso==null){c.lasso=new JSDraw2.Lasso(c,this.linewidth,true)}JSDraw2.Drawer.drawLine(c,d,this.end,"#aaf",this.linewidth/2);this.m.lassoSelect(c,this.start,this.end,d,this.linewidth,this.tor/8)},selectInRect:function(c){return this.m.selectInRect(c)},addTemplate:function(w,z,A){var c=JSDraw2.Atom.cast(z);var g=JSDraw2.Bond.cast(z);var y=w=="[custom]"?JSDraw2.CustomTemplates.get(w):JSDraw2.SuperAtoms.getTemplate(w);if(y==null){return}var x=y.clone();x.setBondLength(g==null?this.bondlength:g.bondLength());if(c!=null){this._addNewAtomInExistingGroup(c,x.atoms);var d=x.atoms[0];if(JSDraw2.SuperAtoms._alignMol(c._parent,c,x,x.atoms[0])){x.replaceAtom(d,c)}else{return}}else{if(g!=null){this._addNewAtomInExistingGroup(g.a1,x.atoms);this._addNewAtomInExistingGroup(g.a2,x.atoms);var h=null;for(var u=0;u<x.bonds.length;++u){if(x.bonds[u].type!=JSDraw2.BONDTYPES.SINGLE){h=x.bonds[u];break}}if(h==null){h=x.bonds[0]}x.offset(g.a1.p.x-h.a1.p.x,g.a1.p.y-h.a1.p.y);var n=this._caclBondDir(this.m,g);var q=this._caclBondDir(x,h);if(n>0&&q>0||n<0&&q<0){x.flipX(g.a1.p.x)}var j=g.angle();var l=h.angle();x.rotate(h.a1.p.clone(),j-l);x.replaceBond(h,g)}else{var d=x.atoms[0];x.offset(A.x-d.p.x,A.y-d.p.y)}}for(var u=0;u<x.atoms.length;++u){var d=x.atoms[u];var f=JSDraw2.Atom.cast(this.toggle(d.p));if(f!=null&&c!=d){x.replaceAtom(d,f)}}var t=null;if(c!=null&&c.group!=null){t=c.group}if(g!=null&&g.a1.group!=null&&g.a2.group!=null&&g.a1.group==g.a2.group){t=g.a1.group}if(t!=null){for(var u=0;u<x.atoms.length;++u){x.atoms[u].group=t}}var B=c!=null?c._parent:(g!=null?g._parent:null);if(B!=null){B.mergeMol(x)}else{this.m.mergeMol(x)}},_caclBondDir:function(g,d){var h=0;var c=g.getNeighborAtoms(d.a1,d.a2);for(var f=0;f<c.length;++f){if(d.a1.p.angleAsOrigin(d.a2.p,c[f].p)>180){++h}else{--h}}var c=g.getNeighborAtoms(d.a2,d.a1);for(var f=0;f<c.length;++f){if(d.a2.p.angleAsOrigin(c[f].p,d.a1.p)>180){++h}else{--h}}return h},keydown:function(u){if(!this.activated){return}if(this.texteditor.ed!=null&&this.texteditor.ed.input.style.display==""){return}if(this.helm!=null){this.helm.cancelDnD();scil.helm.MolViewer.hide()}if(scil.Utils.getZindex(this.div)<scil.Utils.getMaxZindex()){return}this._keypresschar=String.fromCharCode(u.keyCode);if(u.preventDefault==null){u.preventDefault=function(){}}if(this.contextmenu!=null){this.contextmenu.hide()}if(u.keyCode==27){if(this.start!=null){this.start=null;this.redraw()}}if(u.ctrlKey||u.metaKey){switch(u.keyCode){case 89:case 121:if(!this.options.appmode){if(this.redo()){this.refresh(true)}}break;case 90:case 122:if(!this.options.appmode){if(this.undo()){this.refresh(true)}}break;case 67:case 99:if(!this.options.appmode){this.copy()}break;case 86:case 118:if(!this.options.appmode&&scil.Utils.isIE){if(this.paste()){this.refresh(true)}}break;case 88:case 120:if(!this.options.appmode){if(this.cut()){this.refresh(true)}}break;case 65:case 97:if(this.selectAll()){this.refresh(false)}u.preventDefault();break}return}var d=JSDraw2.Atom.cast(this.curObject);if(u.keyCode==8||u.keyCode==46){if(this.onDel()){u.preventDefault()}return}if(this.m.hasSelected()){var n=0;var q=0;switch(u.keyCode){case 37:n=-1;break;case 38:q=-1;break;case 39:n=1;break;case 40:q=1;break}if(n!=0||q!=0){this.pushundo();this.m.offset(u.shiftKey?n:n*20,u.shiftKey?q:q*20,true);this.refresh(true);u.preventDefault();return}}if(this.curObject==null){if(this.getCmd()=="seq"){var h=String.fromCharCode(u.keyCode);if(JSDraw2.SuperAtoms.getAA(h)!=null){this.createAA(this.lastmove,h,JSDraw2.BIO.AA)}}else{if(this.getCmd()=="helix"){var h=String.fromCharCode(u.keyCode);if(JSDraw2.SuperAtoms.getDNA(h)!=null){this.createAA(this.lastmove,h,JSDraw2.BIO.BASE_DNA)}}else{if(this.getCmd()=="rna"){var h=String.fromCharCode(u.keyCode);if(JSDraw2.SuperAtoms.getRNA(h)!=null){this.createAA(this.lastmove,h,JSDraw2.BIO.BASE_RNA)}}}}return}if(d!=null){if(d.bio){if(u.keyCode==13){this.showTextEditor(d,d.p.clone());u.preventDefault();return}if(this.helm!=null&&scil.helm.isHelmNode(d)){var h=String.fromCharCode(u.keyCode);if(scil.helm.Monomers.getMonomer(d,h)!=null){this.pushundo();d.elem=h;this.refresh(true)}}else{if(d.biotype()==JSDraw2.BIO.AA&&JSDraw2.SuperAtoms.getAA(h)!=null||d.biotype()==JSDraw2.BIO.BASE_DNA&&JSDraw2.SuperAtoms.getDNA(h)!=null||d.biotype()==JSDraw2.BIO.BASE_RNA&&JSDraw2.SuperAtoms.getRNA(h)!=null){var h=String.fromCharCode(u.keyCode);if(d.selected){if(d.elem!=h){this.pushundo();d.elem=h;this._setSuperatom(d);this.refresh(true)}}else{this.insertAA(d,h)}}}return}else{if(d.elem=="R"){if(u.keyCode>=49&&u.keyCode<=57){var x="R"+(u.keyCode-48);if(d.alias!=x){this.pushundo();this.m.setAtomAlias(d,x);this.refresh(true)}return}}}var h=null;switch(u.keyCode){case 56:h="*";break;case 50:h="@";break;case 187:case 107:h="+";break;case 189:case 109:h="-";break;case 61:if(scil.Utils.isFirefox){h="+"}break;case 173:if(scil.Utils.isFirefox){h="-"}break;case 65:case 97:h="A";break;case 81:case 113:h="Q";break;case 66:case 98:h="Br";break;case 67:case 99:h="C";break;case 68:case 100:h="D";break;case 70:case 102:h="F";break;case 72:case 104:h="H";break;case 73:case 105:h="I";break;case 76:case 108:h="Cl";break;case 78:case 110:h="N";break;case 79:case 111:h="O";break;case 80:case 112:h="P";break;case 82:case 114:h="R";break;case 83:case 115:h="S";break;case 84:case 116:h="T";break;case 88:case 120:h="X";break;case 77:case 109:h="M";break;case 69:h="Me";break;case 13:this.showTextEditor(d,d.p.clone());u.preventDefault();return}if(h=="+"||h=="-"){var l=this.clone();if(this.increaseNum(d,h=="+"?+1:-1)){this.pushundo(l);this.refresh(true);return}}else{if(h=="Me"){var l=this.clone();if(this.m.setAtomAlias(d,h)){this.pushundo(l);this.refresh(true);return}}else{if(h!=null){var l=this.clone();if(this.m.setAtomType(d,h)){this.pushundo(l);this.refresh(true);return}}}}return}var y=JSDraw2.Shape.cast(this.curObject);if(y!=null&&u.keyCode==13){this.showTextEditor(y,y._rect.center());u.preventDefault();return}var g=JSDraw2.Bond.cast(this.curObject);if(g!=null){if(g.isBio()){var w=false;var l=null;if(u.keyCode==83&&g.type==JSDraw2.BONDTYPES.PEPTIDE){l=this.clone();w=this.m.setBondType(g,JSDraw2.BONDTYPES.DISULFIDE)}else{if(u.keyCode==49&&g.type==JSDraw2.BONDTYPES.DISULFIDE){l=this.clone();w=this.m.setBondType(g,JSDraw2.BONDTYPES.PEPTIDE)}}if(w){this.pushundo(l);this.refresh(true)}}else{var h=-1;if(u.keyCode==189||u.keyCode==109){h=10}else{if(u.keyCode==187||u.keyCode==107){h=11}else{if(u.keyCode==192){h=13}else{h=u.keyCode-48}}}if(h>=JSDraw2.BONDTYPES.UNKNOWN&&h<=JSDraw2.BONDTYPES.DUMMY&&this.curObject.type!=h){var l=this.clone();if(this.m.setBondType(g,h)){this.pushundo(l);if(g.type==JSDraw2.BONDTYPES.WEDGE||g.type==JSDraw2.BONDTYPES.HASH){this.fixWedgeDir(g)}this.refresh(true);return}}else{if(h==9&&(g.type==JSDraw2.BONDTYPES.WEDGE||g.type==JSDraw2.BONDTYPES.HASH)){this.pushundo();g.reverse();this.refresh(true);return}}}return}var A=JSDraw2.Text.cast(this.curObject);if(A!=null){this.showTextEditor(A);u.preventDefault();return}var z=JSDraw2.TLC.cast(this.curObject);if(z!=null){if(z.curspot!=null){switch(u.keyCode){case 187:case 189:var j=this.clone();if(z.curspot.move((u.keyCode==187?0.1:-0.1)*(u.shiftKey?0.1:1))){this.pushundo(j);this.refresh(true)}u.preventDefault();break;case 190:this.pushundo();z.changeSize(z.curspot,"110%");this.refresh(true);break;case 188:this.pushundo();z.changeSize(z.curspot,"90%");this.refresh(true);break;case 82:case 76:this.pushundo();z.curspot.rx+=u.shiftKey?-0.2:0.2;if(z.curspot.rx<0.1){z.curspot.rx=0.1}this.refresh(true);break;case 85:this.pushundo();z.curspot.ry1+=u.shiftKey?-0.2:0.2;this.refresh(true);break;case 68:this.pushundo();z.curspot.ry2+=u.shiftKey?-0.2:0.2;this.refresh(true);break}}}},toCharArray:function(f,d){if(!(d>0)){d=1}var g=[];for(var c=0;c<f.length;++c){g.push(f.substr(c,d))}return g},splitString:function(j,f){var l=[];var g=new RegExp("^"+f);var h;while((h=g.exec(j))!=null){var d=h+"";l.push(d);if(j.length==d.length){return l}j=j.substr(d.length)}return null},createAA2:function(n,d,g,c,j,f,q){if(scil.Utils.isNullOrEmpty(n)){return}if(g){n=n.replace(/[>|\^]/g,"")}if(new RegExp("^[a-z|^|>]+$").test(n)){n=scil.Utils.trim(n).toUpperCase()}var u=null;if(d==JSDraw2.BIO.BASE_DNA){if(new RegExp("^[A|G|T|C]+$").test(n)){u=this.toCharArray(n)}else{scil.Utils.alert2("Invalid DNA sequence.");return}}if(d==JSDraw2.BIO.BASE_RNA){if(new RegExp("^[A|G|T|C|U]+$").test(n)){u=this.toCharArray(n)}else{scil.Utils.alert2("Invalid RNA sequence.");return}}else{if(d==JSDraw2.BIO.AA){n=n.replace(/[\.]/g,"-");if(n.indexOf("-")>0){u=n.split("-")}else{if(new RegExp("^([A-Z][a-z|0-9]{2}[\\^]?)+[>]?$").test(n)){u=this.splitString(n,"[A-Z][a-z|0-9]{2}[\\^|>]?")}else{if(new RegExp("^([A-Z][\\^]?)+[>]?$").test(n)){u=this.splitString(n,"[A-Z][\\^|>]?")}}}if(u==null){scil.Utils.alert2("Invalid peptide sequence.");return}}}if(u.length>=3&&scil.Utils.endswith(u[u.length-1],">")&&n.indexOf("^")<=0){u[0]+="^"}var h;if(g&&d==JSDraw2.BIO.AA){h=this._createExpandedAA(u,d,j,f)}else{h=this._createCollapsedAA(u,d,j,f)}if(h==null){return false}if(j==null||j==""){j="H"}if(f==null||f==""){f="OH"}var t=(j!=null?j+"-":"")+n+(f!=null?"-"+f:"");if(this.options.onAddSequence!=null){if(this.options.onAddSequence(h,t,c)){return true}}this.m.setSelected(false);if(q!=false){h.setSelected(true)}this.pushundo();if(c=="reactant"||c=="product"){var l=this.m.parseRxn();if(c=="reactant"){l.reactants.push(h)}else{l.products.push(h)}this.setRxn(l,false,this.bondlength)}else{this.m.mergeMol(h)}this.fitToWindow();this.refresh(true);return true},_createCollapsedAA:function(E,h,C,u){if(C==null||C==""){C="H"}if(u==null||u==""){u="OH"}var w=[];var q=null;var F=null;var f=[];for(var x=0;x<E.length;++x){var l=E[x];var y=l.length>1&&(l.substr(l.length-1)=="^"||l.substr(l.length-1)==">");if(y){l=l.substr(0,l.length-1)}var d=new JSDraw2.Atom(null,l,{type:h});switch(h){case JSDraw2.BIO.AA:d.superatom=JSDraw2.SuperAtoms.getAA(l);break;case JSDraw2.BIO.BASE_DNA:d.superatom=JSDraw2.SuperAtoms.getDNA(l);break;case JSDraw2.BIO.BASE_RNA:d.superatom=JSDraw2.SuperAtoms.getRNA(l);break}if(d.superatom==null){scil.Utils.alert("It cannot parse: "+l);return}f.push(d);if(y){if(q==null){q=[d]}else{if(F==null){q.push(d);F=[]}else{F.push(d)}}}else{if(F!=null){F.push(d)}else{if(q!=null){q.push(d)}else{w.push(d)}}}}var j=JSDraw2.BONDTYPES.SINGLE;if(h==JSDraw2.BIO.AA){j=JSDraw2.BONDTYPES.PEPTIDE}else{if(h==JSDraw2.BIO.DNA||h==JSDraw2.BIO.RNA){j=JSDraw2.BONDTYPES.NUCLEOTIDE}}if(q!=null&&q.length==1){w.push(q[0]);q=null;if(F!=null){for(var x=0;x<F.length;++x){w.push(F[x])}F=null}}var B=null;var t=null;var A=new JSDraw2.Mol(this.options.showimplicithydrogens);if(w.length>0){B=new JSDraw2.Atom(null,"C");A.addAtom(B);w.splice(0,0,B);var g=new JSDraw2.Bond(w[1],B,h==JSDraw2.BIO.AA?JSDraw2.BONDTYPES.PEPTIDE:JSDraw2.BONDTYPES.NUCLEOTIDE);g.apo1=1;A.addBond(g)}A.addAtom(f[0]);for(var x=1;x<f.length;++x){A.addAtom(f[x]);var g=new JSDraw2.Bond(f[x],f[x-1],j);g.apo1=1;g.apo2=2;A.addBond(g)}if(q==null){var D=new JSDraw2.Atom(null,h==JSDraw2.BIO.AA?"O":"3'");A.addAtom(D);w.push(D);t=D;var g=new JSDraw2.Bond(D,w[w.length-2],h==JSDraw2.BIO.AA?JSDraw2.BONDTYPES.PEPTIDE:JSDraw2.BONDTYPES.NUCLEOTIDE);g.apo2=2;A.addBond(g)}else{if(w.length==0&&(F==null||F.length==0)){var g=new JSDraw2.Bond(q[0],q[q.length-1],JSDraw2.BONDTYPES.PEPTIDE);g.apo1=1;g.apo2=2;A.addBond(g)}else{if(q[0].elem=="C"&&q[q.length-1].elem=="C"){var g=new JSDraw2.Bond(q[0],q[q.length-1],JSDraw2.BONDTYPES.DISULFIDE);g.apo1=3;g.apo2=3;A.addBond(g)}else{if(q[0].elem=="K"&&(F==null||F.length==0)){var g=new JSDraw2.Bond(q[0],q[q.length-1],JSDraw2.BONDTYPES.AMIDE);g.apo1=3;g.apo2=2;A.addBond(g)}}}if(F!=null&&F.length>0){t=new JSDraw2.Atom(null,"C");A.addAtom(t);F.push(t);var g=new JSDraw2.Bond(F[F.length-2],t,JSDraw2.BONDTYPES.SINGLE);g.apo1=1;A.addBond(g)}}if(q==null||q.length==1){var z=null;this.layoutAtoms(w,"line",this.bondlength,z);if(w.length>0){z=w[w.length-1]}if(q!=null){this.layoutAtoms(q,"line",this.bondlength,z);if(q.length>0){z=q[q.length-1]}if(F!=null){this.layoutAtoms(F,"line",this.bondlength,z)}}}else{var n=new JSDraw2.Point(0,0);this.layoutAtoms(q,"circle",this.bondlength,n.clone().offset(1,0),n);if(w.length>0){w.push(null);w.reverse();this.layoutAtoms(w,"line",this.bondlength,q[0].p,n)}if(F!=null&&F.length>0){F.splice(0,0,null);this.layoutAtoms(F,"line",this.bondlength,q[q.length-1].p,n)}}if(B!=null){if(h==JSDraw2.BIO.AA){if(C=="H"){B.elem="H"}else{A.setAtomAlias(B,C)}}else{B.elem="5'"}}if(t!=null){if(h==JSDraw2.BIO.AA){if(u=="OH"){t.elem="O"}else{if(u=="NH2"){t.elem="N"}else{A.setAtomAlias(t,u)}}}else{t.elem="3'"}}return A},_createExpandedAA:function(A,h,x,l){if(x==null||x==""){x="H"}if(l==null||l==""){l="OH"}var w=null;var t=null;for(var n=0;n<A.length;++n){var j=A[n];var u=JSDraw2.SuperAtoms.getAA(j);if(u==null){scil.Utils.alert("Unknow Amino Acid: "+j);return null}u=u.clone();u.setBondLength(this.bondlength);var f=JSDraw2.SuperAtoms._getAttachAtoms(u);for(var q=2;q<f.length;++q){f[q].a.attachpoints=[]}if(n==0){w=u;f[0].a.attachpoints=[];if(x!="H"){var y=this._guessAutoBond(f[0].a);var d=new JSDraw2.Atom(y,"C");var g=new JSDraw2.Bond(f[0].a,d,JSDraw2.BONDTYPES.SINGLE);w.addAtom(d);w.addBond(g);w.setAtomAlias(d,x)}t=f[1].a;continue}if(n%2==1){for(var q=0;q<u.atoms.length;++q){u.atoms[q].p.y*=-1}for(var q=0;q<u.bonds.length;++q){if(u.bonds[q].type==JSDraw2.BONDTYPES.WEDGE){u.bonds[q].type=JSDraw2.BONDTYPES.HASH}else{if(u.bonds[q].type==JSDraw2.BONDTYPES.HASH){u.bonds[q].type=JSDraw2.BONDTYPES.WEDGE}}}}var z=f[0].a.p;var y=this._guessAutoBond(t);u.offset(y.x-z.x,y.y-z.y);w.mergeMol(u);t.attachpoints=[];f[0].a.attachpoints=[];var g=new JSDraw2.Bond(t,f[0].a,JSDraw2.BONDTYPES.SINGLE);w.addBond(g);t=f[1].a}if(t!=null){t.attachpoints=[];if(l!="H"){var y=this._guessAutoBond(t);var d=new JSDraw2.Atom(y,"C");var g=new JSDraw2.Bond(t,d,JSDraw2.BONDTYPES.SINGLE);w.addAtom(d);w.addBond(g);if(l=="OH"){d.elem="O"}else{w.setAtomAlias(d,l)}}}return w},layoutAtoms:function(c,w,f,n,q){if(c==null||c.length==0){return}if(q==null){q=new JSDraw2.Point(0,0)}if(n==null){n=q.clone().offset(f,0)}switch(w){case"line":if(c[0]!=null){c[0].p=n.clone()}var u=f/n.distTo(q);var h=(n.x-q.x)*u;var j=(n.y-q.y)*u;for(var l=1;l<c.length;++l){c[l].p=n.clone().offset(h*l,j*l)}break;case"circle":var g=360/c.length;var t=f/2/Math.sin(g/2*Math.PI/180);var u=t/n.distTo(q);n=new JSDraw2.Point(q.x+(n.x-q.x)*u,q.y+(n.y-q.y)*u);if(c[0]!=null){c[0].p=n.clone()}for(var l=1;l<c.length;++l){c[l].p=n.clone().rotateAround(q,g*l)}break}},createAA:function(q,j,g){if(q==null){return}this.pushundo();var l=new JSDraw2.Atom(q.clone().offset(-this.bondlength,0),g==JSDraw2.BIO.AA?"H":"5'");var d=new JSDraw2.Atom(q.clone(),j,{type:g});d.superatom=null;if(g==JSDraw2.BIO.AA){d.superatom=JSDraw2.SuperAtoms.getAA(j)}else{if(g==JSDraw2.BIO.BASE_DNA){d.superatom=JSDraw2.SuperAtoms.getDNA(j)}else{if(g==JSDraw2.BIO.BASE_RNA){d.superatom=JSDraw2.SuperAtoms.getRNA(j)}}}var n=new JSDraw2.Atom(q.clone().offset(this.bondlength,0),g==JSDraw2.BIO.AA?"O":"3'");this.m.addAtom(l);this.m.addAtom(d);this.m.addAtom(n);var f=new JSDraw2.Bond(l,d,JSDraw2.BONDTYPES.SINGLE);d.apo2=2;this.m.addBond(f);f=new JSDraw2.Bond(d,n,JSDraw2.BONDTYPES.SINGLE);d.apo1=1;this.m.addBond(f);this.curObject=d;this.refresh(true)},delAA:function(c){if(c==null||c.biotype()!=JSDraw2.BIO.AA&&c.biotype()!=JSDraw2.BIO.BASE_DNA&&c.biotype()!=JSDraw2.BIO.BASE_RNA){return false}var j=this.findNextAA(c,false);if(j==null){return false}this.m.delBond(j.b,false);var h=this.m.getFragment(j.a);h.offset(c.p.x-j.a.p.x,c.p.y-j.a.p.y);var f=this.m.getNeighborBonds(c);for(var g=0;g<f.length;++g){var d=f[g];if(d.a1==c){d.a1=j.a}else{if(d.a2==c){d.a2=j.a}}}c._parent.delAtom(c);return true},_setSuperatom:function(d){d.superatom=null;var f=d.elem;switch(d.biotype()){case JSDraw2.BIO.BASE_DNA:d.superatom=JSDraw2.SuperAtoms.getDNA(f);break;case JSDraw2.BIO.BASE_RNA:d.superatom=JSDraw2.SuperAtoms.getRNA(f);break;case JSDraw2.BIO.AA:d.superatom=JSDraw2.SuperAtoms.getAA(f);break}},insertAA:function(d,g){if(d==null||!d.bio){return}if(d.biotype()==JSDraw2.BIO.AA&&JSDraw2.SuperAtoms.getAA(g)==null||d.biotype()==JSDraw2.BIO.BASE_DNA&&JSDraw2.SuperAtoms.getDNA(g)!=null||d.biotype()==JSDraw2.BIO.BASE_RNA&&JSDraw2.SuperAtoms.getRNA(g)!=null){return}var h=this.bondlength;var u=true;var j=null;var t=this.findNextAA(d,true);this.pushundo();var n=new JSDraw2.Atom(d.p.clone().offset(h,0),g,dojo.clone(d.bio));var q=new JSDraw2.Bond(n,d,d.biotype()==JSDraw2.BIO.AA?JSDraw2.BONDTYPES.PEPTIDE:JSDraw2.BONDTYPES.SINGLE);this.m.addAtom(n);this.m.addBond(q);this._setSuperatom(n);q.apo1=1;q.apo2=2;if(t!=null){this.m.delBond(t.b,false);var l=this.m.getFragment(t.a);l.offset(h,0);var f=new JSDraw2.Bond(t.a,n,d.biotype()==JSDraw2.BIO.AA?JSDraw2.BONDTYPES.PEPTIDE:JSDraw2.BONDTYPES.SINGLE,true);f.apo1=1;f.apo2=2;this.m.addBond(f)}this.curObject=n;this.refresh(true)},findNextAA:function(c,h){var g=this.m.getNeighborBonds(c);if(g.length==0){return null}else{if(g.length==1){return{a:g[0].otherAtom(c),b:g[0]}}}var f=null;for(var j=g.length-1;j>=0;--j){var l=g[j].otherAtom(c);if(Math.abs(c.p.y-l.p.y)<this.tor/2){if(l.p.x<c.p.x){f=g[j];g.splice(j,1)}else{if(l.p.x>=c.p.x){return{a:l,b:g[j]}}}}}var n=null;for(var j=0;j<g.length;++j){var d=g[j];var l=d.otherAtom(c);if(n==null){n={a:l,b:d}}else{if(!h&&d.isBio()&&!n.b.isBio()){n={a:l,b:d}}else{if(l.p.x<c.p.x&&n.a.p.x<c.p.x||l.p.x>c.p.x&&n.a.p.x>c.p.x){if(l.p.y>n.a.p.y){n={a:l,b:d}}}else{if(l.p.x>c.p.x){n={a:l,b:d}}}}}}if(n==null){return{a:f.otherAtom(c),b:f}}else{if(!h&&!n.a.bio){var l=f.otherAtom(c);if(l.bio){return{a:l,b:f}}}}return n},findNextAAs:function(c,g){var d=[];while(c!=null){var f=this._findNextAA(c,g);if(f!=null){d.push(f);c=f.a}else{break}}return d},_findNextAA:function(c,h){var d=this.m.bonds;for(var f=0;f<d.length;++f){var g=d[f].otherAtom(c);if(g!=null&&Math.abs(g.p.y-c.p.y)<this.tor/2&&(h&&g.p.x>c.p.x||!h&&g.p.x<c.p.x)){return{b:d[f],a:g}}}return null},setSize:function(d,c){if(this.maintable!=null){if(d>0){this.maintable.style.width=d+"px"}if(c>0){this.maintable.style.height=c+"px"}if(this.isSkinW8()){this.resize(d,c-24)}else{this.resize(d-28,c-24)}}else{this.resize(d,c)}},onResize:function(d,c){if(this.options.onresize!=null){if(this.options.onresize()){return}}this.resize(d>0?d:this.div.offsetWidth,c>0?c:this.div.offsetHeight)},resize:function(d,c){if(scil.Utils.isIpad){if(scil.eln!=null||scil.App!=null&&scil.App.AccountTypes!=null){return}}if(this._setSurfaceSize(new JSDraw2.Point(d,c))){if(this.isSkinW8()&&this.toolbar!=null){this.toolbar.recreateTopToolbar()}}},_setSurfaceSize:function(c){if(Math.abs(c.x-this.dimension.x)<6&&Math.abs(c.y-this.dimension.y)<6){return false}if(c.x>0){this.dimension.x=c.x}if(c.y>0){this.dimension.y=c.y}this.div.style.width=this.dimension.x+"px";this.div.style.height=this.dimension.y+"px";this.surface.setDimensions(this.dimension.x,this.dimension.y);this.fitToWindow();this.redraw();return true},dblclick:function(){if(this.popuplocked){scil.Utils.alert("Editing is currently locked");return false}if(this.options.toolbarmode=="helm"){scil.helm.HELMEditor.showpopup(this);return}var d=this;var c=function(f){d.restoreClone(f.clone());d.fitToWindow();d.refresh(true);if(d.options.onpopupsaved!=null){d.options.onpopupsaved(d)}};JSDraw2.Editor.showPopup("JSDraw2 Popup Editor","Save",c,{value:this.clone(),format:"clone"})},_makeChain:function(f,j){if(f==null||f.end!=null&&f.end.distTo(j)<this.tor){return false}if(j.distTo(f.start)<this.bondlength*2){f.p2=j}f.end=j;f.points=[];var g=f.start.distTo(j);var n=f.start;var q;if(f.a==null){if(Math.abs(j.y-n.y)/Math.abs(j.x-n.x)<0.1){q=n.clone().offset(this.bondlength*(j.x>n.x?1:-1),0).rotateAround(n,30)}else{q=this._guessBond(n,f.p2,true)}}else{q=this._guessAutoBond(f.a,j)}if(q==null){return false}f.points=[f.start];f.points.push(q);var c;var h=f.start.distTo(q);while(h!=0&&h<g){var l=q;if(f.points.length==2){var t=n.clone().rotateAround(l,120);var u=n.clone().rotateAround(l,-120);if(t.distTo(j)<u.distTo(j)){q=t;c=120}else{q=u;c=-120}}else{c=-c;q=n.clone().rotateAround(l,c)}n=l;f.points.push(q);h=f.start.distTo(q)}return true},_guessAutoBond:function(c,l){if(c==null){return null}if(l==null){return c._parent.guessBond(c,this.bondlength)}var q=null;var h=c._parent.getNeighborAtoms(c);if(h.length==0){q=c.p.clone().offset(this.bondlength,0);if(l!=null){var j=Math.round(l.angleTo(c.p)/30)*30;q.rotateAround(c.p,j)}}else{if(h.length==1){var d=h[0];var q=d.p.clone().rotateAround(c.p,-120);if(l!=null){var u=d.p.clone().rotateAround(c.p,120);if(u.distTo(l)<q.distTo(l)){q=u}}}else{if(h.length==2){var d=h[0];var f=h[1];var g=d.p.angleTo(c.p);var n=c.p.middleAngle(d.p,f.p);q=d.p.clone().rotateAround(c.p,n-g+180)}}}return q},_addAutoBond:function(d,h){var l=d._parent;var t=this._guessAutoBond(d);if(t==null){return false}var j=null;var g=this._countAABonds(d);var f=this.Cmd2BondType(h);if(g!=null){if(g.peptideN==0&&g.others==0){j="H";f=JSDraw2.BONDTYPES.PEPTIDE}else{if(g.peptideC==0&&g.others==0){j="O"}else{return false}}}var n=JSDraw2.Atom.cast(this.toggle(t));if(n!=null){if(n._parent!=d._parent){n=null}}if(n==null){n=new JSDraw2.Atom(t,j);this._addNewAtomInExistingGroup(d,[n],true);l.addAtom(n);if(d.group!=null){n.group=d.group}}else{if(l.findBond(d,n)!=null){return false}}var q=new JSDraw2.Bond(d,n,f);l.addBond(q,null,true);return true},_guessBond:function(g,h,f){if(!f&&g.distTo(h)<this.tor){return null}var c=h.angleTo(g);var d=Math.abs(c)%this.angleStop;if(c>0){c=c-d+(d>(this.angleStop/2)?this.angleStop:0)}else{c=-(-c-d+(d>(this.angleStop/2)?this.angleStop:0))}return new JSDraw2.Point(this.bondlength,0).rotate(c).offset(g.x,g.y)},guessArrow:function(f,g){if(f.distTo(g)<this.bondlength){return null}var c=g.angleTo(f);var d=c%90;if(d==0){return g}var h=0;if(d<5){h=-d}else{if(90-d<5){h=90-d}else{return g}}return g.clone().rotateAround(f,h)},frameoffset:{x:0,y:0},setFrameoffset:function(c,d){this.frameoffset.x=c;this.frameoffset.y=d},eventPoint:function(c){var d=true;var g=scil.Utils.getOffset(this.div,d);var h=new JSDraw2.Point(c.clientX-g.x-this.frameoffset.x,c.clientY-g.y-this.frameoffset.y);h.tm=new Date().getTime();h.clientX=c.clientX;h.clientY=c.clientY;return h},getCmd:function(d){if(d==null){d=this.curButton}var c=d==null?"select":d.getAttribute("cmd");if(c.length>2&&c.substr(0,2)=="e-"){c=c.substr(2)}return c},onSelBtn:function(c){var f=c.target||c.srcElement;if(f.getAttribute("cmd")!=null){this.onCmd(f);return}for(var d=0;d<5;++d){f=f.parentNode;if(f==null||f.tagName!="TD"){return}if(f.getAttribute("cmd")!=null){this.onCmd(f);return}}},doCmd:function(c){if(this.toolbar==null){return}var f=this.toolbar.getButtons();for(var d=0;d<f.length;++d){var g=f[d];if(this.options.skin=="si"){g=g.parentNode}if(g.getAttribute("cmd")==c){this.onCmd(g);break}}},onCmd:function(j){var l=true;this.start=null;var d=this.getCmd(j);JSDraw2.Menu.close();switch(d){case"about":case"jsdraw":JSDraw2.Editor.showAbout();break;case"inkclearall":if(this.ink!=null){this.ink.clear()}break;case"inkclear":if(this.ink!=null){this.ink.clearLastOne()}break;case"center":this.pushundo();this.fitToWindow();this.redraw();break;case"zoomin":this.pushundo();this.scale(1.25,new JSDraw2.Point(this.dimension.x/2,this.dimension.y/2));this.redraw();l=false;break;case"zoomout":this.pushundo();this.scale(0.75,new JSDraw2.Point(this.dimension.x/2,this.dimension.y/2));this.redraw();l=false;break;case"new":if(!this.m.isEmpty()){var g=this;g.pushundo();g.clear(null,true);g.refresh(true);if(g.options.filenew!=null){g.options.filenew(g)}}else{if(this.ink!=null){this.ink.clear()}}break;case"save":if(this.options.filesave!=null){this.options.filesave(this)}else{if(scil.Utils.serviceAvailable()){JSDraw2.JSDrawIO.jsdFileSave(this)}else{this.onShowSaveFileDlg()}}break;case"open":if(this.options.fileopen!=null){this.options.fileopen(this)}else{if(scil.Utils.serviceAvailable()){JSDraw2.JSDrawIO.jsdFileOpen(this)}else{this.onShowOpenFileDlg()}}break;case"undo":if(this.undo()){this.refresh(true)}l=true;break;case"redo":if(this.redo()){this.refresh(true)}l=true;break;case"rxn":var c=this.clone();if(this.cleanupRxn(this.bondlength)){this.pushundo(c);this.refresh(true)}break;case"copyprod":var h=this.m.parseRxn(true);if(h!=null&&h.reactants.length>0&&h.products.length==0){this.pushundo();for(var f=0;f<h.reactants.length;++f){h.products.push(h.reactants[f].clone())}this.setRxn(h,false,null,null,false);this.refresh(true)}else{scil.Utils.alert("It's already a reaction")}break;case"rxnmap2":var c=this.clone();if(this.m.clearAtomMap()>0){this.pushundo(c);this.refresh(true)}else{scil.Utils.alert("No reaction map found")}break;case"seq":JSDraw2.SequenceBuilder.show(this,JSDraw2.BIO.AA,"Peptide");break;case"helix":JSDraw2.SequenceBuilder.show(this,JSDraw2.BIO.BASE_DNA,"DNA");break;case"rna":JSDraw2.SequenceBuilder.show(this,JSDraw2.BIO.BASE_RNA,"RNA");break;case"n2s":JSDraw2.JSDrawIO.name2structure(this);break;case"cleanup":JSDraw2.JSDrawIO.cleanup(this);break;case"selectall":if(this.selectAll()){this.redraw()}break;case"copy":this.copy();break;case"cut":if(this.cut()){this.redraw()}break;case"paste":if(this.paste()){this.redraw()}break;case"fliph":this.flip("hori");break;case"flipv":this.flip("vert");break;case"reaxys":case"pubchem":case"chemspider":this.sendQuery(d);l=true;break;case"scifinder":scil.SciFinder.search(this);break;break;case"chemdraw":JSDraw2.ChemdrawPopup.show(this);l=true;break;case"eraser":if(!this.onDel()){l=false}break;case"...":case"more":this.showPT();l=false;break;case"pastechemdraw":JSDraw2.ChemDraw.paste(this);break;case"copychemdraw":JSDraw2.ChemDraw.copy(this);break;case"symbol":this.showSymbolDlg();break;case"template.[custom]":this.showTemplatesDlg();l=false;break;case"tlctemplate":JSDraw2.TLCTemplates.show(true,this);break;case"tlcnumber":this.numberTlcPlates();break;case"fullscreen":case"fullscreen2":if(JSDraw2.Fullscreen!=null){JSDraw2.Fullscreen.show(this)}l=true;break;case"helm_import":if(this.helm!=null){this.helm.showImportDlg()}l=true;break;case"helm_editor":scil.helm.HELMEditor.showpopup(this);l=true;break;case"helm_find":if(this.helm!=null){this.helm.showFindReplaceDlg()}l=true;break;case"helm_mex":if(this.helm!=null){scil.helm.MonomerExplorer.showDlg(this)}l=true;break;case"helm_layout":if(this.helm!=null){this.helm.clean(null,true)}l=true;break;default:l=false;break}if(!l){this.onCmd2(j)}},onCmd2:function(j){var c=this.getCmd(j);if(c=="rxnmap"){var h=this.m.parseRxn();if(h==null||h.reactants.length==0||h.products.length==0){scil.Utils.alert("Please draw a completed reaction first.");return}}var g=dojo.attr(j,"parent");var f=g==null?null:dojo.byId(g);if(f!=null){this.toolbar.exchangeButton(f,j);j=f}if(this.curButton!=j){if(this.options.skin=="w8"){var d=this;if(this.curButton!=null){dojo.style(this.curButton,{backgroundImage:scil.Utils.imgSrc("w8/"+d.options.buttonshape+".png",true)});this.curButton.removeAttribute("pushed")}j.setAttribute("pushed",1);dojo.style(j,{backgroundImage:scil.Utils.imgSrc("w8/"+d.options.buttonshape+"0.png",true)})}else{if(this.options.skin=="si"){if(this.curButton!=null){dojo.style(this.curButton,{background:""});this.curButton.removeAttribute("pushed")}j.setAttribute("pushed",1);dojo.style(j,{background:JSDraw2.Skin.jsdraw.btnselcolor})}else{if(this.curButton!=null){dojo.style(this.curButton,{border:"none",padding:"2px"})}dojo.style(j,{border:"solid 1px",borderColor:"#c0c0c0 #f5f5f5 #f5f5f5 #c0c0c0",padding:"1px"})}}this.curButton=j}},flip:function(g){if(this.m.isEmpty()){return}var u=[];var c=this.m.atoms;for(var q=0;q<c.length;++q){if(c[q].selected){u.push(c[q])}}if(u.length==0){var n=this.m.graphics;for(var q=0;q<n.length;++q){if(n[q].selected&&JSDraw2.Curve.cast(n[q])!=null){u.push(n[q])}}if(u.length!=0){this.pushundo();for(var q=0;q<u.length;++q){u[q].flip()}this.refresh(true);return}}var j=null;var h=null;var d=null;if(u.length==0){d=this.getCenter();u=c}else{if(u.length==1){d=u[0].p.clone();var l=this.getFragment(u[0]);if(l!=null){u=l.atoms}}else{if(u.length==2&&(j=this.m.findBond(u[0],u[1]))!=null){d=j.center();var l=this.getFragment(u[0]);if(l!=null){u=l.atoms}}else{var t=this.getConnectingAtomBonds(u);if(t.length==1){j=t[0].b;d=(j.a1.f?j.a1:j.a2).p.clone()}else{if(t.length==2){h={a1:t[0].a,a2:t[1].a}}else{d=this.getCenter(u)}}}}}if(j!=null){h={a1:j.a1,a2:j.a2}}this.pushundo();if(h!=null){var f=h.a2.p.angleTo(h.a1.p);d=h.a1.p.clone();this.rotate(u,d,-f);for(var q=0;q<u.length;++q){var w=u[q].p;w.y=d.y-(w.y-d.y)}this.rotate(u,d,f)}else{if(g=="vert"){for(var q=0;q<u.length;++q){var w=u[q].p;w.y=d.y-(w.y-d.y)}}else{for(var q=0;q<u.length;++q){var w=u[q].p;w.x=d.x-(w.x-d.x)}}}this._invertStereoBonds(u);this.refresh(true)},_invertStereoBonds:function(g){var c=g.length==this.m.atoms.length;for(var f=0;f<this.m.bonds.length;++f){var d=this.m.bonds[f];if(d.type==JSDraw2.BONDTYPES.WEDGE||d.type==JSDraw2.BONDTYPES.HASH){if(scil.Utils.indexOf(g,d.a1)>=0||scil.Utils.indexOf(g,d.a2)>=0){d.type=d.type==JSDraw2.BONDTYPES.WEDGE?JSDraw2.BONDTYPES.HASH:JSDraw2.BONDTYPES.WEDGE}}}},sendQuery:function(c){var d=this.getSmiles();if(d==null||d==""){scil.Utils.alert("No query structure drawn");return}var f;switch(c.toLowerCase()){case"pubchem":f="http://pubchem.ncbi.nlm.nih.gov/search/search.cgi?cmd=search&q_type=dt&simp_schtp=fs&q_data=";break;case"chemspider":f="http://www.chemspider.com/Search.aspx?q=";break;case"reaxys":f="https://www.reaxys.com/reaxys/secured/hopinto.do?context=S&query=";break;default:return}f+=escape(d);window.open(f,"_blank")},onShowOpenFileDlg:function(){var h=JSDraw2.Editor;if(h.openfiledlg==null){var f=null;if(jsd.options.toolbarmode=="tlc"){f=JSDraw2.JSDrawIO.jsdFiles2}else{f=JSDraw2.JSDrawIO.jsdFiles}var d={filetype:{label:"File Type",type:"select",items:f},contents:{label:"Contents",type:"textarea",width:800,height:400}};h.openfiledlg=scil.Form.createDlgForm("Import File",d,{label:"Import",onclick:function(){h.onOpenFile()}})}var c={};var g=scil.Utils.getDictKeys(h.openfiledlg.form.items.filetype.items);if(g.length==1){c={filetype:g[0]}}h.openfiledlg.show();h.openfiledlg.form.setData(c);h.openfiledlg.jsd=this},onShowSaveFileDlg:function(){var h=JSDraw2.Editor;if(h.savefiledlg==null){var f=null;if(jsd.options.toolbarmode=="tlc"){f=JSDraw2.JSDrawIO.jsdFiles2}else{f=JSDraw2.JSDrawIO.jsdFiles}var d={filetype:{label:"File Type",addblank:false,type:"select",items:f},contents:{label:"Contents",type:"textarea",width:800,height:400}};h.savefiledlg=scil.Form.createDlgForm("Export File",d,null,{onchange:function(j){if(j==h.savefiledlg.form.fields.filetype){h.onSaveFile()}}})}var c={};var g=scil.Utils.getDictKeys(h.savefiledlg.form.items.filetype.items);if(g.length==1){c={filetype:g[0]}}h.savefiledlg.show();h.savefiledlg.form.setData(c);h.savefiledlg.jsd=this;if(g.length==1){h.onSaveFile()}},onPT:function(c){JSDraw2.Editor.periodictable.hide();if(c!=null){this.ptElement=c}},showPT:function(c){JSDraw2.needPro()},showAtomDlg:function(c){JSDraw2.needPro()},setAtomProps:function(c){JSDraw2.needPro()},showBondDlg:function(c){JSDraw2.needPro()},setBondProps:function(c){JSDraw2.needPro()},setJdx:function(c){var d=new JSDraw2.Mol();d.setJdx(c,this.bondlength);this.setMol(d)},getData:function(c){if(c=="mol"){return this.getMolfile()}else{if(c=="mol3000"){return this.getMolfile(true)}else{if(c=="rxn"){return this.getRxnfile()}else{if(c=="rxn3000"){return this.getRxnfile(null,true)}else{if(c=="xml"){return this.getXml()}else{if(c=="helm"){return this.getHelm()}else{if(c=="xhelm"){return this.getXHelm()}else{if(c=="smiles"){return this.m.getSmiles()}else{if(c=="helm"){return this.getHelm()}else{if(c=="xhelm"){return this.getXHelm()}else{return null}}}}}}}}}}},setData:function(c,d){this.setFile(c,d)},setFile:function(c,d){var f=null;if(d=="mol"){f=this.m.setMolfile(c)}else{if(d=="rxn"){f=this.m.setRxnfile(c)}else{if(d=="xml"){f=this.m.setXml(c)}else{if(d=="helm"){this.setHelm(c);return}else{if(d=="xhelm"){this.setXHelm(c);return}else{if(d=="jdx"){f=this.m.setJdx(c,this.bondlength)}else{return}}}}}}if(f==null){this.clear(true);return}this.setMol(f);return this.m},setMol:function(c){if(c!=null&&typeof(c)=="object"&&c.T=="MOL"){this.m=c;this.m.showimplicithydrogens=this.options.showimplicithydrogens;if(this.options.removehydrogens){this.m.removeHydrogens()}this.m.calcHCount();this.m.toScreen(this.bondlength);this.fitToWindow();this._setmol(this.m);this.refresh(true);return true}return false},setMolfile:function(c){this.setFile(c,"mol")},setRxnfile:function(c){this.setFile(c,"rxn")},getMolfile:function(d,c){this.m.bondlength=this.bondlength;return this.m.getMolfile(false,d,c)},getSvg:function(){var c=dojox.gfx;if(c.renderer!="svg"){return null}var f=this.m.rect();f.inflate(20,20);var d=dojox.gfx.utils;this.m.offset(-f.left,-f.top);this.redraw();var h=d._cleanSvg(d._innerXML(this.surface.rawNode));this.m.offset(f.left,f.top);this.redraw();h=h.replace(/ width="[0-9]+"/,' width="'+Math.round(f.width)+'"');h=h.replace(/ height="[0-9]+"/,' height="'+Math.round(f.height)+'"');return h},getXml:function(h,d,g,j){var f=null;try{f=j?this.getSvg():null}catch(c){}this.m.bondlength=this.bondlength;return this.m.getXml(h>0?h:this.dimension.x,d>0?d:this.dimension.y,g,f,this.bondlength)},getHtml:function(f,c,d,g){return this.getXml(f,c,d,g)},getSequence:function(c){return this.helm==null?null:this.helm.getSequence(c)},getHelm:function(c,d){return this.helm==null?null:this.helm.getHelm(c,d)},setHelm:function(c){return this.helm==null?null:this.helm.setHelm(c)},getXHelm:function(){return this.helm==null?null:this.helm.getXHelm()},setXHelm:function(c){return this.helm==null?null:this.helm.setXHelm(c)},setXml:function(g,f){var c=typeof(g)=="string"?scil.Utils.parseXml(g):g;if(c==null){if(typeof(g)=="string"&&g.indexOf("M  END")>0){return this.setMolfile(g)}return}if(this.helm!=null&&this.helm.isXHelm(c)){this.setXHelm(c);return}this.clear();var d=null;if(typeof(g)=="string"){d=c==null?null:(c.documentElement||c.firstElementChild)}else{d=g}this.m.setXml(d);this.m.calcHCount();if(this.m.bondlength>0){this.m.scale(JSDraw2.Editor.BONDLENGTH/this.m.bondlength);this.resetScale()}else{this.m.toScreen(this.bondlength)}this.fitToWindow();this._setmol(this.m);this.refresh(f==null?true:f);return this.m},setHtml:function(c){return this.setXml(c)},getRxnfile:function(c,d){return this.m.getRxnfile(c,d)},getSmiles:function(){return this.m.getSmiles()},setMolbase64:function(c){var d=JSDraw2.Base64.decode(c);this.setMolfile(d)},setRxnbase64:function(c){var d=JSDraw2.Base64.decode(c);this.setRxnfile(d)},getMolbase64:function(){var c=this.m.getMolfile();return JSDraw2.Base64.encode(c)},hasHelmNodes:function(){if(this.helm==null){return false}for(var c=0;c<this.m.atoms.length;++c){if(scil.helm.isHelmNode(this.m.atoms[c])){return true}}return false},getAtomStats:function(){var c=this.m.expandSuperAtoms();if(this.hasHelmNodes()){return scil.helm.Formula.getAtomStats(c)}else{return JSDraw2.FormulaParser.getAtomStats(c)}},getFormula:function(c){if(this.hasHelmNodes()){return this.helm.getMF(c)}else{return this.m.getFormula(c)}},getMolWeight:function(){if(this.hasHelmNodes()){return this.helm.getMW()}else{return this.m.getMolWeight()}},getExtinctionCoefficient:function(){if(this.hasHelmNodes()){return this.helm.getExtinctionCoefficient()}else{return null}},getExactMass:function(){return this.m.getExactMass()},setAny:function(g,d){if(!scil.Utils.serviceAvailable()||g==null||g.length==0){return}var f=this;var h={url:scil.Utils.scriptUrl()+"Service.aspx?cmd=tomolfile",postData:"input="+escape(g)+"&fmt="+escape(d),handleAs:"json",load:function(j){if(j.success){f.pushundo(f.clone());f.setMolfile(j.result)}else{scil.Utils.alert(j.error)}},error:function(j){scil.Utils.alert(j.message)}};var c=dojo.rawXhrPost(h)},highlight:function(f){var d=null;if(typeof f=="string"){d=new JSDraw2.Mol(this.options.showimplicithydrogens).setMolfile(f)}else{d=f.T=="MOL"?f:f.m}if(d==null){return false}var g=this;var c=d.aamap(g.m,false,true);g.redraw();return c!=null},sss:function(c){return c.highlight(this)},res:function(c){return JSDraw2.Language.res(c)},isSkinW8:function(){return this.options.skin=="w8"||this.options.skin=="si"},download:function(g,d){var f=this;var c=function(h){if(h.ret!=null){f.setFile(h.ret.molfile,d)}else{f.setFile(h,d)}};scil.Utils.download(g,c)},writeCookie:function(f,c){if(f==null||f.length==0){f="__jsdraw_cookie_structure"}if(!(c>0)){c=30}var d=this.getXml();scil.Utils.createCookie(f,d,c)},readCookie:function(d){if(d==null||d.length==0){d="__jsdraw_cookie_structure"}var c=scil.Utils.readCookie(d);this.setXml(c)},destroy:function(){this.div=null;this.curObject=null;this.curButton=null;this.texteditor={input:null,text:null,atom:null};this.maintable=null;if(this.toolbar!=null){this.toolbar.destroy();this.toolbar=null}if(this.surface!=null){try{this.surface.destroy()}catch(c){}this.surface=null}for(var d=0;d<this.connectHandlers.length;++d){dojo.disconnect(this.connectHandlers[d])}this.connectHandlers=null},bodyMouseDown:function(d){var h=d.target||d.srcElement;if(this.texteditor.ed!=null&&this.texteditor.ed.isVisible()&&!(this.texteditor.ed.isChildOf(h)||JSDraw2.Symbol!=null&&JSDraw2.Symbol.isFrom(h))){this.hideTextEditor();return}if(this.texteditor.ed!=null&&this.texteditor.ed.isChildOf(h)||this.contextmenu!=null&&this.contextmenu.isFrom(h)){return}var c=scil.Dialog.getDialog(h);if(c!=null&&c.owner==this){return}if(this._testdeactivation!=null){if(this._testdeactivation(d,this)){return}}var g=scil.Utils.hasAnsestor(h,this.surface.children[0].rawNode)||this.isFromSvgGroup(h)||scil.Utils.hasAnsestor(h,this.maintable);if(this.activated){if(!g){this.activate(false)}}else{if(g){this.activate(true)}}},isFromSvgGroup:function(d){if(dojox.gfx.renderer!="svg"){return false}var c=scil.Utils.getParent(d,"g");return c!=null&&c.getAttribute("__surface_parentid")==this.id},bodyTouchStart:function(c){if(this.activated&&c.touches.length>0){var f=c.touches[0];var d=f.target||f.srcElement;if(!scil.Utils.hasAnsestor(d,this.maintable)){this.activate(false)}}this.bodyMouseDown(c)},touchClick:function(c){if(!this.activated){this.activate(true);c.preventDefault();return false}},touch:{reset:function(c){if(this.cloned!=null){c.pushundo(this.cloned);c.setModified(true)}this.center=null;this.start1=null;this.start2=null;this.end1=null;this.end2=null;this.gesture=null;this.deg=null;this.scale=null;this.cloned=null}},resetGesture:function(){this.touch.reset(this)},holding:{delay:1000,tor:2,e:null,tm:null,timer:null,jsd:null,start:function(c,d){if(!scil.Utils.isTouch&&!window.navigator.msPointerEnabled){return}this.end();this.e={clientX:c.clientX,clientY:c.clientY};this.tm=new Date().getTime();this.jsd=d;var f=this;this.timer=setTimeout(function(){f.timeout()},this.delay)},end:function(){if(this.timer==null){return}this.e=null;this.tm=null;clearTimeout(this.timer);this.timer=null},timeout:function(){if(this.e!=null){this.jsd.start=null;this.jsd.showContextMenu(this.e,this.jsd.options.viewonly)}this.end()},move:function(c){if(this.e!=null&&(Math.abs(c.clientX-this.e.clientX)>this.tor||Math.abs(c.clientY-this.e.clientY)>this.tor)){this.end()}}},touchStart:function(c){if(!this.activated){return}if(JSDraw2.Menu.isOpen()){JSDraw2.Menu.close();c.preventDefault();return false}if(c.touches.length==1){this.mousedown(c.touches[0]);c.preventDefault();return false}else{if(c.touches.length==2){this.lastmove=null;this.resetGesture();this.touch.start1=this.eventPoint(c.touches[0]);this.touch.start2=this.eventPoint(c.touches[1]);this.touch.center=new JSDraw2.Point((this.touch.start1.x+this.touch.start2.x)/2,(this.touch.start1.y+this.touch.start2.y)/2);c.preventDefault();return false}}},touchMove:function(q){if(!this.activated){return}if(q.touches.length==1){this.mousemove(q.touches[0]);q.preventDefault();this.resetGesture();return false}this.holding.end();if(this.ink!=null){this.ink.cancel()}this.start=null;if(q.touches.length==2){var t=this.eventPoint(q.touches[0]);var u=this.eventPoint(q.touches[1]);if(this.touch.start1==null){this.touch.start1=t;this.touch.start2=u;return}if(t.equalsTo(this.touch.end1)&&u.equalsTo(this.touch.end2)){return}this.touch.end1=t;this.touch.end2=u;if(this.touch.gesture==null&&this.touch.start1!=null&&this.touch.start2!=null){var g=this.touch.end1.distTo(this.touch.start1);var h=this.touch.end2.distTo(this.touch.start2);if(g>25||h>25){var c=this.touch.end1.angleTo(this.touch.start1);var d=this.touch.end2.angleTo(this.touch.start2);var j=Math.abs(c-d);if(g>8&&h>8&&(j<30||Math.abs(j-360)<30)){this.touch.gesture="moving"}else{var f=g>25?this.touch.start1.angleAsOrigin(this.touch.end1,this.touch.start2):this.touch.start2.angleAsOrigin(this.touch.end2,this.touch.start1);if(Math.abs(f-180)<45||Math.abs(f-360)<45){this.touch.gesture="zooming"}else{this.touch.gesture="rotating"}}}}if(this.touch.gesture!=null&&(!this.touch.end1.equalsTo(this.touch.start1)||!this.touch.end2.equalsTo(this.touch.start2))){if(this.touch.gesture=="zooming"){var l=this.touch.end1.x-this.touch.start1.x;var n=this.touch.end2.y-this.touch.start1.y;if(Math.abs(l)>=this.movingresolution||Math.abs(n)>=this.movingresolution){this.touch.scale=this.touch.end1.distTo(this.touch.end2)/this.touch.start1.distTo(this.touch.start2);if(this.touch.cloned==null){this.touch.cloned=this.clone()}this.scale(this.touch.scale,this.touch.center);this.touch.start1=this.touch.end1;this.touch.start2=this.touch.end2;this.redraw()}}else{if(this.touch.gesture=="moving"){var l=this.touch.end1.x-this.touch.start1.x;var n=this.touch.end1.y-this.touch.start1.y;if(Math.abs(l)>=this.movingresolution||Math.abs(n)>=this.movingresolution){if(this.touch.cloned==null){this.touch.cloned=this.clone()}this.m.offset(l,n);this.touch.start1=this.touch.end1;this.redraw()}}else{if(this.touch.gesture=="rotating"){var c=this.touch.start2.angleAsOrigin(this.touch.start1,this.touch.end1);var d=this.touch.start1.angleAsOrigin(this.touch.start2,this.touch.end2);if(c>180){c-=360}if(d>180){d-=360}if((Math.abs(c)>=1||Math.abs(d)>=1)&&Math.abs(c)<30&&Math.abs(d)<30){var w=Math.abs(d)/(Math.abs(c)+Math.abs(d));var z=this.touch.start1.x+(this.touch.start2.x-this.touch.start1.x)*w;var A=this.touch.start1.y+(this.touch.start2.y-this.touch.start1.y)*w;this.m.rotate(new JSDraw2.Point(z,A),Math.abs(c)>Math.abs(d)?c:d);this.touch.start1=this.touch.end1;this.touch.start2=this.touch.end2;this.redraw()}}}}}q.preventDefault();return false}this.resetGesture()},touchEnd:function(c){if(!this.activated){return}this.resetGesture();this.mouseup(c);return false},activate:function(c,d){if(this.activated==c||this.maintable==null){return}this.activated=c;if(c){if(JSDraw2.__currentactived!=this&&JSDraw2.__currentactived!=null){JSDraw2.__currentactived.activate(false)}JSDraw2._currentactived=this}if(window.navigator.msPointerEnabled){if(c){if(document.body.style.overflow!="hidden"){this._msContentZooming=document.body.style.msContentZooming;this._overflow=document.body.style.overflow;document.body.style.msContentZooming="none";document.body.style.overflow="hidden"}}else{if(document.body.style.overflow!=this._overflow){document.body.style.msContentZooming=this._msContentZooming;document.body.style.overflow=this._overflow}}}if(!c&&this.contextmenu!=null){this.contextmenu.hide()}if(d==false){return}if(this.options.focusbox!=false){this.maintable.style.borderColor=c?(this.options.focuscolor==null?"#5555ff":this.options.focuscolor):"#cccccc"}if(!c&&this.curObject!=null){this.curObject=null;this.redraw()}if(this.options.onfocus!=null){this.options.onfocus(c)}}});scilligence.apply(JSDraw2.Editor,{__xcode:91,undoGestureTime:300,dblclickdelay:300,BONDLENGTH:30,ANGLESTOP:30,LINEWIDTH:2,TOR:10,FONTSIZE:14,get:function(c){if(JSDraw2.Editor._allitems==null){JSDraw2.Editor._allitems={}}return c==null?null:JSDraw2.Editor._allitems[c]},getClipboard:function(){var c=scil.Utils.readCookie("__jsdrawclipboard");if(c==null||c==""){return null}if(c.substr(0,1)=="@"){var f=c.indexOf(":");var g=parseInt(c.substr(1,f-1));c=c.substr(f+1);if(new Date().getTime()-g>5*60000){scil.Utils.eraseCookie("__jsdrawclipboard");return null}}c=JSDraw2.Base64.decode(c);var d=new JSDraw2.Mol();if(d.setXml(c)==null||d.isEmpty()){return null}return d},setClipboard:function(d,c){if(d!=null&&!d.isEmpty()){var f=new Date().getTime();scil.Utils.createCookie("__jsdrawclipboard","@"+f+":"+JSDraw2.Base64.encode(d.getXml(null,null,null,null,c)));return true}scil.Utils.eraseCookie("__jsdrawclipboard");return false},showAbout:function(){if(JSDraw2.Editor.about==null){var d=scil.Utils.createElement(null,"div",null,{width:"430px",color:"black"});scil.Utils.createElement(d,"img",null,null,{src:scil.Utils.imgSrc("img/jsdraw2.jpg")});var f=JSDraw2.Security.lic==null?null:JSDraw2.Security.lic.expiration;var g=JSDraw2.Security.error!=null?JSDraw2.Security.error:"Licensed to <b>"+JSDraw2.Security.lic.licensor+"</b>, expires on "+f.getFullYear()+"-"+(f.getMonth()+1)+"-"+f.getDate();if(!JSDraw2.Security.valid){g="<span style='color:red'>"+g+"</span>"}scil.Utils.createElement(d,"div",g,{textAlign:"right"});var h=scil.Utils.createTable(d,null,null,{borderTop:"solid 1px gray",width:"100%"});var j=scil.Utils.createElement(h,"tr");scil.Utils.createElement(j,"td",JSDraw2.version);scil.Utils.createElement(j,"td","<a target='_blank' href='http://www.jsdraw.com'>http://www.jsdraw.com</a>",{textAlign:"right"});var c=scil.Utils.createElement(scil.Utils.createElement(d,"div",null,{textAlign:"center"}),"button","OK",{width:scil.Utils.buttonWidth+"px"});JSDraw2.Editor.about=new JSDraw2.Dialog(JSDraw2.Language.res("About JSDraw"),d);scil.connect(c,"onclick",function(l){JSDraw2.Editor.about.hide();l.preventDefault()})}JSDraw2.Editor.about.show()},onClickPT:function(c,d){JSDraw2.Editor.get(d).onPT(c)},onSaveFile:function(){var c=JSDraw2.Editor.savefiledlg.form.fields;var d=c.filetype.value;var f=c.contents;f.value=JSDraw2.Editor.savefiledlg.jsd.getData(d);f.select();f.focus()},onOpenFile:function(){var c=JSDraw2.Editor.openfiledlg.form.fields;var f=c.contents.value;var d=c.filetype.value;JSDraw2.Editor.openfiledlg.jsd.setData(f,d);JSDraw2.Editor.openfiledlg.hide()},initNoDelay:function(){var f=document.getElementsByTagName("div");for(var d=0;d<f.length;d++){var c=f[d];if(dojo.hasClass(c,"JSDraw")){new JSDraw2.Editor(c);dojo.removeClass(c,"JSDraw")}}},init:function(){scil.onload(function(){JSDraw2.Editor.initNoDelay()})},create:function(c,d){dojo.ready(function(){new JSDraw2.Editor(c,d)})},write:function(c,d){document.writeln("<div id='"+c+"'></div>");scil.onload(function(){new JSDraw2.Editor(c,d)})},showPopupIframe:function(h,d,c,j){var f=false;var g=scil.Utils.getTopWindow();g.JSDraw2.Editor.showPopup(h,d,c,j)},getPopupSize:function(l){var c={width:800,height:400};if(JSDraw2.defaultoptions!=null){var j=JSDraw2.defaultoptions.popupwidth||JSDraw2.defaultoptions.popupWidth;var g=JSDraw2.defaultoptions.popupheight||JSDraw2.defaultoptions.popupHeight;var f=scil.Utils.getScreenSize(l);if(typeof(j)=="string"&&j.substr(j.length-1,1)=="%"){c.width=f.w*parseInt(j.substr(0,j.length-1))/100}else{if(j>0){c.width=s}}if(typeof(g)=="string"&&j.substr(g.length-1,1)=="%"){c.height=f.h*parseInt(g.substr(0,g.length-1))/100}else{if(g>0){c.height=g}}}return c},showPopup:function(n,f,d,t,u){var c=null;if(JSDraw2.Editor.popupdlg==null){c=this.getPopupSize();var j=scil.Utils.createTable();var q=scil.Utils.createElement(j,"tr");var l=scil.Utils.createElement(q,"td");c.div=scil.Utils.createElement(l,"div",null,{width:c.width+"px",height:c.height+"px"});q=scil.Utils.createElement(j,"tr");l=scil.Utils.createElement(q,"td",null,{textAlign:"center"});var g=scil.Utils.createElement(l,"button",null,{width:scil.Utils.buttonWidth+"px"});JSDraw2.Editor.popupdlg=new JSDraw2.Dialog(n,j.parentNode);JSDraw2.Editor.popupdlg.button=g}JSDraw2.Editor.popupdlg.show(n,u);if(c!=null){if(JSDraw2.defaultoptions.popupxdraw){c.height-=40;c.value=t;JSDraw2.Editor.popupdlg.jsd=new scilligence.XDraw(c.div,c)}else{c.div.style.border="solid 1px #ddd";JSDraw2.Editor.popupdlg.jsd=new JSDraw2.Editor(c.div);this._loadPopupData(t)}if(!scil.Utils.isIE||scil.Utils.isIE>8){JSDraw2.Editor.popupdlg.updateWidth()}var h=function(w){var x=true;if(JSDraw2.Editor.popupdlg.callback!=null){x=JSDraw2.Editor.popupdlg.callback(JSDraw2.Editor.popupdlg.jsd);JSDraw2.Editor.popupdlg.callback=null}if(x!=false){JSDraw2.Editor.popupdlg.hide()}w.preventDefault()};dojo.connect(JSDraw2.Editor.popupdlg.button,"onclick",h)}else{this._loadPopupData(t)}JSDraw2.Editor.popupdlg.button.innerHTML=scil.Utils.imgTag("tick.gif",f);JSDraw2.Editor.popupdlg.callback=d;return JSDraw2.Editor.popupdlg.jsd},_loadPopupData:function(c){if(c==null){JSDraw2.Editor.popupdlg.jsd.clear(true);return}if(c.format=="jsdraw"||c.format=="html"||c.format=="xml"){JSDraw2.Editor.popupdlg.jsd.setXml(c.value)}else{if(c.format=="mol"||c.format=="molfile"){JSDraw2.Editor.popupdlg.jsd.setMolfile(c.value)}else{if(c.format=="jdx"){JSDraw2.Editor.popupdlg.jsd.setJdx(c.value)}else{if(c.format=="clone"){JSDraw2.Editor.popupdlg.jsd.restoreClone(c.value);JSDraw2.Editor.popupdlg.jsd.fitToWindow()}else{JSDraw2.Editor.popupdlg.jsd.clear(true)}}}}JSDraw2.Editor.popupdlg.jsd.refresh()}});scilligence.mstouch={pointers:{},down:function(c){this.pointers[c.pointerId]={clientX:c.clientX,clientY:c.clientY,target:c.target,button:c.button,pointerId:c.pointerId,_tm:new Date().getTime()};c.touches=this.toTouches();return c},move:function(c){var d=this.pointers[c.pointerId];if(d==null){return}d.clientX=c.clientX;d.clientY=c.clientY;d._tm=new Date().getTime();c.touches=this.toTouches();return c},up:function(c){delete this.pointers[c.pointerId];c.touches=this.toTouches();return c},toTouches:function(){var h=[];var g=new Date().getTime();var f=[];for(var d in this.pointers){if(this.pointers[d]._tm>g-5000){h.push(this.pointers[d])}else{f.push(d)}}for(var c=0;c<f.length;++c){delete this.pointers[f[c]]}h.sort(function(j,l){return j.pointerId-l.pointerId});return h}};JSDraw=JSDraw2.Editor;JSDraw2.Bracket=scilligence.extend(scilligence._base,{constructor:function(f,c,d){this.T="BRACKET";this.atoms=[];this.type=f;this._rect=c;this.color=null;this.shape=d},clone:function(){var c=new JSDraw2.Bracket(this.type,this._rect.clone(),this.shape);c.color=this.color;c.sgrouptexts=this.sgrouptexts;return c},getXbonds:function(l){var j=[];var d=l.bonds;for(var h=0;h<d.length;++h){var c=d[h];var f=scil.Utils.indexOf(this.atoms,c.a1)>=0;var g=scil.Utils.indexOf(this.atoms,c.a2)>=0;if(f!=g){j.push(c)}}return j},allAtomsIn:function(d){if(this.atoms.length==0){return false}for(var c=0;c<this.atoms.length;++c){if(d.atoms.indexOf(this.atoms[c])<0){return false}}return true},getTypeNum:function(){if(this.type==null){return null}var c=this.type+"";if(c.match(/^[c][0-9]+$/)){return c.substr(1)}return null},getType:function(){if(this.type==null){return""}var c=this.type+"";if(c.match(/^[c][0-9]+$/)){c="c"}return c},getSubscript:function(c){var d=c.getSgroupText(this,"BRACKET_TYPE");return d==null?null:d.text},createSubscript:function(d,f){if(scil.Utils.isNullOrEmpty(f)){return null}var g=d.getSgroupText(this,"BRACKET_TYPE");if(g!=null){return g}var c=d.medBondLength(1.56)/2;g=d.setSgroup(this,"BRACKET_TYPE",f,this._rect.right()+c/4,this._rect.bottom()-c);return g},html:function(f){var g="";if(this.atoms!=null&&this.atoms.length>0){g=this.atoms[0].id+"";for(var c=1;c<this.atoms.length;++c){g+=","+this.atoms[c].id}}var d="<i i='"+this.id+"' x='"+this.T+"' t='"+scilligence.Utils.escXmlValue(this.type)+"'";if(this.color!=null){d+=" clr='"+this.color+"'"}if(this.shape!=null){d+=" shape='"+this.shape+"'"}d+=" r='"+this._rect.toString(f)+"'";d+=" atoms='"+g+"'></i>";return d},flipY:function(c){},flipX:function(c){},scale:function(d,c){this._rect.scale(d,c)},offset:function(c,d){this._rect.offset(c,d)},rect:function(){return this._rect},toggle:function(c,f){var d=this._rect;if(d==null){return}var g=c.x-d.left;var h=d.right()-c.x;return c.y>=d.top-f&&c.y<=d.bottom()+f&&(g>=-f/2&&g<f||h>=-f/2&&h<f)},drawCur:function(j,g,c,f){var h=this._rect;if(h==null){return}var l=h.center().y;j.createCircle({cx:h.left,cy:l,r:g}).setFill(c);j.createCircle({cx:h.right(),cy:l,r:g}).setFill(c);if(f!=null){for(var d=0;d<this.atoms.length;++d){this.atoms[d].drawCur(j,g*0.75,c)}}},draw:function(j,f,g,d){var h=this._rect;var c=this.color==null?"gray":this.color;JSDraw2.Drawer.drawBracket(j,h,c,f)},drawSelect:function(c){c.draw(this,this._rect.fourPoints())},cornerTest:function(c,d){return this._rect.cornerTest(c,d)},resize:function(c,f,h){this._rect.moveCorner(c,f);if(h==null){return}switch(c){case"topleft":for(var g=0;g<h.topleft.length;++g){h.topleft[g]._rect.offset(f.x,f.y)}for(var g=0;g<h.topright.length;++g){h.topright[g]._rect.offset(0,f.y)}for(var g=0;g<h.bottomleft.length;++g){h.bottomleft[g]._rect.offset(f.x,0)}break;case"topright":for(var g=0;g<h.topright.length;++g){h.topright[g]._rect.offset(f.x,f.y)}for(var g=0;g<h.topleft.length;++g){h.topleft[g]._rect.offset(0,f.y)}for(var g=0;g<h.bottomright.length;++g){h.bottomright[g]._rect.offset(f.x,0)}break;case"bottomleft":for(var g=0;g<h.bottomleft.length;++g){h.bottomleft[g]._rect.offset(f.x,f.y)}for(var g=0;g<h.bottomright.length;++g){h.bottomright[g]._rect.offset(0,f.y)}for(var g=0;g<h.topleft.length;++g){h.topleft[g]._rect.offset(f.x,0)}break;case"bottomright":for(var g=0;g<h.bottomright.length;++g){h.bottomright[g]._rect.offset(f.x,f.y)}for(var g=0;g<h.bottomleft.length;++g){h.bottomleft[g]._rect.offset(0,f.y)}for(var g=0;g<h.topright.length;++g){h.topright[g]._rect.offset(f.x,0)}break}},removeObject:function(f){var c=JSDraw2.Atom.cast(f);if(c==null){return}for(var d=0;d<this.atoms.length;++d){if(this.atoms[d]==c){this.atoms.splice(d,1);break}}},getTexts:function(h){var j={topleft:[],topright:[],bottomleft:[],bottomright:[]};var f=this._rect.center();for(var g=0;g<h.graphics.length;++g){var l=JSDraw2.Text.cast(h.graphics[g]);if(l==null||l.anchors.length!=1||l.anchors[0]!=this){continue}var d=l._rect.center();if(d.x<f.x){if(d.y<f.y){j.topleft.push(l)}else{j.bottomleft.push(l)}}else{if(d.y<f.y){j.topright.push(l)}else{j.bottomright.push(l)}}}return j}});JSDraw2.Bracket.cast=function(c){return c!=null&&c.T=="BRACKET"?c:null};JSDraw2.Group=scil.extend(scil._base,{constructor:function(c,d){this.T="GROUP";this.type=d;this.name=c;this.id=null;this._rect=null;this.p=null;this.gap=6;this.group=null;this.color=null;this.a=null;this.ratio=null;this.tag=null},clone:function(){var c=new JSDraw2.Group(this.name,this.type);c.id=this.id;c._rect=this._rect==null?null:this._rect.clone();c.p=this.p==null?null:this.p.clone();c.color=this.color;c.gap=this.gap;c.ratio=this.ratio;c.tag=this.tag;return c},html:function(d){var c="<i i='"+this.id+"' x='"+this.T+"' t='"+scilligence.Utils.escXmlValue(this.type)+"' n='"+this.name+"'";if(this.color!=null){c+=" clr='"+this.color+"'"}if(this.gap>0){c+=" gap='"+this.gap+"'"}c+="></i>";return c},readHtml:function(c){var d=parseFloat(c.getAttribute("gap"));if(d>0){this.gap=d}},flipY:function(c){},flipX:function(c){},scale:function(d,c){},offset:function(c,d){},rect:function(){return this._rect},toggle:function(c,f){var d=this._rect;if(d==null){return}return c.y>=d.top&&c.y<=d.bottom()&&(Math.abs(c.x-d.left)<f/2||Math.abs(c.x-d.right())<f/2)||c.x>=d.left&&c.x<=d.right()&&(Math.abs(c.y-d.top)<f/2||Math.abs(c.y-d.bottom())<f/2)},drawCur:function(n,j,f,h){var l=this._rect;if(l==null){return}var d=l.center();n.createCircle({cx:l.left,cy:d.y,r:j}).setFill(f);n.createCircle({cx:l.right(),cy:d.y,r:j}).setFill(f);n.createCircle({cx:d.x,cy:l.top,r:j}).setFill(f);n.createCircle({cx:d.x,cy:l.bottom(),r:j}).setFill(f);if(h!=null){for(var g=0;g<h.atoms.length;++g){if(h.atoms[g].group!=this){continue}h.atoms[g].drawCur(n,j*0.75,f)}for(var g=0;g<h.graphics.length;++g){if(h.graphics[g].group!=this){continue}h.graphics[g].drawCur(n,j*0.75,f)}}},_updateRect:function(d,c){var f=d.getGroupRect(this,c);this._rect=f;return f},draw:function(j,f,g,d){var h=this._rect;if(h==null){return}var c=this.color==null?"gray":this.color;if(this.type=="chiral"){JSDraw2.Drawer.drawLabel(j,new JSDraw2.Point(h.left+h.width/2,h.top-d),this.name,c,d,false)}else{JSDraw2.Drawer.drawRect(j,h,c,f/4,f*3);JSDraw2.Drawer.drawLabel(j,new JSDraw2.Point(h.left+h.width/2,h.bottom()+d/2),this.name,c,d,false)}if(!scil.Utils.isNullOrEmpty(this.tag)){JSDraw2.Drawer.drawLabel(j,new JSDraw2.Point(h.left,h.top-d),this.tag,"black",d,false,"start")}if(!scil.Utils.isNullOrEmpty(this.ratio)){JSDraw2.Drawer.drawLabel(j,new JSDraw2.Point(h.right(),h.bottom()+d/2),"ratio: "+this.ratio,"black",d,false,"end")}},drawSelect:function(c){c.draw(this,this._rect.fourPoints())}});JSDraw2.Group.cast=function(c){return c!=null&&c.T=="GROUP"?c:null};JSDraw2.Text=scilligence.extend(scilligence._base,{constructor:function(c,d){this.T="TEXT";this._rect=c;this.text=d;this.color=null;this.fontsize=1;this.selected=false;this.fieldtype=null;this.readonly=false;this.anchors=[];this.italic=null},clone:function(){var c=new JSDraw2.Text(this._rect.clone(),this.text);c.id=this.id;c.color=this.color;c.fieldtype=this.fieldtype;c.readonly=this.readonly;c.fontsize=this.fontsize;c.italic=this.italic;return c},allAnchorsIn:function(f){if(this.anchors.length==0){return false}for(var d=0;d<this.anchors.length;++d){var c=this.anchors[d];if(JSDraw2.Atom.cast(c)!=null&&f.atoms.indexOf(c)<0||JSDraw2.Bond.cast(c)!=null&&f.bonds.indexOf(c)<0||JSDraw2.Bracket.cast(c)!=null&&f.graphics.indexOf(c)<0){return false}}return true},attach:function(d){if(JSDraw2.Bracket.cast(d)!=null){this.anchors=[d];return true}if(JSDraw2.Atom.cast(d)==null&&JSDraw2.Bond.cast(d)==null){return false}if(this.anchors.length==1&&JSDraw2.Bracket.cast(this.anchors[0])!=null){this.objects=[]}for(var c=0;c<this.anchors.length;++c){if(this.anchors[c]==d){this.anchors.splice(c,1);return true}}this.anchors.push(d);return true},html:function(f){var g="";for(var c=0;c<this.anchors.length;++c){g+=(g==""?"":",")+this.anchors[c].id}var d="<i i='"+this.id+"' x='"+this.T+"' p='"+this._rect.toString(f)+"'";if(this.color!=null&&this.color!=""){d+=" clr='"+this.color+"'"}if(this.fontsize>0){d+=" fontsize='"+this.fontsize.toFixed(2)+"'"}if(this.readonly){d+=" v='1'"}if(this.italic){d+=" italic='1'"}if(this.fieldtype!=null&&this.fieldtype!=""){d+=" fieldtype='"+scil.Utils.escXmlValue(this.fieldtype)+"'"}if(g!=""){d+=" anchors='"+g+"'"}d+=">"+scilligence.Utils.escXmlValue(this.text)+"</i>";return d},readHtml:function(f,l){var n=JSDraw2.Rect.fromString(f.getAttribute("p"));var q=f.getAttribute("s");if(q==null){q=f.text||f.textContent}if(n==null||scil.Utils.isNullOrEmpty(q)){return false}if(n.width>n.height*100){n.width=n.height*5}if(n.height>n.height*100){n.height=n.width/5}this._rect=n;this.text=q;this.readonly=scil.Utils.isTrue(f.getAttribute("v"));this.italic=scil.Utils.isTrue(f.getAttribute("italic"));this.dummy=scil.Utils.isTrue(f.getAttribute("dum"));this.fieldtype=f.getAttribute("fieldtype");var g=parseFloat(f.getAttribute("fontsize"));if(g>0){this.fontsize=g}var t=f.getAttribute("anchors");if(t!=null&&t!=""){var d=[];var u=t.split(",");for(var h=0;h<u.length;++h){var c=l[parseInt(u[h])];if(c!=null&&(JSDraw2.Atom.cast(c)!=null||JSDraw2.Bond.cast(c)!=null||JSDraw2.Bracket.cast(c)!=null)){d.push(c)}}this.anchors=d}return true},flipY:function(c){},flipX:function(c){},scale:function(d,c){if(this._rect!=null){this._rect.scale(d,c)}},offset:function(c,d){if(this._rect!=null){this._rect.offset(c,d)}},rect:function(){return this._rect==null?null:this._rect.clone()},toggle:function(c,d){return this._rect!=null&&this._rect.contains(c)},removeObject:function(d){for(var c=0;c<this.anchors.length;++c){if(this.anchors[c]==d){this.anchors.splice(c,1);break}}},drawCur:function(j,h,c,f){var g=this._rect.center();j.createCircle({cx:g.x,cy:g.y,r:h}).setFill(c);if(f!=null){for(var d=0;d<this.anchors.length;++d){this.anchors[d].drawCur(j,h*0.75,c)}}},draw:function(n,g,h,d){var l=this.text;if(l==null){return}var j=this._rect;var f=d*(this.fontsize>0?this.fontsize:1);var c=this.color==null||this.color.length==0?"black":this.color;var q=JSDraw2.Drawer.drawText(n,new JSDraw2.Point(j.left,j.top),l,c,f,null,this.italic);j.width=q==null?0:q.getTextWidth();j.height=f+4},drawSelect:function(c){c.draw(this,this._rect.fourPoints())}});JSDraw2.Text.cast=function(c){return c!=null&&c.T=="TEXT"?c:null};scil.apply(JSDraw2.Mol.prototype,{getSmiles:function(){var d=this.parseRxn();if(d!=null&&d.arrow!=null){var f="";for(var c=0;c<d.reactants.length;++c){f+=(c>0?".":"")+d.reactants[c]._getSmiles()}f+=">>";for(var c=0;c<d.products.length;++c){f+=(c>0?".":"")+d.products[c]._getSmiles()}return f}return this._getSmiles()},_getSmiles:function(){var d=this.expandSuperAtoms();var g=null;d._setAromaticFlag();var h=d._getTrees();for(var c=0;c<h.length;++c){var f=h[c].renderSmiles();if(c==0){g=f}else{g+="."+f}}return g==null?null:g.replace(/\]\]\[\[/g,"")},getRgfile:function(n,l,t){var q="$MDL  REV  1 "+this._getMolTime()+"\n";q+="$MOL\n$HDR\n\n";q+=this._getMolHeader();q+="\n$END HDR\n";q+="$CTAB\n";q+=this._getMolV2000(n,null,t);q+="$END CTAB\n";for(var c=0;c<l.list.length;++c){var h=l.list[c];var g=h.rgroup;q+="$RGP\n"+scil.Utils.padLeft(h.iR+"",4)+"\n";for(var d=0;d<g.mols.length;++d){var f=g.mols[d];if(f.isEmpty()){continue}t=[];f=f.expandSuperAtoms(t,true);q+="$CTAB\n";q+=f._getMolV2000(n,l,t);q+="$END CTAB\n"}q+="$END RGP\n"}q+="$END MOL\n";return q},guessSuperAtoms:function(){var h=0;for(var f=0;f<this.atoms.length;++f){var c=this.atoms[f];if(c.superatom==null){if(c.bio!=null&&c.superatom==null){c.superatom=null;switch(c.biotype()){case JSDraw2.BIO.BASE_DNA:c.superatom=JSDraw2.SuperAtoms.getDNA(c.elem);break;case JSDraw2.BIO.BASE_RNA:c.superatom=JSDraw2.SuperAtoms.getRNA(c.elem);break;case JSDraw2.BIO.AA:c.superatom=JSDraw2.SuperAtoms.getAA(c.elem);break}}else{if(c.alias!=null&&c.alias!=""&&c.rgroup==null){var d=JSDraw2.PT[c.alias];if(d!=null&&d.a>0){c.elem=c.alias;c.alias=null}else{var g=JSDraw2.SuperAtoms.get(c.alias);if(g!=null){c.superatom=g.clone();++h}}}}}else{JSDraw2.SuperAtoms.normalize(c.superatom);h+=c.superatom.guessSuperAtoms()}}return h},setMolV3000:function(j,t,n,l,f){var d={na:null,nb:null};var c={};var q=[];var g;for(g=t;g<j.length;++g){if(j[g].length<6){continue}var h=j[g];if(scil.Utils.startswith(h,"M  END")||scil.Utils.startswith(h,"M  CTAB")){break}if(!scil.Utils.startswith(h,"M  V30")){continue}h=j[g].substr(7);if(h=="END CTAB"){++g;break}if(f!=null&&scil.Utils.startswith(h,f)){break}if(scil.Utils.startswith(h,"BEGIN CTAB")){g=this.readV30Counts(j,g+1,d)}else{if(d.na>0&&scil.Utils.startswith(h,"BEGIN ATOM")){g=this.readV30Atoms(j,g+1,c,n)}else{if(d.nb>0&&scil.Utils.startswith(h,"BEGIN BOND")){g=this.readV30Bonds(j,g+1,c,n)}else{if(d.na>0&&scil.Utils.startswith(h,"BEGIN COLLECTION")){g=this.readV30Collections(j,g+1,c)}else{if(d.na>0&&scil.Utils.startswith(h,"BEGIN SGROUP")){g=this.readV30Sgroup(j,g+1,c,q)}}}}}}if(l!=null){l.i=g}this.readSgroups(q);return this},readV30Sgroup:function(g,d,c,j){var h="";do{if(g[d].length<=7){continue}var f=g[d].substr(7);if(scil.Utils.startswith(f,"END SGROUP")){break}if(scil.Utils.endswith(f,"-")){h+=f.substr(0,f.length-1);continue}h+=f;this.parseOneSgroup(h,c,j);h=""}while(++d<g.length);if(h!=""){this.parseOneSgroup(h,c,j)}return d},parseOneSgroup:function(u,d,x){var t=u.indexOf(" ");var j=u.substr(0,t);u=u.substr(t+1);t=u.indexOf(" ");var y=u.substr(0,t);u=u.substr(t+1);if(y=="SUP"){var f=this._findToken(u,"ATOMS");var n=this._findToken(u,"LABEL");var z=this._findToken(u,"XBONDS");var g=this._findToken(u,"CSTATE");if(f==null||n==null||z==null||g==null){return}var w=x[parseInt(j)]={type:"SUPERATOM",atoms:[],subscript:n};var q=f.split(" ");for(var h=1;h<q.length;++h){var l=parseInt(q[h]);var c=d[l];if(c!=null){w.atoms.push(c)}}}},_findToken:function(f,g){var c=" "+g+"=";var d=f.indexOf(c);if(d<0){return null}d+=c.length;f=f.substr(d);if(f.substr(0,1)=="("){d=f.indexOf(")");return f.substr(1,d-1)}else{d=f.indexOf(" ");return f.substr(0,d)}},readV30Collections:function(q,g,f){var l=this.medBondLength();do{if(q[g].length<=7){continue}var n=q[g].substr(7);if(scil.Utils.startswith(n,"END COLLECTION")||!scil.Utils.startswith(n,"MDLV30/STE")){break}n=n.substr(10);var x=null;switch(n.substr(0,3)){case"ABS":x="abs";break;case"RAC":x="&"+n.substr(3,1);break;case"REL":x="or"+n.substr(3,1);break}if(x==null){continue}var t=/ATOMS=\([0-9 ]+\)/.exec(n);if(t==null){continue}var u=t[0];var w=u.substr(7,u.length-8).split(" ");for(var h=1;h<w.length;++h){var d=parseInt(w[h]);var c=f[d];if(c!=null){this.markChirality(c,x,l)}}}while(++g<q.length);return g},readV30Bonds:function(t,l,f,w){do{if(t[l].length<=7){continue}var q=t[l].substr(7);if(scil.Utils.startswith(q,"END BOND")){break}var x=q.split(" ");var n=parseInt(x[0]);var u=parseInt(x[1]);var c=parseInt(x[2]);var d=parseInt(x[3]);var g=this.parseV30Attributes(x,4);var y=g.CFG==null?null:parseInt(g.CFG);var j=JSDraw2.BONDTYPES.UNKNOWN;switch(u){case 0:j=JSDraw2.BONDTYPES.UNKNOWN;break;case 1:switch(y){case 1:j=JSDraw2.BONDTYPES.WEDGE;break;case 2:j=JSDraw2.BONDTYPES.WIGGLY;break;case 3:j=JSDraw2.BONDTYPES.HASH;break;default:j=JSDraw2.BONDTYPES.SINGLE;break}break;case 2:j=y==2?JSDraw2.BONDTYPES.EITHER:JSDraw2.BONDTYPES.DOUBLE;break;case 3:j=JSDraw2.BONDTYPES.TRIPLE;break;case 4:j=JSDraw2.BONDTYPES.DELOCALIZED;break;case 5:j=JSDraw2.BONDTYPES.SINGLEORDOUBLE;break;case 6:j=JSDraw2.BONDTYPES.SINGLEORAROMATIC;break;case 7:j=JSDraw2.BONDTYPES.DOUBLEORAROMATIC;break;case 8:j=JSDraw2.BONDTYPES.UNKNOWN;break;case 9:j=JSDraw2.BONDTYPES.DUMMY;break}if(f[c]!=null&&f[d]!=null){var h=new JSDraw2.Bond(f[c],f[d],j);this._addBond(h);if(w){this.readRxnCenter(h,g.RXCTR)}switch(g.TOPO){case"1":h.ring=true;break;case"2":h.ring=false;break}}}while(++l<t.length);return l},markChirality:function(d,g,f){if(d==null){return false}if(scil.Utils.startswith(g,"and")){g="&"+g.substr(3)}if(g=="R"||g=="S"){g="("+g+")"}else{if(!JSDraw2.Atom.isValidChiral(g)){g=null}}var q=null;for(var h=0;h<this.graphics.length;++h){var n=JSDraw2.Text.cast(this.graphics[h]);if(this.getChiralAtom(n)==d){q=n;break}}if(q!=null){if(g==null){this.delGraphics(q);return true}else{if(q.text!=g){q.text=g;return true}}}else{if(g!=null){var j=this.findBestPostion(d,f);var l=new JSDraw2.Rect(j.x,j.y,1,1);q=new JSDraw2.Text(l,g);q.fieldtype="CHIRAL";q.fontsize=0.75;q.anchors=[d];this.addGraphics(q);return true}}return false},hasEnhancedStereochemistry:function(){for(var d=0;d<this.graphics.length;++d){var f=JSDraw2.Text.cast(this.graphics[d]);if(f==null||f.text=="(R)"||f.text=="(S)"){continue}var c=this.getChiralAtom(f);if(c!=null){return true}}return false},getEnhancedStereochemistry:function(d){var h=false;var g={};if(d==null){d={}}for(var j=0;j<this.graphics.length;++j){var u=JSDraw2.Text.cast(this.graphics[j]);var c=this.getChiralAtom(u);if(c!=null){if(g[u.text]==null){g[u.text]=c.id+""}else{g[u.text]+=" "+c.id}h=true;d[c.id]=u.text}}if(JSDraw2.defaultoptions.enhanced_default2abs){var l=this.allChiralCenters();for(var j=0;j<l.length;++j){var c=l[j];if(d[c.id]!=null){continue}if(g.abs==null){g.abs=c.id+""}else{g.abs+=" "+c.id}h=true;d[c.id]="abs"}}var n="";if(h){n+="M  V30 BEGIN COLLECTION\n";for(var q in g){var f=g[q];f=f.split(" ").length+" "+f;switch(q.substr(0,1)){case"&":n+="M  V30 MDLV30/STERAC"+q.substr(1)+" ATOMS=("+f+")\n";break;case"o":n+="M  V30 MDLV30/STEREL"+q.substr(2)+" ATOMS=("+f+")\n";break;case"a":n+="M  V30 MDLV30/STEABS ATOMS=("+f+")\n";break}}n+="M  V30 END COLLECTION\n"}return n},allChiralCenters:function(){var g=[];for(var f=0;f<this.bonds.length;++f){var d=this.bonds[f];if(d.type==JSDraw2.BONDTYPES.WEDGE||d.type==JSDraw2.BONDTYPES.HASH){var c=d.a1;if(scil.Utils.indexOf(g,c)<0){g.push(c)}}}return g},readV30Atoms:function(t,l,g,u){do{if(t[l].length<=7){continue}var q=t[l].substr(7);if(scil.Utils.startswith(q,"END ATOM")){break}var w=q.split(" ");var n=parseInt(w[0]);var j=w[1];var z=parseFloat(w[2]);var A=-parseFloat(w[3]);var f=w.length>5?parseInt(w[5]):null;var h=this.parseV30Attributes(w,6);var d=null;if(j!=null){if(/^R[0-9]+$/.test(j)){d=j;j="R"}else{if(j=="R#"){j="R"}}}var c=new JSDraw2.Atom(new JSDraw2.Point(z,A),j);c.alias=d;if(h.CHG!=null){c.charge=parseInt(h.CHG)}if(h.MASS!=null){c.isotope=parseInt(h.MASS);if(!(c.isotope>0)){c.isotope=null}}if(f>0&&u){c.atommapid=f}this._addAtom(c);g[n]=c}while(++l<t.length);return l},readV30Counts:function(g,d,c){var j="M  V30 COUNTS ";do{if(scil.Utils.startswith(g[d],j)){var f=g[d].substr(j.length);var h=f.split(" ");if(h.length>0){c.na=parseInt(h[0])}if(h.length>1){c.nb=parseInt(h[1])}if(h.length>4){this.chiral=parseInt(h[1])}break}}while(++d<g.length);return d},parseV30Attributes:function(g,h){var f={};for(var c=h;c<g.length;++c){var d=g[c].indexOf("=");if(d>0){f[g[c].substr(0,d)]=g[c].substr(d+1)}}return f},getDataGroup:function(c,g,l,n,f,j){if(c==null||c==""){return""}if(g==null||g==""){g="UNKNOWN"}var d=++j.id.k;j.sty+=" "+scil.Utils.formatStr(d,3,0)+" DAT";if(f!=null){j.spl+=" "+scil.Utils.formatStr(d,3,0)+" "+scil.Utils.formatStr(f,3,0)}var h="";h+="M  SDT "+scil.Utils.formatStr(d,3,0)+" "+scil.Utils.padright(g,30," ")+" F\n";h+="M  SDD "+scil.Utils.formatStr(d,3,0)+" "+scil.Utils.formatStr(l,10,4)+scil.Utils.formatStr(n,10,4)+"    DA    ALL  1       5\n";h+="M  SED "+scil.Utils.formatStr(d,3,0)+" "+c+"\n";j.data+=h},setRgfile:function(z){this.clear();if(z==null||z.length==0){return null}var q=z.split("\n");if(!scil.Utils.startswith(q[0],"$MDL")){return null}var u=null;var x={};var g=null;for(var j=0;j<q.length;++j){if(scil.Utils.startswith(q[j],"$CTAB")){if(u==null){u=this.setMolV2000(q,j+1,false,x)}else{if(g!=null){var t=new JSDraw2.Mol();t.showimplicithydrogens=this.showimplicithydrogens;if(t.setMolV2000(q,j+1,false,x)){g.mols.push(t)}}}}else{if(scil.Utils.startswith(q[j],"$RGP")){++j;var l=parseInt(q[j]);var c=x[l];if(c!=null){c.rgroup=new JSDraw2.RGroup(null,null,l);g=c.rgroup}}else{if(scil.Utils.startswith(q[j],"$END RGP")){g=null}}}}var d=this.medBondLength();var f=this.rect(true).bottomleft();for(var n in x){var c=x[n];var w=c.rgroup;c.updateRGroup();if(w==null){continue}w._rect=new JSDraw2.Rect(f.x,f.y+2*d,0,0);var y=w.relayout(d);var h=f.y+2*d-y.top;w.offsetAll(0,h);f.y=y.bottomleft().y+h}return u},setRxnfile:function(d){this.clear();if(d==null||d.length==0){return null}var c=d.split("\n");if(!scil.Utils.startswith(c[0],"$RXN")){return null}if(c[0].indexOf("V3000")>0){return this.setRxnV3000(c)}else{return this.setRxnV2000(c)}},setRxnV3000:function(g){var c={na:null,nb:null};var l=[];var j=[];this.readV30Counts(g,4,c);for(var d=5;d<g.length;++d){if(g[d].length<6){continue}var h=g[d].substr(0,6);if(h=="M  END"){break}if(h!="M  V30"){continue}var f=g[d].substr(7);if(scil.Utils.startswith(f,"BEGIN REACTANT")){d=this.readCtabs(g,d+1,c.na,l,"END REACTANT")}else{if(scil.Utils.startswith(f,"BEGIN PRODUCT")){d=this.readCtabs(g,d+1,c.nb,j,"END PRODUCT")}}}this.setRxn({reactants:l,products:j},1.56);return this},setRxnV2000:function(f){var l=parseFloat(f[4].substr(0,3));var j=parseFloat(f[4].substr(3,3));var q=[];var n=[];var d=0;var h=null;for(var c=5;c<f.length;++c){if(scil.Utils.trim(f[c])=="$MOL"){if(h!=null){var g=new JSDraw2.Mol();if(g.setMolfile(h,true)==null){return null}h=null;if(++d<=l){q.push(g)}else{n.push(g)}}}else{if(h==null){h=f[c]+"\n"}else{h+=f[c]+"\n"}}}if(h!=null){var g=new JSDraw2.Mol();if(g.setMolfile(h,true)==null){return null}h=null;if(++d<=l){q.push(g)}else{n.push(g)}}this.setRxn({reactants:q,products:n},1.56);return this},setRxn:function(l,c,j){this.clear();for(var f=0;f<l.reactants.length;++f){var h=l.reactants[f];var d=null;if(l.reactants[f].chiral){d=new JSDraw2.Group("[Chiral]","chiral");this.addGraphics(d)}this.mergeMol(h,null,d);if(j!=false){h.setBondLength(c)}}for(var f=0;f<l.products.length;++f){var h=l.products[f];var d=null;if(h.chiral){d=new JSDraw2.Group("[Chiral]","chiral");this.addGraphics(d)}this.mergeMol(h,null,d);if(j!=false){h.setBondLength(c)}}if(l.arrow==null){l.arrow=new JSDraw2.Arrow(new JSDraw2.Point(0,0),new JSDraw2.Point(c*3,0));if(l.reversible){l.arrow.arrowstyle="reversible"}}this._addGraphics(l.arrow);if(l.above!=null){for(var f=0;f<l.above.length;++f){this._addGraphics(l.above[f])}}if(l.below!=null){for(var f=0;f<l.below.length;++f){this._addGraphics(l.below[f])}}this._layoutRxn(l,c)},_addRxnLabel:function(d,c){if(scil.Utils.isNullOrEmpty(d.label)){return false}var f=d.rect();f=new JSDraw2.Rect(f.center().x-d.label.length*c/5,f.bottom()+c,0,0);var g=new JSDraw2.Text(f,d.label);g.anchors=d.atoms;g.fieldtype="RXNLABEL";this.addGraphics(g);return true},removeTextByFieldType:function(d){for(var c=this.graphics.length-1;c>=0;--c){if(this.graphics[c].fieldtype==d){this.graphics.splice(c,1)}}},getRxnV2000:function(f){var c=new Date();var h=c.getFullYear()+"";var g="$RXN\n\n";g+="      JSDraw2  "+scil.Utils.formatStr(c.getMonth()+1,2,0).replace(" ","0")+scil.Utils.formatStr(c.getDate(),2,0).replace(" ","0")+h.substr(2)+scil.Utils.formatStr(c.getHours(),2,0).replace(" ","0")+scil.Utils.formatStr(c.getMinutes(),2,0).replace(" ","0")+"\n";g+="\n";g+=scil.Utils.formatStr(f.reactants.length,3,0)+scil.Utils.formatStr(f.products.length,3,0)+"\n";for(var d=0;d<f.reactants.length;++d){g+="$MOL\n";g+=f.reactants[d].getMolfile(true)}for(var d=0;d<f.products.length;++d){g+="$MOL\n";g+=f.products[d].getMolfile(true)}return g},getRxnV3000:function(g,d){var h="$RXN V3000\n\n";var c=new Date();var j=c.getFullYear()+"";h+="      JSDraw2  "+scil.Utils.formatStr(c.getMonth()+1,2,0).replace(" ","0")+scil.Utils.formatStr(c.getDate(),2,0).replace(" ","0")+j.substr(2)+scil.Utils.formatStr(c.getHours(),2,0).replace(" ","0")+scil.Utils.formatStr(c.getMinutes(),2,0).replace(" ","0")+"\n";h+="\n";h+="M  V30 COUNTS "+g.reactants.length+" "+g.products.length+"\n";h+="M  V30 BEGIN REACTANT\n";for(var f=0;f<g.reactants.length;++f){h+=g.reactants[f].getMolV3000(true)}h+="M  V30 END REACTANT\n";h+="M  V30 BEGIN PRODUCT\n";for(var f=0;f<g.products.length;++f){h+=g.products[f].getMolV3000(true)}h+="M  V30 END PRODUCT\n";h+="M  END\n";return h},_getMolV3000:function(w){var q=this.bondlength>0?this.bondlength:this.medBondLength();var y=q>0?(1.56/q):1;this.resetIds();var h=new Date();var A=h.getFullYear()+"";var x="";if(!w){x+=(scil.Utils.isNullOrEmpty(this.name)==null?"-":this.name)+"\n";x+="   JSDraw "+scil.Utils.formatStr(h.getMonth()+1,2,0).replace(" ","0")+scil.Utils.formatStr(h.getDate(),2,0).replace(" ","0")+A.substr(2)+scil.Utils.formatStr(h.getHours(),2,0).replace(" ","0")+scil.Utils.formatStr(h.getMinutes(),2,0).replace(" ","0")+"2D\n";x+="\n";x+="  0  0        0               999 V3000\n"}var g={};var l=this.getEnhancedStereochemistry(g);var f=this.hasStereoCenter()||!scil.Utils.isNullOrEmpty(l);x+="M  V30 BEGIN CTAB\n";x+="M  V30 COUNTS "+this.atoms.length+" "+this.bonds.length+" 0 0 "+(f?1:0)+"\n";x+="M  V30 BEGIN ATOM\n";for(var n=0;n<this.atoms.length;++n){var c=this.atoms[n];var j=c.elem;if(j=="R"){if(c.iR>0){j="R#"}else{if(!scil.Utils.isNullOrEmpty(c.alias)){j=c.alias}else{j="R"}}}else{if(j=="H"){if(c.isotope==2){j="D"}else{if(c.isotope==3){element="T"}}}}x+="M  V30 "+c.id+" "+j;x+=" "+scil.Utils.formatStr(c.p.x*y,0,4);x+=" "+scil.Utils.formatStr(-c.p.y*y,0,4);x+=" 0 "+(w&&c.atommapid>0?c.atommapid:0);if(c.charge!=null&&c.charge!=0){x+=" CHG="+c.charge}if(c.radical>=1&&c.radical<=3){x+=" RAD="+c.radical}if(c.isotope>0){x+=" MASS="+c.isotope}if(g[c.id]!=null){var u=this.getParity(c);if(u!=null){x+=" CFG="+u}}x+="\n"}x+="M  V30 END ATOM\n";x+="M  V30 BEGIN BOND\n";for(var n=0;n<this.bonds.length;++n){var d=this.bonds[n];var t=0;var z=0;switch(d.type){case JSDraw2.BONDTYPES.UNKNOWN:t=8;break;case JSDraw2.BONDTYPES.DUMMY:t=9;break;case JSDraw2.BONDTYPES.DOUBLEORAROMATIC:t=7;break;case JSDraw2.BONDTYPES.SINGLEORAROMATIC:t=6;break;case JSDraw2.BONDTYPES.SINGLEORDOUBLE:t=5;break;case JSDraw2.BONDTYPES.SINGLE:case JSDraw2.BONDTYPES.DOUBLE:case JSDraw2.BONDTYPES.TRIPLE:case JSDraw2.BONDTYPES.DELOCALIZED:t=d.type;z=0;break;case JSDraw2.BONDTYPES.WEDGE:t=1;z=1;break;case JSDraw2.BONDTYPES.HASH:t=1;z=3;break;case JSDraw2.BONDTYPES.WIGGLY:t=1;z=2;break;case JSDraw2.BONDTYPES.EITHER:t=2;z=2;break}x+="M  V30 "+(n+1)+" "+t+" "+d.a1.id+" "+d.a2.id;if(z>0){x+=" CFG="+z}if(d.ring!=null){x+=" TOPO="+(d.ring?1:2)}if(w&&d.rcenter>0){x+=" RXCTR="+d.rcenter}x+="\n"}x+="M  V30 END BOND\n";x+=l;x+="M  V30 END CTAB\n";x+="M  END\n";return x},getParity:function(c){var g=this.getNeighborBonds(c);var h=null;var l=[];for(var f=0;f<g.length;++f){var d=g[f];var j=d.otherAtom(c);if(h==null||h.atomid<j.atomid){h=j}l.push({oa:j,b:d,angle:j.p.angleTo(c.p)})}if(l.length==4){for(var f=0;f<l.length;++f){if(l[f].oa==h){l.splice(f,1);break}}}if(l.length!=3){return null}l.sort(function(t,u){return t.angle==u.angle?0:(t.angle<u.angle?-1:1)});var q=false;if(l[0].oa.atomid<l[1].oa.atomid){q=!(l[2].oa.atomid>l[1].oa.atomid||l[2].oa.atomid<l[0].oa.atomid)}else{if(l[0].oa.atomid>l[1].oa.atomid){q=l[2].oa.atomid<l[1].oa.atomid||l[2].oa.atomid>l[0].oa.atomid}}var n=JSDraw2.BA.getStereoPattern(l,"b",c,q);if(n=="@"){return 2}else{if(n=="@@"){return 1}}return null},_getXml:function(x,d,w,u,j,g){if(this.isEmpty()){return null}if(j==null){j=this.bondlength>0?this.bondlength:this.medBondLength()}var q=j>0?(1.56/j):1;var l=this.rect();this.resetIds(true);var t="";if(x>0){t+="width:"+x+"px;"}if(d>0){t+="height:"+d+"px;"}var n;if(g){n="<div>\n"}else{var c=j*q;n="<div version='"+JSDraw2.kFileVersion+"'"+(scil.Utils.isNullOrEmpty(this.chiral)?"":" chiral='"+scil.Utils.escXmlValue(this.chiral)+"'")+" class='JSDraw' app='"+JSDraw2.version+"'"+(this.name==null||this.name==""?"":" molname='"+scil.Utils.escXmlValue(this.name)+"'")+(t!=""?" style='"+t+"'":"")+(c>0?" bondlength='"+scil.Utils.round(c,6)+"'":"")+(w?" viewonly":"")+">\n"}if(this.props!=null){n+="<att";for(var h in this.props){n+=" "+h+"='"+scil.Utils.escXmlValue(this.props[h])+"'"}n+=" />"}for(var f=0;f<this.atoms.length;++f){n+=this.atoms[f].html(q,j)+"\n"}for(var f=0;f<this.bonds.length;++f){n+=this.bonds[f].html(q)+"\n"}for(var f=0;f<this.graphics.length;++f){n+=this.graphics[f].html(q)+"\n"}if(u!=null){n+=u}n+="</div>\n";return n},setJdx:function(d,c){if(!(c>0)){c=30}var f=new JSDraw2.Spectrum(new JSDraw2.Rect(0,0,c,c/3));f.setSpectrumData2(null,d);this.addGraphics(f);return this},setXml:function(ah){var X=null;if(typeof ah=="object"){X=ah}else{if(typeof ah=="string"){var E=scil.Utils.parseXml(ah);if(E==null){return this.setMolfile(ah)}else{X=E.documentElement||E.firstElementChild}}}if(X==null){return null}this.chiral=X.getAttribute("chiral");if(scil.Utils.indexOf(JSDraw2.molchirals,this.chiral)<0){this.chiral=null}this.name=X.getAttribute("molname");var y=scil.Utils.getElements(X,"a",true);var D=scil.Utils.getElements(X,"b",true);var J=scil.Utils.getElements(X,"i",true);this.bondlength=parseFloat(X.getAttribute("bondlength"));var af=X.getAttribute("version");var G=af==null||af==""?NaN:parseFloat(af);var U=scil.Utils.getElements(X,"att");for(var L=0;L<U.length;++L){var z=U[L];for(var P=0;P<z.attributes.length;++P){var q=z.attributes[P];if(this.props==null){this.props={}}this.props[q.name]=q.value}}var K={};var R=[];var ab=[];for(var L=0;L<y.length;++L){var c=y[L];var M=parseInt(c.getAttribute("i"));var F=c.getAttribute("e");var aa=c.getAttribute("sa");if(aa!=null&&aa!=""){ab[M]=true;continue}var B=null;var ac=c.getAttribute("bio");if(ac==JSDraw2.BIO.AA){B=JSDraw2.BIO.AA}else{if(ac=="BASE"||ac==JSDraw2.BIO.BASE_DNA){B=JSDraw2.BIO.BASE_DNA}else{if(ac==JSDraw2.BIO.BASE_RNA){B=JSDraw2.BIO.BASE_RNA}else{if(ac==JSDraw2.BIO.ANTIBODY||ac==JSDraw2.BIO.PROTEIN||ac==JSDraw2.BIO.GENE||ac==JSDraw2.BIO.DNA||ac==JSDraw2.BIO.RNA||ac==scil.helm.HELM.BASE||ac==scil.helm.HELM.LINKER||ac==scil.helm.HELM.SUGAR||ac==scil.helm.HELM.AA||ac==scil.helm.HELM.CHEM){B=ac}}}}var T=JSDraw2.Point.fromString(c.getAttribute("p"));if(T==null){return null}var q=new JSDraw2.Atom(T,F,B==null?null:{type:B});q.readHtml(c);q.locked=scil.Utils.isTrue(c.getAttribute("locked"));q.id=M;var H=c.getAttribute("g");if(H!=null){if(K[H]==null){K[H]=[]}K[H].push(q)}this._addAtom(q);R[M]=q}for(var L=0;L<D.length;++L){var A=D[L];var d=parseInt(A.getAttribute("a1"));var f=parseInt(A.getAttribute("a2"));if(ab[d]||ab[f]){continue}var ae=parseInt(A.getAttribute("t"));var W=A.getAttribute("ring");var V=A.getAttribute("rcenter");var u=R[d];var w=R[f];if(u==null||w==null||isNaN(ae)){return null}var C=new JSDraw2.Bond(u,w,ae,scil.Utils.isTrue(A.getAttribute("bio")));var h=A.getAttribute("apo1");if(h!=null&&h!=""&&!isNaN(h)){C.apo1=parseInt(h)}var l=A.getAttribute("apo2");if(l!=null&&l!=""&&!isNaN(l)){C.apo2=parseInt(l)}if(W!=null){C.ring=scil.Utils.isTrue(W)}if(V!=null){switch(parseInt(V)){case -1:C.rcenter=JSDraw2.RXNCENTER.NOTCENTER;break;case 1:C.rcenter=JSDraw2.RXNCENTER.CENTER;break;case 12:case 13:C.rcenter=JSDraw2.RXNCENTER.BREAKANDCHANGE;break;case 4:case 5:C.rcenter=JSDraw2.RXNCENTER.BREAK;break;case 8:case 9:C.rcenter=JSDraw2.RXNCENTER.CHANGE;break}}var M=parseInt(A.getAttribute("i"));C.id=M;C.readHtml(A);this._addBond(C);R[M]=C}for(var L=0;L<J.length;++L){var H=J[L];var ag=H.getAttribute("x");var I=null;switch(ag){case"ARROW":I=new JSDraw2.Arrow();if(!I.readHtml(H,R)){I=null}break;case"CURVE":I=new JSDraw2.Curve();if(!I.readHtml(H,R)){I=null}break;case"SHAPE":I=new JSDraw2.Shape();if(!I.readHtml(H,R)){I=null}break;case"ASSAYCURVE":I=new JSDraw2.AssayCurve();if(!I.readHtml(H)){I=null}break;case"SPECTRUM":I=new JSDraw2.Spectrum();if(!I.readHtml(H)){I=null}break;case"TLC":I=new JSDraw2.TLC();if(!I.readHtml(H,R,G)){I=null}break;case"PLUS":var T=JSDraw2.Point.fromString(H.getAttribute("p"));if(T==null){return null}I=new JSDraw2.Plus(T);break;case"TEXT":I=new JSDraw2.Text();if(!I.readHtml(H,R)){I=null}break;case"GROUP":var M=H.getAttribute("i");var Q=K[M];if(Q!=null){var S=H.getAttribute("n");var ae=H.getAttribute("t");I=new JSDraw2.Group(S,ae);I.readHtml(H);for(var O=0;O<Q.length;++O){Q[O].group=I}}break;case"BRACKET":I=new JSDraw2.Bracket(H.getAttribute("t"),JSDraw2.Rect.fromString(H.getAttribute("r")),H.getAttribute("shape"));var Z=H.getAttribute("atoms");if(Z!=null){var y=[];var ad=Z.split(",");for(var O=0;O<ad.length;++O){var c=R[parseInt(ad[O])];if(c!=null&&JSDraw2.Atom.cast(c)!=null){y.push(c)}}I.atoms=y}break}if(I!=null){I.color=H.getAttribute("clr");var M=parseInt(H.getAttribute("i"));I.id=M;this._addGraphics(I);R[M]=I}}for(var L=0;L<this.graphics.length;++L){var H=this.graphics[L];if(JSDraw2.Shape.cast(H)==null){continue}if(H.fromindices!=null){var ad=H.fromindices.split(",");for(var P=0;P<ad.length;++P){var N=parseInt(ad[P]);if(!(N>0)){continue}var Y=JSDraw2.Shape.cast(R[N]);if(Y!=null&&scil.Utils.indexOf(H.froms,Y)<0){H.froms.push(Y)}}}if(H.rejectindex!=null&&!isNaN(H.rejectindex)){H.reject=JSDraw2.Shape.cast(R[H.rejectindex])}}this.guessSuperAtoms();return this},_connectFragsByPlus:function(j,f){var l=this.graphics;var w=[];for(var n=0;n<l.length;++n){var c=JSDraw2.Plus.cast(l[n]);if(c!=null){w.push(c)}}for(var n=0;n<w.length;++n){var u=w[n];var h=[];for(var q=0;q<j.length;++q){var g=j[q].bounds.distance2Point(u.p);if(g<4*f){var x={d:g,k:q};if(h.length<2){h.push(x)}else{if(g<h[0].d){h.splice(0,1)}else{if(g<h[1].d){h.splice(1,1)}}if(h.length<2){h.push(x)}}}}if(h.length==2){j[h[0].k].mergeMol(j[h[1].k]);j[h[0].k].bounds.union(j[h[1].k].bounds);j.splice(h[1].k,1)}}return j},_connectNextLine:function(q,z,f,g,h){var l=null;for(var u=0;u<this.graphics.length;++u){var c=JSDraw2.Arrow.cast(this.graphics[u]);if(c!=null&&c.isLeftToRight()){if(f){if(c.p1.y<z.top){if(l==null){l={dy:z.top-c.p1.y,a:c}}else{if(z.top-c.p1.y<l.dy){l={dy:z.top-c.p1.y,a:c}}}}}else{if(c.p1.y>z.bottom()){if(l==null){l={dy:c.p1.y-z.bottom(),a:c}}else{if(c.p1.y-z.bottom()<l.dy){l={dy:c.p1.y-z.bottom(),a:c}}}}}}}if(l!=null){var A=null;var c=l.a;for(var u=0;u<q.length;++u){var x=q[u].bounds;var B=x.cross(c.p1,c.p2);if(B==2||B==-2||B==1||B==-1){if(f){if(A==null){A={right:x.right(),frag:q[u]}}else{if(A.right<x.right()){A={right:x.right(),frag:q[u]}}}}else{if(A==null){A={left:x.left,frag:q[u]}}else{if(A.left>x.left){A={left:x.left,frag:q[u]}}}}}}if(A!=null){return A.frag}}var j=q[0].bounds;for(var u=1;u<q.length;++u){j.union(q[u].bounds)}var A=null;if(f){var w=new JSDraw2.Point(j.right(),g.p1.y);var C=g.p1.y-h;for(var u=0;u<q.length;++u){var x=q[u].bounds;if(!z.contains(x)&&x.bottom()<C){var n=w.distTo(new JSDraw2.Point(x.right(),x.bottom()));if(A==null){A={d:n,frag:q[u]}}else{if(A.d>n){A={d:n,frag:q[u]}}}}}}else{var w=new JSDraw2.Point(j.left,g.p2.y);var C=g.p2.y+h;for(var u=0;u<q.length;++u){var x=q[u].bounds;if(!z.contains(x)&&x.top>C){var n=w.distTo(new JSDraw2.Point(x.left,x.top));if(A==null){A={d:n,frag:q[u]}}else{if(A.d>n){A={d:n,frag:q[u]}}}}}}return A!=null?A.frag:null},detectRxn:function(g){var j=this.medBondLength();var B=[];var y=[];var u=this.splitFragments();for(var w=0;w<u.length;++w){u[w].bounds=u[w].rect()}u=this._connectFragsByPlus(u,j);var C=new JSDraw2.Rect(Math.min(g.p1.x,g.p2.x),Math.min(g.p1.y,g.p2.y),Math.abs(g.p1.x-g.p2.x),Math.abs(g.p1.y-g.p2.y));for(var w=0;w<u.length;++w){var A=u[w].bounds;var D=A.cross(g.p1,g.p2);if(D==2||D==-2){(D==2?y:B).push(u[w])}else{if(D==1||D==-1){var n=A.distance2Point(D==1?g.p2:g.p1);if(n<=4*j){(D==1?y:B).push(u[w])}}}if(D==2||D==-2||D==1||D==-1){C.union(u[w].bounds)}}if(B.length==0&&g.isLeftToRight()){var q=this._connectNextLine(u,C,true,g,j);if(q!=null){B.push(q)}}if(y.length==0&&g.isLeftToRight()){var q=this._connectNextLine(u,C,false,g,j);if(q!=null){y.push(q)}}var E=[];for(var w=0;w<this.graphics.length;++w){var D=JSDraw2.Text.cast(this.graphics[w]);if(D!=null){E.push(D)}}var c=[];var h=[];var l=new JSDraw2.Point((g.p1.x+g.p2.x)/2,(g.p1.y+g.p2.y)/2);for(var w=0;w<E.length;++w){var D=E[w];if(D==null){continue}var A=D.rect();var n=l.distTo(A.center());if(n>=2*j){n=l.distTo(new JSDraw2.Point(A.left,A.top));if(n>=2*j){n=l.distTo(new JSDraw2.Point(A.right(),A.bottom()))}}if(n<2*j){var f=g.p1.angleAsOrigin(g.p2,A.center());E[w]=null;var z=[];z.push(D);while(z.length>0){var F=z.pop();(f<180?h:c).push(F);this._findCloseTexts(F,E,j,z)}}}this._splitFrags(B);this._splitFrags(y);return{arrow:g,reactants:B,products:y,above:c,below:h}},parseRxn2:function(){var j=this.parseRxn();var h=[];var g=[];for(var c=0;c<j.reactants.length;++c){var f=j.reactants[c];for(var d=0;d<f.atoms.length;++d){h.push(f.atoms[d])}}for(var c=0;c<j.products.length;++c){var f=j.products[c];for(var d=0;d<f.atoms.length;++d){g.push(f.atoms[d])}}return{reactants:h,products:g}},isRxn:function(){var d=0;for(var c=0;c<this.graphics.length;++c){if(this.graphics[c].T=="ARROW"){if(d==0){++d}else{return false}}}return d==1&&this.atoms.length>0},_parseRxn:function(){var g=[];for(var q=0;q<this.graphics.length;++q){if(this.graphics[q].T=="ARROW"){g.push(this.graphics[q])}}if(g.length>1){return null}var n=this.splitFragments();if(n==null){return null}if(this.chiral!=null){for(var q=0;q<n.length;++q){n[q].chiral=this.chiral}}var I=[];var F=[];for(var q=0;q<n.length;++q){var H=n[q].rect().left;var z=I.length;for(var u=0;u<I.length;++u){if(H<I[u]){z=u;break}}I.splice(z,0,H);F.splice(z,0,n[q])}n=F;if(g.length==0){return{reactants:n,products:[],arrow:null,above:null,below:null}}var f=g[0];var D=g[0].rect();var H=D.center().x;var C=[];var A=[];for(var q=0;q<n.length;++q){var l=n[q];var B=l.rect();if(B.right()<H){C.push(l)}else{if(B.left>H){A.push(l)}}}var w=D.left;var E=D.right();var J=D.center().y;var d=[];var h=[];for(var q=0;q<this.graphics.length;++q){var G=JSDraw2.Text.cast(this.graphics[q]);if(G==null||G.anchors!=null&&G.anchors.length>0){continue}var j=G._rect.center();if(this._hasOverlap(w,E,G._rect)){if(j.y>J){h.push(G)}else{d.push(G)}}}return{reactants:C,products:A,arrow:f,above:this._sortTextByTop(d),below:this._sortTextByTop(h)}}});JSDraw2.Language={current:null,use:function(c){if(c==null){return}c=c.toLowerCase();if(c=="zh"){c="cn"}this.current=c=="en"?{}:this[c]},res:function(d){if(this.current==null){if(JSDraw2.defaultoptions!=null){this.use(JSDraw2.defaultoptions.lang)}if(this.current==null){var c=window.navigator.userLanguage;if(c!=null&&c.length>2){this.use(c.substr(0,2))}}if(this.current==null){this.current={}}}return this.current==null||this.current[d]==null||this.current[d]==""?d:this.current[d]},jp:{"Triple bond":"三重結合",Triple:"  三重結合","Wedge bond":"くさび型線",Up:"手前方向","Hash bond":"破線",Down:"奥方向","Wiggle bond":"波線",Wiggle:"波線","Delocalized bond":"非局在結合",Delocalized:"非局在化","Either double bond":"不特定二重結合",Either:"不特定","Dotted bond":"点線",Dotted:"点線","Single or Double":"単結合又は二重結合",Single:"単結合","Single or Aromatic":"単結合又は芳香族","Double or Aromatic":"二重結合又は芳香族",Export:"エクスポート",Import:"インポート","Paste ChemDraw, ISIS/Draw...":"ChemDraw, ISIS/Drawをペースト",Paste:"ペースト","Copy ChemDraw, ISIS/Draw, Word...":"ChemDraw, ISIS/Draw, Wordにコピー",Copy:"コピー","About JSDraw":" JSDrawについて",About:"About",New:"新規","Name to Structure":"名前構造変換",Convert:"変換",N2S:"名前構造変換","Clean up":"クリーンアップ",Clean:"整列","Lasso Selection":"投げ縄ツール",Lasso:"投げ縄","Select Fragment":"選択",Fragment:"選択","Select All":"全選択",All:"全部",Cut:"カット","Box Selection":"ボックス選択",Box:"ボックス選択",Eraser:"消しゴム",Undo:"取り消す",Redo:"やり直す","Single bond":"単結合","Double bond":"二重結合",Double:"二重結合","Chain Tool":"直鎖アルカンツール",Chain:"直鎖",Template:"テンプレート","Text/Atom Label":"テキスト/原子ラベル",Text:"テキスト","SGroup - Tag Atom/Bond/Bracket":"SGroup - Tag Atom/Bond/Bracket",SGroup:"SGroup",Bracket:"ブラケット","Increase charges":"電荷増加",Charge:"電荷","Descrease charges":"電荷減少","Move to center":"センターに移動",Center:"センター","Zoom in":"拡大",Zoom:"ズーム","Zoom out":"縮小",Rotate:"回転","Flip Horizontal":"水平に反転",Flip:"反転","Flip Vertical":"垂直に反転","Reaction arrow":"化学反応",Reaction:"化学反応","Reaction Plus":"化学反応プラス",Plus:"プラス","Clean up reaction":"クリーンアップ",Clean:"クリーンアップ","Copy reactants to products":"生成物に反応物をコピー","R->P":"","Map reaction":"マッピング",Map:"マッピング","Clear reaction map":"マッピングをクリア","Peptide Sequence":"ペプチド配列",Peptide:"ペプチド","DNA Sequence":"DNA配列","RNA Sequence":"RNA配列",Antibody:"抗体",Protein:"タンパク質",Gene:"遺伝子","Ink - Red":"赤ペン",Ink:"ペン","Ink - Blue":"青ペン","Ink - Green":"緑ペン","Clear Ink":"ペンを消去","Clear All Inks":"ペンを全て消去","Search PubChem":"PubChemデータベース検索","Search ChemSpider":"ChemSpiderデータベース検索","click to expand":"展開する","Element C":"炭素",Carbon:"炭素","Element H":"水素",Hydrogen:"水素","Element O":"酸素",Oxygen:"酸素","Element N":"窒素",Nitrogen:"窒素","Element S":"硫黄",Sulfur:"硫黄","Element P":"リン",Phosphorus:"リン","Element F":"フッ素",Fluorine:"フッ素","Element Cl":"塩素",Chlorine:"塩素","Element Br":"臭素",Bromine:"臭素","Element Periodic Table":"元素周期表","P.T.":"周期表","Copy ChemDraw etc.":"ChemDrawなどにコピー","Atom Properties":"原子属性","Atom Type":"原子タイプ","Enhanced Stereochemistry":"拡張立体化学","Atom Charges":"原子電荷",Isotope:"同位体",Radical:"ラジカル","Add Tag":"ラベル添加","R Group":"Ｒグループ","Create R Definition":"Ｒグループ定義を作成","Remove R Definition":"Ｒグループ定義を削除","Attach Point":"接続点",Query:"クエリー",Substituents:"置換基","Ring Bonds":"リング結合","Edit Atom List ...":"原子リストを編集",Unsaturated:"不飽和",Delete:"削除","Antibody Type":"抗体タイプ","Show Sequences":"配列表示",Expand:"展開","Bond Properties":"結合属性","Bond Type":"結合タイプ","Bond Topology":"結合位相","Reaction Center":"反応センター",Unspecified:"不特定","Not Center":"非反応センター","Break/Form":"断裂/形成",Change:"変化","Break/Form and Change":"断裂/形成/変化","Unknown Locant":"不明なロカント","Add Structure":"構造を追加","Bracket Type":"ブラケットタイプ","Bracket Sub-type":"ブラケットサブタイプ",Connectivity:"結合性","Mod Flags":"Mod標示","Set Ratio":"比率の設定","Set Data":"データ設定",Chiral:"キラル",Color:"カラー","Paste ChemDraw etc.":"ChemDraw構造などをペースト",Default:"デフォルト",Clear:"クリア",Search:"検索","* - Wildcard":"* - 任意の元素","A - Not Hydrogen":"A - 非水素","Q - Not H and C":"Q - 非水素と炭素","X - Halide":"X - ハロゲン","M - Metal":"M - 金属",Ring:"リング","Please type chemical name, CAS, SMILES etc.":"CAS No., SMILESなどの化合物名を入力してください","Query Features":"クエリー特性","Atom List":"原子リスト","# Substituents":"置換基","Unsaturated Bond":"不飽和結合","Atom Tag":"原子ラベル",Update:"アップデート","On Ring":"リングの上","On Chain":"チェーンの上","Export File":"ファイルをエクスポート","Import File":"ファイルをインポート","Please select a chemistry file":"化学関連ファイルを選んでください",Upload:"アップロード",Benzene:"ベンゼン",Hexane:"ヘキサン",Pentane:"ペンタン",Propane:"プロパン",Butane:"ブタン",Heptane:"ヘプタン",Octane:"オクタン","About ...":"JS Drawについて","Add Chain":"チェーン付加","Remove Chain":"チェーン削除","Add Annotation":"アノテーション付加","Remove Annotation":"アノテーション削除","Edit Annotation":"アノテーション編集","Show Properties":"属性表示","Edit Sequence":"配列の編集","Sequence Editor":"シーケンスエディタ","Add Peptide":"ポリペプチドの追加","Please type peptide sequence here":"ポリペプチドの配列を入力してください","Add DNA":"DNAの追加","Add RNA":"RNAの追加","Please type DNA sequence here":"DNAの配列を入力してください","Please type RNA sequence here":"DRNAの配列を入力してください","Set Signal Sequence":"シグナル配列のセット","Please select a chain":"チェーンを選択してください","Please type the signal sequence length":"シグナル配列の長さを入力してください",Properties:"属性",OK:"確定",Cancel:"キャンセル",Attention:"注意",Close:"閉じる","Atom Attributes":"原子属性",Templates:"テンプレート","Custom Templates":"カスタムテンプレート",Symbol:"特殊記号","Insert Symbol":"特殊記号を挿入",Curve:"矢印","Shape Type":"形状",Rectangle:"長方形",Square:"正方形",Ellipse:"長円",Circle:"円","Set Fill":"塗りつぶし",Solid:"単一色",Linear:"対角グラデーション","Linear-X":"水平グラデーション","Linear-Y":"垂直グラデーション","Bring to Front":"前面に移動","Set to Back":"背面に移動","Other Colors":"他のカラー","Choose Color":"カラーの選択",None:"なし"},kr:{},fr:{},es:{},de:{"Triple bond":"Dreifachbindung",Triple:"dreifach","Wedge bond":"Wedge Bindung",Up:"nach oben","Hash bond":"Hash Bindung",Down:"nach unten","Wiggle bond":"R/S Doppelbindung",Wiggle:"R/S","Delocalized bond":"aromatisch Bindung",Delocalized:"aromatisch","Either double bond":"E/Z Doppelbindung",Either:"entweder","Dotted bond":"gepunktete Bindung",Dotted:"gepunktet","Single or Double":"einfach oder doppelt",Single:"einfach","Single or Aromatic":"einfach oder aromatisch","Double or Aromatic":"doppelt oder aromatisch",Export:"Exportieren",Import:"Importieren","Paste ChemDraw, ISIS/Draw...":"Einfüge ChemDraw, ISIS/Draw...",Paste:"Einfügen","Copy ChemDraw, ISIS/Draw, Word...":"Kopiere ChemDraw, ISIS/Draw...",Copy:"Kopieren","About JSDraw":"Hilfe",About:"Hilfe ",New:"neu","Name to Structure":"Struktur vom Namen",Convert:"konvertieren",N2S:"N2S","Clean up":"Säubern",Clean:" Säubern ","Lasso Selection":"Lasso Auswahl",Lasso:"Lasso","Select Fragment":"Fragment auswählen",Fragment:"Fragment","Select All":"Alles auswählen",All:"Alles",Cut:"Ausschneiden","Box Selection":"Auswahl mit Rechteck",Box:"Rechteck",Eraser:"Löscher",Undo:"Rückgängig machen",Redo:"Wiederholen","Single bond":"Einfachbindung","Double bond":"Doppelbindung",Double:"doppelt","Chain Tool":"Ketten Werkzeug",Chain:"Kette",Template:"Vorlage","Text/Atom Label":null,Text:"Text","SGroup - Tag Atom/Bond/Bracket":"SGruppe - ?? Atom/Bindung/eckige Klammer",SGroup:"SGruppe",Bracket:"eckige Klammer","Increase charges":"Ladung erhöhen",Charge:"Ladung ","Descrease charges":"Ladung erniedrigen","Move to center":"Zentrieren",Center:"Zentrieren","Zoom in":"Vergrössern",Zoom:"Vergrössern","Zoom out":"Verkleinern",Rotate:"Drehen","Flip Horizontal":"Horizontal spiegeln",Flip:"Spiegeln","Flip Vertical":"Vertical spiegeln","Reaction arrow":"Reaktionspfeil",Reaction:"Reaktion","Reaction Plus":"reaktion Plus",Plus:"Plus","Clean up reaction":"Reaktion säubern",Clean:"Säubern","Copy reactants to products":"Reaktanten auf Produktseite kopieren","R->P":null,"Map reaction":"Reaktionszentren bezeichnen",Map:"R-Zentren","Clear reaction map":"Reaktionszentren Abgleich löschen","Peptide Sequence":"Peptid Sequenz",Peptide:"Peptide","DNA Sequence":"DNA Sequenz","RNA Sequence":"RNA Sequenz",Antibody:"Antikörper",Protein:"Eiweiss",Gene:"Gen",Ink:"Farbe","Ink - Red":"Farbe rot","Ink - Blue":"Farbe blau","Ink - Green":"Farbe grün","Clear Ink":"Farbe löschen","Clear All Inks":"Alle Farben löschen","Search PubChem":"PubChem durchsuchen","Search ChemSpider":"Chemspider durchsuchen","click to expand":"klicke für mehr Optionen","Element C":"Element C",Carbon:"Kohlenstoff","Element H":null,Hydrogen:"Wasserstoff","Element O":null,Oxygen:"Sauerstoff","Element N":null,Nitrogen:"Stickstoff","Element S":null,Sulfur:"Schwefel","Element P":null,Phosphorus:"Phosphor","Element F":null,Fluorine:"Fluor","Element Cl":null,Chlorine:"Chlor","Element Br":null,Bromine:"Brom","Element Periodic Table":"Periodensystem","P.T.":"Periodensystem","Copy ChemDraw etc.":"Chemdraw kopieren","Atom Properties":"Atom Eigenschaften","Atom Type":"Atom Typ","Enhanced Stereochemistry":"erweiterte Stereochemie","Atom Charges":"Atomladungen",Isotope:"Isotop",Radical:"Radikal","Add Tag":"Anmerkung hinzufügen","R Group":"R Gruppe","Create R Definition":"R Gruppe definieren","Remove R Definition":"R Gruppendefintion löschen","Attach Point":"Absatzpunkt",Query:"Frage",Substituents:"Substituent","Ring Bonds":"Ringbindung","Edit Atom List ...":"Atom(Symbol) Liste verändern",Unsaturated:"ungesättigt",Delete:"löschen","Antibody Type":"Antikörper Typ","Show Sequences":"zeige Sequenz",Expand:"Expandieren","Bond Properties":"Bindungseigenschaften","Bond Type":"Bindungstyp","Bond Topology":"Bindungsart","Reaction Center":"Reaktionszentrum",Unspecified:"nicht bezeichnet","Not Center":"kein Zentrum","Break/Form":"Bindung brechen/bilden",Change:"Ändern","Break/Form and Change":"Brechen/Bilden und Ändern","Unknown Locant":"Unbekannter ???","Add Structure":"Struktur hinzufügen","Bracket Type":"Klammer Typ","Bracket Sub-type":"Klammer Untertyp",Connectivity:"Bindung","Mod Flags":null,"Set Ratio":"Verhältnis","Set Data":null,Chiral:"chiral",Color:"Farbe","Paste ChemDraw etc.":"Struktur einfügen...",Default:"Standard",Clear:"Löschen",Search:"Suchen","* - Wildcard":"Platzhalter","A - Not Hydrogen":"A – nicht Wasserstoff","Q - Not H and C":"Q – nicht H und C","X - Halide":"X - Halogen","M - Metal":"M - Metall",Ring:"Ring","Please type chemical name, CAS, SMILES etc.":"Bitte chemischen Namen, CAS... eingeben","Query Features":"Sucherweiterungen","Atom List":"Atom Liste","# Substituents":"‘ Anzahl Substituenten","Unsaturated Bond":"ungesättigte Bindung","Atom Tag":"",Update:"Aktualisieren","On Ring":"Ring an","On Chain":"Kette an","Export File":"Datei exportieren","Import File":"Datei importieren","Please select a chemistry file":"Bitte wähle eine Chemiedatei",Upload:"Hochladen",Benzene:"Benzol",Hexane:"Hexan",Pentane:"Pentan",Propane:"Propan",Butane:"Butan",Heptane:"Heptan",Octane:"Oktan","About ...":"Über ...","Add Chain":"Kette anhängen","Remove Chain":"Kette löschen","Add Annotation":"Anmerkung hinzufügen","Remove Annotation":"Anmerkung löschen","Edit Annotation":"Anmerkung ändern","Show Properties":"Eigenschften zeigen","Edit Sequence":"Sequenz ändern","Sequence Editor":"Sequenz Editor","Add Peptide":"Peptide hinzufügen","Please type peptide sequence here":"Bitte Peptidsequenz hier eingeben","Add DNA":"DNA hinzu fügen","Add RNA":"RNA hinzu fügen","Please type DNA sequence here":" Bitte DNA Sequenz hier eingeben ","Please type RNA sequence here":" Bitte RNA Sequenz hier eingeben ","Set Signal Sequence":null,"Please select a chain":"Bitte Kette auswählen","Please type the signal sequence length":null,Properties:"Eigenschaften",Cancel:"Abbrechen",Attention:"Achtung",Close:"Schliessen","Atom Attributes":"Atom Eigenschaften","Clear 1":"Löschen 1",Templates:"","Custom Templates":"",Symbol:"","Insert Symbol":"",Curve:"","Shape Type":"",Rectangle:"",Square:"",Ellipse:"",Circle:"","Set Fill":"",Solid:"",Radial:"",Linear:"","Linear-X":"","Linear-Y":"","Bring to Front":"","Set to Back":"","Other Colors":"","Choose Color":"",None:""},pl:{"Triple bond":"Wiązanie potrójne",Triple:"Potrójne","Wedge bond":"Wiązanie ponad płaszczyznę",Up:"Ponad","Hash bond":"Wiązanie pod płaszczyznę",Down:"Pod","Wiggle bond":"Wiązanie faliste",Wiggle:"Faliste","Delocalized bond":"Wiązanie zdelokalizowane",Delocalized:"Zdelokalizowane","Either double bond":"Wiązanie E/Z",Either:"E/Z","Dotted bond":"Wiązanie kropkowane",Dotted:"Kropkowane","Single or Double":"Pojedyncze lub Podwójne",Single:"Pojedyncze","Single or Aromatic":"pojedyncze lub Aromatyczne","Double or Aromatic":"Podwójne lub Aromatyczne",Export:"Eksportuj",Import:"Importuj","Paste ChemDraw, ISIS/Draw...":"Wklej z ChemDraw, ISIS/Draw...",Paste:"Wklej","Copy ChemDraw, ISIS/Draw, Word...":"Kopiuj do ChemDraw, ISIS/Draw, Word...",Copy:"Kopiuj","About JSDraw":"O programie JSDraw",About:"Informacje",New:"Nowy","Name to Structure":"Zamień nazwę na Strukturę",Convert:"Konwertuj",N2S:"N2S","Clean up":"Wyczyść wszystko",Clean:"Wyczyść","Lasso Selection":"Zaznaczenie lassem",Lasso:"Lasso","Select Fragment":"Zaznacz fragment",Fragment:"Fragment","Select All":"Zaznacz wszystko",All:"Wszystko",Cut:"Wytnij","Box Selection":"Zaznaczenie prostokątne",Box:"Prostokąt",Eraser:"Gumka",Undo:"Cofnij",Redo:"Powtórz","Single bond":"Wiązanie pojedyncze","Double bond":"Wiązanie podwójne",Double:"Podwójne","Chain Tool":"Rysuj szkielet węglowy",Chain:"Szkielet",Template:"Szablon","Text/Atom Label":"Dodaj etykietę",Text:"Tekst","SGroup - Tag Atom/Bond/Bracket":"",SGroup:"",Bracket:"Nawias","Increase charges":"Zwiększ ładunek",Charge:"Ładunek","Descrease charges":"Zmniejsz ładunek","Move to center":"Wycentruj",Center:"Środek","Zoom in":"Przybliż",Zoom:"Przybliżenie","Zoom out":"Oddal",Rotate:"Obróć","Flip Horizontal":"Przerzuć w poziomie",Flip:"Przerzuć","Flip Vertical":"Przerzuć w pionie","Reaction arrow":"strzałka reakcyjna",Reaction:"Reakcja","Reaction Plus":"Plus",Plus:"Plus","Clean up reaction":"Wyczyść reakcję",Clean:"Wyczyść","Copy reactants to products":"Skopiuj substraty na stronę produktów","R->P":"S->P","Map reaction":"Stwórz mapę reakcji",Map:"Mapowanie reakcji","Clear reaction map":"Wyczyść mape reakcji","Peptide Sequence":"Sekwencja aminokwasów",Peptide:"Peptyd","DNA Sequence":"Sekwencja DNA","RNA Sequence":"Sekwencja RNA",Antibody:"Przeciwciało",Protein:"Białko",Gene:"Gen","Ink - Red":"Pióro - Czerwone",Ink:"Pióro","Ink - Blue":"Pióro - Niebieskie","Ink - Green":"Pióro - Zielone","Clear Ink":"Wyczyść Pióro","Clear All Inks":"Wyczyść wszystkie Pióra","Search PubChem":"Szukaj w PubChem","Search ChemSpider":"Szukaj w ChemSpider","click to expand":"Kliknij, aby powiększyć","Element C":"Pierwiastek C",Carbon:"Węgiel","Element H":"Pierwiastek H",Hydrogen:"Wodór","Element O":"Pierwiastek O",Oxygen:"Tlen","Element N":"Pierwiastek N",Nitrogen:"Azot","Element S":"Pierwiastek S",Sulfur:"Siarka","Element P":"Pierwiastek P",Phosphorus:"Fosfor","Element F":"Pierwiastek F",Fluorine:"Fluor","Element Cl":"Pierwiastek Cl",Chlorine:"Chlor","Element Br":"Pierwiastek Br",Bromine:"Brom","Element Periodic Table":"Układ okresowy pierwiastków","P.T.":"U.O.","Copy ChemDraw etc.":"Kopiuj ChemDraw itp.","Atom Properties":"Właściwości atomu","Atom Type":"Typ atomu","Enhanced Stereochemistry":"Skorygowana stereochemia","Atom Charges":"Ładunek atomu",Isotope:"Izotop",Radical:"Rodnik","Add Tag":"Dodaj znacznik","R Group":"Grupa R","Create R Definition":"Stwórz definicję R","Remove R Definition":"Usuń definicję R","Attach Point":"Dodaj punkt",Query:"Zapytanie",Substituents:"Podstawniki","Ring Bonds":"Wiązania cykliczne","Edit Atom List ...":"Edytuj listę atomów",Unsaturated:"Nienasycony",Delete:"Usuń","Antibody Type":"Typ przeciwciała","Show Sequences":"Pokaż sekwencję",Expand:"Rozwiń","Bond Properties":"Właściwości wiązania","Bond Type":"Rodzaj wiązania","Bond Topology":"Topologia wiązania","Reaction Center":"Centrum reakcji",Unspecified:"Nieokreślony","Not Center":"Nie centruj","Break/Form":"Przerwij/Stwórz",Change:"Zmień","Break/Form and Change":"Przerwij/Stwórz i zmień","Unknown Locant":"Nieznany lokant","Add Structure":"Dodaj strukturę","Bracket Type":"Typ nawiasu","Bracket Sub-type":"Podtyp nawiasu",Connectivity:"Spójność","Mod Flags":"","Set Ratio":"Ustal stosunek","Set Data":"Ustal dane",Chiral:"Chiralny",Color:"Kolor","Paste ChemDraw etc.":"Wklej ChemDraw itp.",Default:"Domyślny",Clear:"Wyczyść",Search:"Szukaj","* - Wildcard":"* - Dowolny","A - Not Hydrogen":"A - inny niż wodór","Q - Not H and C":"Q - inny niż C i H","X - Halide":"X - Halogen","M - Metal":"M - metal",Ring:"Pierścień/Cykliczny","Please type chemical name, CAS, SMILES etc.":"Wprowadź nazwę chemiczną, CAS, SMILES itp.","Query Features":"Cechy zapytania","Atom List":"Lista atomów","# Substituents":"Liczba podstawników","Unsaturated Bond":"Wiązania nienasycone","Atom Tag":"Znacznik atomu",Update:"Aktualizuj","On Ring":"W Pierścieniu","On Chain":"W Łańcuchu","Export File":"Eksportuj plik","Import File":"Importuj plik","Please select a chemistry file":"Wybierz plik chemiczny",Upload:"Załaduj",Benzene:"Benzen",Hexane:"Heksan",Pentane:"Pentan",Propane:"Propan",Butane:"Butan",Heptane:"Heptan",Octane:"Oktan","About ...":"O programie","Add Chain":"Dodaj łańcuch","Remove Chain":"Usuń łańcuch","Add Annotation":"Dodaj przypis","Remove Annotation":"Usuń przypis","Edit Annotation":"Zmień przypis","Show Properties":"Pokaż właściwości","Edit Sequence":"Edytuj sekwencję","Sequence Editor":"Edytor sekwencji","Add Peptide":"Dodaj peptyd","Please type peptide sequence here":"Wprowadź sekwencję peptydów","Add DNA":"Dodaj DNA","Add RNA":"Dodaj RNA","Please type DNA sequence here":"Wprowadź sekwencję DNA","Please type RNA sequence here":"Wprowadź sekwencję RNA","Set Signal Sequence":"Ustaw sekwencje sygnałową","Please select a chain":"Wybierz łańcuch","Please type the signal sequence length":"Wprowadź długość sekwencji sygnałowej",Properties:"Właściwości",OK:"OK",Cancel:"Anuluj",Attention:"Uwaga",Close:"Zamknij","Atom Attributes":"Cechy atomu",Templates:"Szablony","Custom Templates":"Szablony własne",Symbol:"Symbol","Insert Symbol":"Wprowadź symbol",Curve:"Krzywa","Shape Type":"Kształt",Rectangle:"Trójkąt",Square:"Kwadrat",Ellipse:"Elipsa",Circle:"Okrąg","Set Fill":"Wybierz wypełnienie",Solid:"Pełne",Radial:"Promieniowe",Linear:"Liniowe","Linear-X":"Liniowe-X","Linear-Y":"Liniowe-Y","Bring to Front":"Przesuń do przodu","Set to Back":"Przesuń do tyłu","Other Colors":"Inne kolory","Choose Color":"Wybierz kolor",None:"Brak",Yesterday:"Wczoraj",Today:"Dziś",Yes:"Tak",No:"Nie",Message:"Wiadomość",Hashed:"Pod płaszczyzną","Hashed bond":"Wiązanie pod płaszczyzną",Bold:"Nad płaszczyzną","Bold bond":"Wiązanie nad płaszczyzną",Ionic:"Jonowe","Ionic bond":"Wiązanie jonowe",Electrophoresis:"Elektroforeza","Electrophoresis Gel Plate":"Płytka z żelem do elektroforezy",Assay:"Próba","Assay Curve":"Krzywa testowa",Diamond:"Romb","Set Raw Data & Fit Curve":"Ustal dane źródlowe i dopasuj krzywą","Exclude Sample Point":"Ukryj punkt próby","Set Raw Curve Data":"Ustal dane krzywej źródlowej",Data:"Dane","Chart Title":"Tytuł wykresu","X Axis Label":"Etykieta osi X","Y Axis Label":"Etykieta osi Y","X Axis":"Oś X","Chart Type":"Typ wykresu","Average Repeat":"Średnie powtórzenie","Align Shapes":"Wyrównaj kształty","Align Left":"Wyrownaj do lewej","Align Horizontal Center":"Wyrównaj poziomo do środka","Align Right":"Wyrównaj do prawej","Align Top":"Wyrównaj do góry","Align Vertical Center":"Wyrównaj pionowo do środka","Align Bottom":"Wyrównaj do dołu","Align Width":"Wyrównaj szerokość","Align Height":"Wyrownaj wysokość","Workflow Properties":"Właściwości przepływu pracy","Output Stuatus":"Status wyjściowy","Can Cancel":"Może anulować","Authorized Role":"Autoryzowana rola","Authorized User":"Autoryzowany użytkownik","CC Emails":"CC Emaili",Subform:"","Append Lane":"","Frame Color":"Kolor ramki","RF Labels of All Spots":"","All Spots Fill":"Wypełnij wszystkie punkty","Show Lane Label":"",Show:"Pokaż",Hide:"Ukryj",Hollow:"Pusty","Set Mol Type":"Ustaw typ Mol","Set Chirality":"","Set MW":"","Registration Parent":"",SmallMolecule:"Mała cząsteczka",Polymer:"Polimer",ChemicalReagent:"Odczynnik Chemiczny",Unknown:"Nieznany",Achiral:"Achiralny",Absolute:"Absolutny",Racemic:"Racemiczny",Diastereomeric:"Diastereomeryczny","Enantiomer R":"Enancjomer R","Enantiomer S":"Enancjomer S",Any:"Dowolny","Add Peptide":"Dodaj Peptyd","Amino Acids":"Aminokwasy","N-Terminal":"N-końcowy","C-Terminal":"C-końcowy",Expand:"Rozszerz","Please type the sequence below:":"Wprowadź sekwencję poniżej",Add:"Dodaj",Save:"Zapisz",Cancel:"Anuluj",Action:"Akcja",Sequence:"Sekwencja","Expand All Nodes":"Rozwiń wszystkie gałęzie","Query Atoms":"","Lock Connection":"Zablokuj połączenie","Unlock Connection":"Odblokuj połączenie","Create Multi-Center":"Stwórz Multi-Center","@ - Multi-Center Attachment":"@ - ",Wiggly:"","View Raw Assay Data":"Pokaż dane analizy","View in Large Window":"Pokaż w dużym oknie","Remove All Atom Values":"Usuń wszystkie wartości atomów",Fit:"Dopasuj",Edit:"Edytuj","Set Lane Labels":"","Next Month":"Następny miesiąc","Previous Month":"Poprzedni miesiąc","Next Year":"Następny rok","Previous Year":"Poprzedni rok",January:"Styczeń",February:"Luty",March:"Marzec",April:"Kwiecień",May:"Maj",June:"Czerwiec",July:"Lipiec",August:"Sierpień",September:"Wrzesień",October:"Październik",November:"Listopad",December:"Grudzień","Font Size":"Rozmiar czcionki","Field Type":"Typ pola"},cn:{"Triple bond":"三键",Triple:"三键","Wedge bond":"楔型向上键",Up:"向上","Hash bond":"楔型向下键",Down:"向下","Wiggle bond":"上下不确定键",Wiggle:"上下","Delocalized bond":"离域键",Delocalized:"离域","Either double bond":"顺反不确定键",Either:"顺反","Dotted bond":"不确定键",Dotted:"不定","Single or Double":"单双键",Single:"单双","Single or Aromatic":"单键或离域键","Double or Aromatic":"双键或离域键",Export:"导出",Import:"导入","Paste ChemDraw, ISIS/Draw...":"张贴ChemDraw, ISIS/Draw",Paste:"张贴","Copy ChemDraw, ISIS/Draw, Word...":"复制到ChemDraw, ISIS/Draw, Word...",Copy:"复制","About JSDraw":"关于JSDraw",About:"关于",New:"新建","Name to Structure":"转换名称到结构",Convert:"转换",N2S:"","Clean up":"整理",Clean:"整理","Lasso Selection":"套索选中",Lasso:"套索","Select Fragment":"选中片段",Fragment:"片段","Select All":"全选",All:"全选",Cut:"剪切","Box Selection":"方框选中",Box:"方框",Eraser:"擦子",Undo:"撤销",Redo:"重做","Single bond":"单键","Double bond":"双键",Double:"双键","Chain Tool":"造链工具",Chain:"造链",Template:"模板","Text/Atom Label":"文字/原子标记",Text:"文字","SGroup - Tag Atom/Bond/Bracket":"",SGroup:"SGroup",Bracket:"括号","Increase charges":"增加电荷",Charge:"电荷","Descrease charges":"减少电荷","Move to center":"结构居中",Center:"居中","Zoom in":"放大",Zoom:"放缩","Zoom out":"缩小",Rotate:"旋转","Flip Horizontal":"水平反转",Flip:"反转","Flip Vertical":"垂直反转","Reaction arrow":"化学反应箭头",Reaction:"反应","Reaction Plus":"化学反应加号",Plus:"加号","Clean up reaction":"整理化学反应",Clean:"整理","Copy reactants to products":"复制反应物到产物","R->P":"复制","Map reaction":"反应物到产物对应",Map:"对应","Clear reaction map":"清除对应","Peptide Sequence":"多肽序列",Peptide:"多肽","DNA Sequence":"DNA序列","RNA Sequence":"RNA序列",Antibody:"抗体",Protein:"蛋白",Gene:"基因","Ink - Red":"红笔",Ink:"笔","Ink - Blue":"蓝笔","Ink - Green":"绿笔","Clear Ink":"清除标记","Clear All Inks":"清除所有标记","Search PubChem":"搜索PubChem数据库","Search ChemSpider":"搜索PChemSpider数据库","click to expand":"点击展开","Element C":"碳元素",Carbon:"碳","Element H":"氢元素",Hydrogen:"氢","Element O":"氧元素",Oxygen:"氧","Element N":"氮元素",Nitrogen:"氮","Element S":"硫元素",Sulfur:"硫","Element P":"磷元素",Phosphorus:"磷","Element F":"氟元素",Fluorine:"氟","Element Cl":"氯元素",Chlorine:"氯","Element Br":"溴元素",Bromine:"溴","Element Periodic Table":"元素周期表","P.T.":"周期表","Copy ChemDraw etc.":"复制到ChemDraw等","Atom Properties":"原子属性","Atom Type":"原子类型","Enhanced Stereochemistry":"扩展立体化学","Atom Charges":"原子电荷",Isotope:"同位素",Radical:"自由基","Add Tag":"添加标签","R Group":"R基团","Create R Definition":"创建R基团定义","Remove R Definition":"删除R基团定义","Attach Point":"连接点",Query:"提问结构",Substituents:"取代位","Ring Bonds":"环键","Edit Atom List ...":"编辑原子列表",Unsaturated:"不饱和键",Delete:"删除","Antibody Type":"抗体类型","Show Sequences":"显示序列",Expand:"展开","Bond Properties":"键属性","Bond Type":"键类型","Bond Topology":"键拓扑","Reaction Center":"反应中心",Unspecified:"不确定的","Not Center":"非反应中心","Break/Form":"断裂/形成",Change:"改变","Break/Form and Change":"断裂/形成/改变","Unknown Locant":"不确定位置","Add Structure":"添加结构","Bracket Type":"括号类型","Bracket Sub-type":"括号子类型",Connectivity:"连接性","Mod Flags":"Mod标志","Set Ratio":"设置比例","Set Data":"设置数据","Set Data from File":"从文件加载数据",Chiral:"手性",Color:"颜色","Paste ChemDraw etc.":"张贴ChemDraw结构等",Default:"默认",Clear:"清除",Search:"检索","* - Wildcard":"* - 任意元素","A - Not Hydrogen":"A - 非氢元素","Q - Not H and C":"Q - 非氢和碳元素","X - Halide":"X - 卤素","M - Metal":"M - 金属",Ring:"环","Please type chemical name, CAS, SMILES etc.":"请输入化学名称，CAS号，SMILES等","Query Features":"查询属性","Atom List":"原子列表","# Substituents":"取代数","Unsaturated Bond":"不饱和键","Atom Tag":"原子标签",Update:"更新","On Ring":"位于环上","On Chain":"位于链上","Export File":"导出文件","Import File":"导入文件","Please select a chemistry file":"请选择化学文件类型",Upload:"上传",Benzene:"苯环",Hexane:"六元环",Pentane:"五元环",Propane:"三元环",Butane:"四元环",Heptane:"七元环",Octane:"八元环","About ...":"关于...","Add Chain":"添加链","Remove Chain":"删除链","Add Annotation":"添加备注","Remove Annotation":"删除备注","Edit Annotation":"修改备注","Show Properties":"显示属性","Edit Sequence":"修改序列","Sequence Editor":"序列编辑器","Add Peptide":"添加多肽","Please type peptide sequence here":"请输入多肽序列","Add DNA":"添加DNA","Add RNA":"添加RNA","Please type DNA sequence here":"请输DNA入序列","Please type RNA sequence here":"请输RNA入序列","Set Signal Sequence":"设置信号序列","Please select a chain":"请先选中一条链","Please type the signal sequence length":"请输入信号序列长度",Properties:"属性",OK:"确定",Cancel:"取消",Attention:"提示",Close:"关闭","Atom Attributes":"原子属性",Templates:"模板","Custom Templates":"自定义模板",Symbol:"符号","Insert Symbol":"插入特殊符号",Curve:"曲线","Shape Type":"形状类型",Rectangle:"矩形",Square:"正方形",Ellipse:"椭圆形",Circle:"圆形","Set Fill":"设置填充",Solid:"均一颜色",Radial:"发散",Linear:"线性","Linear-X":"X轴线性","Linear-Y":"Y轴线性","Bring to Front":"提到最上层","Set to Back":"放到最底层","Other Colors":"其他颜色","Choose Color":"选择颜色",None:"无",Yesterday:"昨天",Today:"今天",Yes:"是",No:"否",Message:"消息",Hashed:"空心","Hashed bond":"空心键",Bold:"粗键","Bold bond":"粗键",Ionic:"离子","Ionic bond":"离子键",Electrophoresis:"电泳","Electrophoresis Gel Plate":"电泳凝胶板",Assay:"Assay","Assay Curve":"Assay曲线",Diamond:"菱形","Set Raw Data & Fit Curve":"输入原始数据并拟合曲线","Exclude Sample Point":"剔除数据点","Set Raw Curve Data":"输入原始数据","Show Curve Only":"只显示曲线","Show IC50 Line":"显示IC50线","Overlay Curves":"叠加曲线",Data:"数据","Chart Title":"图表标题","X Axis Label":"X坐标标题","Y Axis Label":"Y坐标标题","X Axis":"X坐标","Chart Type":"图表类型","Average Repeat":"平均重复点","Align Shapes":"对齐","Align Left":"左对齐","Align Horizontal Center":"水平中间对齐","Align Right":"右对齐","Align Top":"上对齐","Align Vertical Center":"垂直中间对齐","Align Bottom":"下对齐","Align Width":"等宽度","Align Height":"等高度","Workflow Properties":"流程属性","Output Stuatus":"输出状态","Can Cancel":"能取消","Authorized Role":"授权角色","Authorized User":"授权用户","CC Emails":"抄送邮件",Subform:"子表格","Append Lane":"添加色带","Frame Color":"框颜色","RF Labels of All Spots":"所有点的RF标题","All Spots Fill":"所有点的填充","Show Lane Label":"显示色带标题",Show:"显示",Hide:"隐藏",Hollow:"空心","Set Mol Type":"设置分子类型","Set Chirality":"设置分子手性","Set MW":"设置分子量","Registration Parent":"注册父结构",SmallMolecule:"小分子",Polymer:"聚合物",ChemicalReagent:"化学试剂",Unknown:"未知",Achiral:"非手性",Absolute:"绝对",Racemic:"外消旋",Diastereomeric:"非对映体","Enantiomer R":"R对映体","Enantiomer S":"S对映体",Any:"任意","Add Peptide":"添加多肽","Amino Acids":"氨基酸","N-Terminal":"N-端","C-Terminal":"C-端",Expand:"展开","Please type the sequence below:":"请输入序列:",Add:"添加",Save:"保存",Cancel:"取消",Action:"操作",Sequence:"序列","Expand All Nodes":"展开所有节点","Query Atoms":"提问原子","Lock Connection":"锁定连接","Unlock Connection":"解锁连接","Create Multi-Center":"创建多原子中心","@ - Multi-Center Attachment":"@ - 多原子中心",Wiggly:"摇摆","View Raw Assay Data":"查看Assay原始数据","View in Large Window":"在大窗体中查看","Remove All Atom Values":"删除所有原子值",Fit:"拟合",Edit:"编辑","Set Lane Labels":"设置色带标题","Next Month":"下月","Previous Month":"上月","Next Year":"下年","Previous Year":"上年",January:"一月",February:"二月",March:"三月",April:"四月",May:"五月",June:"六月",July:"七月",August:"八月",September:"九月",October:"十月",November:"十一月",December:"十二月",Jan:"一月",Feb:"二月",Mar:"三月",Apr:"四月",Jun:"六月",Jul:"七月",Aug:"八月",Sep:"九月",Oct:"十月",Nov:"十一月",Dec:"十二月","Font Size":"字体大小","Field Type":"字段类型",Timeline:"时间表","Work Days":"工作日","Script Type":"脚本类型",Script:"脚本",days:"天","Started Date":"开始日期","Finished Date":"完成日期","Required Work Days":"需要工作日","Required Finish Date":"设定完成日期","Expected Finish Date":"预计完成日期","Delay Days":"延误天数","Created Date":"创建日期",Requestor:"申请人",Status:"状态","Expected Finish":"预计完成日期",", if starting today":"（如果从今天算起）","Estimated Finish Date":"估计完成日期","Change Timeline":"改变时间表","Test Script":"测试脚本","C# Script":"C#脚本","Control Information":"控制信息",Form:"表单","Flow Condition":"流向条件控制","Detect All Stereochemistry":"计算所有立体化中心","Hide All Stereochemistry":"隐藏所有立体化中心","Detect Selected Stereochemistry":"计算选择的立体化中心","Hide Selected Stereochemistry":"隐藏选择的立体化中心","Move to Center":"移到中心",Move:"移动","Move/View":"移动视图",Sunday:"星期日",Monday:"星期一",Tuesday:"星期二",Wednesday:"星期三",Thursday:"星期四",Friday:"星期五",Saturday:"星期六",Sun:"周日",Mon:"周一",Tue:"周二",Wed:"周三",Thu:"周四",Fri:"周五",Sat:"周六","Has Timeline":"使用时间表","Max Requests/Day":"每天最多申请","Restart App":"重启程序","Delete Requests":"删除申请","User Roles":"用户角色","Creating Roles":"创建角色","Viewing Roles":"查看角色","Request No":"申请号",Start:"开始",End:"结束",Type:"类型","Coding Region":"编码区域",Notes:"备注",Annotation:"注释","Form Designer":"表单编辑器",Controls:"控件",Properties:"属性",Key:"键",Required:"必填项",Width:"宽度",Height:"高度",Items:"选项","Move Up":"上移","Move Down":"下移","Move to Top":"置顶","Move to Bottom":"置底",Label:"标签",Designer:"编辑器",Value:"值",Unit:"单位","Reset Password":"重置密码",Edit:"编辑",Phone:"电话","Mobile Phone":"手机","Employee No":"工号",Home:"主页",Admin:"管理员",About:"关于",Help:"帮助",Date:"日期",Time:"时间",Logout:"登出",Language:"语言",Login:"登录","Number of Copies":"打印份数","Overwrite Status":"修改状态","Delete Request":"删除申请",Result:"结果","Search Perfered Vendors Only":"只检索优先供应商","Search Results":"查询结果",Structure:"结构","Catalog No":"目录号",Vendor:"供应商",Amount:"总额",Price:"价格","Search Type":"检索类型","Previous Page":"前一页","Next Page":"后一页",Query:"查询",Spectrum:"谱图","View Attributes":"查看属性","Request ID":"申请编号","Approved By":"批准人",Assignee:"被分配给",Apply:"应用",Rules:"规则",Filter:"过滤","Apply All":"全部应用",Chemistry:"化学",Find:"查找",Nucleotide:"核苷酸",Sugar:"糖",Base:"碱基",Linker:"连接","Sequence Type":"输入格式","Import Sequence":"导入序列","Monomer Type":"单体类型","Find and Replace":"查找替换","Replace With":"替换为",Replace:"替换","Replace All":"替换所有","Find All":"查找所有",Chem:"化学","Search Selected Only":"只查找选择部分查找",Scope:"范围",Layout:"排布","Output Status":"输出状态","External Action":"外部执行",Silent:"无通知","Sub-Request Form":"子请求表单","Sub-Request ID Field":"子请求ID字段","Sub-Request Data Out":"子请求数据输出","Sub-Request Data Back ":"子请求数据返回","D Shape":"D形状","D Reversed":"反D形状","Copy To":"复制到",General:"基本",Advanced:"高级",Select:"选择","Find/Replace":"查找/替换",Format:"格式","Structure View":"结构视图",Append:"追加","Copy Molfile":"复制Molfile","Copy SMILES":"复制SMILES","Copy HELM":"复制HELM",Apply:"应用",Monomers:"单体","Set as Sense":"设置为有义链","Set as Antisense":"设置为反义链","Clear Annotation":"清除备注","Sending Email":"发送邮件","Destination Form":"被复制到表单","Fields to Be Copied":"被复制的字段",Users:"用户",Configuration:"系统配置","Save for Later":"保存稍后处理",Deletable:"可被删除","Manage Users":"管理用户",Count:"数目","Full Name":"全名",Manager:"主管",Mobile:"移动",Database:"数据库",Category:"分类",Package:"包装",Source:"来源","Product Name":"产品名称",Size:"量","Price/g":"价格/g",Purity:"纯度",Grade:"等级",Expiration:"过期",Rating:"评级","Update Dt.":"更新日期",Name:"名称","Dept.":"部门",Dept:"部门","Confirm Password":"确认密码","Show Me":"我的信息",Logout:"退出","Scan Settings":"扫描设置","Download App":"下载移动App","Mobile(Live)":"移动(在线)","Mobile(Mute)":"移动(已切断)","Symbol/Name":"代码/名称","Polymer Type":"聚合物类型","Natural Analog":"自然单体",Author:"作者",Monomer:"单体","Monomer List":"单体列表","Add Coding Region":"添加编码区域",Disabled:"已禁用","Config Editor":"配置编辑器",Fullscreen:"全屏",Separator:"分隔符",Favorite:"常用","Monomer Explorer":"单体浏览器","Quick Search":"快捷查询","Advanced Search":"高级查询","File Size":"文件大小","Insert Before":"插入之前","Insert After":"插入之后","Delete Selected Row(s)":"删除行","New File":"新文件","Open File":"打开文件","Save File":"保存文件","Structure Search":"查询结构","Reset Search":"重置查询","Draw Chart":"画图表","Show/Hide Columns":"显示/隐藏纵","Define Columns":"定义纵","Delete Selected Area":"删除选中区域","Copy Selected Area":"复制选中区域","Cut Selected Area":"剪切选中区域","Paste Selected Area":"张贴选中区域","Weigh Station":"称重站",Pivot:"行纵换位","From Mobile":"来自移动端","Please select a file":"请选择文件",File:"文件","Please select a file type":"请选择文件类型","File Name":"文件名",Device:"设备",Uploaded:"已上传","Add File":"添加文件","Fullscreen Size":"全屏","Set Stereochemistry":"设置立体化学",Submit:"提交","Cancel Request":"取消申请","External Script":"外部脚本","Sub-Request Data Back":"子申请数据返回","Weigh Records":"称量记录","Select Balance":"选择天平","Last Minutes":"最早时间(分钟数)","End Minutes":"截止时间(分钟数)",Weight:"重量",Balance:"天平",Print:"打印","Use Data":"使用数据","Start Date":"开始日期","Start Time":"开始时间","End Date":"结束日期","End Time":"结束时间",Password:"密码",Refresh:"刷新","Bypass Condition":"跳过的条件",Bypass:"跳过","New Status":"新状态",Set:"设置","Set Status":"设置状态",Reject:"拒绝","Insert Structure":"插入化学结构","WARNING: Form data are not saved yet.":"警告：表单数据尚未保存。",Stats:"统计","Test Printer":"测试打印机",Signature:"签名",Sign:"签字","Add Plate":"添加板子","Delete current plate":"删除当前板子","Remove all plates":"删除所有板子","Change Plate Barcode":"修改板子条形码","Fill compounds":"填充化合物","Calculate results from raw values":"计算原始数据","Set calculation formula":"设置计算公式","Authorized Field":"授权字段","Display Range X1":"显示范围X1","Display Range Y1":"显示范围Y1","Show ICx Line":"显示ICx线","Show Curve":"曲线显示",Both:"两者","Curve Only":"曲线","Data Only":"数据点","No Records Found":"没有数据","Show As":"显示为","Fit Line Shape":"拟合线形状","Import data from files":"从文件批量导入",Download:"下载","Test Structure":"测试结构","Test Applying":"测试使用","Password Expiration":"密码过期","Play Video":"播放视频","Inline Annotation":"嵌入备注","Inline Annotate":"嵌入备注",Annotation:"备注",Annotate:"备注","[No Comments]":"[没有备注]","Quick Start Manual":"入门快手","Verify Method":"验证方法","Code Recieved":"刚刚收到的验证码","Remember this device":"记住这台设备",Send:"发送","Resend in ":"再发送于"," second(s)":"秒",Resend:"重新发送",Verify:"验证","Exclude Data Points":"剔除数据点","Click the number to mask/unmask it":"点击数字可以屏蔽(去屏蔽)数据点","Internal Key":"内部键","Table ID":"表ID","DB Table":"数据库表","Table View":"数据库视图",Alias:"别名","View Only":"只读",Modified:"修改","MyTable Fields":"MyTable字段","Custom C#":"定制C#","Custom JavaScript":"定制JavaScript","JSDraw Form":"JSDraw表单","MyTable Log":"MyTable日志","Log ID":"日志ID","Primary Key":"主键","Auto-No Col.":"自动编号列","No Prefix":"编号前缀","Tree Col.":"树显示列","Tree Caption":"树标题","Tree Json":"树显示用Json","Left Width":"左边宽度","Allow Edit":"允许编辑","Allow Add":"允许添加","Allow Delete":"允许删除","Allow Copy":"允许复制","Allow Import":"允许导入","Allow Download":"允许下载",Logging:"日志","Child Tabs":"子选卡","Request Key of MyTableID":"流程中保存MyTableID的字段","MyTable Key of ReqeustID":"MyTable保存RequestID的字段","Field ID":"字段ID",Locked:"锁","Data Type":"数据类型","Save to DB":"保存到数据库","Select from DB":"从数据库提取",List:"列表","Test Code":"测试代码","Referred Table":"参照表","Referred ID":"参照内部ID","Filter Type":"过滤类型","Referred Field":"参照显示字段","Default Value":"缺省值","Edit Attributes":"编辑属性","List Attributes":"列表属性","Filter Attributes":"过滤属性","Select Items":"选项","Items URL":"选项URL","Auto-Suggest URL":"联想URL","Edit Type":"编辑类型","List Type":"列表类型","Filter Type":"过滤类型","Show Prototype":"显示原型",Override:"重载",Code:"代码","New Column":"显示为新列","Column Span":"跨列数","Plate Raw Files":"板原始数据","Raw Data File":"原始数据文件","Raw File Reader":"原始文件读取器","Plate Data Source":"板数据源","Plate Data File":"板数据文件","Normalization Formula":"数据标准化公式","Report Field":"数据字段",Plates:"板子","Fit Curves":"曲线拟合",IMPORTANT:"非常重要","Assay Plate":"Assay板",Matrix:"数据矩阵",Curves:"曲线","Hill Slope":"坡度","Inactive Range":"非活性范围","Save to Assay DB":"保存到Assay数据库",Permission:"权限","Full Page":"整页","Display Name":"显示名称","Bulk Update":"批量更新","Row Check":"行复选框","Column Hideable":"列可隐藏","Page Counts":"分页数","Update Mode":"更新模式","Update data by primary key":"按主键更新数据","Import Data":"导入数据","All Columns":"所有列","Select Columns":"选择列","Select File Format":"选择文件类型","Save Query":"保存查询","Clear Values":"清楚查询","Manage Queries":"管理查询","Message Us":"联系我们","Previous Plate":"上一个板","Next Plate":"下一个板",Invert:"反转","Select Field":"先择字段",Heatmap:"热图","Show Heatmap":"显示热图","Auto-Exclude":"字段排除数据点","Re-Fit":"重新拟合","Calculate IC50":"计算IC50","":"","":"","":"","":"","":"","":"","":"","":"","":""}};JSDraw2.Fullscreen={show:function(h){if(h.options.exitfullscreen){h=h.fullscreen.parent;if(h.fullscreen!=null){h.fullscreen.dlg.hide(true);var l=h.fullscreen.editor.modified;if(l){var c=h.fullscreen.editor.clone();h.restoreClone(c);h.fitToWindow();h.refresh(true)}if(h.options.onexitfullscreen!=null){h.options.onexitfullscreen(l)}}}else{var f=dojo.window.getBox();f.w-=20;f.h-=20;if(h.fullscreen==null){h.fullscreen={};var g=scil.Utils.createElement(null,"div");h.fullscreen.dlg=new JSDraw2.Dialog(null,g,{notitle:true});h.fullscreen.dlg.show();var n=scil.clone(h.options);n.width=n.height=null;n.fullscreen=false;n.exitfullscreen=true;n.ondatachange=null;var j=new JSDraw(g,n);h.fullscreen.editor=j;j.fullscreen={parent:h};h.fullscreen.dlg.hide(true)}var f=dojo.window.getBox();if(h.options.skin=="w8"||h.options.skin=="si"){f.w-=50;f.h-=95}else{f.w-=60;f.h-=60}h.fullscreen.dlg.show();h.fullscreen.editor.resize(f.w,f.h);h.fullscreen.dlg.moveCenter();var c=h.clone();h.fullscreen.editor.restoreClone(c);h.fullscreen.editor.setModified(false);h.fullscreen.editor.fitToWindow();h.fullscreen.editor.redraw()}},resize:function(f){if(f.fullscreen==null){return}var g=scil.Utils.getMaxZindex();f.fullscreen.div.style.zIndex=g+1;var c=dojo.window.getBox();if(f.options.skin=="w8"||f.options.skin=="si"){c.w-=30;c.h-=75}else{c.w-=20;c.h-=20}f.fullscreen.div.style.display="";f.fullscreen.editor.resize(c.w,c.h)}};scil.apply(JSDraw2.SuperAtoms,{kRepeatMax:200,sdf:"\nMolEngine02241412152D\n\n  5  4  0  0  0  0            999 V2000\n    1.3510    0.0000    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n    1.3510    1.5600    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    0.0000    2.3400    0.0000 F   0  0  0  0  0  0  0  0  0  0  0  0\n    2.7020    2.3400    0.0000 F   0  0  0  0  0  0  0  0  0  0  0  0\n    1.3510    3.1200    0.0000 F   0  0  0  0  0  0  0  0  0  0  0  0\n  1  2  1  0  0  0  0\n  2  3  1  0  0  0  0\n  2  4  1  0  0  0  0\n  2  5  1  0  0  0  0\nM  APO  1   1   1\nM  END\n> <Name>\n@OCF3\n\n$$$$\n\nMolEngine02241412152D\n\n  0  0  0  0  0  0            999 V2000\nM  END\n> <Name>\nAcyclic\n\n$$$$\n\nMolEngine02241412152D\n\n  0  0  0  0  0  0            999 V2000\nM  END\n> <Name>\nCyclic\n\n$$$$\n\nMolEngine02241412152D\n\n  0  0  0  0  0  0            999 V2000\nM  END\n> <Name>\nAlkynyl\n\n$$$$\n\nMolEngine02241412152D\n\n  0  0  0  0  0  0            999 V2000\nM  END\n> <Name>\nAlkyl\n\n$$$$\n\nMolEngine02241412152D\n\n  0  0  0  0  0  0            999 V2000\nM  END\n> <Name>\nAlkenyl\n\n$$$$\n\nMolEngine02241412152D\n\n  0  0  0  0  0  0            999 V2000\nM  END\n> <Name>\nAlkoxy\n\n$$$$\n\nMolEngine02241412152D\n\n  0  0  0  0  0  0            999 V2000\nM  END\n> <Name>\nCarbocyclic\n\n$$$$\n\nMolEngine02241412152D\n\n  0  0  0  0  0  0            999 V2000\nM  END\n> <Name>\nHeterocyclic\n\n$$$$\n\nMolEngine02241412152D\n\n  0  0  0  0  0  0            999 V2000\nM  END\n> <Name>\nAryl\n\n$$$$\n\nMolEngine02241412152D\n\n  0  0  0  0  0  0            999 V2000\nM  END\n> <Name>\nCycloalkyl\n\n$$$$\n\nMolEngine02241412152D\n\n  0  0  0  0  0  0            999 V2000\nM  END\n> <Name>\nCycloalkenyl\n\n$$$$\n\nMolEngine02241412152D\n\n  0  0  0  0  0  0            999 V2000\nM  END\n> <Name>\nHeteoaryl\n\n$$$$\n\nMolEngine02241412152D\n\n  4  3  0  0  0  0            999 V2000\n    1.3510    1.5600    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    2.7020    2.3400    0.0000 Cl  0  0  0  0  0  0  0  0  0  0  0  0\n    0.0000    2.3400    0.0000 Cl  0  0  0  0  0  0  0  0  0  0  0  0\n    1.3510    0.0000    0.0000 Cl  0  0  0  0  0  0  0  0  0  0  0  0\n  1  2  1  0  0  0  0\n  1  3  1  0  0  0  0\n  1  4  1  0  0  0  0\nM  APO  1   1   1\nM  END\n> <Name>\n@CCl3\n\n$$$$\n\nMolEngine02241412152D\n\n  4  3  0  0  0  0            999 V2000\n    1.3510    1.5600    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    2.7020    2.3400    0.0000 F   0  0  0  0  0  0  0  0  0  0  0  0\n    0.0000    2.3400    0.0000 F   0  0  0  0  0  0  0  0  0  0  0  0\n    1.3510    0.0000    0.0000 F   0  0  0  0  0  0  0  0  0  0  0  0\n  1  2  1  0  0  0  0\n  1  3  1  0  0  0  0\n  1  4  1  0  0  0  0\nM  APO  1   1   1\nM  END\n> <Name>\n@CF3\n\n$$$$\n\nMolEngine02241412152D\n\n  4  3  0  0  0  0            999 V2000\n    1.3510    1.5600    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    2.7020    2.3400    0.0000 I   0  0  0  0  0  0  0  0  0  0  0  0\n    0.0000    2.3400    0.0000 I   0  0  0  0  0  0  0  0  0  0  0  0\n    1.3510    0.0000    0.0000 I   0  0  0  0  0  0  0  0  0  0  0  0\n  1  2  1  0  0  0  0\n  1  3  1  0  0  0  0\n  1  4  1  0  0  0  0\nM  APO  1   1   1\nM  END\n> <Name>\n@CI3\n\n$$$$\n\nMolEngine02241412152D\n\n  3  2  0  0  0  0            999 V2000\n    1.3510    0.0000    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    2.7020    0.7800    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n    0.0000    0.7800    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n  1  2  2  0  0  0  0\n  1  3  1  0  0  0  0\nM  APO  1   1   1\nM  END\n> <Name>\n@COOH,@CO2H\n\n$$$$\n\nMolEngine02241412152D\n\n  3  2  0  0  0  0            999 V2000\n    1.3510    0.0000    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    2.7020    0.7800    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n    0.0000    0.7800    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n  1  2  1  0  0  0  0\n  1  3  1  0  0  0  0\nM  APO  1   2   1\nM  END\n> <Name>\n@OC2H5\n\n$$$$\n\nMolEngine02241412152D\n\n  2  1  0  0  0  0            999 V2000\n    0.0000    0.0000    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    1.3510    0.7800    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n  1  2  1  0  0  0  0\nM  APO  1   2   1\nM  END\n> <Name>\n@OCH3,@OMe\n\n$$$$\n\nMolEngine02241412152D\n\n  3  2  0  0  0  0            999 V2000\n    0.0000    2.3400    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n    0.0000    0.7800    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    1.3510    0.0000    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n  1  2  2  0  0  0  0\n  2  3  1  0  0  0  0\nM  APO  1   2   1\nM  END\n> <Name>\nAc\n\n$$$$\n\nMolEngine02241412152D\n\n 10 12  0  0  0  0            999 V2000\n    2.1353    3.8785    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    0.6551    3.0504    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    3.4845    3.0944    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    1.3082    2.7464    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    0.6551    1.7442    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    2.0913    1.1351    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    3.4845    1.7882    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    2.7444    0.0000    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    0.0000    0.6131    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    1.3092    0.9181    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n  1  2  1  0  0  0  0\n  1  3  1  0  0  0  0\n  1  4  1  0  0  0  0\n  2  5  1  0  0  0  0\n  5  6  1  0  0  0  0\n  6  7  1  0  0  0  0\n  7  3  1  0  0  0  0\n  7  8  1  0  0  0  0\n  5  9  1  0  0  0  0\n  9 10  1  0  0  0  0\n 10  8  1  0  0  0  0\n  4 10  1  0  0  0  0\nM  APO  1   7   1\nM  END\n> <Name>\nAd\n\n$$$$\n\nMolEngine02241412152D\n\n  6  5  0  0  0  0            999 V2000\n    0.0000    1.5600    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    1.3510    2.3400    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    2.7020    1.5600    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    4.0530    2.3400    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n    5.4040    1.5600    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    5.4040    0.0000    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n  1  2  2  0  0  0  0\n  2  3  1  0  0  0  0\n  3  4  1  0  0  0  0\n  4  5  1  0  0  0  0\n  5  6  2  0  0  0  0\nM  APO  1   5   1\nM  END\n> <Name>\nAlloc\n\n$$$$\n\nMolEngine02241412152D\n\n  3  2  0  0  0  0            999 V2000\n    0.0000    0.0000    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    1.3510    0.7800    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    2.7020    0.0000    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n  1  2  2  0  0  0  0\n  2  3  1  0  0  0  0\nM  APO  1   3   1\nM  END\n> <Name>\nAllyl\n\n$$$$\n\nMolEngine02241412152D\n\n  8  8  0  0  0  0            999 V2000\n    1.3510    1.5600    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    0.0000    2.3400    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    0.0000    3.9000    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    2.7020    2.3400    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    2.7020    3.9000    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    1.3510    4.6800    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    4.0530    1.5600    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    4.0530    0.0000    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n  1  2  2  0  0  0  0\n  2  3  1  0  0  0  0\n  1  4  1  0  0  0  0\n  4  5  2  0  0  0  0\n  5  6  1  0  0  0  0\n  6  3  2  0  0  0  0\n  4  7  1  0  0  0  0\n  7  8  2  0  0  0  0\nM  APO  1   7   1\nM  END\n> <Name>\nBenzoyl,Bz\n\n$$$$\n\nMolEngine02241412152D\n\n  7  7  0  0  0  0            999 V2000\n    1.3510    0.0000    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    0.0000    0.7800    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    0.0000    2.3400    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    2.7020    0.7800    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    2.7020    2.3400    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    1.3510    3.1200    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    4.0530    3.1200    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n  1  2  1  0  0  0  0\n  2  3  2  0  0  0  0\n  1  4  2  0  0  0  0\n  4  5  1  0  0  0  0\n  5  6  2  0  0  0  0\n  6  3  1  0  0  0  0\n  5  7  1  0  0  0  0\nM  APO  1   7   1\nM  END\n> <Name>\nBenzyl,Bzl,Bn\n\n$$$$\n\nMolEngine02241412152D\n\n  7  6  0  0  0  0            999 V2000\n    0.0000    1.3510    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    1.3510    0.5710    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n    0.0000    2.9110    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n    2.7020    1.3510    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    3.4820    0.0000    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    1.9220    2.7020    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    4.0530    2.1310    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n  1  2  1  0  0  0  0\n  1  3  2  0  0  0  0\n  2  4  1  0  0  0  0\n  4  5  1  0  0  0  0\n  4  6  1  0  0  0  0\n  4  7  1  0  0  0  0\nM  APO  1   1   1\nM  END\n> <Name>\nBoc\n\n$$$$\n\nMolEngine02241412152D\n\n  9 10  0  0  0  0            999 V2000\n    1.3510    0.0000    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    0.0000    0.7800    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    0.0000    2.3400    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    2.7020    0.7800    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    2.7020    2.3400    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    1.3510    3.1200    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    4.1860    2.8220    0.0000 N   0  0  0  0  0  0  0  0  0  0  0  0\n    5.1030    1.5600    0.0000 N   0  0  0  0  0  0  0  0  0  0  0  0\n    4.1860    0.2980    0.0000 N   0  0  0  0  0  0  0  0  0  0  0  0\n  1  2  2  0  0  0  0\n  2  3  1  0  0  0  0\n  1  4  1  0  0  0  0\n  4  5  2  0  0  0  0\n  5  6  1  0  0  0  0\n  6  3  2  0  0  0  0\n  5  7  1  0  0  0  0\n  7  8  2  0  0  0  0\n  8  9  1  0  0  0  0\n  9  4  1  0  0  0  0\nM  APO  1   9   1\nM  END\n> <Name>\nBt\n\n$$$$\n\nMolEngine02241412152D\n\n  8  8  0  0  0  0            999 V2000\n    1.3510    0.0000    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    0.0000    0.7800    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    0.0000    2.3400    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    2.7020    0.7800    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    2.7020    2.3400    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    1.3510    3.1200    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    4.0530    3.1200    0.0000 S   0  0  0  0  0  0  0  0  0  0  0  0\n    5.4040    2.3400    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n  1  2  1  0  0  0  0\n  2  3  2  0  0  0  0\n  1  4  2  0  0  0  0\n  4  5  1  0  0  0  0\n  5  6  2  0  0  0  0\n  6  3  1  0  0  0  0\n  5  7  1  0  0  0  0\n  7  8  1  0  0  0  0\nM  APO  1   8   1\nM  END\n> <Name>\nBtm\n\n$$$$\n\nMolEngine02241412152D\n\n  4  3  0  0  0  0            999 V2000\n    0.0000    0.0000    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    1.3510    0.7800    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    2.7020    0.0000    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    4.0530    0.7800    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n  1  2  1  0  0  0  0\n  2  3  1  0  0  0  0\n  3  4  1  0  0  0  0\nM  APO  1   4   1\nM  END\n> <Name>\nBu,n-Bu,nBu\n\n$$$$\n\nMolEngine02241412152D\n\n  9  9  0  0  0  0            999 V2000\n    5.4040    0.0000    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    4.0530    0.7800    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    4.0530    2.3400    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    6.7550    0.7800    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    6.7550    2.3400    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    5.4040    3.1200    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    2.7020    0.0000    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    1.3510    0.7800    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n    0.0000    0.0000    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n  1  2  1  0  0  0  0\n  2  3  2  0  0  0  0\n  1  4  2  0  0  0  0\n  4  5  1  0  0  0  0\n  5  6  2  0  0  0  0\n  6  3  1  0  0  0  0\n  2  7  1  0  0  0  0\n  7  8  1  0  0  0  0\n  8  9  1  0  0  0  0\nM  APO  1   9   1\nM  END\n> <Name>\nBzOM,BOM\n\n$$$$\n\nMolEngine02241412152D\n\n 13 14  0  0  0  0            999 V2000\n    4.0530    0.0000    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    5.4040    0.7800    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    2.7020    0.7800    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    5.4040    2.3400    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    6.7550    3.1200    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    6.7550    0.0000    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    8.1060    0.7800    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    8.1060    2.3400    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    1.3510    0.0000    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    0.0000    0.7800    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    2.7020    2.3400    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    1.3510    3.1200    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    0.0000    2.3400    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n  1  2  1  0  0  0  0\n  1  3  1  0  0  0  0\n  2  4  1  0  0  0  0\n  4  5  2  0  0  0  0\n  2  6  2  0  0  0  0\n  6  7  1  0  0  0  0\n  7  8  2  0  0  0  0\n  8  5  1  0  0  0  0\n  3  9  2  0  0  0  0\n  9 10  1  0  0  0  0\n  3 11  1  0  0  0  0\n 11 12  2  0  0  0  0\n 12 13  1  0  0  0  0\n 13 10  2  0  0  0  0\nM  APO  1   1   1\nM  END\n> <Name>\nBzh\n\n$$$$\n\nMolEngine02241412152D\n\n 10 10  0  0  0  0            999 V2000\n    1.3510    0.0000    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    0.0000    0.7800    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    0.0000    2.3400    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    2.7020    0.7800    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    2.7020    2.3400    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    1.3510    3.1200    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    4.0530    3.1200    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    5.4040    2.3400    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n    6.7550    3.1200    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    6.7550    4.6800    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n  1  2  1  0  0  0  0\n  2  3  2  0  0  0  0\n  1  4  2  0  0  0  0\n  4  5  1  0  0  0  0\n  5  6  2  0  0  0  0\n  6  3  1  0  0  0  0\n  5  7  1  0  0  0  0\n  7  8  1  0  0  0  0\n  8  9  1  0  0  0  0\n  9 10  2  0  0  0  0\nM  APO  1   9   1\nM  END\n> <Name>\nCbz\n\n$$$$\n\nMolEngine02241412152D\n\n  7  6  0  0  0  0            999 V2000\n    5.4040    0.7800    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    4.0530    0.0000    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    2.7020    0.7800    0.0000 N   0  0  0  0  0  0  0  0  0  0  0  0\n    1.3510    0.0000    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    0.0000    0.7800    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    2.7020    2.3400    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    4.0530    3.1200    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n  1  2  1  0  0  0  0\n  2  3  1  0  0  0  0\n  3  4  1  0  0  0  0\n  4  5  1  0  0  0  0\n  3  6  1  0  0  0  0\n  6  7  1  0  0  0  0\nM  APO  1   1   1\nM  END\n> <Name>\nDEAE\n\n$$$$\n\nMolEngine02241412152D\n\n  8  7  0  0  0  0            999 V2000\n    2.7020    3.9000    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    2.7020    2.3400    0.0000 Si  0  0  0  0  0  0  0  0  0  0  0  0\n    1.3510    1.5600    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    4.0530    1.5600    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    0.0000    2.3400    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    4.0530    0.0000    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    4.0530    4.6800    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    1.3510    4.6800    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n  1  2  1  0  0  0  0\n  2  3  1  0  0  0  0\n  2  4  1  0  0  0  0\n  3  5  1  0  0  0  0\n  4  6  1  0  0  0  0\n  1  7  1  0  0  0  0\n  1  8  1  0  0  0  0\nM  APO  1   2   1\nM  END\n> <Name>\nDEIPS\n\n$$$$\n\nMolEngine02241412152D\n\n  6  5  0  0  0  0            999 V2000\n    1.3510    0.7800    0.0000 Si  0  0  0  0  0  0  0  0  0  0  0  0\n    1.3510    2.3400    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    0.0000    0.0000    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    2.7020    0.0000    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    2.7020    3.1200    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    0.0000    3.1200    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n  1  2  1  0  0  0  0\n  1  3  1  0  0  0  0\n  1  4  1  0  0  0  0\n  2  5  1  0  0  0  0\n  2  6  1  0  0  0  0\nM  APO  1   1   1\nM  END\n> <Name>\nDMIPS\n\n$$$$\n\nMolEngine02241412152D\n\n 11 11  0  0  0  0            999 V2000\n    4.0530    2.3400    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    2.7020    3.1200    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    2.7020    4.6800    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    5.4040    3.1200    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    5.4040    4.6800    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    4.0530    5.4600    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    4.0530    0.7800    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n    1.3510    2.3400    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n    0.0000    3.1200    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    2.7020    0.0000    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    6.7550    5.4600    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n  1  2  1  0  0  0  0\n  2  3  2  0  0  0  0\n  1  4  2  0  0  0  0\n  4  5  1  0  0  0  0\n  5  6  2  0  0  0  0\n  6  3  1  0  0  0  0\n  1  7  1  0  0  0  0\n  2  8  1  0  0  0  0\n  8  9  1  0  0  0  0\n  7 10  1  0  0  0  0\n  5 11  1  0  0  0  0\nM  APO  1  11   1\nM  END\n> <Name>\nDMPM\n\n$$$$\n\nMolEngine02241412152D\n\n  9  9  0  0  0  0            999 V2000\n    1.3510    1.5600    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    0.0000    2.3400    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    0.0000    3.9000    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    2.7020    2.3400    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    2.7020    3.9000    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    1.3510    4.6800    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    4.0530    1.5600    0.0000 Si  0  0  0  0  0  0  0  0  0  0  0  0\n    4.0530    0.0000    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    5.4040    2.3400    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n  1  2  2  0  0  0  0\n  2  3  1  0  0  0  0\n  1  4  1  0  0  0  0\n  4  5  2  0  0  0  0\n  5  6  1  0  0  0  0\n  6  3  2  0  0  0  0\n  4  7  1  0  0  0  0\n  7  8  1  0  0  0  0\n  7  9  1  0  0  0  0\nM  APO  1   7   1\nM  END\n> <Name>\nDMPS\n\n$$$$\n\nMolEngine02241412152D\n\n 23 25  0  0  0  0            999 V2000\n    4.0530    4.6800    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    5.4040    5.4600    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    2.7020    5.4600    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    4.0530    3.1200    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    5.4040    7.0200    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    6.7550    7.8000    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    6.7550    4.6800    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    8.1060    5.4600    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    8.1060    7.0200    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    1.3510    4.6800    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    0.0000    5.4600    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    2.7020    7.0200    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    1.3510    7.8000    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    0.0000    7.0200    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    5.4040    2.3400    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    5.4040    0.7800    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    2.7020    2.3400    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    2.7020    0.7800    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    4.0530    0.0000    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    9.4570    7.8000    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n   10.8080    7.0200    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    1.3510    9.3600    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n    2.7020   10.1400    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n  1  2  1  0  0  0  0\n  1  3  1  0  0  0  0\n  1  4  1  0  0  0  0\n  2  5  1  0  0  0  0\n  5  6  2  0  0  0  0\n  2  7  2  0  0  0  0\n  7  8  1  0  0  0  0\n  8  9  2  0  0  0  0\n  9  6  1  0  0  0  0\n  3 10  1  0  0  0  0\n 10 11  2  0  0  0  0\n  3 12  2  0  0  0  0\n 12 13  1  0  0  0  0\n 13 14  2  0  0  0  0\n 14 11  1  0  0  0  0\n  4 15  1  0  0  0  0\n 15 16  2  0  0  0  0\n  4 17  2  0  0  0  0\n 17 18  1  0  0  0  0\n 18 19  2  0  0  0  0\n 19 16  1  0  0  0  0\n  9 20  1  0  0  0  0\n 20 21  1  0  0  0  0\n 13 22  1  0  0  0  0\n 22 23  1  0  0  0  0\nM  APO  1   1   1\nM  END\n> <Name>\nDMTr\n\n$$$$\n\nMolEngine02241412152D\n\n 12 12  0  0  0  0            999 V2000\n    4.0530    0.0000    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    2.7020    0.7800    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    2.7020    2.3400    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    5.4040    0.7800    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    5.4040    2.3400    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    4.0530    3.1200    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    6.7550    3.1200    0.0000 N   0  3  0  0  0  0  0  0  0  0  0  0\n    1.3510    3.1200    0.0000 N   0  3  0  0  0  0  0  0  0  0  0  0\n    1.3510    4.6800    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n    0.0000    2.3400    0.0000 O   0  5  0  0  0  0  0  0  0  0  0  0\n    8.1060    2.3400    0.0000 O   0  5  0  0  0  0  0  0  0  0  0  0\n    6.7550    4.6800    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n  1  2  1  0  0  0  0\n  2  3  2  0  0  0  0\n  1  4  2  0  0  0  0\n  4  5  1  0  0  0  0\n  5  6  2  0  0  0  0\n  6  3  1  0  0  0  0\n  5  7  1  0  0  0  0\n  3  8  1  0  0  0  0\n  8  9  2  0  0  0  0\n  8 10  1  0  0  0  0\n  7 11  1  0  0  0  0\n  7 12  2  0  0  0  0\nM  CHG  1   7   1\nM  CHG  1   8   1\nM  CHG  1  10  -1\nM  CHG  1  11  -1\nM  APO  1   6   1\nM  END\n> <Name>\nDNP\n\n$$$$\n\nMolEngine02241412152D\n\n 16 17  0  0  0  0            999 V2000\n    1.3510    2.3400    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    0.0000    3.1200    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    0.0000    4.6800    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    2.7020    3.1200    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    2.7020    4.6800    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    1.3510    5.4600    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    4.0530    2.3400    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    5.4040    3.1200    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    5.4040    4.6800    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    4.0530    5.4600    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    1.3510    0.7800    0.0000 N   0  0  0  0  0  0  0  0  0  0  0  0\n    0.0000    0.0000    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    2.7020    0.0000    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    4.0530    7.0200    0.0000 S   0  0  0  0  0  0  0  0  0  0  0  0\n    5.4040    7.8000    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n    2.7020    7.8000    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n  1  2  2  0  0  0  0\n  2  3  1  0  0  0  0\n  1  4  1  0  0  0  0\n  4  5  1  0  0  0  0\n  5  6  1  0  0  0  0\n  6  3  2  0  0  0  0\n  7  4  2  0  0  0  0\n  7  8  1  0  0  0  0\n  8  9  2  0  0  0  0\n  9 10  1  0  0  0  0\n 10  5  2  0  0  0  0\n  1 11  1  0  0  0  0\n 11 12  1  0  0  0  0\n 11 13  1  0  0  0  0\n 10 14  1  0  0  0  0\n 14 15  2  0  0  0  0\n 14 16  2  0  0  0  0\nM  APO  1  14   1\nM  END\n> <Name>\nDNS\n\n$$$$\n\nMolEngine02241412152D\n\n 17 18  0  0  0  0            999 V2000\n    4.0530    4.6800    0.0000 Si  0  0  0  0  0  0  0  0  0  0  0  0\n    5.4040    5.4600    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n    2.7020    5.4600    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    4.0530    3.1200    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    1.3510    4.6800    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    0.0000    5.4600    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    2.7020    7.0200    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    1.3510    7.8000    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    0.0000    7.0200    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    5.4040    2.3400    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    5.4040    0.7800    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    2.7020    2.3400    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    2.7020    0.7800    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    4.0530    0.0000    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    5.4040    7.0200    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    6.7550    7.8000    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    4.0530    7.8000    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n  1  2  1  0  0  0  0\n  1  3  1  0  0  0  0\n  1  4  1  0  0  0  0\n  3  5  1  0  0  0  0\n  5  6  2  0  0  0  0\n  3  7  2  0  0  0  0\n  7  8  1  0  0  0  0\n  8  9  2  0  0  0  0\n  9  6  1  0  0  0  0\n  4 10  1  0  0  0  0\n 10 11  2  0  0  0  0\n  4 12  2  0  0  0  0\n 12 13  1  0  0  0  0\n 13 14  2  0  0  0  0\n 14 11  1  0  0  0  0\n  2 15  1  0  0  0  0\n 15 16  1  0  0  0  0\n 15 17  1  0  0  0  0\nM  APO  1   1   1\nM  END\n> <Name>\nDPIPS\n\n$$$$\n\nMolEngine02241412152D\n\n 18 19  0  0  0  0            999 V2000\n    4.0520    4.6800    0.0000 Si  0  0  0  0  0  0  0  0  0  0  0  0\n    5.4030    5.4600    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n    2.7020    5.4600    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    4.0520    3.1200    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    1.3510    4.6800    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    0.0000    5.4600    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    2.7020    7.0200    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    1.3510    7.8000    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    0.0000    7.0200    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    5.4030    2.3400    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    5.4030    0.7800    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    2.7020    2.3400    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    2.7020    0.7800    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    4.0520    0.0000    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    5.4030    7.0200    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    6.7540    7.8000    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    4.0520    7.8000    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    5.4030    8.5800    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n  1  2  1  0  0  0  0\n  1  3  1  0  0  0  0\n  1  4  1  0  0  0  0\n  3  5  1  0  0  0  0\n  5  6  2  0  0  0  0\n  3  7  2  0  0  0  0\n  7  8  1  0  0  0  0\n  8  9  2  0  0  0  0\n  9  6  1  0  0  0  0\n  4 10  1  0  0  0  0\n 10 11  2  0  0  0  0\n  4 12  2  0  0  0  0\n 12 13  1  0  0  0  0\n 13 14  2  0  0  0  0\n 14 11  1  0  0  0  0\n  2 15  1  0  0  0  0\n 15 16  1  0  0  0  0\n 15 17  1  0  0  0  0\n 15 18  1  0  0  0  0\nM  APO  1   1   1\nM  END\n> <Name>\nDPTBS\n\n$$$$\n\nMolEngine02241412152D\n\n 10  9  0  0  0  0            999 V2000\n    2.7010    3.1200    0.0000 Si  0  0  0  0  0  0  0  0  0  0  0  0\n    4.0520    3.9000    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    1.3510    3.9000    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    2.7010    1.5600    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    0.0000    3.1200    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    1.3510    5.4590    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    0.0000    4.6800    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    1.3500    0.7800    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    4.0520    0.7800    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    2.7010    0.0000    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n  1  2  1  0  0  0  0\n  1  3  1  0  0  0  0\n  1  4  1  0  0  0  0\n  3  5  1  0  0  0  0\n  3  6  1  0  0  0  0\n  3  7  1  0  0  0  0\n  4  8  1  0  0  0  0\n  4  9  1  0  0  0  0\n  4 10  1  0  0  0  0\nM  APO  1   1   1\nM  END\n> <Name>\nDTBMS\n\n$$$$\n\nMolEngine02241412152D\n\n 16 17  0  0  0  0            999 V2000\n    1.3510    2.3400    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    0.0000    3.1200    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    0.0000    4.6800    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    2.7020    3.1200    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    2.7020    4.6800    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    1.3510    5.4600    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    4.0530    2.3400    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    5.4040    3.1200    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    5.4040    4.6800    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    4.0530    5.4600    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    1.3510    0.7800    0.0000 N   0  0  0  0  0  0  0  0  0  0  0  0\n    0.0000    0.0000    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    2.7020    0.0000    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    4.0530    7.0200    0.0000 S   0  0  0  0  0  0  0  0  0  0  0  0\n    5.4040    7.8000    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n    2.7020    7.8000    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n  1  2  2  0  0  0  0\n  2  3  1  0  0  0  0\n  1  4  1  0  0  0  0\n  4  5  1  0  0  0  0\n  5  6  1  0  0  0  0\n  6  3  2  0  0  0  0\n  7  4  2  0  0  0  0\n  7  8  1  0  0  0  0\n  8  9  2  0  0  0  0\n  9 10  1  0  0  0  0\n 10  5  2  0  0  0  0\n  1 11  1  0  0  0  0\n 11 12  1  0  0  0  0\n 11 13  1  0  0  0  0\n 10 14  1  0  0  0  0\n 14 15  2  0  0  0  0\n 14 16  2  0  0  0  0\nM  APO  1  14   1\nM  END\n> <Name>\nDan\n\n$$$$\n\nMolEngine02241412152D\n\n  2  1  0  0  0  0            999 V2000\n    0.0000    0.0000    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    1.3510    0.7800    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n  1  2  1  0  0  0  0\nM  APO  1   2   1\nM  END\n> <Name>\nEt,C2H5\n\n$$$$\n\nMolEngine02241412152D\n\n 17 19  0  0  0  0            999 V2000\n    3.0510    1.1590    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    4.6110    1.1590    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    5.0930    2.6430    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    3.8310    3.5590    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    2.5690    2.6420    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    1.0430    2.9670    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    0.0000    1.8070    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    0.4820    0.3240    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    2.0080    0.0000    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    5.6550    0.0000    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    7.1810    0.3240    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    7.6630    1.8080    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    6.6190    2.9670    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    3.8310    5.1190    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    5.1820    5.9000    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n    5.1820    7.4600    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    6.5330    8.2400    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n  1  2  1  0  0  0  0\n  2  3  1  0  0  0  0\n  3  4  1  0  0  0  0\n  4  5  1  0  0  0  0\n  5  1  1  0  0  0  0\n  6  5  2  0  0  0  0\n  6  7  1  0  0  0  0\n  7  8  2  0  0  0  0\n  8  9  1  0  0  0  0\n  9  1  2  0  0  0  0\n 10  2  2  0  0  0  0\n 10 11  1  0  0  0  0\n 11 12  2  0  0  0  0\n 12 13  1  0  0  0  0\n 13  3  2  0  0  0  0\n  4 14  1  0  0  0  0\n 14 15  1  0  0  0  0\n 15 16  1  0  0  0  0\n 16 17  2  0  0  0  0\nM  APO  1  16   1\nM  END\n> <Name>\nFmoc\n\n$$$$\n\nMolEngine02241412152D\n\n  5  5  0  0  0  0            999 V2000\n    0.0000    0.4819    0.0000 N   0  0  0  0  0  0  0  0  0  0  0  0\n    1.4837    0.0000    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    2.4005    1.2618    0.0000 N   0  0  0  0  0  0  0  0  0  0  0  0\n    1.4837    2.5235    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    0.0000    2.0416    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n  1  2  1  0  0  0  0\n  2  3  2  0  0  0  0\n  3  4  1  0  0  0  0\n  4  5  2  0  0  0  0\n  5  1  1  0  0  0  0\nM  APO  1   3   1\nM  END\n> <Name>\nIm\n\n$$$$\n\nMolEngine02241412152D\n\n  8  7  0  0  0  0            999 V2000\n    1.3510    2.3400    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    2.7020    1.5600    0.0000 Si  0  0  0  0  0  0  0  0  0  0  0  0\n    4.0530    2.3400    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    2.7020    0.0000    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    1.3510    3.9000    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    0.0000    1.5600    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    5.4040    1.5600    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    4.0530    3.9000    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n  1  2  1  0  0  0  0\n  2  3  1  0  0  0  0\n  2  4  1  0  0  0  0\n  1  5  1  0  0  0  0\n  1  6  1  0  0  0  0\n  3  7  1  0  0  0  0\n  3  8  1  0  0  0  0\nM  APO  1   2   1\nM  END\n> <Name>\nMDIPS\n\n$$$$\n\nMolEngine02241412152D\n\n 14 15  0  0  0  0            999 V2000\n    4.0530    4.6800    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    5.4040    5.4600    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    2.7020    5.4600    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    4.0530    3.1200    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    5.4040    2.3400    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    5.4040    0.7800    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    2.7020    2.3400    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    2.7020    0.7800    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    4.0530    0.0000    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    1.3510    4.6800    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    0.0000    5.4600    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    2.7020    7.0200    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    1.3510    7.8000    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    0.0000    7.0200    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n  1  2  1  0  0  0  0\n  1  3  1  0  0  0  0\n  1  4  1  0  0  0  0\n  4  5  1  0  0  0  0\n  5  6  2  0  0  0  0\n  4  7  2  0  0  0  0\n  7  8  1  0  0  0  0\n  8  9  2  0  0  0  0\n  9  6  1  0  0  0  0\n  3 10  2  0  0  0  0\n 10 11  1  0  0  0  0\n  3 12  1  0  0  0  0\n 12 13  2  0  0  0  0\n 13 14  1  0  0  0  0\n 14 11  2  0  0  0  0\nM  APO  1   1   1\nM  END\n> <Name>\nMDPS\n\n$$$$\n\nMolEngine02241412152D\n\n  6  5  0  0  0  0            999 V2000\n    0.0000    0.7800    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    1.3510    0.0000    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n    2.7020    0.7800    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    4.0530    0.0000    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    5.4040    0.7800    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n    6.7550    0.0000    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n  1  2  1  0  0  0  0\n  2  3  1  0  0  0  0\n  3  4  1  0  0  0  0\n  4  5  1  0  0  0  0\n  5  6  1  0  0  0  0\nM  APO  1   1   1\nM  END\n> <Name>\nMEM\n\n$$$$\n\nMolEngine02241412152D\n\n 21 23  0  0  0  0            999 V2000\n    6.7550    4.6800    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    5.4040    5.4600    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    5.4040    7.0200    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    8.1060    5.4600    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    8.1060    7.0200    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    6.7550    7.8000    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    6.7550    3.1200    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    5.4040    2.3400    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    8.1060    2.3400    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    5.4040    0.7800    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    4.0530    0.0000    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    4.0530    3.1200    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    2.7020    2.3400    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    2.7020    0.7800    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    9.4570    3.1200    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n   10.8080    2.3400    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    8.1060    0.7800    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    9.4570    0.0000    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n   10.8080    0.7800    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    1.3510    0.0000    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n    0.0000    0.7800    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n  1  2  1  0  0  0  0\n  2  3  2  0  0  0  0\n  1  4  2  0  0  0  0\n  4  5  1  0  0  0  0\n  5  6  2  0  0  0  0\n  6  3  1  0  0  0  0\n  1  7  1  0  0  0  0\n  7  8  1  0  0  0  0\n  7  9  1  0  0  0  0\n  8 10  2  0  0  0  0\n 10 11  1  0  0  0  0\n  8 12  1  0  0  0  0\n 12 13  2  0  0  0  0\n 13 14  1  0  0  0  0\n 14 11  2  0  0  0  0\n  9 15  1  0  0  0  0\n 15 16  2  0  0  0  0\n  9 17  2  0  0  0  0\n 17 18  1  0  0  0  0\n 18 19  2  0  0  0  0\n 19 16  1  0  0  0  0\n 14 20  1  0  0  0  0\n 20 21  1  0  0  0  0\nM  APO  1   7   1\nM  END\n> <Name>\nMMTr\n\n$$$$\n\nMolEngine02241412152D\n\n  3  2  0  0  0  0            999 V2000\n    0.0000    0.0000    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    1.3510    0.7800    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n    2.7020    0.0000    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n  1  2  1  0  0  0  0\n  2  3  1  0  0  0  0\nM  APO  1   1   1\nM  END\n> <Name>\nMOM\n\n$$$$\n\nMolEngine02241412152D\n\n  9  9  0  0  0  0            999 V2000\n    4.0530    0.0000    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    2.7020    0.7800    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    2.7020    2.3400    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    5.4040    0.7800    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    5.4040    2.3400    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    4.0530    3.1200    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    6.7550    3.1200    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    1.3510    0.0000    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n    0.0000    0.7800    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n  1  2  1  0  0  0  0\n  2  3  2  0  0  0  0\n  1  4  2  0  0  0  0\n  4  5  1  0  0  0  0\n  5  6  2  0  0  0  0\n  6  3  1  0  0  0  0\n  5  7  1  0  0  0  0\n  2  8  1  0  0  0  0\n  8  9  1  0  0  0  0\nM  APO  1   7   1\nM  END\n> <Name>\nMPM\n\n$$$$\n\nMolEngine02241412152D\n\n  3  2  0  0  0  0            999 V2000\n    0.0000    0.0000    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    1.3510    0.7800    0.0000 S   0  0  0  0  0  0  0  0  0  0  0  0\n    2.7020    0.0000    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n  1  2  1  0  0  0  0\n  2  3  1  0  0  0  0\nM  APO  1   3   1\nM  END\n> <Name>\nMTM\n\n$$$$\n\nMolEngine02241412152D\n\n  1  0  0  0  0  0            999 V2000\n    0.0000    0.0000    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\nM  APO  1   1   1\nM  END\n> <Name>\nMe,@CH3\n\n$$$$\n\nMolEngine02241412152D\n\n  9  9  0  0  0  0            999 V2000\n    2.7020    0.0000    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    1.3510    0.7800    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    1.3510    2.3400    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    4.0530    0.7800    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    4.0530    2.3400    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    2.7020    3.1200    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    2.7020    4.6800    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    5.4040    0.0000    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    0.0000    0.0000    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n  1  2  1  0  0  0  0\n  2  3  2  0  0  0  0\n  1  4  2  0  0  0  0\n  4  5  1  0  0  0  0\n  5  6  2  0  0  0  0\n  6  3  1  0  0  0  0\n  6  7  1  0  0  0  0\n  4  8  1  0  0  0  0\n  2  9  1  0  0  0  0\nM  APO  1   5   1\nM  END\n> <Name>\nMes\n\n$$$$\n\nMolEngine02241412152D\n\n  4  3  0  0  0  0            999 V2000\n    1.3510    1.5600    0.0000 S   0  0  0  0  0  0  0  0  0  0  0  0\n    2.7020    2.3400    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    0.0000    2.3400    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n    1.3510    0.0000    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n  1  2  1  0  0  0  0\n  1  3  2  0  0  0  0\n  1  4  2  0  0  0  0\nM  APO  1   1   1\nM  END\n> <Name>\nMs\n\n$$$$\n\nMolEngine02241412152D\n\n  3  2  0  0  0  0            999 V2000\n    0.0000    0.0000    0.0000 N   0  0  0  0  0  0  0  0  0  0  0  0\n    1.5600    0.0000    0.0000 N   0  3  0  0  0  0  0  0  0  0  0  0\n    3.1200    0.0000    0.0000 N   0  5  0  0  0  0  0  0  0  0  0  0\n  1  2  2  0  0  0  0\n  2  3  2  0  0  0  0\nM  CHG  1   2   1\nM  CHG  1   3  -1\nM  APO  1   1   1\nM  END\n> <Name>\nN3\n\n$$$$\n\nMolEngine02241412152D\n\n  9  9  0  0  0  0            999 V2000\n    4.0530    0.0000    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    2.7020    0.7800    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    2.7020    2.3400    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    5.4040    0.7800    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    5.4040    2.3400    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    4.0530    3.1200    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    1.3510    3.1200    0.0000 N   0  3  0  0  0  0  0  0  0  0  0  0\n    1.3510    4.6800    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n    0.0000    2.3400    0.0000 O   0  5  0  0  0  0  0  0  0  0  0  0\n  1  2  2  0  0  0  0\n  2  3  1  0  0  0  0\n  1  4  1  0  0  0  0\n  4  5  2  0  0  0  0\n  5  6  1  0  0  0  0\n  6  3  2  0  0  0  0\n  3  7  1  0  0  0  0\n  7  8  2  0  0  0  0\n  7  9  1  0  0  0  0\nM  CHG  1   7   1\nM  CHG  1   9  -1\nM  APO  1   4   1\nM  END\n> <Name>\nNp\n\n$$$$\n\nMolEngine02241412152D\n\n  9  9  0  0  0  0            999 V2000\n    4.0530    0.0000    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    2.7020    0.7800    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    2.7020    2.3400    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    5.4040    0.7800    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    5.4040    2.3400    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    4.0530    3.1200    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    1.3510    0.0000    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n    0.0000    0.7800    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    6.7550    3.1200    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n  1  2  1  0  0  0  0\n  2  3  2  0  0  0  0\n  1  4  2  0  0  0  0\n  4  5  1  0  0  0  0\n  5  6  2  0  0  0  0\n  6  3  1  0  0  0  0\n  2  7  1  0  0  0  0\n  7  8  1  0  0  0  0\n  5  9  1  0  0  0  0\nM  APO  1   9   1\nM  END\n> <Name>\nPMB\n\n$$$$\n\nMolEngine02241412152D\n\n 11 11  0  0  0  0            999 V2000\n    4.0520    0.0000    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    2.7020    0.7800    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    2.7020    2.3400    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    5.4030    0.7800    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    5.4030    2.3400    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    4.0520    3.1200    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    1.3510    0.0000    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n    0.0000    0.7800    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    6.7540    3.1200    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    8.1050    2.3400    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n    9.4560    3.1200    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n  1  2  1  0  0  0  0\n  2  3  2  0  0  0  0\n  1  4  2  0  0  0  0\n  4  5  1  0  0  0  0\n  5  6  2  0  0  0  0\n  6  3  1  0  0  0  0\n  2  7  1  0  0  0  0\n  7  8  1  0  0  0  0\n  5  9  1  0  0  0  0\n  9 10  1  0  0  0  0\n 10 11  1  0  0  0  0\nM  APO  1  11   1\nM  END\n> <Name>\nPMBM\n\n$$$$\n\nMolEngine02241412152D\n\n 11 11  0  0  0  0            999 V2000\n    4.0530    0.0000    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    2.7020    0.7800    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    2.7020    2.3400    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    5.4040    0.7800    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    5.4040    2.3400    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    4.0530    3.1200    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    6.7550    3.1200    0.0000 N   0  3  0  0  0  0  0  0  0  0  0  0\n    1.3510    0.0000    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    8.1060    2.3400    0.0000 O   0  5  0  0  0  0  0  0  0  0  0  0\n    6.7550    4.6800    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n    0.0000    0.7800    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n  1  2  1  0  0  0  0\n  2  3  2  0  0  0  0\n  1  4  2  0  0  0  0\n  4  5  1  0  0  0  0\n  5  6  2  0  0  0  0\n  6  3  1  0  0  0  0\n  5  7  1  0  0  0  0\n  2  8  1  0  0  0  0\n  7  9  1  0  0  0  0\n  7 10  2  0  0  0  0\n  8 11  2  0  0  0  0\nM  CHG  1   7   1\nM  CHG  1   9  -1\nM  APO  1   8   1\nM  END\n> <Name>\nPNB\n\n$$$$\n\nMolEngine02241412152D\n\n  6  6  0  0  0  0            999 V2000\n    1.3510    0.0000    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    0.0000    0.7800    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    0.0000    2.3400    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    2.7020    0.7800    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    2.7020    2.3400    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    1.3510    3.1200    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n  1  2  2  0  0  0  0\n  2  3  1  0  0  0  0\n  1  4  1  0  0  0  0\n  4  5  2  0  0  0  0\n  5  6  1  0  0  0  0\n  6  3  2  0  0  0  0\nM  APO  1   6   1\nM  END\n> <Name>\nPh,Phenyl\n\n$$$$\n\nMolEngine02241412152D\n\n  6  5  0  0  0  0            999 V2000\n    1.3510    1.3510    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    2.7020    2.1310    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    2.7020    3.6910    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n    0.5710    2.7020    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    2.1310    0.0000    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    0.0000    0.5710    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n  1  2  1  0  0  0  0\n  2  3  2  0  0  0  0\n  1  4  1  0  0  0  0\n  1  5  1  0  0  0  0\n  1  6  1  0  0  0  0\nM  APO  1   2   1\nM  END\n> <Name>\nPiv,Pv\n\n$$$$\n\nMolEngine02241412152D\n\n  8  8  0  0  0  0            999 V2000\n    0.0000    1.9220    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    1.4840    1.4400    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    2.4010    2.7020    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    1.4840    3.9640    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    0.0000    3.4820    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    3.9610    2.7020    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n    4.7410    1.3510    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    3.9610    0.0000    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n  1  2  1  0  0  0  0\n  2  3  1  0  0  0  0\n  3  4  1  0  0  0  0\n  4  5  1  0  0  0  0\n  5  1  1  0  0  0  0\n  3  6  1  0  0  0  0\n  6  7  1  0  0  0  0\n  7  8  2  0  0  0  0\nM  APO  1   7   1\nM  END\n> <Name>\nPoc\n\n$$$$\n\nMolEngine02241412152D\n\n  8  7  0  0  0  0            999 V2000\n    1.3510    1.5600    0.0000 Si  0  0  0  0  0  0  0  0  0  0  0  0\n    2.7020    2.3400    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    0.0000    2.3400    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    1.3510    0.0000    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    0.0000    0.7800    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    4.0530    1.5600    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    5.4040    2.3400    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n    6.7550    1.5600    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n  1  2  1  0  0  0  0\n  1  3  1  0  0  0  0\n  1  4  1  0  0  0  0\n  1  5  1  0  0  0  0\n  2  6  1  0  0  0  0\n  6  7  1  0  0  0  0\n  7  8  1  0  0  0  0\nM  APO  1   8   1\nM  END\n> <Name>\nSEM\n\n$$$$\n\nMolEngine02241412152D\n\n  9  8  0  0  0  0            999 V2000\n    1.3510    1.5600    0.0000 Si  0  0  0  0  0  0  0  0  0  0  0  0\n    2.7020    2.3400    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    0.0000    2.3400    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    1.3510    0.0000    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    0.0000    0.7800    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    4.0520    1.5600    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    5.4030    2.3400    0.0000 S   0  0  0  0  0  0  0  0  0  0  0  0\n    6.7540    1.5600    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n    5.4030    3.9000    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n  1  2  1  0  0  0  0\n  1  3  1  0  0  0  0\n  1  4  1  0  0  0  0\n  1  5  1  0  0  0  0\n  2  6  1  0  0  0  0\n  6  7  1  0  0  0  0\n  7  8  2  0  0  0  0\n  7  9  2  0  0  0  0\nM  APO  1   7   1\nM  END\n> <Name>\nSES\n\n$$$$\n\nMolEngine02241412152D\n\n  7  6  0  0  0  0            999 V2000\n    0.0000    0.0000    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    1.3510    0.7800    0.0000 Si  0  0  0  0  0  0  0  0  0  0  0  0\n    2.7020    0.0000    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    1.3510    2.3400    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    2.7020    3.1200    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    0.0000    3.1200    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    1.3510    3.9000    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n  1  2  1  0  0  0  0\n  2  3  1  0  0  0  0\n  2  4  1  0  0  0  0\n  4  5  1  0  0  0  0\n  4  6  1  0  0  0  0\n  4  7  1  0  0  0  0\nM  APO  1   2   1\nM  END\n> <Name>\nTBDMS,TBS\n\n$$$$\n\nMolEngine02241412152D\n\n 14 14  0  0  0  0            999 V2000\n    4.0520    4.6800    0.0000 Si  0  0  0  0  0  0  0  0  0  0  0  0\n    5.4030    5.4600    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    2.7020    5.4600    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    4.0520    3.1200    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    6.7540    4.6800    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    5.4030    7.0200    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    6.7540    6.2400    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    1.3510    4.6800    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n    0.0000    5.4600    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    5.4030    2.3400    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    5.4030    0.7800    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    2.7020    2.3400    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    2.7020    0.7800    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    4.0520    0.0000    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n  1  2  1  0  0  0  0\n  1  3  1  0  0  0  0\n  1  4  1  0  0  0  0\n  2  5  1  0  0  0  0\n  2  6  1  0  0  0  0\n  2  7  1  0  0  0  0\n  3  8  1  0  0  0  0\n  8  9  1  0  0  0  0\n  4 10  2  0  0  0  0\n 10 11  1  0  0  0  0\n  4 12  1  0  0  0  0\n 12 13  2  0  0  0  0\n 13 14  1  0  0  0  0\n 14 11  2  0  0  0  0\nM  APO  1   1   1\nM  END\n> <Name>\nTBMPS\n\n$$$$\n\nMolEngine02241412152D\n\n 17 18  0  0  0  0            999 V2000\n    4.0530    4.6800    0.0000 Si  0  0  0  0  0  0  0  0  0  0  0  0\n    5.4040    5.4600    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    2.7020    5.4600    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    4.0530    3.1200    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    6.7550    4.6800    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    5.4040    7.0200    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    6.7550    6.2400    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    1.3510    4.6800    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    0.0000    5.4600    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    2.7020    7.0200    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    1.3510    7.8000    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    0.0000    7.0200    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    5.4040    2.3400    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    5.4040    0.7800    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    2.7020    2.3400    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    2.7020    0.7800    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    4.0530    0.0000    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n  1  2  1  0  0  0  0\n  1  3  1  0  0  0  0\n  1  4  1  0  0  0  0\n  2  5  1  0  0  0  0\n  2  6  1  0  0  0  0\n  2  7  1  0  0  0  0\n  3  8  1  0  0  0  0\n  8  9  2  0  0  0  0\n  3 10  2  0  0  0  0\n 10 11  1  0  0  0  0\n 11 12  2  0  0  0  0\n 12  9  1  0  0  0  0\n  4 13  2  0  0  0  0\n 13 14  1  0  0  0  0\n  4 15  1  0  0  0  0\n 15 16  2  0  0  0  0\n 16 17  1  0  0  0  0\n 17 14  2  0  0  0  0\nM  APO  1   1   1\nM  END\n> <Name>\nTDBPS\n\n$$$$\n\nMolEngine02241412152D\n\n  9  8  0  0  0  0            999 V2000\n    4.0530    1.5600    0.0000 Si  0  0  0  0  0  0  0  0  0  0  0  0\n    5.4040    2.3400    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    2.7020    2.3400    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    4.0530    0.0000    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    1.9220    0.9890    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    3.4820    3.6910    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    1.3510    3.1200    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    1.3510    4.6800    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    0.0000    2.3400    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n  1  2  1  0  0  0  0\n  1  3  1  0  0  0  0\n  1  4  1  0  0  0  0\n  3  5  1  0  0  0  0\n  3  6  1  0  0  0  0\n  3  7  1  0  0  0  0\n  7  8  1  0  0  0  0\n  7  9  1  0  0  0  0\nM  APO  1   1   1\nM  END\n> <Name>\nTDS\n\n$$$$\n\nMolEngine02241412152D\n\n  7  6  0  0  0  0            999 V2000\n    0.0000    1.5600    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n    1.3510    2.3400    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    1.3510    3.9000    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n    2.7020    1.5600    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    4.0530    2.3400    0.0000 F   0  0  0  0  0  0  0  0  0  0  0  0\n    2.7020    0.0000    0.0000 F   0  0  0  0  0  0  0  0  0  0  0  0\n    4.0530    0.7800    0.0000 F   0  0  0  0  0  0  0  0  0  0  0  0\n  1  2  1  0  0  0  0\n  2  3  2  0  0  0  0\n  2  4  1  0  0  0  0\n  4  5  1  0  0  0  0\n  4  6  1  0  0  0  0\n  4  7  1  0  0  0  0\nM  APO  1   1   1\nM  END\n> <Name>\nTFA\n\n$$$$\n\nMolEngine02241412152D\n\n  5  5  0  0  0  0            999 V2000\n    0.0000    0.4819    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    1.4837    0.0000    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    2.4005    1.2618    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    1.4837    2.5235    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n    0.0000    2.0416    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n  1  2  1  0  0  0  0\n  2  3  1  0  0  0  0\n  3  4  1  0  0  0  0\n  4  5  1  0  0  0  0\n  5  1  1  0  0  0  0\nM  APO  1   3   1\nM  END\n> <Name>\nTHF\n\n$$$$\n\nMolEngine02241412152D\n\n  6  6  0  0  0  0            999 V2000\n    1.3510    0.0000    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    0.0000    0.7800    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    0.0000    2.3400    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    1.3510    3.1200    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    2.7020    2.3400    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n    2.7020    0.7800    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n  1  2  1  0  0  0  0\n  2  3  1  0  0  0  0\n  3  4  1  0  0  0  0\n  4  5  1  0  0  0  0\n  5  6  1  0  0  0  0\n  6  1  1  0  0  0  0\nM  APO  1   6   1\nM  END\n> <Name>\nTHP\n\n$$$$\n\nMolEngine02241412152D\n\n 10  9  0  0  0  0            999 V2000\n    2.7020    2.3400    0.0000 Si  0  0  0  0  0  0  0  0  0  0  0  0\n    4.0530    3.1200    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    1.3510    3.1200    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    2.7020    0.7800    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    1.3510    4.6800    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    0.0000    2.3400    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    5.4040    2.3400    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    4.0530    4.6800    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    1.3510    0.0000    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    4.0530    0.0000    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n  1  2  1  0  0  0  0\n  1  3  1  0  0  0  0\n  1  4  1  0  0  0  0\n  3  5  1  0  0  0  0\n  3  6  1  0  0  0  0\n  2  7  1  0  0  0  0\n  2  8  1  0  0  0  0\n  4  9  1  0  0  0  0\n  4 10  1  0  0  0  0\nM  APO  1   1   1\nM  END\n> <Name>\nTIPS\n\n$$$$\n\nMolEngine02241412152D\n\n  4  3  0  0  0  0            999 V2000\n    1.3510    1.5600    0.0000 Si  0  0  0  0  0  0  0  0  0  0  0  0\n    2.7020    2.3400    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    0.0000    2.3400    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    1.3510    0.0000    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n  1  2  1  0  0  0  0\n  1  3  1  0  0  0  0\n  1  4  1  0  0  0  0\nM  APO  1   1   1\nM  END\n> <Name>\nTMS\n\n$$$$\n\nMolEngine02241412152D\n\n  7  6  0  0  0  0            999 V2000\n    1.3510    3.1200    0.0000 S   0  0  0  0  0  0  0  0  0  0  0  0\n    2.7020    3.9000    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n    0.0000    3.9000    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n    1.3510    1.5600    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    0.0000    0.7800    0.0000 F   0  0  0  0  0  0  0  0  0  0  0  0\n    2.7020    0.7800    0.0000 F   0  0  0  0  0  0  0  0  0  0  0  0\n    1.3510    0.0000    0.0000 F   0  0  0  0  0  0  0  0  0  0  0  0\n  1  2  2  0  0  0  0\n  1  3  2  0  0  0  0\n  1  4  1  0  0  0  0\n  4  5  1  0  0  0  0\n  4  6  1  0  0  0  0\n  4  7  1  0  0  0  0\nM  APO  1   1   1\nM  END\n> <Name>\nTf\n\n$$$$\n\nMolEngine02241412152D\n\n 10 10  0  0  0  0            999 V2000\n    2.7020    1.5600    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    1.3510    2.3400    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    1.3510    3.9000    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    4.0530    2.3400    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    4.0530    3.9000    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    2.7020    4.6800    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    0.0000    4.6800    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    5.4040    1.5600    0.0000 S   0  0  0  0  0  0  0  0  0  0  0  0\n    5.4040    0.0000    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n    6.7550    2.3400    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n  1  2  2  0  0  0  0\n  2  3  1  0  0  0  0\n  1  4  1  0  0  0  0\n  4  5  2  0  0  0  0\n  5  6  1  0  0  0  0\n  6  3  2  0  0  0  0\n  3  7  1  0  0  0  0\n  4  8  1  0  0  0  0\n  8  9  2  0  0  0  0\n  8 10  2  0  0  0  0\nM  APO  1   8   1\nM  END\n> <Name>\nTos,Ts\n\n$$$$\n\nMolEngine02241412152D\n\n  8  7  0  0  0  0            999 V2000\n    0.0000    2.3400    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    1.3510    1.5600    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n    0.0000    3.9000    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n    2.7020    2.3400    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    4.0530    1.5600    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    4.0530    0.0000    0.0000 Cl  0  0  0  0  0  0  0  0  0  0  0  0\n    5.4040    2.3400    0.0000 Cl  0  0  0  0  0  0  0  0  0  0  0  0\n    5.4040    0.7800    0.0000 Cl  0  0  0  0  0  0  0  0  0  0  0  0\n  1  2  1  0  0  0  0\n  1  3  2  0  0  0  0\n  2  4  1  0  0  0  0\n  4  5  1  0  0  0  0\n  5  6  1  0  0  0  0\n  5  7  1  0  0  0  0\n  5  8  1  0  0  0  0\nM  APO  1   1   1\nM  END\n> <Name>\nTroc\n\n$$$$\n\nMolEngine02241412152D\n\n 19 21  0  0  0  0            999 V2000\n    4.0530    4.6800    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    5.4040    5.4600    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    2.7020    5.4600    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    4.0530    3.1200    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    1.3510    4.6800    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    0.0000    5.4600    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    2.7020    7.0200    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    1.3510    7.8000    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    0.0000    7.0200    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    5.4040    7.0200    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    6.7550    7.8000    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    6.7550    4.6800    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    8.1060    5.4600    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    8.1060    7.0200    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    5.4040    2.3400    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    5.4040    0.7800    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    2.7020    2.3400    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    2.7020    0.7800    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    4.0530    0.0000    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n  1  2  1  0  0  0  0\n  1  3  1  0  0  0  0\n  1  4  1  0  0  0  0\n  3  5  1  0  0  0  0\n  5  6  2  0  0  0  0\n  3  7  2  0  0  0  0\n  7  8  1  0  0  0  0\n  8  9  2  0  0  0  0\n  9  6  1  0  0  0  0\n  2 10  1  0  0  0  0\n 10 11  2  0  0  0  0\n  2 12  2  0  0  0  0\n 12 13  1  0  0  0  0\n 13 14  2  0  0  0  0\n 14 11  1  0  0  0  0\n  4 15  2  0  0  0  0\n 15 16  1  0  0  0  0\n  4 17  1  0  0  0  0\n 17 18  2  0  0  0  0\n 18 19  1  0  0  0  0\n 19 16  2  0  0  0  0\nM  APO  1   1   1\nM  END\n> <Name>\nTrt\n\n$$$$\n\nMolEngine02241412152D\n\n  8  8  0  0  0  0            999 V2000\n    1.3510    1.5600    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    0.0000    2.3400    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    0.0000    3.9000    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    2.7020    2.3400    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    2.7020    3.9000    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    1.3510    4.6800    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    4.0530    4.6800    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    1.3510    0.0000    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n  1  2  1  0  0  0  0\n  2  3  2  0  0  0  0\n  1  4  2  0  0  0  0\n  4  5  1  0  0  0  0\n  5  6  2  0  0  0  0\n  6  3  1  0  0  0  0\n  5  7  1  0  0  0  0\n  1  8  1  0  0  0  0\nM  APO  1   4   1\nM  END\n> <Name>\nXyl\n\n$$$$\n\nMolEngine02241412152D\n\n  6  6  0  0  0  0            999 V2000\n    1.3510    0.0000    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    0.0000    0.7800    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    0.0000    2.3400    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    1.3510    3.1200    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    2.7020    2.3400    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    2.7020    0.7800    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n  1  2  1  0  0  0  0\n  2  3  1  0  0  0  0\n  3  4  1  0  0  0  0\n  4  5  1  0  0  0  0\n  5  6  1  0  0  0  0\n  6  1  1  0  0  0  0\nM  APO  1   5   1\nM  END\n> <Name>\ncHx,Cy\n\n$$$$\n\nMolEngine02241412152D\n\n  4  4  0  0  0  0            999 V2000\n    0.0000    0.0000    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    0.0000    1.5600    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    1.5600    1.5600    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    1.5600    0.0000    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n  1  2  1  0  0  0  0\n  2  3  1  0  0  0  0\n  3  4  1  0  0  0  0\n  4  1  1  0  0  0  0\nM  APO  1   3   1\nM  END\n> <Name>\ncyclobutyl\n\n$$$$\n\nMolEngine02241412152D\n\n  7  7  0  0  0  0            999 V2000\n    0.0000    0.9712    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    1.2193    0.0000    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    2.7395    0.3471    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    3.4167    1.7534    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    2.7395    3.1576    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    1.2193    3.5057    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    0.0000    2.5325    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n  1  2  1  0  0  0  0\n  2  3  1  0  0  0  0\n  3  4  1  0  0  0  0\n  4  5  1  0  0  0  0\n  5  6  1  0  0  0  0\n  6  7  1  0  0  0  0\n  7  1  1  0  0  0  0\nM  APO  1   4   1\nM  END\n> <Name>\ncycloheptyl\n\n$$$$\n\nMolEngine02241412152D\n\n  8  8  0  0  0  0            999 V2000\n    0.0000    1.1030    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    1.1030    0.0000    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    2.6630    0.0000    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    3.7660    1.1030    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    3.7660    2.6630    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    2.6630    3.7660    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    1.1030    3.7660    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    0.0000    2.6630    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n  1  2  1  0  0  0  0\n  2  3  1  0  0  0  0\n  3  4  1  0  0  0  0\n  4  5  1  0  0  0  0\n  5  6  1  0  0  0  0\n  6  7  1  0  0  0  0\n  7  8  1  0  0  0  0\n  8  1  1  0  0  0  0\nM  APO  1   5   1\nM  END\n> <Name>\ncyclooctyl\n\n$$$$\n\nMolEngine02241412152D\n\n  5  5  0  0  0  0            999 V2000\n    0.0000    0.4819    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    1.4837    0.0000    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    2.4005    1.2618    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    1.4837    2.5235    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    0.0000    2.0416    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n  1  2  1  0  0  0  0\n  2  3  1  0  0  0  0\n  3  4  1  0  0  0  0\n  4  5  1  0  0  0  0\n  5  1  1  0  0  0  0\nM  APO  1   3   1\nM  END\n> <Name>\ncyclopentyl\n\n$$$$\n\nMolEngine02241412152D\n\n  3  3  0  0  0  0            999 V2000\n    0.7800    0.0000    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    0.0000    1.3510    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    1.5600    1.3510    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n  1  2  1  0  0  0  0\n  1  3  1  0  0  0  0\n  2  3  1  0  0  0  0\nM  APO  1   3   1\nM  END\n> <Name>\ncyclopropyl\n\n$$$$\n\nMolEngine02241412152D\n\n  5  4  0  0  0  0            999 V2000\n    0.0000    1.5600    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    1.3510    2.3400    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    2.7020    1.5600    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    4.0530    2.3400    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    2.7020    0.0000    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n  1  2  1  0  0  0  0\n  2  3  1  0  0  0  0\n  3  4  1  0  0  0  0\n  3  5  1  0  0  0  0\nM  APO  1   1   1\nM  END\n> <Name>\ni-Am,iAm\n\n$$$$\n\nMolEngine02241412152D\n\n  4  3  0  0  0  0            999 V2000\n    0.0000    2.3400    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    1.3510    1.5600    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    2.7020    2.3400    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    1.3510    0.0000    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n  1  2  1  0  0  0  0\n  2  3  1  0  0  0  0\n  2  4  1  0  0  0  0\nM  APO  1   1   1\nM  END\n> <Name>\ni-Bu,iBu\n\n$$$$\n\nMolEngine02241412152D\n\n  3  2  0  0  0  0            999 V2000\n    1.3510    0.0000    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    2.7020    0.7800    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    0.0000    0.7800    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n  1  2  1  0  0  0  0\n  1  3  1  0  0  0  0\nM  APO  1   1   1\nM  END\n> <Name>\ni-Pr,iPr\n\n$$$$\n\nMolEngine02241412152D\n\n  7  7  0  0  0  0            999 V2000\n    2.7020    0.0000    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    1.3510    0.7800    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    1.3510    2.3400    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    4.0530    0.7800    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    4.0530    2.3400    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    2.7020    3.1200    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    0.0000    3.1200    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n  1  2  2  0  0  0  0\n  2  3  1  0  0  0  0\n  1  4  1  0  0  0  0\n  4  5  2  0  0  0  0\n  5  6  1  0  0  0  0\n  6  3  2  0  0  0  0\n  3  7  1  0  0  0  0\nM  APO  1   5   1\nM  END\n> <Name>\nm-Tolyl\n\n$$$$\n\nMolEngine02241412152D\n\n  5  4  0  0  0  0            999 V2000\n    0.0000    0.0000    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    1.3510    0.7800    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    2.7020    0.0000    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    4.0530    0.7800    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    5.4040    0.0000    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n  1  2  1  0  0  0  0\n  2  3  1  0  0  0  0\n  3  4  1  0  0  0  0\n  4  5  1  0  0  0  0\nM  APO  1   1   1\nM  END\n> <Name>\nnAm,n-Am,Am\n\n$$$$\n\nMolEngine02241412152D\n\n  3  2  0  0  0  0            999 V2000\n    0.0000    0.0000    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    1.3510    0.7800    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    2.7020    0.0000    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n  1  2  1  0  0  0  0\n  2  3  1  0  0  0  0\nM  APO  1   3   1\nM  END\n> <Name>\nnPr,n-Pr,Pr\n\n$$$$\n\nMolEngine02241412152D\n\n  5  4  0  0  0  0            999 V2000\n    1.3510    1.5600    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    1.3510    0.0000    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    2.7020    2.3400    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    0.0000    2.3400    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    1.3510    3.1200    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n  1  2  1  0  0  0  0\n  1  3  1  0  0  0  0\n  1  4  1  0  0  0  0\n  1  5  1  0  0  0  0\nM  APO  1   2   1\nM  END\n> <Name>\nneo-Am\n\n$$$$\n\nMolEngine02241412152D\n\n  7  7  0  0  0  0            999 V2000\n    1.3510    0.0000    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    0.0000    0.7800    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    0.0000    2.3400    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    2.7020    0.7800    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    2.7020    2.3400    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    1.3510    3.1200    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    4.0530    3.1200    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n  1  2  1  0  0  0  0\n  2  3  2  0  0  0  0\n  1  4  2  0  0  0  0\n  4  5  1  0  0  0  0\n  5  6  2  0  0  0  0\n  6  3  1  0  0  0  0\n  5  7  1  0  0  0  0\nM  APO  1   2   1\nM  END\n> <Name>\np-Tolyl\n\n$$$$\n\nMolEngine02241412152D\n\n  5  4  0  0  0  0            999 V2000\n    0.0000    1.5600    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    0.0000    0.0000    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    1.3510    2.3400    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    2.7020    1.5600    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    4.0530    2.3400    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n  1  2  1  0  0  0  0\n  1  3  1  0  0  0  0\n  3  4  1  0  0  0  0\n  4  5  1  0  0  0  0\nM  APO  1   1   1\nM  END\n> <Name>\ns-Am,sAm\n\n$$$$\n\nMolEngine02241412152D\n\n  4  3  0  0  0  0            999 V2000\n    0.0000    1.5600    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    1.3510    2.3400    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    2.7020    1.5600    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    0.0000    0.0000    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n  1  2  1  0  0  0  0\n  2  3  1  0  0  0  0\n  1  4  1  0  0  0  0\nM  APO  1   1   1\nM  END\n> <Name>\ns-Bu,sBu\n\n$$$$\n\nMolEngine02241412152D\n\n  5  4  0  0  0  0            999 V2000\n    1.3510    2.3400    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    2.7020    3.1200    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    0.0000    3.1200    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    1.3510    0.7800    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    0.0000    0.0000    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n  1  2  1  0  0  0  0\n  1  3  1  0  0  0  0\n  1  4  1  0  0  0  0\n  4  5  1  0  0  0  0\nM  APO  1   1   1\nM  END\n> <Name>\nt-Am,tAm\n\n$$$$\n\nMolEngine02241412152D\n\n  7  6  0  0  0  0            999 V2000\n    0.0000    1.3510    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    1.5600    1.3510    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    3.1200    1.3510    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n    0.7800    2.7020    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    0.7800    0.0000    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    3.9000    2.7020    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    5.4600    2.7020    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n  1  2  1  0  0  0  0\n  2  3  1  0  0  0  0\n  2  4  1  0  0  0  0\n  2  5  1  0  0  0  0\n  3  6  1  0  0  0  0\n  6  7  2  0  0  0  0\nM  APO  1   6   1\nM  END\n> <Name>\nt-BOC\n\n$$$$\n\nMolEngine02241412152D\n\n  4  3  0  0  0  0            999 V2000\n    0.0000    1.5600    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    1.5600    1.5600    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    1.5600    3.1200    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    1.5600    0.0000    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n  1  2  1  0  0  0  0\n  2  3  1  0  0  0  0\n  2  4  1  0  0  0  0\nM  APO  1   2   1\nM  END\n> <Name>\nt-Bu,tBu\n\n$$$$\n\nMolEngine02241412152D\n\n  9  9  0  0  0  0            999 V2000\n    1.3510    0.0000    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    0.0000    0.7800    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    0.0000    2.3400    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    2.7020    0.7800    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    2.7020    2.3400    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    1.3510    3.1200    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    4.0530    3.1200    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    5.4040    2.3400    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    6.7550    3.1200    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n  1  2  1  0  0  0  0\n  2  3  2  0  0  0  0\n  1  4  2  0  0  0  0\n  4  5  1  0  0  0  0\n  5  6  2  0  0  0  0\n  6  3  1  0  0  0  0\n  5  7  1  0  0  0  0\n  7  8  2  0  0  0  0\n  8  9  1  0  0  0  0\nM  APO  1   9   1\nM  END\n> <Name>\ntrans-Cinnamyl\n\n$$$$\n\nMolEngine02241412152D\n\n  4  3  0  0  0  0            999 V2000\n    0.0000    1.5600    0.0000 N   0  0  0  0  0  0  0  0  0  0  0  0\n    1.3510    2.3400    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    2.7010    1.5600    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    2.7010    0.0000    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n  1  2  1  0  0  0  0\n  2  3  1  0  0  0  0\n  3  4  2  0  0  0  0\nM  APO  1   1   1\nM  APO  1   3   2\nM  END\n> <Name>\nGly\n\n> <AA>\nG\n\n$$$$\n\nMolEngine02241412152D\n\n  5  4  0  0  0  0            999 V2000\n    0.0000    1.5600    0.0000 N   0  0  0  0  0  0  0  0  0  0  0  0\n    1.3510    2.3400    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    2.7010    1.5600    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    2.7010    0.0000    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n    1.3510    3.9000    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n  1  2  1  0  0  0  0\n  2  3  1  0  0  0  0\n  3  4  2  0  0  0  0\n  2  5  1  1  0  0  0\nM  APO  1   1   1\nM  APO  1   3   2\nM  END\n> <Name>\nAla\n\n> <AA>\nA\n\n$$$$\n\nMolEngine02241412152D\n\n  6  5  0  0  0  0            999 V2000\n    0.0000    1.5600    0.0000 N   0  0  0  0  0  0  0  0  0  0  0  0\n    1.3510    2.3400    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    2.7010    1.5600    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    2.7010    0.0000    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n    1.3510    3.9000    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    2.7010    4.6800    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n  1  2  1  0  0  0  0\n  2  3  1  0  0  0  0\n  3  4  2  0  0  0  0\n  2  5  1  1  0  0  0\n  5  6  1  0  0  0  0\nM  APO  1   1   1\nM  APO  1   3   2\nM  END\n> <Name>\nSer\n\n> <AA>\nS\n\n$$$$\n\nMolEngine02241412152D\n\n  7  6  0  0  0  0            999 V2000\n    0.0000    1.5600    0.0000 N   0  0  0  0  0  0  0  0  0  0  0  0\n    1.3510    2.3400    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    2.7010    1.5600    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    2.7010    0.0000    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n    1.3510    3.9000    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    2.7010    4.6800    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n    0.0000    4.6800    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n  1  2  1  0  0  0  0\n  2  3  1  0  0  0  0\n  3  4  2  0  0  0  0\n  2  5  1  1  0  0  0\n  5  6  1  0  0  0  0\n  5  7  1  1  0  0  0\nM  APO  1   1   1\nM  APO  1   3   2\nM  END\n> <Name>\nThr\n\n> <AA>\nT\n\n$$$$\n\nMolEngine02241412152D\n\n  6  5  0  0  0  0            999 V2000\n    0.0000    1.5600    0.0000 N   0  0  0  0  0  0  0  0  0  0  0  0\n    1.3510    2.3400    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    2.7010    1.5600    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    2.7010    0.0000    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n    1.3510    3.9000    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    2.7010    4.6800    0.0000 S   0  0  0  0  0  0  0  0  0  0  0  0\n  1  2  1  0  0  0  0\n  2  3  1  0  0  0  0\n  3  4  2  0  0  0  0\n  2  5  1  1  0  0  0\n  5  6  1  0  0  0  0\nM  APO  1   1   1\nM  APO  1   3   2\nM  APO  1   6   3\nM  END\n> <Name>\nCys\n\n> <AA>\nC\n\n$$$$\n\nMolEngine02241412152D\n\n  7  6  0  0  0  0            999 V2000\n    0.0000    1.5600    0.0000 N   0  0  0  0  0  0  0  0  0  0  0  0\n    1.3510    2.3400    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    2.7010    1.5600    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    2.7010    0.0000    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n    1.3510    3.9000    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    2.7010    4.6800    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    0.0000    4.6800    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n  1  2  1  0  0  0  0\n  2  3  1  0  0  0  0\n  3  4  2  0  0  0  0\n  2  5  1  1  0  0  0\n  5  6  1  0  0  0  0\n  5  7  1  0  0  0  0\nM  APO  1   1   1\nM  APO  1   3   2\nM  END\n> <Name>\nVal\n\n> <AA>\nV\n\n$$$$\n\nMolEngine02241412152D\n\n  8  7  0  0  0  0            999 V2000\n    0.0000    1.5600    0.0000 N   0  0  0  0  0  0  0  0  0  0  0  0\n    1.3510    2.3400    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    2.7010    1.5600    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    2.7010    0.0000    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n    1.3510    3.9000    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    2.7010    4.6800    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    4.0520    3.9000    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    2.7010    6.2400    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n  1  2  1  0  0  0  0\n  2  3  1  0  0  0  0\n  3  4  2  0  0  0  0\n  2  5  1  1  0  0  0\n  5  6  1  0  0  0  0\n  6  7  1  0  0  0  0\n  6  8  1  0  0  0  0\nM  APO  1   1   1\nM  APO  1   3   2\nM  END\n> <Name>\nLeu\n\n> <AA>\nL\n\n$$$$\n\nMolEngine02241412152D\n\n  8  7  0  0  0  0            999 V2000\n    0.0000    1.5600    0.0000 N   0  0  0  0  0  0  0  0  0  0  0  0\n    1.3510    2.3400    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    2.7010    1.5600    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    2.7010    0.0000    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n    1.3510    3.9000    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    2.7010    4.6800    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    0.0000    4.6800    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    2.7010    6.2400    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n  1  2  1  0  0  0  0\n  2  3  1  0  0  0  0\n  3  4  2  0  0  0  0\n  2  5  1  1  0  0  0\n  5  6  1  0  0  0  0\n  5  7  1  1  0  0  0\n  6  8  1  0  0  0  0\nM  APO  1   1   1\nM  APO  1   3   2\nM  END\n> <Name>\nIle\n\n> <AA>\nI\n\n$$$$\n\nMolEngine02241412152D\n\n  8  7  0  0  0  0            999 V2000\n    0.0000    1.5600    0.0000 N   0  0  0  0  0  0  0  0  0  0  0  0\n    1.3520    2.3400    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    2.7020    1.5600    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    2.7020    0.0000    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n    1.3520    3.9000    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    2.7020    4.6800    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    2.7020    6.2400    0.0000 S   0  0  0  0  0  0  0  0  0  0  0  0\n    4.0520    7.0200    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n  1  2  1  0  0  0  0\n  2  3  1  0  0  0  0\n  3  4  2  0  0  0  0\n  2  5  1  1  0  0  0\n  5  6  1  0  0  0  0\n  6  7  1  0  0  0  0\n  7  8  1  0  0  0  0\nM  APO  1   1   1\nM  APO  1   3   2\nM  END\n> <Name>\nMet\n\n> <AA>\nM\n\n$$$$\n\nMolEngine02241412152D\n\n  7  7  0  0  0  0            999 V2000\n    0.3120    1.5600    0.0000 N   0  0  0  0  0  0  0  0  0  0  0  0\n    1.6620    2.3400    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    3.0120    1.5600    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    3.0120    0.0000    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n    1.6620    3.9000    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    0.0000    3.2240    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    0.6760    4.8350    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n  1  2  1  0  0  0  0\n  2  3  1  0  0  0  0\n  3  4  2  0  0  0  0\n  2  5  1  1  0  0  0\n  1  6  1  0  0  0  0\n  6  7  1  0  0  0  0\n  5  7  1  0  0  0  0\nM  APO  1   1   1\nM  APO  1   3   2\nM  END\n> <Name>\nPro\n\n> <AA>\nP\n\n$$$$\n\nMolEngine02241412152D\n\n 11 11  0  0  0  0            999 V2000\n    0.0000    1.5600    0.0000 N   0  0  0  0  0  0  0  0  0  0  0  0\n    1.3510    2.3400    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    2.7020    1.5600    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    2.7020    0.0000    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n    1.3510    3.9000    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    2.7020    4.6800    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    2.7020    6.2400    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    4.0530    7.0200    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    4.0530    3.9000    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    5.4040    4.6800    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    5.4040    6.2400    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n  1  2  1  0  0  0  0\n  2  3  1  0  0  0  0\n  3  4  2  0  0  0  0\n  2  5  1  1  0  0  0\n  5  6  1  0  0  0  0\n  6  7  2  0  0  0  0\n  7  8  1  0  0  0  0\n  6  9  1  0  0  0  0\n  9 10  2  0  0  0  0\n 10 11  1  0  0  0  0\n 11  8  2  0  0  0  0\nM  APO  1   1   1\nM  APO  1   3   2\nM  END\n> <Name>\nPhe\n\n> <AA>\nF\n\n$$$$\n\nMolEngine02241412152D\n\n 12 12  0  0  0  0            999 V2000\n    0.0000    1.5600    0.0000 N   0  0  0  0  0  0  0  0  0  0  0  0\n    1.3510    2.3400    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    2.7020    1.5600    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    2.7020    0.0000    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n    1.3510    3.9000    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    2.7020    4.6800    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    2.7020    6.2400    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    4.0520    7.0200    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    4.0520    3.9000    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    5.4030    4.6800    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    5.4030    6.2400    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    6.7540    7.0200    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n  1  2  1  0  0  0  0\n  2  3  1  0  0  0  0\n  3  4  2  0  0  0  0\n  2  5  1  1  0  0  0\n  5  6  1  0  0  0  0\n  6  7  2  0  0  0  0\n  7  8  1  0  0  0  0\n  6  9  1  0  0  0  0\n  9 10  2  0  0  0  0\n 10 11  1  0  0  0  0\n 11  8  2  0  0  0  0\n 11 12  1  0  0  0  0\nM  APO  1   1   1\nM  APO  1   3   2\nM  END\n> <Name>\nTyr\n\n> <AA>\nY\n\n$$$$\n\n   JSDraw208221616162D\n\n 14 15  0  0  1  0              0 V2000\n   18.2607  -11.7339    0.0000 N   0  0  0  0  0  0  0  0  0  0  0  0\n   19.5736  -10.9785    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n   20.8463  -11.8003    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n   20.8435  -13.3149    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n   19.5736   -9.4639    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n   20.3538   -8.1130    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n   21.9054   -7.9500    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n   22.2297   -6.4239    0.0000 N   0  0  0  0  0  0  0  0  0  0  0  0\n   19.7192   -6.6874    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n   20.8784   -5.6437    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n   20.5545   -4.1179    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n   19.0706   -3.6359    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n   17.9113   -4.6796    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n   18.2356   -6.2057    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n  7  8  1  0  0  0  0\n  6  7  2  0  0  0  0\n  8 10  1  0  0  0  0\n  9  6  1  0  0  0  0\n  2  1  1  0  0  0  0\n  9 10  2  0  0  0  0\n  2  5  1  1  0  0  0\n 10 11  1  0  0  0  0\n  2  3  1  0  0  0  0\n 11 12  2  0  0  0  0\n  5  6  1  0  0  0  0\n 12 13  1  0  0  0  0\n  3  4  2  0  0  0  0\n 13 14  2  0  0  0  0\n 14  9  1  0  0  0  0\nM  APO  1   1   1\nM  APO  1   3   2\nM  END\n> <Name>\nTrp\n\n> <AA>\nW\n\n$$$$\n\nMolEngine02241412152D\n\n  8  7  0  0  0  0            999 V2000\n    0.0000    1.5600    0.0000 N   0  0  0  0  0  0  0  0  0  0  0  0\n    1.3510    2.3400    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    2.7000    1.5600    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    2.7000    0.0000    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n    1.3510    3.9000    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    2.7010    4.6800    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    4.0520    3.9000    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n    2.7010    6.2400    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n  1  2  1  0  0  0  0\n  2  3  1  0  0  0  0\n  3  4  2  0  0  0  0\n  2  5  1  1  0  0  0\n  5  6  1  0  0  0  0\n  6  7  1  0  0  0  0\n  6  8  2  0  0  0  0\nM  APO  1   1   1\nM  APO  1   3   2\nM  END\n> <Name>\nAsp\n\n> <AA>\nD\n\n$$$$\n\nMolEngine02241412152D\n\n  9  8  0  0  0  0            999 V2000\n    0.0000    1.5600    0.0000 N   0  0  0  0  0  0  0  0  0  0  0  0\n    1.3510    2.3400    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    2.7000    1.5600    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    2.7000    0.0000    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n    1.3510    3.9000    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    2.7010    4.6800    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    2.7010    6.2400    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    4.0520    7.0200    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n    1.3510    7.0200    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n  1  2  1  0  0  0  0\n  2  3  1  0  0  0  0\n  3  4  2  0  0  0  0\n  2  5  1  1  0  0  0\n  5  6  1  0  0  0  0\n  6  7  1  0  0  0  0\n  7  8  2  0  0  0  0\n  7  9  1  0  0  0  0\nM  APO  1   1   1\nM  APO  1   3   2\nM  END\n> <Name>\nGlu\n\n> <AA>\nE\n\n$$$$\n\nMolEngine02241412152D\n\n  8  7  0  0  0  0            999 V2000\n    0.0000    1.5600    0.0000 N   0  0  0  0  0  0  0  0  0  0  0  0\n    1.3510    2.3400    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    2.7000    1.5600    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    2.7000    0.0000    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n    1.3510    3.9000    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    2.7010    4.6800    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    4.0520    3.9000    0.0000 N   0  0  0  0  0  0  0  0  0  0  0  0\n    2.7010    6.2400    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n  1  2  1  0  0  0  0\n  2  3  1  0  0  0  0\n  3  4  2  0  0  0  0\n  2  5  1  1  0  0  0\n  5  6  1  0  0  0  0\n  6  7  1  0  0  0  0\n  6  8  2  0  0  0  0\nM  APO  1   1   1\nM  APO  1   3   2\nM  END\n> <Name>\nAsn\n\n> <AA>\nN\n\n$$$$\n\nMolEngine02241412152D\n\n  9  8  0  0  0  0            999 V2000\n    0.0000    1.5600    0.0000 N   0  0  0  0  0  0  0  0  0  0  0  0\n    1.3510    2.3400    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    2.7000    1.5600    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    2.7000    0.0000    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n    1.3510    3.9000    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    2.7010    4.6800    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    2.7010    6.2400    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    4.0520    7.0200    0.0000 N   0  0  0  0  0  0  0  0  0  0  0  0\n    1.3510    7.0200    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n  1  2  1  0  0  0  0\n  2  3  1  0  0  0  0\n  3  4  2  0  0  0  0\n  2  5  1  1  0  0  0\n  5  6  1  0  0  0  0\n  6  7  1  0  0  0  0\n  7  8  1  0  0  0  0\n  7  9  2  0  0  0  0\nM  APO  1   1   1\nM  APO  1   3   2\nM  END\n> <Name>\nGln\n\n> <AA>\nQ\n\n$$$$\n\nMolEngine02241412152D\n\n 10 10  0  0  0  0            999 V2000\n    0.0000    1.5600    0.0000 N   0  0  0  0  0  0  0  0  0  0  0  0\n    1.3510    2.3400    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    2.7000    1.5600    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    2.7000    0.0000    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n    1.3510    3.9000    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    2.7010    4.6800    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    4.1260    4.0460    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    5.1700    5.2050    0.0000 N   0  0  0  0  0  0  0  0  0  0  0  0\n    4.3900    6.5560    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    2.8640    6.2310    0.0000 N   0  0  0  0  0  0  0  0  0  0  0  0\n  1  2  1  0  0  0  0\n  2  3  1  0  0  0  0\n  3  4  2  0  0  0  0\n  2  5  1  1  0  0  0\n  5  6  1  0  0  0  0\n  6  7  2  0  0  0  0\n  7  8  1  0  0  0  0\n  8  9  2  0  0  0  0\n  9 10  1  0  0  0  0\n 10  6  1  0  0  0  0\nM  APO  1   1   1\nM  APO  1   3   2\nM  END\n> <Name>\nHis\n\n> <AA>\nH\n\n$$$$\n\nMolEngine02241412152D\n\n  9  8  0  0  0  0            999 V2000\n    0.0000    1.5600    0.0000 N   0  0  0  0  0  0  0  0  0  0  0  0\n    1.3510    2.3400    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    2.7010    1.5600    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    2.7010    0.0000    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n    1.3510    3.9000    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    2.7020    4.6800    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    2.7020    6.2400    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    4.0530    7.0200    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    5.4040    6.2400    0.0000 N   0  0  0  0  0  0  0  0  0  0  0  0\n  1  2  1  0  0  0  0\n  2  3  1  0  0  0  0\n  3  4  2  0  0  0  0\n  2  5  1  1  0  0  0\n  5  6  1  0  0  0  0\n  6  7  1  0  0  0  0\n  7  8  1  0  0  0  0\n  8  9  1  0  0  0  0\nM  APO  1   1   1\nM  APO  1   3   2\nM  APO  1   9   3\nM  END\n> <Name>\nLys\n\n> <AA>\nK\n\n$$$$\n\nMolEngine02241412152D\n\n 11 10  0  0  0  0            999 V2000\n    0.0010    1.5625    0.0000 N   0  0  0  0  0  0  0  0  0  0  0  0\n    1.3544    2.3427    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    2.7048    1.5625    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    2.7048    0.0000    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n    1.3544    3.9062    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    2.7058    4.6885    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    2.7058    6.2500    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    1.3544    7.0342    0.0000 N   0  0  0  0  0  0  0  0  0  0  0  0\n    1.3544    8.5957    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    2.7058    9.3750    0.0000 N   0  0  0  0  0  0  0  0  0  0  0  0\n    0.0000    9.3750    0.0000 N   0  0  0  0  0  0  0  0  0  0  0  0\n  1  2  1  0  0  0  0\n  2  3  1  0  0  0  0\n  3  4  2  0  0  0  0\n  2  5  1  1  0  0  0\n  5  6  1  0  0  0  0\n  6  7  1  0  0  0  0\n  7  8  1  0  0  0  0\n  8  9  1  0  0  0  0\n  9 10  2  0  0  0  0\n  9 11  1  0  0  0  0\nM  APO  1   1   1\nM  APO  1   3   2\nM  END\n> <Name>\nArg\n\n> <AA>\nR\n\n$$$$\n\nMolEngine02241412152D\n\n  5  4  0  0  0  0            999 V2000\n    0.0000    1.5600    0.0000 N   0  0  0  0  0  0  0  0  0  0  0  0\n    1.3510    2.3400    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    2.7010    1.5600    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    2.7010    0.0000    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n    1.3510    3.9000    0.0000 Se  0  0  0  0  0  0  0  0  0  0  0  0\n  1  2  1  0  0  0  0\n  2  3  1  0  0  0  0\n  3  4  2  0  0  0  0\n  2  5  1  1  0  0  0\nM  APO  1   1   1\nM  APO  1   3   2\nM  END\n> <Name>\nSec\n\n> <AA>\nU\n\n$$$$\n\nMolEngine02241412152D\n\n 17 17  0  0  0  0            999 V2000\n    0.0000    1.5600    0.0000 N   0  0  0  0  0  0  0  0  0  0  0  0\n    1.3510    2.3400    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    2.7010    1.5600    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    2.7010    0.0000    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n    1.3510    3.9000    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    2.7020    4.6800    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    2.7020    6.2400    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    1.3510    7.0200    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    1.3510    8.5800    0.0000 N   0  0  0  0  0  0  0  0  0  0  0  0\n    2.7020    9.3600    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    2.7020   10.9200    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    4.0530    8.5800    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n    3.9640   11.8370    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    3.4820   13.3200    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    1.9220   13.3200    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    1.4400   11.8370    0.0000 N   0  0  0  0  0  0  0  0  0  0  0  0\n    5.4480   11.3550    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n  1  2  1  0  0  0  0\n  2  3  1  0  0  0  0\n  3  4  2  0  0  0  0\n  2  5  1  1  0  0  0\n  5  6  1  0  0  0  0\n  6  7  1  0  0  0  0\n  7  8  1  0  0  0  0\n  8  9  1  0  0  0  0\n  9 10  1  0  0  0  0\n 10 11  1  0  0  0  0\n 10 12  2  0  0  0  0\n 11 13  1  0  0  0  0\n 13 14  1  0  0  0  0\n 14 15  2  0  0  0  0\n 15 16  1  0  0  0  0\n 16 11  1  0  0  0  0\n 13 17  1  0  0  0  0\nM  APO  1   1   1\nM  APO  1   3   2\nM  END\n> <Name>\nPyl\n\n> <AA>\nO\n\n$$$$\n\nMolEngine02241412152D\n\n 21 23  0  0  0  0            999 V2000\n    5.8190    1.5570    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    7.3800    1.5570    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    7.8620    3.0410    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    6.6000    3.9580    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    5.3370    3.0410    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n    4.4700    0.7780    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    3.1180    1.5570    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n    1.5580    1.5570    0.0000 P   0  0  0  0  0  0  0  0  0  0  0  0\n    1.5580    0.0000    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n    1.5580    3.1170    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n    0.0000    1.5570    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n    6.6000    5.5170    0.0000 N   0  0  0  0  0  0  0  0  0  0  0  0\n    7.8620    6.4330    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    7.3800    7.9160    0.0000 N   0  0  0  0  0  0  0  0  0  0  0  0\n    5.8190    7.9160    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    5.3370    6.4330    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    4.7750    9.0750    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    3.2500    8.7510    0.0000 N   0  0  0  0  0  0  0  0  0  0  0  0\n    2.7680    7.2680    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    3.8120    6.1090    0.0000 N   0  0  0  0  0  0  0  0  0  0  0  0\n    5.2570   10.5590    0.0000 N   0  0  0  0  0  0  0  0  0  0  0  0\n  1  2  1  0  0  0  0\n  2  3  1  0  0  0  0\n  3  4  1  0  0  0  0\n  4  5  1  0  0  0  0\n  5  1  1  0  0  0  0\n  1  6  1  1  0  0  0\n  6  7  1  0  0  0  0\n  7  8  1  0  0  0  0\n  8  9  1  0  0  0  0\n  8 10  2  0  0  0  0\n  8 11  1  0  0  0  0\n  4 12  1  1  0  0  0\n 12 13  1  0  0  0  0\n 13 14  2  0  0  0  0\n 14 15  1  0  0  0  0\n 15 16  2  0  0  0  0\n 16 12  1  0  0  0  0\n 17 15  1  0  0  0  0\n 17 18  2  0  0  0  0\n 18 19  1  0  0  0  0\n 19 20  2  0  0  0  0\n 20 16  1  0  0  0  0\n 17 21  1  0  0  0  0\nM  APO  1   2   2\nM  APO  1  11   1\nM  END\n> <Name>\n\n\n> <AA>\n\n\n> <DNA>\nA\n\n> <RNA>\n\n\n> <T>\n\n\n$$$$\n\nMolEngine02241412152D\n\n 22 24  0  0  0  0            999 V2000\n    5.8220    1.5590    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    7.3820    1.5590    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    7.8640    3.0430    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    6.6020    3.9610    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    5.3400    3.0430    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n    4.4710    0.7800    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    3.1200    1.5590    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n    1.5610    1.5590    0.0000 P   0  0  0  0  0  0  0  0  0  0  0  0\n    1.5610    0.0000    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n    1.5610    3.1200    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n    0.0000    1.5590    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n    6.6020    5.5190    0.0000 N   0  0  0  0  0  0  0  0  0  0  0  0\n    7.8640    6.4360    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    7.3820    7.9200    0.0000 N   0  0  0  0  0  0  0  0  0  0  0  0\n    5.8220    7.9200    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    5.3400    6.4360    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    4.7780    9.0780    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    3.2520    8.7540    0.0000 N   0  0  0  0  0  0  0  0  0  0  0  0\n    2.7700    7.2710    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    3.8140    6.1110    0.0000 N   0  0  0  0  0  0  0  0  0  0  0  0\n    5.2600   10.5630    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n    1.2440    6.9470    0.0000 N   0  0  0  0  0  0  0  0  0  0  0  0\n  1  2  1  0  0  0  0\n  2  3  1  0  0  0  0\n  3  4  1  0  0  0  0\n  4  5  1  0  0  0  0\n  5  1  1  0  0  0  0\n  1  6  1  1  0  0  0\n  6  7  1  0  0  0  0\n  7  8  1  0  0  0  0\n  8  9  1  0  0  0  0\n  8 10  2  0  0  0  0\n  8 11  1  0  0  0  0\n  4 12  1  1  0  0  0\n 12 13  1  0  0  0  0\n 13 14  2  0  0  0  0\n 14 15  1  0  0  0  0\n 15 16  2  0  0  0  0\n 16 12  1  0  0  0  0\n 17 15  1  0  0  0  0\n 17 18  1  0  0  0  0\n 18 19  1  0  0  0  0\n 19 20  2  0  0  0  0\n 20 16  1  0  0  0  0\n 17 21  2  0  0  0  0\n 19 22  1  0  0  0  0\nM  APO  1   2   2\nM  APO  1  11   1\nM  END\n> <Name>\n\n\n> <AA>\n\n\n> <DNA>\nG\n\n> <RNA>\n\n\n> <T>\n\n\n$$$$\n\nMolEngine02241412152D\n\n 20 21  0  0  0  0            999 V2000\n    5.8220    1.5600    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    7.3820    1.5600    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    7.8640    3.0440    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    6.6020    3.9610    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    5.3400    3.0440    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n    4.4710    0.7810    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    3.1200    1.5600    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n    1.5600    1.5600    0.0000 P   0  0  0  0  0  0  0  0  0  0  0  0\n    1.5600    0.0000    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n    1.5600    3.1200    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n    0.0000    1.5600    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n    6.6020    5.5210    0.0000 N   0  0  0  0  0  0  0  0  0  0  0  0\n    5.2510    6.3010    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    5.2510    7.8610    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    7.9530    6.3010    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    7.9530    7.8610    0.0000 N   0  0  0  0  0  0  0  0  0  0  0  0\n    6.6020    8.6410    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    3.9000    8.6410    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    6.6020   10.2010    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n    9.3040    5.5210    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n  1  2  1  0  0  0  0\n  2  3  1  0  0  0  0\n  3  4  1  0  0  0  0\n  4  5  1  0  0  0  0\n  5  1  1  0  0  0  0\n  1  6  1  1  0  0  0\n  6  7  1  0  0  0  0\n  7  8  1  0  0  0  0\n  8  9  1  0  0  0  0\n  8 10  2  0  0  0  0\n  8 11  1  0  0  0  0\n  4 12  1  1  0  0  0\n 12 13  1  0  0  0  0\n 13 14  2  0  0  0  0\n 12 15  1  0  0  0  0\n 15 16  1  0  0  0  0\n 16 17  1  0  0  0  0\n 17 14  1  0  0  0  0\n 14 18  1  0  0  0  0\n 17 19  2  0  0  0  0\n 15 20  2  0  0  0  0\nM  APO  1   2   2\nM  APO  1  11   1\nM  END\n> <Name>\n\n\n> <AA>\n\n\n> <DNA>\nT\n\n> <RNA>\n\n\n> <T>\n\n\n$$$$\n\nMolEngine02241412152D\n\n 19 20  0  0  0  0            999 V2000\n    5.8220    1.5600    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    7.3820    1.5600    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    7.8640    3.0440    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    6.6020    3.9610    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    5.3400    3.0440    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n    4.4710    0.7810    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    3.1200    1.5600    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n    1.5600    1.5600    0.0000 P   0  0  0  0  0  0  0  0  0  0  0  0\n    1.5600    0.0000    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n    1.5600    3.1200    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n    0.0000    1.5600    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n    6.6020    5.5210    0.0000 N   0  0  0  0  0  0  0  0  0  0  0  0\n    5.2510    6.3010    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    5.2510    7.8610    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    7.9530    6.3010    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    7.9530    7.8610    0.0000 N   0  0  0  0  0  0  0  0  0  0  0  0\n    6.6020    8.6410    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    6.6020   10.2010    0.0000 N   0  0  0  0  0  0  0  0  0  0  0  0\n    9.3040    5.5210    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n  1  2  1  0  0  0  0\n  2  3  1  0  0  0  0\n  3  4  1  0  0  0  0\n  4  5  1  0  0  0  0\n  5  1  1  0  0  0  0\n  1  6  1  1  0  0  0\n  6  7  1  0  0  0  0\n  7  8  1  0  0  0  0\n  8  9  1  0  0  0  0\n  8 10  2  0  0  0  0\n  8 11  1  0  0  0  0\n  4 12  1  1  0  0  0\n 12 13  1  0  0  0  0\n 13 14  2  0  0  0  0\n 12 15  1  0  0  0  0\n 15 16  1  0  0  0  0\n 16 17  2  0  0  0  0\n 17 14  1  0  0  0  0\n 17 18  1  0  0  0  0\n 15 19  2  0  0  0  0\nM  APO  1   2   2\nM  APO  1  11   1\nM  END\n> <Name>\n\n\n> <AA>\n\n\n> <DNA>\nC\n\n> <RNA>\n\n\n> <T>\n\n\n$$$$\n\nMolEngine02241412152D\n\n 22 24  0  0  0  0            999 V2000\n    5.8210    1.5590    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    7.3820    1.5590    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    7.8640    3.0430    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    6.6020    3.9600    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    5.3390    3.0430    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n    4.4710    0.7800    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    3.1190    1.5590    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n    1.5590    1.5590    0.0000 P   0  0  0  0  0  0  0  0  0  0  0  0\n    1.5590    0.0000    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n    1.5590    3.1190    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n    0.0000    1.5590    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n    6.6020    5.5190    0.0000 N   0  0  0  0  0  0  0  0  0  0  0  0\n    7.8640    6.4350    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    7.3820    7.9200    0.0000 N   0  0  0  0  0  0  0  0  0  0  0  0\n    5.8210    7.9200    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    5.3390    6.4350    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    4.7770    9.0790    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    3.2510    8.7550    0.0000 N   0  0  0  0  0  0  0  0  0  0  0  0\n    2.7690    7.2700    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    3.8130    6.1110    0.0000 N   0  0  0  0  0  0  0  0  0  0  0  0\n    5.2590   10.5630    0.0000 N   0  0  0  0  0  0  0  0  0  0  0  0\n    9.3470    3.5250    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n  1  2  1  0  0  0  0\n  2  3  1  0  0  0  0\n  3  4  1  0  0  0  0\n  4  5  1  0  0  0  0\n  5  1  1  0  0  0  0\n  1  6  1  1  0  0  0\n  6  7  1  0  0  0  0\n  7  8  1  0  0  0  0\n  8  9  1  0  0  0  0\n  8 10  2  0  0  0  0\n  8 11  1  0  0  0  0\n  4 12  1  1  0  0  0\n 12 13  1  0  0  0  0\n 13 14  2  0  0  0  0\n 14 15  1  0  0  0  0\n 15 16  2  0  0  0  0\n 16 12  1  0  0  0  0\n 17 15  1  0  0  0  0\n 17 18  2  0  0  0  0\n 18 19  1  0  0  0  0\n 19 20  2  0  0  0  0\n 20 16  1  0  0  0  0\n 17 21  1  0  0  0  0\n  3 22  1  0  0  0  0\nM  APO  1   2   2\nM  APO  1  11   1\nM  END\n> <Name>\nAdenosine\n\n> <RNA>\nA\n\n$$$$\n\nMolEngine02241412152D\n\n 23 25  0  0  0  0            999 V2000\n    5.8220    1.5590    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    7.3820    1.5590    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    7.8640    3.0430    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    6.6020    3.9610    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    5.3400    3.0430    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n    4.4710    0.7800    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    3.1200    1.5590    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n    1.5610    1.5590    0.0000 P   0  0  0  0  0  0  0  0  0  0  0  0\n    1.5610    0.0000    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n    1.5610    3.1200    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n    0.0000    1.5590    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n    6.6020    5.5190    0.0000 N   0  0  0  0  0  0  0  0  0  0  0  0\n    7.8640    6.4360    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    7.3820    7.9200    0.0000 N   0  0  0  0  0  0  0  0  0  0  0  0\n    5.8220    7.9200    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    5.3400    6.4360    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    4.7780    9.0780    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    3.2520    8.7540    0.0000 N   0  0  0  0  0  0  0  0  0  0  0  0\n    2.7700    7.2710    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    3.8140    6.1110    0.0000 N   0  0  0  0  0  0  0  0  0  0  0  0\n    5.2600   10.5630    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n    1.2440    6.9470    0.0000 N   0  0  0  0  0  0  0  0  0  0  0  0\n    9.3480    3.5240    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n  1  2  1  0  0  0  0\n  2  3  1  0  0  0  0\n  3  4  1  0  0  0  0\n  4  5  1  0  0  0  0\n  5  1  1  0  0  0  0\n  1  6  1  1  0  0  0\n  6  7  1  0  0  0  0\n  7  8  1  0  0  0  0\n  8  9  1  0  0  0  0\n  8 10  2  0  0  0  0\n  8 11  1  0  0  0  0\n  4 12  1  1  0  0  0\n 12 13  1  0  0  0  0\n 13 14  2  0  0  0  0\n 14 15  1  0  0  0  0\n 15 16  2  0  0  0  0\n 16 12  1  0  0  0  0\n 17 15  1  0  0  0  0\n 17 18  1  0  0  0  0\n 18 19  1  0  0  0  0\n 19 20  2  0  0  0  0\n 20 16  1  0  0  0  0\n 17 21  2  0  0  0  0\n 19 22  1  0  0  0  0\n  3 23  1  0  0  0  0\nM  APO  1   2   2\nM  APO  1  11   1\nM  END\n> <Name>\nGuanosine\n\n> <RNA>\nG\n\n$$$$\n\nMolEngine02241412152D\n\n 21 22  0  0  0  0            999 V2000\n    5.8220    1.5600    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    7.3820    1.5600    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    7.8640    3.0440    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    6.6020    3.9610    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    5.3400    3.0440    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n    4.4710    0.7810    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    3.1200    1.5600    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n    1.5600    1.5600    0.0000 P   0  0  0  0  0  0  0  0  0  0  0  0\n    1.5600    0.0000    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n    1.5600    3.1200    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n    0.0000    1.5600    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n    6.6020    5.5210    0.0000 N   0  0  0  0  0  0  0  0  0  0  0  0\n    5.2510    6.3010    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    5.2510    7.8610    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    7.9530    6.3010    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    7.9530    7.8610    0.0000 N   0  0  0  0  0  0  0  0  0  0  0  0\n    6.6020    8.6410    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    3.9000    8.6410    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    6.6020   10.2010    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n    9.3040    5.5210    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n    9.3480    3.5260    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n  1  2  1  0  0  0  0\n  2  3  1  0  0  0  0\n  3  4  1  0  0  0  0\n  4  5  1  0  0  0  0\n  5  1  1  0  0  0  0\n  1  6  1  1  0  0  0\n  6  7  1  0  0  0  0\n  7  8  1  0  0  0  0\n  8  9  1  0  0  0  0\n  8 10  2  0  0  0  0\n  8 11  1  0  0  0  0\n  4 12  1  1  0  0  0\n 12 13  1  0  0  0  0\n 13 14  2  0  0  0  0\n 12 15  1  0  0  0  0\n 15 16  1  0  0  0  0\n 16 17  1  0  0  0  0\n 17 14  1  0  0  0  0\n 14 18  1  0  0  0  0\n 17 19  2  0  0  0  0\n 15 20  2  0  0  0  0\n  3 21  1  0  0  0  0\nM  APO  1   2   2\nM  APO  1  11   1\nM  END\n> <Name>\nThymidine\n\n> <RNA>\nT\n\n$$$$\n\nMolEngine02241412152D\n\n 20 21  0  0  0  0            999 V2000\n    5.8220    1.5600    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    7.3820    1.5600    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    7.8640    3.0440    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    6.6020    3.9610    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    5.3400    3.0440    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n    4.4710    0.7810    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    3.1200    1.5600    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n    1.5600    1.5600    0.0000 P   0  0  0  0  0  0  0  0  0  0  0  0\n    1.5600    0.0000    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n    1.5600    3.1200    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n    0.0000    1.5600    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n    6.6020    5.5210    0.0000 N   0  0  0  0  0  0  0  0  0  0  0  0\n    5.2510    6.3010    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    5.2510    7.8610    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    7.9530    6.3010    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    7.9530    7.8610    0.0000 N   0  0  0  0  0  0  0  0  0  0  0  0\n    6.6020    8.6410    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    6.6020   10.2010    0.0000 N   0  0  0  0  0  0  0  0  0  0  0  0\n    9.3040    5.5210    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n    9.3480    3.5260    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n  1  2  1  0  0  0  0\n  2  3  1  0  0  0  0\n  3  4  1  0  0  0  0\n  4  5  1  0  0  0  0\n  5  1  1  0  0  0  0\n  1  6  1  1  0  0  0\n  6  7  1  0  0  0  0\n  7  8  1  0  0  0  0\n  8  9  1  0  0  0  0\n  8 10  2  0  0  0  0\n  8 11  1  0  0  0  0\n  4 12  1  1  0  0  0\n 12 13  1  0  0  0  0\n 13 14  2  0  0  0  0\n 12 15  1  0  0  0  0\n 15 16  1  0  0  0  0\n 16 17  2  0  0  0  0\n 17 14  1  0  0  0  0\n 17 18  1  0  0  0  0\n 15 19  2  0  0  0  0\n  3 20  1  0  0  0  0\nM  APO  1   2   2\nM  APO  1  11   1\nM  END\n> <Name>\nCytidine\n\n> <RNA>\nC\n\n$$$$\n\nMolEngine02241412152D\n\n 20 21  0  0  0  0            999 V2000\n    5.8220    1.5600    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    7.3820    1.5600    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    7.8640    3.0440    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    6.6020    3.9610    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    5.3400    3.0440    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n    4.4710    0.7810    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    3.1200    1.5600    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n    1.5600    1.5600    0.0000 P   0  0  0  0  0  0  0  0  0  0  0  0\n    1.5600    0.0000    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n    1.5600    3.1200    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n    0.0000    1.5600    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n    6.6020    5.5210    0.0000 N   0  0  0  0  0  0  0  0  0  0  0  0\n    5.2510    6.3010    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    5.2510    7.8610    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    7.9530    6.3010    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    7.9530    7.8610    0.0000 N   0  0  0  0  0  0  0  0  0  0  0  0\n    6.6020    8.6410    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    6.6020   10.2010    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n    9.3040    5.5210    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n    9.3480    3.5260    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n  1  2  1  0  0  0  0\n  2  3  1  0  0  0  0\n  3  4  1  0  0  0  0\n  4  5  1  0  0  0  0\n  5  1  1  0  0  0  0\n  1  6  1  1  0  0  0\n  6  7  1  0  0  0  0\n  7  8  1  0  0  0  0\n  8  9  1  0  0  0  0\n  8 10  2  0  0  0  0\n  8 11  1  0  0  0  0\n  4 12  1  1  0  0  0\n 12 13  1  0  0  0  0\n 13 14  2  0  0  0  0\n 12 15  1  0  0  0  0\n 15 16  1  0  0  0  0\n 16 17  1  0  0  0  0\n 17 14  1  0  0  0  0\n 17 18  2  0  0  0  0\n 15 19  2  0  0  0  0\n  3 20  1  0  0  0  0\nM  APO  1   2   2\nM  APO  1  11   1\nM  END\n> <Name>\nUridine\n\n> <RNA>\nU\n\n$$$$\n\nMolEngine02241412152D\n\n 22 24  0  0  0  0            999 V2000\n    5.8240    1.5580    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    7.3860    1.5580    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    7.8660    3.0450    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    6.6050    3.9610    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    5.3400    3.0450    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n    4.4730    0.7800    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    3.1210    1.5580    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n    1.5600    1.5580    0.0000 P   0  0  0  0  0  0  0  0  0  0  0  0\n    1.5600    0.0000    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n    1.5600    3.1210    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n    0.0000    1.5580    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n    6.6050    5.5210    0.0000 N   0  0  0  0  0  0  0  0  0  0  0  0\n    7.8660    6.4380    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    7.3860    7.9220    0.0000 N   0  0  0  0  0  0  0  0  0  0  0  0\n    5.8240    7.9220    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    5.3400    6.4380    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    4.7790    9.0820    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    3.2530    8.7580    0.0000 N   0  0  0  0  0  0  0  0  0  0  0  0\n    2.7710    7.2720    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    3.8160    6.1150    0.0000 N   0  0  0  0  0  0  0  0  0  0  0  0\n    5.2600   10.5670    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n    9.3480    3.5310    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n  1  2  1  0  0  0  0\n  2  3  1  0  0  0  0\n  3  4  1  0  0  0  0\n  4  5  1  0  0  0  0\n  5  1  1  0  0  0  0\n  1  6  1  1  0  0  0\n  6  7  1  0  0  0  0\n  7  8  1  0  0  0  0\n  8  9  1  0  0  0  0\n  8 10  2  0  0  0  0\n  8 11  1  0  0  0  0\n  4 12  1  0  0  0  0\n 12 13  1  0  0  0  0\n 13 14  2  0  0  0  0\n 14 15  1  0  0  0  0\n 15 16  2  0  0  0  0\n 16 12  1  0  0  0  0\n 17 15  1  0  0  0  0\n 17 18  1  0  0  0  0\n 18 19  1  0  0  0  0\n 19 20  2  0  0  0  0\n 20 16  1  0  0  0  0\n 17 21  2  0  0  0  0\n  3 22  1  0  0  0  0\nM  APO  1   2   2\nM  APO  1  11   1\nM  END\n> <Name>\nInosine\n\n> <RNA>\nI\n\n$$$$\n\nMolEngine02241412152D\n\n 23 25  0  0  0  0            999 V2000\n    5.8220    1.5590    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    7.3820    1.5590    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    7.8640    3.0440    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    6.6030    3.9610    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    5.3400    3.0440    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n    4.4710    0.7800    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    3.1200    1.5590    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n    1.5590    1.5590    0.0000 P   0  0  0  0  0  0  0  0  0  0  0  0\n    1.5590    0.0000    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n    1.5590    3.1200    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n    0.0000    1.5590    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n    6.6030    5.5190    0.0000 N   0  0  0  0  0  0  0  0  0  0  0  0\n    7.8640    6.4370    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    7.3820    7.9200    0.0000 N   0  0  0  0  0  0  0  0  0  0  0  0\n    5.8220    7.9200    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    5.3400    6.4370    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    4.7770    9.0790    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    3.2520    8.7550    0.0000 N   0  0  0  0  0  0  0  0  0  0  0  0\n    2.7700    7.2710    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    3.8140    6.1130    0.0000 N   0  0  0  0  0  0  0  0  0  0  0  0\n    5.2600   10.5640    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n    1.2420    6.9440    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n    9.3470    3.5280    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n  1  2  1  0  0  0  0\n  2  3  1  0  0  0  0\n  3  4  1  0  0  0  0\n  4  5  1  0  0  0  0\n  5  1  1  0  0  0  0\n  1  6  1  1  0  0  0\n  6  7  1  0  0  0  0\n  7  8  1  0  0  0  0\n  8  9  1  0  0  0  0\n  8 10  2  0  0  0  0\n  8 11  1  0  0  0  0\n  4 12  1  0  0  0  0\n 12 13  1  0  0  0  0\n 13 14  2  0  0  0  0\n 14 15  1  0  0  0  0\n 15 16  2  0  0  0  0\n 16 12  1  0  0  0  0\n 17 15  1  0  0  0  0\n 17 18  1  0  0  0  0\n 18 19  1  0  0  0  0\n 19 20  1  0  0  0  0\n 20 16  1  0  0  0  0\n 17 21  2  0  0  0  0\n 19 22  2  0  0  0  0\n  3 23  1  0  0  0  0\nM  APO  1   2   2\nM  APO  1  11   1\nM  END\n> <Name>\nXanthosine\n\n> <RNA>\nX\n\n$$$$\n\nMolEngine02241412152D\n\n 20 21  0  0  0  0            999 V2000\n    5.8220    1.5600    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    7.3820    1.5600    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    7.8640    3.0440    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    6.6020    3.9610    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    5.3400    3.0440    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n    4.4710    0.7810    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    3.1200    1.5600    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n    1.5600    1.5600    0.0000 P   0  0  0  0  0  0  0  0  0  0  0  0\n    1.5600    0.0000    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n    1.5600    3.1200    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n    0.0000    1.5600    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n    6.6020    5.5210    0.0000 N   0  0  0  0  0  0  0  0  0  0  0  0\n    5.2510    6.3010    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    5.2510    7.8610    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    7.9530    6.3010    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    7.9530    7.8610    0.0000 N   0  0  0  0  0  0  0  0  0  0  0  0\n    6.6020    8.6410    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    6.6020   10.2010    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n    9.3040    5.5210    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n    9.3480    3.5260    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n  1  2  1  0  0  0  0\n  2  3  1  0  0  0  0\n  3  4  1  0  0  0  0\n  4  5  1  0  0  0  0\n  5  1  1  0  0  0  0\n  1  6  1  1  0  0  0\n  6  7  1  0  0  0  0\n  7  8  1  0  0  0  0\n  8  9  1  0  0  0  0\n  8 10  2  0  0  0  0\n  8 11  1  0  0  0  0\n  4 12  1  0  0  0  0\n 12 13  1  0  0  0  0\n 13 14  1  0  0  0  0\n 12 15  1  0  0  0  0\n 15 16  1  0  0  0  0\n 16 17  1  0  0  0  0\n 17 14  1  0  0  0  0\n 17 18  2  0  0  0  0\n 15 19  2  0  0  0  0\n  3 20  1  0  0  0  0\nM  APO  1   2   2\nM  APO  1  11   1\nM  END\n> <Name>\nDihydrouridine\n\n> <RNA>\nD\n\n$$$$\n\nMolEngine02241412152D\n\n 10 11  0  0  0  0            999 V2000\n    0.4819    0.0000    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    2.0419    0.0000    0.0000 N   0  0  0  0  0  0  0  0  0  0  0  0\n    2.5238    1.4839    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    1.2619    2.4008    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    0.0000    1.4839    0.0000 N   0  0  0  0  0  0  0  0  0  0  0  0\n    3.9488    2.1178    0.0000 N   0  0  0  0  0  0  0  0  0  0  0  0\n    4.1118    3.6708    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    2.8498    4.5877    0.0000 N   0  0  0  0  0  0  0  0  0  0  0  0\n    1.4249    3.9527    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    0.1630    4.8687    0.0000 N   0  0  0  0  0  0  0  0  0  0  0  0\n  1  2  2  0  0  0  0\n  2  3  1  0  0  0  0\n  3  4  1  0  0  0  0\n  4  5  1  0  0  0  0\n  5  1  1  0  0  0  0\n  6  3  2  0  0  0  0\n  6  7  1  0  0  0  0\n  7  8  2  0  0  0  0\n  8  9  1  0  0  0  0\n  9  4  2  0  0  0  0\n  9 10  1  0  0  0  0\nM  APO  1   2   1\nM  END\n> <Name>\nAdenine\n\n$$$$\n\nMolEngine02241412152D\n\n 11 12  0  0  0  0            999 V2000\n    0.4819    0.0000    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    2.0426    0.0000    0.0000 N   0  0  0  0  0  0  0  0  0  0  0  0\n    2.5245    1.4837    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    1.2617    2.3995    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    0.0000    1.4837    0.0000 N   0  0  0  0  0  0  0  0  0  0  0  0\n    3.9492    2.1176    0.0000 N   0  0  0  0  0  0  0  0  0  0  0  0\n    4.1111    3.6692    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    2.8504    4.5861    0.0000 N   0  0  0  0  0  0  0  0  0  0  0  0\n    1.4257    3.9512    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    5.5359    4.3031    0.0000 N   0  0  0  0  0  0  0  0  0  0  0  0\n    0.1629    4.8680    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n  1  2  2  0  0  0  0\n  2  3  1  0  0  0  0\n  3  4  2  0  0  0  0\n  4  5  1  0  0  0  0\n  5  1  1  0  0  0  0\n  6  3  1  0  0  0  0\n  6  7  2  0  0  0  0\n  7  8  1  0  0  0  0\n  8  9  1  0  0  0  0\n  9  4  1  0  0  0  0\n  7 10  1  0  0  0  0\n  9 11  2  0  0  0  0\nM  APO  1   2   1\nM  END\n> <Name>\nGuanine\n\n$$$$\n\nMolEngine02241412152D\n\n  9  9  0  0  0  0            999 V2000\n    2.7010    0.0000    0.0000 N   0  0  0  0  0  0  0  0  0  0  0  0\n    1.3510    0.7800    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    1.3510    2.3400    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    2.7010    3.1200    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    4.0510    2.3400    0.0000 N   0  0  0  0  0  0  0  0  0  0  0  0\n    4.0510    0.7800    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    5.4020    0.0000    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n    2.7010    4.6800    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n    0.0000    3.1200    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n  1  2  1  0  0  0  0\n  2  3  2  0  0  0  0\n  3  4  1  0  0  0  0\n  4  5  1  0  0  0  0\n  5  6  1  0  0  0  0\n  6  1  1  0  0  0  0\n  6  7  2  0  0  0  0\n  4  8  2  0  0  0  0\n  3  9  1  0  0  0  0\nM  APO  1   1   1\nM  END\n> <Name>\nThymine\n\n$$$$\n\nMolEngine02241412152D\n\n  8  8  0  0  0  0            999 V2000\n    1.3510    0.0000    0.0000 N   0  0  0  0  0  0  0  0  0  0  0  0\n    0.0000    0.7800    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    0.0000    2.3400    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    1.3510    3.1200    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    2.7010    2.3400    0.0000 N   0  0  0  0  0  0  0  0  0  0  0  0\n    2.7010    0.7800    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    4.0520    0.0000    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n    1.3510    4.6800    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n  1  2  1  0  0  0  0\n  2  3  2  0  0  0  0\n  3  4  1  0  0  0  0\n  4  5  1  0  0  0  0\n  5  6  1  0  0  0  0\n  6  1  1  0  0  0  0\n  6  7  2  0  0  0  0\n  4  8  2  0  0  0  0\nM  APO  1   1   1\nM  END\n> <Name>\nUracil\n\n$$$$\n\nMolEngine02241412152D\n\n  8  8  0  0  0  0            999 V2000\n    1.3510    0.0000    0.0000 N   0  0  0  0  0  0  0  0  0  0  0  0\n    0.0000    0.7800    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    0.0000    2.3400    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    1.3510    3.1200    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    2.7010    2.3400    0.0000 N   0  0  0  0  0  0  0  0  0  0  0  0\n    2.7010    0.7800    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    4.0520    0.0000    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n    1.3510    4.6800    0.0000 N   0  0  0  0  0  0  0  0  0  0  0  0\n  1  2  1  0  0  0  0\n  2  3  2  0  0  0  0\n  3  4  1  0  0  0  0\n  4  5  2  0  0  0  0\n  5  6  1  0  0  0  0\n  6  1  1  0  0  0  0\n  6  7  2  0  0  0  0\n  4  8  1  0  0  0  0\nM  APO  1   1   1\nM  END\n> <Name>\nCytosine\n\n$$$$\n\nMolEngine02241412152D\n\n  3  2  0  0  0  0            999 V2000\n    0.0000    0.0000    0.0000 O   0  5  0  0  0  0  0  0  0  0  0  0\n    1.3510    0.7800    0.0000 N   0  3  0  0  0  0  0  0  0  0  0  0\n    1.3510    2.3400    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n  1  2  1  0  0  0  0\n  2  3  2  0  0  0  0\nM  CHG  1   1  -1\nM  CHG  1   2   1\nM  APO  1   2   1\nM  END\n> <Name>\n@NO2\n\n$$$$\n\nMolEngine02241412152D\n\n  6  6  0  0  0  0            999 V2000\n    1.3510    0.0000    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    0.0000    0.7800    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    0.0000    2.3400    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    2.7020    0.7800    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    2.7020    2.3400    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    1.3510    3.1200    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n  1  2  2  0  0  0  0\n  2  3  1  0  0  0  0\n  1  4  1  0  0  0  0\n  4  5  2  0  0  0  0\n  5  6  1  0  0  0  0\n  6  3  2  0  0  0  0\nM  END\n> <T>\nBenzene\n\n$$$$\n\nMolEngine02241412152D\n\n  6  6  0  0  0  0            999 V2000\n    1.3510    0.0000    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    0.0000    0.7800    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    0.0000    2.3400    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    1.3510    3.1200    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    2.7020    2.3400    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    2.7020    0.7800    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n  1  2  1  0  0  0  0\n  2  3  1  0  0  0  0\n  3  4  1  0  0  0  0\n  4  5  1  0  0  0  0\n  5  6  1  0  0  0  0\n  6  1  1  0  0  0  0\nM  END\n> <T>\nHexane\n\n$$$$\n\nMolEngine02241412152D\n\n  5  5  0  0  0  0            999 V2000\n    0.0000    0.4821    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    1.4836    0.0000    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    2.4006    1.2621    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    1.4836    2.5242    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    0.0000    2.0421    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n  1  2  1  0  0  0  0\n  2  3  1  0  0  0  0\n  3  4  1  0  0  0  0\n  4  5  1  0  0  0  0\n  5  1  1  0  0  0  0\nM  END\n> <T>\nPentane\n\n$$$$\n\nMolEngine02241412152D\n\n  3  3  0  0  0  0            999 V2000\n    0.7800    0.0000    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    0.0000    1.3510    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    1.5600    1.3510    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n  1  2  1  0  0  0  0\n  1  3  1  0  0  0  0\n  2  3  1  0  0  0  0\nM  END\n> <T>\nPropane\n\n$$$$\n\nMolEngine02241412152D\n\n  4  4  0  0  0  0            999 V2000\n    0.0000    0.0000    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    0.0000    1.5600    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    1.5600    1.5600    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    1.5600    0.0000    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n  1  2  1  0  0  0  0\n  2  3  1  0  0  0  0\n  3  4  1  0  0  0  0\n  4  1  1  0  0  0  0\nM  END\n> <T>\nButane\n\n$$$$\n\nMolEngine02241412152D\n\n  7  7  0  0  0  0            999 V2000\n    0.0000    0.9727    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    1.2196    0.0000    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    2.7405    0.3471    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    3.4174    1.7527    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    2.7405    3.1581    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    1.2196    3.5054    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    0.0000    2.5327    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n  1  2  1  0  0  0  0\n  2  3  1  0  0  0  0\n  3  4  1  0  0  0  0\n  4  5  1  0  0  0  0\n  5  6  1  0  0  0  0\n  6  7  1  0  0  0  0\n  7  1  1  0  0  0  0\nM  END\n> <T>\nHeptane\n\n$$$$\n\nMolEngine02241412152D\n\n  8  8  0  0  0  0            999 V2000\n    0.0000    1.1031    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    1.1031    0.0000    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    2.6631    0.0000    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    3.7660    1.1031    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    3.7660    2.6631    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    2.6631    3.7662    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    1.1031    3.7662    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    0.0000    2.6631    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n  1  2  1  0  0  0  0\n  2  3  1  0  0  0  0\n  3  4  1  0  0  0  0\n  4  5  1  0  0  0  0\n  5  6  1  0  0  0  0\n  6  7  1  0  0  0  0\n  7  8  1  0  0  0  0\n  8  1  1  0  0  0  0\nM  END\n> <T>\nOctane\n\n$$$$\n\nMolEngine02241412152D\n\n  5  4  0  0  0  0            999 V2000\n    1.5600    3.1200    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    1.5600    1.5600    0.0000 S   0  0  0  0  0  0  0  0  0  0  0  0\n    3.1200    1.5600    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n    0.0000    1.5600    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n    1.5600    0.0000    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n  1  2  1  0  0  0  0\n  2  3  2  0  0  0  0\n  2  4  2  0  0  0  0\n  2  5  1  0  0  0  0\nM  APO  1   5   1\nM  END\n> <Name>\n@OMs\n\n$$$$\n\nMolEngine02241412152D\n\n  4  3  0  0  0  0            999 V2000\n    0.0000    0.0000    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n    1.3510    0.7800    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    1.3510    2.3400    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    2.7020    0.0000    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n  1  2  1  0  0  0  0\n  2  3  1  0  0  0  0\n  2  4  2  0  0  0  0\nM  APO  1   1   1\nM  END\n> <Name>\n@OAc\n\n$$$$\n\nMolEngine02241412152D\n\n  4  3  0  0  0  0            999 V2000\n    0.0000    0.7800    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    1.3510    0.0000    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n    2.7020    0.7800    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    4.0530    0.0000    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n  1  2  1  0  0  0  0\n  2  3  1  0  0  0  0\n  3  4  1  0  0  0  0\nM  APO  1   1   1\nM  END\n> <Name>\nEOM\n\n$$$$\n\nMolEngine02241412152D\n\n 13 15  0  0  0  0            999 V2000\n    1.3510    1.2900    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    0.0000    2.0700    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    0.0000    3.6300    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    2.7020    2.0700    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    2.7020    3.6300    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    1.3510    4.4100    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    4.1850    4.1120    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    5.1020    2.8500    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    4.1850    1.5880    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    6.6540    2.6870    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    7.2880    1.2620    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    6.3710    0.0000    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    4.8200    0.1630    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n  1  2  2  0  0  0  0\n  2  3  1  0  0  0  0\n  1  4  1  0  0  0  0\n  4  5  2  0  0  0  0\n  5  6  1  0  0  0  0\n  6  3  2  0  0  0  0\n  5  7  1  0  0  0  0\n  7  8  1  0  0  0  0\n  8  9  1  0  0  0  0\n  9  4  1  0  0  0  0\n 10  8  1  0  0  0  0\n 10 11  2  0  0  0  0\n 11 12  1  0  0  0  0\n 12 13  2  0  0  0  0\n 13  9  1  0  0  0  0\nM  APO  1   7   1\nM  END\n> <Name>\nFI\n\n$$$$\n\nMolEngine02241412152D\n\n 10 10  0  0  0  0            999 V2000\n    4.0530    0.0000    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    2.7020    0.7800    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    2.7020    2.3400    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    5.4040    0.7800    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    5.4040    2.3400    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    4.0530    3.1200    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    6.7550    3.1200    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    6.7550    0.0000    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n    1.3510    0.0000    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n    0.0000    0.7800    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n  1  2  1  0  0  0  0\n  2  3  2  0  0  0  0\n  1  4  2  0  0  0  0\n  4  5  1  0  0  0  0\n  5  6  2  0  0  0  0\n  6  3  1  0  0  0  0\n  5  7  1  0  0  0  0\n  4  8  1  0  0  0  0\n  2  9  1  0  0  0  0\n  9 10  1  0  0  0  0\nM  APO  1   7   1\nM  END\n> <Name>\nHmb\n\n$$$$\n\nMolEngine02241412152D\n\n 17 18  0  0  0  0            999 V2000\n    4.0530    4.6800    0.0000 Si  0  0  0  0  0  0  0  0  0  0  0  0\n    5.4040    5.4600    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    2.7020    5.4600    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    4.0530    3.1200    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    6.7550    4.6800    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    5.4040    7.0200    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    6.7550    6.2400    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    1.3510    4.6800    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    0.0000    5.4600    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    2.7020    7.0200    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    1.3510    7.8000    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    0.0000    7.0200    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    5.4040    2.3400    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    5.4040    0.7800    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    2.7020    2.3400    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    2.7020    0.7800    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    4.0530    0.0000    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n  1  2  1  0  0  0  0\n  1  3  1  0  0  0  0\n  1  4  1  0  0  0  0\n  2  5  1  0  0  0  0\n  2  6  1  0  0  0  0\n  2  7  1  0  0  0  0\n  3  8  1  0  0  0  0\n  8  9  2  0  0  0  0\n  3 10  2  0  0  0  0\n 10 11  1  0  0  0  0\n 11 12  2  0  0  0  0\n 12  9  1  0  0  0  0\n  4 13  2  0  0  0  0\n 13 14  1  0  0  0  0\n  4 15  1  0  0  0  0\n 15 16  2  0  0  0  0\n 16 17  1  0  0  0  0\n 17 14  2  0  0  0  0\nM  APO  1   1   1\nM  END\n> <Name>\nTBDPS,BPS,DPS\n\n$$$$\n\nMolEngine02241412152D\n\n 12 12  0  0  0  0            999 V2000\n    4.0530    1.5600    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    2.7020    2.3400    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    2.7020    3.9000    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    5.4040    3.9000    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    4.0530    4.6800    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    1.3510    4.6800    0.0000 N   0  3  0  0  0  0  0  0  0  0  0  0\n    1.3510    6.2400    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n    0.0000    3.9000    0.0000 O   0  5  0  0  0  0  0  0  0  0  0  0\n    5.4040    2.3400    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    6.7550    1.5600    0.0000 S   0  0  0  0  0  0  0  0  0  0  0  0\n    8.1060    2.3400    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n    6.7550    0.0000    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n  1  2  1  0  0  0  0\n  2  3  2  0  0  0  0\n  4  5  2  0  0  0  0\n  5  3  1  0  0  0  0\n  3  6  1  0  0  0  0\n  6  7  2  0  0  0  0\n  6  8  1  0  0  0  0\n  4  9  1  0  0  0  0\n  9 10  1  0  0  0  0\n  9  1  2  0  0  0  0\n 10 11  2  0  0  0  0\n 10 12  2  0  0  0  0\nM  CHG  1   6   1\nM  CHG  1   8  -1\nM  APO  1  10   1\nM  END\n> <Name>\nNos\n\n$$$$\n\nMolEngine02241412152D\n\n 12 12  0  0  0  0            999 V2000\n    0.0000    3.8930    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    0.0000    2.3330    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    1.3510    1.5530    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    2.7020    2.3330    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    2.7020    3.8930    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    1.3510    4.6730    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    4.0490    4.6710    0.0000 S   0  0  0  0  0  0  0  0  0  0  0  0\n    5.3960    3.8930    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n    4.0490    6.2260    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n    4.0490    1.5560    0.0000 N   0  3  0  0  0  0  0  0  0  0  0  0\n    4.0490    0.0000    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n    5.3960    2.3330    0.0000 O   0  5  0  0  0  0  0  0  0  0  0  0\n  1  2  1  0  0  0  0\n  2  3  2  0  0  0  0\n  3  4  1  0  0  0  0\n  4  5  2  0  0  0  0\n  5  6  1  0  0  0  0\n  6  1  2  0  0  0  0\n  5  7  1  0  0  0  0\n  7  8  2  0  0  0  0\n  7  9  2  0  0  0  0\n  4 10  1  0  0  0  0\n 10 11  2  0  0  0  0\n 10 12  1  0  0  0  0\nM  CHG  1  10   1\nM  CHG  1  12  -1\nM  APO  1   7   1\nM  END\n> <Name>\nNs\n\n$$$$\n\nMolEngine02241412152D\n\n  9  9  0  0  0  0            999 V2000\n    0.0000    2.3400    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    0.0000    0.7800    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    1.3510    0.0000    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    2.7020    0.7800    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    2.7020    2.3400    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    1.3510    3.1200    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    4.0490    3.1170    0.0000 S   0  0  0  0  0  0  0  0  0  0  0  0\n    5.3960    2.3400    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n    4.0490    4.6730    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n  1  2  2  0  0  0  0\n  2  3  1  0  0  0  0\n  3  4  2  0  0  0  0\n  4  5  1  0  0  0  0\n  5  6  2  0  0  0  0\n  6  1  1  0  0  0  0\n  5  7  1  0  0  0  0\n  7  8  2  0  0  0  0\n  7  9  2  0  0  0  0\nM  APO  1   7   1\nM  END\n> <Name>\nBos\n\n$$$$\n\nMolEngine02241412152D\n\n  8  8  0  0  0  0            999 V2000\n    2.6940    2.3400    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    2.6940    0.7800    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    4.0450    0.0000    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    5.3960    0.7800    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    5.3960    2.3400    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    4.0450    3.1200    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    1.3470    0.0030    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n    0.0000    0.7800    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n  1  2  1  0  0  0  0\n  2  3  2  0  0  0  0\n  3  4  1  0  0  0  0\n  4  5  2  0  0  0  0\n  5  6  1  0  0  0  0\n  6  1  2  0  0  0  0\n  2  7  1  0  0  0  0\n  7  8  1  0  0  0  0\nM  APO  1   5   1\nM  END\n> <Name>\nPMP\n\n$$$$\n\nMolEngine02241412152D\n\n 11 11  0  0  0  0            999 V2000\n    2.6940    2.3400    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    2.6940    0.7800    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    4.0450    0.0000    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    5.3960    0.7800    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    5.3960    2.3400    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    4.0450    3.1200    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    1.3470    0.0030    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n    0.0000    0.7800    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    6.7430    0.0030    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n    8.0900    0.7800    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    6.7430    3.1180    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n  1  2  2  0  0  0  0\n  2  3  1  0  0  0  0\n  3  4  2  0  0  0  0\n  4  5  1  0  0  0  0\n  5  6  2  0  0  0  0\n  6  1  1  0  0  0  0\n  2  7  1  0  0  0  0\n  7  8  1  0  0  0  0\n  4  9  1  0  0  0  0\n  9 10  1  0  0  0  0\n  5 11  1  0  0  0  0\nM  APO  1  11   1\nM  END\n> <Name>\nDMB\n\n$$$$\n\nMolEngine02241412152D\n\n  4  3  0  0  0  0            999 V2000\n    0.0000    0.7800    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    1.3510    0.0000    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n    0.0000    2.3400    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n    2.7020    0.7800    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n  1  2  1  0  0  0  0\n  1  3  2  0  0  0  0\n  2  4  1  0  0  0  0\nM  APO  1   1   1\nM  END\n> <Name>\n@CO2Me,@COOMe,@COOCH3\n\n$$$$\n\nMolEngine02241412152D\n\n  5  4  0  0  0  0            999 V2000\n    0.0000    0.7800    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    1.3510    0.0000    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n    0.0000    2.3400    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n    2.7020    0.7800    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    4.0530    0.0000    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n  1  2  1  0  0  0  0\n  1  3  2  0  0  0  0\n  2  4  1  0  0  0  0\n  4  5  1  0  0  0  0\nM  APO  1   1   1\nM  END\n> <Name>\n@CO2Et,@COOEt,@COOC2H5\n\n$$$$\n\nMolEngine02241412152D\n\n  2  1  0  0  0  0            999 V2000\n    0.0000    0.0000    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    1.3510    0.7800    0.0000 N   0  0  0  0  0  0  0  0  0  0  0  0\n  1  2  3  0  0  0  0\nM  APO  1   1   1\nM  END\n> <Name>\n@CN\n\n$$$$\n\nMolEngine02241412152D\n\n  2  1  0  0  0  0            999 V2000\n    0.0000    0.0000    0.0000 N   0  3  0  0  0  0  0  0  0  0  0  0\n    1.3510    0.7800    0.0000 C   0  5  0  0  0  0  0  0  0  0  0  0\n  1  2  3  0  0  0  0\nM  CHG  1   1   1\nM  CHG  1   2  -1\nM  APO  1   1   1\nM  END\n> <Name>\n@NC\n\n$$$$\n\nMolEngine02241412152D\n\n  3  2  0  0  0  0            999 V2000\n    0.0000    0.7800    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    0.0000    2.3400    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n    1.3510    0.0000    0.0000 N   0  0  0  0  0  0  0  0  0  0  0  0\n  1  2  2  0  0  0  0\n  1  3  1  0  0  0  0\nM  APO  1   1   1\nM  END\n> <Name>\n@CO2NH2,@COONH2\n\n$$$$\n\nMolEngine02241412152D\n\n  3  2  0  0  0  0            999 V2000\n    0.0000    0.7800    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    0.0000    2.3400    0.0000 O   0  5  0  0  0  0  0  0  0  0  0  0\n    1.3510    0.0000    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n  1  2  1  0  0  0  0\n  1  3  2  0  0  0  0\nM  CHG  1   2  -1\nM  APO  1   1   1\nM  END\n> <Name>\n@CO2-,@COO-\n\n$$$$\n\n   JSDraw202211714252D\n\n  8  7  0  0  0  0              0 V2000\n   20.0720   -9.3080    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n   21.4230   -8.5280    0.0000 S   0  0  0  0  0  0  0  0  0  0  0  0\n   22.7740   -7.7480    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n   20.6430   -7.1770    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n   22.2030   -9.8790    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n   24.1250   -6.9680    0.0000 F   0  0  0  0  0  0  0  0  0  0  0  0\n   22.7740   -6.1880    0.0000 F   0  0  0  0  0  0  0  0  0  0  0  0\n   24.1250   -8.5280    0.0000 F   0  0  0  0  0  0  0  0  0  0  0  0\n  1  2  1  0  0  0  0\n  2  3  1  0  0  0  0\n  2  4  2  0  0  0  0\n  2  5  2  0  0  0  0\n  3  6  1  0  0  0  0\n  3  7  1  0  0  0  0\n  3  8  1  0  0  0  0\nM  APO  1   1   1\nM  END\n> <Name>\n@OTf\n\n$$$$\n\nMolEngine02241412152D\n\n  0  0  0  0  0  0            999 V2000\nM  END\n> <Name>\nResin\n\n$$$$\n\n   JSDraw205221907492D\n\n  8  7  0  0  0  0              0 V2000\n   14.4040   -8.5800    0.0000 N   0  0  0  0  0  0  0  0  0  0  0  0\n   15.7550   -7.8000    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n   15.7550   -6.2400    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n   17.1060   -8.5800    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n   18.4570   -7.8000    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n   19.8080   -7.0200    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n   17.6770   -6.4490    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n   19.2370   -9.1510    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n  1  2  1  0  0  0  0\n  2  3  2  0  0  0  0\n  2  4  1  0  0  0  0\n  4  5  1  0  0  0  0\n  5  6  1  0  0  0  0\n  5  7  1  0  0  0  0\n  5  8  1  0  0  0  0\nM  APO  2   1   1   1   2\nM  END\n> <Name>\nNboc\n\n$$$$\n\n   JSDraw208021907332D\n\n  2  1  0  0  0  0              0 V2000\n   18.7720   -7.4360    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n   20.1230   -6.6560    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n  1  2  2  0  0  0  0\nM  APO  1   2   1\nM  END\n> <Name>\nCHO\n\n$$$$\n",AA3letters:{A:"Ala",R:"Arg",N:"Asn",D:"Asp",C:"Cys",E:"Glu",Q:"Gln",G:"Gly",H:"His",I:"Ile",L:"Leu",K:"Lys",M:"Met",F:"Phe",P:"Pro",S:"Ser",T:"Thr",W:"Trp",Y:"Tyr",V:"Val",O:"Pyl",U:"Sec",B:"Asx",Z:"Glx",J:"Xle",X:"Xaa"},addSdf:function(f){if(f==null||f==""){return}var h={count:0};var g=f.split("$$$$");for(var c=0;c<g.length;++c){var d=JSDraw2.Table.readSdfRecord(g[c],true);this._addOneRecord(d,h)}},loadFromHelm:function(){if(scil.helm.Monomers==null||scil.helm.Monomers.aas==null){return}var f={count:0};for(var d in scil.helm.Monomers.aas){var c=scil.helm.Monomers.aas[d];this._addOneRecord(this._makeRecord(c),f)}},_makeRecord:function(d){if(this.AminoAcids[d.id]!=null){return null}var l={props:{AA:d.id}};var g=new JSDraw2.Mol();g.setMolfile(d.m);for(var j in d.at){var n=parseInt(j.substr(1));if(!(n>0)){continue}var f=scil.helm.MolViewer.findR(g,j);var h=f.a0;h.attachpoints.push(n);scil.Utils.removeArrayItem(g.atoms,f.a1);scil.Utils.removeArrayItem(g.bonds,f.b)}l.molfile=g.getMolfile();return l},_addOneRecord:function(u,z){if(u==null){return}var c=u.props.AA;var w=u.props.RNA;var h=u.props.DNA;var y=u.props.T;var g=u.props.CT;var t=u.props.NTerm;var f=u.props.CTerm;var x=u.props.Name;var l=new JSDraw2.Mol();l.setMolfile(u.molfile);this.normalize(l);if(x!=null&&x!=""){var q=x.replace(/ /,"").split(",");for(var j=0;j<q.length;++j){var n=q[j];if(n.substr(0,1)=="@"){n=n.substr(1);this.reversible[n]=true}this.dict[n]=l}}else{if(y!=null){this.templates[y]=l}else{if(g!=null){this.customtemplates[g]=l}else{if(t!=null){this.nterminals[t]=l}else{if(f!=null){this.cterminals[f]=l}else{if(c==null&&h==null&&w==null){g="Unnamed - "+(++z.count);this.customtemplates[g]=l}}}}}}if(c!=null&&c!=""){if(c.length==1&&JSDraw2.defaultoptions!=null&&JSDraw2.defaultoptions.use3LetterAAs){var d=this.AA3letters[c];if(d!=null){c=d}}if(this.AminoAcids[c]==null){this.AminoAcids[c]=l}}if(h!=null&&h!=""){this.DNAs[h]=l}if(w!=null&&w!=""){this.RNAs[w]=l}},normalize:function(c){if(c!=null){c.attachpoints=this._moveAttachPoints(c);c.calcHCount();c.mw=c.getMolWeight()}},_moveAttachPoints:function(g){var d=this._getAttachAtoms(g);for(var f=0;f<d.length;++f){var c=d[f];if(c==null){continue}var h=scil.Utils.indexOf(g.atoms,c.a);if(f!=h){g.atoms.splice(h,1);g.atoms.splice(f,0,c.a)}}return d.length},_getAttachAtoms:function(h){var g=[];if(h!=null){for(var d=0;d<h.atoms.length;++d){var c=h.atoms[d];for(var f=0;f<c.attachpoints.length;++f){g[c.attachpoints[f]-1]={apo:c.attachpoints[f],a:c}}}}return g},getNextAttachPoint:function(c){if(c==null||c.superatom==null){return null}var l=c._parent.getAllBonds(c);var g=this._getAttachAtoms(c.superatom);for(var q=0;q<g.length;++q){var d=g[q].apo;var n=false;for(var t=0;t<l.length;++t){var h=l[t];if(h.a1==c&&h.apo1==d||h.a2==c&&h.apo2==d){n=true;break}}if(!n){return d}}return null},_getFirstAttachAtom:function(f){if(f!=null){for(var d=0;d<f.atoms.length;++d){var c=f.atoms[d];if(c.attachpoints.length>0){return c}}}return null},addToMol:function(q,c,B,l){if(B==null||B.isEmpty()){return null}var y=B.clone();var n=[];var f=this._getAttachAtoms(y);if(f.length==0){var n=q.getNeighborBonds(c);for(var t=0;t<n.length;++t){scil.Utils.removeArrayItem(q.bonds,n[t])}scil.Utils.removeArrayItem(q.atoms,c)}else{if(l==null){l=q.medBondLength()}var g=scil.clone(f);var w=0;var x=q.getAllBonds(c);var C=[];for(var t=0;t<x.length;++t){var h=x[t];if(w++==0){if(f.length==1){this._alignMol(q,c,y,f[0].a,l)}else{y.setBondLength(l);var z=c.p;var A=this._getLeftPoint(f);y.offset(z.x-A.x,z.y-A.y)}}var d=null;if(h.a1==c&&h.apo1>0){d=f[h.apo1-1]==null?null:f[h.apo1-1].a;if(d!=null){h.a1=d;f[h.apo1-1]=null}}else{if(h.a2==c&&h.apo2>0){d=f[h.apo2-1]==null?null:f[h.apo2-1].a;if(d!=null){h.a2=d;f[h.apo2-1]=null}}}if(d!=null){n.push(h)}else{C.push(h)}}for(var t=0;t<C.length;++t){var h=C[t];var d=null;for(var u=0;u<f.length;++u){if(f[u]!=null){d=f[u].a;f[u]=null;break}}if(d==null){break}if(h.a1==c){h.a1=d}else{h.a2=d}n.push(h)}for(var u=0;u<g.length;++u){g[u].a.attachpoints=[]}scil.Utils.removeArrayItem(q.atoms,c)}q.mergeMol(y);return{atoms:y.atoms,bonds:n}},_getLeftPoint:function(f){var g=f[0].a.p;for(var d=1;d<f.length;++d){var c=f[d].a;if(c.p.x<g.x){g=c.p}}return g.clone()},_alignMol:function(j,c,n,d,l){if(l>0){n.setBondLength(l)}var f=j.getNeighborBonds(c);if(f.length==0){n.offset(c.p.x-d.p.x,c.p.y-d.p.y)}else{if(f.length==1){n.offset(c.p.x-d.p.x,c.p.y-d.p.y);b=f[0];var h=b.otherAtom(c).p.angleTo(c.p);var g=n.getNeighborBonds(d);if(g.length==1){n.rotate(c.p,h+60-d.p.angleTo(g[0].otherAtom(d).p))}else{if(g.length==2){n.rotate(c.p,h+180-d.p.middleAngle(g[0].otherAtom(d).p,g[1].otherAtom(d).p))}}}else{if(f.length==2){n.offset(c.p.x-d.p.x,c.p.y-d.p.y);var h=c.p.middleAngle(f[0].otherAtom(c).p,f[1].otherAtom(c).p);var g=n.getNeighborBonds(d);if(g.length==1){n.rotate(c.p,h+60-d.p.angleTo(g[0].otherAtom(d).p))}else{if(g.length==2){n.rotate(c.p,h+180-d.p.middleAngle(g[0].otherAtom(d).p,g[1].otherAtom(d).p))}}}else{return false}}}return true},expandRepeat:function(w,g){var g=JSDraw2.Bracket.cast(g);var D=g==null?null:g.getType();if(D==null||D!="mul"&&!new RegExp("^[~][0-9]+$").test(D)||g.atoms==null||g.atoms.length==0||g.expanedatoms!=null){return false}var y=false;var A=g.getSubscript(w);var B=parseInt(A);if(B>1){if(JSDraw2.SuperAtoms.kRepeatMax>0&&B>JSDraw2.SuperAtoms.kRepeatMax){y=true}}else{if(scil.Utils.startswith(A,"~")){B=parseInt(A.substr(1));if(B>1){y=true}}if(!y){return false}}var d=g.atoms;if(g.children!=null){for(var t=0;t<g.children.length;++t){var u=g.children[t].expandedatoms;if(u!=null){for(var n=0;n<u.length;++n){var c=u[n];if(scil.Utils.indexOf(d,c)<0){d.push(c)}}}}}var z=w.getSubMol(d);if(z.openbonds.length>2){return false}if(y){for(var t=0;t<z.atoms.length;++t){z.atoms[t].__repeat=B}return false}g.expandedatoms=[];for(var t=0;t<z.atoms.length;++t){g.expandedatoms.push(z.atoms[t])}var l=z.openbonds[0];var C=z.openbonds[1];for(var q=0;q<B-1;++q){for(var t=0;t<z.atoms.length;++t){var c=z.atoms[t].clone();z.atoms[t]._newatom=c;w._addAtom(c);g.expandedatoms.push(c)}for(var t=0;t<z.bonds.length;++t){var f=z.bonds[t].clone();f.a1=f.a1._newatom;f.a2=f.a2._newatom;w.addBond(f,false)}if(C!=null){var f=C.b.clone();if(f.a1==C.oa){f.a2=f.a2._newatom}else{f.a1=f.a1._newatom}w.addBond(f,false)}if(l!=null){var h=l.b.a1==l.oa?l.b.a2._newatom:l.b.a1._newatom;if(C==null){var x=new JSDraw2.Bond(l.oa,h);w.addBond(x,false)}else{if(C.b.a1==C.oa){C.b.a1=h}else{C.b.a2=h}C.oa=h}}for(var t=0;t<z.atoms.length;++t){z.atoms[t].newatom=null}}return true},collapseRepeat:function(h,f){if(f==null||f.type!="mul"||f.spa==null||f.spa.length==0){return false}var c=h.getSubMol(f.atoms);var l=h.getSubMol(f.spa);if(l.openbonds.length==0&&c.openbonds.length==0){for(var g=0;g<c.atoms.length;++g){if(scil.Utils.indexOf(l.atoms,c.atoms[g])<0){scil.Utils.delFromArray(h.atoms,c.atoms[g])}}for(var g=0;g<c.bonds.length;++g){var d=c.bonds[g];if(scil.Utils.indexOf(l.bonds,d)<0){scil.Utils.delFromArray(h.bonds,d)}}}else{if(l.openbonds.length==1&&c.openbonds.length>1){var j=true;if(l.openbonds[0].b==c.openbonds[0].b){j=false;for(var g=1;g<c.openbonds.length;++g){if(c.openbonds[g].oa!=c.openbonds[0].oa){j=true;break}}}if(!j){for(var g=0;g<c.atoms.length;++g){if(scil.Utils.indexOf(l.atoms,c.atoms[g])<0){scil.Utils.delFromArray(h.atoms,c.atoms[g])}}for(var g=0;g<c.bonds.length;++g){var d=c.bonds[g];if(scil.Utils.indexOf(l.bonds,d)<0&&d!=l.openbonds[0].b){scil.Utils.delFromArray(h.bonds,d)}}for(var g=1;g<c.openbonds.length;++g){scil.Utils.delFromArray(h.bonds,c.openbonds[g].b)}}}else{if(l.openbonds.length==2&&c.openbonds.length==2){if(l.openbonds[0].b==c.openbonds[0].b){c.openbonds[0]=null;if(l.openbonds[1].b==c.openbonds[1].b){c.openbonds[1]=null}else{l.openbonds[1].b.replaceAtom(l.openbonds[1].oa,c.openbonds[1].oa)}}else{if(l.openbonds[0].b==c.openbonds[1].b){c.openbonds[1]=null;if(l.openbonds[1].b==c.openbonds[0].b){c.openbonds[1]=null}else{l.openbonds[1].b.replaceAtom(l.openbonds[1].oa,c.openbonds[0].oa)}}else{if(l.openbonds[1].b==c.openbonds[0].b){c.openbonds[0]=null;if(l.openbonds[0].b==c.openbonds[1].b){c.openbonds[0]=null}else{l.openbonds[0].b.replaceAtom(l.openbonds[0].oa,c.openbonds[1].oa)}}else{if(l.openbonds[1].b==c.openbonds[1].b){c.openbonds[1]=null;if(l.openbonds[0].b==c.openbonds[0].b){c.openbonds[0]=null}else{l.openbonds[0].b.replaceAtom(l.openbonds[0].oa,c.openbonds[0].oa)}}else{l.openbonds[0].b.replaceAtom(l.openbonds[0].oa,c.openbonds[0].oa);l.openbonds[1].b.replaceAtom(l.openbonds[1].oa,c.openbonds[1].oa)}}}}for(var g=0;g<c.atoms.length;++g){if(scil.Utils.indexOf(l.atoms,c.atoms[g])<0){scil.Utils.delFromArray(h.atoms,c.atoms[g])}}for(var g=0;g<c.bonds.length;++g){var d=c.bonds[g];if(scil.Utils.indexOf(l.bonds,d)<0&&d!=l.openbonds[0].b&&d!=l.openbonds[1].b){scil.Utils.delFromArray(h.bonds,d)}}if(c.openbonds[0]!=null){scil.Utils.delFromArray(h.bonds,c.openbonds[0].b)}if(c.openbonds[1]!=null){scil.Utils.delFromArray(h.bonds,c.openbonds[1].b)}}else{return false}}}f.expandedatoms=f.atoms;f.atoms=f.spa;return true},download:function(d){var c=this;JSDraw2.abbreviations=null;scil.Utils.download(d,function(f){JSDraw2.abbreviations=f;c.addSdf(JSDraw2.abbreviations)})}});JSDraw2.Arrow=scilligence.extend(scilligence._base,{constructor:function(c,d){this.T="ARROW";this.p1=c;this.p2=d;this.color=null;this.selected=false;this.arrowstyle=null},html:function(d){var c="<i i='"+this.id+"' x='"+this.T+"' p1='"+this.p1.toString(d)+"' p2='"+this.p2.toString(d)+"'";if(!scil.Utils.isNullOrEmpty(this.arrowstyle)){c+=" as='"+this.arrowstyle+"'"}if(this.color!=null){c+=" clr='"+this.color+"'"}c+="></i>";return c},readHtml:function(c){this.p1=JSDraw2.Point.fromString(c.getAttribute("p1"));this.p2=JSDraw2.Point.fromString(c.getAttribute("p2"));this.arrowstyle=c.getAttribute("as");return true},clone:function(){var c=new JSDraw2.Arrow(this.p1.clone(),this.p2.clone());c.id=this.id;c.color=this.color;c.arrowstyle=this.arrowstyle;return c},flipY:function(c){this.p1.y=c-(this.p1.y-c);this.p2.y=c-(this.p2.y-c)},flipX:function(c){this.p1.x=c-(this.p1.x-c);this.p2.x=c-(this.p2.x-c)},scale:function(d,c){this.p1.scale(d,c);this.p2.scale(d,c)},offset:function(c,d){this.p1.offset(c,d);this.p2.offset(c,d)},rect:function(){return new JSDraw2.Rect(Math.min(this.p1.x,this.p2.x),Math.min(this.p1.y,this.p2.y),Math.abs(this.p1.x-this.p2.x),Math.abs(this.p1.y-this.p2.y))},isLeftToRight:function(){var c=this.p2.angleTo(this.p1);return c<=15||c>=345},toggle:function(f,g){var c=this.p1.distTo(f)+this.p2.distTo(f)-this.p1.distTo(this.p2);return Math.abs(c)<=g/6},drawCur:function(g,f,c){var d=new JSDraw2.Point((this.p1.x+this.p2.x)/2,(this.p1.y+this.p2.y)/2);g.createCircle({cx:d.x,cy:d.y,r:f}).setFill(c)},draw:function(f,d){var c=this.color==null||this.color.length==0?"black":this.color;JSDraw2.Drawer.drawArrow(f,this.p1,this.p2,c,d,null,this.arrowstyle)},drawSelect:function(c){c.draw(this,[this.p1,this.p2])},cornerTest:function(c,d){if(c.distTo(this.p1)<d){return"start"}else{if(c.distTo(this.p2)<d){return"end"}}return null},resize:function(c,f){if(c=="start"){this.p1.offset(f.x,f.y)}else{if(c=="end"){this.p2.offset(f.x,f.y)}}}});JSDraw2.Arrow.cast=function(c){return c!=null&&c.T=="ARROW"?c:null};JSDraw2.ChemDraw={chemdraw:null,chemdrawDlg:null,msg:null,btn:null,ispasting:null,applet:null,onappletstart:null,javaenabled:navigator.javaEnabled(),failuremessage:"In order to do general copy and paste for ChemDraw, ISIS/Draw, SciFinder, Word, etc., either Java or ChemDraw is needed.",versions:{"18":"clsid:BFC17D2E-4BAB-4DA2-AFFE-0554CD12FFAF","17":"clsid:DE727D51-7109-4A3A-8F67-94AECB3D9782","16":"clsid:B8350810-35B3-46F8-AA9B-FC649FFF06DF","15":"clsid:F974516A-2072-4AF1-B063-489FAA6D4177","14":"clsid:8B0D4252-4E82-463a-84ED-E8A796C4808A","13":"clsid:8B0D4252-4E82-463a-84ED-E8A796C4808A","12":"clsid:4A6F3C59-D184-49FA-9189-AF42BEDFE5E4","11":"clsid:45C31980-E065-49A1-A3D7-E69CD40DAF66","10":"clsid:7EF697A4-D9F3-4303-9161-BBBEA1C30097","9":"clsid:60257C74-D60B-41D6-9296-A08BD51F15B5","8":"clsid:51A649C4-3E3D-4557-9BD8-B14C0AD44B0C","7":"clsid:AF2D2DC1-75E4-4123-BC0B-A57BD5C5C5D2"},CD_CONTROL_CLSID:"clsid:4A6F3C59-D184-49FA-9189-AF42BEDFE5E4",paste:function(f,j){if(!this.javaenabled||JSDraw2.defaultoptions!=null&&JSDraw2.defaultoptions.pasteuseapplet==false){this.pasteUseCdax(f,j);return}if(this.applet==null){this.onappletstart=function(){JSDraw2.ChemDraw.paste(f,j)};this.createApplet();return}var c=this.getApplet();try{c.isReady()}catch(d){this.javaenabled=false;this.pasteUseCdax(f,j);return}var h=c.getMolfile();if(h!=null&&h!=""){if(scilligence.Utils.startswith(h,"ERROR:")){scilligence.Utils.alert(h)}else{var g=new JSDraw2.Mol();g.setMolfile(h);if(f.pasteMol(g,null,j)){f.redraw();f.doCmd("lasso")}}if(f.options.onCdxPasted!=null){f.options.onCdxPasted()}return}scilligence.Utils.alert("No structure data found on clipboard")},pasteUseCdax:function(c,d){if(scilligence.Utils.isIE){this.doIE(c,true,d)}else{this.doNonIE(c,true,d)}},copy:function(f){var l=f.options.viewonly!=true&&f.options.popup!=null;if(l&&!f.m.hasSelected()){scil.Utils.alert("No structure selected");return}if(!this.javaenabled){this.copyUseCdax(f);return}if(this.applet==null){this.onappletstart=function(){JSDraw2.ChemDraw.copy(f)};this.createApplet();return}var c=this.getApplet();try{c.isReady()}catch(d){this.javaenabled=false;this.copyUseCdax(f);return}var h=this;var n=scil.Utils.serviceAvailable()?JSDrawServices.url:null;var g=f.m.clone(l);var j=g.getMolfile(false,false,true);if(n==null){h.copy2(j,"{\\rtf1\\ansi\\ansicpg1252\\deff0\\deflang1033{\\colortbl ;\\red255\\green0\\blue0;}\\viewkind4\\uc1\\pard\\sa200\\sl276\\slmult1\\cf1\\lang9\\f0\\fs22 (In order to copy to Word, JSDraw Web Service is needed)}")}else{scil.Utils.ajax(n+"?cmd=jsdraw2rtf",function(q){h.copy2(j,q.rtf)},{jsdraw:g.getXml()})}},getApplet:function(){if(this.applet==null){return null}return this.applet.contentWindow!=null?this.applet.contentWindow:this.applet},copy2:function(d,g){var c=this.getApplet();var f=c.setMolfile(d,g);if(f!="OK"){scil.Utils.alert(f)}},copyUseCdax:function(c){if(scilligence.Utils.isIE){this.doIE(c,false)}else{this.doNonIE(c,false)}},createApplet:function(){if(this.applet!=null){return this.applet}scilligence.Utils.alert("This is going to launch JSDraw Clipboard Utils Java Applet.  Once this Utils is running, you can do copy/paste");this.applet=scil.Utils.createElement(document.body,"iframe",null,{width:1,height:1},{frameborder:0});this.applet.src=scil.Utils.scriptUrl()+"JSDrawClipboard.htm?JSDrawClipboard_onstart()";return null},doNonIE:function(h,j,l){this.ispasting=j;if(this.chemdraw==null){var f=scilligence.Utils.createElement(null,"div");this.msg=scilligence.Utils.createElement(f,"div","",{color:"red"});this.chemdraw=scilligence.Utils.createElement(f,"EMBED",null,{width:"500px",height:"200px",border:"solid 1px gray"},{type:"chemical/x-cdx",showtoolswhenvisible:0});if(this.chemdraw!=null){var c=scilligence.Utils.createElement(f,"div",null,{textAlign:"center"});this.btn=scilligence.Utils.createElement(c,"button","");dojo.connect(this.btn,"onclick",function(){JSDraw2.ChemDraw.doneNonIE(l)});this.chemdrawDlg=new JSDraw2.Dialog("",f)}}if(this.chemdraw==null||this.chemdraw.notinstalled){scilligence.Utils.alert(this.failuremessage);return}this.chemdrawDlg.show((j?"Paste":"Copy")+" ChemDraw",9999999);this.chemdrawDlg.jsdraw=h;if(j){this.msg.innerHTML="Please right-click below box, and click Paste, then click Save button:";this.btn.innerHTML="Paste ChemDraw Structure"}else{this.msg.innerHTML="Please copy the structure below:";this.btn.innerHTML="Done"}try{this.chemdraw.clear();if(!j){this.chemdraw.putData(1,h.getMolfile())}this.chemdraw.focus()}catch(g){this.chemdraw.notinstalled=true;this.chemdrawDlg.hide(true)}},doneNonIE:function(d){this.chemdrawDlg.hide();if(!this.ispasting){return}var c=this.chemdraw.getData(1);if(c!=null&&c.length>90){if(this.chemdrawDlg.jsdraw.pasteMol(c,null,d)){this.chemdrawDlg.jsdraw.redraw()}}else{scil.Utils.alert("No data to paste")}},doIE:function(g,j,l){if(this.chemdraw==null){if(this.isCDActiveXInstalled()==false){scilligence.Utils.alert("No ChemDraw found");return}var f=scilligence.Utils.createElement(null,"div");this.chemdraw=scilligence.Utils.createElement(f,"object",null,{width:"500px",height:"200px"},{classid:this.CD_CONTROL_CLSID});if(this.chemdraw!=null){var c=scilligence.Utils.createElement(f,"div",null,{textAlign:"center"});this.btn=scilligence.Utils.createElement(c,"button","Done");dojo.connect(this.btn,"onclick",function(){JSDraw2.ChemDraw.chemdrawDlg.hide()});this.chemdrawDlg=new JSDraw2.Dialog("Copy ChemDraw",f)}}if(this.chemdraw==null||this.chemdraw.Objects==null){scil.Utils.alert(this.failuremessage);return}this.chemdraw.Objects.clear();if(j){this.chemdraw.ActiveDocument.paste();var h=this.chemdraw.Objects.Data("chemical/x-mdl-rxn");if(h!=null&&h.length>90){g.pasteMol(h,null,l)}else{scil.Utils.alert("No ChemDraw data on clipboard")}}else{this.chemdrawDlg.show();this.chemdraw.Objects.Data("chemical/x-mdl-rxn")=g.getMolfile()}},isCDActiveXInstalled:function(){for(var c in this.versions){if(this.checkOneVersion(c)){JSDraw2.ChemDraw.CD_CONTROL_CLSID=this.versions[c];return true}}return false},checkOneVersion:function(ver){if(JSDraw2.ChemDraw.__testgood){return true}var str='try\n{\n	// Try ##.0\n	var obj=new ActiveXObject("ChemDrawControl'+ver+".ChemDrawCtl\");\n	JSDraw2.ChemDraw.__testgood=true;obj='';\n} catch(e)\n{\n}";eval(str);return JSDraw2.ChemDraw.__testgood}};JSDrawClipboard_onstart=function(){if(JSDraw2.ChemDraw.onappletstart!=null){JSDraw2.ChemDraw.onappletstart();JSDraw2.ChemDraw.onappletstart=null}};JSDraw2.Curve=scilligence.extend(scilligence._base,{constructor:function(d,g,f,h){this.T="CURVE";this.p1=d;this.p2=g;if((f==null||h==null)&&d!=null&&g!=null){var c=JSDraw2.Curve.calcAnchors(this.p1,this.p2);f=c.p1a;h=c.p2a}this.p1a=f;this.p2a=h;this.color=null;this.selected=false},html:function(d){var c="<i i='"+this.id+"' x='"+this.T+"' p1='"+this.p1.toString(d)+"' p2='"+this.p2.toString(d)+"' p1a='"+this.p1a.toString(d)+"' p2a='"+this.p2a.toString(d)+"'";if(this.color!=null){c+=" clr='"+this.color+"'"}c+="></i>";return c},readHtml:function(c){this.p1=JSDraw2.Point.fromString(c.getAttribute("p1"));this.p2=JSDraw2.Point.fromString(c.getAttribute("p2"));this.p1a=JSDraw2.Point.fromString(c.getAttribute("p1a"));this.p2a=JSDraw2.Point.fromString(c.getAttribute("p2a"));return true},clone:function(){var c=new JSDraw2.Curve(this.p1.clone(),this.p2.clone(),this.p1a.clone(),this.p2a.clone());c.id=this.id;c.color=this.color;return c},flip:function(){this.p1a.flip(this.p1,this.p2);this.p2a.flip(this.p2,this.p1)},flipY:function(c){this.p1.y=c-(this.p1.y-c);this.p2.y=c-(this.p2.y-c);this.p1a.y=c-(this.p1a.y-c);this.p2a.y=c-(this.p2a.y-c)},flipX:function(c){this.p1.x=c-(this.p1.x-c);this.p2.x=c-(this.p2.x-c);this.p1a.x=c-(this.p1a.x-c);this.p2a.x=c-(this.p2a.x-c)},scale:function(d,c){this.p1.scale(d,c);this.p2.scale(d,c);this.p1a.scale(d,c);this.p2a.scale(d,c)},offset:function(c,d){this.p1.offset(c,d);this.p2.offset(c,d);this.p1a.offset(c,d);this.p2a.offset(c,d)},rect:function(){return new JSDraw2.Rect(Math.min(this.p1.x,this.p2.x),Math.min(this.p1.y,this.p2.y),Math.abs(this.p1.x-this.p2.x),Math.abs(this.p1.y-this.p2.y))},isLeftToRight:function(){var c=this.p2.angleTo(this.p1);return c<=15||c>=345},toggle:function(d,g){var c=d.inTriangle(this.p1,this.p1a,this.p2)||d.inTriangle(this.p2,this.p2a,this.p1)||d.inTriangle(this.p1a,this.p1,this.p2a)||d.inTriangle(this.p2a,this.p2,this.p1a);if(!c){g/=2;c=this.p1.distTo(d)<=g||this.p2.distTo(d)<=g||this.p1a.distTo(d)<=g||this.p2a.distTo(d)<=g}return c},drawCur:function(f,d,c){this.draw4Points(f,d,d/2,c)},draw:function(f,d){var c=this.color==null||this.color.length==0?"black":this.color;JSDraw2.Drawer.drawCurveArrow(f,this.p1,this.p2,this.p1a,this.p2a,c,d/2)},drawSelect:function(c){JSDraw2.Drawer.drawLine(c.surface,this.p1,this.p1a,"gray",c.linewidth/3,10);JSDraw2.Drawer.drawLine(c.surface,this.p2,this.p2a,"gray",c.linewidth/3,10);c.draw(this,[this.p1,this.p2,this.p1a,this.p2a])},draw4Points:function(g,d,f,c){g.createCircle({cx:this.p1.x,cy:this.p1.y,r:d}).setFill(c);g.createCircle({cx:this.p2.x,cy:this.p2.y,r:d}).setFill(c);g.createCircle({cx:this.p1a.x,cy:this.p1a.y,r:f}).setFill(c);g.createCircle({cx:this.p2a.x,cy:this.p2a.y,r:f}).setFill(c)},cornerTest:function(c,d){if(c.distTo(this.p1)<d){return"start"}else{if(c.distTo(this.p2)<d){return"end"}else{if(c.distTo(this.p1a)<d){return"start.a"}else{if(c.distTo(this.p2a)<d){return"end.a"}}}}return null},resize:function(c,f){if(c=="start"){this.p1.offset(f.x,f.y)}else{if(c=="end"){this.p2.offset(f.x,f.y)}else{if(c=="start.a"){this.p1a.offset(f.x,f.y)}else{if(c=="end.a"){this.p2a.offset(f.x,f.y)}}}}}});scilligence.apply(JSDraw2.Curve,{cast:function(c){return c!=null&&c.T=="CURVE"?c:null},calcAnchors:function(g,h,f,j){var l={};if(f==null){f=80}if(j==null){j=0.5}var c=g.distTo(h);l.p2a=g.clone().rotateAround(h,f,c*j);l.p1a=h.clone().rotateAround(g,-f,c*j);return l}});JSDraw2.Ink=scilligence.extend(scilligence._base,{constructor:function(c){this.list=[];this.ink=null;this.width=10;this.surface=c},clear:function(){this.end();this.list=[];this.surface.clear()},clearLastOne:function(){this.end();if(this.list.length==0){return}var c=this.list[this.list.length-1];this.list.splice(this.list.length-1,1);this.surface.remove(c)},start:function(c,d){switch(c){case"blue":c=[0,0,255,0.5];break;case"green":c=[0,255,0,0.5];break;default:c=[255,0,0,0.5];break}this.ink=this.surface.createPath("M"+d.x+","+d.y).setStroke({color:c,width:this.width,cap:"round"})},add:function(c){if(this.ink==null){return false}this.ink.lineTo(c.x,c.y);return true},end:function(){if(this.ink==null){return false}this.list.push(this.ink);this.ink=null;return true},cancel:function(){if(this.ink==null){return false}this.surface.remove(this.ink);this.ink=null;return true}});JSDraw2.Plus=scilligence.extend(scilligence._base,{constructor:function(c){this.T="PLUS";this.p=c;this.color=null;this.selected=false},html:function(d){var c="<i i='"+this.id+"' x='"+this.T+"' p='"+this.p.toString(d)+"'";if(this.color!=null){c+=" clr='"+this.color+"'"}c+="></i>";return c},clone:function(){var c=new JSDraw2.Plus(this.p.clone());c.id=this.id;c.color=this.color;return c},flipY:function(c){this.p.y=c-(this.p.y-c)},flipX:function(c){this.p.x=c-(this.p.x-c)},scale:function(d,c){this.p.scale(d,c)},offset:function(c,d){this.p.offset(c,d)},rect:function(){return new JSDraw2.Rect(this.p.x,this.p.y,0,0)},toggle:function(f,g){var c=this.p.distTo(f);return Math.abs(c)<=g},drawCur:function(f,d,c){f.createCircle({cx:this.p.x,cy:this.p.y,r:d}).setFill(c)},draw:function(h,g){var f=g*4;var c=this.color==null||this.color.length==0?"black":this.color;JSDraw2.Drawer.drawLine(h,new JSDraw2.Point(this.p.x,this.p.y-f),new JSDraw2.Point(this.p.x,this.p.y+f),c,g);JSDraw2.Drawer.drawLine(h,new JSDraw2.Point(this.p.x-f,this.p.y),new JSDraw2.Point(this.p.x+f,this.p.y),c,g)},drawSelect:function(c){c.draw(this,this.p)}});JSDraw2.Plus.cast=function(c){return c!=null&&c.T=="PLUS"?c:null};JSDraw2.SGroup={allfieldtypes:["-","IDS_DESCRIPTION","POLYMER_MW","RATIO","RATIO_MAX","RATIO_UNITS","STEREO_LABEL","DELOCALIZED_CHARGE"],types:{"":"Generic",c:"Component",co:"Copolymer",mix:"Mixture",mon:"Monomer",n:"SRU",f:"Formulation",mer:"Mer type",any:"Any","#":"Multiple Group"},subtypes:{mix:["None","-","Ordered (or)","Unordered (un)"],co:["None","-","Alternating (alt)","Block (blk)","Random (ran)"]},connectivities:{SRU:["None","-","Head to Tail (ht)","Head to Head (hh)","Either/Unknown (eu)"],co:["None","-","Head to Tail (ht)","Head to Head (hh)","Either/Unknown (eu)"]},modflags:{c:["None","-","Modified (mod)"],SRU:["None","-","Modified (mod)","Graft (grf)"],mon:["None","-","Modified (mod)","Graft (grf)"],co:["None","-","Modified (mod)","Graft (grf)"]},stys:{"":"GEN",c:"COM",co:"COP",mix:"MIX",mon:"MON",n:"SRU",f:"FOR",sup:"SUP",mer:"MER",any:"ANY",mul:"MUL"},fieldtypes:{},ratios:{c:true,mon:true},getDisplayTypes:function(){var d=[];for(var c in this.types){d.push(this.types[c]+(c==null||c==""?"":"("+c+")"))}return d}};JSDraw2.Shape=scilligence.extend(scilligence._base,{constructor:function(d,f,c){this.T="SHAPE";this.centercolor="#eee";this._rect=d;this.type=f;this.fill=c;this.text=null;this.fontsize=1;this.textcolor=null;this.color=null;this.selected=false;this.froms=[];this.outputstatus=null;this.reject=null;this.cancel=false;this.userrole=null;this.userfield=null;this.user=null;this.ccemails=null;this.silent=null;this.externalaction=null;this.externalscript=null;this.subform=null;this.regjectsubform=null;this.scripttype=null;this.script=null;this.timeline=null;this.workdays=null;this.condition=null;this.bypass=null;this.deferdays=null;this.subreq=null;this.subreqid=null;this.subreqdataout=null;this.subreqdataback=null;if(f=="dshape"){this.text="Wait";this.userrole="(script)"}else{if(f=="dreversed"){this.text="Parallel";this.userrole="(script)"}}},html:function(f){var d="<i i='"+this.id+"' x='"+this.T+"' type='"+this.type+"'"+(this.fill!=null?" fill='"+this.fill+"'":"")+" p='"+this._rect.toString(f)+"'";if(!scil.Utils.isNullOrEmpty(this.color)){d+=" clr='"+this.color+"'"}if(!scil.Utils.isNullOrEmpty(this.textcolor)){d+=" textcolor='"+this.textcolor+"'"}if(this.fontsize>0){d+=" fontsize='"+this.fontsize+"'"}if(this.froms!=null){var g="";for(var c=0;c<this.froms.length;++c){g+=(g==""?"":",")+this.froms[c].id}if(g!=""){d+=" from='"+g+"'"}}if(!scil.Utils.isEmptyStr(this.outputstatus)){d+=" outputstatus='"+scil.Utils.escXmlValue(this.outputstatus)+"'"}if(!scil.Utils.isEmptyStr(this.reject)){d+=" reject='"+this.reject.id+"'"}if(this.cancel){d+=" cancel='1'"}if(!scil.Utils.isEmptyStr(this.userrole)){d+=" userrole='"+scil.Utils.escXmlValue(this.userrole)+"'"}if(!scil.Utils.isEmptyStr(this.userfield)){d+=" userfield='"+scil.Utils.escXmlValue(this.userfield)+"'"}if(!scil.Utils.isEmptyStr(this.user)){d+=" user='"+scil.Utils.escXmlValue(this.user)+"'"}if(!scil.Utils.isEmptyStr(this.ccemails)){d+=" ccemails='"+scil.Utils.escXmlValue(this.ccemails)+"'"}if(scil.Utils.isTrue(this.silent)){d+=" silent='1'"}if(scil.Utils.isTrue(this.externalaction)){d+=" externalaction='1'"}if(!scil.Utils.isEmptyStr(this.externalscript)){d+=" externalscript='"+scil.Utils.escXmlValue(this.externalscript)+"'"}if(!scil.Utils.isEmptyStr(this.subform)){d+=" subform='"+scil.Utils.escXmlValue(this.subform)+"'"}if(!scil.Utils.isEmptyStr(this.scripttype)){d+=" scripttype='"+scil.Utils.escXmlValue(this.scripttype)+"'"}if(!scil.Utils.isEmptyStr(this.script)){d+=" script='"+scil.Utils.escXmlValue(this.script)+"'"}if(!scil.Utils.isEmptyStr(this.timeline)){d+=" timeline='"+scil.Utils.escXmlValue(this.timeline)+"'"}if(!scil.Utils.isEmptyStr(this.workdays)){d+=" workdays='"+scil.Utils.escXmlValue(this.workdays)+"'"}if(!scil.Utils.isEmptyStr(this.condition)){d+=" condition='"+scil.Utils.escXmlValue(this.condition)+"'"}if(!scil.Utils.isEmptyStr(this.bypass)){d+=" bypass='"+scil.Utils.escXmlValue(this.bypass)+"'"}if(!scil.Utils.isEmptyStr(this.deferdays)){d+=" deferdays='"+scil.Utils.escXmlValue(this.deferdays)+"'"}if(!scil.Utils.isEmptyStr(this.subreq)){d+=" subreq='"+scil.Utils.escXmlValue(this.subreq)+"'"}if(!scil.Utils.isEmptyStr(this.subreqid)){d+=" subreqid='"+scil.Utils.escXmlValue(this.subreqid)+"'"}if(!scil.Utils.isEmptyStr(this.subreqdataout)){d+=" subreqdataout='"+scil.Utils.escXmlValue(this.subreqdataout)+"'"}if(!scil.Utils.isEmptyStr(this.subreqdataback)){d+=" subreqdataback='"+scil.Utils.escXmlValue(this.subreqdataback)+"'"}d+=">";if(this.text!=null){d+=scil.Utils.escXmlValue(this.text)}d+="</i>";return d},readHtml:function(c){var f=JSDraw2.Rect.fromString(c.getAttribute("p"));this._rect=f;this.text=c.text||c.textContent;this.type=c.getAttribute("type");this.fill=c.getAttribute("fill");this.textcolor=c.getAttribute("textcolor");var d=parseFloat(c.getAttribute("fontsize"));if(d>0){this.fontsize=d}this.fromindices=c.getAttribute("from");var g=c.getAttribute("reject");this.rejectindex=scil.Utils.isNullOrEmpty(g)?null:parseInt(g);this.outputstatus=c.getAttribute("outputstatus");this.cancel=scil.Utils.isTrue(c.getAttribute("cancel"));this.userrole=c.getAttribute("userrole");this.userfield=c.getAttribute("userfield");this.user=c.getAttribute("user");this.ccemails=c.getAttribute("ccemails");this.silent=scil.Utils.isTrue(c.getAttribute("silent"));this.externalaction=scil.Utils.isTrue(c.getAttribute("externalaction"));this.externalscript=c.getAttribute("externalscript");this.subform=c.getAttribute("subform");this.scripttype=c.getAttribute("scripttype");this.script=c.getAttribute("script");this.timeline=c.getAttribute("timeline");this.condition=c.getAttribute("condition");this.bypass=c.getAttribute("bypass");this.deferdays=c.getAttribute("deferdays");this.subreq=c.getAttribute("subreq");this.subreqid=c.getAttribute("subreqid");this.subreqdataout=c.getAttribute("subreqdataout");this.subreqdataback=c.getAttribute("subreqdataback");var g=c.getAttribute("workdays");this.workdays=scil.Utils.isEmptyStr(g)||isNaN(g)?null:parseFloat(g);return true},clone:function(){var c=new JSDraw2.Shape(this._rect.clone(),this.type,this.fill);c.id=this.id;c.color=this.color;c.textcolor=this.textcolor;c.text=this.text;c.fontsize=this.fontsize;c.reject=this.reject;c.cancel=this.cancel;c.outputstatus=this.outputstatus;c.userrole=this.userrole;c.userfield=this.userfield;c.user=this.user;c.ccemails=this.ccemails;c.silent=this.silent;c.externalaction=this.externalaction;c.externalscript=this.externalscript;c.subform=this.subform;c.scripttype=this.scripttype;c.script=this.script;c.timeline=this.timeline;c.workdays=this.workdays;c.condition=this.condition;c.bypass=this.bypass;c.deferdays=this.deferdays;c.subreq=this.subreq;c.subreqid=this.subreqid;c.subreqdataout=this.subreqdataout;c.subreqdataback=this.subreqdataback;return c},flipY:function(c){},flipX:function(c){},scale:function(d,c){this._rect.scale(d,c)},offset:function(c,d){this._rect.offset(c,d)},rect:function(){return this._rect.clone()},toggle:function(c,d){return this._rect.contains(c)||this._rect.cornerTest(c,d)!=null},removeObject:function(c){scil.Utils.delFromArray(this.froms,c);if(this.reject==c){this.reject=null}},drawCur:function(l,j,d,g,c){this._drawAnchor(l,j/2,d);if(c=="arrow"){var h=this._rect;var f=j/16;l.createCircle({cx:h.left+h.width/2,cy:h.bottom()-j/2,r:j/2}).setFill(d)}},draw:function(D,w,x,q){var h=this.color==null||this.color.length==0?"black":this.color;var C=null;switch(this.type){case"rectangle":C=JSDraw2.Drawer.drawRect(D,this._rect,h,w/2,5);break;case"dshape":C=JSDraw2.Drawer.drawDShape(D,this._rect,h,w/2);break;case"dreversed":C=JSDraw2.Drawer.drawDShape(D,this._rect,h,w/2,true);break;case"ellipse":C=JSDraw2.Drawer.drawEllipse(D,this._rect,h,w/2);break;case"diamond":C=JSDraw2.Drawer.drawDiamond(D,this._rect,h,w/2);break;case"doublearrow":C=JSDraw2.Drawer.drawDoubleArrow(D,this._rect,h,w);break}if(C!=null&&this.fill!=null&&this.fill!=""&&this.type!="doublearrow"){var g=this._rect.center();var z=this._rect.clone();if(dojox.gfx.renderer=="silverlight"){z.offset(-z.left,-z.top)}switch(this.fill){case"solid":C.setFill(h);break;case"linear":C.setFill({type:"linear",x1:z.left,y1:z.top,x2:z.right(),y2:z.bottom(),colors:[{offset:0,color:h},{offset:0.5,color:this.centercolor},{offset:1,color:h}]});break;case"linear-x":C.setFill({type:"linear",x1:z.left,y1:g.y,x2:z.right(),y2:g.y,colors:[{offset:0,color:h},{offset:0.5,color:this.centercolor},{offset:1,color:h}]});break;case"linear-y":C.setFill({type:"linear",x1:g.x,y1:z.top,x2:g.x,y2:z.bottom(),colors:[{offset:0,color:h},{offset:0.5,color:this.centercolor},{offset:1,color:h}]});break;case"radial":C.setFill(dojo.mixin({type:"radial",cx:g.x,cy:g.y,r:Math.max(z.width,z.height)},{colors:[{offset:0,color:this.centercolor},{offset:0.5,color:h},{offset:1,color:this.centercolor}]}));break}}var A="";if(!scil.Utils.isEmptyStr(this.timeline)){A+=this.timeline}if(!scil.Utils.isEmptyStr(this.workdays)){A+="("+this.workdays+")"}if(A!=""){JSDraw2.Drawer.drawText(D,this._rect.topright().offset(0,-q*1.15),A,h,q*0.75,"right")}for(var t=0;t<this.froms.length;++t){var n=this.froms[t];if(n==null){continue}var g=n.color==h?h:"black";var u=this.drawArrow(D,n,this,g,w*0.75,true);if(!scil.Utils.isEmptyStr(this.condition)){var d=u.p2.angleTo(u.p1);if(d>90&&d<270){d-=180}var j=q*0.8*Math.sin(d*Math.PI/180);var l=q*0.8*Math.cos(d*Math.PI/180);var y=new JSDraw2.Point((u.p1.x+u.p2.x)/2-j,(u.p1.y+u.p2.y)/2-l);JSDraw2.Drawer.drawText2(D,y,this.condition,g,q*0.8,d/180*Math.PI)}}if(this.reject!=null){this.drawSideArrow(D,this,this.reject,"black",w*0.75)}if(!scil.Utils.isEmptyStr(this.text)){var B=this.fontsize>0?this.fontsize:1;JSDraw2.Drawer.drawText2(D,this._rect.center(),this.text,scil.Utils.isNullOrEmpty(this.textcolor)?h:this.textcolor,q*B)}if(!scil.Utils.isEmptyStr(this.bypass)){this.drawBypassArrow(D,h,q,w*0.75)}},drawArrow:function(A,l,B,h,q,j){var y=l._rect;var z=B._rect;var f=y.center();var g=z.center();var t,u,w,x;var n=false;if(Math.abs(f.x-g.x)>=Math.abs(f.y-g.y)){n=true;if(f.x<g.x){t=y.centerRight();x=z.centerLeft()}else{t=y.centerLeft();x=z.centerRight()}}else{if(f.y<g.y){t=y.centerBottom();x=z.centerTop()}else{t=y.centerTop();x=z.centerBottom()}}if(j){JSDraw2.Drawer.drawArrow(A,t,x,h,q,null,"solid")}else{var d=new JSDraw2.Point((t.x+x.x)/2,(t.y+x.y)/2);if(n){u=new JSDraw2.Point(d.x,t.y);w=new JSDraw2.Point(d.x,x.y)}else{u=new JSDraw2.Point(t.x,d.y);w=new JSDraw2.Point(x.x,d.y)}JSDraw2.Drawer.drawLine(A,t,u,h,q);JSDraw2.Drawer.drawLine(A,u,w,h,q);JSDraw2.Drawer.drawArrow(A,w,x,h,q,null,"solid")}return{p1:t,p2:x}},drawSideArrow:function(w,g,z,f,h){var t=g._rect;var u=z._rect;var c=t.center();var d=u.center();var j,l,n,q;if(Math.abs(c.x-d.x)>=Math.abs(c.y-d.y)){j=t.centerBottom();q=u.centerBottom();var B=Math.max(j.y,q.y)+h*20;l=new JSDraw2.Point(j.x,B);n=new JSDraw2.Point(q.x,B)}else{j=t.centerRight();q=u.centerRight();var A=Math.max(j.x,q.x)+h*20;l=new JSDraw2.Point(A,j.y);n=new JSDraw2.Point(A,q.y)}JSDraw2.Drawer.drawLine(w,j,l,f,h,h*2);JSDraw2.Drawer.drawLine(w,l,n,f,h,h*2);JSDraw2.Drawer.drawArrow(w,n,q,f,h,h*2,"solid")},drawBypassArrow:function(x,f,g,h){var w=this._rect;var d=w.center();var l=new JSDraw2.Point(w.left,d.y);var n=new JSDraw2.Point(l.x-g,l.y);var q=new JSDraw2.Point(n.x,w.top-g);var t=new JSDraw2.Point(w.right()+g,q.y);var u=new JSDraw2.Point(t.x,n.y);JSDraw2.Drawer.drawLine(x,l,n,f,h,h*2);JSDraw2.Drawer.drawLine(x,n,q,f,h,h*2);JSDraw2.Drawer.drawLine(x,q,t,f,h,h*2);JSDraw2.Drawer.drawArrow(x,t,u,f,h,h*2);var j=new JSDraw2.Point(d.x,w.top-g*1.8);JSDraw2.Drawer.drawText2(x,j,this.bypass,f,g*0.9)},drawSelect:function(c){c.draw(this,this._rect.fourPoints())},_drawAnchor:function(f,d,c){r=this._rect;f.createCircle({cx:r.left,cy:r.top,r:d}).setFill(c);f.createCircle({cx:r.right(),cy:r.top,r:d}).setFill(c);f.createCircle({cx:r.right(),cy:r.bottom(),r:d}).setFill(c);f.createCircle({cx:r.left,cy:r.bottom(),r:d}).setFill(c)},cornerTest:function(c,d){return this._rect.cornerTest(c,d)},resize:function(c,f){this._rect.moveCorner(c,f)},bestConnectPoint:function(c,d){if(this._rect.centerBottom().distTo(c)<d){return{p:this._rect.centerBottom(),connector:"rejector"}}if(c.x>this._rect.right()-d*2){return{p:this._rect.centerRight(),connector:"right"}}if(c.y>this._rect.bottom()-d){return{p:this._rect.centerBottom(),connector:"bottom"}}if(c.y<this._rect.top+d){return{p:this._rect.centerTop(),connector:"top"}}if(c.x<this._rect.left+d){return{p:this._rect.centerLeft(),connector:"left"}}return{p:this._rect.centerRight(),connector:"right"}},changeType:function(c){switch(c){case"ellipse":case"rectangle":case"diamond":case"dshape":case"dreversed":if(this.type!=c){this.type=c;return true}break;case"square":if(this.type!="rectangle"||this._rect.width!=this._rect.height){this.type="rectangle";this._rect.width=this._rect.height=Math.max(this._rect.width,this._rect.height);return true}break;case"circle":if(this.type!="ellipse"||this._rect.width!=this._rect.height){this.type="ellipse";this._rect.width=this._rect.height=Math.max(this._rect.width,this._rect.height);return true}break}}});scil.apply(JSDraw2.Shape,{kScriptHelUrl:"https://www.scilligence.com/web/pmf-workflow-script-apis/",cast:function(c){return c!=null&&c.T=="SHAPE"?c:null},showProperties:function(d,c){if(this.dlg==null){var h=scil.Workflow.options;if(h==null){h={}}if(scil.User!=null&&scil.User.options!=null&&scil.User.options.roles!=null){h.roles=h.roles.concat(scil.User.options.roles)}var j=700;var g=this;var f={text:{label:"Action",width:200,type:"dropdowninput",items:h.actions},outputstatus:{label:"Output Status",width:200,type:"dropdowninput",items:h.statuses},cancel:{label:"Can Cancel",type:"checkbox"},userrole:{label:"Authorized Role",width:200,type:"dropdowninput",items:h.roles},user:{label:"Authorized User",width:200},userfield:{label:"Authorized Field",width:200},timeline:{label:"Timeline",type:"date",width:200},workdays:{label:"Work Days",type:"number",width:50,unit:JSDraw2.Language.res("days")},ccemails:{label:"CC Emails",width:j},externalaction:{label:"External Action",type:"checkbox",str:"Action performed in other applications"},externalscript:{label:"External Script",width:j},silent:{label:"Silent",type:"checkbox",str:"Don't send notification emails to the requestor"},subform:{label:"Subform",type:"textarea",width:j,height:50,allowhtml:true},condition:{label:"Flow Condition",type:"dropdowninput",items:["else"],width:200,str:"<div>e.g. <span style='background:yellow'>amount&gt;=20</span>, where amount is the form data.</div>"},bypass:{label:"Bypass Condition",width:200,str:"e.g. amount>500"},deferdays:{label:"Defer Days",width:50,str:"e.g. 5, or {fieldkey}"},subreq:{label:"Sub-Request Form",width:200,str:"The form internal key of the new sub request"},subreqid:{label:"Sub-Request ID Field",width:200,str:"The data field to store sub request ID"},subreqdataout:{label:"Sub-Request Data Out",width:200,str:"e.g. amount,secondfieldkey"},subreqdataback:{label:"Sub-Request Data Back",width:200,str:"e.g. amount,secondfieldkey"},script:{label:"C# Script",type:"textarea",width:j,height:90,allowhtml:true,str:" <a target=_blank href='"+this.kScriptHelUrl+"'>Workflow Script APIs</a>",button:{label:"Test Script",onclick2:function(l){g.testScript(l)}}}};this.dlg=scil.Form.createDlgForm("Workflow Properties",f,[{src:scil.App.imgSmall("submit.png"),label:"Save",onclick:function(){g.saveProperties(true)}},{src:scil.App.imgSmall("cancel.png"),label:"Cancel",onclick:function(){g.saveProperties()}}],{lang:JSDraw2.Language})}this.dlg.show2({owner:d});this.dlg.shape=c;this.dlg.ed=d;this.dlg.form.setData(c)},testScript:function(c){var d=c.value;if(scil.Utils.isNullOrEmpty(d)){return}scil.Utils.ajax(JSDrawServices.url+"?cmd=workflow.testscript",function(f){if(f.succeed){scil.Utils.alert("Script works")}else{scil.Utils.alert("ERROR:\n"+f.error)}},{script:d,scripttype:null})},saveProperties:function(h){if(h){var c=this.dlg.shape;var f=this.dlg.form.getData(true);if(!scil.Utils.areDictEq(f,c)){var g=this.dlg.ed;g.pushundo();scil.apply(c,f);g.refresh(true)}}this.dlg.hide()}});JSDraw2.RGroup=scil.extend(JSDraw2.Text,{constructor:function(c,d){this.T="RGROUP";this._rect=c;this.text=d;this.color=null;this.selected=false;this.fieldtype=null;this.readonly=false;this.anchors=[];this.mols=[]},clone:function(f){var c=new JSDraw2.RGroup(this._rect.clone(),this.text);c.id=this.id;c.color=this.color;c.text=this.text;c.fieldtype=this.fieldtype;c.readonly=this.readonly;for(var d=0;d<this.mols.length;++d){c.mols.push(this.mols[d].clone(f,true))}return c},offsetAll:function(c,d){this._rect.offset(c,d);for(var f=0;f<this.mols.length;++f){this.mols[f].offset(c,d)}},relayout:function(d){var l=this._rect.left+d*2;var n=this._rect.top;var j=this._rect.clone();for(var f=0;f<this.mols.length;++f){var g=this.mols[f];var h=g.rect(true);var c=n-h.top-h.height/2;g.offset(l-h.left,c);h.offset(l-h.left,c);l+=d*2+h.width;if(j==null){j=h}else{j.union(h)}}return j},addStructure:function(d){var h=null;for(var f=this.mols.length-1;f>=0;--f){if(this.mols[f].isEmpty()){continue}var j=this.mols[f].rect(true);h=new JSDraw2.Point(j.right(),j.center().y);h.offset(2*d,0);break}if(h==null){h=new JSDraw2.Point(this._rect.left,this._rect.center().y);h.offset(2*d,0)}var c=new JSDraw2.Atom(h);c.attachpoints=[1];var g=new JSDraw2.Mol();g.addAtom(c);this.mols.push(g);return g}});JSDraw2.RGroup.cast=function(c){return c!=null&&c.T=="RGROUP"?c:null};scil.XDraw=scil.extend(scil._base,{constructor:function(h,g){this.options=g;if(this.options==null){this.options={}}if(typeof h=="string"){h=document.getElementById(h)}var l=scil.Utils.createTable(h);var n=scil.Utils.createElement(l,"tr");var d=this;var j={border:"solid 1px #ddd",background:"#fff",width:"120px",padding:"2px",textAlign:"center"};this.tabJSDraw=scil.Utils.createElement(n,"td","JSDraw",j);dojo.connect(this.tabJSDraw,"onclick",function(){d.showJSDraw()});this.divJSDraw=scil.Utils.createElement(h,"div",null,{display:"none"});if(this.options.showchemdraw!=false&&JSDraw2.defaultoptions.showchemdraw!=false){this.tabChemDraw=scil.Utils.createElement(n,"td","ChemDraw",j);dojo.connect(this.tabChemDraw,"onclick",function(){d.showChemDraw()});this.divChemDraw=scil.Utils.createElement(h,"div",null,{display:"none"})}if(this.options.showjdraw!=false&&JSDraw2.defaultoptions.showjdraw!=false){this.tabJDraw=scil.Utils.createElement(n,"td","Accelrys JDraw",j);dojo.connect(this.tabJDraw,"onclick",function(){d.showJDraw()});this.divJDraw=scil.Utils.createElement(h,"div",null,{display:"none"})}var q=scil.Utils.readCookie(scil.XDraw.kXDraw);if(q==null){q=JSDraw2.defaultoptions.xdraw}var c=false;if(q=="chemdraw"){c=this.showChemDraw(this.options.value)}else{if(q=="jdraw"){c=this.showJDraw(this.options.value)}}if(!c){this.showJSDraw(this.options.value)}this.xdraw=true},getCurrentEditor:function(){if(this.divJSDraw.style.display==""){return"jsdraw"}else{if(this.divChemDraw.style.display==""){return"chemdraw"}else{if(this.divJDraw.style.display==""){return"jdraw"}}}return null},selectTab:function(c){this.divJSDraw.style.display=c=="jsdraw"?"":"none";if(this.divChemDraw!=null){this.divChemDraw.style.display=c=="chemdraw"?"":"none"}if(this.divJDraw!=null){this.divJDraw.style.display=c=="jdraw"?"":"none"}this.tabJSDraw.style.background=c=="jsdraw"?"#eee":"#fff";if(this.divChemDraw!=null){this.tabChemDraw.style.background=c=="chemdraw"?"#eee":"#fff"}if(this.divJDraw!=null){this.tabJDraw.style.background=c=="jdraw"?"#eee":"#fff"}},onDataChange:function(){if(this.skipdatachangeevent){return}this.tabdatachanged=true;if(this.options.ondatachange!=null){this.options.ondatachange(this)}},onFocus:function(c){this.tabdatachanged=true;if(this.options.onfocus!=null){this.options.onfocus(c)}},showJSDraw:function(h){if(this.divJSDraw.style.display==""){return}var j=h==null?null:h.value;var f=h==null?"xml":h.format;if(j==null){j=this.getXml();f="xml"}this.selectTab("jsdraw");if(this.jsdraw==null){var c=scil.clone(this.options);c.dataformat=f;c.data=j;if(c.width<=0){c.width=700}if(c.height<=0){c.height=350}var g=this;c.ondatachange=function(){g.onDataChange()};c.onfocus=function(l){g.onFocus(l)};var d=scil.Utils.createElement(this.divJSDraw,"div");this.jsdraw=new JSDraw(d,c);if(!scil.Utils.isNullOrEmpty(j)){this.skipdatachangeevent=true;this.jsdraw.setXml(j);this.skipdatachangeevent=false}}else{this.skipdatachangeevent=true;this.jsdraw.setXml(j,false);this.skipdatachangeevent=false}scil.Utils.createCookie(scil.XDraw.kXDraw,"jsdraw");this.tabdatachanged=false},convertFile:function(f,c){if(scil.Utils.isNullOrEmpty(f)){return f}if(typeof(f)=="object"){f=scil.Utils.getInnerXml(f)}var d=scil.Utils.ajaxwait(JSDrawServices.url+"?cmd=convertfile",{input:f,outputformat:c});return d==null?null:d.output},oldcdxml:null,testChemDrawDataChanged:function(){if(this.chemdraw&&!scil.Utils.isIE){var c=this._getChemDrawData("text/xml");if(c!=this.oldcdxml){this.onDataChange()}}},showChemDraw:function(q){if(this.divChemDraw==null){return false}if(this.divChemDraw.style.display==""){return true}var c=this.value2Molfile(q);if(c==null){c=this.getXml()}if(JSDrawServices.url!=null){c=this.convertFile(c,"cdxml")}this.selectTab("chemdraw");try{if(this.chemdraw==null){if(c!=null){if(JSDrawServices.url!=null){c="text/xml;base64,"+JSDraw2.Base64.encode(c)}else{c="chemical/x-mdl-molfile,"+scil.Utils.escXmlValue(c)}}if(scil.Utils.isIE){if(scil.Utils.isIE>=11||JSDraw2.ChemDraw.isCDActiveXInstalled()==false){this.chemdraw=false}else{var t=this.options.width;var g=this.options.height;var d=scil.Utils.createElement(this.divChemDraw,"div");var n='<param NAME="ShowToolsWhenVisible" VALUE="1">';if(c!=null){n+="<param NAME='DataURL' VALUE=\"data:"+c+'"/>'}var j="<object classid='"+JSDraw2.ChemDraw.CD_CONTROL_CLSID+"' style='border:solid 1px #ddd; width:"+(t>0?t:700)+"px;height:"+(g>0?g:350)+"px;'>"+n+"</object>";d.innerHTML=j;this.chemdraw=d.firstChild;if(this.chemdraw.Objects==null){this.chemdraw=false}else{var l=this;this.chemdraw.attachEvent("DataChanged",function(){l.onDataChange()});dojo.connect(this.chemdraw,"onfocus",function(){l.onFocus(true)});dojo.connect(this.chemdraw,"onblur",function(){l.onFocus(false)})}}if(this.chemdraw==false){scil.Utils.removeAll(d);scil.Utils.createElement(this.divChemDraw,"div",scil.Utils.isIE>=11?"ChemDraw is not supported on IE 11+":"ChemDraw is not installed",{width:(t>0?t:700)+"px",height:(g>0?g:350)+"px",color:"red",padding:20,border:"solid 1px #ddd"})}}else{var t=this.options.width;var g=this.options.height;var d=scil.Utils.createElement(this.divChemDraw,"div");var j="<embed type='chemical/x-cdx' showtoolswhenvisible=1 style='border:solid 1px #ddd; width:"+(t>0?t:700)+"px;height:"+(g>0?g:350)+"px;' dataurl='data:"+c+"'></embed>";d.innerHTML=j;this.chemdraw=d.firstChild;if(false){}else{dojo.connect(this.chemdraw,"onfocus",function(){l.onFocus(true)});dojo.connect(this.chemdraw,"onblur",function(){l.onFocus(false)})}}}else{this.skipdatachangeevent=true;if(JSDrawServices.url!=null){this._setChemDrawData("text/xml",c)}else{this._setChemDrawData("chemical/x-mdl-rxn",c)}this.skipdatachangeevent=false}}catch(f){this.chemdraw=false;scil.Utils.createElement(this.divChemDraw,"div",f.message,{color:"red"})}scil.Utils.createCookie(scil.XDraw.kXDraw,"chemdraw");this.tabdatachanged=false;return true},showJDraw:function(q){if(this.divJDraw==null){return false}if(this.divJDraw.style.display==""){return true}var l=this.value2Molfile(q);if(l==null){l=this.getMolfile()}this.selectTab("jdraw");try{if(this.jdraw==null){var t=this.options.width;var f=this.options.height;var c=scil.Utils.createElement(this.divJDraw,"div");var j=this.options.jdrawpath==null?JSDraw2.defaultoptions.jdrawpath:this.options.jdrawpath;if(j==null||j==""){this.jdraw=false;scil.Utils.createElement(c,"div","*jdrawpath* for JDraw jar files is not set!",{padding:"20px",color:"red"})}else{var n=null;if(l!=null){n="<param NAME='molstring' VALUE=\""+l.replace(/\n/g,"\\n").replace(/\r/g,"")+'"/>'}var g="<applet code='com.symyx.draw.JDrawEditor' codebase='"+j+"' archive='CsInline.jar,jdrawcore.jar,jdrawapplet.jar' style='border:solid 1px #ddd' width="+(t>0?t:700)+" height="+(f>0?f:350)+">"+n+"</applet>";c.innerHTML=g;this.jdraw=c.firstChild}}else{this.setMolfile(l)}}catch(d){this.jdraw=false;scil.Utils.createElement(this.divJDraw,"div",d.message,{color:"red"})}scil.Utils.createCookie(scil.XDraw.kXDraw,"jdraw");this.tabdatachanged=false;return true},value2Molfile:function(d){if(d==null){return null}var c=new JSDraw2.Mol();if(d.format=="mol"||d.format=="molfile"){c.setMolfile(d.value)}else{c.setXml(d.value)}return c.getMolfile()},getMolfile:function(){if(this.divJSDraw.style.display==""){if(this.jsdraw!=null&&this.jsdraw!=false){return this.jsdraw.getMolfile()}}else{if(this.divJDraw!=null&&this.divJDraw.style.display==""){if(this.jdraw!=null&&this.jdraw!=false){return this.jdraw.getMolString()}}else{if(this.divChemDraw!=null&&this.divChemDraw.style.display==""){if(this.chemdraw!=null&&this.chemdraw!=false){return this._getChemDrawData("chemical/x-mdl-rxn")}}}}return null},getSmiles:function(){if(this.divJSDraw.style.display==""){if(this.jsdraw!=null&&this.jsdraw!=false){return this.jsdraw.getSmiles()}}else{if(this.divJDraw!=null&&this.divJDraw.style.display==""){if(this.jdraw!=null&&this.jdraw!=false){var d=this._getJDrawData();var c=new JSDraw2.Mol();c.setMolfile(d);return c.getSmiles()}}else{if(this.divChemDraw!=null&&this.divChemDraw.style.display==""){if(this.chemdraw!=null&&this.chemdraw!=false){return this._getChemDrawData("chemical/x-daylight-smiles")}}}}return null},setMolfile:function(c){if(c==null||c.length<100){return}if(this.divJSDraw.style.display==""){if(this.jsdraw!=null&&this.jsdraw!=false){this.jsdraw.setMolfile(c)}}else{if(this.divJDraw!=null&&this.divJDraw.style.display==""){if(this.jdraw!=null&&this.jdraw!=false){this._setJDrawData(c)}}else{if(this.divChemDraw!=null&&this.divChemDraw.style.display==""){if(this.chemdraw!=null&&this.chemdraw!=false){this._setChemDrawData("chemical/x-mdl-rxn",c)}}}}},reset:function(){this.clear()},clear:function(){if(this.divJSDraw.style.display==""){if(this.jsdraw!=null&&this.jsdraw!=false){this.jsdraw.clear()}}else{if(this.divJDraw!=null&&this.divJDraw.style.display==""){if(this.jdraw!=null&&this.jdraw!=false){this._setJDrawData("")}}else{if(this.divChemDraw!=null&&this.divChemDraw.style.display==""){if(this.chemdraw!=null&&this.chemdraw!=false){this._setChemDrawData("chemical/cdx")}}}}},setXml:function(f){if(scil.Utils.isNullOrEmpty(f)){return}if(this.divJSDraw.style.display==""){if(this.jsdraw!=null&&this.jsdraw!=false){this.jsdraw.setXml(f,false)}}else{if(this.divJDraw!=null&&this.divJDraw.style.display==""){if(this.jdraw!=null&&this.jdraw!=false){var c=new JSDraw2.Mol();c.setXml(f);var d=c.getMolfile();this._setJDrawData(d)}}else{if(this.divChemDraw!=null&&this.divChemDraw.style.display==""){if(this.chemdraw!=false){if(this.chemdraw!=null&&this.chemdraw!=false){this.chemdraw.Objects.clear();if(JSDrawServices.url!=null){this._setChemDrawData("text/xml",this.convertFile(f,"cdxml"))}else{var c=new JSDraw2.Mol();c.setXml(f);this._setChemDrawData("chemical/x-mdl-rxn",c.getMolfile())}}}}}}},getHtmlAsync:function(c){if(this.divChemDraw.style.display==""){var d=this._getChemDrawData("chemical/cdx");var f=this.options.serviceurl+"?cmd=convertfile";scil.Utils.ajax(f,function(g){c(g.output)},{input:d,base64:true})}else{c(this.getXml())}},getXml:function(){if(this.divJSDraw.style.display==""){if(this.jsdraw!=null&&this.jsdraw!=false){return this.jsdraw.getXml()}}else{if(this.divJDraw!=null&&this.divJDraw.style.display==""){if(this.jdraw!=null&&this.jdraw!=false){try{var g=this._getJDrawData();var f=new JSDraw2.Mol();f.setMolfile(g);return f.getXml()}catch(d){return null}}}else{if(this.divChemDraw!=null&&this.divChemDraw.style.display==""){if(this.chemdraw!=null&&this.chemdraw!=false){if(JSDrawServices.url!=null){var c=this._getChemDrawData("text/xml");return this.convertFile(c,"jsdraw")}else{var g=this._getChemDrawData("chemical/x-mdl-rxn");var f=new JSDraw2.Mol();f.setMolfile(g);return f.getXml()}}}}}return null},getHtml:function(){return this.getXml()},setHtml:function(c){this.setXml(c)},_getChemDrawData:function(g){try{if(scil.Utils.isIE){if(g=="chemical/cdx"||g=="chemical/x-cdx"){this.chemdraw.DataEncoded=true;var c=this.chemdraw.Objects.Data("chemical/cdx");this.chemdraw.DataEncoded=false;return c}return this.chemdraw.Objects.Count==0?null:this.chemdraw.Objects.Data(g)}else{var d=this._chemdrawMimetype2Dt(g);return d==-1?null:this.chemdraw.getData(d)}}catch(f){return null}},_getJDrawData:function(){try{return this.jdraw.getMolString()}catch(c){return null}},_setChemDrawData:function(h,c){try{if(scil.Utils.isIE){this.chemdraw.Objects.clear();if(h=="chemical/cdx"||h=="chemical/x-cdx"){this.chemdraw.DataEncoded=true;this.chemdraw.Objects.Data("chemical/cdx")=c;this.chemdraw.DataEncoded=false}else{this.chemdraw.Objects.Data(h)=c}}else{var d=this._chemdrawMimetype2Dt(h);if(d!=-1){var g=this;setTimeout(function(){g.chemdraw.clear();g.chemdraw.putData(d,c)},1000)}else{alert("Unknown file format: "+h)}}}catch(f){alert(f.Message)}},_setJDrawData:function(c){try{return this.jdraw.setMolString(c)}catch(d){}},_chemdrawMimetype2Dt:function(c){switch(c){case"chemical/x-cdx":case"chemical/cdx":return 0;case"chemical/x-mdl-molfile":case"chemical/x-mdl-rxn":case"chemical/mdl-molfile":case"chemical/mdl-rxn":return 1;case"chemical/x-daylight-smiles":case"chemical/daylight-smiles":return 2;case"chemical/x-questel-f1":case"chemical/questel-f1":return 3;case"chemical/x-questel-f1-query":case"chemical/questel-f1-query":return 4;case"text/xml":return 5;case"chemical/x-name":return 6;case"chemical/x-cml":case"chemical/cml":return 7;case"chemical/x-inchi":case"chemical/inchi":return 8;default:return -1}},redraw:function(){}});scil.apply(scil.XDraw,{kXDraw:"_scilligence_xdraw"});JSDraw2.TLC=scil.extend(scil._base,{constructor:function(h,f,d,g){this.T="TLC";this.type=h==null||h==""?"tlc":h;this._rect=f;this.spotsize=g;this.color=null;this.selected=false;this.spots=[];this.height=null;this.showlanelabel=true;this.lanelabels=[];if(d>0){for(var c=0;c<d;++c){this.spots.push(this._newSpot(c+1))}this.setDefaultLaneLabels(d)}},setDefaultLaneLabels:function(d){if(d==null){d=this.getLanes()}if(d==3){this.lanelabels=["S","M","R"]}else{if(d>0){for(var c=0;c<d;++c){this.lanelabels.push(scil.Utils.num2letter(c+1))}}}},sortSpots:function(){if(this.spots.length>1){this.spots.sort(function(c,d){if(c.lane==d.lane){return 0}return c.lane>d.lane?1:-1})}},getLanes:function(){var d=0;var g={};for(var c=0;c<this.spots.length;++c){var f=this.spots[c];if(g[f.lane]==null){++d;g[f.lane]=true}}return d},html:function(f){var d="<i i='"+this.id+"' x='"+this.T+"' type='"+scil.Utils.escXmlValue(this.type)+"' size='"+(this.spotsize*f).toFixed(3)+"' p='"+this._rect.toString(f)+"'";if(this.color!=null){d+=" clr='"+this.color+"'"}d+=" showlanelabel='"+(this.showlanelabel?1:0)+"'";if(this.lanelabels!=null&&this.lanelabels.length>0){d+=" lanelabels='"+scil.Utils.escXmlValue(scil.Utils.array2str(this.lanelabels,";"))+"'"}d+=">\n";for(var c=0;c<this.spots.length;++c){d+=this.spots[c].html(f)}d+="</i>";return d},readHtml:function(c,h,d){var j=JSDraw2.Rect.fromString(c.getAttribute("p"));this.type=c.getAttribute("type");if(this.type==null||this.type==""){this.type="tlc"}this._rect=j;this.spotsize=parseFloat(c.getAttribute("size"));this.showlanelabel=!scil.Utils.isFalse(c.getAttribute("showlanelabel"));if(d>=4){var l=c.getAttribute("lanelabels");if(l!=null){this.lanelabels=(l+"").split(";")}}var g=c.getElementsByTagName("s");if(g!=null){for(var f=0;f<g.length;++f){var l=new JSDraw2.TLC.Spot();if(l.readHtml(g[f])){this.spots.push(l)}}}this.sortSpots();if(!(d>=4)){this.setDefaultLaneLabels()}return true},clone:function(){var c=new JSDraw2.TLC(this.type,this._rect.clone());c.id=this.id;c.color=this.color;c.spotsize=this.spotsize;c.showlanelabel=this.showlanelabel;c.lanelabels=scil.clone(this.lanelabels);for(var d=0;d<this.spots.length;++d){c.spots.push(this.spots[d].clone())}return c},flipY:function(c){},flipX:function(c){},scale:function(d,c){this._rect.scale(d,c);this.spotsize*=d},offset:function(c,d){this._rect.offset(c,d)},rect:function(){return this._rect.clone()},toggle:function(c,d){return this._rect.contains(c)||this._rect.cornerTest(c,d)!=null},drawCur:function(f,d,c){this._drawAnchor(f,d/2,c,true)},duplicateLane:function(l){var h=scil.Utils.indexOf(this.spots,l);if(h<0){return false}var d=l.lane;if(d>0){d;var f=[];for(var c=0;c<this.spots.length;++c){var j=this.spots[c];if(j.lane>d){++j.lane}else{if(j.lane==d){f.push(j)}}}for(var c=0;c<f.length;++c){var g=f[c].clone();g.lane=d+1;this.spots.splice(h+c+1,0,g)}}else{var g=l.clone();g.lane=d+1;this.spots.splice(h+1,0,g)}this.sortSpots();return true},duplicateSpot:function(l){if(scil.Utils.indexOf(this.spots,l)<0){return false}var f=l.clone();var c=0.1;while(c<=1&&c>=-1){var h=f.rf+c;if(h>1){c=-0.1;continue}else{if(h<0){c=-f.rf;break}}var g=false;for(var d=0;d<this.spots.length;++d){var j=this.spots[d];if(j.lane==f.lane&&Math.abs(j.rf-h)<0.05){g=true;break}}if(!g){break}c+=c>0?0.1:-0.1}f.rf+=c;this.spots.push(f);this.sortSpots();return true},showSetLabel:function(g,c){var d=false;if(g!=null){if(g.label!=c){g.label=c;d=true}}return d},showLaneLabel:function(c){if(this.showlanelabel==c){return false}this.showlanelabel=c;return true},showLabel:function(h,c){var g=false;if(h==null){for(var d=0;d<this.spots.length;++d){if(this.spots[d].showlabel!=c){this.spots[d].showlabel=c;g=true}}}else{if(h.showlabel!=c){h.showlabel=c;g=true}}return g},changeSize:function(g,f,c){if(g==null){return false}var d=parseInt(f.substr(0,f.length-1))/100;if(c>0){d=(d*0.75/g.rx)*this.spotsize/c;if(d==1){return false}g.rx*=d;g.ry1*=d;g.ry2*=d}else{if(d==1){return false}g.rx*=d;g.ry1*=d;g.ry2*=d}return true},changeShape:function(l,h,j){if(l==null){return false}var g=1;switch((j+"").toLowerCase()){case"small":g=1.5;break;case"medium":case"short":g=2.2;break;case"tall":case"wide":case"large":case"long":g=3;break;case"long-x":g=5;break;case"long-xx":g=7;break;case"long-xxx":g=9;break}var c,d,f;switch(h){case"circle":c=0.75;d=f=1;break;case"hellipse":c=0.75*g;d=f=1;break;case"vellipse":c=0.75;d=f=1*g;break;case"halfellipseup":c=0.75;d=1.2*g;f=0;break;case"halfellipsedown":c=0.75;d=0;f=1.2*g;break;case"crescentup":c=0.75;d=1.2*g;f=-d/2;break;case"crescentdown":c=0.75;f=1.2*g;d=-f/2;break;case"blowingup":c=0.75;d=1.2*g;f=1;break;case"blowingdown":c=0.75;f=1.2*g;d=1;break;default:return false}l.rx=c;l.ry1=d;l.ry2=f;return true},setShapeFill:function(g,f){var d=false;if(g==null){for(var c=0;c<this.spots.length;++c){if(this.spots[c].shape!=f){this.spots[c].shape=f;d=true}}}else{if(g.shape!=f){g.shape=f;d=true}}return d},removeSpot:function(d){var c=scil.Utils.indexOf(this.spots,d);if(c<0){return false}if(this.curspot==d){this.curspot=null}this.spots.splice(c,1);this.sortSpots();return true},setRfValue:function(d,c){scil.Utils.prompt("Set RF Value","Please enter the RF value (0-1.0)",d.rf,"Save",function(f){var g=parseFloat(f);if(isNaN(g)||!(g>=0&&g<=1)){scil.Utils.alert("RF value must be a number between 0 and 1.0");return}if(d.rf!=g){d.rf=g;c.refresh(true)}});return false},addLane:function(){var f=0;for(var c=0;c<this.spots.length;++c){var d=this.spots[c].lane;if(d>f){f=d}}this.spots.push(this._newSpot(f+1));this.sortSpots();return true},_newSpot:function(c){return new JSDraw2.TLC.Spot(c,0,0.75,1,1)},addSpot:function(g,d,j){var h=this.hitSpot(d,j);if(h==null){var c=this.testLane(d);var l=this._rect.bottom()-this.spotsize*2;var f=(l-d.y)/(this._rect.height-this.spotsize*4);if(!(f>=0&&f<=1)){return false}h=new JSDraw2.TLC.Spot(c,f,0.75,1,1);this.spots.push(h);this.sortSpots()}this.changeShape(h,g,"Medium");return true},delSpot:function(c,f){var d=this.hitSpot(c,f);if(d==null){return false}scil.Utils.delFromArray(this.spots,d);return true},getLanes:function(f){var g=0;if(f==null){f={}}for(var c=0;c<this.spots.length;++c){var d=this.spots[c].lane;if(f[d]==null){f[d]=g++}}return g},draw:function(F,z,A,q){z/=2;var l=this.type=="electrophoresis";var f=this.color==null||this.color==""?"black":this.color;var E=this._rect.clone();E.inflate(0,-this.spotsize*2);this.height=E.height;var w={};var B=this.getLanes(w);if(l){var D=this._rect;var C=[{x:D.right(),y:D.top},{x:D.right(),y:D.bottom()},{x:D.left,y:D.bottom()},{x:D.left,y:D.top}];var h=this.spotsize*2*0.75;for(var t=0;t<B;++t){var G=D.left+(t+1)*D.width/(B+1);C.push({x:G-h,y:D.top});C.push({x:G-h,y:D.top+h/2});C.push({x:G+h,y:D.top+h/2});C.push({x:G+h,y:D.top})}C.push({x:D.right(),y:D.top});F.createPolyline(C).setStroke({color:f,width:z}).setFill("white")}else{F.createRect({x:this._rect.left,y:this._rect.top,width:this._rect.width,height:this._rect.height}).setStroke({color:f,width:z}).setFill("white");var I=this._rect.top+this.spotsize*2;F.createLine({x1:this._rect.left,y1:I,x2:this._rect.right(),y2:I}).setStroke({color:f,width:z/2});var J=this._rect.bottom()-this.spotsize*2;F.createLine({x1:this._rect.left,y1:J,x2:this._rect.right(),y2:J}).setStroke({color:f,width:z/2});var g=(J-I)/10;for(var t=1;t<10;++t){var H=I+g*t;F.createLine({x1:this._rect.left,y1:H,x2:this._rect.right(),y2:H}).setStroke({color:"#eee",width:z/2})}var J=this._rect.bottom();H=E.bottom();var j=this.spotsize/2;for(var t=0;t<B;++t){var G=E.left+(t+1)*E.width/(B+1);F.createLine({x1:G,y1:H-j,x2:G,y2:H+j}).setStroke({color:f,width:z/2});if(this.showlanelabel&&this.lanelabels!=null){var d=this.lanelabels[t];if(d!=null&&d!=""){JSDraw2.Drawer.drawText(F,new JSDraw2.Point(G,J),d,f,q,"middle")}}}}for(var t=0;t<this.spots.length;++t){var u=w[this.spots[t].lane];var G=E.left+(u+1)*E.width/(B+1);this.spots[t].draw(F,E,G,this.spotsize,z,q/2,l)}},drawSelect:function(c){c.draw(this,this._rect.fourPoints())},_drawAnchor:function(h,g,c,d){g*=8/5;r=this._rect;h.createCircle({cx:r.left,cy:r.top,r:g}).setFill(c);h.createCircle({cx:r.right(),cy:r.top,r:g}).setFill(c);h.createCircle({cx:r.right(),cy:r.bottom(),r:g}).setFill(c);h.createCircle({cx:r.left,cy:r.bottom(),r:g}).setFill(c);if(this.curspot!=null){var f=this.curspot.pt;if(f!=null){h.createCircle({cx:f.x,cy:f.y,r:g}).setFill(c);JSDraw2.Drawer.drawTriangle(h,f.clone().offset(0,3*g),f.clone().offset(-g,g*1.2),f.clone().offset(g,g*1.2),c);JSDraw2.Drawer.drawTriangle(h,f.clone().offset(0,-3*g),f.clone().offset(-g,-g*1.2),f.clone().offset(g,-g*1.2),c);JSDraw2.Drawer.drawTriangle(h,f.clone().offset(3*g,0),f.clone().offset(g*1.2,-g),f.clone().offset(g*1.2,g),c);JSDraw2.Drawer.drawTriangle(h,f.clone().offset(-3*g,0),f.clone().offset(-g*1.2,-g),f.clone().offset(-g*1.2,g),c)}}},testDir:function(f,h,g){if(Math.abs(h.x-f.x)<=g){if(Math.abs(h.y-f.y)<=g){return"C"}if(h.y>f.y&&h.y<=f.y+2*g){return"B"}if(h.y<f.y&&f.y<=h.y+2*g){return"U"}}else{if(Math.abs(h.y-f.y)<=g){if(h.x>f.x&&h.x<=f.x+2*g){return"R"}if(h.x<f.x&&f.x<=h.x+2*g){return"L"}}}return null},testLane:function(h){if(!this._rect.contains(h)){return null}var f=null;var g=null;for(var d=0;d<this.spots.length;++d){var j=this.spots[d];if(d==0){f=j.lane;g=Math.abs(j.pt.x-h.x)}else{var c=Math.abs(j.pt.x-h.x);if(c<g){f=j.lane;g=c}}}return f},hitSpot:function(d,h,g){for(var c=0;c<this.spots.length;++c){var f=this.spots[c].pt;if(f.distTo(d)<(this.spots[c]==g?2*h:h)){return this.spots[c]}}return null},cornerTest:function(j,q,f,c){var n=this.curspot;this.curspot=null;if(this.selected&&(c=="tlc"||c=="electrophoresis")||c=="eraser"){this.curspot=this.hitSpot(j,q,n);if(this.curspot!=null){var g=q*0.8;var l=this.curspot.pt;if(l!=null){var h=this.testDir(l,j,g);if(h!=null){return f?"spot-@":"spot-"+h}}}}return c=="tlc"||c=="electrophoresis"?null:this._rect.cornerTest(j,q)},resize:function(c,f){if(this.curspot!=null&&this.height!=null&&c.length==6&&c.substr(0,5)=="spot-"){var g=c.substr(5,1);var j=this.curspot;switch(g){case"@":var l=f.y/50;if(l>0.1){l=0.1}else{if(l<-0.1){l=-0.1}}j.ry1*=1+l;j.ry2*=1+l;j.rx*=1+l;break;case"C":var h=f.y/this.height;if(j.rf-h>=0&&j.rf-h<=1){j.rf-=h}break;case"U":j.ry1-=f.y/10;if(this.type=="electrophoresis"){j.ry2=j.ry1}break;case"B":j.ry2+=f.y/10;if(this.type=="electrophoresis"){j.ry1=j.ry2}break;case"L":j.rx-=f.x/10;if(j.rx<0.1){j.ry=0.1}break;case"R":j.rx+=f.x/10;break}return}this._rect.moveCorner(c,f)}});scil.apply(JSDraw2.TLC,{dlg:null,cast:function(c){return c!=null&&c.T=="TLC"?c:null},create:function(h,c,d,g){var f=new JSDraw2.Rect().set(c,d);return new JSDraw2.TLC(h,f,Math.floor(f.width/g/7),g)},setLaneLabels:function(f,q){if(q==null){return}if(this.dlg==null){var c=[{caption:"Lane",key:"lane",viewonly:true,width:100},{caption:"Label",key:"label",width:300}];var j=this;this.dlg=scil.Form.createDlgForm("Set Lane Labels",{lanes:{type:"jsdraw.table",options:{columns:c,rowid:false,toolbar:false,hidelabel:true}}},{src:scil.App.imgSmall("submit.png"),label:"Save",onclick:function(){j.setLaneLabels2()}},{lang:JSDraw2.Language})}this.dlg.show();this.jsd=f;this.obj=q;var g=this.dlg.form.fields.lanes.jsd;g.clear();var l=this.obj.getLanes();for(var d=0;d<l;++d){var h=q.lanelabels==null?null:q.lanelabels[d];g.insert(null,{lane:"Lane "+(d+1),label:h})}},setLaneLabels2:function(){var f=[];var d=this.dlg.form.fields.lanes.jsd;for(var c=0;c<d.getRowCount();++c){var g=d.getCellValue(c,"label");if(g!=null){g=scil.Utils.trim(g)}f.push(g)}this.obj.lanelabels=f;this.jsd.refresh(true);this.dlg.hide()}});JSDraw2.TLC.Spot=scil.extend(scil._base,{constructor:function(d,f,g,h,j,l,c,n){this.lane=d;this.rf=f;this.rx=g;this.ry1=h;this.ry2=j;this.shape=l==null||l==""?"solid":l;this.color=c;this.label=null;this.showlabel=n==null?true:n;this.pt=null},move:function(c){var d=this.rf;this.rf+=c;if(this.rf>1){this.rf=1}else{if(this.rf<0){this.rf=0}}return d!=this.rf},html:function(d){var c="<s lane='"+this.lane+"' rf='"+this.rf.toFixed(3)+"' rx='"+this.rx.toFixed(3)+"' ry1='"+this.ry1.toFixed(3)+"' ry2='"+this.ry2.toFixed(3)+"'";if(this.color!=null&&this.color!=""){c+=" clr='"+this.color+"'"}if(this.shape!=null&&this.shape!=""){c+=" shape='"+this.shape+"'"}if(this.label!=null&&this.label!=""){c+=" label='"+this.label+"'"}if(this.showlabel){c+=" showlabel='1'"}c+="/>\n";return c},readHtml:function(c){this.lane=parseInt(c.getAttribute("lane"));this.rf=parseFloat(c.getAttribute("rf"));this.rx=parseFloat(c.getAttribute("rx"));this.ry1=parseFloat(c.getAttribute("ry1"));this.ry2=parseFloat(c.getAttribute("ry2"));this.shape=c.getAttribute("shape");this.color=c.getAttribute("clr");this.label=c.getAttribute("label");this.showlabel=scil.Utils.isTrue(c.getAttribute("showlabel"));return true},clone:function(){return new JSDraw2.TLC.Spot(this.lane,this.rf,this.rx,this.ry1,this.ry2,this.shape,this.color,this.showlabel)},draw:function(A,l,B,z,j,f,d){var c=this.color==null||this.color==""?(d?"blue":"black"):this.color;var C=l.bottom()-l.height*this.rf;this.pt=new JSDraw2.Point(B,C);if(d){var q=z*this.rx*2;var t=z*this.ry1;A.createRect({x:B-q,y:C-t/2,width:q*2,height:t}).setStroke({color:c,width:j}).setFill(c)}else{var q=z*this.rx;var t=z*this.ry1;var u=z*this.ry2;var h=A.createPath("").moveTo(B-q,C).curveTo(B-q,C-t,B+q,C-t,B+q,C).moveTo(B-q,C).curveTo(B-q,C+u,B+q,C+u,B+q,C).setStroke({color:c,width:j});if(h!=null&&this.shape!="hollow"){h.setFill(c)}if(this.showlabel){var w="";if(this.label!=null&&this.label!=""){w=this.label}var n=JSDraw2.defaultoptions.tlc==null||JSDraw2.defaultoptions.tlc.rflabel==null?"rf=":JSDraw2.defaultoptions.tlc.rflabel;w+="("+n+this.rf.toFixed(2)+")";JSDraw2.Drawer.drawText(A,new JSDraw2.Point(B+z,C-z*2),w,c,f*1.3,"left")}}}});JSDraw2.TLCTemplates={dlg:null,current:null,editor:null,templates:null,jsds:{},get:function(){this._load();return this.templates[this.current]},_load:function(){if(this.templates!=null){return}if(JSDraw2.tlctemplates!=null){if(JSDraw2.tlctemplates.length>0){this.templates={};for(var c=0;c<JSDraw2.tlctemplates.length;++c){this.templates["Template "+(c+1)]=JSDraw2.tlctemplates[c]}}else{this.templates=JSDraw2.tlctemplates}}else{this.templates={"1 Lane":"<div version='1.3' class='JSDraw' app='JSDraw V3.1.0' style='width:772px;height:326px;'><i i='1' x='TLC' size='0.364' p='13.260 -13.832 6.864 10.608'><s lane='1' rf='0.673' rx='0.750' ry1='1.000' ry2='1.000' shape='solid' showlabel='1'/></i></div>","2 Lanes":"<div version='1.3' class='JSDraw' app='JSDraw V3.1.0' style='width:772px;height:326px;'><i i='1' x='TLC' size='0.364' p='13.260 -13.832 6.864 10.608'><s lane='1' rf='0.673' rx='0.750' ry1='1.000' ry2='1.000' shape='solid' showlabel='1'/><s lane='2' rf='0.240' rx='0.750' ry1='1.000' ry2='1.000' shape='solid' showlabel='1'/></i></div>","3 Lanes":"<div version='1.3' class='JSDraw' app='JSDraw V3.1.0' style='width:772px;height:326px;'><i i='1' x='TLC' size='0.364' p='14.508 -15.132 8.632 11.024'><s lane='1' rf='0.401' rx='0.750' ry1='1.000' ry2='1.000' clr='#808080' shape='solid' label='R1'/><s lane='2' rf='0.399' rx='0.750' ry1='1.000' ry2='1.000' clr='#808080' shape='solid' label='R1' showlabel='1'/><s lane='3' rf='0.586' rx='0.750' ry1='1.000' ry2='1.000' clr='#0000ff' shape='solid' label='P1' showlabel='1'/><s lane='2' rf='0.587' rx='0.750' ry1='1.000' ry2='1.000' clr='#0000ff' shape='solid' label='P1'/></i></div>","4 Lanes":"<div version='1.3' class='JSDraw' app='JSDraw V3.1.0' style='width:772px;height:326px;'><i i='1' x='TLC' size='0.364' p='10.504 -16.068 9.412 11.596'><s lane='1' rf='0.202' rx='0.750' ry1='1.000' ry2='1.000' shape='solid' showlabel='1'/><s lane='2' rf='0.417' rx='0.750' ry1='1.000' ry2='1.000' shape='solid' showlabel='1'/><s lane='3' rf='0.620' rx='0.750' ry1='1.000' ry2='1.000' shape='solid' showlabel='1'/><s lane='4' rf='0.859' rx='0.750' ry1='1.000' ry2='1.000' shape='solid' showlabel='1'/></i></div>"}}},show:function(f,c){this.editor=c;this.create();this.dlg.show(null,null,f);var d=this.jsds[this.current];if(scil.Utils.isIE&&scil.Utils.isIE<9&&d!=null){this.createJsd(d.div,this.current)}d.jsd.moveCenter();d.jsd.refresh()},hide:function(){if(this.dlg!=null){this.dlg.hide()}},create:function(){if(this.dlg!=null){return false}this._load();var t=JSDraw2.defaultoptions.tlc!=null&&JSDraw2.defaultoptions.tlc.size>0?JSDraw2.defaultoptions.tlc.size:150;var c=JSDraw2.defaultoptions.tlc!=null&&JSDraw2.defaultoptions.tlc.cols>0?JSDraw2.defaultoptions.tlc.cols:4;this.div=scil.Utils.createElement(null,"div",null,{width:(c*t+80)+"px",overflowY:"scroll",fontSize:"28px",textAlign:"center"});scil.Utils.unselectable(this.div);var u=scil.Utils.createTable(this.div,null,null,{width:"100%"});var x=null;var j={};var l=this;var q=0;for(var h in this.templates){++q;if((q-1)%c==0){x=scil.Utils.createElement(u,"tr")}var w=scil.Utils.createElement(x,"td",null,{border:"solid 1px #f5f5f5",textAlign:"center"},{title:h});var f=scil.Utils.createElement(w,"div",null,{width:"150px",height:"150px"});j[h]=f;dojo.connect(f,"onmouseup",function(d){if(d.button!=2){l.select(d);d.preventDefault()}})}for(var g=x.childNodes.length;g<c;++g){var w=scil.Utils.createElement(x,"td");var f=scil.Utils.createElement(w,"div",null,{width:t+"px",height:t+"px"})}if(Math.floor(q/c)*t>600){this.div.style.height="600px"}this.dlg=new JSDraw2.Dialog(scil.Utils.res("TLC Templates"),this.div);this.dlg.show();for(var h in j){this.createJsd(j[h],h)}return true},createJsd:function(c,f){var g=this.templates[f];var d=new JSDraw2.Editor(c,{viewonly:true,showcontextmenu:false});d.setXml(g);this.jsds[f]={jsd:d,div:c}},select:function(c){var h=c.srcElement||c.target;if(h.tagName!="TD"){h=scil.Utils.getParent(h,"TD")}this.current=h.getAttribute("title");this.dlg.hide();var l=this.get();if(l==null){return}var d=new JSDraw2.Mol();d.setXml(l);var j=d.graphics[0];if(JSDraw2.TLC.cast(j)==null){return}j.selected=true;if(d.graphics.length>0&&JSDraw2.TLC.cast(d.graphics[0])!=null){d.scale(this.editor.fontsize/2/d.graphics[0].spotsize)}var f=this.editor.m.rect();if(f!=null){var g=d.rect();d.offset(f.right()+this.editor.bondlength*3-g.left,f.center().y-g.center().y)}this.editor.pushundo();this.editor.addTlcPlate(j);this.editor.refresh(true)}};scil.apply(JSDraw2.Editor.prototype,{showContextMenu:function(z,ac){if(this.options.showcontextmenu==false){return}var y="#ff0000,#00ffff,#0000ff,#800080,#FFFF00,#00FF00,#FF00FF,#C0C0C0,#808080,#000000,#FFA500,#A52A2A,#800000,#008000,#808000".split(",");var w=[{caption:"Default",key:""},"-"];for(var G=0;G<y.length;++G){w.push({caption:"&nbsp;",key:y[G],bg:y[G]})}w.push("-");w.push({caption:"Other Colors",key:"other"});var f=0;var K=this;var H=[];if(ac){var M=this.eventPoint(z);this.curObject=this.toggle(M);var c=JSDraw2.Atom.cast(this.curObject);var l=c==null?null:c.biotype();var d=JSDraw2.AssayCurve.cast(this.curObject);var U=JSDraw2.Spectrum.cast(this.curObject);if(l==JSDraw2.BIO.PROTEIN||l==JSDraw2.BIO.GENE||l==JSDraw2.BIO.DNA||l==JSDraw2.BIO.RNA||l==JSDraw2.BIO.ANTIBODY){H.push({caption:"Show Sequences",key:"bio_showsequence"});f=3}else{if(d!=null){H.push({caption:"View Raw Assay Data",key:"setrawassaydata"});if(this.options.allowqccurve){H.push({caption:"QC Curve",key:"maskdatapoints"})}f=3}else{if(U!=null){H.push({caption:"View Attributes",key:"spectrum_attributes"});f=3}else{if(this.options.popup){H.push({caption:"Edit",key:"edit-popup"})}if(!this.options.appmode){H.push({caption:"Copy",key:"copy-viewonly"})}if(this.options.pastechemdraw){H.push({caption:"Copy ChemDraw etc.",key:"copychemdraw"})}H.push({caption:"Copy Molfile",key:"copymolfile"});H.push({caption:"Copy SMILES",key:"copysmiles"});H.push({caption:"Copy HELM",key:"copyhelm",disabled:!this.hasHelmNodes()});f=2}}}}else{if(this.curObject!=null){var O=false;if(!this.curObject.selected){this.m.setSelected();this.curObject.selected=true;O=true}var u=this.getCmd();if((u=="tlc"||u=="electrophoresis")&&JSDraw2.TLC.cast(this.curObject)!=null){var M=this.eventPoint(z);this.curObject.cornerTest(M,this.tor,false,"tlc");O=true}if(O){this.refresh(false)}}var c=JSDraw2.Atom.cast(this.curObject);if(c!=null){if(c.bio==null){var B=JSDraw2.PT[c.elem];if(H.length>0){H.push("-")}H.push({caption:"Atom Properties",key:"atom_prop"});H.push("-");H.push({caption:"Atom Type",callback:function(t){K.menuSetAtomType(t)},children:JSDraw2.PT.getCommonUsedElements("menu")});H.push({caption:"Enhanced Stereochemistry",callback:function(t){K.menuSetEhnStereochemistry(t)},children:["None","-","abs","-","&1","&2","&3","&4","&5","-","or1","or2","or3","or4","or5"]});if(B!=null&&B.a>0){H.push({caption:"Atom Charges",callback:function(t){K.menuSetAtomCharges(t)},children:["+4","+3","+2",{caption:"+1",shortcut:"+"},"-","0","-",{caption:"-1",shortcut:"-"},"-2","-3","-4"]});var J=[c.elem,"-"];if(B.iso!=null){for(var I in B.iso){J.push(c.elem+"-"+I)}}H.push({caption:"Isotope",callback:function(t){K.menuSetAtomIsotope(t)},children:J});H.push({caption:"Radical",callback:function(t){K.menuSetAtomRadical(t)},children:[{caption:"Off",key:"0"},"-",{caption:"Singlelet",key:"1"},{caption:"Doublelet",key:"2"},{caption:"Triplelet",key:"3"}]})}H.push({caption:"Detect Selected Stereochemistry",key:"detectstereochemistry"});H.push({caption:"Hide Selected Stereochemistry",key:"hidestereochemistry"});H.push({caption:"Add Tag",key:"atom_tag"});if(this.options.query){H.push("-");H.push({caption:"Create Multi-Center",key:"multi-center"});H.push("-");H.push({caption:"R Group",callback:function(t,ad){K.menuSetAtomType(t,ad)},children:["R","R1","R2","R3","R4","R5"]});H.push({caption:"Create R Definition",disabled:c.rgroup!=null,key:"rgroup_define"});H.push({caption:"Remove R Definition",disabled:c.rgroup==null,key:"rgroup_remove"});H.push({caption:"Attach Point",callback:function(t,ad){K.menuSetAttachPoint(t,ad)},children:[{key:0,caption:"None"},"-","1","1,2","-",{key:98,caption:"Link"},{key:99,caption:"Basis"}]});H.push({caption:"Query Atoms",callback:function(t,ad){K.menuSetAtomType(t,ad)},children:[{caption:"* - Wildcard",key:"*",shortcut:"*"},{caption:"@ - Multi-Center Attachment",key:"@"},{caption:"A - Not Hydrogen",key:"A",shortcut:"A"},{caption:"Q - Not H and C",key:"Q",shortcut:"Q"},{caption:"X - Halide",key:"X",shortcut:"X"},{caption:"M - Metal",key:"M",shortcut:"M"}]});H.push({caption:"Query",callback:function(ad,ae,t){K.menuSetAtomQuery(ad,null,t,ae)},children:[{caption:"Substituents",callback:function(t){K.menuSetAtomQuery(t,"sub")},children:["Default","-","*","0","1","2","3","4","5","6"]},{caption:"Ring Bonds",callback:function(t){K.menuSetAtomQuery(t,"rbc")},children:["Default","-","0","2","3","4"]},{caption:"Edit Atom List ...",key:"als"},{caption:"Unsaturated",key:"uns",checked:c.query!=null&&c.query.uns},"-",{caption:"Lock Connection",key:"connection_lock"},{caption:"Unlock Connection",key:"connection_unlock"},"-","Clear"]})}H.push("-");H.push({caption:"Color",callback:function(t,ad){K.menuSetColor(t,ad)},children:w});H.push("-");H.push({caption:"Delete",shortcut:"Del"})}else{var l=c.biotype();if(l==JSDraw2.BIO.ANTIBODY){H.push({caption:"Antibody Type",callback:function(t,ad){K.menuAntiboyType(ad,t)},children:[{caption:"Whole IgG",checked:c.bio.subtype==null||c.bio.subtype==JSDraw2.ANTIBODY.IgG},{caption:"Fab",checked:c.bio.subtype==JSDraw2.ANTIBODY.Fab},{caption:"ScFv",checked:c.bio.subtype==JSDraw2.ANTIBODY.ScFv}]});H.push({caption:"Show Sequences",key:"bio_showsequence"});H.push({caption:"Add Tag",key:"atom_tag"})}else{if(l==JSDraw2.BIO.PROTEIN||l==JSDraw2.BIO.GENE||l==JSDraw2.BIO.DNA||l==JSDraw2.BIO.RNA){H.push({caption:"Show Sequences",key:"bio_showsequence"});H.push({caption:"Add Tag",key:"atom_tag"})}else{if(l==scil.helm.HELM.SUGAR){if(c.bio.annotation!=null){H.push({caption:"Set as Sense",key:"helm_set_sense"});H.push({caption:"Set as Antisense",key:"helm_set_antisense"});H.push({caption:"Clear Annotation",key:"helm_set_clear"});H.push("-");H.push({caption:"Create Complementary Strand",key:"helm_complementary_strand"});H.push("-");H.push({caption:"Auto-Pair Hairpin",key:"helm_pair_hairpin"});H.push({caption:"Auto-Pair Duplex",key:"helm_pair_duplex"});H.push("-");H.push({caption:"Remove HydrogenBonds",key:"helm_remove_hbonds"})}}else{if(l==scil.helm.HELM.CHEM||scil.helm.isInlineSmilesNode(c)){H.push({caption:"Expand",key:"helm_expand_node"})}}}}if(scil.helm.ambiguity&&scil.helm.isHelmNode(l)&&c.superatom==null){if(H.length>0){H.push("-")}if(l==scil.helm.HELM.BLOB){H.push({caption:"Blob Type",callback:function(t,ad){K.helm.setHelmBlobType(ad,t)},children:scil.helm.blobtypes})}else{H.push({caption:"Create Group",key:"helm_create_group"})}}}if(c.superatom!=null){if(H.length>0){H.push("-")}H.push({caption:"Expand"})}}var j=JSDraw2.Bond.cast(this.curObject);if(j!=null){if(H.length>0){H.push("-")}if(j.a1.bio!=null||j.a2.bio!=null){if(scil.helm.isProteinAntibody(j.a1)||scil.helm.isProteinAntibody(j.a2)){H.push({caption:"Set Bond Attributes",key:"helm_bond_prop"})}else{if(j.a1.biotype()==scil.helm.HELM.AA||j.a2.biotype()==scil.helm.HELM.AA){H.push({caption:"Set Bond Shape",key:"helm_bond_shape",callback:function(t,ad){K.menuSetBondShape(t,j)},children:[{caption:"Default"},"-",{key:"Z",caption:"Z Shape"},"-",{key:"U",caption:"Up"},{key:"D",caption:"Down"}]})}}}else{H.push({caption:"Bond Properties",key:"bond_prop"});H.push("-");H.push({caption:"Bond Type",callback:function(t){K.menuSetBondType(t)},children:[{caption:"Single",shortcut:"1"},{caption:"Double",shortcut:"2"},{caption:"Triple",shortcut:"3"},{caption:"Delocalized",shortcut:"4"},"-",{caption:"Up",shortcut:"5"},{caption:"Down",shortcut:"6"},{caption:"Wiggly",shortcut:"7"},"Bold","Hashed","-",{caption:"Either",shortcut:"8"},"-",{caption:"Any"},{caption:"Ionic"},{caption:"Single or Double"},{caption:"Single or Aromatic"},{caption:"Double or Aromatic"}]});H.push({caption:"Bond Topology",callback:function(t){K.menuSetBondTop(t)},children:["Unspecified","-","Chain","Ring"]});if(this.m.isRxn()){H.push({caption:"Reaction Center",callback:function(t){K.menuSetRxnCenter(t)},children:[{key:"",caption:"Unspecified"},"-",{key:"-1",caption:"Not Center"},{key:"1",caption:"Center"},{key:"4",caption:"Break/Form"},{key:"8",caption:"Change"},{key:"12",caption:"Break/Form and Change"}]})}H.push("-");H.push({caption:"Create Multi-Center",key:"multi-center"});H.push("-");H.push({caption:"Add Tag",key:"bond_tag"});H.push({caption:"Unknown Locant",key:"bond_locant"});H.push("-");H.push({caption:"Color",callback:function(t,ad){K.menuSetColor(t,ad)},children:w});H.push("-");H.push({caption:"Delete",shortcut:"Del"})}}var N=JSDraw2.RGroup.cast(this.curObject);if(N!=null){if(H.length>0){H.push("-")}H.push({caption:"Add Structure",key:"rgroup_addstructure"})}var n=JSDraw2.Bracket.cast(this.curObject);if(n!=null){var J=[];var aa=n.type;if(aa=="mul"){aa="#"}if(JSDraw2.SGroup.types[aa]==null){aa=""}for(var I in JSDraw2.SGroup.types){J.push({caption:JSDraw2.SGroup.types[I]+(I==""?"":" ("+I+")"),key:I,checked:aa==I})}H.push({caption:"Bracket Type",callback:function(ad,ae,t){K.menuBracket(ad,"type",t,ae)},children:J});if(JSDraw2.MOLECULETYPES!=null){var J=[{caption:"Default",key:""},"-"].concat(JSDraw2.MOLECULETYPES);H.push({caption:"Set Mol Type",callback:function(ad,ae,t){K.menuBracket(ad,"moltype",t,ae)},children:J})}if(JSDraw2.CHIRALITIES!=null){var J=[{caption:"Unknown",key:""},"-"].concat(JSDraw2.CHIRALITIES);H.push({caption:"Set Chirality",callback:function(ad,ae,t){K.menuBracket(ad,"chirality",t,ae)},children:J})}var aa=n.getType();var X=JSDraw2.SGroup.subtypes[aa];var x=JSDraw2.SGroup.connectivities[aa];var L=JSDraw2.SGroup.modflags[aa];if(X!=null){H.push({caption:"Bracket Sub-type",callback:function(ad,ae,t){K.menuBracket(ad,"subtype",t,ae)},children:X})}else{H.push({caption:"Bracket Sub-type",disabled:true})}if(x!=null){H.push({caption:"Connectivity",callback:function(ad,ae,t){K.menuBracket(ad,"connectivity",t,ae)},children:x})}else{H.push({caption:"Connectivity",disabled:true})}if(L!=null){H.push({caption:"Mod Flags",callback:function(ad,ae,t){K.menuBracket(ad,"modflag",t,ae)},children:L})}else{H.push({caption:"Mod Flags",disabled:true})}if(JSDraw2.SGroup.ratios[aa]){H.push({caption:"Set Ratio",key:"setbracketratio"})}else{H.push({caption:"Set Ratio",disabled:true})}H.push({caption:"Set MW",key:"setbracketmw"});H.push({caption:"Registration Parent",key:"registrationparent"})}var Y=JSDraw2.Text.cast(this.curObject);if(Y!=null){var C=["None"];var ab=JSDraw2.SGroup.allfieldtypes;if(ab!=null){for(var G=0;G<ab.length;++G){if(ab[G]=="-"){C.push("-")}else{if(ab[G]==Y.fieldtype){C.push({caption:ab[G],checked:true})}else{C.push({caption:ab[G]})}}}}var E=[10,12,14,16,18,20,30,40,60];var D=[];for(var G=0;G<E.length;++G){D.push({caption:"<div style='font-size:"+E[G]+"px'>"+E[G]+"</div>",key:E[G]})}H.push({caption:"Font Size",callback:function(t,ad){K.menuSetFontsize(t,ad)},children:D});H.push({caption:"Color",callback:function(t,ad){K.menuSetColor(t,ad)},children:w});H.push("-");H.push({caption:"Field Type",callback:function(t,ad){K.menuSetTextField(t,ad)},children:C})}var T=JSDraw2.Shape.cast(this.curObject);if(T!=null){H.push({caption:"Shape Type",callback:function(t,ad){K.menuShapeType(ad,t)},children:[{key:"rectangle",caption:"&rect; "+this.res("Rectangle")},{key:"ellipse",caption:"O "+this.res("Ellipse")},{key:"diamond",caption:"&diam; "+this.res("Diamond")},{key:"dreversed",caption:"D "+this.res("D Reversed")},{key:"dshape",caption:"D "+this.res("D Shapre")},"-",{key:"square",caption:"&squ; "+this.res("Square")},{key:"circle",caption:"&cir; "+this.res("Circle")},]});H.push({caption:"Set Fill",callback:function(t,ad){K.menuShapeFill(ad,t)},children:["None","-","Solid","Radial","Linear","Linear-X","Linear-Y"]});H.push({caption:"Align Shapes",callback:function(t,ad){K.menuAlignShapes(ad,t)},children:[{key:"left",icon:scil.Utils.imgSrc("img/alignleft.gif"),caption:"Align Left"},{key:"center",icon:scil.Utils.imgSrc("img/aligncenter.gif"),caption:"Align Horizontal Center"},{key:"right",icon:scil.Utils.imgSrc("img/alignright.gif"),caption:"Align Right"},"-",{key:"top",icon:scil.Utils.imgSrc("img/aligntop.gif"),caption:"Align Top"},{key:"middle",icon:scil.Utils.imgSrc("img/alignmiddle.gif"),caption:"Align Vertical Center"},{key:"bottom",icon:scil.Utils.imgSrc("img/alignbottom.gif"),caption:"Align Bottom"},"-",{key:"width",icon:scil.Utils.imgSrc("img/alignwidth.gif"),caption:"Align Width"},{key:"height",icon:scil.Utils.imgSrc("img/alignheight.gif"),caption:"Align Height"}]});H.push("-");H.push({caption:"Workflow Properties",key:"workflow_properties"});H.push("-");H.push({caption:"Color",callback:function(t,ad){K.menuSetColor(t,ad)},children:w});H.push("-");H.push({caption:"Bring to Front",key:"graphics_bring2front"});H.push({caption:"Set to Back",key:"graphics_set2back"})}var d=JSDraw2.AssayCurve.cast(this.curObject);if(d!=null){H.push({caption:"Set Raw Data & Fit Curve",key:"setrawassaydata"});if(this.options.allowqccurve){H.push({caption:"QC Curve",key:"maskdatapoints"})}H.push("-");H.push({caption:"Show Curve Only",key:"curveonly",checked:d.curveonly});H.push({caption:"Show IC50 Line",key:"curveline",checked:d.curveline});var R=d.showline;var S=[{key:"",caption:"Both",checked:R!="data"&&R!="curve"},"-",{key:"curve",caption:"Curve Only",checked:R=="curve"},{key:"data",caption:"Data Only",checked:R=="data"}];H.push({caption:"Show Curve",callback:function(t,ad){JSDraw2.AssayCurve.menuSetShowCurve(ad,t,K)},children:S});if(JSDraw2.AssayCurve.toNumber(d.icx)!=null){H.push({caption:"Show ICx Line",key:"icxline",checked:d.icxline})}H.push("-");H.push({caption:"Overlay Curves",key:"overlaycurves"});H.push("-");H.push({caption:"Color",callback:function(t,ad){K.menuSetColor(t,ad)},children:w});H.push("-");H.push({caption:"Bring to Front",key:"graphics_bring2front"});H.push({caption:"Set to Back",key:"graphics_set2back"})}var U=JSDraw2.Spectrum.cast(this.curObject);if(U!=null){H.push({caption:"Set Data",key:"spectrum_setdata"});if(typeof(JSDrawServices)!="undefined"&&JSDrawServices!=null&&JSDrawServices.url!=null){H.push({caption:"Set Data from File",key:"spectrum_setdatafromfile"})}H.push("-");H.push({caption:"View Attributes",key:"spectrum_attributes"});H.push("-");H.push({caption:"Color",callback:function(t,ad){K.menuSetColor(t,ad)},children:w});H.push("-");H.push({caption:"Bring to Front",key:"graphics_bring2front"});H.push({caption:"Set to Back",key:"graphics_set2back"})}var Z=JSDraw2.TLC.cast(this.curObject);if(Z!=null){var M=this.eventPoint(z);var V=Z.curspot;var A=Z.type=="electrophoresis";if(V!=null){if(!A){H.push({caption:"Spot Label",callback:function(t,ad){K.menuTLCSetLabel(ad,t)},children:[{caption:"None",key:""},"-","R1","R2","R3","-","P1","P2","P3"]});H.push({caption:"Spot RF Label",callback:function(t,ad){K.menuTLCLabel(ad,t)},children:["Show","Hide"]});H.push({caption:"Spot Fill",callback:function(t,ad){K.menuTLCFill(ad,t)},children:["Solid","Hollow"]});H.push({caption:"Spot Shape",callback:function(t,ad){K.menuTLCSetSpotShape(ad,"circle")},children:[{caption:scil.Utils.imgTag("spot-circle.gif"),cmd:"Circle"},"-",{caption:scil.Utils.imgTag("spot-hellipse.gif"),callback:function(t,ad){K.menuTLCSetSpotShape(ad,"hellipse",t)},children:["Small","Medium","Wide"]},{caption:scil.Utils.imgTag("spot-vellipse.gif"),callback:function(t,ad){K.menuTLCSetSpotShape(ad,"vellipse",t)},children:["Small","Medium","Tall"]},{caption:scil.Utils.imgTag("spot-halfellipseup.gif"),callback:function(t,ad){K.menuTLCSetSpotShape(ad,"halfellipseup",t)},children:["Short","Long","Long-X","Long-XX","Long-XXX"]},{caption:scil.Utils.imgTag("spot-halfellipsedown.gif"),callback:function(t,ad){K.menuTLCSetSpotShape(ad,"halfellipsedown",t)},children:["Short","Long","Long-X","Long-XX","Long-XXX"]},{caption:scil.Utils.imgTag("spot-blowingup.gif"),callback:function(t,ad){K.menuTLCSetSpotShape(ad,"blowingup",t)},children:["Short","Long","Long-X","Long-XX","Long-XXX"]},{caption:scil.Utils.imgTag("spot-blowingdown.gif"),callback:function(t,ad){K.menuTLCSetSpotShape(ad,"blowingdown",t)},children:["Short","Long","Long-X","Long-XX","Long-XXX"]},{caption:scil.Utils.imgTag("spot-crescentup.gif"),callback:function(t,ad){K.menuTLCSetSpotShape(ad,"crescentup",t)},children:["Short","Long","Long-X","Long-XX"]},{caption:scil.Utils.imgTag("spot-crescentdown.gif"),callback:function(t,ad){K.menuTLCSetSpotShape(ad,"crescentdown",t)},children:["Short","Long","Long-X","Long-XX"]}]})}H.push({caption:"Spot Size",callback:function(t,ad){K.menuTLCSetSpotSize(ad,t)},children:["50%","75%","100%","125%","150%","200%","300%"]});H.push({caption:"Spot Color",callback:function(t,ad){K.menuSetColor(t,ad)},children:w});H.push("-");H.push({caption:"Set Spot RF",key:"tlc_setrfvalue"});H.push("-");H.push({caption:"Duplicate Spot",key:"tlc_duplicatespot"});H.push({caption:"Remove Spot",key:"tlc_removespot"});H.push("-");H.push({caption:"Duplicate Lane",key:"tlc_duplicatelane"})}else{H.push({caption:"Append Lane",key:"tlc_addlane"});H.push("-");if(!A){H.push({caption:"RF Labels of All Spots",callback:function(t,ad){K.menuTLCLabel(ad,t)},children:["Show","Hide"]});H.push({caption:"All Spots Fill",callback:function(t,ad){K.menuTLCFill(ad,t)},children:["Solid","Hollow"]})}H.push({caption:"Frame Color",callback:function(t,ad){K.menuSetColor(t,ad)},children:w});if(!A){H.push("-");H.push({caption:"Show Lane Label",key:"tlc_showlanelabel",checked:Z.showlanelabel});H.push({caption:"Set Lane Labels",key:"tlc_setlanelabels"})}}H.push("-");H.push({caption:"Bring to Front",key:"graphics_bring2front"});H.push({caption:"Set to Back",key:"graphics_set2back"})}var g=JSDraw2.Arrow.cast(this.curObject);if(g!=null){var h=["default","solid","-","reversible","double","dual","-","none"];var J=[];for(var G=0;G<h.length;++G){if(h[G]=="-"){J.push("-")}else{J.push({caption:scil.Utils.imgTag("arrow-"+h[G]+".gif"),key:h[G]})}}H.push({caption:"Arrow Style",callback:function(t,ad){K.menuSetArrowStyle(t,ad)},children:J});H.push({caption:"Color",callback:function(t,ad){K.menuSetColor(t,ad)},children:w});H.push("-");H.push({caption:"Bring to Front",key:"graphics_bring2front"});H.push({caption:"Set to Back",key:"graphics_set2back"})}var F=JSDraw2.Group.cast(this.curObject);if(F!=null){H.push({caption:"Collapse",key:"helm_group_collapse"})}if(c==null&&j==null&&n==null&&Y==null&&N==null&&T==null&&Z==null&&d==null&&U==null&&g==null&&F==null){H=[];if(JSDraw2.defaultoptions.and_enantiomer){var W=[{caption:"Absolute",key:"abs",checked:this.m.chiral==null},{caption:"AND Enantiomer",key:"and",checked:this.m.chiral=="and"},{caption:"OR Enantiomer",key:"or",checked:this.m.chiral=="or"}];H.push({caption:"Mol. Chirality",children:W,callback:function(t){K.menuSetStereochemistry(t)}});H.push("-")}else{if(JSDraw2.defaultoptions.simplechiral){var W=[{caption:"Chiral",key:"1",checked:this.m.chiral=="1"},{caption:"Nonchiral",key:null,checked:this.m.chiral!="1"}];H.push({caption:"Mol. Chirality",children:W,callback:function(t){K.menuSetStereochemistry(t)}});H.push("-")}else{var W=[{caption:"As Drawn",key:"abs",checked:this.m.chiral==null},"-",{caption:"Racemic",key:"rac",checked:this.m.chiral=="rac"},{caption:"Single Enantiomer",key:"ena",checked:this.m.chiral=="ena"},"-",{caption:"Unknown Chiral",key:"unk",checked:this.m.chiral=="unk"}];H.push({caption:"Mol. Chirality",children:W,callback:function(t){K.menuSetStereochemistry(t)}});H.push("-")}}if(!this.options.appmode){H.push({caption:"Undo",shortcut:"Ctrl+Z",disabled:this._undostack.length()==0});H.push({caption:"Redo",shortcut:"Ctrl+Y",disabled:this._redostack.length()==0})}H.push("-");H.push({caption:"Color",callback:function(t,ad){K.menuSetColor(t,ad)},children:w});H.push("-");if(this.options.pastechemdraw){var P=this.m.parseRxn();var q=null;if(P!=null&&P.arrow!=null){q=[{caption:"As Reactant",key:"pastechemdrawasreactant"},{caption:"As Product",key:"pastechemdrawasproduct"}]}H.push({caption:"Copy ChemDraw etc.",key:"copychemdraw"});H.push({caption:"Paste ChemDraw etc.",key:"pastechemdraw",children:q})}H.push({caption:"Copy Molfile",key:"copymolfile"});H.push({caption:"Copy SMILES",key:"copysmiles"});H.push({caption:"Copy HELM",key:"copyhelm",disabled:!this.hasHelmNodes()});H.push("-");if(this.hasSelected()){if(!this.options.appmode){H.push({caption:"Copy",shortcut:"Ctrl+C"});H.push({caption:"Cut",shortcut:"Ctrl+X"});H.push({caption:"Paste",shortcut:"Ctrl+V",disabled:JSDraw2.Editor.getClipboard()==null})}H.push({caption:"Delete",shortcut:"Del"})}else{H=H.concat([{caption:"Select All",shortcut:"Ctrl+A"},{caption:"Paste",shortcut:"Ctrl+V",disabled:JSDraw2.Editor.getClipboard()==null},{caption:"Clear",disabled:this.m.isEmpty()}])}f=1}}if(f!=0){if(!ac){H.push({caption:"Remove All Atom Values",key:"removeatomvalues"});H.push("-");H.push({caption:"Detect All Stereochemistry",key:"detectstereochemistry2"});H.push({caption:"Hide All Stereochemistry",key:"hidestereochemistry2"})}if(ac&&!this.options.popup){H.push("-");H.push({caption:"View in Large Window",key:"viewlarge"});H.push({caption:"Move to Center",key:"movecenter"})}if(this.options.sendquery){H.push("-");H.push({caption:"Search",callback:function(t){K.sendQuery(t)},children:[{caption:"PubChem"},{caption:"ChemSpider"}]})}if(this.options.scifinder!=false&&scil.SciFinder.enabled){H.push("-");H.push({caption:"Search SciFinder<sup>n</sup>",key:"scifinder"})}H.push("-");H.push({caption:"About JSDraw",key:"about"})}if(this.contextmenu==null){this.contextmenu=new JSDraw2.ContextMenu(H,function(t,ad){K.menuCallback(t,ad)},null,null,JSDraw2.Language)}var Q=scil.Utils.scrollOffset();this.contextmenu.show(z.clientX+Q.x,z.clientY+Q.y,this.curObject,H);this.contextmenu.pos=this.eventPoint(z)},rgroupDefine:function(g){var c=JSDraw2.Atom.cast(g);if(c==null||c.rgroup!=null){return false}var f=null;var d=c.alias;if(c.elem!="R"||d==null||d==""){f="R";if(d==null||d==""||JSDraw2.SuperAtoms.get(d)!=null){d="R"+(this.m.getMaxRIndex()+1)}}var h=this.m.rect();var j=new JSDraw2.RGroup(new JSDraw2.Rect(h.left,h.bottom()+2*this.bondlength,0,0),d+"=");c.rgroup=j;if(f!=null){c._parent.setAtomType(c,f)}c._parent.setAtomAlias(c,d);this.fitToWindow(this.bondlength);return true},createMulticenter:function(){var g=[];for(var f=0;f<this.m.atoms.length;++f){var c=this.m.atoms[f];if(c.selected){g.push(c)}}if(g.length<2){return null}var h=0;var j=0;for(var f=0;f<g.length;++f){h+=g[f].p.x;j+=g[f].p.y}var c=new JSDraw2.Atom(new JSDraw2.Point(h/g.length,j/g.length),"@");this.m.addAtom(c);for(var f=0;f<g.length;++f){var d=new JSDraw2.Bond(g[f],c,JSDraw2.BONDTYPES.DUMMY);this.m.addBond(d)}return c},showPT:function(c){if(JSDraw2.Editor.periodictable==null){var d=1+(this.options.scale-1)/2;JSDraw2.Editor.periodictable=new JSDraw2.Dialog(this.res("Element Periodic Table"),JSDraw2.PT.html(d))}JSDraw2.Editor.periodictable.jsdid=this.id;JSDraw2.Editor.periodictable.show2({owner:this});JSDraw2.Editor.periodictable.callback=c;JSDraw2.PT.showQueryAtoms(JSDraw2.Editor.periodictable.dialog,this.options.query)},showAtomDlg:function(c){var l;if(JSDraw2.Editor.atomDlg==null){var f={atomattributes:{type:"group",label:"Atom Attributes"},charge:{type:"select",label:"Atom Charges",width:120,items:["","-6","-5","-4","-3","-2","-1","0","+1","+2","+3","+4","+5","+6"]},radical:{type:"select",label:"Radical",width:120,items:{"0":"Off","1":"Singlelet","2":"Doublelet","3":"Triplelet"},sort:false},isotope:{type:"number",label:"Isotope",width:120},tag:{type:"input",label:"Atom Value",width:300},queryfeature:{type:"group",label:"Query Features",width:120},als_t:{type:"select",label:"Atom List",width:120,items:{"":"","1":"As","0":"Not As"}},als:{type:"input",width:300},rbc:{type:"select",label:"Ring Bonds",width:120,items:{"":"Default","0":"0 (no rings)","2":"2 (isolated ring)","3":"3 ring bonds","4":"4 ring bonds"}},sub:{type:"input",label:"# Substituents",width:120},uns:{type:"select",label:"Unsaturated Bond",width:120,items:{"":"","0":"No","1":"Yes"}}};var d={label:scil.Utils.imgTag("tick.gif",this.res("Update"))};d.onclick=function(t){var q=JSDraw2.Editor.atomDlg;q.jsd.setAtomProps(q.a);JSDraw2.Editor.atomDlg.hide();q.jsd.activate(true);t.preventDefault()};var n={lang:JSDraw2.Language,onchange:function(q){JSDraw2.Editor.atomDlg.form.buttons[0].disabled=false}};JSDraw2.Editor.atomDlg=scil.Form.createDlgForm("Atom Properties",f,d,n)}var h=JSDraw2.Editor.atomDlg;h.jsd=this;h.a=c;h.show(null,null,null,null,this);h.form.buttons[0].disabled=true;var g={};var j=JSDraw2.PT[c.elem];if(c.elem=="L"||j!=null&&j.a>0){g.charge=c.charge==null?"":(c.charge>0?"+"+c.charge:""+c.charge);g.radical=c.radical==null?"":""+c.radical;g.isotope=c.isotope==null?"":c.isotope}g.tag=c.tag==null?"":c.tag;if(c.query!=null){if(c.query.als!=null){g.als=c.query.als.join(",");g.als_t=c.query.t?"1":"0"}g.rbc=c.query.rbc+"";if(c.query.uns!=null){g.uns=c.query.uns?"1":"0"}g.sub=c.query.sub==null?"":c.query.sub+""}h.form.setData(g)},setAtomProps:function(c){var h=JSDraw2.Editor.atomDlg.form.fields;this.pushundo();var q=h.tag.value;if(q==""){q=null}if(c.tag!=q){c.tag=q}if(c.elem=="R"){}else{var l=null;if(h.als.value!=null){var d=JSDraw2.PT.makeAtomList(h.als.value,h.als_t.value);if(d!=null){if(l==null){l={}}l.als=d.atoms;l.t=d.t}if(!isNaN(h.rbc.value)&&parseInt(h.rbc.value)>=0){if(l==null){l={}}l.rbc=parseInt(h.rbc.value)}if(h.uns.value!=""){if(l==null){l={}}l.uns=scil.Utils.isTrue(h.uns.value)?true:null}if(h.sub.value=="*"||!isNaN(h.sub.value)&&parseInt(h.sub.value)>0){if(l==null){l={}}l.sub=parseInt(h.sub.value)}}if(l!=null&&l.als!=null){this.m.setAtomType(c,"L")}c.query=l;var f=h.charge.value==""?0:parseInt(h.charge.value);if(c.charge!=f&&!isNaN(f)){c.charge=f}var n=h.radical.value==""?null:parseInt(h.radical.value);if(c.radical!=n){c.radical=n;this.m.setHCount(c)}var g=JSDraw2.PT[c.elem];if(g!=null&&g.a>0){var j=h.isotope.value==""?null:parseInt(h.isotope.value);if(c.isotope!=j&&!isNaN(j)){c.isotope=j}}c._parent.setHCount(c)}this.refresh(true)},showBondDlg:function(c){var j;if(JSDraw2.Editor.bondDlg==null){var f={topology:{type:"select",label:"Bond Topology",width:120,items:{"":"","true":this.res("On Ring"),"false":this.res("On Chain")}},rcenter:{type:"select",label:"Reaction Center",width:120,items:{"":"","-1":this.res("Not Center"),"1":this.res("Reaction Center"),"4":this.res("Break/Form"),"8":this.res("Change"),"12":this.res("Break/Form and Change")}}};var d={label:scil.Utils.imgTag("tick.gif",this.res("Update"))};d.onclick=function(q){var n=JSDraw2.Editor.bondDlg;n.jsd.setBondProps(n.b);JSDraw2.Editor.bondDlg.hide();n.jsd.activate(true);q.preventDefault()};var l={lang:JSDraw2.Language,onchange:function(n){JSDraw2.Editor.bondDlg.form.buttons[0].disabled=false}};JSDraw2.Editor.bondDlg=scil.Form.createDlgForm("Bond Properties",f,d,l)}var h=JSDraw2.Editor.bondDlg;h.jsd=this;h.b=c;h.show(null,null,null,null,this);h.form.buttons[0].disabled=true;var g={};g.topology,c.ring==null?"":c.ring+"";g.rcenter,c.rcenter==null?"":c.rcenter+"";h.form.setData(g)},setBondProps:function(c){var d=JSDraw2.Editor.bondDlg.form.fields;this.pushundo();var f=false;var h=null;if(d.topology.value!=""){h=scil.Utils.isTrue(d.topology.value)}if(c.ring!=h){c.ring=h;f=true}var g=d.rcenter.value==""?null:parseInt(d.rcenter.value);if(c.rcenter!=g){c.rcenter=g;f=true}if(f){this.refresh(f)}},addRgroupStructure:function(f){if(JSDraw2.RGroup.cast(f)==null){return}var c=this.clone();var d=f.addStructure(this.bondlength);if(d!=null){this.pushundo(c);d.showimplicithydrogens=this.m.showimplicithydrogens;d.calcHCount()}},menuTLCSetSpotShape:function(d,f,g){if(JSDraw2.TLC.cast(d)==null){return}var c=this.clone();if(d.changeShape(d.curspot,f,g)){this.pushundo(c);this.refresh(true)}},menuTLCSetSpotSize:function(d,f){if(JSDraw2.TLC.cast(d)==null){return}var c=this.clone();if(d.changeSize(d.curspot,f,this.fontsize/2)){this.pushundo(c);this.refresh(true)}},menuTLCLabel:function(f,d){if(JSDraw2.TLC.cast(f)==null){return false}var c=this.clone();if(f.showLabel(f.curspot,d=="Show")){this.pushundo(c);this.refresh(true)}},menuTLCSetLabel:function(f,d){if(JSDraw2.TLC.cast(f)==null){return false}var c=this.clone();if(f.showSetLabel(f.curspot,d)){this.pushundo(c);this.refresh(true)}},menuTLCFill:function(f,d){if(JSDraw2.TLC.cast(f)==null){return false}var c=this.clone();if(f.setShapeFill(f.curspot,d.toLowerCase())){this.pushundo(c);this.refresh(true)}},menuShapeType:function(g,f){var c=JSDraw2.Shape.cast(g);if(c==null){return}var d=this.clone();if(c.changeType(f.toLowerCase())){this.pushundo(d);this.refresh(true)}},menuAlignShapes:function(q,g){var l=[];for(var j=0;j<this.m.graphics.length;++j){var u=JSDraw2.Shape.cast(this.m.graphics[j]);if(u!=null&&u.selected){l.push(u)}}q=JSDraw2.Shape.cast(q);if(l.length==0||l.length==1&&(l[0]==q||q==null)){return false}if(q==null){var j=scil.Utils.indexOf(l,q);q=j>=0?l[j]:l[0]}var f=this.clone();switch(g){case"left":for(var j=0;j<l.length;++j){l[j]._rect.left=q._rect.left}break;case"right":var t=q._rect.right();for(var j=0;j<l.length;++j){l[j]._rect.left=t-l[j]._rect.width}break;case"center":var d=q._rect.center().x;for(var j=0;j<l.length;++j){l[j]._rect.left=d-l[j]._rect.width/2}break;case"top":for(var j=0;j<l.length;++j){l[j]._rect.top=q._rect.top}break;case"bottom":var c=q._rect.bottom();for(var j=0;j<l.length;++j){l[j]._rect.top=c-l[j]._rect.height}break;case"middle":var n=q._rect.center().y;for(var j=0;j<l.length;++j){l[j]._rect.top=n-l[j]._rect.height/2}break;case"width":var w=q._rect.width;for(var j=0;j<l.length;++j){l[j]._rect.width=w}break;case"height":var h=q._rect.height;for(var j=0;j<l.length;++j){l[j]._rect.height=h}break;default:return false}this.pushundo(f);this.refresh(true);return true},menuShapeFill:function(f,d){d=d.toLowerCase();if(d=="none"){d=null}var c=JSDraw2.Shape.cast(f);if(c==null&&c.fill==d){return}this.pushundo();c.fill=d;this.refresh(true)},menuAntiboyType:function(f,d){if(d!="Fab"&&d!="ScFv"){d="IgG"}var c=JSDraw2.Atom.cast(f);if(c==null||c.biotype()!=JSDraw2.BIO.ANTIBODY||d==c.bio.subtype){return}this.pushundo();c.bio.subtype=d;this.refresh(true)},showSequences:function(h){var c=JSDraw2.Atom.cast(h);if(c==null||c.biotype()!=JSDraw2.BIO.ANTIBODY&&c.biotype()!=JSDraw2.BIO.PROTEIN&&c.biotype()!=JSDraw2.BIO.GENE&&c.biotype()!=JSDraw2.BIO.DNA&&c.biotype()!=JSDraw2.BIO.RNA){return}var g=this;var f=function(n){var l=n.getXml();if(c.bio.sequences!=l){c.bio.sequences=l;g.refresh(true)}};var j=c.bio.sequences;if(!this.options.viewonly&&scil.Utils.isNullOrEmpty(j)){switch(c.biotype()){case JSDraw2.BIO.ANTIBODY:j=">Light Chain\nAAA\n\n>Heavy Chain\nBBB";break;case JSDraw2.BIO.PROTEIN:j=">Protein\nAAA";break;case JSDraw2.BIO.GENE:j=">Gene\nATGC";break;case JSDraw2.BIO.DNA:j=">DNA\nATGC";break;case JSDraw2.BIO.RNA:j=">RNA\nATGCU";break}}var d=null;switch(c.biotype()){case JSDraw2.BIO.ANTIBODY:d="protein";break;case JSDraw2.BIO.PROTEIN:d="protein";break;case JSDraw2.BIO.GENE:d="gene";break;case JSDraw2.BIO.DNA:d="dna";break;case JSDraw2.BIO.RNA:d="rna";break}if(this.options.viewonly){JSDraw2.SequenceEditor.showPopupViewer(this.res("View Sequence"),j,"xml",this)}else{JSDraw2.SequenceEditor.showPopup(this.res("Edit Sequence"),j,"xml",f,d,this)}},menuSetFontsize:function(d,j){var h=Math.round(parseFloat(d)*100/14)/100;var g=false;var c=this.clone();if(JSDraw2.Text.cast(j)!=null&&j.fontsize!=h){j.fontsize=h;g=true}if(g){this.pushundo(c);this.refresh(true)}},menuSetBondShape:function(d,f){var c=JSDraw2.Bond.cast(f);if(c==null){return}if((d==""?null:d)==(c.shape==""?null:c.shape)){return}this.pushundo();c.shape=d;this.refresh(true)},menuSetColor:function(d,l){if(d=="other"){var j=this;JSDraw2.ColorPicker.show(function(f){j.menuSetColor(f,l)});return}var g=d==""?null:d.toLowerCase();var h=false;var c=this.clone();if(l!=null){if(JSDraw2.TLC.cast(l)!=null&&l.curspot!=null){l=l.curspot}if(l.color!=g){l.color=g;h=true}}else{if(this.m.setColor(g,true)>0){h=true}}if(h){this.pushundo(c);this.refresh(true)}},menuSetArrowStyle:function(d,f){var c=JSDraw2.Arrow.cast(f);if(c==null){return}d=d.toLowerCase();if(d=="default"){d=null}if(c.arrowstyle==""){c.arrowstyle=null}if(c.arrowstyle!=d){this.pushundo();c.arrowstyle=d;this.refresh(true)}},addTag:function(d,f,g,c){this.pushundo();var h=new JSDraw2.Text(new JSDraw2.Rect(f.x+this.bondlength,f.y,0,0),g);h.fieldtype="IDS_DESCRIPTION";h.attach(d);this.m.addGraphics(h);this.refresh(true);if(c){this.showTextEditor(h)}},setBracketData:function(c,d,g,j){if(JSDraw2.Bracket.cast(c)==null){return}var h=this.m.getSgroupText(c,d);if(h==null){var f=this.m.medBondLength(1.56)/2;h=this.m.setSgroup(c,d,g,c._rect.right()+f/4,c._rect.top-f/4+j*f)}this.showTextEditor(h)},setBracketRatio:function(c){if(JSDraw2.Bracket.cast(c)==null){return}var f=this.m.getSgroupText(c,"RATIO");if(f!=null){this.showTextEditor(f)}else{this.pushundo();var d=this.m.medBondLength(1.56)/2;f=this.m.setSgroup(c,"RATIO","[ratio]",c._rect.right()+d/4,c._rect.top-d/4+d);this.m.setSgroup(c,"RATIO_MAX","[max]",c._rect.right()+d/4,c._rect.top-d/4+2*d);this.m.setSgroup(c,"RATIO_UNITS","wt%",c._rect.right()+d/4,c._rect.top-d/4+3*d);this.refresh(true);this.showTextEditor(f)}},menuBracket:function(h,w,d,q){var c=JSDraw2.Bracket.cast(q);if(c==null){return}var x=null;if(h!="None"){var t=h.indexOf("(")+1;var u=h.indexOf(")");x=t<1?h:h.substr(t,u-t)}var g=this.clone();var j=false;var l=this.m.medBondLength(1.56)/2;switch(w){case"type":if(x=="#"){c.type="mul"}else{c.type=x}j=null!=this.m.setSgroup(c,"BRACKET_TYPE",x,c._rect.right()+l/4,c._rect.bottom()-l);if(j){var n="BRACKET_SUBTYPE,BRACKET_MOD,BRACKET_CONN,RATIO,RATIO_MAX,RATIO_UNITS,DELOCALIZED_CHARGE";this.m.removeTags(c,n)}break;case"subtype":j=null!=this.m.setSgroup(c,"BRACKET_SUBTYPE",x,c._rect.right()+l/4,c._rect.bottom()-2*l);break;case"connectivity":j=null!=this.m.setSgroup(c,"BRACKET_CONN",x,c._rect.right()+l/4,c._rect.top-l/4);break;case"modflag":j=null!=this.m.setSgroup(c,"BRACKET_MOD",x,c._rect.left-(x.length+1)*this.fontsize*0.5,c._rect.top-l/4);break;case"moltype":j=null!=this.m.setSgroup(c,"MOL_TYPE",x,c._rect.right()+l/4,c._rect.top-l/4);break;case"chirality":this.m.chiral=null;j=null!=this.m.setSgroup(c,"CHIRALITY",x,c._rect.right()+l/4,c._rect.top-l/4);break}if(j){this.pushundo(g);this.refresh(true)}},menuSetTextField:function(c,d){if(c=="None"){c=null}d.fieldtype=c},menuSetAttachPoint:function(g,l){var c=JSDraw2.Atom.cast(l);if(c==null){return}var h=false;var d=this.clone();switch(g){case"0":if(c.attachpoints.length!=0){c.attachpoints=[];h=true;break}break;case"1":case"98":case"99":var j=parseInt(g);if(c.attachpoints.length!=1||c.attachpoints[0]!=j){c.attachpoints=[j];h=true;break}case"1,2":if(c.attachpoints.length!=2||c.attachpoints[0]!=1||c.attachpoints[1]!=2){c.attachpoints=[1,2];h=true;break}}if(h){this.pushundo(d);c._parent.setHCount(c);this.refresh(true)}},lockAtomConnection:function(d){var h=[];for(var g=0;g<this.m.atoms.length;++g){var c=this.m.atoms[g];if(c.selected&&c.locked!=d){h.push(c)}}if(h.length==0){return 0}this.pushundo();for(var g=0;g<h.length;++g){h[g].locked=d}this.refresh(true);return h.length},menuSetAtomQuery:function(g,q,f,n){if(g=="Clear"){this.menuSetAtomQuery2("clear")}else{if(g=="uns"){this.menuSetAtomQuery2(g,f)}else{if(q=="sub"||q=="rbc"){this.menuSetAtomQuery2(q,g)}else{if(g=="connection_lock"||g=="connection_unlock"){this.lockAtomConnection(g=="connection_lock")}else{if(g=="als"){if(JSDraw2.Editor.atomlistDlg==null){var t=scil.Utils.createTable(document.body);var u=scil.Utils.createElement(t,"tr");scil.Utils.createElement(u,"td","Logic:");var j=scil.Utils.createElement(scil.Utils.createElement(u,"td"),"select");scil.Utils.listOptions(j,["As","Not As"]);u=scil.Utils.createElement(t,"tr");scil.Utils.createElement(u,"td","List:");var h=scil.Utils.createElement(scil.Utils.createElement(u,"td"),"input",null,{width:"280px"});u=scil.Utils.createElement(t,"tr");scil.Utils.createElement(u,"td");var d=scil.Utils.createElement(scil.Utils.createElement(u,"td"),"button",scil.Utils.imgTag("tick.gif","Save"));var l=this;dojo.connect(d,"onclick",function(x){var w=JSDraw2.Editor.atomlistDlg;l.menuSetAtomQuery2("als",{als:w.list.value,t:w.logic.value=="As"});w.hide();l.activate(true);x.preventDefault()});JSDraw2.Editor.atomlistDlg=new JSDraw2.Dialog("Atom List",t.parentNode);JSDraw2.Editor.atomlistDlg.logic=j;JSDraw2.Editor.atomlistDlg.list=h}JSDraw2.Editor.atomlistDlg.show(null,999999);var c=JSDraw2.Atom.cast(n);JSDraw2.Editor.atomlistDlg.logic.selectedIndex=c==null||c.query==null||c.query.t?0:1;JSDraw2.Editor.atomlistDlg.list.value=c==null||c.query==null||c.query.als==null?"":c.query.als.join(",");this.activate(false)}}}}}},menuSetAtomQuery2:function(q,w){var t=0;var h=this.clone();var g=this.m.allAtoms();for(var l=0;l<g.length;++l){var c=g[l];if(c.selected){if(q=="clear"){if(c.query!=null||c.elem=="L"||c.locked){c.query=null;c.locked=false;if(c.elem=="L"){c.elem="C"}++t}}else{if(q=="als"){var d=JSDraw2.PT.makeAtomList(w.als,w.t);if(d!=null&&d.atoms.length>0){if(c.query==null){c.query={}}c.query.als=d.atoms;c.query.t=d.t;c.elem="L";++t}else{if(c.query!=null&&c.query.als!=null){c.query.als=null;++t}}}else{if(q=="uns"){var j=w==false;if(j&&(c.query==null||!c.query.uns)||!j&&c.query!=null&&c.query.uns){if(c.query==null){c.query={}}c.query.uns=j?true:null;++t}}else{if(q=="sub"){var u=w=="*"?"*":parseInt(w);if(u=="*"||u>=0){if(c.query==null||c.query.sub!=u){if(c.query==null){c.query={}}c.query.sub=u;++t}}else{if(c.query!=null&&c.query.sub!=null){c.query.sub=null;++t}}}else{if(q=="rbc"){var u=parseInt(w);if(u>=0){if(c.query==null||c.query.rbc!=u){if(c.query==null){c.query={}}c.query.rbc=u;++t}}else{if(c.query!=null&&c.query.rbc!=null){c.query.rbc=null;++t}}}}}}}}}if(t>0){this.pushundo(h);this.refresh(true)}},menuSetAtomIsotope:function(g){var t=g.indexOf("-");var l=t<0?null:parseInt(g.substr(t+1));var h=t<0?g:g.substr(t);var q=0;var f=this.clone();var d=this.m.allAtoms();for(var j=0;j<d.length;++j){var c=d[j];if(c.selected&&(c.elem!=h||c.isotope!=l)){if(c.elem!=h){c._parent.setAtomType(c,h);c.query=null}c.isotope=l;++q}}if(q>0){this.pushundo(f);this.refresh(true)}},menuSetAtomRadical:function(g){var l=parseInt(g);var j=0;var f=this.clone();var d=this.m.allAtoms();for(var h=0;h<d.length;++h){var c=d[h];if(c.selected&&c.radical!=l){c.radical=l;this.m.setHCount(c);++j}}if(j>0){this.pushundo(f);this.refresh(true)}},menuSetEhnStereochemistry:function(g){var f=this.clone();var j=0;var d=this.m.atoms;for(var h=0;h<d.length;++h){var c=d[h];if(c.selected&&this.m.markChirality(c,g,this.bondlength)){++j}}if(j>0){this.m.chiral=null;this.pushundo(f);this.refresh(true)}},menuSetBondTop:function(g){var l=null;switch(g){case"Ring":l=true;break;case"Chain":l=false;break}var j=0;var f=this.clone();var d=this.m.allBonds();for(var h=0;h<d.length;++h){var c=d[h];if(d[h].selected&&c.ring!=l){c.ring=l;++j}}if(j>0){this.pushundo(f);this.refresh(true)}},menuSetRxnCenter:function(g){var l=g==""?null:parseInt(g);var j=0;var f=this.clone();var d=this.m.allBonds();for(var h=0;h<d.length;++h){var c=d[h];if(d[h].selected&&c.rcenter!=l){c.rcenter=l;++j}}if(j>0){this.pushundo(f);this.refresh(true)}},menuSetBondType:function(d){var f=false;var c=this.clone();switch(d){case"Any":f=this._setSelectedBondType(JSDraw2.BONDTYPES.UNKNOWN)>0;break;case"Ionic":case"Dummy":f=this._setSelectedBondType(JSDraw2.BONDTYPES.DUMMY)>0;break;case"Single":f=this._setSelectedBondType(JSDraw2.BONDTYPES.SINGLE)>0;break;case"Double":f=this._setSelectedBondType(JSDraw2.BONDTYPES.DOUBLE)>0;break;case"Triple":f=this._setSelectedBondType(JSDraw2.BONDTYPES.TRIPLE)>0;break;case"Delocalized":f=this._setSelectedBondType(JSDraw2.BONDTYPES.DELOCALIZED)>0;break;case"Up":f=this._setSelectedBondType(JSDraw2.BONDTYPES.WEDGE)>0;break;case"Down":f=this._setSelectedBondType(JSDraw2.BONDTYPES.HASH)>0;break;case"Wiggly":f=this._setSelectedBondType(JSDraw2.BONDTYPES.WIGGLY)>0;break;case"Bold":f=this._setSelectedBondType(JSDraw2.BONDTYPES.BOLD)>0;break;case"Hashed":f=this._setSelectedBondType(JSDraw2.BONDTYPES.BOLDHASH)>0;break;case"Either":f=this._setSelectedBondType(JSDraw2.BONDTYPES.EITHER)>0;break;case"Single or Double":f=this._setSelectedBondType(JSDraw2.BONDTYPES.SINGLEORDOUBLE)>0;break;case"Single or Aromatic":f=this._setSelectedBondType(JSDraw2.BONDTYPES.SINGLEORAROMATIC)>0;break;case"Double or Aromatic":f=this._setSelectedBondType(JSDraw2.BONDTYPES.DOUBLEORAROMATIC)>0;break;case"Delete":f=this.delSelected()>0;break}if(f){this.pushundo(c);this.refresh(f)}},getAllTlcPlates:function(h){var f=[];for(var d=0;d<this.m.graphics.length;++d){var c=this.m.graphics[d];if(JSDraw2.TLC.cast(c)!=null){f.push(c)}}if(f.length>0&&h){f.sort(function(g,j){if(g._rect.left==j._rect.left){return 0}if(g._rect.left>j._rect.left){return 1}else{return -1}})}return f},numberTlcPlates:function(){var f=this.getAllTlcPlates(true);var l=[];this.pushundo();for(var d=this.m.graphics.length-1;d>=0;--d){var c=this.m.graphics[d];if(JSDraw2.Text.cast(c)==null){continue}if(/^Plate [0-9]+$/.test(c.text)){this.m.graphics.splice(d,1)}}for(var d=0;d<f.length;++d){var h=f[d].rect();var n="Plate "+(d+1);l.push(n);var u=h.bottom()+this.fontsize/(f[d].showlanelabel?1:2);var j=new JSDraw2.Rect(h.center().x-n.length*this.fontsize/3,u);var q=new JSDraw2.Text(j,n);this.m._addGraphics(q)}this.refresh(true);if(this.options.ontlcnumber!=null){this.options.ontlcnumber(this,l)}},expandSuperatom:function(){var d=JSDraw2.Atom.cast(this.curObject);if(d==null||d.superatom==null){return}var y=d._parent;var E=null;this.pushundo();if(d.bio!=null){if(scil.helm.isHelmNode(d)){if(this.helm.groupExpand(d)){this.refresh(true)}return}var n=y.getAllBonds(d);var E={b:n[0],a:n[0].otherAtom(d)};for(var w=1;w<n.length;++w){var C=n[w].otherAtom(d);if(C.p.x>E.a.p.x){E={b:n[w],a:C}}}y.delBond(E.b,false);E.frag=y.getFragment(E.a);y.addBond(E.b);if(E.frag.atoms.length==y.atoms.length||scil.Utils.indexOf(E.frag.atoms,d)>=0){E.frag.atoms=[];for(var w=0;w<y.atoms.length;++w){var j=y.atoms[w];if(j.p.x>d.p.x){E.frag.atoms.push(j)}}}}this.m.setSelected(false);var z=JSDraw2.SuperAtoms.addToMol(y,d,d.superatom,this.bondlength);for(var w=0;w<z.atoms.length;++w){z.atoms[w].selected=true}if(d.bio!=null){var F=z.atoms[0].p.x;var u=new JSDraw2.Group(d.elem,d.biotype());y.graphics.push(u);for(var w=0;w<z.atoms.length;++w){var j=z.atoms[w];j.group=u;if(j.p.x>F){F=j.p.x}}for(var w=0;w<y.bonds.length;++w){var l=y.bonds[w];if(E.b==l){var C=l.otherAtom(E.a);if(d.biotype()==JSDraw2.BIO.BASE_DNA||d.biotype()==JSDraw2.BASE_RNA){l.type=JSDraw2.BONDTYPES.HASH;if(l.a1==E.a){l.reverse()}}var D=new JSDraw2.Point(F+this.bondlength,C.p.y);E.frag.offset(D.x-E.a.p.x,D.y-E.a.p.y)}}for(var w=0;w<z.bonds.length;++w){var l=z.bonds[w];if(l.a1.elem=="3'"){y.setAtomType(l.a1,"O")}else{if(l.a1.elem=="5'"||l.a1.bio==null&&l.a1.elem=="H"){y.delAtom(l.a1)}}if(l.a2.elem=="3'"){y.setAtomType(l.a2,"O")}else{if(l.a2.elem=="5'"||l.a2.bio==null&&l.a2.elem=="H"){y.delAtom(l.a2)}}}}if(z.bonds.length==2){var A=z.bonds[0].a1;var B=z.bonds[1].a1;var f,h;if(scil.Utils.indexOf(z.atoms,A)>=0){f=z.bonds[0].a2}else{A=z.bonds[0].a2;f=z.bonds[0].a1}if(scil.Utils.indexOf(z.atoms,B)>=0){h=z.bonds[1].a2}else{B=z.bonds[1].a2;h=z.bonds[1].a1}var t=false;if(A.p.x<B.p.x){t=f.p.x>B.p.x&&h.p.x<A.p.x}else{t=h.p.x>B.p.x&&f.p.x<A.p.x}if(t){var q=JSDraw2.Point.centerOf(A.p,B.p);for(var w=0;w<z.atoms.length;++w){z.atoms[w].p.rotateAround(q,180)}}}this.refresh(true)},doRxnMap:function(h){var n=this.m.parseRxn2();if(n==null||n.reactants.length==0||n.products.length==0){return}var q=[];for(var l=0;l<n.reactants.length;++l){if(n.reactants[l].selected){q.push(n.reactants[l])}}var c;this.m.setSelected();if((c=JSDraw2.Atom.cast(h))==null){return}var j=false;var g=null;if(q.length==1&&scil.Utils.fingArrayIndex(n.products,c)>=0){g=this.clone();var d=q[0];if(c.atommapid!=null){j=this.m.clearAtomMap(c.atommapid)>0}else{if(d.atommapid!=null){j=this.m.clearAtomMap(d.atommapid)>0}else{d.atommapid=c.atommapid=this.m.getMaxMapId();j=true}}}else{if(scil.Utils.fingArrayIndex(n.reactants,c)>=0){if(c.atommapid!=null){g=this.clone();j=this.m.clearAtomMap(c.atommapid)>0}else{c.selected=true}}else{if(scil.Utils.fingArrayIndex(n.products,c)>=0){if(c.atommapid!=null){g=this.clone();j=this.m.clearAtomMap(c.atommapid)>0}}}}if(j&&g!=null){this.pushundo(g)}this.refresh(j)}});scil.apply(JSDraw2.Editor,{});JSDraw2.Table=scil.extend(scil._base,{constructor:function(n,l,f){this.univid=++JSDraw2.Table.univid;this.toLocaleString="SDF";this.BORDERSTYLE="solid 1px #ccc";this.PADDING=0;this.PIVOTCOLWIDTH=120;if(JSDraw2.Table._id==null){JSDraw2.Table._id=0;JSDraw2.Table._deferedConnectors=[];JSDraw2.Table._allitems={}}++JSDraw2.Table._id;this.editor=null;this.currow=null;this.connectors=[];this.buttons={};this.properties={};this.options=l==null?{}:l;if(!(this.options.cols>0)){this.options.cols=5}if(this.options.sortable==null){this.options.sortable=true}if(this.options.columns!=null&&this.options.columns.length==null){this.options.columns=this.dict2array(this.options.columns)}if(this.options.roundmethod==null){this.options.roundmethod=JSDraw2.defaultoptions.roundmethod}if(this.options.decimal==null){this.options.decimal=JSDraw2.defaultoptions.decimal}if(this.options.normalizeinput==null){this.options.normalizeinput=JSDraw2.defaultoptions.normalizeinput}this.setColumns(this.options.columns);this.connectHandlers=[];this.header=null;this.resizing=null;this.tbody=null;this.div=null;if(f==null||typeof f=="string"){this.div=f==null?null:dojo.byId(f);if(this.div==null){this.div=scil.Utils.createElement(document.body,"div");if(f!=null&&f.length>0){this.div.id=f}}}else{this.div=f}if(this.div.id==null||this.div.id.length==0){this.div.id="_JsSDF_"+JSDraw2.Table._id}this.id=this.div.id;JSDraw2.Table._allitems[this.id]=this;for(var h=JSDraw2.Table._deferedConnectors.length-1;h>=0;--h){var d=JSDraw2.Table._deferedConnectors[h];if(d.table==this.id){JSDraw2.Table.connect(d.table,d.formula,d.connected,d.column,false);JSDraw2.Table._deferedConnectors.splice(h,1)}}if(this.options.selectbox){this.selectbox=new JSDraw2.Table.SelectBox(this)}var j=this;var g=function(c){if(typeof c=="object"){j.setJson(c,j.options!=null?j.options.highlight:null)}else{var q=c.indexOf("<jssdf")>=0?scil.Utils.parseXml(c):null;if(q!=null){j.setXml(q,j.options!=null?j.options.highlight:null,j.options!=null?j.options.filter:null)}j.setSdf(c,j.options!=null?j.options.highlight:null,j.options!=null?j.options.filter:null)}};if(n==null||n.length==0){if(this.options.data==null){this.createTable()}else{g(this.options.data)}}else{scil.Utils.download(n,g)}dojo.connect(document,"onscrollinside",function(c){j._doneEditor()})},dict2array:function(c){var f=[];for(var d in c){var g=c[d];if(g==null){continue}g.key=d;g.caption=g.label;if(g.type=="number"){g.type="float"}else{if(g.type=="jsdraw"){g.type="structure"}}f.push(g)}return f},setColumns2:function(c){this.clear(true);this.setColumns(c);this.createTable()},setColumns:function(f){this.columns=null;if(f==null){return}if(f.length==null){f=this.dict2array(f)}this.columns=[];for(var g=0;g<f.length;++g){var d=f[g];if(d.key==null){d.key=d.caption}var h=d.key;if(h=="[structure]"){d.type="structure"}else{if(h=="[formula]"||h=="[mf]"){d.type="mf"}else{if(h=="[molweight]"||h=="[mw]"){d.type="mw"}else{if(h=="[smiles]"){d.type="smiles"}}}}this.columns.push(d)}this._setKeywords()},_setKeywords:function(){var n=this.options.prefix;for(var g=0;g<this.columns.length;++g){var d=this.columns[g];var h=d.key;d.keywords=JSDraw2.Table.getKeywords(d.formula);d.index=g;for(var j in d.keywords){if(j.substr(0,1)=="@"){var l=j.lastIndexOf(".");var q=j.substr(1,l-1);var f=j.substr(l+1);JSDraw2.Table.connect((n==null?"":n)+q,f,this,h)}}}},showSaveSdf:function(){if(JSDraw2.Table.saveDlg==null){var d=scil.Utils.createElement(null,"div");var f=scil.Utils.createElement(d,"textarea",null,{width:"580px",height:"400px"});var c=scil.Utils.createElement(scil.Utils.createElement(d,"div",null,{textAlign:"center"}),"button","OK",{width:scil.Utils.buttonWidth+"px"});JSDraw2.Table.saveDlg=new JSDraw2.Dialog("<img src='"+scil.App.imgSmall("save.png")+"'>Save SDF File",d);dojo.connect(c,"onclick",function(g){JSDraw2.Table.saveDlg.hide();g.preventDefault()});JSDraw2.Table.saveDlg.txt=f}JSDraw2.Table.saveDlg.show();JSDraw2.Table.saveDlg.txt.value=this.getSdf()},showOpenSdf:function(){if(JSDraw2.Table.openDlg==null){var h=scil.Utils.createElement(null,"div");var j=scil.Utils.createElement(h,"textarea",null,{width:"580px",height:"400px"});var g=scil.Utils.createElement(h,"div",null,{textAlign:"center"});var c=scil.Utils.createElement(g,"button",JSDraw2.Language.res("Open"),{width:scil.Utils.buttonWidth+"px"});var f=scil.Utils.createElement(g,"button",JSDraw2.Language.res("Append"),{width:scil.Utils.buttonWidth+"px"});JSDraw2.Table.openDlg=new JSDraw2.Dialog("<img src='"+scil.App.imgSmall("open.png")+"'>"+JSDraw2.Language.res("Open File"),h);dojo.connect(c,"onclick",function(d){JSDraw2.Table.openDlg.jss.openSdf(true);JSDraw2.Table.openDlg.hide();d.preventDefault()});dojo.connect(f,"onclick",function(d){JSDraw2.Table.openDlg.jss.openSdf(false);JSDraw2.Table.openDlg.hide();d.preventDefault()});JSDraw2.Table.openDlg.txt=j}JSDraw2.Table.openDlg.jss=this;JSDraw2.Table.openDlg.show();JSDraw2.Table.openDlg.txt.value=""},newFile:function(c){if(this.options.grid){}else{if(this.getRowCount()>0){if(c!=false){if(!confirm("Delete all rows?")){return}}for(var d=this.getRowCount()-1;d>=0;--d){this.destroyRow(d)}}}if(this.selectbox!=null){this.selectbox.hide()}if(this.jointable!=null){this.jointable.newFile(false)}},openFile:function(){if(this.options.fileopen){this.options.fileopen(this)}else{if(scil.Utils.serviceAvailable()){JSDraw2.JSDrawIO.jssFileOpen(this)}else{this.showOpenSdf()}}},saveFile:function(){if(this.options.filesave){this.options.filesave(this)}else{if(scil.Utils.serviceAvailable()){JSDraw2.JSDrawIO.jssFileSave(this)}else{this.showSaveSdf()}}},clearRow:function(d){for(var c=1;c<this.getColCount();++c){if(!this.columns[c].viewonly){this.setCellValue(d,c,null)}}if(this.options.onclearrow!=null){this.options.onclearrow(d)}},clearAll:function(){for(var c=0;c<this.getRowCount();++c){this.clearRow(c)}if(this.options.onclearall!=null){this.options.onclearall()}},openSdf:function(c){var d=JSDraw2.Table.openDlg.txt.value;if(d.length>0){this.setSdf(d,null,null,c)}},getXml:function(g,u){if(this.columns==null||this.options.grid){return null}var y='<jssdf version="'+JSDraw2.kFileVersion+'"';for(var q in this.properties){y+=" "+q+'="'+scil.Utils.escXmlValue(this.properties[q])+'"'}y+=">";for(var h=0;h<this.getColCount();++h){var c=this.columns[h];var f="";if(c.type=="select"){if(c.items!=null&&c.items.length>0){var l=c.items[0];for(var n=1;n<c.items.length;++n){l+=","+c.items[n]}f=" items='"+scil.Utils.escXmlValue(l)+"'"}}y+="<col key='"+scil.Utils.escXmlValue(c.key)+"' w='"+c.width+"'"+f+(scil.Utils.isNullOrEmpty(c.caption)?"":" caption='"+scil.Utils.escXmlValue(c.caption)+"'")+(scil.Utils.isNullOrEmpty(c.formula)?"":" formula='"+scil.Utils.escXmlValue(c.formula)+"'")+(scil.Utils.isNullOrEmpty(c.html)?"":" html='"+scil.Utils.escXmlValue(c.html)+"'")+(scil.Utils.isNullOrEmpty(c.bgcolor)?"":" bgcolor='"+scil.Utils.escXmlValue(c.bgcolor)+"'")+(scil.Utils.isNullOrEmpty(c.bgheadercolor)?"":" bgheadercolor='"+scil.Utils.escXmlValue(c.bgheadercolor)+"'")+(scil.Utils.isNullOrEmpty(c.bordercolor)?"":" bordercolor='"+scil.Utils.escXmlValue(c.bordercolor)+"'")+(c.allowqccurve?" allowqccurve='1'":"")+" type='"+scil.Utils.escXmlValue(c.type)+"'"+(c.viewonly?" viewonly='1'":"")+"/>"}if(!g){for(var w=0;w<this.getRowCount();++w){y+="<r>";for(var h=0;h<this.getColCount();++h){var c=this.columns[h];if(c.type=="structure"||c.type=="compstructure"||c.type=="subform"||c.type=="file"||c.type=="filelink"||c.type=="filedblink"||c.type=="filepath"||c.type=="image"||c.type=="tabtext"||c.type=="richtext"||c.type=="plaintext"||c.type=="sketches"){var x=this.getCellValue(w,h,true);y+="<i n='"+c.key+"'>"+(x==null?"":x)+"</i>"}else{if(c.type!="id"){var x=this.getCellValue2(w,h,null,u);var t=x!=null&&!scil.Utils.isNullOrEmpty(x.number)?" num='"+scil.Utils.escXmlValue(x==null>null?"":x.number,true)+"'":"";var d=x!=null&&x.edit?" edit='1'":"";y+="<i n='"+c.key+"'"+t+d+">"+scil.Utils.escXmlValue(x==null>null?"":x.value,true)+"</i>"}}}y+="</r>"}}y+="</jssdf>";return y},getJson:function(j){var h=[];for(var f=0;f<this.getRowCount();++f){var g={};for(var d=0;d<this.getColCount();++d){var c=this.columns[d];if(c.type=="structure"||c.type=="compstructure"){g[c.key]=this.getCellValue(f,d,j)}else{if(c.type!="id"){g[c.key]=this.getCellValue(f,d,j)}}}h.push(g)}return{rows:h}},setJson:function(c,d){var g=null;if(typeof c=="object"){g=c}else{if(typeof c=="string"){g=scil.Utils.parseJson(c)}}if(g==null||g.rows==null||g.rows.length==0){return}if(g.columns!=null){this.clear(true);this.columns=g.columns}if(this.columns==null){this.createTable()}for(var f=0;f<g.rows.length;++f){this.insert(false,g.rows[f],false)}if(d!=null){this.highlight(d)}if(this.options.pivot){this.setSize(this.options.width)}JSDraw2.Table.setLastEditCell(null);if(this.options.onLoadTable!=null){this.options.onLoadTable()}},__readKeyMap:function(g){var f=JSDraw2.Table.readXmlColumns(g);if(f==null||this.columns==null){return null}var n={};for(var h=0;h<f.length;++h){var d=f[h];if(d.key!=null&&d.key!=""||d.caption==null||d.caption==""){continue}for(var l=0;l<this.columns.length;++l){if(this.columns[l].caption==d.caption){n[d.caption]=this.columns[l].key;break}}}return n},setXml:function(G,q,d,c,C){var j=null;if(typeof G=="object"){j=G}else{if(typeof G=="string"){j=scil.Utils.parseXml(G)}}if(j==null||j.childNodes==null||j.childNodes.length==0){return}this.properties={};var E=j.documentElement==null?j:j.documentElement;var y=E==null?null:E.getAttributeNames();if(y!=null){for(var t=0;t<y.length;++t){var u=y[t];if(u=="version"){continue}this.properties[u]=E.getAttribute(u)}}if(d==null){d=this.options.spreadsheet}var f=false;var g=scil.Utils.getChildXmlElements(j,"col");var l=g!=null&&g.length>0;if(C&&this.options.fixrows){}else{if(d&&l){this.clear(true);f=true}}var x=null;if(this.columns==null){if(this.options.fixcols!=true){if(!l){return}var h=JSDraw2.Table.readXmlColumns(j);this.setColumns(h);this.createTable()}else{this.createTable();x=this.__readKeyMap(j)}f=true}else{x=this.__readKeyMap(j)}if(this.options.fixrows){if(!f){this.clearAll()}var u=this.options.overwritekey;var B=scil.Utils.getChildXmlElements(j,"r");for(var t=0;t<B.length;++t){var D=JSDraw2.Table.readXmlRow(B[t],x);this.validateRow(D);var w=D[u];var F=this.getRowByColValue(u,w);if(F==null){continue}this.setRowValues(F,D)}}else{if(!f&&d){this.clear()}var z=null;var B=scil.Utils.getChildXmlElements(j,"r");for(var t=0;t<B.length;++t){z=this._loadXmlRow(B[t],z,x,c,c)}if(this.options.grid&&z!=null){var A=z.parentNode.childNodes.length-1;for(var t=0;t<this.options.cols-(A%this.options.cols);++t){scil.Utils.createElement(z.parentNode,"td")}}}if(q!=null){this.highlight(q)}if(this.options.pivot){this.setSize(this.options.width)}JSDraw2.Table.setLastEditCell(null);if(this.options.onLoadTable!=null){this.options.onLoadTable()}},firstStructureColIndex:function(){for(var c=0;c<this.getColCount();++c){if(this.columns[c].type=="structure"||this.columns[c].type=="compstructure"){return c}}return null},getCsv:function(n,f){if(this.columns==null||this.options.grid){return null}var d="";for(var g=0;g<this.getColCount();++g){var c=this.columns[g];var h=scil.Utils.isNullOrEmpty(c.caption)?c.key:c.caption;if(g==0){if(h=="ID"){h="id"}}else{d+=","}d+=scil.Utils.escCsvValue(h)}if(f!=null){for(var h in f){d+=","+scil.Utils.escCsvValue(h)}}d+="\n";for(var j=0;j<this.getRowCount();++j){if(n&&!this.isRowVisible(j)){continue}for(var g=0;g<this.getColCount();++g){var c=this.columns[g];var l=scil.Utils.trim(this.getCellValue(j,g,false,true,true));if(g>0){d+=","}d+=scil.Utils.escCsvValue(l)}for(var h in f){d+=","+scil.Utils.escCsvValue(f[h])}d+="\n"}return d},getSdf:function(u){if(this.columns==null||this.options.grid){return null}var j=this.firstStructureColIndex();var t="";for(var q=0;q<this.getRowCount();++q){if(u&&!this.isRowVisible(q)){continue}var l=j==null?null:this.getCell(q,j).jsd;var n=l==null?null:l.getMolfile();var d={};for(var h=0;h<this.getColCount();++h){var g=this.columns[h];if(g.type=="structure"||g.type=="compstructure"||g.type=="mf"||g.type=="mw"||g.type=="smiles"||g.type=="id"){continue}var f=scil.Utils.isNullOrEmpty(g.caption)?g.key:g.caption;if(!scil.Utils.isNullOrEmpty(f)){d[f]=scil.Utils.trim(this.getCellValue(q,h,false,true))}}t+=JSDraw2.Table.toSdf(n,d,q+1)}return t},setSdf:function(j,f,d,c){if(j==null){return}if(scil.Utils.startswith(j,"$RDFILE ")){this.setRdf(j,f,d,c);return}if(j.indexOf("M  END")<0){return}var h=j.split("$$$$");if(h==null||h.length==0){return}for(var g=0;g<h.length;++g){h[g]=h[g].replace(/^[\r\n]+/,"")}this._setSdf(h,f,d,c,"sdf")},setRdf:function(h,f,d,c){var g=JSDraw2.Table.splitRdf(h);if(g==null||g.length==0){return}this._setSdf(g,f,d,c,"rdf")},_setSdf:function(w,j,g,f,h){if(f){this.clear(true)}if(this.columns==null){var z=w[0];if(h=="sdf"){z=JSDraw2.Table.readSdfRecord(w[0],true)}this.columns=[];this.columns.push({key:"structure",caption:"Structure",type:"structure"});if(this.options!=null&&this.options.showformula){this.columns.push({key:"mf",caption:"M.F.",type:"mf"})}if(this.options!=null&&this.options.showmolweight){this.columns.push({key:"mw",caption:"M.W.",type:"mw"})}var y=z.props;for(var q in y){this.columns.push({key:q,caption:q})}this.createTable()}var A=null;for(var l=0;l<this.columns.length;++l){var d=this.columns[l];if(d.type=="structure"||d.type=="compstructure"){A=this.columns[l].key;break}}var u=null;for(var l=0;l<w.length;++l){var B;if(h=="sdf"){B=this._loadSdfRow(w[l],u,A,g)}else{B=this._loadRdfRow(w[l],u,A,g)}if(B!=null){u=B}}if(this.options.grid&&u!=null){var x=u.parentNode.childNodes.length-1;for(var l=0;l<this.options.cols-(x%this.options.cols);++l){scil.Utils.createElement(u.parentNode,"td")}}if(j!=null){this.highlight(j)}JSDraw2.Table.setLastEditCell(null);if(this.options.onLoadTable!=null){this.options.onLoadTable()}},createTable:function(){if(this.tbody!=null){return}if(this.columns==null){if(this.options.columns!=null&&this.options.columns.length==null){this.options.columns=this.dict2array(this.options.columns)}this.setColumns(this.options.columns)}if(this.columns==null){return}var j=scil.Utils.createTable(this.div,0,0);var l=this.createToolbar(j);var c=scil.Utils.createElement(scil.Utils.createElement(j,"tr"),"td",null,{padding:"0"});var d=this;if(!this.options.grid){var g={tableLayout:scil.Utils.isIE?null:"fixed",boxSizing:scil.Utils.isIE?null:"border-box",borderTop:this.BORDERSTYLE,borderLeft:this.BORDERSTYLE};var j=scil.Utils.createTable(c,0,0,g);this.tbody=this.createGrid(c);this.header=this.createHeaders(j);dojo.connect(this.tbody,"onclick",function(n){d.clickcell(n)})}else{this.tbody=this.createGrid(c);dojo.connect(this.tbody,"onclick",function(n){d.clickcell(n)})}if(this.options.height>0){c.style.background="#eee";c.style.borderRight="solid 1px #ccc";c.style.borderBottom="solid 1px #ccc";var h=this.tbody.parentNode;h.className="jsdrawtable";h.style.overflowY="scroll";h.style.display="block";h.style.maxHeight=this.options.height+"px";JSDraw2.Table.addCssStyles();var f=scil.connect(h,"onscroll",function(){d.onscroll()})}if(this.options.width>0&&!this.options.pivot){this.setSize(this.options.width)}if(this.options.onCreateTable!=null){this.options.onCreateTable(this)}},onscroll:function(){this._doneEditor();if(this.selectbox!=null){this.selectbox.hide()}},clickcell:function(c){var d=c.srcElement||c.target;var f=scil.Utils.getParent(d,"TD");if(f.parentNode.parentNode!=this.tbody){return}if(this.options.onClickCell!=null){this.options.onClickCell(f)}},pivot:function(d){if(d==true&&this.options.pivot==true||d==false&&(this.options.pivot==false||this.options.pivot==null)){return}var g=this.getXml();var c=this.currow;this.destroy();this.options.pivot=this.options.pivot==null?true:!this.options.pivot;this.setXml(g);this.setCurRow(c)},createHeaders:function(g){this.header=scil.Utils.createElement(g,"tr",null,{height:"30px",background:JSDraw2.Skin.jssdf.headercolor});if((this.options.rowid!=false||this.options.pivot)&&this.columns[0].type!="id"){this.columns.splice(0,0,{type:"id",width:40,caption:"ID"})}if(this.options.pivot){this.createTH(0);if(this.options.rowid==false){this.header.style.display="none"}}for(var d=this.options.pivot?1:0;d<this.columns.length;++d){var c=this.columns[d];if(!(c.width>10)){c.width=c.type=="structure"||c.type=="compstructure"?(this.options.molwidth>0?this.options.molwidth:120):80}this._makeHeader(d)}if(this.options.pivot){this.setColWidth(0,this.PIVOTCOLWIDTH)}var f=this;if(scil.Utils.isTouch){this.connectHandlers.push(dojo.connect(document.body,"ontouchmove",function(h){if(h.touches.length==1&&f.onResizing(h.touches[0])){h.preventDefault();return false}}));this.connectHandlers.push(dojo.connect(document.body,"ontouchend",function(h){f.endResizing(h)}))}else{this.connectHandlers.push(dojo.connect(document.body,"onmousemove",function(h){f.onResizing(h)}));this.connectHandlers.push(dojo.connect(document.body,"onmouseup",function(h){f.endResizing(h)}))}return this.header},getColByHeader:function(c,d){var g=c.target||c.srcElement;if(g.tagName=="DIV"){g=g.parentNode}for(var f=0;f<this.header.childNodes.length/2;++f){if(this.header.childNodes[f*2+(d?1:0)]==g){return f}}return null},startResizing:function(d){var c=this.getColByHeader(d,true);if(c==null){return}var f=this.header.childNodes[c*2].firstChild;this.resizing={start:d.clientX,col:c,th:f,thwid:scil.Utils.parsePixel(f.style.width),delta:0};if(!scil.Utils.isIE){d.preventDefault()}},onResizing:function(f){if(f.button!=(scil.Utils.isIE8Lower?1:0)&&this.resizing!=null){this.resizing=null}if(this.resizing==null){return false}var c=f.clientX-this.resizing.start;if(c==0){return true}this.resizing.start=f.clientX;this.resizing.delta+=c;this.resizing.th.style.width=(this.resizing.thwid+this.resizing.delta)+"px";if(this.options.width>0){this.options.width+=c}if(!scil.Utils.isIE){f.preventDefault()}return true},endResizing:function(c){if(this.resizing==null){return}if(c.ctrlKey||c.metaKey){this.setSize(this.tbody.offsetWidth+this.resizing.delta)}else{if(this.options.pivot){this.setColWidth(this.resizing.col,this.resizing.thwid+this.resizing.delta+3)}else{this.setColWidth(this.resizing.col,this.columns[this.resizing.col].width+this.resizing.delta)}}this.resizing=null;if(this.selectbox!=null){this.selectbox.redraw()}},createGrid:function(f){this.tbody=scil.Utils.createTable(f,0,0,{tableLayout:scil.Utils.isIE?null:"fixed",boxSizing:scil.Utils.isIE?null:"border-box",borderLeft:"1px solid #cccccc",backgroundColor:"white"});var d=this;if(!this.options.viewonly){if(scil.Utils.isTouch){var c=function(g){if(!scil.Utils.isTouchDblClick(g)){return}d.dblclick(g.touches[0]);g.preventDefault();return false};this.connectHandlers.push(dojo.connect(this.div,"ontouchstart",c))}else{this.connectHandlers.push(dojo.connect(this.tbody,"ondblclick",function(g){d.dblclick(g);g.preventDefault()}))}}if(!this.options.grid){this.connectHandlers.push(dojo.connect(this.tbody,"onclick",function(g){d.click(g)}))}if(this.selectbox!=null){scil.Utils.unselectable(this.tbody.parentNode)}return this.tbody},createToolbar:function(c){var f=scil.Utils.createElement(null,"tr",null,{backgroundColor:JSDraw2.Skin.jssdf.bgcolor,background:"url("+JSDraw2.Skin.jssdf.bkimg+") repeat-x "+JSDraw2.Skin.jssdf.bkcolor});var d=scil.Utils.createElement(f,"td",null,{border:this.BORDERSTYLE,borderBottom:"none"});this.createButtons(d);if(d.childNodes.length==0){return null}c.appendChild(f);return f},createBtn:function(j,d){var f=scil.Lang==null?JSDraw2.Language:scil.Lang;var c=null;var h=scil.Utils.createElement(j,"td");if(typeof(d)=="string"&&d=="|"){scil.Utils.createElement(h,"img",null,{padding:"2px"},{src:scil.Utils.imgSrc("img/sep.gif")})}else{if(d.type=="checkbox"){c=scil.Utils.createElement(h,"checkbox",f.res(d.label),null,null,d.onclick)}else{var g=this;var c=scil.Utils.createElement(h,"img",null,{padding:"2px",width:"20px",height:"20px"},{src:d.src||d.iconurl,title:f.res(d.title||d.tooltips)});dojo.connect(c,"onclick",function(l){d.onclick(l,g);l.preventDefault()});this.connectHandlers.push(dojo.connect(c,"onmouseover",function(){this.style.backgroundColor=JSDraw2.Skin.jssdf.hovercolor}));this.connectHandlers.push(dojo.connect(c,"onmouseout",function(){this.style.backgroundColor=""}))}}if(!scil.Utils.isNullOrEmpty(d.buttonkey)){this.buttons[d.buttonkey]=c}return c},createButtons:function(l){if(this.options.toolbar==false){return}var q=scil.Utils.createTable(l,0);var u=scil.Utils.createElement(q,"tr");var n=q.parentNode;var f=0;var j=this;if(this.options.toolbar==true||this.options.toolbar==null){d=this.addDefaultButtons(u);++f}else{if(typeof(this.options.toolbar)=="object"){var t=this.options.toolbar;if(t==null||t.length==0){return null}var d=null;for(var g=0;g<t.length;++g){var c=t[g];var h=d;d=null;if(typeof c=="string"){switch(c){case"new":if(!this.options.viewonly&&!this.options.grid){d=this.createBtn(u,{title:"New File",src:scil.App.imgSmall("new.png"),onclick:function(w){j.newFile();j.onClear("new");w.preventDefault()}})}break;case"clear":if(!this.options.viewonly&&!this.options.grid){d=this.createBtn(u,{title:"Clear",src:scil.App.imgSmall("new.png"),onclick:function(w){j.clearAll();j.onClear("clear");w.preventDefault()}})}break;case"open":if(!this.options.viewonly&&!this.options.grid){d=this.createBtn(u,{title:"Open File",src:scil.App.imgSmall("open.png"),onclick:function(w){j.openFile();w.preventDefault()}})}break;case"save":d=this.createBtn(u,{title:"Save File",src:scil.App.imgSmall("save.png"),onclick:function(w){j.saveFile();w.preventDefault()}});break;case"del":if(!this.options.viewonly&&!this.options.grid){d=this.createBtn(u,{title:"Delete Selected Row(s)",src:scil.App.imgSmall("del.png"),onclick:function(w){j.delRow();w.preventDefault()}})}break;case"insertbefore":if(!this.options.viewonly&&!this.options.grid){d=this.createBtn(u,{title:"Insert Before",src:scil.App.imgSmall("insertbefore.png"),onclick:function(w){j.insert(true,null,null,true);w.preventDefault()}})}break;case"insertafter":if(!this.options.viewonly&&!this.options.grid){d=this.createBtn(u,{title:"Insert After",src:scil.App.imgSmall("insertafter.png"),onclick:function(w){j.insert(false,null,null,true);w.preventDefault()}})}break;case"search":d=this.createBtn(u,{title:"Structure Search",src:scil.App.imgSmall("search.png"),onclick:function(w){j.showSearch();w.preventDefault()}});break;case"searchreset":d=this.createBtn(u,{title:"Reset Search",src:scil.App.imgSmall("resetsearch.png"),onclick:function(w){j.resetSearch();w.preventDefault()}});break;case"chart":d=this.createBtn(u,{title:"Draw Chart",src:scil.App.imgSmall("chart.png"),onclick:function(w){j.showChart();w.preventDefault()}});break;case"hidecols":d=this.createBtn(u,{title:"Show/Hide Columns",src:scil.App.imgSmall("columns.png"),onclick:function(w){j.showColumns();w.preventDefault()}});break;case"definecolumns":if(!this.options.viewonly&&!this.options.grid){d=this.createBtn(u,{title:"Define Columns",src:scil.App.imgSmall("properties.png"),onclick:function(){j.defineCols()}})}break;case"del":d=this.createBtn(u,{title:"Delete Selected Area",src:scil.App.imgSmall("delselected.png"),onclick:function(w){if(j.selectbox!=null){j.selectbox.del()}w.preventDefault()}});break;case"copy":d=this.createBtn(u,{title:"Copy Selected Area",src:scil.App.imgSmall("copy.png"),onclick:function(w){if(j.selectbox!=null){j.selectbox.copy()}w.preventDefault()}});break;case"cut":d=this.createBtn(u,{title:"Cut Selected Area",src:scil.App.imgSmall("cut.png"),onclick:function(w){if(j.selectbox!=null){j.selectbox.cut()}w.preventDefault()}});break;case"paste":d=this.createBtn(u,{title:"Paste Selected Area",src:scil.App.imgSmall("paste.png"),onclick:function(w){if(j.selectbox!=null){scil.Utils.alert("Sorry, please use keyboard Ctrl + V to paste data.")}w.preventDefault()}});break;case"weighstation":d=this.createBtn(u,{title:"Weigh Station",src:scil.App.imgSmall("weighstation.png"),onclick:function(w){scil.MobileData.selectWeighstation();w.preventDefault()}});break;case"all":d=this.addDefaultButtons(u);break;case"|":if(h!=null){this.createBtn(u,"|")}break}}else{d=this.createBtn(u,c)}if(d!=null){++f}}}}if(f==0){n.parentNode.removeChild(n)}},addDefaultButtons:function(f){var c=null;var d=this;if(!this.options.viewonly){c=this.createBtn(f,{title:"New File",src:scil.App.imgSmall("new.png"),onclick:function(g){d.newFile();g.preventDefault()}});c=this.createBtn(f,{title:"Open File",src:scil.App.imgSmall("open.png"),onclick:function(){d.openFile()}})}c=this.createBtn(f,{title:"Save File",src:scil.App.imgSmall("save.png"),onclick:function(){d.saveFile()}});if(!this.options.viewonly){if(!this.options.grid){this.createBtn(f,"|");c=this.createBtn(f,{title:"Delete Selected Row(s)",src:scil.App.imgSmall("del.png"),onclick:function(){d.delRow()}});c=this.createBtn(f,{title:"Insert Before",src:scil.App.imgSmall("insertbefore.png"),onclick:function(){d.insert(true,null,null,true)}});c=this.createBtn(f,{title:"Insert After",src:scil.App.imgSmall("insertafter.png"),onclick:function(){d.insert(false,null,null,true)}});if(this.options.spreadsheet){this.createBtn(f,"|");c=this.createBtn(f,{title:"Define Columns",src:scil.App.imgSmall("properties.png"),onclick:function(){d.defineCols()}});c=this.createBtn(f,{title:"Pivot",src:scil.App.imgSmall("pivot.png"),onclick:function(){d.pivot()}})}if(this.options.selectbox){this.createBtn(f,"|");c=this.createBtn(f,{title:"Delete Selected Area",src:scil.App.imgSmall("delselected.png"),onclick:function(g){if(d.selectbox!=null){d.selectbox.del()}g.preventDefault()}});c=this.createBtn(f,{title:"Copy Selected Area",src:scil.App.imgSmall("copy.png"),onclick:function(g){if(d.selectbox!=null){d.selectbox.copy()}g.preventDefault()}});c=this.createBtn(f,{title:"Cut Selected Area",src:scil.App.imgSmall("cut.png"),onclick:function(g){if(d.selectbox!=null){d.selectbox.cut()}g.preventDefault()}});c=this.createBtn(f,{title:"Paste Selected Area",src:scil.App.imgSmall("paste.png"),onclick:function(g){if(d.selectbox!=null){scil.Utils.alert("Sorry, please use keyboard Ctrl + V to paste data.")}g.preventDefault()}})}this.createBtn(f,"|");c=this.createBtn(f,{title:"Weigh Station",src:scil.App.imgSmall("weighstation.png"),onclick:function(){scil.MobileData.selectWeighstation()}})}}if(!this.options.grid){this.createBtn(f,"|");c=this.createBtn(f,{title:"Draw Chart",src:scil.App.imgSmall("chart.png"),onclick:function(g){d.showChart();g.preventDefault()}})}if(this.options.searchable){this.createBtn(f,"|");c=this.createBtn(f,{title:"Structure Search",src:scil.App.imgSmall("search.png"),onclick:function(){d.showSearch()}});c=this.createBtn(f,{title:"Reset Search",src:scil.App.imgSmall("refresh.png"),onclick:function(g){d.resetSearch();g.preventDefault()}})}if(this.options.hidecols){this.createBtn(f,"|");c=this.createBtn(f,{title:"Show/Hide Columns",src:scil.App.imgSmall("columns.png"),onclick:function(g){d.showColumns();g.preventDefault()}})}return c},showChart:function(){if(JSDraw2.Table.chartDlg==null){var h=scil.Utils.createElement(null,"div",null,{width:"600px"});var g=scil.Utils.createElement(h,"div");scil.Utils.createElement(h,"span","Chart Type:");var y=scil.Utils.createElement(h,"select",null,{marginRight:"10px"});scil.Utils.listOptions(y,["Lines","StackedAreas","Columns","Pie"]);var q=scil.Utils.createElement(h,"checkbox","Show Markers");var c=scil.Utils.createElement(h,"div");scil.Utils.createElement(h,"b","Series: ");scil.Utils.createElement(h,"span"," 1).");var u=scil.Utils.createElement(h,"select",null,{width:"120px",marginRight:"10px"});scil.Utils.createElement(h,"span"," 2).");var w=scil.Utils.createElement(h,"select",null,{width:"120px",marginRight:"10px"});scil.Utils.createElement(h,"span"," 3).");var x=scil.Utils.createElement(h,"select",null,{width:"120px"});var d=scil.Utils.createElement(h,"div",null,{height:"300px"});JSDraw2.Table.chartDlg=new JSDraw2.Dialog("<img src='"+scil.App.imgSmall("chart.png")+"'>JSDraw2.Table Chart",h);JSDraw2.Table.chartDlg.types=y;JSDraw2.Table.chartDlg.markers=q;JSDraw2.Table.chartDlg.chart=d;JSDraw2.Table.chartDlg.sels=[u,w,x];var t=this;var j=function(){t.drawChart()};for(var l=0;l<JSDraw2.Table.chartDlg.sels.length;++l){dojo.connect(JSDraw2.Table.chartDlg.sels[l],"onchange",j)}dojo.connect(y,"onchange",j);dojo.connect(q,"onchange",j)}if(JSDraw2.Table.chartDlg.c!=null){JSDraw2.Table.chartDlg.c.destroy();JSDraw2.Table.chartDlg.c=null}JSDraw2.Table.chartDlg.show(null,null,false);var n={"":""};for(var l=0;l<this.columns.length;++l){var f=this.columns[l];if(!this.isColStructure(f)){n[l+""]=f.caption==null?f.key:f.caption}}for(var l=0;l<JSDraw2.Table.chartDlg.sels.length;++l){scil.Utils.listOptions(JSDraw2.Table.chartDlg.sels[l],n,"",true)}},drawChart:function(){if(JSDraw2.Table.chartDlg.c!=null){JSDraw2.Table.chartDlg.c.destroy();JSDraw2.Table.chartDlg.c=null}var j=null;var n=[];for(var f=0;f<JSDraw2.Table.chartDlg.sels.length;++f){var l=JSDraw2.Table.chartDlg.sels[f].value;if(l==""){continue}var g=parseInt(l);var d=this.getChartData(g);var c=this.columns[g];n.push({label:c.caption==null?c.key:c.caption,data:d});for(var h=0;h<d.length;++h){if(d[h]!=null&&(j==null||d[h]<j)){j=d[h]}}}JSDraw2.Table.chartDlg.c=new dojox.charting.Chart2D(JSDraw2.Table.chartDlg.chart);if(JSDraw2.Table.chartDlg.types.value=="Pie"){JSDraw2.Table.chartDlg.c.addPlot("default",{type:"Pie",fontColor:"white",labelOffset:40,radius:100})}else{JSDraw2.Table.chartDlg.c.addPlot("default",{type:JSDraw2.Table.chartDlg.types.value,markers:JSDraw2.Table.chartDlg.markers.checked,shadows:{dx:2,dy:2,dw:2},tension:3,gap:3}).addAxis("x",{fixLower:"major",fixUpper:"major",min:JSDraw2.Table.chartDlg.types.value=="Columns"?0:1}).addAxis("y",{vertical:true,fixLower:"major",fixUpper:"major",min:j}).setTheme(dojox.charting.themes.Wetland)}for(var f=0;f<n.length;++f){var l=n[f];JSDraw2.Table.chartDlg.c.addSeries(l.label,l.data)}JSDraw2.Table.chartDlg.c.render()},getChartData:function(d){var f=[];for(var c=0;c<this.getRowCount();++c){var g=this._getTdNum(this.getCell(c,d));f.push(g)}return f},selTypes:function(d,g){var f=scil.Utils.createElement(d,"select");var c=JSDraw2.Table.kAllColumns;if(typeof(JSDrawServices)!="undefined"&&JSDrawServices.id2s!=null){c.compid="Compoud ID";c.compstructure="Structure of Compoud ID"}scil.Utils.listOptions(f,c,g);return f},selViewonly:function(c,f){var d=scil.Utils.createElement(c,"select");scil.Utils.listOptions(d,["","Yes"],f?"Yes":null);return d},defineCols:function(l){if(this.colsDlg==null){var g=scil.Utils.createElement(null,"div");var n=scil.Utils.createTable(g,0,null,null);var q=scil.Utils.createElement(n,"tr",null,{background:scil.Utils.imgSrc("img/header-bg.gif",true)+" repeat-x",border:"solid 1px gray"});scil.Utils.createElement(q,"th","Column Name");scil.Utils.createElement(q,"th","Key");scil.Utils.createElement(q,"th","Type");scil.Utils.createElement(q,"th","View Only");scil.Utils.createElement(q,"th","Formula");scil.Utils.createElement(q,"th","&nbsp;");scil.Utils.createElement(q,"th","&nbsp;");var j=this;var f=scil.Utils.createElement(g,"div",null,{textAlign:"center",marginTop:"10px"});scil.Utils.createButton(f,{src:scil.App.imgSmall("add.png"),label:"Add Column",onclick:function(d){j.colAdd();d.preventDefault()}});scil.Utils.createButton(f,{src:scil.App.imgSmall("refresh.png"),label:"Reset Columns",onclick:function(d){j.resetColumns();j.colsDlg.hide();d.preventDefault()}});scil.Utils.createButton(f,{src:scil.App.imgSmall("submit.png"),label:"Done",onclick:function(d){j.colsDlg.hide();d.preventDefault()}});this.colsDlg=new JSDraw2.Dialog("Column Manager",g);this.colsDlg.tbody=n}this.colsDlg.options.onhide=l;var n=this.colsDlg.tbody;for(var h=n.childNodes.length-1;h>0;--h){n.removeChild(n.childNodes[h])}for(var h=0;h<this.columns.length;++h){var c=this.columns[h];if(c.type=="id"){continue}this.colAddRow(n,c,h)}this.colsDlg.show()},moveRow:function(c,n){if(c==n||!(c>=0&&c<this.getRowCount()&&n>=0&&n<this.getRowCount())){return}if(!this.options.pivot){var t=this.tbody.childNodes[c];var u=this.tbody.childNodes[n];var f=t.nextSibling;this.tbody.insertBefore(t,u);this.tbody.insertBefore(u,f==u?t:f)}else{var g=this.header.childNodes[n*2];if(n>c){g=g.nextSibling.nextSibling}var j=this.header.childNodes[c*2];var l=this.header.childNodes[c*2+1];this.header.insertBefore(j,g);this.header.insertBefore(l,g);for(var d=0;d<this.tbody.childNodes.length;++d){var q=this.tbody.childNodes[d];g=q.childNodes[n];if(n>c){g=g.nextSibling}var h=q.childNodes[c];q.insertBefore(h,g)}}},moveColumn:function(d,q){if(d==q||!(d>=0&&d<this.columns.length&&q>=0&&q<this.columns.length)){return}if(this.options.pivot){if(d==0||q==0){return}var u=this.tbody.childNodes[d-1];var w=this.tbody.childNodes[q-1];var g=u.nextSibling;this.tbody.insertBefore(u,w);this.tbody.insertBefore(w,g==w?u:g)}else{var h=this.header.childNodes[q*2];if(q>d){h=h.nextSibling.nextSibling}var l=this.header.childNodes[d*2];var n=this.header.childNodes[d*2+1];this.header.insertBefore(l,h);this.header.insertBefore(n,h);for(var f=0;f<this.tbody.childNodes.length;++f){var t=this.tbody.childNodes[f];h=t.childNodes[q];if(q>d){h=h.nextSibling}var j=t.childNodes[d];t.insertBefore(j,h)}}var c=this.columns[d];this.columns.splice(d,1);this.columns.splice(q,0,c);this.onColChange()},delColumn:function(d){if(!(d>=0&&d<this.columns.length)){return}if(this.options.pivot){if(d==0){return}this.tbody.removeChild(this.tbody.childNodes[d-1])}else{var g=this.getCell(-1,d);g.parentNode.removeChild(g.nextSibling);g.parentNode.removeChild(g);for(var c=0;c<this.getRowCount();++c){var f=this.getCell(c,d);f.parentNode.removeChild(f)}}this.columns.splice(d,1);this.onColChange()},appendColumn:function(c){if(c.key==null||c.key==""){c.key=c.caption}this.columns.push(c);this._makeHeader(this.columns.length-1);this.onColChange()},insertColumn:function(c,d){this.appendColumn(c);if(d>=0&&d<this.columns.length-1){this.moveColumn(this.columns.length-1,d)}},setColumnCaption:function(g,c,h){var d=this.columns[g];if(d==null&&typeof(g)=="string"){var f=this.getColIndex(g);if(f!=null){g=f;d=this.columns[g]}}if(d==null||d.caption==c){return false}if(c!=null){d.caption=c}if(h!=null){d.key=h}var j=this.header.childNodes[g*2];this._setHeaderCaption(j,d);this.onColChange();return true},setColumnFormula:function(g,d){var c=this.columns[g];d=scil.Utils.trim(d);if(d==""){d=null}if(c.formula==d){return false}c.formula=d;this._setKeywords();if(d==null){for(var f=0;f<this.getRowCount();++f){this.setCellValue(f,g,null)}}else{for(var f=0;f<this.getRowCount();++f){this._updateCell(f,g)}}this.onColChange();return true},setColumnKey:function(d,f){var c=this.columns[d];if(c.key==f){return false}c.key=f;this.onColChange();return true},setColumnType:function(h,t){var f=this.columns[h];if(f.type==t){return false}var n=f.type;var q=n=="structure"||t=="structure"||n=="compstructure"||t=="compstructure"||n=="file"||t=="file"||n=="filelink"||t=="filelink"||n=="subform"||t=="subform"||n=="filedblink"||t=="filedblink"||n=="filepath"||t=="filepath"||n=="image"||t=="image"||n=="tabtext"||t=="tabtext"||n=="richtext"||t=="richtext"||t=="plaintext"||t=="sketches";if(q){if(!confirm("Please confirm to change this column "+(n=="structure"?"from":"into")+" structure. All data of this column will be lost.")){return false}}if(q){f.type=t;for(var g=0;g<this.getRowCount();++g){this._makeCell(g,h)}}else{if(n=="checkbox"||t=="checkbox"||n=="radio"||t=="radio"){var u=[];for(var g=0;g<this.getRowCount();++g){u.push(this.getCellValue(g,h))}f.type=t;for(var g=0;g<this.getRowCount();++g){this._makeCell(g,h,u[g])}}else{f.type=t}}if(t=="compid"||t=="compstructure"){var j=t=="compid"?h:null;var l=t=="compid"?null:h;for(var g=0;g<this.columns.length;++g){var d=this.columns[g];if(t=="compid"&&d.type=="compstructure"){this.setCompStructure(0,j,g,true);break}else{if(t=="compstructure"&&d.type=="compid"){this.setCompStructure(0,g,l,true);break}}}}this.onColChange();return true},setColumnViewonly:function(d,f){var c=this.columns[d];if(scil.Utils.isTrue(c.viewonly)==scil.Utils.isTrue(f)){return false}c.viewonly=scil.Utils.isTrue(f);this.onColChange();return true},colAddRow:function(n,d,f){var j=this;var t=scil.Utils.createElement(n,"tr");if(f!=null){t.setAttribute("iCol",f)}if(n.childNodes.length%2==1){t.style.backgroundColor="#f0f0f0"}var q=scil.Utils.createElement(t,"td");var h=scil.Utils.createElement(q,"input",null,{width:200});h.value=d.caption==null?"":d.caption;if(d.collocked){h.disabled=true}else{dojo.connect(h,"onchange",function(){j.colChangeTitle(this)})}q=scil.Utils.createElement(t,"td");h=scil.Utils.createElement(q,"input",null,{width:100});h.value=d.key==null?"":d.key;if(d.collocked){h.disabled=true}else{dojo.connect(h,"onchange",function(){j.colChangeKey(this)})}q=scil.Utils.createElement(t,"td");var l=this.selTypes(q,d.type);if(d.collocked){l.disabled=true}else{dojo.connect(l,"onchange",function(){j.colChangeType(this)})}q=scil.Utils.createElement(t,"td");var l=this.selViewonly(q,d.viewonly);if(d.collocked){l.disabled=true}else{dojo.connect(l,"onchange",function(){j.colChangeViewonly(this)})}q=scil.Utils.createElement(t,"td");h=scil.Utils.createElement(q,"input",null,{width:200});h.value=d.formula==null?"":d.formula;if(d.collocked){h.disabled=true}else{dojo.connect(h,"onchange",function(){j.colChangeFormula(this)})}q=scil.Utils.createElement(t,"td",null,{whiteSpace:this.options.whitespace==null?"nowrap":""});var g=scil.Utils.createElement(q,"img",null,{cursor:"pointer"},{src:scil.App.imgSmall("up.png")});dojo.connect(g,"onclick",function(u){j.colMove(this,-1);u.preventDefault()});g=scil.Utils.createElement(q,"img",null,{cursor:"pointer"},{src:scil.App.imgSmall("down.png")});dojo.connect(g,"onclick",function(u){j.colMove(this,+1);u.preventDefault()});if(!d.collocked){g=scil.Utils.createElement(q,"img",null,{cursor:"pointer"},{src:scil.App.imgSmall("del.png")});dojo.connect(g,"onclick",function(u){j.colDel(this);u.preventDefault()})}q=scil.Utils.createElement(t,"td",null,{width:"60px"});if(!d.collocked){var c=scil.Utils.createElement(q,"button","Items",{width:"60px",display:d.type=="select"?"":"none"});dojo.connect(c,"onclick",function(u){j.colSetItems(this);u.preventDefault()})}},colChangeTitle:function(d){var h=scil.Utils.getParent(d,"TD");var j=scil.Utils.getParent(h,"TR");var c=this.colIndex(j);var g=d.value;var f=h.nextSibling.firstChild.value;if(f==null||f==""){f=g.replace(/[ ]/g,"_").toLowerCase();h.nextSibling.firstChild.value=f}this.setColumnCaption(c,g,f)},colChangeKey:function(d){var f=scil.Utils.getParent(d,"TR");var c=this.colIndex(f);this.setColumnCaption(c,null,d.value)},colChangeType:function(d){var f=scil.Utils.getParent(d,"TR");var c=this.colIndex(f);this.setColumnType(c,d.value);f.lastChild.firstChild.style.display=d.value=="select"?"":"none"},colChangeViewonly:function(d){var f=scil.Utils.getParent(d,"TR");var c=this.colIndex(f);this.setColumnViewonly(c,d.value=="Yes");f.lastChild.firstChild.style.display=d.value=="select"?"":"none"},colChangeFormula:function(d){var f=scil.Utils.getParent(d,"TR");var c=this.colIndex(f);this.setColumnFormula(c,d.value)},colAdd:function(){var c={caption:"[No Title]",type:null,width:80};this.colAddRow(this.colsDlg.tbody,c);this.appendColumn(c)},colDel:function(d){var f=scil.Utils.getParent(d,"TR");var c=this.colIndex(f);if(c==null){return}f.parentNode.removeChild(f);this.delColumn(c)},colSetItems:function(f){var l=scil.Utils.getParent(f,"TR");var d=this.colIndex(l);if(d==null){return}var j="";var g=this.columns[d].items;if(g!=null&&g.length>0){j=g[0];for(var c=1;c<g.length;++c){j+=","+g[c]}}var h=this;scil.Utils.prompt("Specify Items","Please list items for this column (e.g. ,A,B,C):",j,"OK",function(n){h.setColItems(d,scil.Utils.splitStr(n,","))},null,5000)},setColItems:function(d,f){if(f!=null&&typeof(f)=="object"&&f.length!=null){this.columns[d].items=f;for(var c=0;c<this.getRowCount();++c){this._makeCell(c,d,this.getCellValue(c,d))}}},colIndex:function(f){var d=this.colsDlg.tbody;for(var c=1;c<d.childNodes.length;++c){if(d.childNodes[c]==f){return c-(this.options.rowid==false?1:0)}}return null},colMove:function(f,c){var j=scil.Utils.getParent(f,"TR");var g=c>0?j.nextSibling:j.previousSibling;if(g==null||g==g.parentNode.childNodes[0]){return}var d=this.colIndex(j);if(d==null){return}var h=this.colsDlg.tbody;if(c>0){h.removeChild(g);h.insertBefore(g,j)}else{h.removeChild(j);h.insertBefore(j,g)}this.moveColumn(d,d+(c>0?1:-1))},getColIndex:function(c){for(var d=0;d<this.columns.length;++d){if(this.columns[d].key==c){return d}}return null},setCellValueWithEvent:function(h,g,j){var d=this.setCellValue(h,g,j);if(!d){return false}if(typeof g=="string"){g=this.getColIndex(g)}var c=this.columns[g];if(c.onchanged!=null){c.onchanged(h,g,this)}if(c.type=="select"&&!scil.Utils.isNullOrEmpty(c.pairto)){this.pairTo(h,g)}this.onCellChanged(h,g);return true},onColChange:function(){if(this.options.onColChange!=null){this.options.onColChange(this)}if(this.options.onchange!=null){this.options.onchange(this,{a:"colchanged"})}},onCellChanged:function(d,c){if(this.options.onCellChanged!=null){this.options.onCellChanged(d,c,this)}if(this.options.onchange!=null){this.options.onchange(this,{a:"cellchanged",row:d,col:c})}},onAddRow:function(c){if(this.options.onAddRow!=null){this.options.onAddRow(this,c)}if(this.options.onchange!=null){this.options.onchange(this,{a:"addrow",row:c})}},onDelRow:function(c){if(this.options.onDelRow!=null){this.options.onDelRow(this,c)}if(this.options.onchange!=null){this.options.onchange(this,{a:"delrow",row:c})}},onClear:function(c){if(this.options.onclear!=null){this.options.onclear(this,c)}if(this.options.onchange!=null){this.options.onchange(this,{a:c})}},setCellValue:function(f,d,t,h){if(typeof d=="string"){d=this.getColIndex(d)}var c=this.columns[d];if(c==null){return false}var g=JSDraw2.Table.isNumerColumn(c.type);var l=this.getCell(f,d);switch(c.type){case"structure":case"compstructure":if(l.jsd!=null){l.jsd.setXml(t,false)}break;case"subform":case"file":case"filelink":case"filedblink":case"filepath":case"image":case"tabtext":case"richtext":case"plaintext":case"sketches":if(l.host!=null){l.host.setXml(t)}break;case"checkbox":case"radio":l.firstChild.firstChild.checked=scil.Utils.isTrue(t);break;case"html":this._setHtmlCell(c,l,t);break;case"rte":l.firstChild.innerHTML=scil.Utils.isNullOrEmpty(t)?"&nbsp;":t;break;default:if(c.type=="date"){if(typeof(t)=="number"){t=scil.Utils.dateStr(t,true,c.dateformat)}else{if(typeof(t)=="string"&&/^[0-9]+$/.test(t)){t=scil.Utils.dateStr(parseInt(t),true,c.dateformat)}}}if(c.type=="temperature"&&t=="rt"){t=t}else{if(g){var j=l.firstChild.innerHTML;var n=JSDraw2.Table.isNA(j)?"n/a":JSDraw2.Table.parseValue(j);var q=JSDraw2.Table.isNA(t)?"n/a":JSDraw2.Table.parseValue(t);if(n==q){t=j}if(q==h){h=null}}}l.firstChild.innerHTML=scil.Utils.isNullOrEmpty(t)?"&nbsp;":t;break}JSDraw2.Table._setCellNumber(l,h);if(g){JSDraw2.ColorCoding.show(l,t,c)}return true},_setHtmlCell:function(c,d,h){var g=false;var f=(c.html||c.template);if(f!=null&&h!=null){g=true;if(c.htmlpattern!=null&&c.htmlpattern!=""){if(!new RegExp(c.htmlpattern).test(h)){g=false}}}if(g){d.firstChild.innerHTML=f.replace(/\{[1|\?]\}/g,h==null?"":h.replace(/[\n]/ig,"<br>"))}else{if(c.render!=null){d.firstChild.innerHTML=c.render(h)}else{d.firstChild.innerHTML=h==null||h==""?"&nbsp;":h}}if(h==null||h==""||h=="&nbsp;"){d.firstChild.removeAttribute("val")}else{d.firstChild.setAttribute("val",h)}},getColMaxNum:function(d,f){var h=null;var g=this.getRowCount();for(var c=0;c<g;++c){var j=this.getCell(c,d);var l=this._getTdNum(j);if(l!=null){if(h==null){h=l}else{if(!f&&h<l||f&&h>l){h=l}}}}return h},setRowValues:function(h,f,n){if(h==null||!(h>=0&&h<this.getRowCount())){return}var l=f==null?null:f.__nums;if(n){if(f!=null){for(var j in f){var q=f[j];if(q!=null){this.setCellValue(h,j,q,l==null?null:l[j])}}}}else{for(var g=0;g<this.columns.length;++g){var d=this.columns[g];if(d.type=="id"){continue}this.setCellValue(h,g,this._getFieldValue(f,d),l==null?null:l[j])}}},_getFieldValue:function(f,d){if(f==null){return null}var g=f[d.key];if(g==null&&!scil.Utils.isNullOrEmpty(d.was)){g=f[d.was]}return g},getCheckedRowValues:function(c){var g=[];var f=this.getJson(true);for(var d=0;d<f.rows.length;++d){if(scil.Utils.isTrue(f.rows[d][c])){g.push(f.rows[d])}}return g},getRowValues:function(g,n,l){if(g==null||!(g>=0&&g<this.getRowCount())){return null}var h={};if(l){h.__nums={};h.__edits={}}for(var f=0;f<this.columns.length;++f){var d=this.columns[f];if(d.type=="id"){continue}if(l){var j=this.getCellValue2(g,f,n);if(j!=null){h[d.key]=j.value;h.__nums[d.key]=j.number;h.__edits[d.key]=j.edit}}else{h[d.key]=this.getCellValue(g,f,n)}}return h},getRowValuesAsNumber:function(g){var h={};for(var f=0;f<this.columns.length;++f){var d=this.columns[f];if(d.type=="id"){continue}if(JSDraw2.Table.isNumerColumn(d.type)){h[d.key]=this._getTdNum(this.getCell(g,f))}else{h[d.key]=this.getCellValue(g,f,true)}}return h},setRowValuesAsNumber:function(j,f,g){if(j==null){return}for(var h=0;h<this.columns.length;++h){var d=this.columns[h];if(d.type=="id"){continue}var l=f==null||f.units==null?null:f.units[d.key];this.setCellValueAsNumber(j,h,f==null?null:f[d.key],l,g)}},getCellValueAsNumber:function(d,c){return this._getTdNum(this.getCell(d,c))},standardUnit:function(c){var d=null;if(d==null){d=JSDraw2.Table._standardUnits[c]}return d},setCellValueAsNumber:function(h,g,n,l,f){if(typeof g=="string"){g=this.getColIndex(g)}if(g==null||g<0){return}var j=null;var d=this.columns[g];if(JSDraw2.Table.isNumerColumn(d.type)){j=n;if(n!=null&&!JSDraw2.Table.isNA(n)){if(isNaN(n)||!isFinite(n)){n=null}else{if(d.type=="density"){n=JSDraw2.Table.formatValue(n/1000,"g/mL",f,true)}else{if(l==null){l=this.standardUnit(d.type)}if(n!=null&&l!=null&&l.toLowerCase()=="g/ml"){n/=1000}if(f==null){f=this.options.decimal}n=JSDraw2.Table.formatValue(n,l,f)}}}}this.setCellValue(h,g,n,j)},getColSum:function(d,f,j){var g=0;for(var c=0;c<this.getRowCount();++c){if(f!=null&&this.getCellValue(c,f)!=j){continue}var h=this.getCellValueAsNumber(c,d);if(h!=null&&!isNaN(h)){g+=h}}return g},getColAvg:function(c,d,g){var f=this.getColSum(c);return f/this.getRowCount()},getColValues:function(d){if(typeof d=="string"){d=this.getColIndex(d)}if(d==null){return null}var f=[];for(var c=0;c<this.getRowCount();++c){f.push(this.getCellValue(c,d))}return f},getCellValue:function(f,d,j,g,c){var h=this.getCellValue2(f,d,j,g,c);return h==null?null:h.value},getCellValue2:function(g,f,n,h,c){if(typeof f=="string"){f=this.getColIndex(f)}var d=this.columns[f];if(d==null){return null}var j=this.getCell(g,f);if(j==null){return null}var l=this._getCellValue(j,d,n,h,c);return{value:l,number:JSDraw2.Table._getCellNumber(j),edit:JSDraw2.Table._getCellEdit(j)}},_getCellValue:function(h,d,l,f,c){switch(d.type){case"structure":case"compstructure":if(h.jsd.m.isEmpty()){return""}else{if(c){return h.jsd.m.getSmiles()}else{if(l){return h.jsd.getXml()}else{return h.jsd.getMolfile()}}}case"checkbox":case"radio":return h.firstChild.firstChild.checked?"1":"";case"subform":case"file":case"filelink":case"filedblink":case"filepath":case"image":case"tabtext":case"richtext":case"plaintext":case"sketches":return h.host.getXml();case"html":var j=h.firstChild.getAttribute("val");return j==null?"":j;case"rte":var j=h.firstChild.innerHTML;return j==null?"":j;default:var g=d.render==null?(f?(h.firstChild.innerText||h.firstChild.textContent):scil.Utils.unescXmlValue(h.firstChild.innerHTML).replace(/<br>/ig,"\n")):h.firstChild.getAttribute("val");return g=="&nbsp;"?"":g}},getColValue:function(formula){var p=formula.indexOf("(");var fun=formula.substr(0,p);var exp=formula.substr(p);var keywords=JSDraw2.Table.getKeywords(exp);for(var key in keywords){keywords[key]=this.getColIndex(key)}var list=[];for(var r=0;r<this.getRowCount();++r){var s=exp;for(var key in keywords){var v=this._getTdNum(this.getCell(r,keywords[key]));if(v==null){s=null;break}s=s.replace(key,v)}if(s==null){list.push(null)}else{eval("var temp="+s);list.push(temp)}}if(list.length==0){return null}if(fun=="min"||fun=="max"||fun=="sum"||fun=="avg"){var ret=null;for(var i=0;i<list.length;++i){if(isNaN(list[i])){return null}var v=parseFloat(list[i]);if(ret==null){ret=v}else{switch(fun){case"min":ret=Math.min(v,ret);break;case"max":ret=Math.max(v,ret);break;case"sum":case"avg":ret+=v;break}}}if(fun=="avg"){ret/=list.length}return ret}return null},getRowCount:function(){if(this.options.pivot){return this.header==null?0:this.header.childNodes.length/2-1}else{return this.tbody==null?0:this.tbody.childNodes.length}},getColCount:function(){return this.columns==null?0:this.columns.length},_updateCol:function(c){var g=[];var f=this.getColIndex(c);for(var d=0;d<this.getRowCount();++d){if(this._updateCell(d,f)){g.push(d)}}for(var d=0;d<g.length;++d){this.cellChanged(g[d],f)}},cellChanged:function(j,h){this._updateRow(j,h);var f=this.columns[h].key;for(var g=0;g<this.connectors.length;++g){var d=this.connectors[g];if(d.keywords[f]){d.connected._updateCol(d.column)}}},_updateRow:function(j,h){var f=[];var d=this.columns[h].key;for(var g=0;g<this.getColCount();++g){var c=this.columns[g];if(c.formula!=null){if(c.keywords[d]){if(this._updateCell(j,g)){f.push(g)}}}}if(this.columns[h].type=="compid"){for(var g=h+1;g<this.getColCount();++g){if(this.columns[g].type=="compstructure"){this.setCompStructure(j,h,g);break}}}for(var g=0;g<f.length;++g){this.cellChanged(j,f[g])}},setCompStructure:function(g,d,f,h){if(JSDrawServices.id2s.url==null){return}var l=this.getCellValue(g,d);var j=this;var c=function(n){j.setCellValue(g,f,typeof(n)=="string"?n:n.jsd);if(h){if(g+1<j.getRowCount()){j.setCompStructure(g+1,d,f,h)}}};if(l!=null&&l!=""){scil.Utils.jsonp(JSDrawServices.id2s.url,c,{q:l,fmt:"jsdraw"})}else{c("")}},_updateCell:function(iRow,iCol){var col=this.columns[iCol];var s=col.formula;for(var c in col.keywords){if(c.substr(0,1)=="@"){var p=c.lastIndexOf(".");var table=c.substr(1,p-1);var formula=c.substr(p+1);var jss=JSDraw2.Table.get((this.options!=null&&this.options.prefix!=null?this.options.prefix:"")+table);if(jss==null){s=null;break}var v=jss.getColValue(formula);if(v==null){s=null;break}s=s.replace(c,v)}else{var i=this.getColIndex(c);if(i==null){continue}var td=this.getCell(iRow,i);if(td==null){continue}var str=false;var v;if(col.keywords[c]=="$"){str=true;v=this._getTdValue(td)}else{v=this._getTdNum(td)}if(v==null){s=null;break}if(str){s=s.replace("$"+c,"'"+v.replace("'","\\'")+"'")}else{s=s.replace(new RegExp("\\b"+c+"\\b","g"),v)}}}var val="&nbsp;";if(s!=null){try{eval("var temp="+s);if(typeof temp=="number"){temp=this.round(temp)}val=temp}catch(e){val="ERROR"}}var target=this.getCell(iRow,iCol);if(target.firstChild.innerHTML==val){return false}this.setCellValue(iRow,iCol,(val==null||val=="")?"&nbsp;":val);return true},round:function(c){if(this.options.roundmethod=="significant"){return scil.Utils.roundToSignificantDigits(c,this.options.decimal>0?this.options.decimal:2)}else{return scil.Utils.round(c,this.options.decimal>0?this.options.decimal:2)}},_getTdValue:function(d,c){return d==null?null:(c?d.firstChild.innerText:d.firstChild.innerHTML)},_getTdNum:function(d){var c=JSDraw2.Table._getCellNumber(d);if(!scil.Utils.isNullOrEmpty(c)){return parseFloat(c)}var f=this._getTdValue(d,true);return JSDraw2.Table.parseValue(f)},showSearch:function(){var f=this;var c=function(g){return f.search(g)};var d=JSDraw2.Editor.showPopup("Structure Search","Search",c)},resetSearch:function(){return this.highlight(null,false)},search:function(c){return this.highlight(c,true)},highlight:function(w,x){var l=[];if(this.options.grid){for(var g=0;g<this.tbody.childNodes.length;++g){var z=this.tbody.childNodes[g];for(var h=0;h<z.childNodes.length;++h){var y=z.childNodes[h];if(y.jsd!=null){if(y.jsd.m.setColor(null)>0){y.jsd.redraw()}l.push(y)}}}}else{var f=[];for(var g=0;g<this.getColCount();++g){var d=this.columns[g];if(d.type=="structure"||d.type=="compstructure"){f.push(g);break}}for(var g=0;g<this.getRowCount();++g){this.setRowStyle(g,"display","");for(var h=0;h<f.length;++h){var y=this.getCell(g,f[h]);if(y.jsd!=null){y.jsd.m.setColor(null);l.push(y)}}}}if(w==null){return}var u=null;if(typeof w=="object"){if(w.T=="MOL"){u=w}else{u=w.m}u=u.clone()}else{u=new JSDraw2.Mol().setMolfile(w)}if(u==null){scil.Utils.alert("No Query");return false}u.removeHydrogens(false);if(u.atoms.length==0){return true}var t=0;for(var g=0;g<l.length;++g){var y=l[g];if(y.jsd.highlight(u)){++t}else{if(x&&!this.options.grid){this.setRowStyle(g,"display","none")}}}if(t==0){scil.Utils.alert("No hits found")}return true},_loadXmlRow:function(g,f,d,c,l){var h=JSDraw2.Table.readXmlRow(g,d);if(l){this.validateRow(h)}var j=this._addRecord(h,f,c);if(g!=null){switch(g.getAttribute("e")){case"+":j.style.backgroundColor="lime";break;case"-":j.style.textDecoration="line-through";break}}},_loadSdfRow2:function(g,d,h,c){if(g==null){return null}if(c!=null&&!c(g.molfile,g.props)){return null}var f=g.props;if(this.options.grid){f={};f[h]=g.molfile}else{if(h!=null&&f!=null){f[h]=g.molfile}}return this._addRecord(f,d,false)},_loadSdfRow:function(g,d,h,c){var f=JSDraw2.Table.readSdfRecord(g,!this.options.grid);return this._loadSdfRow2(f,d,h,c)},_loadRdfRow:function(f,d,g,c){return this._loadSdfRow2(f,d,g,c)},_addRecord:function(t,j,d){if(this.options.grid){var g=null;for(var h=0;h<this.columns.length;++h){var f=this.columns[h];if(f.type=="structure"||f.type=="compstructure"){g=this.columns[h];break}}if(g==null){return}var l=t[g.key];var w=null;var q=j==null?0:j.parentNode.childNodes.length;if(q%this.options.cols==0){w=scil.Utils.createElement(this.tbody,"tr")}else{w=j.parentNode}j=this.createTD(w,null);this.createMol(j,l,200,120,this.options.viewonly,g);return j}else{if(d&&this.options.primarykey!=null&&this.options.primarykey!=""){var x=t[this.options.primarykey];var u=this.findRow(this.options.primarykey,x);if(u!=null){this.updateRow(u,t)}else{return this._makeRow(null,t)}}else{return this._makeRow(null,t)}}},updateRow:function(f,j){if(j==null){j={}}var h=j.__nums;var g=[];for(var d=0;d<this.columns.length;++d){var c=this.columns[d];this.setCellValue(f,d,this._getFieldValue(j,c),h==null?null:h[c.key]);if(c.type=="structure"||c.type=="compstructure"){var l=this.getCell(f,d);if(l!=null){g.push(l)}}}for(var d=0;d<g.length;++d){this._updateMol(g[d],true)}},findRow:function(d,j,f,l){if(j==null||j==""){return null}for(var c=0;c<this.getRowCount();++c){var g=this.getCellValue(c,d);var h=f==null?null:this.getCellValue(c,f);if(g==j&&(f==null||h==l)){return c}}return null},findRows:function(d,h){if(h==null||h==""){return null}var f=[];for(var c=0;c<this.getRowCount();++c){var g=this.getCellValue(c,d);if(g==h){f.push(c)}}return f},checkRequiredFields:function(f){var g=0;var h=this.getRowValues(f);for(var d=0;d<this.columns.length;++d){var c=this.columns[d];if(!c.required){continue}if(h==null||scil.Utils.isNullOrEmpty(h[c.key])){this.hilitHeader(d,"red");++g}else{this.hilitHeader(d,"")}}return g},_setHeaderCaption:function(j,d){var g=d.caption==null||d.caption.length==0?d.key:d.caption;var h=g;if(d.required){if(g==null){g=""}g="<i style='color:red'>*</i>"+g}j.firstChild.innerHTML=g==null||g.length==0?"&nbsp;":g;if(d.tooltips!=null){j.title=d.tooltips}else{if(h!=null){j.title=h}}if(d.type=="checkbox"&&d.headercheckbox!=false&&!d.viewonly&&!this.options.viewonly){var f=this;var c=scil.Utils.createElement(null,"checkbox");j.firstChild.insertBefore(c,j.firstChild.firstChild);dojo.connect(c,scil.Utils.isIE&&scil.Utils.isIE<=8?"onclick":"onchange",function(){var l=c.checked;var t=f.getRowCount();if(t==0){return}for(var q=0;q<t;++q){f.setCellValue(q,d.key,l)}if(f.options.onCheckAll!=null){f.options.onCheckAll(l)}})}},hilitHeader:function(f,g){if(typeof(f)=="string"){f=this.getColIndex(f)}if(this.header==null||f==null||f<0&&f>=this.getColCount()){return}var d=g;if(scil.Utils.isNullOrEmpty(d)){var h=this.columns[f];d=h.bgheadercolor==null?"":h.bgheadercolor}var j=this.header.childNodes[f*2];j.style.backgroundColor=d;j.nextSibling.style.backgroundColor=d},hilitAllHeaders:function(c){for(var d=0;d<this.getColCount();++d){this.hilitHeader(d,c)}},setColWidth:function(f,n){if(!this.options.pivot&&this.columns[f].display=="none"){return 0}if(n<5){n=5}if(!this.options.pivot){this.columns[f].width=n}var g=scil.Utils.isIE&&scil.Utils.isIE<8?0:this.PADDING;var c=this.options.handlerwidth>0?this.options.handlerwidth:2;var l=this.header.childNodes[f*2];l.firstChild.style.width=(n-g-(scil.Utils.isUbuntu?2:0)-c)+"px";l.nextSibling.firstChild.style.width=c+"px";l.nextSibling.style.width=c+"px";var h=this.tbody.childNodes;for(var d=0;d<h.length;++d){var j=h[d].childNodes[f];if(j.jsd!=null){j.firstChild.style.width=n+"px";if(!scil.Utils.isIE||scil.Utils.isIE>=9||scil.Utils.isSilverlight){j.jsd.setSize(n,0)}}else{if(j.host!=null&&j.host.setSize!=null){j.firstChild.style.width=n+"px";if(!scil.Utils.isIE||scil.Utils.isIE>=9||scil.Utils.isSilverlight){j.host.setSize(n,0)}}else{j.firstChild.style.width=(n-g)+"px"}}}return n},showColumns:function(){if(this.showcoldlg==null){var j=this;var g={cols:{type:"table",options:{delrow:false,addrow:false},columns:{k:{type:"hidden"},c:{label:"Column",viewonly:true,width:200},show:{label:"Show",type:"checkbox",width:100}}}};this.showcoldlg=scil.Form.createDlgForm("Show/Hide Columns",g,[{label:"Save",onclick:function(){j.showColumns2()}},{label:"Cancel",onclick:function(){j.showcoldlg.hide()}}],{hidelabel:true})}this.showcoldlg.show();var l=[];for(var h=0;h<this.columns.length;++h){var d=this.columns[h];if(d.type!="hidden"&&d.type!="id"&&d.hideable!=false){var f=scil.Utils.html2Text(d.caption);l.push({k:d.key==null?f:d.key,c:f==null?d.key:f,show:!d.ishidden})}}this.showcoldlg.form.fields.cols.jsd.setData(l);this.showcoldlg.moveCenter()},showColumns2:function(){var d=this.showcoldlg.form.fields.cols.jsd.getData();for(var c=0;c<d.length;++c){this.showColumn(d[c].k,scil.Utils.isTrue(d[c].show))}this.showcoldlg.hide();if(this.options.width>0){this.setSize(this.options.width)}if(this.options.onhidecolumns!=null){this.options.onhidecolumns(this)}},hidColumn:function(c){return this.showColumn(c,false)},showColumn:function(g,h){if(this.options.pivot){return false}if(typeof(g)!="number"){g=this.getColIndex(g)}var d=this.columns[g];if(d==null||d.type=="hidden"){return false}if(h==null){h=true}d.ishidden=!h;this.header.childNodes[g*2].style.display=h?"":"none";this.header.childNodes[g*2+1].style.display=h?"":"none";for(var j=0;j<this.getRowCount();++j){this.tbody.childNodes[j].childNodes[g].style.display=h?"":"none"}return true},_makeHeader:function(f){var c=this.columns[f];if(this.options.pivot){var j=scil.Utils.createElement(this.tbody,"tr",null,{height:"25px"});var g=this.createTD(j,0,this.options.rowid==false&&f==1);dojo.style(g,{backgroundColor:"#f2f2f2",fontWeight:"bold",color:c.viewonly?"gray":""});g.firstChild.innerHTML=c.caption;for(var d=0;d<this.getRowCount();++d){this.createTD(j,d+1,this.options.rowid==false&&f==1);this._makeCell(d,f)}}else{var h=this.createTH(f,c.type=="hidden"||c.ishidden,c.bgheadercolor);this._setHeaderCaption(h,c);h.style.color=c.viewonly?"gray":"";for(var d=0;d<this.getRowCount();++d){this.createTD(this.tbody.childNodes[d],f,null,c);this._makeCell(d,f)}this.setColWidth(f,c.width);if(!this.options.pivot&&!scil.Utils.isNullOrEmpty(c.bordercolor)){h.nextSibling.style.borderRightColor=c.bordercolor}return h}},_makeCell:function(j,g,w,q){var d=this.columns[g];var u=this.getCell(j,g);if(u.jsd!=null){u.jsd.destroy();u.jsd=null}u.firstChild.innerHTML="";var l=d.key;var x=this.options.pivot?this.PIVOTCOLWIDTH:d.width;if(d.type!="structure"&&d.type!="compstructure"){u.firstChild.style.width=(x-(scil.Utils.isIE&&scil.Utils.isIE<8?0:this.PADDING))+"px"}switch(d.type){case"structure":case"compstructure":u.style.padding="0";u.firstChild.style.padding="0";this.createMol(u,w,x,this.options.molheight>0?this.options.molheight:80,d.viewonly||d.type=="compstructure",d);return u;case"hidden":u.style.display="none";break;case"subform":case"file":case"filelink":case"filedblink":case"filepath":case"image":case"sketches":case"tabtext":case"richtext":case"plaintext":var n=this;var t={};if(d.options!=null){scil.apply(t,d.options)}t.onchange=function(){var y=n.getCellPos(u);n.onCellChanged(y.iRow,y.iCol)};if(scil.Utils.isNullOrEmpty(t.source)){t.source=d.source}if(scil.Utils.isNullOrEmpty(t.downloadurl)){t.downloadurl=d.downloadurl}if(scil.Utils.isNullOrEmpty(t.cmd)){t.cmd=d.cmd}if(t.maxcount==null){t.maxcount=d.maxcount}if(t.shortdisplay==null){t.shortdisplay=d.shortdisplay}if(t.onbeforeselect==null){t.onbeforeselect=d.onbeforeselect}if(this.options.viewonly||d.viewonly){t.viewonly=true}switch(d.type){case"subform":u.host=new scil.FieldSubform(u.firstChild,t);break;case"file":u.host=new scil.FieldFile(u.firstChild,t);break;case"filelink":case"filedblink":case"filepath":u.host=new scil.FieldFileLink(u.firstChild,t);break;case"image":u.host=new scil.FieldImage(u.firstChild,t);break;case"sketches":u.host=new scil.FieldSketches(u.firstChild,t);break;case"tabtext":u.host=new scil.FieldTabText(u.firstChild,t);break;case"richtext":u.host=new scil.FieldRichText(u.firstChild,t);break;case"plaintext":u.host=new scil.FieldPlainText(u.firstChild,t);break}break;case"checkbox":case"radio":u.firstChild.style.textAlign=d.align==null?"center":d.align;scil.Utils.removeAll(u.firstChild);var c=scil.Utils.createElement(u.firstChild,d.type,null,null,d.type=="checkbox"?null:{name:"__"+this.id+"_"+this.univid+"_"+d.key});if(d.viewonly||this.options.viewonly){c.disabled=true}else{var n=this;var f=function(){var y=n.getCellPos(u);n.onCellChanged(y.iRow,y.iCol)};dojo.connect(c,"onchange",function(y){f(y)})}break;case"html":break;case"rte":break;default:if(d.type=="id"){var h=this.getRowCount();u.style.backgroundColor=JSDraw2.Skin.jssdf.headercolor;u.firstChild.innerHTML=this.options.idasletter?scil.Utils.num2letter(h):h}break}this.setCellValue(j,g,w,q);if(!scil.Utils.isNullOrEmpty(d.bgcolor)){u.style.backgroundColor=d.bgcolor}return u},_makeRow:function(j,u){if(j<=this.currow){this.setCurRow(null)}if(this.tbody==null){this.createTable()}var z=null;if(this.options.pivot){var c=null;var A=this.tbody.childNodes[0];if(j!=null&&j>=0&&j+1<A.childNodes.length){c=j+1}else{j=A.childNodes.length-1}var y=this.createTH(j+1,null);y.firstChild.innerHTML=j+1;for(var h=0;h<this.tbody.childNodes.length;++h){var z=this.tbody.childNodes[h];var w=z.childNodes[c];var x=this.createTD(z,j+1,this.options.rowid==false&&h==0);if(w!=null){z.insertBefore(x,w)}}this.setColWidth(j+1,this.PIVOTCOLWIDTH)}else{z=scil.Utils.createElement(null,"tr");z.style.height="25px";if(j!=null&&j>=0&&j<this.tbody.childNodes.length){this.tbody.insertBefore(z,this.tbody.childNodes[j])}else{j=this.tbody.childNodes.length;this.tbody.appendChild(z)}for(var h=0;h<this.getColCount();++h){this.createTD(z,h,null,this.columns[h])}}var t=u==null?null:u.__nums;var g=u==null?null:u.__edits;var d=u==null?null:u.__changes;var l=[];for(var h=this.options.pivot?1:0;h<this.getColCount();++h){var f=this.columns[h];var B=this._getFieldValue(u,f);var x=this._makeCell(j,h,B,t==null?null:t[f.key]);JSDraw2.Table._setCellEdit(x,g==null?null:g[f.key]);if(f.type=="structure"||f.type=="compstructure"){l.push(x)}if(d!=null&&!scil.Utils.isNullOrEmpty(d[f.key])){x.style.backgroundColor="red"}}for(var h=0;h<l.length;++h){this._updateMol(l[h],true)}if(!this.options.pivot){for(var h=0;h<this.getColCount();++h){if(this.columns[h].ishidden){z.childNodes[h].style.display="none"}}if(this.columns[0].type=="id"){var q=this.getRowCount();for(var h=j;h<q;++h){this.getCell(h,0).firstChild.innerHTML=this.options.idasletter?scil.Utils.num2letter(h+1):(h+1)}}}if(this.jointable!=null){this.jointable._makeRow(j,{})}return z},createMol:function(l,h,q,f,n,c){var d="molfile";if(h!=null&&typeof(h)=="object"){d="html"}else{if(h!=null&&h.indexOf(" V2000")<0){d="html"}}var j={width:q,height:f,viewonly:true,popup:!this.options.viewonly&&!n,dataformat:d,data:h,removehydrogens:this.options.removehydrogens};j.allowqccurve=c.allowqccurve;var g=this;j.ondatachange=function(t){g._updateMol(l)};j.onfitresult=function(t){g._onfitresult(l,t);var u=g.getCellPos(l);g.onCellChanged(u.iRow,u.iCol)};l.jsd=new JSDraw2.Editor(l.firstChild,j)},_onfitresult:function(q,d){var j=(d.ic50Label()+"").toLowerCase();var l=(d.icxLabel()+"").toLowerCase();var n=this.getCellPos(q);for(var h=n.iCol+1;h<this.getColCount();++h){var g=false;var c=this.columns[h];if(this.options.oncurvefitting!=null){if(this.options.oncurvefitting(d,this,n)=="cancel"){continue}}if(c.type!="float"){continue}var t=d.inactiveRangeValue();switch((c.key+"").toLowerCase()){case"ic50":if(scil.Utils.isNullOrEmpty(t)){this.setCellValueAsNumber(n.iRow,h,d.ic50)}else{this.setCellValue(n.iRow,h,t)}break;case"r2":this.setCellValueAsNumber(n.iRow,h,d.r2);break;case"hillslope":this.setCellValueAsNumber(n.iRow,h,d.hillslope);break;case"emax":this.setCellValueAsNumber(n.iRow,h,d.emax());break;case"emin":this.setCellValueAsNumber(n.iRow,h,d.emin());break;default:if(scil.Utils.isNullOrEmpty(t)){if(j==c.key){this.setCellValueAsNumber(n.iRow,h,t!=null?t:d.ic50)}else{if(l==c.key){this.setCellValueAsNumber(n.iRow,h,t!=null?t:d.icx)}}}else{this.setCellValue(n.iRow,h,t)}g=false;break}if(g){this.cellChanged(n.iRow,h)}}},_updateMol:function(q,g){var h=this.getCellPos(q);var f=q.jsd;if(f.m.atoms.length==0&&f.m.graphics.length==1&&JSDraw2.AssayCurve.cast(f.m.graphics[0])!=null){this._onfitresult(q,f.m.graphics[0]);return}var l=null;var n=null;for(var d=h.iCol+1;d<this.getColCount();++d){var c=this.columns[d];if(c.type=="salt"||c.type=="saltlist"){l=this.getCellValue(h.iRow,d)}else{if(c.key=="saltratio"&&c.type=="float"){n=this.getCellValueAsNumber(h.iRow,d)}else{if(c.type=="structure"||c.type=="compstructure"){return}else{if(c.type=="mf"){var j=JSDraw2.FormulaStats.calcMWMF(f.m,c.withoutsalt?null:l,n).mf;this.getCell(h.iRow,d).firstChild.innerHTML=j==null||j.length==0?"&nbsp;":j;this.cellChanged(h.iRow,d)}else{if(c.type=="mw"){var t=JSDraw2.FormulaStats.calcMWMF(f.m,c.withoutsalt?null:l,n).mw;if(t==null&&JSDraw2.Table._getCellEdit(this.getCell(h.iRow,d))){}else{this.setCellValueAsNumber(h.iRow,d,t);this.cellChanged(h.iRow,d)}}else{if(c.type=="em"){var t=f.getExactMass();this.setCellValueAsNumber(h.iRow,d,t);this.cellChanged(h.iRow,d)}else{if(c.type=="smiles"){var t=f.getSmiles();this.getCell(h.iRow,d).firstChild.innerHTML=t==null?"&nbsp;":t;this.cellChanged(h.iRow,d)}}}}}}}}if(g!=true){this.onCellChanged(h.iRow,h.iCol)}},getCell:function(f,d){if(typeof d=="string"){d=this.getColIndex(d)}if(f==null||d==null||f>=this.getRowCount()||d>=this.getColCount()){return null}var g=this.options.pivot?d-1:f;var c=this.options.pivot?f+1:d;if(g==-1){return this.header.childNodes[c*2]}else{return this.tbody.childNodes[g].childNodes[c]}},getRowByColValue:function(d,g,f,h){if(typeof d=="string"){d=this.getColIndex(d)}if(typeof f=="string"){f=this.getColIndex(f)}for(var c=0;c<this.getRowCount();++c){if(this.getCellValue(c,d)==g&&(f==null||this.getCellValue(c,f)==h)){return c}}return null},createTH:function(j,g,c){var t=this.header;var n=this.options.resizable!=false;var f=scil.Utils.createElement(null,"th",null,{borderRight:this.BORDERSTYLE,borderBottom:this.BORDERSTYLE,padding:"0px",cursor:n?"e-resize":null},{unselectable:"on"});scil.Utils.createElement(f,"div","&nbsp;",{fontSize:"1px",padding:0});if(j!=null&&j>=0&&j<t.childNodes.length/2){t.insertBefore(f,t.childNodes[j*2])}else{t.appendChild(f)}var q=scil.Utils.createElement(null,"th",null,{borderBottom:this.BORDERSTYLE,padding:"5px 0 0 0",textAlign:"center"});var d=scil.Utils.createElement(q,"div",null,{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",padding:"0",paddingLeft:this.PADDING+"px"});t.insertBefore(q,f);if(n){var l=this;if(scil.Utils.isTouch){this.connectHandlers.push(dojo.connect(f,"ontouchstart",function(h){if(h.touches.length==1){l.startResizing(h.touches[0]);h.preventDefault()}}))}else{this.connectHandlers.push(dojo.connect(f,"onmousedown",function(h){l.startResizing(h)}))}}if(this.options.sortable){this.connectHandlers.push(dojo.connect(q,"onclick",function(h){l.sortCol(h)}))}if(g){f.style.display="none";q.style.display="none"}if(!scil.Utils.isNullOrEmpty(c)){f.style.backgroundColor=c;q.style.backgroundColor=c}return q},sortCol:function(d){var c=this.getColByHeader(d,false);if(c!=null){this.sort(c)}},isColString:function(d){var c=typeof d=="object"?d:this.columns[d];return c.type=="string"||c.type==""||c.type==null||c.type=="text"||c.type=="mf"||c.type=="smiles"||c.type=="compid"},isColStructure:function(d){var c=typeof d=="object"?d:this.columns[d];return c.type=="structure"||c.type=="compstructure"},isColNumber:function(d){var c=typeof d=="object"?d:this.columns[d];return c.type!="checkbox"&&c.type!="radio"&&c.type!="html"&&!this.isColStructure(c)&&!this.isColString(c)},applyFormula:function(d,c){if(scil.Utils.isNullOrEmpty(d)){return false}var j=d.indexOf("=");if(j<=0){return false}var l=d.substr(0,j);d=d.substr(j+1);if(scil.Utils.startswith(l,"{")&&scil.Utils.endswith(l,"}")){l=l.substr(1,l.length-2)}var h=0;var g=this;for(var f=0;f<this.getRowCount();++f){var q=scil.Form.evalFormula(d,c,this,f);var t=this.getCellValue(f,l);if(q!=t){this.setCellValue(f,l,q);++h}}return h>0},sort:function(l){if(this.options.pivot||this.options.grid){return}if(this.options.onsortcolumn!=null){this.options.onsortcolumn(l);return}var d=this.columns[l];if(this.isColStructure(d)||d.sortable==false){return}var n=this.isColNumber(d);var q=[];for(var j=0;j<this.getRowCount();++j){var y;if(n){var u=this.getCell(j,l);y=this._getTdNum(u)}else{y=this.getCellValue(j,l,false,true)}y=this.removeQualifier(y);q.push({v:y,r:this.tbody.childNodes[j]})}if(!n&&(d.type==null||d.type=="")){var c=true;for(var j=0;j<q.length;++j){if(q[j].v!=null&&isNaN(q[j].v)){c=false;break}}if(c){for(var j=0;j<q.length;++j){if(q[j].v!=null){q[j].v=parseFloat(q[j].v);if(isNaN(q[j].v)){q[j].v=null}}}}}var w=this.getCell(-1,l);var f=w.style.backgroundImage!=null&&w.style.backgroundImage.indexOf("asc.gif")>0;var g=function(A,B){return A.v==B.v?0:(B.v==null||A.v>B.v?1:-1)};var h=function(A,B){return A.v==B.v?0:(A.v==null||A.v<B.v?1:-1)};q.sort(f?h:g);if(scil.Utils.isSilverlight){var z=[];for(var j=0;j<q.length;++j){var x=q[j].r;var t=this.tbody.childNodes[j];z.push(x==t?null:this.getRowRawData(x))}for(var j=0;j<q.length;++j){if(z[j]!=null){this.setRowRawData(this.tbody.childNodes[j],z[j])}}}else{for(var j=0;j<q.length;++j){var x=q[j].r;var t=this.tbody.childNodes[j];if(x!=t){this.tbody.insertBefore(x,t)}}}for(var j=0;j<this.getColCount();++j){this.getCell(-1,j).style.background=""}w.style.background=scil.Utils.imgSrc("img/"+(f?"sortdsc.gif":"sortasc.gif"),true)+" no-repeat center top"},getRowRawData:function(g){var d=[];for(var c=0;c<g.childNodes.length;++c){var f=g.childNodes[c];if(f.jsd!=null){d.push(f.jsd.getXml())}else{d.push(f.innerHTML)}}return d},setRowRawData:function(g,d){for(var c=0;c<g.childNodes.length;++c){var f=g.childNodes[c];if(f.jsd!=null){f.jsd.setXml(d[c],false)}else{f.innerHTML=d[c]}}},removeQualifier:function(f){if(f==null){return f}if(f.length>1){var d=f.charCodeAt(0);if(d==8804||d==8805||d==62||d==60){f=f.substr(1)}}if(f.length>1&&f.charCodeAt(0)==61){f=f.substr(1)}return f},createTD:function(j,f,h,c){var g=scil.Utils.createElement(null,"td",null,{borderRight:this.BORDERSTYLE,borderBottom:this.BORDERSTYLE,padding:"0"});if(h){g.style.borderTop=this.BORDERSTYLE}var d=scil.Utils.createElement(g,"div",null,{whiteSpace:this.options.whitespace==null?"nowrap":this.options.whitespace,overflow:"hidden",textOverflow:"ellipsis",padding:"0",paddingLeft:this.PADDING+"px"});if(f!=null&&f>=0&&f<j.childNodes.length){j.insertBefore(g,j.childNodes[f])}else{j.appendChild(g)}if(JSDraw2.Table.textoverflowtooltips!=false){scil.connect(d,"onmouseenter",function(l){var n=l.target||l.srcElement;if(n.offsetWidth<n.scrollWidth){n.setAttribute("title",scil.Utils.getInnerText(n))}else{n.removeAttribute("title")}})}if(c!=null&&!this.options.pivot&&!scil.Utils.isNullOrEmpty(c.bordercolor)){g.style.borderRightColor=c.bordercolor}return g},getCellPos:function(g){var h=g.parentNode;var f=this.tbody.childNodes;for(var c=0;c<f.length;++c){if(f[c]==h){for(var d=0;d<h.childNodes.length;++d){if(h.childNodes[d]==g){return this.options.pivot?{iRow:d-1,iCol:c+1}:{iRow:c,iCol:d}}}return null}}return null},getCellPosByScreen:function(q,t){var h=this.tbody.parentNode;var g=scil.Utils.getOffset(h);if(q<g.x||q>g.x+h.offsetWidth||t<g.y||t>g.y+h.offsetHeight){return null}var f=this.tbody.childNodes;for(var c=0;c<f.length;++c){var n=f[c];var l=n.childNodes[0];g=scil.Utils.getOffset(l);if(t>g.y&&t<g.y+l.offsetHeight){for(var d=0;d<n.childNodes.length;++d){l=n.childNodes[d];g=scil.Utils.getOffset(l);if(q>g.x&&q<g.x+l.offsetWidth){return this.options.pivot?{iRow:d-1,iCol:c+1}:{iRow:c,iCol:d}}}}}return null},showRTE:function(g,c){var d=this;var f=g.firstChild.innerHTML;if(f==" "||f=="&nbsp;"){f=""}scil.Richtext.showDlg({text:f,callback:function(h){d.doneRTE(h)}});this._rte={td:g,col:c}},doneRTE:function(f){var g=this._rte.td;var c=this._rte.col;f=this.cleanupRTE(f);if(g.firstChild.innerHTML==f){return}g.firstChild.innerHTML=scil.Utils.isNullOrEmpty(f)?"&nbsp;":f;var d=this.getCellPos(g);if(c.onchanged!=null){c.onchanged(d.iRow,d.iCol,this)}this.onCellChanged(d.iRow,d.iCol)},cleanupRTE:function(j){var d=scil.Utils.createElement(null,"div");d.innerHTML=j;var h="";var c=d.childNodes;for(var g=0;g<c.length;++g){var f=c[g];if(f.tagName!=null&&f.tagName=="P"){h+=f.innerHTML}}return h},_edit:function(h,d){if(d.type=="rte"){this.showRTE(h,d);return}var f=this;if(this.editor==null){this.editor=scil.Utils.createElement(document.body,"input",null,{display:"none",position:"absolute",padding:"2px",zIndex:900,borderRadius:0});this.connectHandlers.push(dojo.connect(this.editor,"onblur",function(j){if(!f.autocomplete.isDropdownVisible()&&!scil.DatePicker.isDropdownVisible()&&!f.multiselect.isDropdownVisible()){f._doneEditor()}}));this.connectHandlers.push(dojo.connect(this.editor,"onkeydown",function(j){f._keydown(j)}));var g=null;if(d.onsuggest!=null){g={onsuggest:function(j){d.onsuggest(j,d,f)}}}this.autocomplete=new scil.DropdownInput(this.editor,g);this.multiselect=new scil.DropdownCheck(this.editor,{onhide:function(){f._doneEditor()}})}if(this.options.onedit!=null){this.options.onedit(d,h,this)}if(d.onedit!=null){d.onedit(d,h,this)}if(d.listurl==null&&d.type=="select"&&d.autosuggesturl!=null){d.listurl=d.autosuggesturl}var f=this;if(d.items==null&&d.listurl!=null){var c={};if(d.onsuggest!=null){d.onsuggest(c)}scil.Utils.jsonp(d.listurl,function(j){d.items=j.items!=null?j.items:j;f._edit2(h,d)},c)}else{this._edit2(h,d)}if(this.selectbox!=null){this.selectbox.hide()}},_edit2:function(h,c){var j=h.firstChild.innerHTML==" "||h.firstChild.innerHTML=="&nbsp;"?"":scil.Utils.unescXmlValue(h.firstChild.innerHTML);this.multiselect.disabledropdown=true;if(c.type=="date"){if(this.datepicker==null){this.datepicker=new scil.DatePicker(this.editor)}this.datepicker.options.startdate=c.startdate;this.datepicker.options.enddate=c.enddate;this.datepicker.options.dateformat=c.dateformat;this.datepicker.disablepopup=false;this.autocomplete.options.items=null;this.autocomplete.options.autosuggest=null}else{if(this.datepicker!=null){this.datepicker.disablepopup=true}if(c.type=="salt"||c.type=="saltlist"){var d=[];var g=JSDraw2.defaultoptions.salts||JSDraw2.salts;for(var f in g){d.push(f)}this.autocomplete.options.autosuggest=c.autosuggesturl;this.autocomplete.options.minautowidth=c.minautowidth;this.autocomplete.options.items=d;this.autocomplete.updateDropdown(c.type=="saltlist")}else{if(c.type=="multiselect"){if(this.datepicker!=null){this.datepicker.disablepopup=true}this.autocomplete.options.items=null;this.autocomplete.options.autosuggest=null;this.multiselect.disabledropdown=false;this.multiselect.updateList(c.items);this.multiselect.showDropdown()}else{this.autocomplete.options.autosuggest=c.type=="select"?null:c.autosuggesturl;this.autocomplete.options.minautowidth=c.minautowidth;this.autocomplete.options.items=c.items;this.autocomplete.updateDropdown(c.type=="select");if(c.type=="html"){j=h.firstChild.getAttribute("val")}}}}this.autocomplete.itemschanged=true;this.editor.value=j==null?"":j;if(this.options.onEditCell!=null){this.options.onEditCell(c,this.editor,this.autocomplete)}this._edit3(h,c)},_edit3:function(h,c){var g=scil.Utils.getOffset(h,true,true);var f=scil.Utils.isIE&&scil.Utils.isIE>=8||scil.Utils.isHtml5?7:0;this.editor.style.zIndex=scil.Utils.getMaxZindex();this.editor.style.left=g.x+"px";this.editor.style.top=(g.y)+"px";this.editor.style.width=(h.offsetWidth-f+2)+"px";this.editor.style.height=(h.offsetHeight-f+2)+"px";this.editor.cur=this.getCellPos(h);this.editor.style.backgroundColor="";this.editor.style.display="";this.editor.select();this.editor.focus();this.editor.weighingtag=null;if(c.readonly){this.editor.setAttribute("readonly","readonly")}else{this.editor.removeAttribute("readonly")}if(this.autocomplete!=null&&this.autocomplete.options.items!=null&&this.autocomplete.options.autosuggest==null){this.autocomplete.show()}else{if(this.datepicker!=null&&!this.datepicker.disablepopup){this.datepicker.show()}else{if(c!=null&&c.type=="mass"){this.startWeighStation()}else{if(c!=null&&c.mobiledata!=null){this.starteMobileData(c.mobiledata)}}}}},scrolltop:function(){var c=this.tbody.parentNode.scrollTop;return c>0?c:0},startWeighStation:function(){if(scil.Utils.isNullOrEmpty(scil.MobileData.weighstation)||!this.options.enablemobiledata){return}if(this.weighstation==null){var c=this;this.weighstation=new scil.MobileData(this.editor,{connectevents:false,weighstation:true,onresult:function(d){c.editor.weighingtag=d},url:scil.MobileData.getDefaultUrl(true),onstarttimer:function(){return c.isEditing()&&c.options.enablemobiledata}})}this.weighstation.start()},starteMobileData:function(c){if(!this.options.enablemobiledata){return}if(this.mobiledata==null){var d=this;this.mobiledata=new scil.MobileData(this.editor,{category:c,connectevents:false,url:scil.MobileData.getDefaultUrl(false),onstarttimer:function(){return d.isEditing()&&d.options.enablemobiledata}})}this.mobiledata.start()},isEditing:function(){return this.editor!=null&&this.editor.style.display==""},_keydown:function(c){var d=null;switch(c.keyCode){case 27:this._doneEditor(true);c.preventDefault();return;case 13:c._jssdone=true;c.preventDefault();break;case 38:d="up";c.preventDefault();break;case 40:d="down";c.preventDefault();break;case 9:d="tab"+(c.shiftKey?"-":"+");c.preventDefault();break;default:return}if(this.autocomplete.isDropdownVisible()&&(c.srcElement||c.target)==this.autocomplete.input){this.autocomplete.keyup(c)}this._doneEditor(false,d)},_doneEditor:function(g,q){var j=null;if(this.editor!=null&&this.editor.style.display==""){j=this.editor}if(j==null||j.style.display=="none"){return}if(this.weighstation!=null){this.weighstation.end()}if(this.mobiledata!=null){this.mobiledata.end()}var t=null;if(g!=true){var w=j.cur;var y=this.getCell(w.iRow,w.iCol);JSDraw2.Table._setCellNumber(y,null);var f=this.columns[w.iCol];var x=scil.Form.makeSafeHtml(scil.Utils.trim(j.value));var C=this.validateValue(f.type,x,f.regex);if(C!=null&&!scil.Utils.isNullOrEmpty(C.op)&&!f.allowqualifier){return null}var h=this.columns[w.iCol];var u=h.type=="html"?y.firstChild.getAttribute("val"):y.firstChild.innerHTML;if(C==null){if(f.errormessage!=null){scil.Utils.alert(f.errormessage)}else{scil.Utils.alert("Invalid value")}}else{t=w;if((C=="&nbsp;"||C==""?null:C)!=(u=="&nbsp;"||u==""?null:u)){if(h.type=="html"){this._setHtmlCell(h,y,C)}else{y.firstChild.innerHTML=C}if(JSDraw2.Table.isNumerColumn(h.type)){JSDraw2.ColorCoding.show(y,C,h)}this.cellChanged(w.iRow,w.iCol);if(this.columns[w.iCol].type=="salt"||this.columns[w.iCol].type=="saltlist"||this.columns[w.iCol].key=="saltratio"){for(var l=w.iCol-1;l>=0;--l){if(this.columns[l].type=="structure"){var z=this.getCell(w.iRow,l);this._updateMol(z,false);break}}}if(h.populateurl!=null){var n=this;var d={};d[h.key]=C;scil.Utils.ajax(h.populateurl,function(D){for(var c in D){n.setCellValue(w.iRow,c,D[c])}},d)}if(h.type=="mass"&&this.editor.weighingtag!=null){this.setWeighingTag(h,this.editor.weighingtag,w.iRow)}if(h.onchanged!=null){h.onchanged(w.iRow,w.iCol,this)}if(h.type=="select"&&!scil.Utils.isNullOrEmpty(h.pairto)){this.pairTo(w.iRow,w.iCol)}this.onCellChanged(w.iRow,w.iCol);JSDraw2.Table.setLastEditCell({jss:this,td:y,row:w.iRow,col:w.iCol})}else{if(C!="&nbsp;"){var A=JSDraw2.Table.parseValueUnit(C);var B=JSDraw2.Table.parseValueUnit(j.value);if(A.unit==B.unit){C=j.value;if(JSDraw2.Table.isNumerColumn(h.type)&&scil.Utils.startswith(C,".")){C="0"+C}}}if(h.type=="html"){this._setHtmlCell(h,y,C)}else{y.firstChild.innerHTML=C}}}}j.style.display="none";if(this.autocomplete!=null){this.autocomplete.hide()}if(this.datepicker!=null){this.datepicker.hide()}if(t!=null&&q!=null){var y=null;switch(q){case"up":y=this.getCell(t.iRow-1,t.iCol);break;case"down":y=this.getCell(t.iRow+1,t.iCol);break;case"tab":case"tab+":for(var l=t.iCol+1;l<this.columns.length;++l){var f=this.columns[l];if(this.isTextEditable(f)){y=this.getCell(t.iRow,l);break}}break;case"tab-":for(var l=t.iCol-1;l>=0;--l){var f=this.columns[l];if(this.isTextEditable(f)){y=this.getCell(t.iRow,l);break}}break}if(y!=null){this._editCell(y)}}},setWeighingTag:function(c,q,j){var d=q.dataid;var g=q.ip;var h=q.note;var l=q.stats;var f=q.deviceid;var n=scil.Utils.timeStr(q.dt,true);if(!scil.Utils.isNullOrEmpty(d)){this.setCellValue(j,c.key+".dataid",d)}if(!scil.Utils.isNullOrEmpty(g)){this.setCellValue(j,c.key+".ipaddress",g)}if(!scil.Utils.isNullOrEmpty(f)){this.setCellValue(j,c.key+".deviceid",f)}if(!scil.Utils.isNullOrEmpty(n)){this.setCellValue(j,c.key+".time",n)}if(!scil.Utils.isNullOrEmpty(l)){this.setCellValue(j,c.key+".stats",l)}if(!scil.Utils.isNullOrEmpty(h)){this.setCellValue(j,c.key+".note",h)}},pairTo:function(n,d){var f=this.columns[d];if(f==null||f.type!="select"||f.items==null||f.pairto==null){return}var q=f.pairto.split(",");for(var l=0;l<q.length;++l){var j=this.getColIndex(q[l]);var g=this.columns[j];if(g==null||g.type!="select"||g.items==null){continue}var t=this.getCellValue(n,d);var h=scil.Utils.indexOf(f.items,t);if(h==null||h<0){continue}var u=g.items[h];this.setCellValue(n,j,u)}},normalizeValue:function(c,d){var f=parseFloat(c);if(isNaN(f)){return null}if(d==null){return c}d=d.replace(/μ/g,"u");switch(d.toLowerCase()){case"pg":case"pl":case"pmol":f/=1000000*1000000;d=d.substr(1);break;case"ng":case"nl":case"nmol":f/=1000000*1000;d=d.substr(1);break;case"ug":case"ul":case"umol":f/=1000000;d=d.substr(1);break;case"mg":case"ml":case"mmol":case"mu":f/=1000;d=d.substr(1);break;case"g":case"l":case"mol":case"u":break;case"kg":f*=1000;d=d.substr(1);break;case"pound":case"lb":f*=453.592;d="g";case"gal":case"gallon":val*=3.78541;d="l";break;default:c+" "+d}return scil.Utils.num2str(f,this.options.decimal>0?this.options.decimal:2,d)},validateRow:function(g){if(g==null){return}for(var f=0;f<this.columns.length;++f){var d=this.columns[f];var h=g[d.key];if(typeof(h)!="string"){continue}g[d.key]=this.validateValue(d.type,h,d.regex)}},parseUnit2:function(g){var d=g;var f=null;if(g!=null){var c=g.indexOf("/");if(c>=0){d=g.substr(0,c);f=g.substr(c+1)}}return{u1:d,u2:f}},normalizeUnit:function(d,f,c){if(d==null){return null}if(f=="M"){d=d.replace(/m/g,"M")}else{if(f=="L"){d=d.replace(/l/g,"L")}}if(c!=null){d=d.replace(/u/g,"μ")}return d},validateValue:function(g,j,c){if(this.options.normalizeinput){return this.validateNomalizedValue(g,j,c)}if(j==null||JSDraw2.Table.isNA(j)){return j}var d;switch(g){case"solubility":case"density":case"float":case"int":case"mass":case"moles":case"temperature":case"hour":case"minute":case"volume":case"molar":case"pressure":case"concentration":case"concentrationratio":case"volumemass":case"massvolume":case"eu":case"euconcentration":if(g=="temperature"&&j=="rt"){return"rt"}d=JSDraw2.Table.parseValueUnit(j);break;case"percent":case"percentage":case"purity":d=JSDraw2.Table.parseValueUnit(j);if(d!=null&&d.unit!="%"){if(!isNaN(d.s)){if(d.unit!=null&&d!="%"){return null}d.unit="%"}}break;case"salt":case"saltlist":var f=JSDraw2.FormulaParser.parseSalt(j);if(f==null){return"&nbsp;"}else{return f.s}default:if(j==null||j.length==0){return"&nbsp;"}if(c!=null&&!new RegExp(c).test(j)){return null}return scil.Utils.trim(j)}if(d==null||d.value==null||isNaN(d.value)){return"&nbsp;"}if(d.unit==null){var h=this.getUnit(g);if(h!=null){d.unit=h.toLowerCase()}}switch(g){case"percent":case"percentage":case"purity":return d.s+"%";case"molar":if(d.unit!="m"&&d.unit!="mm"&&d.unit!="um"&&d.unit!="nm"){return null}return d.s+" "+(d.unit=="mm"?"mM":this.normalizeUnit(d.unit,"M","u"));case"concentration":if(d.unit=="ppm"){return d.s+" "+d.unit}if(new RegExp("^[m|u|n|p]?m$").test(d.unit)){return d.s+" "+(d.unit=="mm"?"mM":this.normalizeUnit(d.unit,"M","u"))}var h=this.parseUnit2(d.unit);if(new RegExp("^[m|u|n|p]?g$").test(h.u1)&&new RegExp("^[m]?l$").test(h.u2)){return d.s+" "+this.normalizeUnit(d.unit,"L","u")}return null;case"concentrationratio":if(d.unit=="ppm"){return d.s+" "+d.unit}if(d.unit=="% w/w"||d.unit=="% w/v"){return d.s+d.unit}var h=this.parseUnit2(d.unit);if(new RegExp("^[m|u|n|p]?g$").test(h.u1)&&new RegExp("^[m]?l$").test(h.u2)){return d.s+" "+this.normalizeUnit(d.unit,"L","u")}if(new RegExp("^[k|m|u|n|p]?g$").test(h.u1)&&new RegExp("^[k|m|u|n|p]?g$").test(h.u2)){return d.s+" "+this.normalizeUnit(d.unit,null,"u")}return null;case"mass":if(!new RegExp("^[k|m|u|n|p]?g$").test(d.unit)){return null}return d.s+" "+this.normalizeUnit(d.unit,null,"u");case"eu":if(!new RegExp("^[m]?u$").test(d.unit)){return null}return d.s+" "+d.unit.replace("u","U");case"euconcentration":var h=this.parseUnit2(d.unit);if(new RegExp("^[m]?u$").test(h.u1)&&new RegExp("^[m|u]?l$").test(h.u2)){return d.s+" "+d.unit.replace("u","U").replace("l","L")}return null;case"volume":if(!new RegExp("^[m|u|n|p]?l$").test(d.unit)){return null}return d.s+" "+this.normalizeUnit(d.unit,"L","u");case"volumemass":if(!new RegExp("^[k|m|u|n|p]?g$").test(d.unit)&&!new RegExp("^[m|u|n|p]?l$").test(d.unit)){return null}return d.s+" "+this.normalizeUnit(d.unit,"L","u");case"massvolume":if(!new RegExp("^[k|m|u|n|p]?g$").test(d.unit)&&!new RegExp("^[m|u|n|p]?l$").test(d.unit)){return null}return d.s+" "+this.normalizeUnit(d.unit,"L","u");case"moles":if(!new RegExp("^[k|m|u|n|p]?mol$").test(d.unit)){return null}return d.s+" "+this.normalizeUnit(d.unit,null,"u");case"pressure":if(d.unit=="pa"||d.unit=="kpa"||d.unit=="mpa"){return d.s+" "+d.unit.toUpperCase().replace("A","a")}else{if(d.unit=="at"||d.unit=="atm"||d.unit=="psi"){return d.s+" "+d.unit}else{if(d.unit=="bar"){return d.s+" "+d.unit}else{if(d.unit=="mmhg"){return d.s+" mmHg"}else{if(d.unit=="torr"){return d.s+" Torr"}}}}}return null;case"hour":case"minute":if(d.unit=="hr"||d.unit=="hour"||d.unit=="hours"){return d.s+" hr"}else{if(d.unit=="min"||d.unit=="minute"||d.unit=="minutes"){return d.s+" min"}else{if(d.unit=="sec"||d.unit=="second"||d.unit=="seconds"){return d.s+" sec"}else{if(d.unit=="day"||d.unit=="days"){return d.s+" day"}else{return null}}}}case"temperature":if(d.unit=="f"||d.unit=="c"){return d.s+" °"+d.unit.toUpperCase()}if(d.unit=="°f"||d.unit=="°c"){return d.s+" "+d.unit.toUpperCase()}return null;case"density":if(d.unit=="g/ml"){return d.s+" g/mL"}return null;case"solubility":if(d.unit=="ppm"){return d.s+" "+d.unit}var h=this.parseUnit2(d.unit);if(new RegExp("^[k|m|u|n|p]?g$").test(h.u1)&&new RegExp("^[m]?l$").test(h.u2)){return d.s+" "+this.normalizeUnit(d.unit,"L","u")}return null;case"int":return d.s==null?null:Math.round(d.s);case"float":return d.s;default:return null}},validateNomalizedValue:function(g,j,c){if(j==null||JSDraw2.Table.isNA(j)){return j}var d;switch(g){case"solubility":case"density":case"float":case"int":case"mass":case"moles":case"temperature":case"hour":case"minute":case"volume":case"molar":case"pressure":case"concentration":case"concentrationratio":case"volumemass":case"massvolume":d=JSDraw2.Table.parseValueUnit(j);break;case"percent":case"percentage":case"purity":d=JSDraw2.Table.parseValueUnit(j);if(d!=null&&d.unit!="%"){if(!isNaN(d.s)){if(d.unit!=null&&d!="%"){return null}d.unit="%"}}break;case"salt":case"saltlist":var f=JSDraw2.FormulaParser.parseSalt(j);if(f==null){return"&nbsp;"}else{return f.s}default:if(j==null||j.length==0){return"&nbsp;"}if(c!=null&&!new RegExp(c).test(j)){return null}return scil.Utils.trim(j)}if(d==null||d.value==null||isNaN(d.value)){return"&nbsp;"}switch(g){case"percent":case"percentage":case"purity":return d.s+"%";case"molar":if(d.unit==null){return d.s+" "+this.getUnit(g)}if(d.unit!="m"&&d.unit!="mm"&&d.unit!="um"&&d.unit!="nm"){return null}return d.s+" "+(d.unit=="mm"?"mM":d.unit.replace("m","M"));case"concentration":if(d.unit==null){return d.s+" "+this.getUnit(g)}if(d.unit=="ppm"){return d.s+" "+d.unit}if(new RegExp("^[m|u|n|p]?m$").test(d.unit)){return d.s+" "+(d.unit=="mm"?"mM":d.unit.replace("m","M"))}var h=this.parseUnit2(d.unit);if(new RegExp("^[m|u|n|p]?g$").test(h.u1)&&new RegExp("^[m]?l$").test(h.u2)){return d.s+" "+d.unit.replace("l","L")}return null;case"concentrationratio":if(d.unit==null){return d.s+" "+this.getUnit("concentration")}if(d.unit=="ppm"){return d.s+" "+d.unit}if(d.unit=="% w/w"||d.unit=="% w/v"){return d.s+d.unit}var h=this.parseUnit2(d.unit);if(new RegExp("^[m|u|n|p]?g$").test(h.u1)&&new RegExp("^[m]?l$").test(h.u2)){return d.s+" "+d.unit.replace("l","L")}if(new RegExp("^[k|m|u|n|p]?g$").test(h.u1)&&new RegExp("^[k|m|u|n|p]?g$").test(h.u2)){return d.s+" "+d.unit}return null;case"mass":if(d.unit==null){return this.normalizeValue(d.s,this.getUnit(g))}if(!new RegExp("^[k|m|u|n|p]?g$").test(d.unit)){return null}return this.normalizeValue(d.s,d.unit);case"volume":if(d.unit==null){return this.normalizeValue(d.s,this.getUnit(g))}if(!new RegExp("^[m|u|n|p]?l$").test(d.unit)){return null}return this.normalizeValue(d.s,d.unit.replace("l","L"));case"volumemass":if(d.unit==null){return this.normalizeValue(d.s,this.getUnit("volume"))}if(!new RegExp("^[k|m|u|n|p]?g$").test(d.unit)&&!new RegExp("^[m|u|n|p]?l$").test(d.unit)){return null}return this.normalizeValue(d.s,d.unit.replace("l","L"));case"massvolume":if(d.unit==null){return this.normalizeValue(d.s,this.getUnit("mass"))}if(!new RegExp("^[k|m|u|n|p]?g$").test(d.unit)&&!new RegExp("^[m|u|n|p]?l$").test(d.unit)){return null}return this.normalizeValue(d.s,d.unit.replace("l","L"));case"moles":if(d.unit==null){return this.normalizeValue(d.s,this.getUnit(g))}if(!new RegExp("^[k|m|u|n|p]?mol$").test(d.unit)){return null}return this.normalizeValue(d.s,d.unit);case"pressure":if(d.unit==null){return d.s+" "+this.getUnit(g)}else{if(d.unit=="pa"||d.unit=="kpa"||d.unit=="mpa"){return d.s+" "+d.unit.toUpperCase().replace("A","a")}else{if(d.unit=="at"||d.unit=="atm"||d.unit=="psi"){return d.s+" "+d.unit}else{if(d.unit=="bar"){return d.s+" "+d.unit}else{if(d.unit=="mmhg"){return d.s+" mmHg"}else{if(d.unit=="torr"){return d.s+" Torr"}}}}}}return null;case"hour":case"minute":if(d.unit==null){return d.s+" "+this.getUnit(g)}else{if(d.unit=="hr"||d.unit=="hour"||d.unit=="hours"){return d.s+" hr"}else{if(d.unit=="min"||d.unit=="minute"||d.unit=="minutes"){return d.s+" min"}else{if(d.unit=="sec"||d.unit=="second"||d.unit=="seconds"){return d.s+" sec"}else{if(d.unit=="day"||d.unit=="days"){return d.s+" day"}else{return null}}}}}case"temperature":if(d.unit==null){return d.s+" "+this.getUnit(g)}if(d.unit=="f"||d.unit=="c"){return d.s+" °"+d.unit.toUpperCase()}if(d.unit=="°f"||d.unit=="°c"){return d.s+" "+d.unit.toUpperCase()}return null;case"density":if(d.unit==null||d.unit=="g/ml"){return d.s+" g/mL"}return null;case"solubility":if(d.unit==null){return d.s+" "+this.getUnit(g)}if(d.unit=="ppm"){return d.s+" "+d.unit}var h=this.parseUnit2(d.unit);if(new RegExp("^[k|m|u|n|p]?g$").test(h.u1)&&new RegExp("^[m]?l$").test(h.u2)){return d.s+" "+d.unit.replace("l","L")}return null;case"int":return d.s==null?null:Math.round(d.s);case"float":return d.s;default:return null}},getUnit:function(c){if(this.options.units!=null&&this.options.units[c]!=null){return this.options.units[c]}if(JSDraw2.defaultoptions.units!=null&&JSDraw2.defaultoptions.units[c]!=null){return JSDraw2.defaultoptions.units[c]}switch(c){case"percent":case"percentage":case"purity":return"%";case"molar":return"M";case"concentration":case"concentrationratio":return"g/mL";case"mass":return"mg";case"eu":return"U";case"euconcentration":return"U/mL";case"volume":return"mL";case"pressure":return"Pa";case"hour":return"hour";case"minute":return"min";case"moles":return"mol";case"temperature":return"°C";case"density":return"g/mL";case"solubility":return"mg/mL";default:return null}},delRow:function(){if(this.currow==null){scil.Utils.alert("Please select a row first");return false}if(!confirm("Delete selected row(s)?")){return false}var g=[];if(this.options.colcheck!=null){var d=this.getColIndex(this.options.colcheck);for(var f=0;f<this.getRowCount();++f){if(scil.Utils.isTrue(this.getCellValue(f,d))){g.push(f)}}}if(g.length==0){g.push(this.currow)}if(this.options.onBeforeDelRow!=null){this.options.onBeforeDelRow(this,g.length==1?g[0]:g)}for(var f=g.length-1;f>=0;--f){this.removeRow(g[f])}this.onDelRow(g.length==1?g[0]:g);return true},removeRow:function(d){this.destroyRow(d);if(this.columns[0].type=="id"){for(var c=d;c<this.getRowCount();++c){this.getCell(c,0).firstChild.innerHTML=this.options.idasletter?scil.Utils.num2letter(c+1):(c+1)}}if(d==this.currow){this.setCurRow(null)}if(this.selectbox!=null){this.selectbox.hide()}if(this.jointable!=null){this.jointable.removeRow(d)}},destroy:function(){this.clear(true)},destroyRow:function(d){if(this.currow==d){this.setCurRow(null)}for(var c=0;c<this.getColCount();++c){var g=this.getCell(d,c);var f=g==null?null:g.jsd;if(f!=null){f.destroy()}}if(this.options.pivot){var h=this.getCell(d,0);for(var c=this.getColCount()-1;c>=1;--c){var g=this.getCell(d,c);g.parentNode.removeChild(g)}h.parentNode.removeChild(h.nextSibling);h.parentNode.removeChild(h)}else{var j=this.tbody.childNodes[d];this.tbody.removeChild(j)}},resetListItems:function(){if(this.columns==null){return}for(var f=0;f<this.columns.length;++f){var d=this.columns[f];if(d.listurl!=null&&d.listurl!=""&&d.items!=null){d.items=null}}},resetColumns:function(){this.clear(true);this.onColChange();this.createTable()},clear:function(c,f){for(var d=this.getRowCount()-1;d>=0;--d){this.destroyRow(d)}if(c){scil.Utils.removeAll(this.tbody);this.tbody=null;scil.Utils.removeAll(this.header);this.header=null;this.editor=null;this.columns=null;for(var d=0;d<this.connectHandlers.length;++d){dojo.disconnect(this.connectHandlers[d])}this.connectHandlers=[];this.div.innerHTML=""}JSDraw2.Table.setLastEditCell(null);if(f){this.resetListItems()}if(this.selectbox!=null){this.selectbox.hide()}if(this.jointable!=null){this.jointable.clear(c)}},insertAt:function(iRow,props,select,fireEvent){if(props==null){for(var i=0;i<this.columns.length;++i){var c=this.columns[i];if(c.defaultvalue!=null){if(props==null){props={}}if(typeof(c.defaultvalue)=="string"&&scil.Utils.startswith(c.defaultvalue,"javascript:")){props[c.key]=scil.Utils.eval(c.defaultvalue.substr(11))}else{if(typeof(c.defaultvalue)=="string"&&(scil.Utils.startswith(c.defaultvalue,"{date}")||scil.Utils.startswith(c.defaultvalue,"{time}"))){props[c.key]=scil.Utils.formatTime(new Date(),c.defaultvalue.substr(6))}else{props[c.key]=c.defaultvalue}}}}}this._makeRow(iRow,props);if(select!=false){this.setCurRow(iRow)}if(fireEvent){this.onAddRow(iRow)}},appendRow:function(f,d){if(f!=null&&f.length>0){for(var c=0;c<f.length;++c){this.insert("end",f[c],null,null,d)}}else{return this.insert("end",f,null,null,d)}},addRow:function(f,d){if(f!=null&&f.length>0){for(var c=0;c<f.length;++c){this.insert(null,f[c],null,null,d)}}else{return this.insert(null,f,null,null,d)}},insert:function(c,j,n,d,h){if(h!=null&&j!=null){var l={};for(var g in h){l[h[g]]=j[g]}scil.apply(j,l)}var f=null;if(c=="begin"){f=0}else{if(c=="end"){f=this.getRowCount()}else{if(c){if(this.currow!=null&&this.currow>=0){f=this.currow}else{f=0}}else{if(this.currow!=null&&this.currow+1<=this.getRowCount()){f=this.currow+1}else{f=this.getRowCount()}}}}this.insertAt(f,j,n,d);return f},dblclick:function(c){var d=c.target||c.srcElement;if(d==null){return}if(d.tagName=="DIV"){d=d.parentNode}this._doneEditor(false);this._editCell(d)},isTextEditable:function(c){return c!=null&&!c.ishidden&&c.viewonly!=true&&c.type!="id"&&c.type!="checkbox"&&c.type!="radio"&&c.type!="file"&&c.type!="subform"&&c.type!="filelink"&&c.type!="filedblink"&&c.type!="filepath"&&c.type!="hidden"&&c.type!="image"&&c.type!="tabtext"&&c.type!="richtext"&&c.type!="plaintext"&&c.type!="sketches"},_editCell:function(f){var d=this.getCellPos(f);if(f.tagName=="TD"&&f.jsd==null){var c=this.columns[d.iCol];if(this.isTextEditable(c)){this._edit(f,c)}}},click:function(c){var f=c.target||c.srcElement;var h=null;var j=this.options.pivot?"TD":"TR";while(f!=null){if(f.tagName=="TABLE"){break}if(f.tagName==j){h=f;break}f=f.parentNode}if(h==null){return}var g=h.parentNode;for(var d=this.options.pivot?1:0;d<g.childNodes.length;++d){if(g.childNodes[d]==h){this.setCurRow(this.options.pivot?(d-1):d);break}}},setCurRow:function(d){if(d==this.currow){return}if(this.options.pivot){this.setRowStyle(this.currow,"backgroundColor","")}else{JSDraw2.Table.setCurrentRow(this,d)}var c=scil.App.config!=null&&scil.App.config.button!=null?scil.App.config.button:JSDraw2.Skin.jssdf.rowcolor;if(this.setRowStyle(d,"backgroundColor",c)){var f=this.currow;this.currow=d;if(this.options.onselectrow!=null){this.options.onselectrow(this,d,f)}}else{this.currow=null}},isRowVisible:function(c){if(c==null||c<0||c>=this.getRowCount()){return false}if(this.options.pivot){return this.getCell(c,0).style.display!="none"}else{return this.tbody.childNodes[c].style.display!="none"}},setRowStyle:function(d,f,l){if(d==null||d<0||d>=this.getRowCount()){return false}if(this.options.pivot){var h=this.getCell(d,0);h.style[f]=l;h.nextSibling.style[f]=l;for(var c=1;c<this.getColCount();++c){var g=this.getCell(d,c);if(g.jsd!=null&&f=="backgroundColor"){g.jsd.div.style.backgroundColor=l}else{g.style[f]=l}}}else{var j=this.tbody.childNodes[d];j.style[f]=l;for(var c=0;c<j.childNodes.length;++c){var g=j.childNodes[c];if(g.jsd!=null&&f=="backgroundColor"){g.jsd.div.style.backgroundColor=l}}}return true},setSize:function(u){if(this.options.grid){return}if(this.options.pivot){var t=0;var j=this.header.childNodes.length/2;if(t==null||t<=0){t=j;for(var f=0;f<this.header.childNodes.length/2;++f){t+=scil.Utils.parsePixel(this.header.childNodes[f*2].firstChild.style.width)+4}}if(!(t>0)){return false}var q=0;var l=u/t;for(var f=0;f<this.header.childNodes.length/2;++f){if(f==this.header.childNodes.length/2-1){t=u-j-q}else{t=(scil.Utils.parsePixel(this.header.childNodes[f*2].firstChild.style.width)+3)*l}this.setColWidth(f,t>=80?t:80);q+=t}this.options.width=u;return l}else{var t=this.tbody==null?0:this.tbody.offsetWidth;if(t==null||t<=0){t=this.columns.length;for(var f=0;f<this.columns.length;++f){var d=this.columns[f];if(d.type!="hidden"&&!d.ishidden){t+=this.columns[f].width}}}if(!(t>0)){return false}var h=-1;for(var f=this.columns.length-1;f>=0;--f){var d=this.columns[f];if(d.type!="hidden"&&!d.ishidden){h=f;break}}var g=this.columns[0].type=="id"?this.columns[0]:null;var l=g==null?u/t:(u-g.width)/(t-g.width);var q=1+(g==null?0:g.width);for(var f=(g==null?0:1);f<=h;++f){var d=this.columns[f];if(d.type!="hidden"&&!d.ishidden){if(f==h){t=u-this.columns.length-q}else{t=Math.round(d.width*l)-1}this.setColWidth(f,t);q+=t}}this.options.width=u;return l}}});scil.apply(JSDraw2.Table,{univid:0,kMobileDataInterval:500,kMobileDataMaxCount:240,kLastEditColor:"#afa",kAllColumns:["","checkbox","density","date","float","int","mass","mf","molar","moles","mw","eu","euconcentration","radio","select","smiles","structure","temperature","hour","minute","text","percent","volume","pressure","image","subform","file","filelink","filedblink","filepath","tabtext","richtext","plaintext","sketches","massvolume","volumemass"],kNumberColumns:["density","solubility","float","int","mass","molar","ppm","concentration","concentrationratio","eu","euconcentration","massvolume","volumemass","moles","mw","temperature","hour","minute","percent","volume","pressure","purity"],_standardUnits:{density:"g/L",solubility:"g/L",mass:"g",molar:"M",moles:"mol",temperature:"°C",hour:"hr",minute:"min",percent:"%",purity:"%",volume:"L",pressure:"Pa"},kDefaultUnits:{density:"g/mL",solubility:"g/L",mass:"g",molar:"M",moles:"mol",temperature:"°C",hour:"hr",minute:"min",percent:"%",purity:"%",volume:"L",massvolume:"g",volumemass:"mL",pressure:"Pa",eu:"U"},isNumerColumn:function(c){return c!=null&&scil.Utils.indexOf(JSDraw2.Table.kNumberColumns,c)>=0},get:function(c){if(JSDraw2.Table._allitems==null){JSDraw2.Table._allitems={}}return JSDraw2.Table._allitems[c]},toSdf:function(j,d,g){var n="";if(scil.Utils.isNullOrEmpty(j)){n+="\n[No Structure]\n\n  0  0  0  0  0  0  0  0  0  0  1 V2000\nM  END\n"}else{n+=j}if(d!=null){for(var h in d){var f=scil.Utils.trim(h);if(scil.Utils.isNullOrEmpty(f)){continue}n+="> <"+f+">\n";var l=scil.Utils.trim(d[h]);n+=(l==null||l=="&nbsp;"?"":l)+"\n";n+="\n"}}n+="$$$$\n";return n},splitUnit:function(f){if(f==null||f=="&nbsp;"){return null}f=scil.Utils.trim(f+"");if(f.length==0){return null}if(f.substr(0,1)=="."){f="0"+f}var d=null;var g=f.replace(/^(([>|<][=]?)|[≥|≤])/,"");if(f.length>g.length){d=f.substr(0,f.length-g.length);if(d==">="){d="≥"}else{if(d=="<="){d="≤"}}f=scil.Utils.trim(g)}var j=null;var h=null;var c=f.replace(/[a-z|μ|\/|%|°]+$/i,"");if(c!=f){j=f.substr(c.length);h=j.replace(/μ/g,"u").toLowerCase();c=scil.Utils.trim(c)}if((h=="w/w"||h=="w/v")&&scil.Utils.endswith(c,"%")){c=c.substr(0,c.length-1);j=h="% "+h}if(h=="%w/w"){j=h="% w/w"}else{if(h=="%w/v"){j=h="% w/v"}}return{op:d,value:scil.Utils.trim(c),unit:h,unit2:j}},getValueWithoutUnit:function(c,h){var g=JSDraw2.Table.splitUnit(c);if(g==null||g.value==null||isNaN(g.value)){return null}var j=parseFloat(g.value);if(scil.Utils.isNullOrEmpty(g.unit)||scil.Utils.isNullOrEmpty(h)||g.unit==h){return j}var d=this.parseValue(1+g.unit);var f=this.parseValue(1+h);return j*d/f},parseValueUnit:function(d){var c=JSDraw2.Table.splitUnit(d);if(c==null){return null}var f=c.value==null||scil.Utils.endswith(c.value,"%")?null:parseFloat(c.value);return{op:c.op,value:f==null||isNaN(f)?null:f,s:c.op==null?c.value:c.op+c.value,unit:c.unit}},parseValue:function(d){var c=JSDraw2.Table.parseValueUnit(d);if(c==null||c.value==null){return null}var f=c.value;switch(c.unit){case"u/ul":f*=1000000;break;case"kg":case"kmol":case"kpa":case"g/ml":case"u/ml":case"kg/l":f*=1000;break;case"mpa":f*=1000000;break;case"pound":case"lb":f*=453.592;break;case"gal":case"gallon":f*=3.78541;break;case"mg":case"ml":case"mmol":case"mm":case"ug/ml":case"mg/l":case"mu/l":case"g/kg":case"mg/g":case"ug/mg":f/=1000;break;case"ppm":f/=1000;break;case"ul":case"ug":case"umol":case"um":case"ng/ml":case"ug/l":case"mg/kg":case"ug/g":f/=1000000;break;case"nm":case"ng":case"nmol":case"nl":case"ng/l":case"pg/ml":case"ng/g":case"ug/kg":f/=1000000000;break;case"pg":case"pmol":case"pl":case"pm":case"pg/g":case"ng/kg":f/=1000000000*1000;break;case"%":case"% w/w":f/=100;break;case"% w/v":f*=10;break;case"min":case"minute":case"minutes":f/=60;break;case"sec":case"second":case"seconds":f/=3600;break;case"at":f*=98066.5;break;case"atm":f*=101325;break;case"psi":f*=6894.8;break;case"mmhg":f*=133.322365;break;case"bar":f*=100000;break;case"torr":f*=133.322;break}return f},formatValue:function(g,f,c,d){if(g!=null&&typeof(g)=="number"){return scil.Utils.num2str(g,c>=0?c:2,f,true,d)}else{return g}},getKeywords:function(w){if(w==null||w.length==0){return null}var x="+-*/()[]=!><&|?, ";var y={};var z="";for(var g=0;g<w.length;++g){var d=w.substr(g,1);if(d=="@"&&z.length==0){var u=0;var q=0;for(var l=g+1;l<w.length;++l){var f=w.substr(l,1);if(f=="("){++u}else{if(f==")"){--u;if(u==0){y[w.substr(g,l-g+1)]=true;g=l;break}}else{if(f=="["){++q}else{if(f=="]"){--q;if(q==0){y[w.substr(g,l-g+1)]=true;g=l;break}}}}}}continue}if(x.indexOf(d)>=0){if(z.length>0){if(z.length>1&&z.substr(0,1)=="$"){y[z.substr(1)]="$"}else{y[z]=true}}z=""}else{z+=d}}if(z.length>0){if(z.length>1&&z.substr(0,1)=="$"){y[z.substr(1)]="$"}else{y[z]=true}}return y},connect:function(n,g,d,c,f){var h=JSDraw2.Table.get(n);if(h!=null){var l=g.indexOf("(");var j=JSDraw2.Table.getKeywords(g.substr(l));h.connectors.push({keywords:j,connected:d,column:c})}else{if(f!=false){JSDraw2.Table._deferedConnectors.push({table:n,formula:g,connected:d,column:c})}}},readXmlRow:function(x,l){var q=null;var A={};var z={};var h={};var d={};var c=scil.Utils.getElements(x,"i");for(var j=0;j<c.length;++j){var t=c[j];var w=t.getAttribute("n");var B=t.getAttribute("v");var y=t.getAttribute("num");var f=t.getAttribute("e");var g=scil.Utils.isTrue(t.getAttribute("edit"));if(B==null){var u=scil.Utils.firstElement(t);if(u==null){B=t.text||t.textContent}else{if(scil.Utils.isIE&&scil.Utils.isIE<9){B=scil.Utils.getInnerXml(u)}else{B=u}}}if(l!=null&&l[w]!=null){w=l[w]}A[w]=B;z[w]=y;h[w]=g;if(f!=null){d[w]=f}}A.__nums=z;A.__edits=h;A.__changes=d;return A},readXmlColumns:function(u){var q=scil.Utils.getChildXmlElements(u,"col");if(q==null||q.length==0){return null}var t=[];for(var y=0;y<q.length;++y){var n=q[y];var z=n.getAttribute("key");var l=n.getAttribute("caption");var x=n.getAttribute("formula");var B=n.getAttribute("type");var f=n.getAttribute("bgcolor");var g=n.getAttribute("bgheadercolor");var h=n.getAttribute("bordercolor");var d=scil.Utils.isTrue(n.getAttribute("allowqccurve"));var D=n.getAttribute("w");var C=scil.Utils.isTrue(n.getAttribute("viewonly"));var E=D==null||isNaN(D)?null:parseInt(D);var j={key:z,caption:l,type:B,width:E,viewonly:C,formula:x,bgcolor:f,bgheadercolor:g,bordercolor:h,allowqccurve:d};if(B=="select"){var A=n.getAttribute("items");if(A!=null){j.items=A.split(",")}}else{if(B=="html"){j.html=n.getAttribute("html")}}t.push(j)}return t},readSdfRecord:function(l,h){if(l.substr(0,1)=="\n"){l=l.substr(1)}else{if(l.substr(0,2)=="\r\n"){l=l.substr(2)}}var d=l.indexOf("\nM  END");if(d<0){d=l.indexOf("\nM END")}if(d<0){return null}var f=l.indexOf("\n",d+1);var c=f<0?l:l.substr(0,f);var j=f<0?null:l.substr(f+1);var g=h?JSDraw2.Table.readProps(j):null;return{molfile:c,props:g}},readProps:function(j){var h={};if(j==null){return h}var l=j.split("\n");for(var c=0;c<l.length;++c){j=l[c];var d=null;var q=null;if(j.substr(0,1)==">"){var f=j.indexOf("<",1);if(f>0){++f;var g=j.indexOf(">",f);if(g>0){d=j.substr(f,g-f)}}for(++c;c<l.length;++c){j=l[c];if(scil.Utils.trim(j).length==0){break}if(q==null){q=j}else{q+=j}}}if(d!=null){h[scil.Utils.trim(d)]=scil.Utils.trim(q)}}return h},splitRdf:function(l){if(l==null||!scil.Utils.startswith(l,"$RDFILE ")){return null}var f=null;if(l.indexOf("\n")>=0){f=l.split("\n")}else{f=l.split("|")}var h=[];var g=null;var j={};for(var c=0;c<f.length;++c){l=f[c];if(scil.Utils.startswith(l,"$MFMT")||scil.Utils.startswith(l,"$RFMT")){if(g!=null){h.push({molfile:g,props:j})}++c;g=f[c];j={};while(c+1<f.length){if(scil.Utils.startswith(f[c+1],"$")){if(!scil.Utils.startswith(f[c+1],"$RXN")&&!scil.Utils.startswith(f[c+1],"$MOL")){break}}++c;g+="\n"+f[c]}}else{if(scil.Utils.startswith(l,"$DTYPE")&&scil.Utils.startswith(f[c+1],"$DATUM")){var d=l.substr(7);var n=f[c+1].substr(7);++c;while(c+1<f.length&&!scil.Utils.startswith(f[c+1],"$")){++c;n+="\n"+f[c]}j[d]=n}}}if(g!=null){h.push({molfile:g,props:j})}return h},setLastEditCell:function(c){if(this.showlastedit==false){return}if(this.lastedit==null&&c==null||this.lastedit!=null&&c!=null&&this.lastedit.td==c.td){return}if(this.lastedit!=null){this.lastedit.td.style.background=this.lastedit.oldbackground}this.lastedit=c;if(c!=null){c.oldbackground=c.td.style.background;c.td.style.background=this.kLastEditColor;JSDraw2.Table._setCellEdit(c.td,true)}},init:function(f,d,c){scil.onload(function(){new JSDraw2.Table(f,d,c)})},delCheckedRows:function(f,c){var h=[];for(var d=0;d<f.getRowCount();++d){var g=f.getCellValue(d,c);if(scil.Utils.isTrue(g)){h.push(d)}}if(h.length==0){return}scil.Utils.confirmYes("Delete checked row(s)",function(){for(var j=h.length-1;j>=0;--j){f.removeRow(h[j])}})},_setCellNumber:function(d,c){if(d.firstChild==null){return}if(scil.Utils.isNullOrEmpty(c)){d.firstChild.removeAttribute("__num")}else{d.firstChild.setAttribute("__num",c);this._setCellEdit(d,false)}},_getCellNumber:function(c){return c==null||c.firstChild==null?null:c.firstChild.getAttribute("__num")},_setCellEdit:function(d,c){if(d.firstChild==null||JSDraw2.Table.editedcolor==null){return}if(c){d.firstChild.setAttribute("__edit","1")}else{d.firstChild.removeAttribute("__edit")}d.firstChild.style.color=c?JSDraw2.Table.editedcolor:null},_getCellEdit:function(c){return c==null||c.firstChild==null?false:c.firstChild.getAttribute("__edit")=="1"},setCurrentRow:function(d,c){if(this.current!=null&&this.current.irow!=null){if(!this.current.jss.options.pivot&&this.current.jss.tbody!=null){this.current.jss.setRowStyle(this.current.irow,"backgroundColor","");this.current.jss.currow=null}}this.current=d==null||c==null?null:{jss:d,irow:c}},rows2Xml:function(g){var h="<jssdf version='1.1'>";for(var c=0;c<g.length;++c){var f=g[c];h+="<r>";for(var d in f){h+="<i n='"+scil.Utils.escXmlValue(d)+"'>"+scil.Utils.escXmlValue(f[d])+"</i>"}h+="</r>"}return h+="</jssdf>"},xml2Rows:function(l,f){var c=null;if(typeof l=="object"){c=l}else{if(typeof l=="string"){c=scil.Utils.parseXml(l)}}if(c==null){return null}var j=[];var g=scil.Utils.getChildXmlElements(c,"r");for(var d=0;d<g.length;++d){var h=JSDraw2.Table.readXmlRow(g[d],f);if(h!=null){j.push(h)}}return j},isNA:function(c){if(typeof(c)!="string"){return false}return c=="-"||c=="n/a"||c=="N/A"},addCssStyles:function(){if(this.cssstyleadded){return}this.cssstyleadded=true;var d=window.document.styleSheets[0];try{d.insertRule(".jsdrawtable::-webkit-scrollbar {width:5px;}",d.cssRules.length);d.insertRule(".jsdrawtable::-webkit-scrollbar-button{background:#888;height:0}",d.cssRules.length);d.insertRule(".jsdrawtable::-webkit-scrollbar-track-piece{background:#eee}",d.cssRules.length);d.insertRule(".jsdrawtable::-webkit-scrollbar-thumb{background:#888;}",d.cssRules.length)}catch(c){}}});JsSDF=JSDraw2.Table;JSDraw2.Table.SelectBox=scil.extend(scil._base,{constructor:function(c){this.jss=c;this.box=null;this.handle=null;this.dragmode=null;this.range=null;this.rect=null;this.zindex=0;this.delta=null;this.box={top:scil.Utils.createElement(document.body,"div",null,{display:"none",position:"absolute",height:"1px",borderTop:"solid 1px blue"}),right:scil.Utils.createElement(document.body,"div",null,{display:"none",position:"absolute",width:"1px",borderRight:"solid 1px blue",borderTop:"none",borderLeft:"none"}),bottom:scil.Utils.createElement(document.body,"div",null,{display:"none",position:"absolute",height:"1px",borderBottom:"solid 1px blue"}),left:scil.Utils.createElement(document.body,"div",null,{display:"none",position:"absolute",width:"1px",borderLeft:"solid 1px blue"})};this.handle=scil.Utils.createElement(document.body,"div",null,{display:"none",position:"absolute",width:"5px",height:"5px",background:"blue",border:"solid 1px #fff",cursor:"move"});this.copybox=scil.Utils.createElement(document.body,"div",null,{display:"none",position:"absolute",border:"solid 1px blue"});scil.Utils.unselectable(this.box.top);scil.Utils.unselectable(this.box.right);scil.Utils.unselectable(this.box.bottom);scil.Utils.unselectable(this.box.right);scil.Utils.unselectable(this.handle);scil.Utils.unselectable(this.copybox);var d=this;dojo.connect(document,"onmousedown",function(f){d.mousedown(f)});dojo.connect(document,"onmousemove",function(f){d.mousemove(f)});dojo.connect(document,"onmouseup",function(f){d.mouseup(f)});dojo.connect(document,"onkeydown",function(f){d.keydown(f)});dojo.connect(document,"onscrollinside",function(f){d.hide()});scil.connect(document,"onpaste",function(f){if(d.paste(f)){f.preventDefault()}})},viewonly:function(){return this.jss.options.viewonly||this.jss.options.selectboxviewonly},getRange:function(){var c=Math.min(this.range.c1,this.range.c2);var d=Math.max(this.range.c1,this.range.c2);var f=Math.min(this.range.r1,this.range.r2);var g=Math.max(this.range.r1,this.range.r2);return{c1:c,r1:f,c2:d,r2:g}},click:function(c){},del:function(){if(!this.canEdit()){return}var g=this.getRange();for(var d=g.c1;d<=g.c2;++d){if(!this.isColEditable(d)){continue}for(var f=g.r1;f<=g.r2;++f){var h=this.jss.getCellValue(f,d);if(!scil.Utils.isNullOrEmpty(h)){this.jss.setCellValue(f,d,null);if(this.jss.options.onCellChanged!=null){this.jss.options.onCellChanged(f,d,this.jss)}}}}},cut:function(c){if(!this.canEdit()){return}if(c!=null){c.preventDefault()}this.copy();this.del()},copy:function(g){if(!this.isvisible()||this.isDlgVisible()){return false}if(g!=null){g.preventDefault()}var l="";var j=this.getRange();for(var h=j.r1;h<=j.r2;++h){for(var d=j.c1;d<=j.c2;++d){var f=this.jss.columns[d];if(f!=null&&(f.type=="hidden"||f.ishidden)){continue}if(d>j.c1){l+="\t"}var n=this.jss.getCellValue(h,d,false,true,true);l+=(n==null?"":n)}l+="\n"}if(l!=""){scil.Clipboard.copy(l)}return true},isColEditable:function(d){var f=this.jss.columns[d];if(f==null||f.viewonly||f.type=="id"||f.type=="hidden"||f.ishidden){return false}return true},paste:function(l){if(!this.canEdit()){return false}if(l!=null&&l.clipboardData!=null){l=l.clipboardData.getData("text/plain")}if(scil.Utils.isNullOrEmpty(l)){return false}var j=this.getRange();var h=l.replace(/[\r][\n]/g,"\n").replace(/[\r]/g,"\n").split("\n");for(var f=h.length-1;f>=0;--f){if(h[f]==""){h.splice(f,1)}}if(j.r1==j.r2&&j.c1==j.c2){var n=h[0].split("\t");if(h.length>1&&n.length>0||h.length>0&&n.length>1){j.r2=j.r1+h.length-1;j.c2=j.c1+n.length-1;if(j.r2>=this.jss.getRowCount()){j.r2=this.jss.getRowCount()-1}if(j.c2>=this.jss.getColCount()){j.c2=this.jss.getColCount()-1}this.select(j)}}for(var f=0;f<h.length;++f){if(j.r1+f>j.r2){break}var g=0;var n=h[f].split("\t");for(var d=j.c1;d<=j.c2;++d){if(g>=n.length){break}if(!this.isColEditable(d)){continue}var q=this.jss.getCellValue(f+j.r1,d);if(q!=n[g]){this.jss.setCellValue(f+j.r1,d,n[g]);if(this.jss.options.onCellChanged!=null){this.jss.options.onCellChanged(f+j.r1,d,this.jss)}}++g}}return true},getCellRect:function(f,c){var g=this.jss.getCell(f,c);if(g==null){return null}var d=scil.Utils.getOffset(g,true,true);return new JSDraw2.Rect(d.x,d.y,g.offsetWidth-1,g.offsetHeight-1)},showCopybox:function(q,f){var j=this.getRange();var c=j.c1;var d=j.c2;var l=j.r1;var n=j.r2;var g=0;if(f<c){g=f-c}else{if(f>d){g=f-d}}var h=0;if(q<l){h=q-l}else{if(q>n){h=q-n}}if(this.jss.options.copymode=="column"){f=d;g=0}else{if(Math.abs(h)>=Math.abs(g)){f=d;g=0}else{q=n;h=0}}if(this.delta!=null&&this.delta.dcol==g&&this.delta.drow==h){return}this.delta={dcol:g,drow:h};var j=this.getCellRect(q,f);j.union(this.rect);dojo.style(this.copybox,{left:j.left+"px",top:j.top+"px",width:j.width+"px",height:j.height+"px",zIndex:this.zindex+3,display:""})},hide:function(c){if(this.box==null){return}if(c!=null){c.preventDefault()}this.range=null;this.box.top.style.display="none";this.box.right.style.display="none";this.box.bottom.style.display="none";this.box.left.style.display="none";this.handle.style.display="none"},isvisible:function(){return this.box!=null&&this.box.top.style.display!="none"&&this.range!=null},canEdit:function(){return this.isvisible()&&!this.viewonly()&&!this.isDlgVisible()},select:function(c){if(this.range==c){return}if(this.range!=null&&this.range.c1==c.c1&&this.range.r1==c.r1&&this.range.c2==c.c2&&this.range.r2==c.r2){return}this.range=c;this.redraw()},redraw:function(){if(this.range==null){this.hide();return}this.rect=this.getCellRect(this.range.r1,this.range.c1);if(this.range.c2!=this.range.c1||this.range.r2!=this.range.r1){var c=this.getCellRect(this.range.r2,this.range.c2);this.rect.union(c)}this.zindex=scil.Utils.getZindex(this.jss.tbody.parentNode);dojo.style(this.box.top,{left:this.rect.left+"px",top:this.rect.top+"px",width:this.rect.width+"px",zIndex:this.zindex+1,display:""});dojo.style(this.box.right,{left:this.rect.right()+"px",top:this.rect.top+"px",height:this.rect.height+"px",zIndex:this.zindex+1,display:""});dojo.style(this.box.bottom,{left:this.rect.left+"px",top:this.rect.bottom()+"px",width:this.rect.width+"px",zIndex:this.zindex+1,display:""});dojo.style(this.box.left,{left:this.rect.left+"px",top:this.rect.top+"px",height:this.rect.height+"px",zIndex:this.zindex+1,display:""});dojo.style(this.handle,{left:(this.rect.right()-2)+"px",top:(this.rect.bottom()-2)+"px",zIndex:this.zindex+2,display:""})},keydown:function(c){if(this.jss.options.keyboardshortcuts==false||!this.isvisible()||this.jss.isEditing()){return false}switch(c.keyCode){case 13:if(!c._jssdone){this.enterValue(c)}break;case 67:case 99:if(c.ctrlKey||c.metaKey){this.copy(c)}break;case 88:case 120:if(c.ctrlKey||c.metaKey){this.cut(c)}break;case 8:case 46:this.del(c);break;case 27:this.hide(c);break}},mousedown:function(d){var g=d.srcElement||d.target;this.dragmode=null;if(g==this.handle){if(!this.viewonly()){this.dragmode="copy"}}else{if(!scil.Utils.isChildOf(g,this.jss.div)&&g!=this.box.left&&g!=this.box.top&&g!=this.box.right&&g!=this.box.bottom){var c=scil.Dialog.getDialog(g);if(c==null||c.owner!=this){this.hide()}}else{this.dragmode="select";var f=this.jss.getCellPosByScreen(d.clientX,d.clientY);if(f!=null){this.select({r1:f.iRow,c1:f.iCol,r2:f.iRow,c2:f.iCol})}}}},mousemove:function(c){if(this.dragmode=="copy"){if(!this.viewonly()){var d=this.jss.getCellPosByScreen(c.clientX,c.clientY);if(d!=null){this.showCopybox(d.iRow,d.iCol)}}}else{if(this.dragmode=="select"&&this.range!=null){var d=this.jss.getCellPosByScreen(c.clientX,c.clientY);if(d!=null){this.select({r1:this.range.r1,c1:this.range.c1,r2:d.iRow,c2:d.iCol})}}}},mouseup:function(c){if(this.dragmode=="copy"&&this.delta!=null){this._duplicate(this.delta,c.shiftKey)}this.dragmode=null;this.copybox.style.display="none"},enterValue:function(c){if(!this.canEdit()){return}var f=this.getRange();if(f==null){return false}c.preventDefault();var d=this;this.manipulate("Manipulate Values",function(g,h){d.enterValue2(f,g,h)},null,true)},enterValue2:function(j,h,q){switch(h){case"divide":case"times":case"plus":case"minus":q=parseFloat(q);if(q==null||isNaN(q)){scil.Utils.alert("Value should be a number");return}break;case"ln":case"log":if(!scil.Utils.isNullOrEmpty(q)){scil.Utils.alert("Value should be blank");return}break;case"set":break}var f=this.jss.options.decimal>0?this.jss.options.decimal:4;for(var g=j.r1;g<=j.r2;++g){for(var d=j.c1;d<=j.c2;++d){var l=this.jss.getCellValue(g,d);if(h=="set"){if(l!=q){this.jss.setCellValueWithEvent(g,d,q)}}else{var n=l;l=parseFloat(l);if(!isNaN(l)){switch(h){case"divide":l/=q;break;case"times":l*=q;break;case"plus":l+=q;break;case"minus":l-=q;break;case"ln":l=Math.log(l);break;case"log":l=scil.Utils.log10(l);break}l=scil.Utils.roundStr(l,f);if(l!=n){this.jss.setCellValueWithEvent(g,d,l)}}}}}},detectPattern:function(g,c,f,j,l,n){if(j==l){return null}var h=[];for(var d=j;d<=l;++d){var q=c=="col"?g.getCellValue(d,f):g.getCellValue(f,d);if(scil.Utils.isNullOrEmpty(q)){return null}h.push(q)}var q=h[0];var t=q.replace(/[0-9]+([.][0-9]+)?$/,"");if(t==""){return this.detectPattern2(h,"","",n)}else{if(q!=t){for(var d=0;d<h.length;++d){if(scil.Utils.startswith(h[d],t)){h[d]=h[d].substr(t.length)}else{return null}}return this.detectPattern2(h,t,"",n)}else{t=q.replace(/^[0-9]+([.][0-9]+)?/,"");if(q!=t){for(var d=0;d<h.length;++d){if(scil.Utils.endswith(h[d],t)){h[d]=h[d].substr(0,q.length-t.length)}else{return null}}return this.detectPattern2(h,"",t,n)}}}return null},detectPattern2:function(j,q,x,w){for(var h=1;h<j.length;++h){if(!new RegExp("^[0-9]+([.][0-9]+)?$").test(j[h])){return null}}var g=w?this.round(parseFloat(j[1])/parseFloat(j[0])):this.round(parseFloat(j[1])-parseFloat(j[0]));if(g==0||!isFinite(g)||isNaN(g)){return null}for(var h=2;h<j.length;++h){var c=w?this.round(parseFloat(j[h])-parseFloat(j[h-1])):this.round(parseFloat(j[h])-parseFloat(j[h-1]));if(!isFinite(c)||isNaN(c)||c!=g){return null}}var l=null;var f=null;var u=j[0];if(u.indexOf(".")>=0&&u.substr(u.length-1,1)=="0"){f=u.substr(u.indexOf(".")+1).length}else{if(u.substr(0,1)=="0"){l=u.length}}var t={prefix:q,suffix:x,start:parseFloat(j[0]),n:l,decimal:f};if(w){t.times=g}else{t.delta=g}return t},round:function(c){return scil.Utils.roundStr(c,4,false)},nextValue:function(d,c){var f;if(d.delta!=null){f=this.round(d.start+d.delta*c)}else{if(d.times!=null){f=this.round(d.start*Math.pow(d.times,c))}else{return d.start}}if(d.decimal>0){f=scil.Utils.roundStr(f,d.decimal,true)}else{if(d.n>0&&!scil.Utils.isNullOrEmpty(d.prefix)){f=scil.Utils.padLeft(f+"",d.n,"0")}}return d.prefix+f+d.suffix},_duplicate:function(j,A){if(this.viewonly()){return}var u=this.getRange();var f=u.c1;var g=u.c2;var w=u.r1;var x=u.r2;if(j.drow!=0){var q=x-w+1;for(var d=f;d<=g;++d){if(!this.isColEditable(d)){continue}var t=this.detectPattern(this.jss,"col",d,w,x,A);for(var l=0;l<Math.abs(j.drow);++l){var u=(j.drow>0?x+l+1:w-l-1);var y=j.drow>0?w+(l%q):x-(l%q);var B;if(t==null){B=this.jss.getCellValue(y,d,true)}else{B=this.nextValue(t,u-w)}var z=this.jss.getCellValue(u,d,true);if(B!=z){this.jss.setCellValue(u,d,B);if(this.jss.options.onCellChanged!=null){this.jss.options.onCellChanged(u,d,this.jss)}}}}if(j.drow>0){x+=j.drow}else{w+=j.drow}this.select({r1:w,c1:f,r2:x,c2:g})}else{if(j.dcol!=0){var q=g-f+1;for(var u=w;u<=x;++u){var t=this.detectPattern(this.jss,"row",u,f,g,A);for(var l=0;l<Math.abs(j.dcol);++l){var d=(j.dcol>0?g+l+1:f-l-1);if(!this.isColEditable(d)){continue}var h=j.dcol>0?f+(l%q):g-(l%q);var B;if(t==null){B=this.jss.getCellValue(u,h,true)}else{B=this.nextValue(t,d-f)}var z=this.jss.getCellValue(u,d,true);if(B!=z){this.jss.setCellValue(u,d,B);if(this.jss.options.onCellChanged!=null){this.jss.options.onCellChanged(u,d,this.jss)}}}}if(j.dcol>0){g+=j.dcol}else{f+=j.dcol}this.select({r1:w,c1:f,r2:x,c2:g})}}},isDlgVisible:function(){return this.opDlg!=null&&this.opDlg.isVisible()},manipulate:function(d,c,f,j){if(this.opDlg==null){var h=this;var g={op:{label:"Operator",type:"select",items:{"":"",set:"Overwrite",plus:"+",minus:"-",divide:"&divide;",times:"&times;",log:"log()",ln:"ln()"}},val:{label:"Value",width:300}};this.opDlg=scil.Form.createDlgForm("Manipulate Values",g,{label:"Continue",onclick:function(){h.manipulate2()}})}this.opDlg.show2({title:d,owner:this});this.opDlg.callback=c;this.opDlg.form.setData({})},manipulate2:function(){var c=this.opDlg.form.getData();this.opDlg.hide();this.opDlg.callback(c.op,c.val)}});JSDraw2.FormulationTable=scilligence.extend(scilligence._base,{constructor:function(d,c){this.batchtable=null;this.ingredienttable=null;this.ingredients=[];this.options=null;if(typeof(d)=="string"){d=dojo.byId(d)}if(c==null){c={}}this.options=c;if(c.ingredientRoles==null){c.ingredientRoles=["","Active Ingredient","Excipient","Salt","Solvent"]}var f=c.width;if(!(f>0)){f=800}scilligence.Utils.createElement(d,"div","Batch:");this.createMain(d,c,f);scilligence.Utils.createElement(d,"div","Ingredients:");this.createTable(d,c,f)},createMain:function(h,g,l){var c=[{key:"name",caption:"Batch Name",width:l*0.2},{key:"amount",caption:"Amount",type:"volume",width:l*0.15},{key:"actualamount",caption:"Actual Amount",type:"volume",width:l*0.15},{key:"percentage",viewonly:true,caption:"Theor. %",type:"percent",width:l*0.1,formula:"scilligence.Utils.num2str(actualamount/amount, 2, '%')"},{key:"lot",caption:"Lot #",width:l*0.1},{key:"notes",caption:"Description",width:l*0.3}];var f=this;var d=scilligence.Utils.createElement(h,"div");var j=g.viewonly?false:["insertbefore","insertafter","del"];this.batchtable=new JSDraw2.Table(null,{columns:c,toolbar:j,rowid:false,viewonly:g.viewonly,onCellChanged:function(q,n){f.onBatchCellChanged(q,n)},onDelRow:function(n){f.onBatchDelRow(n)},onselectrow:function(n,t,q){f.onBatchSelectRow(t,q)}},d);this.batchtable.insert()},createTable:function(h,g,l){var c=[{key:"name",caption:"Ingredient",width:l*0.12},{key:"amount",caption:"Amount",type:"density",width:l*0.07000000000000001},{key:"lot",caption:"Lot #",width:l*0.07000000000000001},{key:"role",caption:"Role",type:"select",items:g.ingredientRoles,width:l*0.07000000000000001},{key:"density",caption:"Density",type:"density",width:l*0.07000000000000001},{key:"purity",caption:"Purity",type:"purity",width:l*0.05},{key:"calcmass",viewonly:true,caption:"Calc. Mass",type:"mass",width:l*0.07000000000000001},{key:"calcvolume",viewonly:true,caption:"Calc. Vol",type:"volume",width:l*0.07000000000000001},{key:"actualmass",caption:"Actual Mass",type:"mass",width:l*0.07000000000000001},{key:"actualvolume",caption:"Actual Vol.",type:"volume",width:l*0.07000000000000001},{key:"percentage",viewonly:true,caption:"Theor. %",type:"percent",width:l*0.07000000000000001},{key:"notes",caption:"Description",width:l*0.192}];var j=g.viewonly?false:["insertbefore","insertafter","del"];var f=this;var d=scilligence.Utils.createElement(h,"div");this.ingredienttable=new JSDraw2.Table(null,{columns:c,toolbar:j,rowid:false,viewonly:g.viewonly,onCellChanged:function(q,n){f.onIngrdientCellChanged(q,n)}},d)},getXml:function(){var f=this.getJson();var g="<formulation>";if(f.batches.rows!=null){for(var c=0;c<f.batches.rows.length;++c){var d=scilligence.Utils.jsonList2Xml(f.batches.rows[c].ingredients.rows,"ingredient");g+=scilligence.Utils.json2Xml(f.batches.rows[c],"batch",d)}}g+="</formulation>";return g},setXml:function(j){var d=null;if(typeof j=="object"){d=j}else{if(typeof j=="string"){d=scilligence.Utils.parseXml(j)}}this.ingredients=[];var c={batches:{}};var h=c.batches.rows=scilligence.Utils.xml2Json(d,"batch");if(h!=null){for(var g=0;g<h.length;++g){var f=h[g]._e;h[g].ingredients={};h[g].ingredients.rows=scilligence.Utils.xml2Json(f,"ingredient")}}this.setJson(c)},setJson:function(c){if(c==null){return}this.ingredienttable.clear();this.batchtable.clear();this.ingredients=[];if(c.batches.rows!=null){for(var d=0;d<c.batches.rows.length;++d){this.ingredients[d]=c.batches.rows[d].ingredients}}this.batchtable.setJson(c.batches);if(c.batches.rows!=null){if(c.batches.rows!=null&&c.batches.rows.length>0){this.batchtable.setCurRow(null);this.batchtable.setCurRow(0)}}},clear:function(){this.ingredienttable.clear();this.batchtable.clear();this.ingredients=[]},getJson:function(){this.saveIngredientTable(this.batchtable.currow);var c=this.batchtable.getJson();for(var d=0;d<c.rows.length;++d){c.rows[d].ingredients=this.ingredients[d]}return{batches:c}},onBatchCellChanged:function(g,c){var d=this.batchtable.columns[c];if(d.key=="amount"){var h=this.batchtable._getTdNum(this.batchtable.getCell(g,"amount"));for(var f=0;f<this.ingredienttable.getRowCount();++f){this.calc(this.ingredienttable,f,0,h)}}if(this.options.onchange!=null){this.options.onchange()}},onBatchDelRow:function(c){if(c<this.ingredients.length){this.ingredients.splice(c,1)}if(this.options.onchange!=null){this.options.onchange()}this.ingredienttable.clear()},onBatchSelectRow:function(d,c){this.saveIngredientTable(c);if(this.ingredienttable!=null){this.ingredienttable.clear();this.ingredienttable.setJson(this.ingredients[d])}},saveIngredientTable:function(c){if(c!=null){this.ingredients[c]=this.ingredienttable.getJson()}},onIngrdientCellChanged:function(d,c){var f=this.batchtable._getTdNum(this.batchtable.getCell(this.batchtable.currow,"amount"));this.calc(this.ingredienttable,d,c,f);if(this.options.onchange!=null){this.options.onchange()}},calc:function(f,h,c,j){var g=this.getRow(f,h,j);if(g.amount==null){return}var d=f.columns[c];switch(d.key){case"amount":break;case"density":if(g.density!=null){if(g.calcmass!=null){g.calcvolume=g.calcmass/g.density}else{if(g.volume!=null){g.calcmass=g.calcvolume*g.density}}}break;case"calcmass":if(g.density!=null&&g.calcmass!=null){g.calcvolume=g.calcmass/g.density}break;case"calcvolume":if(g.density!=null&&g.calcvolume!=null){g.calcmass=g.calcvolume*g.density}break;case"actualmass":g.actualvolume=null;break;case"actualvolume":g.actualmass=null;break}if(g.actualmass!=null){g.actualvolume=null;if(g.calcmass!=null){g.percentage=g.actualmass/g.calcmass}}else{if(g.actualvolume!=null){g.actualmass=null;if(g.calcmass!=null){g.percentage=g.actualvolume/g.calcvolume}}}f.setCellValue(h,"calcmass",scilligence.Utils.num2str(g.calcmass,2,"g"));f.setCellValue(h,"calcvolume",scilligence.Utils.num2str(g.calcvolume,2,"L"));f.setCellValue(h,"actualmass",scilligence.Utils.num2str(g.actualmass,2,"g"));f.setCellValue(h,"actualvolume",scilligence.Utils.num2str(g.actualvolume,2,"L"));f.setCellValue(h,"percentage",scilligence.Utils.num2str(g.percentage==null?null:g.percentage,2,"%"))},getRow:function(f,j,l){var c=f._getTdNum(f.getCell(j,"amount"));var h=f._getTdNum(f.getCell(j,"purity"));var d=f._getTdNum(f.getCell(j,"density"));var g=null;if(l!=null&&c!=null){g=l*c;if(h!=null){g/=h}}var l=g!=null&&d!=null?g/d:null;return{amount:c,density:d,calcmass:g,calcvolume:l,actualmass:f._getTdNum(f.getCell(j,"actualmass")),actualvolume:f._getTdNum(f.getCell(j,"actualvolume"))}}});JSDraw2.StoichiometryGrid=scilligence.extend(scilligence._base,{constructor:function(h,g){this.kSelect="select";this.kMoles="moles";this.kMass="mass";this.kName="name";this.kPurity="purity";this.kStructure="structure";this.kMW="mw";this.kMF="mf";this.kDensity="density";this.kVolume="volume";this.kEq="eq";this.kLimit="limiting";this.kYield="yield";this.kCompletion="completion";this.reactants=null;this.reagents=null;this.products=null;if(g==null){g={}}var f=this;if(typeof(h)=="string"){h=dojo.byId(h)}scilligence.Utils.createElement(h,"div","Reactants:");var d=scilligence.Utils.createElement(h,"div");var c=[{type:"structure",key:"structure",caption:"Structure",width:100,viewonly:true},{type:"text",key:"name",caption:"Name",width:100,viewonly:false},{type:"mf",key:"mf",caption:"MF",width:100,viewonly:true},{type:"mw",key:"mw",caption:"MW",width:70,viewonly:true},{type:"float",key:"eq",caption:"Eq",width:50,viewonly:false},{type:"volume",key:"volume",caption:"Vol",width:80,viewonly:false},{type:"density",key:"density",caption:"Dens.",width:80,viewonly:false},{type:"mass",key:"mass",caption:"Mass",width:70,viewonly:false},{type:"purity",key:"purity",caption:"Purity",width:60,viewonly:false},{type:"moles",key:"moles",caption:"Moles",width:90,viewonly:false},{type:"radio",key:"limiting",caption:"Lmt",width:60,viewonly:false}];this.reactants=new JSDraw2.Table(null,{columns:c,toolbar:false,viewonly:g.viewonly,rowid:false,molheight:50,onCellChanged:function(l,j){f.onCellChanged(f.reactants,l,j)}},d);scilligence.Utils.createElement(h,"div","Reagents:");d=scilligence.Utils.createElement(h,"div");c=[{type:"structure",key:"structure",caption:"Structure",width:100,viewonly:true},{type:"text",key:"name",caption:"Name",width:100,viewonly:false},{type:"mf",key:"mf",caption:"MF",width:100,viewonly:true},{type:"mw",key:"mw",caption:"MW",width:70,viewonly:true},{type:"float",key:"eq",caption:"Eq",width:50,viewonly:false},{type:"volume",key:"colume",caption:"Vol",width:80,viewonly:false},{type:"density",key:"density",caption:"Dens.",width:80,viewonly:false},{type:"mass",key:"mass",caption:"Mass",width:70,viewonly:false},{type:"purity",key:"purity",caption:"Purity",width:60,viewonly:false},{type:"moles",key:"moles",caption:"Moles",width:150,viewonly:false}];this.reagents=new JSDraw2.Table(null,{columns:c,toolbar:false,viewonly:g.viewonly,rowid:false,molheight:50,onCellChanged:function(l,j){f.onCellChanged(f.reagents,l,j)}},d);scilligence.Utils.createElement(h,"div","Products:");var d=scilligence.Utils.createElement(h,"div");var c=[{type:"structure",key:"structure",caption:"Structure",width:100,viewonly:true},{type:"text",key:"name",caption:"Name",width:100,viewonly:false},{type:"mf",key:"mf",caption:"MF",width:100,viewonly:true},{type:"mw",key:"mw",caption:"MW",width:70,viewonly:true},{type:"float",key:"eq",caption:"Eq",width:50,viewonly:false},{type:"percent",key:"completion",caption:"Comp.%",width:160,viewonly:false},{type:"mass",key:"mass",caption:"Mass",width:70,viewonly:false},{type:"purity",key:"purity",caption:"Purity",width:60,viewonly:false},{type:"moles",key:"moles",caption:"Moles",width:90,viewonly:false},{type:"percent",key:"yield",caption:"Yield",width:60,viewonly:false}];this.products=new JSDraw2.Table(null,{columns:c,toolbar:false,viewonly:g.viewonly,rowid:false,molheight:50,onCellChanged:function(l,j){f.onCellChanged(f.products,l,j)}},d)},getXml:function(){var c=this.getJson();var d="<stoichiometry>";d+=scilligence.Utils.jsonList2Xml(c.reactants.rows,"reactant");d+=scilligence.Utils.jsonList2Xml(c.reagents.rows,"reagent");d+=scilligence.Utils.jsonList2Xml(c.products.rows,"product");d+="</stoichiometry>";return d},setXml:function(f){var d=null;if(typeof f=="object"){d=f}else{if(typeof f=="string"){d=scilligence.Utils.parseXml(f)}}var c={reactants:{},reagents:{},products:{}};c.reactants.rows=scilligence.Utils.xml2Json(d,"reactant");c.reagents.rows=scilligence.Utils.xml2Json(d,"reagent");c.products.rows=scilligence.Utils.xml2Json(d,"product");this.setJson(c)},setJson:function(c){if(c==null){return}this.reactants.clear();this.reagents.clear();this.products.clear();this.reactants.setJson(c.reactants);this.reagents.setJson(c.reagents);this.products.setJson(c.products)},getJson:function(){return{reactants:this.reactants.getJson(),reagents:this.reagents.getJson(),products:this.products.getJson()}},populate:function(g){if(typeof(g)=="string"){var f=new JSDraw2.Mol();f.setXml(g);g=f.parseRxn()}if(g==null){return}this._populate2(this.reactants,g.reactants);this._populate2(this.products,g.products);this._setLimitReactant();var d=[];if(g.above!=null){for(var c=0;c<g.above.length;++c){d.push(g.above[c].text)}}if(g.below!=null){for(var c=0;c<g.below.length;++c){d.push(g.below[c].text)}}this._populateReagents(d)},_populate2:function(h,l){var d=h.firstStructureColIndex();if(d==null){return}for(var c=0;c<l.length;++c){var f=true;for(var g=c;g<h.getRowCount();++g){var q=h.getCell(g,d);if(q.jsd.m.fullstructureMatch(l[c])){h.moveRow(g,c);f=false;break}}if(f){var n={eq:1};n[h.columns[d].key]=l[c].getMolfile();h.insertAt(c,n)}}for(var g=h.getRowCount()-1;g>=l.length;--g){h.destroyRow(g)}},_populateReagents:function(h){var g=this.reagents;for(var c=0;c<h.length;++c){var d=true;for(var f=c;f<g.getRowCount();++f){var l=g.getCellValue(f,this.kName);if(s==l){g.moveRow(f,c);d=false;break}}if(d){g.insertAt(c,{name:h[c]})}}for(var f=g.getRowCount()-1;f>=h.length;--f){g.destroyRow(f)}},_setLimitReactant:function(){var d=this.reactants;if(d.getRowCount()==0){return}for(var c=0;c<d.getRowCount();++c){if(d.getCellValue(c,this.kLimit)=="1"){return}}d.setCellValue(0,this.kLimit,"1")},onCellChanged:function(d,f,c){this.calcStoichiometry(d,f,c)},calcStoichiometry:function(f,n,c){var h=false;var l=this._parseRow(f,n);var d=f.columns[c];switch(d.key){case this.kMass:if(l.mass!=null){if(l.density!=null){l.volume=l.mass/l.density}if(this._calcMols(l)){h=true}this._setRow(f,l,n)}break;case this.kMF:var j=JSDraw.mf2mw(l.mf);l.mw=j==null?null:Math.round(j*100)/100;if(this._calcMols(l)){h=true}this._setRow(f,l,n);break;case this.kPurity:if(this._calcMols(l)){h=true;this._setRow(f,l,n)}break;case this.kVolume:if(l.density!=null){l.mass=l.volume*l.density;if(this._calcMols(l)){h=true}this._setRow(f,l,n)}break;case this.kDensity:if(l.density!=null){if(l.mass!=null){l.volume=l.mass/l.density}else{if(l.volume!=null){l.mass=l.volume*l.density;if(this._calcMols(l)){h=true}}}this._setRow(f,l,n)}break;case this.kMoles:if(this._calcMass(l)){if(l.density!=null){l.volume=l.mass/l.density}this._setRow(f,l,n);h=true}break;case this.kEq:if(l.eq!=null){if(f==this.reactants){if(this._isLimitRow(n)){this._updateProductsYield();this._updateByEq(this.reactants,l,n);this._updateByEq(this.reagents,l)}else{this._updateRowByEq(f,l,n)}}else{if(f==this.products){this._updateProductYield(l,n)}else{if(f==this.reagents){this._updateRowByEq(f,l,n)}}}}else{if(f==this.products){f.setCellValue(n,this.kYield,"")}}break;case this.kLimit:case this.kCompletion:this._updateProductsYield()}if(h){if(f==this.reactants){var g=this._getLimitRow();if(g!=null&&g.eq!=null&&g.moles!=null){if(this._isLimitRow(n)){this._updateProductsYield();this._updateByEq(this.reactants,g,n);this._updateByEq(this.reagents,g)}else{l.eq=g.eq/g.moles*l.moles;this._setRow(f,l,n)}}}else{if(f==this.reagents){var g=this._getLimitRow();l.eq=g.eq/g.moles*l.moles;this._setRow(f,l,n)}else{if(f==this.products){this._updateProductYield(l,n)}}}}},_calcMols:function(c){if(c.mass==null||c.mw==null){return false}c.moles=c.mass*(c.purity==null?1:c.purity)*(c.concentration==null?1:c.concentration)/c.mw;return true},_calcMass:function(c){if(c.moles==null||c.mw==null){return false}c.mass=c.moles*c.mw/(c.purity==null?1:c.purity)/(c.concentration==null?1:c.concentration);return true},_parseRow:function(c,f){var d={mf:c.getCellValue(f,this.kMF),mw:c._getTdNum(c.getCell(f,this.kMW)),mass:c._getTdNum(c.getCell(f,this.kMass)),purity:c._getTdNum(c.getCell(f,this.kPurity)),moles:c._getTdNum(c.getCell(f,this.kMoles)),density:c._getTdNum(c.getCell(f,this.kDensity)),volume:c._getTdNum(c.getCell(f,this.kVolume)),eq:c._getTdNum(c.getCell(f,this.kEq)),completion:c._getTdNum(c.getCell(f,this.kCompletion))};return d},_setRow:function(c,d,f){c.setCellValue(f,this.kMass,scilligence.Utils.num2str(d.mass,2,"g"));c.setCellValue(f,this.kMoles,scilligence.Utils.num2str(d.moles,2,"mol"));c.setCellValue(f,this.kVolume,scilligence.Utils.num2str(d.volume,2,"L"));c.setCellValue(f,this.kEq,scilligence.Utils.num2str(d.eq,2));if(this.reagents==c){c.setCellValue(f,this.kMW,d.mw)}},_updateRowByEq:function(c,f,g){if(f.mw!=null&&f.eq!=null){var d=this._getLimitRow();if(d.eq!=null&&d.moles!=null){f.moles=d.moles/d.eq*f.eq;this._calcMass(f);if(f.density!=null){f.volume=f.mass/f.density}this._setRow(c,f,g)}}},_updateProductYield:function(f,g,d){if(f.eq!=null&&f.moles!=null){if(d==null){d=this._getLimitRow()}if(d!=null&&d.eq!=null&&d.moles!=null){var h=(f.moles/f.eq)/(d.moles/d.eq)/(f.completion==null?1:f.completion)*100;var c=this.products.setCellValue(g,this.kYield,scilligence.Utils.num2str(h,2)+"%")}}},_updateProductsYield:function(){var f=this._getLimitRow();if(f==null){return}var d=this.products;for(var c=0;c<d.getRowCount();++c){this._updateProductYield(this._parseRow(d,c),c,f)}},_updateByEq:function(f,g,c){for(var d=0;d<f.getRowCount();++d){if(d==c){continue}var h=this._parseRow(f,d);if(h.eq!=null&&h.mw!=null){h.moles=g.moles/g.eq*h.eq;h.mass=h.moles*h.mw;if(h.density!=null){h.volume=h.mass/h.density}this._setRow(f,h,d)}}},_getItem:function(c,j){if(!(j<c.getRowCount())||!(j>=0)){return null}var h=c.getCellValue(j,this.kName);var f=c.getCellValue(j,this.kMF);var d=c.getCellValue(j,this.kMass);var q=c.getCellValue(j,this.kVolume);var g=c.getCellValue(j,this.kMoles);var l=h==null||h==""?f:h;var n="";if(q!=null&&q!=""){n+=(n==""?"":", ")+q}if(d!=null&&d!=""){n+=(n==""?"":", ")+d}if(g!=null&&g!=""){n+=(n==""?"":", ")+g}if(n!=""){l+=" ("+n+")"}return l},_isLimitRow:function(c){return this.reactants.getCellValue(c,this.kLimit)=="1"},_getLimitRow:function(){var d=this.reactants;for(var c=0;c<d.getRowCount();++c){if(this._isLimitRow(c)){return this._parseRow(d,c)}}return null}});JSDraw2.Stoichiometry=scil.extend(scil._base,{constructor:function(){this.reactants=[];this.products=[];this.reagents=[];this.solventVolume=0;this.stockVolume=0},addMol:function(f,c){var d=new JSDraw2.Stoichiometry.Mol(this,f,c);this.get(f).push(d);return d},get:function(c){switch(c){case"reactant":return this.reactants;case"product":return this.products;case"reagent":return this.reagents;default:return null}},scale:function(g,c,h){var d=this.getLimiting();var f=this.get(g)[c];if(f!=d){d.limiting=false;f.limiting=true}f.onSetData(h);if(f!=d){d.limiting=true;f.limiting=false}},onSetData:function(j,c,n,l){if(l){this.scale(j,c,n);return}if(j==null){return}var g=[];var h=[];var f=[];this.loading2mw(this.reactants,g);this.loading2mw(this.reagents,h);this.loading2mw(this.products,f);if(n=="loading"){n="mw"}var d=this.get(j);if(d==null){return}d[c].onSetData(n);this.mw2loading(this.reactants,g);this.mw2loading(this.reagents,h);this.mw2loading(this.products,f)},mw2loading:function(g,c){if(g==null){return}for(var d=0;d<c.length;++d){if(c[d]){var f=g[d];f.loading=1000/f.mw;f.mw=null}}},loading2mw:function(g,c){if(g==null){return}for(var d=0;d<g.length;++d){var f=g[d];c[d]=false;if(f.mw==null&&f.loading>0){f.mw=1000/f.loading;c[d]=true}}},getLimiting:function(){for(var c=0;c<this.reactants.length;++c){if(this.reactants[c].limiting){return this.reactants[c]}}for(var c=0;c<this.reagents.length;++c){if(this.reagents[c].limiting){return this.reagents[c]}}return null},onMolesChanged:function(f){if(f.role=="reactant"||f.role=="reagent"){if(f.limiting){for(var c=0;c<this.products.length;++c){this.products[c].updateData("yield");this.products[c].updateData("molar")}for(var c=0;c<this.reactants.length;++c){if(this.reactants[c]!=f){this.reactants[c].updateData("eq");this.reactants[c].updateData("molar")}}for(var c=0;c<this.reagents.length;++c){if(this.reagents[c]!=f){this.reagents[c].updateData("eq");this.reagents[c].updateData("molar")}}}else{var d=this.getLimiting();if(d!=null){if((f.moles!=null||f.eq!=null)&&d.moles>0&&d.eq>0){f.eq=f.moles/(d.moles/d.eq);if(!(f.eq>0)&&!this.allowZeroEq){f.eq=1}}}}}else{if(f.role=="product"){f.updateData("yield")}}},onSetSolvent:function(f,c){var d=this.getLimiting();if(d!=null){if(f!="solvent"&&c){this.solventVolume=d.moles/d.molar-this.stockVolume}else{var g=this.solventVolume+this.stockVolume;if(g>0){d.molar=d.moles/g;d.modified=true;this.onMolesChanged(d)}}}},updateStockVolume:function(){var c=this.stockVolume;this.stockVolume=this.getStockVolume(this.reactants,this.reagents);this.stockvolumechanged=c!=this.stockVolume},getStockVolume:function(d,f){if(!JSDraw2.Stoichiometry.kCountStockVolume){return 0}var g=0;if(d!=null){for(var c=0;c<d.length;++c){var h=d[c].volume;if(h>0&&(JSDraw2.Stoichiometry.kCountDensityVolume||!(d[c].density>0))){g+=h}}}if(f!=null){for(var c=0;c<f.length;++c){var h=f[c].volume;if(h>0&&(JSDraw2.Stoichiometry.kCountDensityVolume||!(f[c].density>0))){g+=h}}}return g}});JSDraw2.Stoichiometry.Mol=scil.extend(scil._base,{constructor:function(f,d,c){this.rxn=f;this.role=d;this.modified=false;this.mf=c==null?null:c.mf;this.mw=c==null||!(c.mw>0)?null:c.mw;this.loading=c==null||!(c.loading>0)?null:c.loading;this.eq=c==null||!(c.eq>0)?null:c.eq;this.purity=c==null||!(c.purity>0)?null:c.purity;this.stockcon=c==null||!(c.stockcon>0)?null:c.stockcon;this.density=this.stockcon>0||c==null||!(c.density>0)?null:c.density;this.molar=c==null||!(c.molar>0)?null:c.molar;this.limiting=c==null?null:c.limiting;this.yield=c==null||!(c.yield>0)?null:c.yield;this.batches=c==null||!(c.batches>0)?1:c.batches;this.grossamount=c==null||!(c.grossamount>0)?null:c.grossamount;this.grosspurity=c==null||!(c.grosspurity>0)?null:c.grosspurity;this.eu=c==null||!(c.eu>0)?null:c.eu;this.euconcentration=c==null||!(c.euconcentration>0)?null:c.euconcentration;this.theorymass=c==null?null:c.theorymass;this.mass=c==null||!(c.mass>0)?null:c.mass;this.volume=c==null||!(c.volume>0)?null:c.volume;this.moles=c==null||!(c.moles>0)?null:c.moles;this.state=c==null||c.state==""?null:c.state;this.lastedit=c==null?null:c.lastedit},onSetData:function(c){this.onSetData2(c,true)},updateData:function(d){switch(d){case"yield":var c=this.rxn.getLimiting();if(c==null){}else{if(this.state!=null&&this.state.indexOf("Crude")>=0){this.yield=null}else{this.yield=(this.moles/this.eq)/(this.batches>0?this.batches:1)/(c.moles/c.eq)}this.theorymass=(c.moles/c.eq)*this.eq*this.mw*(this.batches>0?this.batches:1)}break;case"molar":if((this.rxn.solventVolume+this.rxn.stockVolume)>0&&this.moles>0){this.molar=this.moles/(this.rxn.solventVolume+this.rxn.stockVolume)}else{this.molar=null}break;case"eq":return this.onSetData2("eq",false);default:return false}this.modified=true;return true},onSetData2:function(n,c){var f=false;var l=true;var g=this.volume;switch(n){case"state":if(this.role=="product"){var d=this.rxn.getLimiting();if(this.state!=null&&this.state.indexOf("Crude")>=0){if(this.yield!=null){this.yield=null;this.modified=true;return true}}else{this.updateData("yield");this.modified=true;return true}}break;case"grossamount":if(this.grossamount>0&&this.grosspurity>0){this.mass=this.grossamount*this.grosspurity;if(this.mw>0&&this.mass!=null){this.moles=this.mass*(this.purity>0?this.purity:1)/this.mw;f=true}else{if(this.role=="product"){this.yield=null;this.moles=null;this.volume=null}}}else{this.grosspurity=this.mass/this.grossamount}l=false;break;case"grosspurity":if(this.lastedit=="mass"||(this.lastedit!="grossamount"||!(this.grossamount>0))&&this.mass>0&&this.grosspurity>0){this.grossamount=this.mass/this.grosspurity}else{if(this.grossamount>0&&this.grosspurity>0){this.mass=this.grossamount*this.grosspurity;if(this.mw>0&&this.mass!=null){this.moles=this.mass*(this.purity>0?this.purity:1)/this.mw;f=true}else{if(this.role=="product"){this.yield=null;this.moles=null;this.volume=null}}}}l=false;break;case"mass":if(this.mw>0&&this.mass!=null){this.moles=this.mass*(this.purity>0?this.purity:1)/this.mw;f=true}else{if(this.role=="product"){this.yield=null;this.moles=null;this.volume=null}}if(this.lastedit!="grossamount"){this.grossamount=this.mass/this.grosspurity}else{this.grosspurity=this.mass/this.grossamount}l=false;break;case"volume":case"vol":if(this.volume>0){if(this.density>0&&this.lastedit!="mass"){this.mass=this.volume*(this.density*1);this.moles=this.mass*(this.purity>0?this.purity:1)/this.mw;f=true}else{if(this.stockcon>0){this.moles=this.volume*this.stockcon;f=true}else{if(this.euconcentration>0){if(this.lastedit!="eu"){this.eu=this.volume*this.euconcentration}else{this.euconcentration=this.eu/this.volume}}}}}break;case"eu":if(this.eu>0){if(this.euconcentration>0&&this.lastedit!="volume"){this.volume=this.eu/this.euconcentration}else{this.euconcentration=this.eu/this.volume}}break;case"euconcentration":if(this.euconcentration>0){if(this.eu>0&&this.lastedit!="volume"){this.volume=this.eu/this.euconcentration}else{this.eu=this.volume*this.euconcentration}}break;case"purity":if(this.role=="product"){this.moles=this.mass*(this.purity>0?this.purity:1)/this.mw}else{this.mass=(this.moles*this.mw)/(this.purity>0?this.purity:1)}f=true;break;case"density":if(this.density>0){if(this.mass>0&&this.lastedit!="vol"&&this.lastedit!="volume"){this.volume=this.mass/(this.density*1)}else{this.mass=this.volume*(this.density*1);this.moles=this.mass*(this.purity>0?this.purity:1)/this.mw;f=true}this.stockcon=0}break;case"moles":f=true;break;case"batches":f=true;l=false;break;case"eq":l=false;if(this.role!="product"&&!this.limiting){if(this.eq==null&&this.role=="reagent"&&!this.rxn.allowZeroEq){c=false}else{var d=this.rxn.getLimiting();this.moles=d==null?null:(d.moles/d.eq)*this.eq;l=true}}f=true;break;case"molar":if(this.limiting&&this.moles>0&&this.molar>0){this.rxn.solventVolume=this.moles/this.molar-this.rxn.stockVolume;f=true}else{if((this.rxn.solventVolume+this.rxn.stockVolume)>0&&this.moles>0){this.molar=this.moles/(this.rxn.solventVolume+this.rxn.stockVolume)}}break;case"stockcon":if(this.stockcon>0){this.volume=this.moles/this.stockcon;this.density=null}break;case"structure":this.moles=(this.mass/this.mw)*(this.purity>0?this.purity:1);f=true;break;case"mf":var j=JSDraw2.FormulaParser.mf2Stats(this.mf);this.mw=j==null?null:JSDraw2.FormulaParser.stats2mw(j);this.mf=j==null?null:JSDraw2.FormulaParser.stats2mf(j);this.mfChanged=true;if(this.mass==null){var d=this.rxn.getLimiting();this.moles=d==null?null:(d.moles/d.eq)*this.eq}else{this.moles=(this.mass/this.mw)*(this.purity>0?this.purity:1)}f=true;break;case"mw":if(this.mass==null){var d=this.rxn.getLimiting();this.moles=d==null?null:(d.moles/d.eq)*this.eq}else{this.moles=(this.mass/this.mw)*(this.purity>0?this.purity:1)}f=true;break;default:return false}this.modified=true;if(f){if((l||!(this.mass>0))&&this.mw>0&&this.moles!=null){var h=this.mass;this.mass=this.moles*this.mw/(this.purity>0?this.purity:1);if(h>0&&this.mass>0&&Math.abs(h-this.mass)/this.mass<0.001){this.mass=h}if(this.grosspurity>0){this.grossamount=this.mass/this.grosspurity}}if(this.density>0&&this.moles!=null){this.volume=this.mass/(this.density*1)}else{if(this.stockcon>0&&this.moles!=null){this.volume=this.moles/this.stockcon}}if(this.volume!=g){this.rxn.updateStockVolume()}if(this.rxn.fixmolar){var d=this.rxn.getLimiting();if(d!=null){this.rxn.solventVolume=d.moles/d.molar-this.rxn.stockVolume}}else{if(n!="molar"){this.molar=this.moles/(this.rxn.solventVolume+this.rxn.stockVolume)}}if(c){this.rxn.onMolesChanged(this)}}else{if(this.volume!=g||n=="volume"||n=="vol"){this.rxn.updateStockVolume()}}return true}});scil.apply(JSDraw2.Stoichiometry,{kCountDensityVolume:true,kCountStockVolume:true});JSDraw2.SequenceEditor=scilligence.extend(scilligence._base,{constructor:function(d,g){this.gray="#ddd";this.chains=[];this.parent=null;this.options=null;this.cols=1;this.root=null;this.cur=null;this.stoichiometry=null;JSDraw2.Security._check();this.options=g==null?{}:g;if(this.options.rules==null){if(JSDraw2.sequencerules!=null){this.options.rules=JSDraw2.sequencerules}else{this.options.rules=[{name:"Glycosylation Site",pattern:"N[A-Z][S|T]",type:"protein",color:"#aaffee"}]}}if(d==null){return}if(typeof(d)=="string"){d=dojo.byId(d)}this.parent=d;var h=scilligence.Utils.styleRect(this.parent);if(!(this.options.width>0)){this.options.width=h.width>0?h.width:800}if(!(this.options.height>0)&&!this.options.viewonly){this.options.height=h.height>0?h.height:400}this.parent.style.height="";this.cols=Math.floor(this.options.width/130);if(this.cols<1){this.cols=1}if(this.options.color!=null){c.color=this.options.color}var j=JsUtils.createTable(this.parent,0,0,{border:"solid 1px "+this.gray});if(!this.options.viewonly){this.toolbar=JsUtils.createElement(JsUtils.createElement(j,"tr",null,{background:scil.Utils.imgSrc("img/hbg.gif",true)+" repeat-x "+JSDraw2.Skin.jsdraw.bkcolor}),"td");this.createToolbar(this.toolbar,this.options.buttons)}var l=JsUtils.createElement(JsUtils.createElement(j,"tr"),"td");var c={width:(this.options.width-16)+"px",padding:"10px",fontFamily:"courier",overflow:"scroll"};if(this.options.height>0){c.height=this.options.height+"px"}this.root=JsUtils.createElement(l,"div",null,c);if(!this.options.viewonly){var f=this;dojo.connect(this.root,"onclick",function(n){f.onclick(n)})}if(this.parent.id!=null||this.parent.id!=""){JSDraw2.SequenceEditor.__all[this.parent.id]=this}},translate:function(){if(!this.isDNA()&&!this.isRNA()){return null}var f=[];for(var c=0;c<this.chains.length;++c){var d=this.chains[c].translate();if(d!=null){f=f.concat(d)}}return f},onclick:function(c){var d=c.target||c.srcElement},isDNA:function(){return this.options.biotype=="dna"||this.options.biotype=="gene"},isRNA:function(){return this.options.biotype=="rna"},isProtein:function(){return !this.isDNA()&&!this.isRNA()},getBiotype:function(){return this.options.biotype},getMolarExtinctionCoef:function(){if(this.isDNA()||this.isRNA()){return null}return JSDraw2.SequenceEditor.getMolarExtinctionCoef(this._seqForCaluation())},getCorrectionFactorAbsor:function(){if(this.isDNA()||this.isRNA()){return null}return JSDraw2.SequenceEditor.getCorrectionFactorAbsor(this._seqForCaluation(),false)},getGlycosylationSites:function(){if(this.isDNA()||this.isRNA()){return null}return JSDraw2.SequenceEditor.getGlycosylationSites(this._seqForCaluation())},getIP:function(){if(this.isDNA()||this.isRNA()){return null}return JSDraw2.SequenceEditor.getIP(this._seqForCaluation())},updateSignalSequence:function(g,h){var c=false;for(var d=0;d<this.chains.length;++d){if(this.chains[d].setSignalSequence(g,false)){c=true}}if(this.stoichiometry!=h){this.stoichiometry=h;c=true}if(c){this.onchange("updatesignal",this)}return c},redraw:function(){for(var c=0;c<this.chains.length;++c){this.chains[c].redraw()}},validateSequence:function(g,h){g=JSDraw2.SequenceEditor.normSequence(g);if(scil.Utils.isNullOrEmpty(g)){return true}var d=null;if(this.options.biotype=="dna"){d=/^[AGTC]+$/g}else{if(this.options.biotype=="rna"||this.options.biotype=="gene"){d=/^[AGTCU]+$/g}else{if(this.options.biotype=="protein"||this.options.biotype=="aa"){d=/^[A-Z|\-|\*]+$/g}else{if(this.options.biotype=="aa20"){d=/^[A|C-I|K-N|P-T|V-W|Y]+$/g}else{if(this.options.biotype=="aa22"){d=/^[A|C-I|K-W|Y]+$/g}else{if(this.options.biotype=="aa26"){d=/^[A-Z]+$/g}}}}}}var c=d==null?true:d.test(g);if(!c&&h){scil.Utils.alert("Invalid character in the sequence")}return c},createToolbar:function(g,c){var h=JsUtils.createTable(g,0,0);var j=JsUtils.createElement(h,"tr");var f=this;this.createBtn(j,"About ...",scil.Utils.imgSrc("img/jsdraw.gif"),function(l){JSDraw2.Editor.showAbout();l.preventDefault()});this.createBtn(j,null,"|");this.createBtn(j,"New",scil.Utils.imgSrc("img/new.gif"),function(l){f.clear(true);l.preventDefault()});this.createBtn(j,null,"|");this.createBtn(j,"Add Chain",scil.Utils.imgSrc("img/chainadd.gif"),function(l){f.addChain("AAA");l.preventDefault()});this.createBtn(j,"Remove Chain",scil.Utils.imgSrc("img/chaindel.gif"),function(l){f.delSelectedChain();l.preventDefault()});this.createBtn(j,null,"|");this.createBtn(j,"Add Annotation",scil.Utils.imgSrc("img/annadd.gif"),function(l){f.addAnnotation();l.preventDefault()});this.createBtn(j,"Remove Annotation",scil.Utils.imgSrc("img/anndel.gif"),function(l){f.delAnnotation();l.preventDefault()});this.createBtn(j,"Edit Annotation",scil.Utils.imgSrc("img/annedit.gif"),function(l){f.editAnnotation();l.preventDefault()});this.createBtn(j,null,"|");this.createBtn(j,"Show/Hide Auto-Annotations",scil.Utils.imgSrc("img/annauto.gif"),function(l){f.showAutoAnnotations();l.preventDefault()});this.createBtn(j,"List Annotation Patterns",scil.Utils.imgSrc("img/annrules.gif"),function(l){f.listAnnotationRules();l.preventDefault()});this.createBtn(j,null,"|");this.createBtn(j,"Add Coding Region",scil.Utils.imgSrc("img/addcodingregion.gif"),function(l){f.addAnnotation(true);l.preventDefault()});this.createBtn(j,"Set Signal Sequence",scil.Utils.imgSrc("img/signal.gif"),function(l){f.setSignalSequence();l.preventDefault()});this.createBtn(j,null,"|");this.createBtn(j,"Show Properties",scil.Utils.imgSrc("img/prop.gif"),function(l){f.showPorperties();l.preventDefault()});if(c!=null){for(var d=0;d<c.length;++d){this.createButton(j,c[d])}}},addAnnotationsByRules:function(){var c=this;JSDraw2.SequenceEditor.Rule.show(this,null,function(d){c.addAnnotationsByRules2(d)})},addAnnotationsByRules2:function(f){if(f==null||f.length==0){return false}var d=0;for(var c=0;c<this.chains.length;++c){d+=this.chains[c].addAnnotationsByRules(f)}if(d>0){this.redraw()}return d>0},listAnnotationRules:function(){JSDraw2.SequenceEditor.Rule.show(this)},showAutoAnnotations:function(){this.options.showautoannotations=!(this.options.showautoannotations!=false);this.redraw()},createButton:function(f,c){var d=this;this.createBtn(f,c.tooltips,c.iconurl,function(g){c.onclick(d);g.preventDefault()},c.width)},res:function(c){return JSDraw2.Language.res(c)},createBtn:function(j,h,f,d,l){var g=scil.Utils.createElement(j,"td");if(f=="|"){scil.Utils.createElement(g,"image",null,{padding:"2px"},{src:scil.Utils.imgSrc("img/sep.gif")})}else{var c=scil.Utils.createElement(g,"image",null,{padding:"2px",width:l==null?"20px":l+"px",height:"20px"},{src:f,title:this.res(h)});dojo.connect(c,"onclick",function(n){d(n);n.preventDefault()});dojo.connect(c,"onmouseover",function(){this.style.backgroundColor=JSDraw2.Skin.jssdf.hovercolor});dojo.connect(c,"onmouseout",function(){this.style.backgroundColor=""})}},setSignalSequence:function(){var c=this.cur;if(c==null&&this.chains.length==1){this.cur=c=this.chains[0]}if(c==null){scil.Utils.alert(this.res("Please select a chain"));return}var f=this.cur.getSize(true);var d=this;scil.Utils.prompt(this.res("Set Signal Sequence"),this.res("Please type the signal sequence length")+" (0 - "+f+"):",this.cur.signallength>=0?this.cur.signallength:"",this.res("Update"),function(h){var g=parseInt(h);if(d.cur.setSignalSequence(g>=0?g:0)){d.cur.redraw();d.onchange("set signal sequence")}})},showPorperties:function(){var d=this.cur;if(d==null&&this.chains.length==1){this.cur=d=this.chains[0]}if(d==null){scil.Utils.alert(this.res("Please select a chain"));return}var j=this.options.biotype;if(j==null){j="Not specified"}var h=" style='background:#eee'";var g="<table cellspacing=0 cellpadding=1 style='border: solid 1px #ddd;background: fff;'>";g+="<tr"+h+"><td>Type</td><td>"+j+"</td></tr>";g+="<tr><td>Size</td><td>"+d.getSize()+"</td></tr>";g+="<tr"+h+"><td>Signal Sequence</td><td>"+(d.signallength>0?d.signallength:"")+"</td></tr>";g+="<tr><td>Mol. Weight</td><td>"+d.getMolWeight()+"</td></tr>";if(!this.isDNA()&&!this.isRNA()){g+="<tr"+h+"><td>Molar Extinction Coef.:</td><td>"+d.getMolarExtinctionCoef()+"</td></tr>";g+="<tr><td>Glycosylation Sites:</td><td>"+d.getGlycosylationSites()+"</td></tr>";g+="<tr"+h+"><td>Isoelectronic Point:</td><td>"+d.getIP()+"</td></tr>"}else{g+="<tr><td>&nbsp;</td></tr>"}g+="<tr><td colspan=2><b>Stats</b></td></tr>";var c=d.getCounts();for(var f in c){g+="<tr"+h+"><td style='text-align:right;padding-right: 15px;'>"+f+":</td><td>"+c[f]+"</td></tr>"}g+="</table>";scil.Utils.alert2(g,this.res("Properties"))},getSelPos:function(){if(this.cur==null){scil.Utils.alert("No chain selected");return}var g=null;if(window.getSelection!=null){var l=window.getSelection();range=document.createRange();if(l.rangeCount==1){var h=l.getRangeAt(0);g=this.cur.getPosition(h.startContainer,h.startOffset,h.endContainer,h.endOffset)}}else{if(document.selection!=null){var l=document.selection.createRange();var f=l.parentElement();if(f.tagName=="SPAN"){f=f.parentNode}if(f==this.cur.right){var j=l.text.replace(/\r\n/g,"");if(j.length>0){var n=l.duplicate();n.moveToElementText(this.cur.right);n.setEndPoint("EndToStart",l);var t=n.text.replace(/\r\n/g,"").length;var d=t+j.length;var q=this._toNetPosition(t)+1;var c=this._toNetPosition(d);if(q>c){g={start:c,end:q}}else{g={start:q,end:c}}}}}}if(g==null){g={start:1,end:1}}return g},addCodingRegion:function(f,n){if(f==null){return}var l=null;var q=f.getSequence(true);for(var g=0;g<n.length;++g){var d=n[g];var j=d.pattern.replace(/[\?]/g,"[A-Z]").replace(/[*]/g,"[A-Z]{1,1000000}");var h=scil.Utils.regFindAllMatches(q,new RegExp(j));if(h!=null&&h.length>0){l={start:h[0].start+1,end:h[0].start+h[0].str.length,name:d.name};break}}if(l==null){return false}this.addAnnotation2({start:l.start,end:l.end},true,l.name);return true},addAnnotation:function(c){var d=this.getSelPos();this.addAnnotation2(d,c,null)},addAnnotation2:function(g,d,f){if(g==null){return}var c=new JSDraw2.SequenceEditor.Annotation(g.start,g.end,"b","yellow",f);c.codingregion=d;JSDraw2.SequenceEditor.Annotation.edit(c,this.cur,this,true)},delAnnotation:function(){var c=this.getSelPos();if(c!=null){if(this.cur.delAnnoations(c.start,c.end)>0){this.onchange("delete annotation")}}},onchange:function(c,d){if(this.options.onchange!=null){this.options.onchange(c,d)}},editAnnotation:function(){var d=this.getSelPos();if(d==null){return}var c=this.cur.getAnn(d);if(c!=null){JSDraw2.SequenceEditor.Annotation.edit(c,this.cur,this)}else{scil.Utils.alert("No annotation selected")}},addChain:function(f,d){if(this.options.maxchains>0&&this.chains.length>=this.options.maxchains){scil.Utils.alert("Exceeding max chain(s): "+this.options.maxchains);return}var c=new JSDraw2.SequenceEditor.Chain(this);c.setComment(d);c.setSequence(f,[]);this.chains.push(c);this.onchange("add chain");return c},addChainXml:function(d){if(d==null||typeof(d)=="string"&&d==""){return null}var c=new JSDraw2.SequenceEditor.Chain(this);c.setXml(d);this.chains.push(c);return c},clear:function(c){if(this.chains.length==0){return}if(c&&!confirm("Remove all chain(s)?")){return}for(var d=this.chains.length-1;d>=0;--d){this.removeChain(d)}this.cur=null;this.onchange("clear");this.stoichiometry=null},delSelectedChain:function(){if(this.cur==null){return}if(!confirm("Remove selected chain?")){return}if(this.removeChain(this.cur)){this.cur=null;this.onchange("delete chain")}},removeChain:function(d){if(typeof(d)=="number"){d=this.chains[d]}if(d==null){return false}for(var f=0;f<this.chains.length;++f){if(this.chains[f]==d){this.chains.splice(f,1);d.destroy();return true}}return false},select:function(c){if(this.cur==c){return}if(this.cur!=null){this.cur.select(false)}this.cur=c;if(this.cur!=null){this.cur.select(true)}},_seqForCaluation:function(){var j=this.stoichiometry;if(!(j>0)){j=1}var h="";for(var f=0;f<this.chains.length;++f){var d=this.chains[f];for(var g=0;g<j;++g){h+=d.getSequence(true,d.signallength)}}return h},getMolWeight:function(){var d=1;if(this.stoichiometry>0){d=this.stoichiometry}var f=0;for(var c=0;c<this.chains.length;++c){f+=this.chains[c].getMolWeight()*d}return f},getSize:function(){var d=this.stoichiometry;if(!(d>0)){d=1}var f=0;for(var c=0;c<this.chains.length;++c){f+=this.chains[c].getSize()}return f*d},getFasta:function(){var d="";for(var c=0;c<this.chains.length;++c){if(c>0){d+="\n"}d+=this.chains[c].getFasta()}return d},setFasta:function(f){this.clear();if(scil.Utils.isNullOrEmpty(f)){return}var j=f.split("\n");var c="";var h="";for(var d=0;d<j.length;++d){var g=JsUtils.trim(j[d]);if(g==""){if(c!=""&&h!=""){this.addChain(h,c);c="";h=""}}else{if(g.substr(0,1)==">"){if(h!=""){this.addChain(h,c);c="";h=""}else{c+=g.substr(1)+"\n"}}else{h+=g}}}if(h!=""){this.addChain(h,c)}},setXml:function(j){this.clear();var g=null;if(typeof j=="object"){g=j}else{if(typeof j=="string"){var d=scil.Utils.parseXml(j);if(d==null){this.setFasta(j);return}g=d.documentElement}}if(g==null){return null}var h=parseInt(g.getAttribute("stoichiometry"));if(h>0){this.stoichiometry=h}var c=scil.Utils.getElements(g,"chain");for(var f=0;f<c.length;++f){this.addChainXml(c[f])}},getXml:function(){var d="";for(var c=0;c<this.chains.length;++c){d+=this.chains[c].getXml()}if(d==""){return null}return"<se"+(this.options.biotype==null||this.options.biotype==""?"":" biotype='"+this.options.biotype+"'")+(this.stoichiometry>0?" stoichiometry='"+this.stoichiometry+"'":"")+">"+d+"</se>"},_convertPosition:function(h,f,n){var d=this.cols*f;var l=h%d;var g=(h-l)/d;var j=l%f;var c=(l-j)/f;return g*this.cols*n+c*n+j},_toHtmlPosition:function(c){return this._convertPosition(c,10,11)},_toNetPosition:function(c){return this._convertPosition(c,11,10)}});scilligence.apply(JSDraw2.SequenceEditor,{__all:{},popupdlg:null,codontable:{"-":["TAA","TAG","TGA"],A:["GCT","GCC","GCA","GCG"],C:["TGT","TGC"],D:["GAT","GAC"],E:["GAA","GAG"],F:["TTT","TTC"],H:["CAT","CAC"],G:["GGT","GGC","GGA","GGG"],I:["ATT","ATC","ATA"],K:["AAA","AAG"],L:["TTA","TTG","CTT","CTC","CTA","CTG"],M:["ATG"],N:["AAT","AAC"],P:["CCT","CCC","CCA","CCG"],Q:["CAA","CAG"],R:["CGT","CGC","CGA","CGG","AGA","AGG"],S:["TCT","TCC","TCA","TCG","AGT","AGC"],T:["ACT","ACC","ACA","ACG"],V:["GTT","GTC","GTA","GTG"],W:["TGG"],Y:["TAT","TAC"]},translateDNA:function(f){var d={};for(var h in this.codontable){var j=this.codontable[h];for(var g=0;g<j.length;++g){d[j[g]]=h}}var q="";f=f.toUpperCase();var l=f.length%3;if(l!=0){f+=l==1?"  ":" "}for(var g=0;g<f.length;g+=3){var t=f.substr(g,3);var c=d[t];q+=c==null?"?":c}return q},reverseSequence:function(c){return c==null?null:c.split("").reverse().join("")},transriptRNA:function(c){return this._compliment(c,true)},complimentDNA:function(c){return this._compliment(c,false)},_compliment:function(j,h){if(j==null){return null}var g="";for(var f=0;f<j.length;++f){var d=j.substr(f,1);switch(d){case"G":g+="C";break;case"C":g+="G";break;case"A":g+=h?"U":"T";break;case"T":g+="A";break;case"U":g+=h?"A":"-";break;default:g+="-";break}}return g},get:function(c){return this.__all[c]},normSequence:function(c){if(c==null){return null}c=c.replace(/[ |\240|\t|\r|\n]+/g,"");return c.toUpperCase()},res:function(c){return JSDraw2.Language.res(c)},showPopupViewer:function(q,h,j,l){var n=null;if(this.viewerdlg==null){var g=JsUtils.createElement(null,"div",null,{width:"700px"});n=JsUtils.createElement(g,"div");var f=JsUtils.createElement(g,"div",null,{textAlign:"center",paddingTop:"10px"});var c=JsUtils.createElement(f,"button","<img src='"+scil.App.imgSmall("submit.png")+"'/>"+this.res("Done"));dojo.connect(c,"onclick",function(){JSDraw2.SequenceEditor.viewerdlg.hide()});JSDraw2.SequenceEditor.viewerdlg=new JsDialog(this.res("Sequence Viewer"),g)}this.viewerdlg.show({title:q,owner:l});if(n!=null){this.viewerdlg.se=new JSDraw2.SequenceEditor(n,{width:680,height:320,viewonly:true})}if(j=="fasta"){this.viewerdlg.se.setFasta(h)}else{if(j=="xml"){this.viewerdlg.se.setXml(h)}}},showPopup:function(u,l,n,g,f,q){var t=null;if(this.popupdlg==null){var j=JsUtils.createElement(null,"div",null,{width:"700px"});t=JsUtils.createElement(j,"div");var h=JsUtils.createElement(j,"div",null,{textAlign:"center",paddingTop:"10px"});var c=JsUtils.createElement(h,"button","<img src='"+scil.App.imgSmall("submit.png")+"'/>"+this.res("Save"));dojo.connect(c,"onclick",function(){var d=JSDraw2.SequenceEditor.popupdlg;if(d.callback!=null){d.callback(d.se)}d.hide()});JSDraw2.SequenceEditor.popupdlg=new JsDialog(this.res("Sequence Editor"),j)}this.popupdlg.show2({title:u,owner:q});if(t!=null){this.popupdlg.se=new JSDraw2.SequenceEditor(t,{width:680,height:320})}this.popupdlg.se.options.biotype=f;if(n=="fasta"){this.popupdlg.se.setFasta(l)}else{if(n=="xml"){this.popupdlg.se.setXml(l)}}this.popupdlg.callback=g},getCounts:function(h){var g={};for(var f=0;f<h.length;++f){var d=h.substr(f,1);if(g[d]==null){g[d]=1}else{++g[d]}}return g},getMolWeight:function(l,d){if(scil.Utils.isNullOrEmpty(l)){return 0}JSDraw2.SuperAtoms.read();var g=null;if(d=="rna"){g=JSDraw2.SuperAtoms.RNAs}else{if(d=="dna"||d=="gene"){g=JSDraw2.SuperAtoms.DNAs}else{g=JSDraw2.SuperAtoms.AminoAcids}}var h=0;var n=0;for(var j=0;j<l.length;++j){var f=l.substr(j,1);var q=g[f];if(q==null){continue}if(q!=null&&q.mw!=null){n+=q.mw}if(q.attachpoints>2){h+=q.attachpoints-2}}n+=JSDraw2.PT.O.m+(2+h)*JSDraw2.PT.H.m;return n},getMolarExtinctionCoef:function(l){var h,j,g;if(JSDraw2.defaultoptions!=null&&JSDraw2.defaultoptions.mec!=null){h=JSDraw2.defaultoptions.mec.w;j=JSDraw2.defaultoptions.mec.y;g=JSDraw2.defaultoptions.mec.c}var f=this.getCounts(l);var n=f.W==null?0:f.W;var q=f.Y==null?0:f.Y;var d=f.C==null?0:f.C;return n*(h>=0?h:5690)+q*(j>=0?j:1280)+d*(g>=0?g:120)},getCorrectionFactorAbsor:function(f,c){var d=this.getMolWeight(f,c);return d>0?this.getMolarExtinctionCoef(f)/d:0},getGlycosylationSites:function(c){if(scil.Utils.isNullOrEmpty(c)){return 0}return c.replace(/N[A-Z][S|T]/g,"+").replace(/[^\+]/g,"").length},getIP:function(q){if(scil.Utils.isNullOrEmpty(q)){return 0}var f=this.getCounts(q);var d=f.D==null?0:f.D;var h=f.E==null?0:f.E;var g=f.C==null?0:f.C;var t=f.Y==null?0:f.Y;var j=f.H==null?0:f.H;var n=f.K==null?0:f.K;var c=f.R==null?0:f.R;var l=[d,h,g,t,j,n,c];return this.getIP2(l,6.5,0,14)},getIP2:function(c,f,h,g){var j=-1/(1+Math.pow(10,3.65-f));var l=-c[0]/(1+Math.pow(10,3.9-f));var n=-c[1]/(1+Math.pow(10,4.07-f));var q=-c[2]/(1+Math.pow(10,8.18-f));var t=-c[3]/(1+Math.pow(10,10.46-f));var u=c[4]/(1+Math.pow(10,f-6.04));var w=1/(1+Math.pow(10,f-8.199999999999999));var x=c[5]/(1+Math.pow(10,f-10.54));var y=c[6]/(1+Math.pow(10,f-12.48));var d=j+l+n+q+t+u+w+x+y;if(Math.abs(d)<0.01){return f}else{if(d<0){return this.getIP2(c,f-(f-h)/2,h,f)}else{if(d>0){return this.getIP2(c,f+(g-f)/2,f,g)}}}},autoAnnotate:function(g,t,C,l,B,E){if(C==null||g==null||g==""){return null}var w=[];var D=g;for(var q=0;q<C.length;++q){var f=C[q];if(f==null||f.disabled||f.pattern==null){continue}var n=f.type=="gene";var A=f.type=="protein"||f.type==null||f.type=="";if(!(t&&A||!t&&n)){continue}var z=f.pattern.replace(/[\?]/g,"[A-Z]").replace(/[*]/g,"[A-Z]{1,1000000}");var y=scil.Utils.regFindAllMatches(D,new RegExp(z),E);for(var u=0;u<y.length;++u){var x=y[u];var h=f.color==null?"red":f.color;var d=new JSDraw2.SequenceEditor.Annotation(x.start+1,x.start+x.str.length,"b",h,(f.name==null?"":f.name),null,true);if(!this.annotationContains(l,d,B)){w.push(d)}}}return w},annotationContains:function(f,c,g){if(f==null||c==null){return false}for(var d=0;d<f.length;++d){if(f[d].isEqual(c,g)){return true}}return false}});JSDraw2.SequenceEditor.Chain=scilligence.extend(scilligence._base,{constructor:function(g){this.nocomment="no title";this.seqeditor=g;this.left=null;this.right=null;this.editor=null;this.comment=null;this.commenteditor=null;this.root=null;this.annotations=[];this.sel=null;this.signallength=0;var h={width:"50px",color:this.seqeditor.gray,textAlign:"right",paddingRight:"10px",verticalAlign:"top"};this.root=JsUtils.createElement(g.root,"div",null,{marginBottom:"20px"});var j=JsUtils.createTable(this.root,0,0);var n=JsUtils.createElement(j,"tr");this.sel=JsUtils.createElement(n,"td","&nbsp;",null,{rowSpan:3});JsUtils.createElement(n,"td",">",h);this.comment=JsUtils.createElement(JsUtils.createElement(n,"td"),"pre",this.nocomment,{padding:0,margin:0,fontFamily:"arial",fontSize:"80%"});n=JsUtils.createElement(j,"tr");JsUtils.createElement(n,"td");var c="";for(var d=0;d<this.seqeditor.cols;++d){c+=scil.Utils.padright((d+1)+"",11,"&nbsp;")}var l=JsUtils.createElement(n,"td",c,{color:this.seqeditor.gray,textAlign:"left"});var n=JsUtils.createElement(j,"tr");this.left=JsUtils.createElement(n,"td",null,h);this.right=JsUtils.createElement(JsUtils.createElement(n,"td"),"div");var f=this;if(!this.seqeditor.options.viewonly){dojo.connect(this.right,"ondblclick",function(){f.edit()});dojo.connect(this.comment,"ondblclick",function(){f.editComment()})}dojo.connect(j,"onmousedown",function(){f.seqeditor.select(f)})},translate:function(j){var f=[];for(var d=0;d<this.annotations.length;++d){if(this.annotations[d].codingregion){f.push(this.annotations[d])}}var h=[];if(f.length>0){var j=this.getSequence(true);for(var d=0;d<f.length;++d){var c=f[d];var l=j.substr(c.start-1,c.end-c.start+1);var g=JSDraw2.SequenceEditor.translateDNA(l);h.push({gene:l,genexml:this.getXml(),protein:g})}}else{var l=this.getSequence(true,this.signallength);var g=JSDraw2.SequenceEditor.translateDNA(l);h.push({gene:l,protein:g})}return h},getMolWeight:function(){var c=this.getSequence(true,this.signallength);return JSDraw2.SequenceEditor.getMolWeight(c,this.seqeditor.getBiotype())},getSize:function(c){var d=this.getSequence(true,c?0:this.signallength);return d==null?0:d.length},select:function(c){this.sel.style.background=c?"#aaf":""},destroy:function(){this.root.parentNode.removeChild(this.root);this.root=null},getCounts:function(){var c=this.getSequence(true,this.signallength);return JSDraw2.SequenceEditor.getCounts(c)},getMolarExtinctionCoef:function(){var c=this.getSequence(true,this.signallength);return JSDraw2.SequenceEditor.getMolarExtinctionCoef(c)},getCorrectionFactorAbsor:function(){var c=this.getSequence(true,this.signallength);return JSDraw2.SequenceEditor.getCorrectionFactorAbsor(c)},getGlycosylationSites:function(){var c=this.getSequence(true,this.signallength);return JSDraw2.SequenceEditor.getGlycosylationSites(c)},getIP:function(){var c=this.getSequence(true,this.signallength);return JSDraw2.SequenceEditor.getIP(c)},edit:function(){if(this.editor==null){this.editor=JsUtils.createElement(this.right.parentNode,"textarea",null,{display:"none",fontFamily:"Courier"});var c=this;dojo.connect(this.editor,"onblur",function(){c.endEdit()});dojo.connect(this.editor,"onkeydown",function(d){if(d.keyCode==27){c.endEdit(true);d.preventDefault()}else{if(d.keyCode==13&&d.ctrlKey){c.endEdit()}}})}this.editor.style.width=this.right.offsetWidth+"px";this.editor.style.height=(this.right.offsetHeight<60?60:this.right.offsetHeight)+"px";this.right.style.display="none";this.editor.style.display="";this.editor.value=JsUtils.getInnerText(this.right);this.editor.focus()},parseFasta:function(f){var h=f.split("\n");var d={comment:null,sequence:""};for(var c=0;c<h.length;++c){var g=h[c];if(g==""){continue}if(g.substr(0,1)==">"){if(d.comment==null){d.comment=g.substr(1)}else{d.comment+="\r\n"+g.substr(1)}}else{d.sequence+=g}}return d},endEdit:function(c){if(this.editor==null||this.editor.style.display!=""){return}if(!c){var d=this.parseFasta(this.editor.value);if(d.comment!=null&&d.comment!=""){if(this.comment.innerHTML==""||this.comment.innerHTML==this.nocomment){this.comment.innerHTML=d.comment}else{this.comment.innerHTML+="\r\n"+d.comment}}if(!this.seqeditor.validateSequence(d.sequence,true)){return}if(d.sequence==null||d.sequence==""){this.annotations=[]}this.setSequence(d.sequence,this.annotations);this.validateAnnotations();this.seqeditor.onchange("sequence",this)}this.right.style.display="";this.editor.style.display="none"},validateAnnotations:function(){var f=this.getSize();if(f==0){this.annotations=[];return}for(var d=this.annotations.length-1;d>=0;--d){var c=this.annotations[d];if(!(f>=c.start)){this.annotations.splice(d,1)}else{if(!(f>=c.end)){c.end=f}}}},editComment:function(){if(this.commentEditor==null){this.commentEditor=JsUtils.createElement(this.comment.parentNode,"textarea",null,{display:"none",fontSize:"80%",fontFamily:"arial"});var c=this;dojo.connect(this.commentEditor,"onblur",function(){c.endEditComment()});dojo.connect(this.commentEditor,"onkeydown",function(f){if(f.keyCode==27){c.endEditComment(true);f.preventDefault()}else{if(f.keyCode==13&&f.ctrlKey){c.endEditComment()}}})}this.commentEditor.style.width=this.comment.offsetWidth+"px";this.commentEditor.style.height=this.comment.offsetHeight+"px";this.comment.style.display="none";this.commentEditor.style.display="";var d=JsUtils.getInnerText(this.comment);this.commentEditor.value=d==null||d==this.nocomment?"":d;this.commentEditor.focus()},endEditComment:function(c){if(this.commentEditor==null||this.commentEditor.style.display!=""){return}if(!c){var d=this.commentEditor.value;this.comment.innerHTML=scil.Utils.isNullOrEmpty(d)?this.nocomment:d;this.seqeditor.onchange("comment",this)}this.comment.style.display="";this.commentEditor.style.display="none"},getFasta:function(){var f=JsUtils.getInnerText(this.comment);var d="";if(f!=""){var g=f.split("\n");for(var c=0;c<g.length;++c){d+=">"+g[c]+"\n"}}d+=JsUtils.getInnerText(this.right)+"\n";return d},getXml:function(){this.endEdit();this.endEditComment();var c="<chain><c>"+JsUtils.escXmlValue(JsUtils.getInnerText(this.comment))+"</c><seq"+(this.signallength>0?" signal='"+this.signallength+"'":"")+" s='"+this.getSequence(true)+"'>";for(var d=0;d<this.annotations.length;++d){c+=this.annotations[d].getXml()}c+="</seq></chain>";return c},setXml:function(n){if(n==null){return}if(typeof n=="string"){var u=scil.Utils.parseXml(n);n=u.documentElement;if(n==null){return null}}var z=n.getElementsByTagName("seq");var t=n.getElementsByTagName("c");var y=z==null||z.length==0?null:z[0];var g=[];var h=y==null?null:y.getElementsByTagName("a");if(h!=null){for(var x=0;x<h.length;++x){var d=h[x];var B=parseInt(d.getAttribute("st"));var w=parseInt(d.getAttribute("ed"));var C=d.getAttribute("t");var l=d.getAttribute("c");var q=scil.Utils.isTrue(d.getAttribute("coding"));var j=scil.Utils.isTrue(d.getAttribute("auto"));var f=new JSDraw2.SequenceEditor.Annotation(B,w,C,l,d.text||d.textContent,q,j);g.push(f)}}var A=y.getAttribute("signal");if(A!=null&&!isNaN(A)){this.signallength=parseInt(A)}this.setSequence(y==null?null:y.getAttribute("s"),g);this.setComment(t==null||t.length==0?null:t[0].text||t[0].textContent)},clear:function(){this.setComment(null);this.setSequence(null,[]);this.signallength=0},setComment:function(c){this.comment.innerHTML=c==null||c==""?this.nocomment:c},addAnnotationsByRules:function(f){var g=this.getSequence(true);var d=JSDraw2.SequenceEditor.autoAnnotate(g,this.seqeditor.isProtein(),f,this.annotations,false,this.signallength);if(d==null){return 0}for(var c=0;c<d.length;++c){this.addAnnotation(d[c])}return d.length},addAnnotation:function(c){c.auto=null;this.annotations.push(c)},getAnnByNotes:function(f){for(var d=0;d<this.annotations.length;++d){var c=this.annotations[d];if(c.notes==f){return c}}return null},delAnn:function(c){for(var d=0;d<this.annotations.length;++d){if(this.annotations[d]==c){this.annotations.splice(d,1);return true}}return false},getAnn:function(f){for(var d=0;d<this.annotations.length;++d){var c=this.annotations[d];if(c.start>=f.start&&c.end<=f.end){return c}}return null},delAnnoations:function(h,d){var g=0;for(var f=this.annotations.length-1;f>=0;--f){var c=this.annotations[f];if(c.start>=h&&c.end<=d){this.annotations.splice(f,1);++g}}if(g>0){this.redraw()}return g},setSequence:function(d,c){this._display(d,c)},redraw:function(){this._display(this.getSequence(),this.annotations)},_display:function(l,c){if(l==null){l=""}else{l=JSDraw2.SequenceEditor.normSequence(l)}this.annotations=c==null?[]:c;var q=0;var h=0;var g=0;var f="1<br>";var j="";while(q<l.length){if(++h>this.seqeditor.cols){++g;f+=(g*this.seqeditor.cols*10+1)+"<br>";h=1}if(q+10<l.length){j+=l.substr(q,10)+(h==this.seqeditor.cols?"\n":"\t");q+=10}else{j+=l.substring(q);break}}this.left.innerHTML=f;var d=this._addAnnotation(l,j);this.right.innerHTML=d==null||d==""?"&nbsp":d.replace(/\t/g,"&nbsp;").replace(/\n/g,"&nbsp;<br>")},setSignalSequence:function(c,d){if(this.signallength!=c){this.signallength=c;if(d!=null){this.seqeditor.onchange("signallength",this)}return true}return false},_addAnnotation:function(j,d){var f=scil.clone(this.annotations);if(this.signallength>0){var c=new JSDraw2.SequenceEditor.Annotation(1,this.signallength,"b","#fa7","Signal Sequence");var l=[c];f=l.concat(f)}if(this.seqeditor.options.showautoannotations!=false){var g=JSDraw2.SequenceEditor.autoAnnotate(j,this.seqeditor.isProtein(),this.seqeditor.options.rules,this.annotations,true,this.signallength);if(g!=null&&g.length>0){f=f.concat(g)}}var h=new JSDraw2.SequenceEditor.AnnSequence(f);return h.annotate(this.seqeditor,d)},getSequence:function(c,f){var d=JsUtils.getInnerText(this.right);if(c){d=JSDraw2.SequenceEditor.normSequence(d)}if(f>0){d=d.substr(f)}return d},getPosition:function(f,h,g,j){if(f.nodeName!="#text"||g.nodeName!="#text"){return null}var l=f.parentNode;var n=g.parentNode;if(l.nodeName=="SPAN"){l=l.parentNode}if(n.nodeName=="SPAN"){n=n.parentNode}if(l!=this.right||n!=this.right){return null}var t=this.getCharPosition(this.right,f,h);var d=this.getCharPosition(this.right,g,j);if(t==null||d==null){return null}var q=this.seqeditor._toNetPosition(t+1);var c=this.seqeditor._toNetPosition(d);if(q>c){return{start:c,end:q}}else{return{start:q,end:c}}},getCharPosition:function(g,d,f){var j=new JSDraw2.Stack();for(var c=g.childNodes.length-1;c>=0;--c){j.push(g.childNodes[c])}var q=0;while(!j.isEmpty()){var l=j.pop();if(l==d){return q+f}if(l.childNodes.length==0){var h=JsUtils.getInnerText(l);if(h!=null){q+=h.length}else{if(l.tagName=="BR"){++q}}}else{for(var c=l.childNodes.length-1;c>=0;--c){j.push(l.childNodes[c])}}}return null}});JSDraw2.SequenceEditor.Annotation=scilligence.extend(scilligence._base,{constructor:function(j,g,l,f,h,d,c){this.start=j;this.end=g;this.type=l;this.color=f;this.notes=h;this.codingregion=d;this.auto=c},getXml:function(){var c="<a st='"+this.start+"' ed='"+this.end+"'";if(this.type!=null){c+=" t='"+JsUtils.escXmlValue(this.type)+"'"}if(this.color!=null){c+=" c='"+JsUtils.escXmlValue(this.color)+"'"}if(this.codingregion){c+=" coding='1'"}if(this.auto){c+=" auto='1'"}c+=">"+JsUtils.escXmlValue(this.notes)+"</a>";return c},isEqual:function(c,d){if(c.start==this.start&&c.end==this.end){if(d){return c.notes==this.notes&&c.codingregion==this.codingregion}else{return true}}return false}});scil.apply(JSDraw2.SequenceEditor.Annotation,{dlg:null,ann:null,chain:null,edit:function(c,d,g,f){if(this.dlg==null){this.dlg=this.createDialog()}this.dlg.show();this.se=g;this.ann=c;this.chain=d;this.isnew=f;this.dlg.form.fields.start.value=c.start;this.dlg.form.fields.end.value=c.end;this.dlg.form.fields.codingregion.checked=c.codingregion;JsUtils.selectOption(this.dlg.form.fields.type,c.type);JsUtils.selectOption(this.dlg.form.fields.color,c.color);this.dlg.form.fields.notes.value=c.notes==null?"":c.notes},endEdit:function(c){if(c){this.ann.start=parseInt(this.dlg.form.fields.start.value);this.ann.end=parseInt(this.dlg.form.fields.end.value);this.ann.type=this.dlg.form.fields.type.value;this.ann.color=this.dlg.form.fields.color.value;this.ann.codingregion=this.dlg.form.fields.codingregion.checked;this.ann.notes=this.dlg.form.fields.notes.value;if(this.isnew){this.chain.addAnnotation(this.ann)}this.chain.redraw();this.se.onchange(this.isnew?"add annotation":"edit annotation")}this.dlg.hide()},createDialog:function(){var d={start:{label:"Start",type:"number",width:200},end:{label:"End",type:"number",width:200},codingregion:{label:"Coding Region",type:"checkbox"},type:{label:"Type",type:"select",width:200,items:{u:"Underline",f:"Fore color",b:"Background Color"}},color:{label:"Color",type:"select",width:200,items:["","red","green","blue","yellow","cyan","lime","purple","gray","pink"]},notes:{label:"Notes",type:"textarea",width:400,height:40}};var f=this;var c=[{label:"Save",onclick:function(){f.endEdit(true)}},{label:"Cancel",onclick:function(){f.endEdit(false)}}];return scil.Form.createDlgForm("Annotation",d,c)}});JSDraw2.SequenceEditor.AnnFrag=scil.extend(scil._base,{constructor:function(d,c){this.end=d;this.annotations=[];this.addAnn(c)},split:function(d){var c=new JSDraw2.SequenceEditor.AnnFrag(d,null);c.annotations=scil.clone(this.annotations);return c},addAnn:function(c){if(c!=null){this.annotations.push(c)}},show:function(q,h,u,l){var g=this.end;if(h==null||g<u||this.annotations.length==0||u>=h.length){return h}var n="";var d=this.annotations.length==1?this.annotations[0].color:"gray";var x=this.annotations.length==1?this.annotations[0].type:"strip";for(var j=0;j<this.annotations.length;++j){var c=this.annotations[j];if(c.codingregion){n+="Coding Region"}else{if(c.auto){n+="Rule"}else{n+="Annotation"}}n+="["+c.start+"-"+c.end+"]: "+(c.notes==null||c.notes==""?"No Notes":c.notes)+"\n"}if(d==null){d="yellow"}var t=q._toHtmlPosition(u-1);var f=q._toHtmlPosition(g);if(g%10==0){--f}var w="";switch((x+"").toLowerCase()){case"f":w="color:"+d;break;case"b":w="background:"+d;break;case"o":w="text-decoration:overline";break;case"strip":w="background:"+scil.Utils.imgSrc("img/strip.gif",true)+" repeat-x "+(l%2==1?"top":"bottom");break;default:w="text-decoration:underline";break}h=h.substr(0,t)+"<span se='ann' style='"+w+"' title='"+JsUtils.escXmlValue(n)+"'>"+h.substr(t,f-t)+"</span>"+h.substr(f);return h}});JSDraw2.SequenceEditor.AnnSequence=scil.extend(scil._base,{constructor:function(n){this.frags=[];for(var j=0;j<n.length;++j){var c=n[j];var t=c.start;var d=c.end;if(this.frags.length==0){if(t<=1){this.frags.push(new JSDraw2.SequenceEditor.AnnFrag(d,c))}else{this.frags.push(new JSDraw2.SequenceEditor.AnnFrag(t-1,null));this.frags.push(new JSDraw2.SequenceEditor.AnnFrag(d,c))}continue}var w=this.findFragIndex(t);if(w==-1){if(!this.isNext2Frag(-1,t)){this.frags.push(new JSDraw2.SequenceEditor.AnnFrag(t-1,null))}this.frags.push(new JSDraw2.SequenceEditor.AnnFrag(d,c))}else{var u=this.frags[w];if(!this.isNext2Frag(w-1,t)){var q=u.split(t-1);this.frags.splice(w,0,q);++w}var g=this.findFragIndex(d);var f=this.frags[g];if(u==f){var q=f.split(d);q.addAnn(c);this.frags.splice(g,0,q)}else{u.addAnn(c);for(var l=w+1;l<this.frags.length;++l){var h=this.frags[l];if(f==h){if(d==f.end){h.addAnn(c)}else{var q=f.split(d);q.addAnn(c);this.frags.splice(g,0,q)}break}else{h.addAnn(c)}}if(f==null){this.frags.push(new JSDraw2.SequenceEditor.AnnFrag(d,c))}}}}},annotate:function(f,c){for(var d=this.frags.length-1;d>=0;--d){c=this.frags[d].show(f,c,d==0?1:this.frags[d-1].end+1,d)}return c},findFragIndex:function(d){for(var c=0;c<this.frags.length;++c){if(d<=this.frags[c].end){return c}}return -1},isNext2Frag:function(c,d){if(c<0){return d<=1}else{return this.frags[c].end+1==d}}});JSDraw2.SequenceEditor.Rule={dlg:null,se:null,onsave:null,show:function(f,d,c){this.se=f;this.onsave=c;this.create();this.dlg.show();var g=this.dlg.form.fields.rules.jsd;g.clear();if(d==null){d=f.options.rules}g.setData(d)},save:function(){var g=this.dlg.form.fields.rules.jsd;var f=g.getData();for(var c=f.length-1;c>=0;--c){var d=f[c];delete d.isnew;delete d.ruleid;if(scil.Utils.isDictEmpty(d)){f.splice(c,1)}}if(this.onsave!=null){this.onsave(f,g)}else{this.se.options.rules=f;this.se.redraw()}this.dlg.hide()},create:function(){if(this.dlg!=null){return}var c={ruleid:{type:"hidden"},name:{label:"Name",width:160},pattern:{label:"Pattern (? - any letter; * - any string)",width:400},color:{label:"Color",type:"color",width:50},type:{label:"Type",type:"select",items:["protein","gene","coding region"],width:100},disabled:{label:"Disabled",type:"checkbox"}};var d=this;this.dlg=scil.Form.createDlgForm("Sequence Annotation Rules",{rules:{type:"table",columns:c}},[{src:scil.App.imgSmall("submit.png"),label:"OK",onclick:function(){d.save()}}," ",{src:scil.App.imgSmall("add.png"),label:"Add Coding Region",title:"Add coding region using enabled Coding-Region rules",onclick:function(){d.addCodingRegion()}}],{hidelabel:true,rowcheck:true})},addCodingRegion:function(){if(this.se==null){return}if(this.se.cur==null){scil.Utils.alert("Please select chain first");return}var h=this.dlg.form.fields.rules.jsd;var f=h.getData();var g=[];for(var c=f.length-1;c>=0;--c){var d=f[c];if(d.type!="coding region"||d.disabled){continue}g.push(d)}if(g.length==0){scil.Utils.alert("No enabled coding region defined");return}if(!this.se.addCodingRegion(this.se.cur,g)){scil.Utils.alert("No sequence found based on defined coding region rules")}else{this.dlg.hide()}}};JSDraw2.Symbol={symbols:["α","β","γ","δ","ε","ζ","η","θ","ι","κ","λ","μ","ν","ξ","π","ρ","ς","σ","τ","υ","φ","χ","ψ","ω","ϑ","ϒ","ϖ","©","®","†","‡","‰","§","°","Å","±","∓","∔","∸","×","÷","◊","•","★","☆","«","»","∀","∂","∃","∅","∇","∈","∉","∋","∏","∑","√","∝","∞","∠","∧","∨","∩","∪","∫","∵","∴","≅","≈","≠","≡","≟","≤","≥","⊂","⊃","⊄","⊆","⊇","⊕","⊖","⊗","Γ","Δ","Ε","Θ","Ξ","Π","Σ","Φ","Ψ","Ω","½","¼","¾","⅓","⅔","⅕","⅖","⅙","⅚","⅛","⅞","←","→","↓","↑","↔","↵","⇐","⇑","⇒","⇓","⇔","↛","⇌","⇄","⇉","∢"],div:null,td:null,dlg:null,callback:null,isVisible:function(){return this.dlg!=null&&this.dlg.isVisible()},isFrom:function(c){return this.dlg!=null&&this.dlg.isFrom(c)},show:function(d,c,f){this.create();this.dlg.show(null,null,d);this.callback=c;if(f!=null){this.dlg.moveTo(f.x,f.y)}},hide:function(){if(this.dlg!=null){this.dlg.hide()}},create:function(){if(this.dlg!=null){return}var d=this.symbols;if(JSDraw2.defaultoptions!=null&&JSDraw2.defaultoptions.symbols!=null){d=d.concat(JSDraw2.defaultoptions.symbols)}this.div=scil.Utils.createElement(null,"div",null,{width:"600px",fontSize:"28px",textAlign:"center"});scil.Utils.unselectable(this.div);var g=scil.Utils.createTable(this.div,0,0,{width:"100%"});var h=null;for(var c=0;c<d.length;++c){if(c%20==0){h=scil.Utils.createElement(g,"tr")}scil.Utils.createElement(h,"td",d[c],{border:"solid 1px #f5f5f5",textAlign:"center"})}var f=this;dojo.connect(g,"onmouseover",function(j){f.onMouseOver(j)});dojo.connect(g,"onmousedown",function(j){f.onMouseDown(j);j.preventDefault();return false});this.dlg=new JSDraw2.Dialog(scil.Utils.res("Insert Symbol"),this.div)},onMouseOver:function(c){var d=c.target||c.srcElement;if(d.tagName!="TD"){return}if(this.td!=null){this.td.style.background="";this.td.style.color=""}d.style.background="#88f";d.style.color="#fff";this.td=d},onMouseDown:function(c){var g=c.target||c.srcElement;if(g.tagName!="TD"){return}var d=true;if(this.callback!=null){d=this.callback(g.innerHTML)}if(d){this.dlg.hide()}},getCaretPosition:function(d){var c=0;if(document.selection){d.focus();var f=document.selection.createRange();f.moveStart("character",-d.value.length);c=f.text.length}else{if(d.selectionStart||d.selectionStart=="0"){c=d.selectionStart}}return(c)},setCaretPosition:function(d,c){if(d.selectionStart||d.selectionStart=="0"){d.selectionStart=c;d.selectionEnd=c;d.focus()}else{if(document.selection){d.focus();var f=document.selection.createRange();f.moveStart("character",-d.value.length);f.moveStart("character",c);f.moveEnd("character",0);f.select()}}}};JSDraw2.CustomTemplates={dlg:null,current:null,editor:null,jsds:{},get:function(c){return JSDraw2.SuperAtoms.getCustomTemplate(this.current)},show:function(f,c){this.editor=c;if(!this.create()){this.dlg.show(null,null,f)}var d=this.jsds[this.current];if(scil.Utils.isIE&&scil.Utils.isIE<9&&d!=null){this.createJsd(d.div,this.current)}},hide:function(){if(this.dlg!=null){this.dlg.hide()}},create:function(){if(this.dlg!=null){return false}this.div=scil.Utils.createElement(null,"div",null,{width:"680px",overflowY:"scroll",fontSize:"28px",textAlign:"center"});scil.Utils.unselectable(this.div);var l=scil.Utils.createTable(this.div,null,null,{width:"100%"});var t=null;var g={};var h=this;var j=0;for(var f in JSDraw2.SuperAtoms.customtemplates){++j;if((j-1)%6==0){t=scil.Utils.createElement(l,"tr")}var q=scil.Utils.createElement(t,"td",null,{border:"solid 1px #f5f5f5",textAlign:"center"},{title:f});var c=scil.Utils.createElement(q,"div",null,{width:"100px",height:"100px"});g[f]=c;dojo.connect(q,"onmouseup",function(d){h.select(d)})}if(j>24){this.div.style.height="400px"}this.dlg=new JSDraw2.Dialog(scil.Utils.res("Custom Templates"),this.div);this.dlg.show();for(var f in g){this.createJsd(g[f],f)}return true},createJsd:function(c,f){var g=JSDraw2.SuperAtoms.customtemplates[f];var d=new JSDraw2.Editor(c,{viewonly:true,showcontextmenu:false});d.setMolfile(g.getMolfile());this.jsds[f]={jsd:d,div:c}},select:function(c){var d=c.srcElement||c.target;if(d.tagName!="TD"){d=scil.Utils.getParent(d,"TD")}this.current=d.getAttribute("title");this.dlg.hide()}};scil.XDraw=scil.extend(scil._base,{constructor:function(h,g){this.options=g;if(this.options==null){this.options={}}if(typeof h=="string"){h=document.getElementById(h)}var l=scil.Utils.createTable(h);var n=scil.Utils.createElement(l,"tr");var d=this;var j={border:"solid 1px #ddd",background:"#fff",width:"120px",padding:"2px",textAlign:"center"};this.tabJSDraw=scil.Utils.createElement(n,"td","JSDraw",j);dojo.connect(this.tabJSDraw,"onclick",function(){d.showJSDraw()});this.divJSDraw=scil.Utils.createElement(h,"div",null,{display:"none"});if(this.options.showchemdraw!=false&&JSDraw2.defaultoptions.showchemdraw!=false){this.tabChemDraw=scil.Utils.createElement(n,"td","ChemDraw",j);dojo.connect(this.tabChemDraw,"onclick",function(){d.showChemDraw()});this.divChemDraw=scil.Utils.createElement(h,"div",null,{display:"none"})}if(this.options.showjdraw!=false&&JSDraw2.defaultoptions.showjdraw!=false){this.tabJDraw=scil.Utils.createElement(n,"td","Accelrys JDraw",j);dojo.connect(this.tabJDraw,"onclick",function(){d.showJDraw()});this.divJDraw=scil.Utils.createElement(h,"div",null,{display:"none"})}var q=scil.Utils.readCookie(scil.XDraw.kXDraw);if(q==null){q=JSDraw2.defaultoptions.xdraw}var c=false;if(q=="chemdraw"){c=this.showChemDraw(this.options.value)}else{if(q=="jdraw"){c=this.showJDraw(this.options.value)}}if(!c){this.showJSDraw(this.options.value)}this.xdraw=true},getCurrentEditor:function(){if(this.divJSDraw.style.display==""){return"jsdraw"}else{if(this.divChemDraw.style.display==""){return"chemdraw"}else{if(this.divJDraw.style.display==""){return"jdraw"}}}return null},selectTab:function(c){this.divJSDraw.style.display=c=="jsdraw"?"":"none";if(this.divChemDraw!=null){this.divChemDraw.style.display=c=="chemdraw"?"":"none"}if(this.divJDraw!=null){this.divJDraw.style.display=c=="jdraw"?"":"none"}this.tabJSDraw.style.background=c=="jsdraw"?"#eee":"#fff";if(this.divChemDraw!=null){this.tabChemDraw.style.background=c=="chemdraw"?"#eee":"#fff"}if(this.divJDraw!=null){this.tabJDraw.style.background=c=="jdraw"?"#eee":"#fff"}},onDataChange:function(){if(this.skipdatachangeevent){return}this.tabdatachanged=true;if(this.options.ondatachange!=null){this.options.ondatachange(this)}},onFocus:function(c){this.tabdatachanged=true;if(this.options.onfocus!=null){this.options.onfocus(c)}},showJSDraw:function(h){if(this.divJSDraw.style.display==""){return}var j=h==null?null:h.value;var f=h==null?"xml":h.format;if(j==null){j=this.getXml();f="xml"}this.selectTab("jsdraw");if(this.jsdraw==null){var c=scil.clone(this.options);c.dataformat=f;c.data=j;if(c.width<=0){c.width=700}if(c.height<=0){c.height=350}var g=this;c.ondatachange=function(){g.onDataChange()};c.onfocus=function(l){g.onFocus(l)};var d=scil.Utils.createElement(this.divJSDraw,"div");this.jsdraw=new JSDraw(d,c);if(!scil.Utils.isNullOrEmpty(j)){this.skipdatachangeevent=true;this.jsdraw.setXml(j);this.skipdatachangeevent=false}}else{this.skipdatachangeevent=true;this.jsdraw.setXml(j,false);this.skipdatachangeevent=false}scil.Utils.createCookie(scil.XDraw.kXDraw,"jsdraw");this.tabdatachanged=false},convertFile:function(f,c){if(scil.Utils.isNullOrEmpty(f)){return f}if(typeof(f)=="object"){f=scil.Utils.getInnerXml(f)}var d=scil.Utils.ajaxwait(JSDrawServices.url+"?cmd=convertfile",{input:f,outputformat:c});return d==null?null:d.output},oldcdxml:null,testChemDrawDataChanged:function(){if(this.chemdraw&&!scil.Utils.isIE){var c=this._getChemDrawData("text/xml");if(c!=this.oldcdxml){this.onDataChange()}}},showChemDraw:function(q){if(this.divChemDraw==null){return false}if(this.divChemDraw.style.display==""){return true}var c=this.value2Molfile(q);if(c==null){c=this.getXml()}if(JSDrawServices.url!=null){c=this.convertFile(c,"cdxml")}this.selectTab("chemdraw");try{if(this.chemdraw==null){if(c!=null){if(JSDrawServices.url!=null){c="text/xml;base64,"+JSDraw2.Base64.encode(c)}else{c="chemical/x-mdl-molfile,"+scil.Utils.escXmlValue(c)}}if(scil.Utils.isIE){if(scil.Utils.isIE>=11||JSDraw2.ChemDraw.isCDActiveXInstalled()==false){this.chemdraw=false}else{var t=this.options.width;var g=this.options.height;var d=scil.Utils.createElement(this.divChemDraw,"div");var n='<param NAME="ShowToolsWhenVisible" VALUE="1">';if(c!=null){n+="<param NAME='DataURL' VALUE=\"data:"+c+'"/>'}var j="<object classid='"+JSDraw2.ChemDraw.CD_CONTROL_CLSID+"' style='border:solid 1px #ddd; width:"+(t>0?t:700)+"px;height:"+(g>0?g:350)+"px;'>"+n+"</object>";d.innerHTML=j;this.chemdraw=d.firstChild;if(this.chemdraw.Objects==null){this.chemdraw=false}else{var l=this;this.chemdraw.attachEvent("DataChanged",function(){l.onDataChange()});dojo.connect(this.chemdraw,"onfocus",function(){l.onFocus(true)});dojo.connect(this.chemdraw,"onblur",function(){l.onFocus(false)})}}if(this.chemdraw==false){scil.Utils.removeAll(d);scil.Utils.createElement(this.divChemDraw,"div",scil.Utils.isIE>=11?"ChemDraw is not supported on IE 11+":"ChemDraw is not installed",{width:(t>0?t:700)+"px",height:(g>0?g:350)+"px",color:"red",padding:20,border:"solid 1px #ddd"})}}else{var t=this.options.width;var g=this.options.height;var d=scil.Utils.createElement(this.divChemDraw,"div");var j="<embed type='chemical/x-cdx' showtoolswhenvisible=1 style='border:solid 1px #ddd; width:"+(t>0?t:700)+"px;height:"+(g>0?g:350)+"px;' dataurl='data:"+c+"'></embed>";d.innerHTML=j;this.chemdraw=d.firstChild;if(false){}else{dojo.connect(this.chemdraw,"onfocus",function(){l.onFocus(true)});dojo.connect(this.chemdraw,"onblur",function(){l.onFocus(false)})}}}else{this.skipdatachangeevent=true;if(JSDrawServices.url!=null){this._setChemDrawData("text/xml",c)}else{this._setChemDrawData("chemical/x-mdl-rxn",c)}this.skipdatachangeevent=false}}catch(f){this.chemdraw=false;scil.Utils.createElement(this.divChemDraw,"div",f.message,{color:"red"})}scil.Utils.createCookie(scil.XDraw.kXDraw,"chemdraw");this.tabdatachanged=false;return true},showJDraw:function(q){if(this.divJDraw==null){return false}if(this.divJDraw.style.display==""){return true}var l=this.value2Molfile(q);if(l==null){l=this.getMolfile()}this.selectTab("jdraw");try{if(this.jdraw==null){var t=this.options.width;var f=this.options.height;var c=scil.Utils.createElement(this.divJDraw,"div");var j=this.options.jdrawpath==null?JSDraw2.defaultoptions.jdrawpath:this.options.jdrawpath;if(j==null||j==""){this.jdraw=false;scil.Utils.createElement(c,"div","*jdrawpath* for JDraw jar files is not set!",{padding:"20px",color:"red"})}else{var n=null;if(l!=null){n="<param NAME='molstring' VALUE=\""+l.replace(/\n/g,"\\n").replace(/\r/g,"")+'"/>'}var g="<applet code='com.symyx.draw.JDrawEditor' codebase='"+j+"' archive='CsInline.jar,jdrawcore.jar,jdrawapplet.jar' style='border:solid 1px #ddd' width="+(t>0?t:700)+" height="+(f>0?f:350)+">"+n+"</applet>";c.innerHTML=g;this.jdraw=c.firstChild}}else{this.setMolfile(l)}}catch(d){this.jdraw=false;scil.Utils.createElement(this.divJDraw,"div",d.message,{color:"red"})}scil.Utils.createCookie(scil.XDraw.kXDraw,"jdraw");this.tabdatachanged=false;return true},value2Molfile:function(d){if(d==null){return null}var c=new JSDraw2.Mol();if(d.format=="mol"||d.format=="molfile"){c.setMolfile(d.value)}else{c.setXml(d.value)}return c.getMolfile()},getMolfile:function(){if(this.divJSDraw.style.display==""){if(this.jsdraw!=null&&this.jsdraw!=false){return this.jsdraw.getMolfile()}}else{if(this.divJDraw!=null&&this.divJDraw.style.display==""){if(this.jdraw!=null&&this.jdraw!=false){return this.jdraw.getMolString()}}else{if(this.divChemDraw!=null&&this.divChemDraw.style.display==""){if(this.chemdraw!=null&&this.chemdraw!=false){return this._getChemDrawData("chemical/x-mdl-rxn")}}}}return null},getSmiles:function(){if(this.divJSDraw.style.display==""){if(this.jsdraw!=null&&this.jsdraw!=false){return this.jsdraw.getSmiles()}}else{if(this.divJDraw!=null&&this.divJDraw.style.display==""){if(this.jdraw!=null&&this.jdraw!=false){var d=this._getJDrawData();var c=new JSDraw2.Mol();c.setMolfile(d);return c.getSmiles()}}else{if(this.divChemDraw!=null&&this.divChemDraw.style.display==""){if(this.chemdraw!=null&&this.chemdraw!=false){return this._getChemDrawData("chemical/x-daylight-smiles")}}}}return null},setMolfile:function(c){if(c==null||c.length<100){return}if(this.divJSDraw.style.display==""){if(this.jsdraw!=null&&this.jsdraw!=false){this.jsdraw.setMolfile(c)}}else{if(this.divJDraw!=null&&this.divJDraw.style.display==""){if(this.jdraw!=null&&this.jdraw!=false){this._setJDrawData(c)}}else{if(this.divChemDraw!=null&&this.divChemDraw.style.display==""){if(this.chemdraw!=null&&this.chemdraw!=false){this._setChemDrawData("chemical/x-mdl-rxn",c)}}}}},reset:function(){this.clear()},clear:function(){if(this.divJSDraw.style.display==""){if(this.jsdraw!=null&&this.jsdraw!=false){this.jsdraw.clear()}}else{if(this.divJDraw!=null&&this.divJDraw.style.display==""){if(this.jdraw!=null&&this.jdraw!=false){this._setJDrawData("")}}else{if(this.divChemDraw!=null&&this.divChemDraw.style.display==""){if(this.chemdraw!=null&&this.chemdraw!=false){this._setChemDrawData("chemical/cdx")}}}}},setXml:function(f){if(scil.Utils.isNullOrEmpty(f)){return}if(this.divJSDraw.style.display==""){if(this.jsdraw!=null&&this.jsdraw!=false){this.jsdraw.setXml(f,false)}}else{if(this.divJDraw!=null&&this.divJDraw.style.display==""){if(this.jdraw!=null&&this.jdraw!=false){var c=new JSDraw2.Mol();c.setXml(f);var d=c.getMolfile();this._setJDrawData(d)}}else{if(this.divChemDraw!=null&&this.divChemDraw.style.display==""){if(this.chemdraw!=false){if(this.chemdraw!=null&&this.chemdraw!=false){this.chemdraw.Objects.clear();if(JSDrawServices.url!=null){this._setChemDrawData("text/xml",this.convertFile(f,"cdxml"))}else{var c=new JSDraw2.Mol();c.setXml(f);this._setChemDrawData("chemical/x-mdl-rxn",c.getMolfile())}}}}}}},getHtmlAsync:function(c){if(this.divChemDraw.style.display==""){var d=this._getChemDrawData("chemical/cdx");var f=this.options.serviceurl+"?cmd=convertfile";scil.Utils.ajax(f,function(g){c(g.output)},{input:d,base64:true})}else{c(this.getXml())}},getXml:function(){if(this.divJSDraw.style.display==""){if(this.jsdraw!=null&&this.jsdraw!=false){return this.jsdraw.getXml()}}else{if(this.divJDraw!=null&&this.divJDraw.style.display==""){if(this.jdraw!=null&&this.jdraw!=false){try{var g=this._getJDrawData();var f=new JSDraw2.Mol();f.setMolfile(g);return f.getXml()}catch(d){return null}}}else{if(this.divChemDraw!=null&&this.divChemDraw.style.display==""){if(this.chemdraw!=null&&this.chemdraw!=false){if(JSDrawServices.url!=null){var c=this._getChemDrawData("text/xml");return this.convertFile(c,"jsdraw")}else{var g=this._getChemDrawData("chemical/x-mdl-rxn");var f=new JSDraw2.Mol();f.setMolfile(g);return f.getXml()}}}}}return null},getHtml:function(){return this.getXml()},setHtml:function(c){this.setXml(c)},_getChemDrawData:function(g){try{if(scil.Utils.isIE){if(g=="chemical/cdx"||g=="chemical/x-cdx"){this.chemdraw.DataEncoded=true;var c=this.chemdraw.Objects.Data("chemical/cdx");this.chemdraw.DataEncoded=false;return c}return this.chemdraw.Objects.Count==0?null:this.chemdraw.Objects.Data(g)}else{var d=this._chemdrawMimetype2Dt(g);return d==-1?null:this.chemdraw.getData(d)}}catch(f){return null}},_getJDrawData:function(){try{return this.jdraw.getMolString()}catch(c){return null}},_setChemDrawData:function(h,c){try{if(scil.Utils.isIE){this.chemdraw.Objects.clear();if(h=="chemical/cdx"||h=="chemical/x-cdx"){this.chemdraw.DataEncoded=true;this.chemdraw.Objects.Data("chemical/cdx")=c;this.chemdraw.DataEncoded=false}else{this.chemdraw.Objects.Data(h)=c}}else{var d=this._chemdrawMimetype2Dt(h);if(d!=-1){var g=this;setTimeout(function(){g.chemdraw.clear();g.chemdraw.putData(d,c)},1000)}else{alert("Unknown file format: "+h)}}}catch(f){alert(f.Message)}},_setJDrawData:function(c){try{return this.jdraw.setMolString(c)}catch(d){}},_chemdrawMimetype2Dt:function(c){switch(c){case"chemical/x-cdx":case"chemical/cdx":return 0;case"chemical/x-mdl-molfile":case"chemical/x-mdl-rxn":case"chemical/mdl-molfile":case"chemical/mdl-rxn":return 1;case"chemical/x-daylight-smiles":case"chemical/daylight-smiles":return 2;case"chemical/x-questel-f1":case"chemical/questel-f1":return 3;case"chemical/x-questel-f1-query":case"chemical/questel-f1-query":return 4;case"text/xml":return 5;case"chemical/x-name":return 6;case"chemical/x-cml":case"chemical/cml":return 7;case"chemical/x-inchi":case"chemical/inchi":return 8;default:return -1}},redraw:function(){}});scil.apply(scil.XDraw,{kXDraw:"_scilligence_xdraw"});JSDraw2.Plate=scil.extend(scil._base,{constructor:function(f,d,g){this.dlg=null;this.barcode=null;this.rows=null;this.cols=null;this.wellsize=16;this.tablerow=null;this.jss=null;this.options=d==null?{}:d;this._columnchanged=true;this.parentPlates=g;if(this.options.wellsize>0){this.wellsize=this.options.wellsize}if(this.options.resultkey==null){this.options.resultkey="result"}if(this.options.responsekey==null){this.options.responsekey="response"}if(typeof(f)=="string"){f=scil.byId(f)}this.parenttbody=scil.Utils.createTable(f);this.platearea=scil.Utils.createElement(scil.Utils.createElement(this.parenttbody,"tr"),"td",null,{textAlign:"center"});this.tablearea=scil.Utils.createElement(scil.Utils.createElement(this.parenttbody,"tr"),"td");var c=this;var h=scil.Utils.createTable(this.platearea);var l=scil.Utils.createElement(h,"tr");this.create(scil.Utils.createElement(l,"td"));var j=scil.Utils.createElement(l,"td",null,{verticalAlign:"bottom"});if(this.options.showtable!=false){scil.Utils.createButton(j,{src:scil.Utils.imgSrc("img/table.gif"),title:"Show/Hide Table",onclick:function(){c.showTable()}})}if(this.options.selectbox!=false){this.selectbox=new JSDraw2.Plate.SelectBox(this)}scil.Utils.unselectable(h.parentNode);this.setSize(this.options);if(this.options.hidetable){this.showTable(false)}},showTable:function(c){if(c==null){c=this.tablearea.style.display=="none"}this.tablearea.style.display=(c?"":"none")},getDefaultFields:function(fordialog){if(this.options.fields!=null){return this.options.fields}var ret=JSDraw2.Plate.kDefaultFields;if(this.options.readouts!=null){var readouts=this.options.readouts;if(typeof(readouts)=="string"){readouts=scil.Utils.eval(readouts)}if(readouts!=null){var old=ret;ret={};for(var k in old){if(k=="response"){for(var k in readouts){ret[k]=scil.clone(readouts[k])}}else{ret[k]=old[k]}}}}if(ret.batch!=null){ret.batch.autosuggesturl=this.options.compoundsuggest}if(ret.color!=null){ret.color.items=JSDraw2.Plate.colors}return ret},getFieldsForDlg:function(){var h={};var f=this.jss.columns;for(var g=2;g<f.length;++g){var d=f[g];h[d.key]=d;h[d.key].label=d.caption}return h},clearWells:function(){for(var c=1;c<this.rows+1;++c){var g=this.tbody.childNodes[c];for(var d=1;d<this.cols+1;++d){var f=g.childNodes[d];this._setWellColor(f,null)}}},clear:function(c){this.clearWells();this.jss.clearAll();if(this.options.onClear!=null){this.options.onClear()}},setSize:function(d){if(d==null){d={}}var g=null;var c=null;if(d.rows>0&&d.cols>0){g=d.rows;c=d.cols}else{var h=(d.size+"").toLowerCase();switch(h){case"1536":g=32;c=48;break;case"384":g=16;c=24;break;case"96":g=8;c=12;break;case"24":g=4;c=6;break;default:var f=h.indexOf("*");if(f>0){g=parseInt(h.substr(0,f));c=parseInt(h.substr(f+1))}break}}if(!(g>0&&c>0)){g=8;c=12}if(g==this.rows||c==this.cols){return false}this.rows=g;this.cols=c;if(this.options.wellsize>0){this.wellsize=this.options.wellsize}else{this.wellsize=Math.round(800/c);if(this.wellsize>40){this.wellsize=40}}this.recreateWells();this.renderTable();if(this.options.onSetSize!=null){this.options.onSetSize()}return true},renderTable:function(){if(this.jss!=null){return this.jss}this.tablearea.style.display="";this.renderTable2(this.tablearea);if(this.options.showtable==false){this.tablearea.style.display="none"}},renderTable2:function(g){var f=this;var c=scil.Utils.createElement(g,"div");var h;if(this.options.viewonly){h=["save"]}else{h=[{iconurl:scil.Utils.imgSrc("img/new.gif"),tooltips:"Clear",onclick:function(){f.clearPlate()}},"open","save","|",{iconurl:scil.Utils.imgSrc("img/selectall.gif"),tooltips:"Change Plate Size",onclick:function(){f.changeSize()}},"|",{iconurl:scil.Utils.imgSrc("img/pivot.gif"),tooltips:"Change Display Order",onclick:function(){f.changeDisplayOrder()}}];if(this.options.canchangefields){h.push("|");h.push("definecolumns")}}if(this.parentPlates==null){if(!this.options.viewonly){h.push("|");h.push({iconurl:scil.Utils.imgSrc("img/pen.gif"),tooltips:"Table Editor",onclick:function(){JSDraw2.Plates.TableEditor.show(f)}});h.push("|");h.push({iconurl:scil.Utils.imgSrc("img/assayplate.gif"),tooltips:"Layout Samples",onclick:function(){f.layoutCompounds()}});h.push({iconurl:scil.Utils.imgSrc("img/dilute.gif"),tooltips:"Serial Dilution",onclick:function(){JSDraw2.Plate.Dilution.show(f)}})}h.push("|");h.push({iconurl:scil.Utils.imgSrc("img/heatmap.gif"),tooltips:"Show Heatmap",onclick:function(){JSDraw2.Plate.showHeatmap(f)}})}if(this.options.tabletoolbar!=null&&this.options.tabletoolbar.length>0){h.push("|");for(var d=0;d<this.options.tabletoolbar.length;++d){h.push(this.options.tabletoolbar[d])}}if(this.options.ontabletoolbar!=null){this.options.ontabletoolbar(h)}this.jss=new JSDraw2.Table(null,{viewonly:this.options.viewonly,width:this.options.width,spreadsheet:this.options.canchangefields,selectbox:this.options.selectbox!=false,selectboxviewonly:this.options.selectboxviewonly,copymode:this.options.copymode,fixrows:true,overwritekey:"position",columns:this.getDefaultFields(),toolbar:h,onLoadTable:function(){f.onloadtable()},onclearall:function(){f.oncleartable()},onCellChanged:function(l,j){f.oncellchanged(l,j)},onColChange:function(){f._columnchanged=true;if(f.options.onColChanged!=null){f.options.onColChanged()}},onCreateTable:function(j){f.clearWells();f.jss=j;f.refreshTable()}},c)},layoutCompounds:function(){JSDraw2.Plate.Layout.show(this)},clearPlate:function(){var c=this;scil.Utils.confirmYes("Clear all data?",function(){c.clear()})},changeSize:function(){if(this.sizeDlg==null){var f=this;var d=this.options.sizes;if(d==null){d=JSDraw2.Plate.kSizes}var c={size:{label:"New Size",type:"select",items:d,sort:false}};this.sizeDlg=scil.Form.createDlgForm("Change Size",c,{label:"Change",onclick:function(){f.changeSize2()}})}this.sizeDlg.show();this.sizeDlg.form.setData({})},changeSize2:function(){this.sizeDlg.hide();var c=this.sizeDlg.form.fields.size.value;if(c==null||c==""){return}this.setSize({size:c})},onloadtable:function(){this.clearWells();for(var d=0;d<this.jss.getRowCount();++d){var c=this.jss.getRowValues(d);this.setWellData(c.position,c,null,false)}},oncleartable:function(){this.clearWells()},oncellchanged:function(f,c){var d=this.jss.getRowValues(f);this.setWellData(d.position,d);if(this.options.oncellchanged!=null){this.options.oncellchanged(this,f,c)}},create:function(f){var d=this;var c=scil.Utils.isNullOrEmpty(this.options.background)?"#444":this.options.background;this.tbody=scil.Utils.createTable(f,0,0,{textAlign:"center",background:c,borderRadius:"4px"});this.tbody.parentNode.setAttribute("align","center");var g=this.tbody.parentNode;g.style.borderRight="10px solid "+c;g.style.borderBottom="10px solid "+c;dojo.connect(g,"ondblclick",function(h){d.onDblClickWell(h)});dojo.connect(g,"onclick",function(h){d.onClickWell(h)});if(this.options.tooltip!=null){this.tooltips=new scil.TooltipForm(g,{fields:this.options.tooltip.fields,ongetkey:function(h){return d.onTooltipGetKey(h)},ongetcaption:function(h){return h},ongetdata:function(h){return d.options.tooltip.ongetdata(h,d)}})}},recreateWells:function(){scil.Utils.removeAll(this.tbody);for(var d=0;d<this.rows+1;++d){var h=scil.Utils.num2letter(d);var g=scil.Utils.createElement(this.tbody,"tr");for(var c=0;c<this.cols+1;++c){var f=scil.Utils.createElement(g,"td");if(c>0&&d>0){f.setAttribute("well",h+c);this._setWellColor(f,null);if(this.options.wellcolor!=null){f.style.backgroundColor=this.options.wellcolor}if(this.options.gridline){if(c==1){f.style.borderLeft="solid 1px gray"}if(d==1){f.style.borderTop="solid 1px gray"}f.style.borderRight="solid 1px gray";f.style.borderBottom="solid 1px gray"}else{if(this.rows==16&&this.cols==24){if(c==12){f.style.borderRight="solid 1px gray"}if(d==8){f.style.borderBottom="solid 1px gray"}}}}else{f.style.color="#fff";f.style.fontSize=d==0?"60%":"75%";f.style.padding="0 2px 0 2px";if(c==0&&d==0){f.style.background=scil.Utils.imgSrc("img/plate-corner.gif",true)+" no-repeat"}else{if(d==0){f.innerHTML=c}else{if(c==0){f.innerHTML=h}}}}}}this.refreshTable()},changeDisplayOrder:function(){var c=this.jss.getJson().rows;var f={};for(var d=0;d<c.length;++d){f[c[d].position]=c[d]}this.options.pivotflag=!this.options.pivotflag;this.refreshTable(f)},refreshTable:function(h){if(this.jss==null){return}this.jss.clear();if(this.options.pivotflag){for(var f=1;f<this.rows+1;++f){var l=scil.Utils.num2letter(f);for(var d=1;d<this.cols+1;++d){var g=l+d;var c=h==null||h[g]==null?{position:g}:h[g];this.jss.insert(false,c)}}}else{for(var d=1;d<this.cols+1;++d){for(var f=1;f<this.rows+1;++f){var g=scil.Utils.num2letter(f)+d;var c=h==null||h[g]==null?{position:g}:h[g];this.jss.insert(false,c)}}}},onDblClickWell:function(c){var d=c.srcElement||c.target;if(d.tagName!="IMG"||!this.isWell(d.parentNode)){return}if(this.options.ondblclickwell!=null){this.options.ondblclickwell(d.parentNode,this)}else{this.showDlg(d.parentNode)}},onClickWell:function(c){if(this.options.onclickwell!=null){var d=c.srcElement||c.target;if(d.tagName=="IMG"&&this.isWell(d.parentNode)){this.options.onclickwell(d.parentNode,this)}}},getXml:function(){var c="<plate rows='"+this.rows+"' cols='"+this.cols+"'";if(!scil.Utils.isNullOrEmpty(this.barcode)){c+=" barcode='"+scil.Utils.escXmlValue(this.barcode)+"'"}c+=">"+this.jss.getXml();c+="</plate>";return c},setXml:function(h,c){if(c==null){c=true}var f=null;if(typeof(h)=="string"){f=scil.Utils.firstElement(scil.Utils.parseXml(h),"plate")}else{f=h}this.clearWells();if(f!=null){var g=parseInt(f.getAttribute("rows"));var d=parseInt(f.getAttribute("cols"));if(g>0&&d>0&&(g!=this.rows||d!=this.cols)){this.setSize({rows:g,cols:d})}this.barcode=f.getAttribute("barcode");if(this.options.canchangefields){this.jss.setXml(scil.Utils.firstElement(f,"jssdf"),null,true,false)}else{this.jss.setXml(scil.Utils.firstElement(f,"jssdf"),null,c)}}else{this.jss.clear(true)}if(this.jss.columns==null){this.jss.createTable()}},isWell:function(d){var c=this.getWellPos(d);return !scil.Utils.isNullOrEmpty(c)},onTooltipGetKey:function(c){var d=c.srcElement||c.target;if(d.tagName=="IMG"){return this.getWellPos(d.parentNode)}return null},getWellPos:function(c){return c.getAttribute("well")},showDlg:function(g){if(!this.isWell(g)){return}if(this.dlg==null||this._columnchanged){var d=this;this.dlg=scil.Form.createDlgForm("Well - "+g.getAttribute("well"),this.getFieldsForDlg(),[{label:scil.Utils.imgTag("tick.gif",scil.Utils.res("OK")),onclick:function(){if(!d.options.viewonly){d._saveWellData()}d.dlg.hide()}},{label:scil.Utils.imgTag("del.gif",scil.Utils.res("Clear")),onclick:function(){if(!d.options.viewonly){d._saveWellData(true)}d.dlg.hide()}}],{viewonly:this.options.viewonly});this._columnchanged=false}var f=g.getAttribute("well");this.dlg.td=g;this.dlg.show("Well - "+f);var c=this.getWellData(f);this.dlg.form.setData(c)},isDataChanged:function(c,d){if(c==d){return false}if(c==null||d==null){return true}for(var f in c){if(c[f]!=d[f]){return true}}return false},getWell:function(f,g){if(typeof(f)=="string"&&g==null){var c=f.replace(/[0-9]+$/i,"");g=parseInt(f.substr(c.length))-1;f=scil.Utils.letter2num(c)-1}if(f<0||g<0||f>=this.rows||g>=this.cols){return null}var d=this.tbody.childNodes[f+1];return d==null?null:d.childNodes[g+1]},getWell2:function(d,f){return this.getWell(this.xy2Pos(d+1,f+1))},getCell:function(d,c){return this.getWell(d,c)},getCellPosByScreen:function(q,t){var h=this.tbody.parentNode;var g=scil.Utils.getOffset(h);if(q<g.x||q>g.x+h.offsetWidth||t<g.y||t>g.y+h.offsetHeight){return null}var f=this.tbody.childNodes;for(var c=1;c<f.length;++c){var n=f[c];var l=n.childNodes[0];g=scil.Utils.getOffset(l);if(t>g.y&&t<g.y+l.offsetHeight){for(var d=1;d<n.childNodes.length;++d){l=n.childNodes[d];g=scil.Utils.getOffset(l);if(q>g.x&&q<g.x+l.offsetWidth){return{iRow:c-1,iCol:d-1}}}}}return null},isWellEmpty:function(c){if(c==null){return true}for(var d in c){if(d=="select"||d=="position"||c[d]==null||c[d]==""){continue}return false}return true},getWellData2:function(d,g,f){return this.getWellData(this.xy2Pos(d+1,g+1),f)},setWellData2:function(d,h,f,g){this.setWellData(this.xy2Pos(d+1,h+1),f,g)},getWellData:function(f,c){var d=this.jss.getRowByColValue("position",f);if(c==null){return this.jss.getRowValues(d)}else{return this.jss.getCellValue(d,c)}},setWellData:function(l,f,g,h){var j=this.jss.getRowByColValue("position",l);if(g==null){var c=f==null?{}:scil.clone(f);c.position=l;this.jss.setRowValues(j,c)}else{this.jss.setCellValue(j,g,f);f=this.getWellData(l)}var n=this.getWell(l);if(this.isWellEmpty(f)){this._setWellColor(n,null)}else{this._setWellColor(n,f)}if(h!=false&&this.options.onsetwelldata!=null){this.options.onsetwelldata(l)}},_saveWellData:function(c){var f=this.dlg.td.getAttribute("well");var d=c?{}:this.dlg.form.getData();this.saveWellData(f,d)},getMatrix:function(f){var g=new JSDraw2.Matrix();for(var h=0;h<this.rows;++h){for(var d=0;d<this.cols;++d){g.setValue(h,d,this.getWellData2(d,h,f))}}return g},setMatrix:function(g,f){for(var h=0;h<this.rows;++h){for(var d=0;d<this.cols;++d){this.saveWellData2(d,h,g.getValue(h,d),f)}}},saveWellData2:function(d,h,f,g){this.saveWellData(this.xy2Pos(d+1,h+1),f,g)},setFieldData:function(f,h){for(var g=0;g<this.rows;++g){for(var d=0;d<this.cols;++d){this.saveWellData(this.xy2Pos(d+1,g+1),h,f)}}},setRowData:function(j,f,g,h){for(var d=0;d<this.cols;++d){if(h==null){this.saveWellData(this.xy2Pos(d+1,j+1),f,g)}else{this.saveWellData(this.xy2Pos(d+1,j+1),h[d],g)}}},setColumnData:function(d,f,g,h){for(var j=0;j<this.rows;++j){if(h==null){this.saveWellData(this.xy2Pos(d+1,j+1),f,g)}else{this.saveWellData(this.xy2Pos(d+1,j+1),h[j],g)}}},saveWellData:function(g,c,d){if(d==null){var f=this.getWellData(g);if(!this.isDataChanged(f,c)){return false}if(c==null){c={}}c.position=g;this.setWellData(c.position,c);return true}else{var f=this.getWellData(g,d);if(f==""){f=null}if(c==""){c=null}if(f==c){return false}this.setWellData(g,c,d);return true}},_setWellColor:function(j,d){if(j==null){return}var c;var h="";if(d==null){c=null}else{if(d.color==null||d.color==""){var h=(d.batch||d.lotno);if(h!=null){h=h.toLowerCase()}if(h==JSDraw2.Plate.kNegative||h==JSDraw2.Plate.kPositive){c=h}else{c="gray"}}else{c=d.color}if(this.options.tooltip==null){for(var g in d){var l=d[g];if(g!="color"&&l!=null&&l!=""){h+=g+": "+l+"\n"}}}}if(c==null||c==""){c="white"}else{if(c!="white"){c=scil.Utils.indexOf(JSDraw2.Plate.colors,c)==-1?"gray":c}}scil.Utils.removeAll(j);var f=scil.Utils.createElement(j,"img",null,{verticalAlign:"middle",width:this.wellsize},{title:h,src:scil.Utils.imgSrc("img/plate-"+c+".png")});f.ondragstart=function(){return false}},getFields:function(){var h={"":""};for(var f=0;f<this.jss.columns.length;++f){var d=this.jss.columns[f];if(d.key!="position"&&d.type!="id"){var g=d.key||d.caption;var j=scil.Utils.trim(d.caption||d.key);if(!scil.Utils.isNullOrEmpty(g)&&!scil.Utils.isNullOrEmpty(j)){h[g]=j}}}return h},getHeaders:function(){var g="";for(var f=2;f<this.jss.columns.length;++f){var d=this.jss.columns[f];if(f>2){g+="\t"}g+=d.caption}g+="\r\n";return g},getFieldMatrix:function(f){var n="[]";for(var g=0;g<this.cols;++g){n+="\t"+(g+1)}n+="\n";for(var g=0;g<this.rows;++g){n+=scil.Utils.num2letter(g+1);for(var h=0;h<this.cols;++h){var l=this.options.pivotflag?(g*this.cols+h):(h*this.rows+g);var d=this.jss.getCellValue(l,f);n+="\t"+(d==null?"":d)}n+="\n"}return n},getArray:function(f){var q=[];for(var g=0;g<this.rows;++g){var n=[];for(var h=0;h<this.cols;++h){var l=this.options.pivotflag?(g*this.cols+h):(h*this.rows+g);var d=this.jss.getCellValue(l,f);n.push(d==null||d==""||isNaN(d)?d:parseFloat(d))}q.push(n)}return q},getResponseArray:function(g,f){var u=[];for(var h=0;h<this.rows;++h){var t=[];for(var l=0;l<this.cols;++l){var n=this.options.pivotflag?(h*this.cols+l):(l*this.rows+h);var q=this.jss.getCellValue(n,g);var d=this.jss.getCellValue(n,f);q=q==null||q==""||isNaN(q)?null:parseFloat(q);d=d==null||d==""||isNaN(d)?null:parseFloat(d);if(q!=null&&d!=null){t.push({r:q,c:d})}else{t.push(null)}}u.push(t)}return u},testFormula:function(f){var c=this.getPlateData(this.options.responsekey);try{JSDraw2.Plate.runFormula(c,f,this);return"Looks good!"}catch(d){return d+""}},runFormula:function(f){var d=this.getPlateData(this.options.responsekey);JSDraw2.Plate.runFormula(d,f,this);for(var g in d){var h=d[g];if(h==null){continue}for(var c in h){if(c!=this.options.responsekey){this.setWellData(g,h[c],c)}}}},oncalculate:function(f){var d=this.getPlateData(this.options.responsekey);f(d);for(var g in d){var j=d[g];if(j==null){continue}for(var c in j){if(c!=this.options.responsekey){var h=j[c];this.setWellData(g,isNaN(h)?null:h,c)}}}},getControls:function(l){var f={color:{}};f[l]={};this.getDataList(f);var j=[];var g=[];var d=f[l];for(var h in d){var c=f.color[h];if(c==JSDraw2.Plate.kPositive){j.push(parseFloat(d[h]))}else{if(c==JSDraw2.Plate.kNegative){g.push(parseFloat(d[h]))}}}return{positive:j,negative:g}},getFieldKeys:function(h){var d={};var f;var g=new RegExp("[{][a-z|_][a-z|_|0-9]{0,999}[}]","i");while(h.indexOf("{")>=0){f=g.exec(h);if(f==null||f.length==0){break}f=f[0];var c=f.substr(1,f.length-2);d[c]={};h=h.replace(f,"")}return d.length==0?null:d},calculate:function(F,D,j,n,A,g){var t=this.getFieldKeys(n);var l={color:{}};var G=n=="avg"||n=="max"||n=="min"||n=="median"||n=="sum";if(G){l[JSDraw2.Plate.kBatch]={}}l[F]={};if(t!=null){for(q in t){l[q]={}}}l[JSDraw2.Plate.kKnockout]={};this.getDataList(l);var H=typeof(n)=="string"&&(n.indexOf("HPE")>=0||n.indexOf("ZPE")>=0);if(j==null){j=2}var E={result:{}};var h=l[F];var u=l[JSDraw2.Plate.kKnockout];if(G){var c=l[JSDraw2.Plate.kBatch];var f=this.groupCompounds(c,h,u);for(var q in f){var I=this.calcFormula(f[q].values,n);I=I==null||isNaN(I)?null:scil.Utils.round(I,j);E.result[q]=I;if(D!=null){this.setWellData(f[q].pos,I,D)}}}else{var C=[];var z=[];for(var B in h){var d=l.color[B];var I=parseFloat(h[B]);if(H){if(d==JSDraw2.Plate.kPositive){if(u==null||!scil.Utils.isTrue(u[B])){C.push(I)}I=null}else{if(d==JSDraw2.Plate.kNegative){if(u==null||!scil.Utils.isTrue(u[B])){z.push(I)}I=null}}}h[B]=I}if(H){if(C.length==0&&g!=null){C=g.positive}if(C!=null&&C.length==0){scil.Utils.alert("No positive control found");return null}if(z.length==0&&g!=null){z=g.negative}if(z!=null&&z.length==0){scil.Utils.alert("No negative control found");return null}}E.hpe=JSDraw2.Plate.calcAvgStdev(C);E.zpe=JSDraw2.Plate.calcAvgStdev(z);E.z=1-3*(E.hpe.stdev+E.zpe.stdev)/Math.abs(E.zpe.avg-E.hpe.avg);JSDraw2.Plate.__currentplate=this;var y=this;if(typeof(n)=="string"){n=n.replace(/[(][A-Z][0-9]+[)]/g,function(w){return h[w.substr(1,w.length-2)]});n=n.replace("standardcurve.","JSDraw2.Plate.__currentplate.getStandardCurve().m.graphics[0].")}var J=(E.zpe.avg-E.hpe.avg)/100;for(var B in h){var K=h[B];var I=JSDraw2.Plate.normalizeFun(n,K,E,B,l,t);I=I==null||isNaN(I)?null:scil.Utils.round(I,j);E.result[B]=I;if(D!=null){this.setWellData(B,I,D)}}}if(A!=null){A(E,this)}return E},calcFormula:function(d,c){if(d==null||d.length==0){return null}switch(c){case"avg":return scil.Math.avg(d);case"max":return scil.Math.max(d);case"min":return scil.Math.min(d);case"median":return scil.Math.median(d);case"sum":return scil.Math.sum(d);default:return null}},groupCompounds:function(d,f,h){var j={};for(var g in d){var c=d[g];var l=parseFloat(f[g]);if(scil.Utils.isNullOrEmpty(c)||isNaN(l)){continue}if(h!=null&&scil.Utils.isTrue(h[g])){continue}if(j[c]==null){j[c]={pos:g,values:[]}}j[c].values.push(l)}return j},getDataList:function(d){var c={};for(var h in d){c[h]=this.jss.getColIndex(h);d[h]={}}var g=this.jss.getColIndex("position");for(var f=0;f<this.jss.getRowCount();++f){var j=this.jss.getCellValue(f,g);for(var h in d){d[h][j]=this.jss.getCellValue(f,c[h])}}},getPlateData:function(j){var f={};var h=this.jss.getColIndex("position");for(var g=0;g<this.jss.getRowCount();++g){var l=this.jss.getCellValue(g,h);if(j==null){f[l]=this.jss.getRowValues(g)}else{var c={};c[j]=parseFloat(this.jss.getCellValue(g,j));f[l]=c}}return f},selectPlateValues:function(d,j,l,f,g){var h=[];for(var c=0;c<this.jss.getRowCount();++c){var n=this.jss.getCellValue(c,j);if(n!=l){continue}if(f!=null){n=this.jss.getCellValue(c,f);if(n==g){continue}}h.push(this.jss.getCellValue(c,d))}return h},setRepeatingData:function(f,q,h,w){if(f==null||f==""||q==null||q==""){return}if(q=="All"){q="A1-"+scil.Utils.num2letter(this.rows)+this.cols}var c=0;var t=q.toUpperCase().replace(/,/g,";").split(";");for(var g=0;g<t.length;++g){var n=scil.Utils.trim(t[g]);if(n.length==0){continue}if(/^[A-Z]+$/.test(n)){n=n+"1-"+n+this.cols}else{if(/^[0-9]+$/.test(n)){n="A"+n+"-"+scil.Utils.num2letter(this.rows)+n}}var j=n.indexOf("-");if(j<0){if(this._setRepeatingData(f,scil.Utils.trim(n),h,w)){++c}}else{var u=this.pos2Xy(n.substr(0,j));var d=this.pos2Xy(n.substr(j+1));if(u==null||d==null){continue}for(var A=Math.min(u.y,d.y);A<=Math.max(u.y,d.y);++A){for(var z=Math.min(u.x,d.x);z<=Math.max(u.x,d.x);++z){var l=scil.Utils.num2letter(A)+z;if(this._setRepeatingData(f,l,h,w)){++c}}}}}if(c>0){this.onloadtable();if(this.options.onSetData!=null){this.options.onSetData()}}},pos2Xy:function(g){g=scil.Utils.trim(g);if(g==""){return null}var f=g.replace(/^[A-Z]+/,"");var c=g.substr(0,g.length-f.length);return isNaN(f)?null:{x:parseInt(f),y:scil.Utils.letter2num(c)}},xy2Pos:function(c,d){return scil.Utils.num2letter(d)+c},_setRepeatingData:function(field,pos,operator,value){var irow=this.jss.getRowByColValue("position",pos);if(irow==null){return false}var v=this.jss.getCellValue(irow,field);switch(operator){case"+":case"-":case"x":case"÷":if(value==null||value==""||isNaN(value)){return false}if(v==null||v==""||isNaN(v)){return false}var v2=parseFloat(value);switch(operator){case"+":value=parseFloat(v)+v2;break;case"-":value=parseFloat(v)-v2;break;case"x":value=parseFloat(v)*v2;break;case"÷":value=parseFloat(v)/v2;break}break;case"append":if(value==null||value==""){return false}else{if(v!=null&&v!=""){value=v+"; "+value}}break;case"formula":var s=scil.Utils.trim(value);if(s.substr(0,1)=="="){s=s.substr(1)}for(var i=0;i<this.jss.columns.length;++i){var k=this.jss.columns[i].caption;var p=k.indexOf("(");if(p>0){k=scil.Utils.trim(k.substr(0,p))}var key="{"+k+"}";var p=s.indexOf(key);if(p>=0){var v3=this.jss.getCellValue(irow,i);do{s=s.replace(key,v3)}while(s.indexOf(key)>=0)}}value=scil.Utils.eval(s);break}this.jss.setCellValue(irow,field,value);return true},appendField:function(c){if(c!=null){if(!(c.width>0)){c.width=100}this.jss.appendColumn(c)}},invert:function(c){var d=this.getMatrix(c);d.invert();this.setMatrix(d,c)},flipV:function(c){var d=this.getMatrix(c);d.flipV();this.setMatrix(d,c)},flipH:function(c){var d=this.getMatrix(c);d.flipH();this.setMatrix(d,c)}});scil.apply(JSDraw2.Plate,{kNegative:"negative",kPositive:"positive",kColor:"color",kBatch:"batch",kKnockout:"masked",kSizes:["",24,96,384],colors:["","negative","positive","dose","","blue","cyan","green","purple","red","yellow","gray"],kDefaultFields:{select:{label:" ",type:"checkbox",width:35,collocked:true},position:{label:"Pos.",width:50,collocked:true,viewonly:true},color:{label:"Color",width:60,type:"select",collocked:true,sort:false},batch:{label:"Batch",width:100,collocked:true},barcode:{label:"Barcode",width:100},volume:{label:"Volume(μL)",type:"number",width:100},solvent:{label:"Solvent",width:90,type:"select",items:JSDraw2.solvents},concentration:{label:"Concentration(μM)",type:"number",width:150},response:{label:"Response",type:"number",width:80},result:{label:"Result",type:"number",width:80},masked:{label:"Exclude",type:"checkbox",width:50,headercheckbox:false},note:{label:"Note",width:150}},kFormulas:{"":"","(Raw-ZPE)/(HPE-ZPE)*100":"(Raw-ZPE)/(HPE-ZPE)*100","(1.0-(Raw-ZPE)/(HPE-ZPE))*100":"(1.0-(Raw-ZPE)/(HPE-ZPE))*100"},normalizeFun:function(formula,v,ret,pos,dict,keys){if((scil.Utils.isNullOrEmpty(v)||isNaN(v))&&keys==null){return null}if(typeof(formula)=="string"){var s=formula.replace("Raw",v==null).replace(/HPE/g,ret.hpe.avg).replace(/ZPE/g,ret.zpe.avg).replace(/HPE/g,ret.hpe.avg);if(keys!=null){for(var k in keys){s=s.replace(new RegExp("\\{"+k+"\\}","g"),dict[k][pos])}}return scil.Utils.eval(s)}else{if(typeof(formula)=="function"){return formula(v,ret,pos,data)}}},calcAvgStdev:function(c){return{avg:scil.Utils.avg(c),stdev:scil.Utils.stdev(c)}},showHeatmap:function(g){this.plate=g;if(this.heatmapDlg==null){var f=this;var d={field:{type:"select",leading:"Select Field: ",onchange:function(){f.heatmapSelectField()}},colorprofile:{type:"select",leading:"Color Profile: ",items:scil.Utils.getDictKeys(JSDraw2.ColorProfile.colors),onchange:function(){f.heatmapSelectField()}},map:{type:"div",colspan:2}};if(!g.options.viewonly){d.hints={label:"",type:"html",template:"<div style='color:orange'>(Click cells to exclude/include data points)</div>"}}var c=null;if(g.parentPlates!=null){c=[{label:"Previous Plate",onclick:function(){f.showNextHeatmap(-1)}},{label:"Next Plate",onclick:function(){f.showNextHeatmap(+1)}}];if(!g.options.viewonly){if(g.options.caninvert!=false){c.push(" ");c.push({label:"Invert",onclick:function(){f.plate.invert(f.heatmapDlg.form.fields.field.value);f.heatmapSelectField()}})}if(g.options.canflip!=false){c.push(" ");c.push({label:"Flip Vertical",onclick:function(){f.plate.flipV(f.heatmapDlg.form.fields.field.value);f.heatmapSelectField()}});c.push({label:"Flip Horizontal",onclick:function(){f.plate.flipH(f.heatmapDlg.form.fields.field.value);f.heatmapSelectField()}})}}}this.heatmapDlg=scil.Form.createDlgForm("Heatmap",d,c,{hidelabel:true})}this.heatmapDlg.show();scil.Utils.listOptions(this.heatmapDlg.form.fields.field,g.getFields(),g.options.responsekey,true);if(this.heatmapDlg.map==null){this.heatmapDlg.map=new JSDraw2.HeatMap(this.heatmapDlg.form.fields.map,g.options.viewonly?null:{onclick:function(l,h,j){g.setWellData(g.xy2Pos(h+1,l+1),j,JSDraw2.Plate.kKnockout)},canclick:function(){return f.heatmapDlg.form.fields.field.value==g.options.responsekey}})}this.heatmapSelectField();this.heatmapDlg.moveCenter()},showNextHeatmap:function(c){if(this.plate==null||this.plate.parentPlates==null){return}if(this.plate.parentPlates.nextPlate(c)){this.heatmapSelectField()}else{scil.Utils.alert("Out of range")}},heatmapSelectField:function(){var d=this.heatmapDlg.form.fields.field.value;var c=this.heatmapDlg.form.fields.colorprofile.value;this.heatmapDlg.map.setData({rows:this.plate.getArray(d),masks:this.plate.getArray(JSDraw2.Plate.kKnockout),colorprofile:c});var f=this.plate.barcode;this.heatmapDlg.setTitle("Heatmap"+(scil.Utils.isNullOrEmpty(f)?"":" - "+f))},setXmlBarcode:function(j,c,h,d){var f=scil.Utils.parseXml(j);var g=scil.Utils.firstElement(f,"plate");if(g==null){return"<plate rows='"+h+"' cols='"+d+"'"+(scil.Utils.isNullOrEmpty(c)?"":" barcode='"+scil.Utils.escXmlValue(c)+"'")+"/>"}g.setAttribute("barcode",c==null?"":c);return scil.Utils.getOuterXml(f)},_round:function(c){var f=JSDraw2.Plate.__data;for(var h in f){var j=f[h];for(var g in j){j[g]=scil.Utils.round(j[g],c)}}},runFormula:function(data,s,plate){JSDraw2.Plate.__data=data;JSDraw2.Plate.__plate=plate;var st={script:s};while(this.replaceLoop(st)){}s=st.script;var list=[];for(var k in data){s=s.replace(new RegExp(k+"[\\.]","g"),"data."+k+".")}s="var data=JSDraw2.Plate.__data; var plate=JSDraw2.Plate.__plate; var avg=scil.Math.avg; var stdev=scil.Math.stdev; var sum=scil.Math.sum; var min=scil.Math.min; var max=scil.Math.max; var rsd=scil.Math.rsd; var round=JSDraw2.Plate._round;"+s;eval(s)},replaceLoop:function(x){var t=x.script;var c="LOOPBEGIN(";var f="LOOPEND";var n=t.lastIndexOf(c);if(n<0){return false}var u=t.substr(0,n);t=t.substr(n+c.length);n=t.indexOf(")");var l=t.substr(0,n);t=t.substr(n+1);n=t.indexOf(f);var w=t.substr(n+f.length);var d=t.substr(0,n);n=l.indexOf(":");var y=l.substr(0,n).replace(/ /g,"").split(",");var h=l.substr(n+1).replace(/ /g,"").split(",");for(var g=0;g<h.length;g+=y.length){var q=d;for(var j=0;j<y.length;++j){q=q.replace(new RegExp(y[j],"g"),h[g+j])}u+=q}x.script=u+w;return true}});JSDraw2.Plate.Counter=scil.extend(scil._base,{constructor:function(c,d){this.n=c;this.i=0;this.value=d==null?1:d},next:function(){++this.i;if(this.i>this.n){this.i=1;++this.value}return this.value}});JSDraw2.Plates=scil.extend(scil._base,{constructor:function(l,j){if(typeof(l)=="string"){l=scil.byId(l)}this.options=j==null?{}:j;this.verifykeys=["concentration","volume","solvent"];this.formula=this.options.formula;if(this.options.showtemplateplate==null){this.options.showtemplateplate=true}var h=this;var c=this.options.buttons;if(c==null&&!this.options.viewonly){c=[{src:scil.Utils.imgSrc("img/save.gif"),title:"Save Excel File",onclick:function(){h.saveFile()}},"|",{src:scil.Utils.imgSrc("img/new.gif"),title:"Remove all plates",onclick:function(){h.clear(true)}},{src:scil.Utils.imgSrc("img/add.gif"),title:"Add Plate",onclick:function(){h.addPlate()}},{src:scil.Utils.imgSrc("img/del.gif"),title:"Delete current plate",onclick:function(){h.delPlate()}},"|",{src:scil.Utils.imgSrc("img/barcode.gif"),title:"Change Plate Barcode",onclick:function(){h.changeBarcode()}},{src:scil.Utils.imgSrc("img/templates.gif"),title:"Fill Samples",onclick:function(){h.fillCompounds()}},"|",{iconurl:scil.Utils.imgSrc("img/assayplate.gif"),tooltips:"Layout Samples",onclick:function(){h.choosePlate(0);h.plate.layoutCompounds()}},{iconurl:scil.Utils.imgSrc("img/dilute.gif"),tooltips:"Serial Dilution",onclick:function(){h.choosePlate(0);JSDraw2.Plate.Dilution.show(h.plate)}},"|",{iconurl:scil.Utils.imgSrc("img/pen.gif"),tooltips:"Table Editor",onclick:function(){JSDraw2.Plates.TableEditor.show(h)}},{iconurl:scil.Utils.imgSrc("img/heatmap.gif"),tooltips:"Show Heatmap",onclick:function(){JSDraw2.Plate.showHeatmap(h.plate)}}];if(this.options.templates){c.push({src:scil.Utils.imgSrc("img/template.gif"),title:"Plate Templates",onclick:function(){h.showTemplate()}})}if(this.options.calculate!=false){c.push("|")}c.push({src:scil.Utils.imgSrc("img/calc.gif"),title:"Calculate results from raw values",onclick:function(){h.calculate()}});if(this.options.setformula!=false){c.push({src:scil.Utils.imgSrc("img/text.gif"),title:"Set calculation formula",onclick:function(){h.setFormula()}})}if(this.options.toolbar!=null&&this.options.toolbar.length>0){c.push("|");for(var g=0;g<this.options.toolbar.length;++g){c.push(this.options.toolbar[g])}}}var d=scil.Utils.createElement(l,"div",null,{background:"#eee",border:"solid 1px #ddd"});this.tr=scil.Utils.createElement(scil.Utils.createTable(d,0,0,{border:"solid 1px #ddd"}),"td");scil.Utils.createElement(this.tr,"td","Plates:",{background:"#eee",padding:"2px",borderRight:"solid 1px #ddd"});this.grid=scil.Utils.createElement(this.tr,"td",null,{background:"#fff",padding:"2px"},null,function(q){h.clickPlate(q)});if(this.options.onplatetoolbar!=null){this.options.onplatetoolbar(c)}var n=scil.Utils.createElement(this.tr,"td",null,{background:"#eee",padding:"2px",borderLeft:"solid 1px #ddd"});scil.Form.createToolbarButtons(n,c);if(this.options.oncellchanged!=null){var f=this.options.oncellchanged;this.options.oncellchanged=function(t,u,q){f(h,u,q)}}d=scil.Utils.createElement(l,"div");this.plate=new JSDraw2.Plate(d,this.options,this);this.clear2()},showTemplate:function(){var c=this;scil.Page.MyTable.showSearch("platetemplates",function(d){scil.Utils.ajax("ajax.ashx?cmd=mytable.platetemplates.load",function(f){c.plate.setXml(f.xml)},{plateid:d[0].plateid})},{active:1})},openFile:function(){var c=this;scil.FileUploader.upload({caption:"Open Excel File",url:JSDrawServices.url+"?cmd=plates.openfile",callback:function(d){var f=JSDraw2.Base64.decode(d.base64);c.setXml(f)}})},saveFile:function(){var c={xml:this.getXml()};scil.Utils.post(JSDrawServices.url+"?cmd=plates.savefile",c,"_blank")},addPlates:function(){var d=this;var f=this.options.addplatesurl;if(scil.Utils.isNullOrEmpty(f)){scil.Utils.alert("*addplatesurl* is not configured yet");return}if(this.addPlatesDlg==null){var c={barcodes:{label:"Plate Barcodes",type:"textarea",width:400,height:100,str:"(one barcode per line)"},status:{label:"Set Plate Status",type:"select",items:["","Disposed","Used"]}};var d=this;this.addPlatesDlg=scil.Form.createDlgForm("Add Data Plates",c,{label:"OK",onclick:function(){d.addPlates2(f)}})}this.addPlatesDlg.show();this.addPlatesDlg.form.setData({})},addPlates2:function(d){var c=this.addPlatesDlg.form.getData();this.addPlatesDlg.hide();this.addNextPlate(c.barcodes.split("\n"),c.status,d,this._startIndex())},addNextPlate:function(g,h,j,d){var c=null;for(;d<g.length;++d){c=scil.Utils.trim(g[d]);if(!scil.Utils.isNullOrEmpty(c)){break}}if(scil.Utils.isNullOrEmpty(c)){return}var f=this;scil.Utils.jsonp(j,function(l){f.addPlate(l.xml,c);f.addNextPlate(g,h,j,d+1)},{barcode:c,status:h})},setFormula:function(){if(this.formulaDlg==null){var c={note:{type:"html",template:"Use this custom formula to normalize plate data (<a href='https://www.scilligence.com/web/assayplate-formula/' target=_blank>manual</a>):"},formula:{type:"code",mode:"javascript",width:800,height:300}};var d=this;this.formulaDlg=scil.Form.createDlgForm("Custom Formula",c,[{label:"Save",onclick:function(){d.setFormula2()}}," ",{label:"Test",onclick:function(){d.testFormula()}}],{hidelabel:true})}this.formulaDlg.show();this.formulaDlg.form.setData({formula:this.formula})},setFormula2:function(){var c=this.formulaDlg.form.getData();this.formula=c.formula;this.formulaDlg.hide()},testFormula:function(){var c=this.formulaDlg.form.getData();var d=this.plate.testFormula(c.formula);scil.Utils.alert(d)},getXml:function(){this.saveCurPlateXml();var g="<plates";if(!scil.Utils.isNullOrEmpty(this.formula)){g+=" formula='"+scil.Utils.escXmlValue(this.formula)+"'"}g+=">";for(var d=0;d<this.plates.length;++d){var f=this.plates[d];var c=this.barcodes[d];g+=JSDraw2.Plate.setXmlBarcode(f,c,this.plate.rows,this.plate.cols)}g+="</plates>";return g},setXml:function(l){var j=null;if(typeof(l)=="string"){j=scil.Utils.firstElement(scil.Utils.parseXml(l),"plates")}else{j=l}var d=j==null?null:j.getAttribute("formula");this.formula=d==null?this.options.formula:d;var g=[];var c=[];var h=j==null?[]:j.getElementsByTagName("plate");for(var f=0;f<h.length;++f){g[f]=scil.Utils.getOuterXml(h[f]);c[f]=h[f].getAttribute("barcode")}if(g.length==0){this.clear2()}else{this._resetData();for(var f=this._startIndex();f<g.length;++f){this.addPlate(g[f],c[f])}this.choosePlate(this._startIndex())}},setBarcode:function(g,c){this.barcodes[g]=c;var f=this.grid.childNodes[g];if(f!=null){f.setAttribute("title",c==null?"":c)}},getCompoundGroup:function(l){var j=this.parsePlateXml(l);if(j==null){return null}var d={};for(var g=0;g<j.length;++g){var h=j[g];if(h==null){continue}var f=null;if(h.color==JSDraw2.Plate.kNegative||h.color==JSDraw2.Plate.kPositive){f=h.color}else{if(!scil.Utils.isNullOrEmpty(h.batch)){f=h.batch}else{continue}}if(d[f]==null){d[f]=[]}d[f].push(h.position)}return d},parsePlateXml:function(l,c){var f=scil.Utils.parseXml(l);var h=f==null?null:f.getElementsByTagName("jssdf");var j=h==null?null:JSDraw2.Table.xml2Rows(h[0]);if(j==null||!c){return j}var d={};for(var g=0;g<j.length;++g){d[j[g].position]=j[g]}return d},getAllCompounds:function(w,A,B){this.saveCurPlateXml();if(w==null){w=["result"]}var f=null;if(B){f=this.getCompoundGroup(this.plates[0])}var j=[];for(var n=A==null?0:A;n<this.plates.length;++n){var d=this.barcodes[n];var z=this.parsePlateXml(this.plates[n],B);if(z==null){continue}if(B){for(var g in f){var t=f[g];var h=z[t[0]].batch;if(g==JSDraw2.Plate.kNegative||g==JSDraw2.Plate.kPositive){continue}var y=[];for(var q=0;q<t.length;++q){var u=z[t[q]];var C={c:u.concentration,m:u.masked,se:u.se,platebarcode:d};for(var D=0;D<w.length;++D){C[w[D]]=u[w[D]]}y.push(C)}j.push({batch:h,data:y})}}else{var l={};for(var q=0;q<z.length;++q){var u=z[q];if(u==null||scil.Utils.isNullOrEmpty(u.batch)){continue}if(l[u.batch]==null){l[u.batch]=[]}if(!scil.Utils.isNullOrEmpty(u.concentration)){var C={c:u.concentration,m:u.masked,se:u.se,platebarcode:d};for(var D=0;D<w.length;++D){C[w[D]]=u[w[D]]}l[u.batch].push(C)}}for(var q in l){j.push({batch:q,data:l[q]})}}}return j},calculate:function(j,h){if(j==null){j="response"}if(h==null){h="result"}if(this.options.onnormalize!=null){this.options.onnormalize(j,h,this);return}if(this.options.oncalculate!=null){for(var d=1;d<this.plates.length;++d){this.choosePlate2(d);this.options.oncalculate(this.plate,this)}return}else{if(!scil.Utils.isNullOrEmpty(this.formula)){for(var d=1;d<this.plates.length;++d){this.choosePlate2(d);this.plate.runFormula(this.formula)}return}}if(this.calcDlg==null){var g=this;var c={formula:{label:"Formula",type:"select",items:scil.Utils.getDictKeys(JSDraw2.Plate.kFormulas)},src:{label:"Input Field (Raw)",type:"select"},result:{label:"Output Field",type:"select"}};this.calcDlg=scil.Form.createDlgForm("Calculate Result",c,{label:"Calculate",onclick:function(){g.calculate2()}})}this.calcDlg.show();var f=this.plate.getFields();scil.Utils.listOptions(this.calcDlg.form.fields.src,f,null,true,false);scil.Utils.listOptions(this.calcDlg.form.fields.result,f,null,true,false);this.calcDlg.form.setData({src:j,result:h})},calculate2:function(){var c=this.calcDlg.form.getData();if(c.src==""||c.result==""){scil.Utils.alert("Please select both Raw column and Result column:");return}this.calcDlg.hide();this.calculate3(c.formula,c.src,c.result)},calculate3:function(d,h,g){if(this.options.onbeforenormplates!=null){this.options.onbeforenormplates()}var c=null;if(this.options.controlonfirstplate){c=this.choosePlate2(1);c=this.plate.getControls(h)}for(var f=1;f<this.plates.length;++f){this.choosePlate2(f);this.plate.calculate(h,g,null,d,this.options.onafternormplate,c)}},changeBarcode:function(){var f=this;var d=this.current;var c=this.barcodes[d];scil.Utils.prompt2({caption:"Change Plate Bar Code",message:"Please enter the new bar code",defaultvalue:c,callback:function(g){if(c!=g){f.setBarcode(d,g);if(f.options.onchanagebarcode!=null){f.options.onchanagebarcode(g)}}}})},addPlate:function(j,c){var h={border:"solid 1px #ccc",margin:"1px",background:"#eee",display:"block","float":"left",width:30,textAlign:"center",cursor:"pointer"};if(JSDraw2.Skin.kRoundish){h.borderRadius="15px"}var g=this.grid.childNodes.length;var f=scil.Utils.createElement(this.grid,"div",this._plateid(g),h,{plate:"1",title:c==null?"":c});this.plates.push(j);this.barcodes.push(c);if(this.options.onaddplate!=null){this.options.onaddplate(this,scil.Utils.isNullOrEmpty(j))}},uploadFile:function(d){var c=this;scil.Utils.uploadFile("Upload Data","Please upload a CSV file","JSDraw/Service.aspx?cmd=openfile",function(g){try{d(JSDraw2.Base64.decode(g.base64),c)}catch(f){scil.Utils.alert("Failed: "+f)}})},uploadData:function(d){var c=this;scil.Utils.uploadFile("Upload Data","Please upload a CSV file","JSDraw/Service.aspx?cmd=openfile",function(g){try{c.uploadData2(JSDraw2.Base64.decode(g.base64),d)}catch(f){scil.Utils.alert("Failed: "+f)}})},uploadData2:function(c,d){JSDraw2.PlateReader.read(this,d,c)},fillCompounds:function(f){if(this.options.onfillcompounds!=null){this.options.onfillcompounds(this);return}if(this.fillDlg==null){var c={xml:{type:"hidden"},list:{label:"Samples",type:"textarea",width:500,height:300,leading:"<div style='color:orange'>One Sample per Line:</div>"},append:{label:"New Plate",type:"select",items:["New","Append to Existing Plate"]}};var d=this;this.fillDlg=scil.Form.createDlgForm("Fill Samples",c,{label:"Fill",onclick:function(){d.fillCompounds2()}})}this.fillDlg.show();this.fillDlg.form.setData({xml:f,append:"New"})},fillCompounds2:function(){var c=this.fillDlg.form.getData();var l=c.list.replace(/[\r|\n|\t|;| ]/g,",").split(",");var g=[];for(var f=0;f<l.length;++f){var j=scil.Utils.trim(l[f]);if(j.length>0){g.push(j)}}if(g.length==0){scil.Utils.alert("No samples");return}if(this.options.onloadcompounds==null){this.fillCompounds3(g,c.xml,c.append)}else{var h=this;this.options.onloadcompounds(g,function(d){h.fillCompounds3(d,c.xml,c.append)})}},fillCompounds3:function(f,j,c){if(this.current==this._startIndex()){this.saveCurPlateXml()}if(scil.Utils.isNullOrEmpty(j)&&this.options.showtemplateplate){j=this.plates[0]}var h=j==null?null:new JSDraw2.Plates.Template(j,"batch");if(h==null||h.compounds==null||h.compounds.length==0){scil.Utils.alert("No samples placed on the template");return}if(c!="New"&&this.plates.length>1){var d=this.plates[this.plates.length-1];var g=h.fillPlate(this,f,d);if(g!=null){this.plates[this.plates.length-1]=g;if(this.current==i){this.plate.setXml(g)}}}while(f.length>0){var g=h.fillPlate(this,f);if(g==null){break}this.addPlate(g)}if(this.options.onafterfillcompounds!=null){this.options.onafterfillcompounds(this)}this.fillDlg.hide()},addCompoundPlates:function(f,d){var c=this;scil.Utils.prompt2({caption:"Add Sample Plates",message:"Please type or scan plate barcodes:",multiline:true,height:300,callback:function(g){c.addCompoundPlates2(f,g,d)}})},addCompoundPlates2:function(q,h,n,c){if(scil.Utils.isNullOrEmpty(h)){return}var j=h.replace(/[\r|\n|\t|;| ]/g,",").split(",");var g=[];for(var f=0;f<j.length;++f){var h=scil.Utils.trim(j[f]);if(h.length>0){g.push(h)}}if(g.length==0){return}if(this.current==this._startIndex()){this.saveCurPlateXml()}if(n==null&&this.options.showtemplateplate){n=this.plates[0]}var l=n==null?null:new JSDraw2.Plates.Template(n,"batch");var d=null;if(c&&l!=null){d=new JSDraw2.Plates.Template(n,"batch")}this.addCompoundPlates3(q,null,g,0,d)},addCompoundPlates3:function(j,h,f,d,c){if(h!=null){if(c!=null){h.xml=c.setControls(h.xml)}this.addCompoundPlate(h.xml,h.barcode)}if(d>=f.length){return}var g=this;scil.Utils.ajax(j,function(l){g.addCompoundPlates3(j,l,f,d+1,c)},{barcode:f[d]})},addCompoundPlate:function(w,j,n){if(n==null&&this.options.showtemplateplate){n=this.plates[0]}var l=n==null?null:new JSDraw2.Plates.Template(n,"batch");if(l!=null&&l.compounds!=null&&l.compounds.length>0){var g=l.verifyPlate(w,this.verifykeys);if(g!=null){scil.Utils.alert(g);return false}}var t=null;var f=this.plate.jss.columns;for(var h=0;h<f.length;++h){var d=f[h];if(d.key=="volume"||d.key=="concentration"){var q=JSDraw2.Plates.getUnit(d.caption);if(q!=null){if(t==null){t={}}t[d.key]=q}}}if(t!=null){w=JSDraw2.Plates.convertUnits(w,t)}this.addPlate(w,j);return true},saveCurPlateXml:function(){this.plates[this.current]=this.plate.getXml()},clear:function(c){if(c){var d=this;scil.Utils.confirmYes("Delete all plates?",function(){d.clear2()})}else{this.clear2()}},clear2:function(){this.formula=this.options.formula;this._resetData();this.addPlate();this.choosePlate(this._startIndex());if(this.options.onclear!=null){this.options.onclear(this)}},_startIndex:function(){return this.options.showtemplateplate?0:1},_resetData:function(){this.current=null;this.plates=[];this.barcodes=[];scil.Utils.removeAll(this.grid);if(!this.options.showtemplateplate){this.plates.push(null);this.barcodes.push(null);scil.Utils.createElement(this.grid,"span")}},delPlate:function(){var c=this;scil.Utils.confirm("Delete the current plate?",function(){c.delPlate2(c.current)})},delPlate2:function(d){if(d==0&&this.options.showtemplateplate){scil.Utils.alert("Cannot delete template plate");return}if(!(d>=1&&d<this.plates.length)){return false}this.plates.splice(d,1);this.barcodes.splice(d,1);this.grid.removeChild(this.grid.childNodes[d]);if(this.plates.length==this._startIndex()){this.clear2()}else{var c=this.current>=d?this.current:null;this.current=null;for(var d=this._startIndex();d<this.plates.length;++d){this.grid.childNodes[d].innerHTML=this._plateid(d)}if(c!=null){this.choosePlate2(c>=this.plates.length?this.plates.length-1:c,false)}}if(this.options.ondelplate!=null){this.options.ondelplate(this)}return true},_plateid:function(c){return c==0?"M":c+""},clickPlate:function(c){var d=c.target||c.srcElement;if(d.getAttribute("plate")!="1"){return}this.choosePlate(d.innerHTML=="M"?0:parseInt(d.innerHTML))},selectPlateByBarcode:function(c){if(scil.Utils.isNullOrEmpty(c)){return null}for(var d=this._startIndex();d<this.plates.length;++d){if(c==this.barcodes[d]){this.choosePlate(d);return d}}return null},nextPlate:function(c){if(this.current==null){return false}return this.choosePlate(this.current+c)},choosePlate:function(d,c){if(!(d>=this._startIndex()&&d<this.plates.length)||d==this.current){return false}this.choosePlate2(d,c);return this.current!=null},choosePlate2:function(d,c){if(this.current!=null&&this.current>=this._startIndex()&&this.current<this.plates.length){this.grid.childNodes[this.current].style.background="#eee";this.grid.childNodes[this.current].style.color="";this.saveCurPlateXml()}if(d!=null&&!isNaN(d)&&d>=this._startIndex()&&d<this.plates.length){var f=this.plates[d];if(scil.Utils.isNullOrEmpty(f)){f=this.plates[this._startIndex()]}this.current=d;this.grid.childNodes[d].style.background="#339";this.grid.childNodes[d].style.color="#fff";this.plate.setXml(f,c);this.plate.barcode=this.barcodes[d]}else{this.current=this._startIndex()}}});scil.apply(JSDraw2.Plates,{convertUnits:function(x,t){if(t==null){return xm}var d=scil.Utils.parseXml(x);var j=scil.Utils.firstElement(d,"plate");var g=scil.Utils.firstElement(j,"jssdf");var n=JSDraw2.Table.xml2Rows(g);if(n==null){return x}var c=false;for(var f=0;f<n.length;++f){var l=n[f];for(var h in t){var u=l[h];var w=JSDraw2.Table.getValueWithoutUnit(u,t[h]);if(u!=w){l[h]=scil.Math.round(w,6);c=true}}}if(!c){return x}var q="<plate rows='"+j.getAttribute("rows")+"' cols='"+j.getAttribute("cols")+"'";q+=" barcode='"+scil.Utils.escXmlValue(j.getAttribute("barcode"))+"'";q+=">"+JSDraw2.Table.rows2Xml(n);q+="</plate>";return q},getUnit:function(c){if(c==null){return null}var d=c.replace(/[(][a-z|μ]+[)]$/i,"");if(d==c){return null}var f=c.substr(d.length);return f.substr(1,f.length-2)},viewTemplate:function(d){var c=this;scil.Utils.ajax("ajax.ashx?cmd=mytable.platetemplates.load",function(f){c.viewTemplate2(f.xml)},{plateid:d})},viewTemplate2:function(d){if(this.viewDlg==null){var c={xml:{type:"plate"}};this.viewDlg=scil.Form.createDlgForm("Plate",c,{label:"Hide",onclick:function(){me.viewDlg.hide()}},{hidelabel:true})}this.viewDlg.show();this.viewDlg.form.setData({xml:d})}});JSDraw2.Plates.Template=scil.extend(scil._base,{constructor:function(q,f){this.wells={};this.compoundkey=f;this.doc=scil.Utils.parseXml(q);this.negativecontrols=[];this.positivecontrols=[];this.controlbatches={};var c=true;this.compounds={};this.wells=this.xml2Wells(this.doc);for(var j in this.wells){var n=this.wells[j];var d=n[this.compoundkey];var h=false;if(n.color==JSDraw2.Plate.kNegative){h=true;this.negativecontrols.push(n.position)}else{if(n.color==JSDraw2.Plate.kPositive){h=true;this.positivecontrols.push(n.position)}}if(!scil.Utils.isNullOrEmpty(d)){if(h){this.controlbatches[d]=true}if(this.compounds[d]==null){this.compounds[d]=[]}this.compounds[d].push(n);if(c&&isNaN(d)){c=false}}}this.compoundlist=scil.Utils.getDictKeys(this.compounds);if(c){var l=[];for(var g=0;g<this.compoundlist.length;++g){l[g]=parseInt(this.compoundlist[g])}l.sort(function(t,u){return t==u?0:(t>u?1:-1)});for(var g=0;g<this.compoundlist.length;++g){this.compoundlist[g]=l[g]+""}}else{this.compoundlist.sort(function(t,u){return t==u?0:(t>u?1:-1)})}},xml2Wells:function(c){if(c==null){return null}var h={};var f=c.getElementsByTagName("r");for(var d=0;d<f.length;++d){var g=JSDraw2.Table.readXmlRow(f[d]);g.node=f[d];h[g.position]=g}return h},setControls:function(j){if(this.negativecontrols.length==0&&this.positivecontrols.length==0){return}doc=scil.Utils.parseXml(j);if(doc==null){return j}var f=doc.getElementsByTagName("r");for(var c=0;c<f.length;++c){var g=JSDraw2.Table.readXmlRow(f[c]);if(scil.Utils.indexOf(this.negativecontrols,g.position)>=0||scil.Utils.indexOf(this.positivecontrols,g.position)>=0){var h=JSDraw2.Table.readXmlRow(this.wells[g.position].node);for(var d in h){this.setNodeValue(f[c],d,h[d])}}}return scil.Utils.getOuterXml(doc)},verifyPlate:function(l,g){var c={};doc=scil.Utils.parseXml(l);var h=doc.getElementsByTagName("r");for(var f=0;f<h.length;++f){var j=JSDraw2.Table.readXmlRow(h[f]);if(this.wells[j.position]==null){return"Invalid position: "+j.position}var d=this.isMatch(j,this.wells[j.position].node,g,c);if(d!=null){return d}}return null},isMatch:function(q,l,j,d){var u=JSDraw2.Table.readXmlRow(l);var c=u[this.compoundkey];var f=q[this.compoundkey];if(d[c]==null){d[c]=f}else{if(!this.eqStr(d[c],f)){return"Samples not match at position: "+q.position+". It should be *"+d[c]+"*, but *"+f+"* found."}}for(var g=0;g<j;++g){var h=j[g];if(!this.eqStr(q[h],u[h])){return"*"+h+"* not match at position: "+q.position+". It should be *"+u[h]+"*, but *"+q[h]+"* found."}}return null},eqStr:function(c,d){return c==d||c==""&&d==null||c==null&&d==""},fillPlate:function(y,f,l){if(f==null||f.length==0||this.compoundlist==null||this.compoundlist.length==0){return null}var x=0;var g=null;var h=null;if(!scil.Utils.isNullOrEmpty(l)){var z=scil.Utils.parseXml(l);h=z==null?null:this.xml2Wells(z)}var g=this.doc;this.clearNodeValues(this.compoundkey,null);for(var j=0;j<this.compoundlist.length;++j){var c=this.compoundlist[j];if(this.controlbatches[c]){if(y.plates.length==1||!y.options.controlonfirstplate){continue}}var u=this.compounds[c];if(h!=null&&this.isCompoundFilled(u,h)){for(var q=0;q<u.length;++q){var A=h[u[q].position];var x=u[q].node;for(var t in A){this.setNodeValue(x,t,A[t])}}continue}var d=this.nextCompound(f);var u=this.compounds[c];for(var q=0;q<u.length;++q){var x=u[q].node;if(scil.Utils.isNullOrEmpty(d)){if(x!=null&&x.parentNode!=null){x.parentNode.removeChild(x)}}else{this.fillWell(y,u[q].position,x,d)}}}return scil.Utils.getOuterXml(g)},nextCompound:function(c){if(c.length==0){return null}var d=c[0];c.splice(0,1);return d},isCompoundFilled:function(d,g){for(var c=0;c<d.length;++c){var f=g[d[c].position];if(f!=null&&!scil.Utils.isNullOrEmpty(f[this.compoundkey])){return true}}return false},fillWell:function(h,j,g,d){var l=this.wells[j];var c=(this.getNodeValue(g,"color")+"").toLocaleLowerCase();if(c==JSDraw2.Plate.kNegative||c==JSDraw2.Plate.kPositive){this.setNodeValue(g,"color",null)}if(d==null||typeof(d)=="string"){this.setNodeValue(g,this.compoundkey,d)}else{for(var f in d){this.setNodeValue(g,f,d[f])}}},clearNodeValues:function(c,f){for(var d in this.wells){this.setNodeValue(this.wells[d].node,c,f)}},getNodeValue:function(g,f){for(var d=0;d<g.childNodes.length;++d){var c=g.childNodes[d];if(c.getAttribute("n")==f){return c.text||c.textContent}}return null},setNodeValue:function(g,f,h){if(h==null){h=""}for(var d=0;d<g.childNodes.length;++d){var c=g.childNodes[d];if(c.getAttribute("n")==f){if(c.text!=null){c.text=h}else{c.textContent=h}}}}});JSDraw2.Plate.Dilution={plate:null,dlg:null,kDefautValues:{stockconcentration:10,topconcentration:10,volumeperwell:"5μL",dilutionfactor:5,points:8,decimal:3},kFields:{stockconcentration:{label:"Stock Concentration",type:"number",unit:"μM",width:100},topconcentration:{label:"Top Concentration",type:"number",unit:"μM",width:100},volumeperwell:{label:"Volume per Well",type:"number",units:["μL","mL"],width:100},dilutionfactor:{label:"Dilution Faction",type:"number",width:100},points:{label:"Sample Points",type:"number",width:100},decimal:{label:"Precision",type:"number",width:100,value:3,str:"(e.g. 3 for 1.200)"},chart:{label:"Dilution Chart",type:"html"}},show:function(u,j,t){this.plate=u;this.fields=j==null?{}:j;this.create();this.dlg.show();this.dlg.form.setData(this.kDefautValues);if(this.fields.batch==null){this.fields.batch="batch"}if(this.fields.concentration==null){this.fields.concentration="concentration"}if(this.fields.volume==null){this.fields.volume="volume"}var d=this.getCompounds();var q=null;if(d!=null){for(var n in d){q=d[n];break}}if(q!=null&&q.length>0){var w=null;var g=[];for(var l=0;l<q.length;++l){var f=parseFloat(q[l].concentration);if(f>0){g.push(f);if(w==null||f>parseFloat(w.concentration)){w=q[l]}}}g.sort(function(z,A){return z==A?0:(z>A?-1:+1)});this.dlg.form.setFieldValue("points",q.length);if(w!=null){if(w.concentration>0){this.dlg.form.setFieldValue("topconcentration",w.concentration)}if(w.volume>0){this.dlg.form.setFieldValue("volumeperwell",w.volume+"μL")}this.dlg.form.setFieldValue("dilutionfactor",g[0]/g[1])}}var h=t==null?null:t.concunit;if(h==null){var c=u.jss.columns;for(var l=0;l<c.length;++l){if(c[l].key==this.fields.concentration){h=this.getConcUnit(c[l].caption);break}}}if(scil.Utils.isNullOrEmpty(h)){h="μM"}this.dlg.form.items.stockconcentration.fieldunit.innerHTML=h;this.dlg.form.items.topconcentration.fieldunit.innerHTML=h;this.kFields.stockconcentration.unit=h;this.kFields.topconcentration.unit=h;this.chart()},getConcUnit:function(c){if(c==null){return null}c=scil.Utils.trim(c);var d=c.replace(/[(][a-z]+[)]$/i,"");if(c==d){return null}var f=c.substr(d.length);f=f.substr(1,f.length-2).toLowerCase();if(f=="um"||f=="mm"||f=="nm"){return f.substr(0,1).replace("u","μ")+"M"}return null},getCompounds:function(){if(this.plate==null){return null}var c={};var f=this.plate.jss;for(var d=0;d<f.getRowCount();++d){var h=f.getCellValue(d,this.fields.batch);if(scil.Utils.isNullOrEmpty(h)){continue}if(c[h]==null){c[h]=[]}var g=f.getRowValues(d);g._index=d;c[h].push(g)}return c},create:function(){if(this.dlg!=null){return}var d=this;var c=[];if(!this.viewonly){c.push({label:"Save",onclick:function(){d.chart(true)}});c.push(" ")}c.push({label:"Print",onclick:function(){d.print()}});this.dlg=scil.Form.createDlgForm("Serial Dilution",this.kFields,c,{onchange:function(){d.chart()}})},print:function(){if(this.printdlg==null){var d=this;var f=scil.Utils.createElement(null,"div");var g=scil.Utils.createElement(f,"div",null,{textAlign:"center",marginBottom:"5px"});scil.Utils.createButton(g,{label:"Print Table",onclick:function(){if(scil.Utils.isIE){d.printiframe.contentWindow.document.execCommand("print",false,null)}else{d.printiframe.contentWindow.print()}}});var c=this.dlg;this.printiframe=scil.Utils.createElement(f,"iframe",null,{border:"solid 1px gray",width:800,height:300},{frameBorder:0});scil.connect(this.printiframe,"onload",function(){d.printiframe.contentWindow.document.write("<html><body></body></html>");d.showPrint()});this.printdlg=new scilligence.Dialog("Print Preview",f);this.printdlg.show()}else{this.printdlg.show();this.showPrint()}},showPrint:function(){var c=this.dlg.form.fields.chart.innerHTML;this.printiframe.contentWindow.document.body.innerHTML=c},chart:function(j){var A="<tr><td>From</td>";var B="<tr><td>To</td>";var C="<tr><td>Vol. to Take</td>";var D="<tr><td>Dilution Vol.</td>";var E="<tr><td>Conc. ("+this.kFields.topconcentration.unit+")</td>";var f=this.dlg.form.getData();var G=JSDraw2.Table.parseValueUnit(f.volumeperwell);var u=parseInt(f.decimal);if(isNaN(u)||!(u>=0)){u=3}var I=null;var q=[];if(G!=null){var z=parseFloat(f.topconcentration);var w=scil.Utils.isNullOrEmpty(f.stockconcentration)?z:parseFloat(f.stockconcentration);var H=parseFloat(G.value);var h=parseFloat(f.dilutionfactor);var t=parseInt(f.points);if(w>0&&z>0&&H>0&&t>1&&h>0){var F=H;var x=F;for(var n=1;n<t;++n){F/=h;x+=F}I=G.unit.replace("u","μ").replace("l","L");var c=z;var y=x*z/w;var g=x-y;A+="<td>Stock</td>";B+="<td>Well 1</td>";C+="<td style='color:blue;background:#fff'>"+scil.Utils.num2str(y,u)+" "+I+"</td>";if(z==w){D+="<td style='color:green;background:#fff;text-align:right'> </td>"}else{D+="<td style='color:green;background:#fff;text-align:right'>"+scil.Utils.num2str(g,u)+" "+I+"</td>"}E+="<td style='color:#000;background:#ccc'>"+scil.Utils.num2str(c,u)+"</td>";q.push({volume:H,concentration:scil.Utils.num2str(c,u)});for(var n=1;n<t;++n){y=x-H;x=y*h;g=x-y;c/=h;q.push({volume:H,concentration:scil.Utils.num2str(c,u)});A+="<td>Well "+n+"</td>";B+="<td>Well "+(n+1)+"</td>";C+="<td style='color:blue;background:#fff;text-align:right'>"+scil.Utils.num2str(y,u)+" "+I+"</td>";D+="<td style='color:green;background:#fff;text-align:right'>"+scil.Utils.num2str(g,u)+" "+I+"</td>";E+="<td style='color:#000;background:#ccc'>"+scil.Utils.num2str(c,u)+"</td>"}}}var l="<table border=1 style='border-collapse:collapse;color:#fff;background:#000'>";l+=A+"</tr>";l+=B+"</tr>";l+=C+"</tr>";l+=D+"</tr>";l+=E+"</tr>";l+="</table>";this.dlg.form.setFieldValue("chart",l);if(j){this.save(q,I,this.kFields.topconcentration.unit);this.dlg.hide()}else{this.dlg.moveCenter()}},findNextBlankWell:function(l,d){var f=this.plate.pos2Xy(l);if(f!=null&&f.x>0&&f.y>0){var h=[l];for(var c=f.x+1;c<=d;++c){var g=this.plate.xy2Pos(c,f.y);var j=this.plate.getWellData(g,this.fields.batch);if(scil.Utils.isNullOrEmpty(j)){h.push(g)}else{break}}if(h.length>=d){return h}h=[l];for(var c=f.y+1;c<=d;++c){var g=this.plate.xy2Pos(f.x,c);var j=this.plate.getWellData(g,this.fields.batch);if(scil.Utils.isNullOrEmpty(j)){h.push(g)}else{break}}return h}return null},save:function(g,w,h){if(this.plate==null){return}var q=g.length;var f=this.getCompounds();if(f==null){return}if(w==null){w=""}else{w=" "+w}if(h==null){h=""}else{h=" "+h}for(var j=0;j<this.plate.jss.columns.length;++j){var d=this.plate.jss.columns[j];if(d.key==this.fields.volume&&this.hasUnit(d.caption,w)){w=""}else{if(d.key==this.fields.concentration&&this.hasUnit(d.caption,h)){h=""}}}for(var d in f){var l=f[d];if(l.length==1){var t=this.findNextBlankWell(l[0].position,g.length);if(t!=null&&t.length>=g.length){for(var j=0;j<g.length;++j){var u=g[j%q];this.plate.setWellData(t[j],d,this.fields.batch);this.plate.setWellData(t[j],u==null?null:u.volume+w,this.fields.volume);this.plate.setWellData(t[j],u==null?null:u.concentration+h,this.fields.concentration)}}}else{for(var j=0;j<l.length;++j){var u=g[j%q];this.plate.setWellData(l[j].position,d,this.fields.batch);this.plate.setWellData(l[j].position,u==null?null:u.volume+w,this.fields.volume);this.plate.setWellData(l[j].position,u==null?null:u.concentration+h,this.fields.concentration)}}}},hasUnit:function(d,h){if(scil.Utils.isNullOrEmpty(h)){return false}var g=scil.Utils.trim(h);var c=scil.Utils.endswith(d,"("+g+")",false);if(c){return c}if(g.substr(0,1)=="μ"){g="u"+g.substr(1);return scil.Utils.endswith(d,"("+g+")",false)}return false},findByConc:function(f,d){for(var g=0;g<f.length;++g){if(d==f[g].concentration){return f[g]}}return null}};JSDraw2.Plate.Layout={plate:null,dlg:null,show:function(d){this.plate=d;var c=this.dlg==null;this.create();this.dlg.show();if(c){this.dlg.form.setData({size:96,by:"column",count:"2",negative:"first column",positive:"last column",points:8,replicates:1,jumpcols:0,jumprows:0})}},create:function(){if(this.dlg!=null){return}var c=["","first column","last column","first row","last row"];var d={size:{label:"Plate Size",type:"select",items:[96,384],sort:false},negative:{label:"Negative Control",type:"select",items:c,sort:false},positive:{label:"Positive Control",type:"select",items:c,sort:false},by:{label:"Layout By",type:"select",items:["","row","column"],width:100},points:{label:"Wells per Sample",type:"number",width:96},replicates:{label:"Replicates",type:"select",width:100,items:[1,2,3]},jumpcols:{label:"Jump Columns",type:"select",width:100,items:[0,1]},jumprows:{label:"Jump Rows",type:"select",width:100,items:[0,1]}};var f=this;this.dlg=scil.Form.createDlgForm("Layout Samples",d,{label:"Set",onclick:function(){f.lay()}})},setControls:function(q,c,j,g,h,d){var l={};if(q=="first row"){for(var f=0;f<Math.min(this.plate.cols,j*g);f+=g){l[this.plate.xy2Pos(f+1,1)]=c}}else{if(q=="last row"){for(var f=0;f<Math.min(this.plate.cols,j*g);f+=g){l[this.plate.xy2Pos(this.plate.cols-f,this.plate.rows)]=c}}else{if(q=="first column"){for(var f=0;f<Math.min(this.plate.rows,j*h);f+=h){l[this.plate.xy2Pos(1,f+1)]=c}}else{if(q=="last column"){for(var f=0;f<Math.min(this.plate.rows,j*h);f+=h){l[this.plate.xy2Pos(this.plate.cols,this.plate.rows-f)]=c}}else{return}}}}for(var n in l){this.plate.setWellData(n,l[n],JSDraw2.Plate.kColor);d[n]=l[n]}},lay:function(){for(var n=0;n<this.plate.rows;++n){this.plate.setRowData(n,null,JSDraw2.Plate.kBatch);this.plate.setRowData(n,null,JSDraw2.Plate.kColor)}var h=this.dlg.form.getData();this.plate.setSize({size:(h.size>0?h.size:96)});var q=scil.Utils.isNullOrEmpty(h.jumpcols)?1:parseInt(h.jumpcols)+1;var t=scil.Utils.isNullOrEmpty(h.jumprows)?1:parseInt(h.jumprows)+1;var y=parseInt(h.points);var B=parseInt(h.replicates);var D={};this.setControls(h.negative,JSDraw2.Plate.kNegative,y,q,t,D);this.setControls(h.positive,JSDraw2.Plate.kPositive,y,q,t,D);var n=0;var f=1;var A=1;var x=this;var C=function(E,d){var F=x.plate.xy2Pos(d+1,E+1);if(D[F]){return}if(++n>y){n=1;if(++A>B){A=1;++f}}x.plate.setWellData(F,f,JSDraw2.Plate.kBatch)};if(h.by=="column"){var j=h.negative=="first column"||h.positive=="first column";var u=h.negative=="last column"||h.positive=="last column";for(var g=0;g<this.plate.cols;g+=q){this.fillrows(j&&g==0?1:0,g,t,C)}if(t==2){for(var g=0;g<this.plate.cols;g+=q){this.fillrows(j&&g==0?0:1,g,t,C)}}if(q==2){for(var g=1;g<this.plate.cols;g+=q){this.fillrows(u&&g==this.plate.cols-1?1:0,g,t,C)}if(t==2){for(var g=1;g<this.plate.cols;g+=q){this.fillrows(u&&g==this.plate.cols-1?0:1,g,t,C)}}}}else{if(h.by=="row"){var l=h.negative=="first row"||h.positive=="first row";var w=h.negative=="last row"||h.positive=="last row";for(var z=0;z<this.plate.rows;z+=t){this.fillcols(l&&z==0?1:0,z,q,C)}if(q==2){for(var z=0;z<this.plate.rows;z+=t){this.fillcols(l&&z==0?0:1,z,q,C)}}if(t==2){for(var z=1;z<this.plate.rows;z+=t){this.fillcols(l&&z==this.plate.rows-1?1:0,z,q,C)}if(q==2){for(var z=1;z<this.plate.rows;z+=t){this.fillcols(l&&z==this.plate.rows-1?0:1,z,q,C)}}}}}this.dlg.hide()},fillcols:function(j,g,f,h){for(var d=j;d<this.plate.cols;d+=f){h(g,d)}},fillrows:function(j,d,f,h){for(var g=j;g<this.plate.rows;g+=f){h(g,d)}}};JSDraw2.Plate.SelectBox=scil.extend(scil._base,{constructor:function(d){this.plate=d;this.box=null;this.handle=null;this.dragmode=null;this.range=null;this.rect=null;this.zindex=0;this.decimal=4;var c=this;if(this.plate.options.selectboxtrans==false){this.box=scil.Utils.createElement(document.body,"div",null,{display:"none",position:"absolute",border:"solid 1px blue"});scil.Utils.createElement(this.box,"div",null,{width:"100%",height:"100%",background:"blue",opacity:0.1,filter:"alpha(opacity=10)"});scil.Utils.unselectable(this.box);dojo.connect(this.box,"ondblclick",function(f){c.dblclick(f)})}else{this.box={top:scil.Utils.createElement(document.body,"div",null,{display:"none",position:"absolute",height:"1px",borderTop:"solid 1px blue"}),right:scil.Utils.createElement(document.body,"div",null,{display:"none",position:"absolute",width:"1px",borderRight:"solid 1px blue",borderTop:"none",borderLeft:"none"}),bottom:scil.Utils.createElement(document.body,"div",null,{display:"none",position:"absolute",height:"1px",borderBottom:"solid 1px blue"}),left:scil.Utils.createElement(document.body,"div",null,{display:"none",position:"absolute",width:"1px",borderLeft:"solid 1px blue"})};scil.Utils.unselectable(this.box.top);scil.Utils.unselectable(this.box.right);scil.Utils.unselectable(this.box.bottom);scil.Utils.unselectable(this.box.right)}this.handle=scil.Utils.createElement(document.body,"div",null,{display:"none",position:"absolute",width:"5px",height:"5px",background:"blue",border:"solid 1px #fff",cursor:"move"});this.copybox=scil.Utils.createElement(document.body,"div",null,{display:"none",position:"absolute",border:"solid 1px blue"});scil.Utils.unselectable(this.handle);scil.Utils.unselectable(this.copybox);dojo.connect(document,"onmousedown",function(f){c.mousedown(f)});dojo.connect(document,"onmousemove",function(f){c.mousemove(f)});dojo.connect(document,"onmouseup",function(f){c.mouseup(f)});dojo.connect(document,"onkeydown",function(f){c.keydown(f)});dojo.connect(document,"onscrollinside",function(f){c.hide()});scil.connect(document,"onpaste",function(f){if(c.paste(f)){f.preventDefault()}})},viewonly:function(){return this.plate.options.viewonly||this.plate.options.selectboxviewonly},getRangePos:function(){var c=this.getRange();if(c==null){return null}return this.plate.xy2Pos(c.c1+1,c.r1+1)+"-"+this.plate.xy2Pos(c.c2+1,c.r2+1)},getRange:function(){if(this.range==null){return null}var c=Math.min(this.range.c1,this.range.c2);var d=Math.max(this.range.c1,this.range.c2);var f=Math.min(this.range.r1,this.range.r2);var g=Math.max(this.range.r1,this.range.r2);return{c1:c,r1:f,c2:d,r2:g}},click:function(c){},del:function(c,g){if(!this.canEdit()){return}c.preventDefault();var f=this.getRange();var d=this;if(g){this.del2(f,null)}else{this.selectColumn("Delete Data",f,function(h){d.del2(f,h)},{"[all]":"[All Fields]"})}},del2:function(d,c){if(this.plate.options.ondel!=null){this.plate.options.ondel(d,this.plate,c)}else{this.del3(d,c)}},del3:function(h,f){for(var g=h.r1;g<=h.r2;++g){for(var d=h.c1;d<=h.c2;++d){this.plate.saveWellData2(d,g,null,f)}}},setControl:function(d,c){if(this.plate.jss.getColIndex("color")!=null){this.enterValue2(d,"color","set",c)}else{if(this.plate.jss.getColIndex("batch")!=null&&(c==JSDraw2.Plate.kNegative||c==JSDraw2.Plate.kPositive)){this.enterValue2(d,"batch","set",c)}else{if(this.plate.jss.getColIndex("lotno")!=null&&(c==JSDraw2.Plate.kNegative||c==JSDraw2.Plate.kPositive)){this.enterValue2(d,"lotno","set",c)}else{scil.Utils.alert("Cannot find color field")}}}},enterValue:function(c){if(!this.canEdit()){return}var f=this.getRange();if(f==null){return false}c.preventDefault();var d=this;this.selectColumn("Manipulate Values",f,function(g,h,n,j,l){return d.enterValue2(f,g,h,n,l)},null,true,true)},enterValue2:function(t,f,n,x,u){if(scil.Utils.isNullOrEmpty(f)){scil.Utils.alert("No attribute selected");return false}var h=null;switch(n){case"divide":case"times":case"plus":case"minus":case"spread":x=parseFloat(x);if(x==null||isNaN(x)){scil.Utils.alert("Value should be a number");return false}break;case"fold":var q=x.indexOf("/");if(q<=0){scil.Utils.alert("Please write Value like (Top)/(Fold), e.g. 10.0 / 5");return false}h=parseFloat(x.substr(q+1));x=parseFloat(x.substr(0,q));break;case"ln":case"log":case"sqrt":case"exp":case"x2":case"x1":if(!scil.Utils.isNullOrEmpty(x)){scil.Utils.alert("Value should be blank");return false}break;case"set":break;default:scil.Utils.alert("Please select an Operator");return false}var j=0;if(!(u>0)){u=1}var g=this.plate.options.decimal>0?this.plate.options.decimal:4;for(var l=t.r1;l<=t.r2;++l){for(var d=t.c1;d<=t.c2;++d){var w=this.plate.getWellData2(d,l,f);if(n=="set"){this.plate.setWellData2(d,l,x,f)}else{if(n=="spread"){this.plate.setWellData2(d,l,x,f);if(++j>=u){++x;j=0}}else{if(n=="fold"){this.plate.setWellData2(d,l,scil.Utils.roundStr(x,g),f);if(++j>=u){x/=h;j=0}}else{w=parseFloat(w);if(!isNaN(w)){switch(n){case"divide":w/=x;break;case"times":w*=x;break;case"plus":w+=x;break;case"minus":w-=x;break;case"ln":w=Math.log(w);break;case"log":w=scil.Utils.log10(w);break;case"sqrt":w=Math.sqrt(w);break;case"exp":w=Math.exp(w);break;case"x2":w=w*w;break;case"x1":w=1/w;break}this.plate.setWellData2(d,l,scil.Utils.roundStr(w,g),f)}}}}}}},cut:function(c){if(!this.canEdit()){return}c.preventDefault();var f=this.getRange();if(f==null){return false}var d=this;this.selectColumn("Cut to Clipboard",f,function(g){d.cut2(f,g)})},cut2:function(d,c){if(this.plate.options.oncut!=null){this.plate.options.oncut(this.plate,d,c)}else{this.copy3(d,c);this.del3(d,c)}},copy:function(){if(!this.isvisible()||this.isDlgVisible()){return false}var d=this.getRange();if(d==null){return false}var c=this;this.selectColumn("Copy to Clipboard",d,function(f){c.copy2(d,f)},{"[all]":"[All Fields]"})},copy2:function(d,c){if(this.plate.options.oncopy!=null){this.plate.options.oncopy(this.plate,d,c)}else{this.copy3(d,c)}},copy3:function(h,d){var j="";if(scil.Utils.isNullOrEmpty(d)){var f=this.plate.getFields();for(var g in f){var c=f[g];if(c==null||scil.Utils.trim(c)==""){continue}var l=this.copyOneAttribute(h,g);if(!scil.Utils.isNullOrEmpty(l)){j+=c+"\n";j+=l;j+="\n"}}}else{j+=this.copyOneAttribute(h,d)}if(j!=""){scil.Clipboard.copy(j)}},copyOneAttribute:function(h,f){var j="";for(var g=h.r1;g<=h.r2;++g){for(var d=h.c1;d<=h.c2;++d){var l=this.plate.getWellData2(d,g,f);if(d>h.c1){j+="\t"}j+=(l==null?"":l)}j+="\n"}return j},paste:function(j){if(!this.canEdit()){return false}var h=this.getRange();if(h==null){return false}if(j!=null&&j.clipboardData!=null){j=j.clipboardData.getData("text/plain")}if(scil.Utils.isNullOrEmpty(j)){scil.Utils.alert("No text found on clipboard");return false}var c=this.plate.getFields();var f=this.parseMatrices(j,c,h.r2-h.r1+1,h.c2-h.c1+1,"\t");var d=f!=null?null:this.parseMatrix(j,h.r2-h.r1+1,h.c2-h.c1+1,"\t");if(f==null&&d==null){scil.Utils.alert("No valid data matrix found on clipboard");return false}var g=this;if(f!=null){return this.selectColumn("Paste from Clipboard",h,function(l){g.pasteMatrices(h,l,f)},{"[all]":"[All Fields]"})}else{if(d!=null){return this.selectColumn("Paste from Clipboard",h,function(l){g.pasteMatrix(h,l,d)})}}return false},pasteMatrices:function(g,c,f){if(scil.Utils.isNullOrEmpty(c)){for(var d in f){this.pasteMatrix(g,d,f[d])}}else{this.pasteMatrix(g,c,f[c])}return true},pasteMatrix:function(l,f,h){if(h==null){return}if(this.plate.options.onpaste!=null){this.plate.options.onpaste(this.plate,l,f)}else{for(var g=l.r1;g<=l.r2;++g){var j=h[g-l.r1];for(var d=l.c1;d<=l.c2;++d){var n=j==null?null:j[d-l.c1];var q=n==null?null:n.toLowerCase();if(q==JSDraw2.Plate.kNegative||q==JSDraw2.Plate.kPositive){this.plate.saveWellData2(d,g,q,JSDraw2.Plate.kColor);if(f!=JSDraw2.Plate.kColor){this.plate.saveWellData2(d,g,"",f)}}else{this.plate.saveWellData2(d,g,n,f)}}}}},parseMatrix:function(f,d,c,g){if(scil.Utils.isNullOrEmpty(f)){return null}var h=f.replace(/[\r][\n]/g,"\n").replace(/[\r]/g,"\n").split("\n");return this.parseOneMatrix(h,0,d,c,g)},parseMatrices:function(q,f,n,d,t){if(scil.Utils.isNullOrEmpty(q)){return null}var g=0;var l=null;var u=q.replace(/[\r][\n]/g,"\n").replace(/[\r]/g,"\n").split("\n");while(g+n<u.length){var c=scil.Utils.trim(u[g]);if(c==""){++g;continue}var h=scil.Utils.getDictKeyByValue(f,c);if(h==null){return null}++g;var j=this.parseOneMatrix(u,g,n,d,t);if(j==null){return null}if(l==null){l={}}l[h]=j;g+=n}return l},parseOneMatrix:function(n,q,h,c,l){if(q+h>n.length){return null}var g=[];for(var d=0;d<h;++d){var j=n[q+d];if(j==null){return null}var f=j.split(l);if(f.length!=c){return null}g.push(f)}return g.length==0?null:g},getCellRect:function(f,c){var g=this.plate.getCell(f,c);if(g==null){return null}var d=scil.Utils.getOffset(g,true,true);return new JSDraw2.Rect(d.x+1,d.y+1,g.offsetWidth-1,g.offsetHeight-2)},showCopybox:function(q,f){var j=this.getRange();var c=j.c1;var d=j.c2;var l=j.r1;var n=j.r2;var g=0;if(f<c){g=f-c}else{if(f>d){g=f-d}}var h=0;if(q<l){h=q-l}else{if(q>n){h=q-n}}if(Math.abs(h)>=Math.abs(g)){f=d;g=0}else{q=n;h=0}if(JSDraw2.Plate.SelectBox.dragdelta!=null&&JSDraw2.Plate.SelectBox.dragdelta.dcol==g&&JSDraw2.Plate.SelectBox.dragdelta.drow==h){return}JSDraw2.Plate.SelectBox.dragdelta={dcol:g,drow:h};var j=this.getCellRect(q,f);j.union(this.rect);dojo.style(this.copybox,{left:j.left+"px",top:j.top+"px",width:j.width+"px",height:j.height+"px",zIndex:this.zindex,display:""})},hide:function(c){if(this.dragmode!=null){this.dragmode=null;if(this.copybox!=null){this.copybox.style.display="none"}JSDraw2.Plate.SelectBox.dragstart=null;JSDraw2.Plate.SelectBox.dragdelta=null}if(this.box==null){return}if(c!=null){c.preventDefault()}if(this.range!=null){var d=this.range;this.range=null;if(this.plate.options.onselectchanged!=null){this.plate.options.onselectchanged(this.range,d,this.plate)}}if(this.box.style!=null){this.box.style.display="none"}else{this.box.top.style.display="none";this.box.right.style.display="none";this.box.bottom.style.display="none";this.box.left.style.display="none"}this.handle.style.display="none"},isvisible:function(){return this.box!=null&&(this.box.style!=null?this.box:this.box.top).style.display!="none"&&this.range!=null},canEdit:function(){return this.isvisible()&&!this.viewonly()&&!this.isDlgVisible()},select:function(d){if(this.range==d){return}if(d==null){this.hide();return}if(this.range!=null&&this.range.c1==d.c1&&this.range.r1==d.r1&&this.range.c2==d.c2&&this.range.r2==d.r2){return}var c=this.range;this.range=d;this.redraw();if(this.plate.options.onselectchanged!=null){this.plate.options.onselectchanged(d,c,this.plate)}},getRangeRect:function(c){var f=this.getCellRect(c.r1,c.c1);if(c.c2!=c.c1||c.r2!=c.r1){var d=this.getCellRect(c.r2,c.c2);f.union(d)}return f},redraw:function(){if(this.range==null){this.hide();return}this.rect=this.getRangeRect(this.range);this.zindex=scil.Utils.getZindex(this.plate.tbody.parentNode)+1;if(this.box.style!=null){dojo.style(this.box,{left:this.rect.left+"px",top:this.rect.top+"px",width:this.rect.width+"px",height:this.rect.height+"px",zIndex:this.zindex+1,display:""})}else{dojo.style(this.box.top,{left:this.rect.left+"px",top:this.rect.top+"px",width:this.rect.width+"px",zIndex:this.zindex+1,display:""});dojo.style(this.box.right,{left:this.rect.right()+"px",top:this.rect.top+"px",height:this.rect.height+"px",zIndex:this.zindex+1,display:""});dojo.style(this.box.bottom,{left:this.rect.left+"px",top:this.rect.bottom()+"px",width:this.rect.width+"px",zIndex:this.zindex+1,display:""});dojo.style(this.box.left,{left:this.rect.left+"px",top:this.rect.top+"px",height:this.rect.height+"px",zIndex:this.zindex+1,display:""})}dojo.style(this.handle,{left:(this.rect.right()-2)+"px",top:(this.rect.bottom()-2)+"px",zIndex:this.zindex+2,display:""})},dblclick:function(c){var f=this.plate.getCellPosByScreen(c.clientX,c.clientY);if(f==null){return}var g={r1:f.iRow,c1:f.iCol,r2:f.iRow,c2:f.iCol};this.select(g);var d=this.plate.getWell2(g.c1,g.r2);if(d!=null){this.plate.onDblClickWell({target:d.firstChild})}},keydown:function(c){if(this.plate.options.keyboardshortcuts==false||!this.isvisible()){return false}switch(c.keyCode){case 13:this.enterValue(c);break;case 67:case 99:if(c.ctrlKey||c.metaKey){this.copy(c)}break;case 88:case 120:if(c.ctrlKey||c.metaKey){this.cut(c)}break;case 8:case 46:this.del(c,c.shiftKey);break;case 27:this.hide(c);break}},mousedown:function(d){var g=d.srcElement||d.target;this.dragmode=null;if(this.box==g.parentNode){JSDraw2.Plate.SelectBox.dragstart=this.plate.getCellPosByScreen(d.clientX,d.clientY);if(JSDraw2.Plate.SelectBox.dragstart!=null){JSDraw2.Plate.SelectBox.dragstart.source=this;this.dragmode="drag"}}else{if(g==this.handle){if(!this.viewonly()){this.dragmode="copy"}}else{if(!scil.Utils.isChildOf(g,this.plate.tbody.parentNode)&&(this.box.style==null&&g!=this.box.left&&g!=this.box.top&&g!=this.box.right&&g!=this.box.bottom||this.box.style!=null&&g!=this.box)){var c=scil.Dialog.getDialog(g);if(c==null||c.owner!=this){this.hide()}}else{this.dragmode="select";var f=this.plate.getCellPosByScreen(d.clientX,d.clientY);if(f!=null){this.select({r1:f.iRow,c1:f.iCol,r2:f.iRow,c2:f.iCol})}}}}},mousemove:function(c){if(this.dragmode=="copy"){if(!this.viewonly()){var d=this.plate.getCellPosByScreen(c.clientX,c.clientY);if(d!=null){this.showCopybox(d.iRow,d.iCol)}}}else{if(this.dragmode=="select"){var d=this.plate.getCellPosByScreen(c.clientX,c.clientY);if(d!=null&&this.range!=null){this.select({r1:this.range.r1,c1:this.range.c1,r2:d.iRow,c2:d.iCol})}}else{if(JSDraw2.Plate.SelectBox.dragstart!=null){if(!this.viewonly()){var d=this.plate.getCellPosByScreen(c.clientX,c.clientY);if(d!=null){JSDraw2.Plate.SelectBox.showDragbox(this,d.iRow,d.iCol)}}}}}},mouseup:function(d){if(this.dragmode==null){return}if(this.dragmode=="copy"&&JSDraw2.Plate.SelectBox.dragdelta!=null){if(this.plate.options.oncopyselected!=null){this.plate.options.oncopyselected(this)}else{this._duplicate(JSDraw2.Plate.SelectBox.dragdelta,d.shiftKey)}}else{if(JSDraw2.Plate.SelectBox.dragstart!=null){var c=d.ctrlKey||d.metaKey;if(this.plate.options.onmoveselected!=null){this.plate.options.onmoveselected(JSDraw2.Plate.SelectBox.dragstart,JSDraw2.Plate.SelectBox.dragdelta,c)}else{JSDraw2.Plate.SelectBox._moveSelected(c)}}}JSDraw2.Plate.SelectBox.dragstart=null;JSDraw2.Plate.SelectBox.dragdelta=null;this.dragmode=null;this.copybox.style.display="none"},_duplicate:function(c,g){if(this.viewonly()){return}var f=this.getRange();var d=this;if(g){this._duplicate2(f,c,null)}else{this.selectColumn("Duplicate Data",f,function(h){d._duplicate2(f,c,h)},{"[all]":"[All Fields]"})}},_duplicate2:function(y,l,j){if(l==null||l.drow==0&&l.dcol==0){return}var u=y;var f=u.c1;var g=u.c2;var w=u.r1;var x=u.r2;if(l.drow!=0){var t=x-w+1;for(var q=0;q<Math.abs(l.drow);++q){var u=(l.drow>0?x+q+1:w-q-1);for(var d=f;d<=g;++d){var z=l.drow>0?w+(q%t):x-(q%t);var A=this.plate.getWellData2(d,z,j);this.plate.saveWellData2(d,u,A,j)}}if(l.drow>0){x+=l.drow}else{w+=l.drow}this.select({r1:w,c1:f,r2:x,c2:g})}else{if(l.dcol!=0){var t=g-f+1;for(var q=0;q<Math.abs(l.dcol);++q){var d=(l.dcol>0?g+q+1:f-q-1);for(var u=w;u<=x;++u){var h=l.dcol>0?f+(q%t):g-(q%t);var A=this.plate.getWellData2(h,u,j);this.plate.saveWellData2(d,u,A,j)}}if(l.dcol>0){g+=l.dcol}else{f+=l.dcol}this.select({r1:w,c1:f,r2:x,c2:g})}}},isDlgVisible:function(){return this.selectColDlg!=null&&this.selectColDlg.isVisible()},scanFirstValuField:function(j){if(j==null){return null}var g=this.plate.getFields();for(var f in g){for(var h=j.r1;h<=j.r2;++h){for(var d=j.c1;d<=j.c2;++d){var l=this.plate.getWellData2(d,h,f);if(!scil.Utils.isNullOrEmpty(l)){return f}}}}return null},selectColumn:function(d,n,c,f,l,q){if(this.selectColDlg==null){var j=this;var g={n:{type:"note",label:"Please select the attribute to be operated:"},col:{label:"Field",type:"select",width:300,onchange:function(){j.onchangecol()}},op:{label:"Operator",sort:false,type:"select",items:{"":"",plus:"+",minus:"-",divide:"&divide;",times:"&times;",set:"Overwrite",spread:"Spread (1,2,3...)",fold:"Dilute (10,2,0.4,0.08...)",log:"log(x)",ln:"ln(x)",exp:"e^x",sqrt:"sqrt(x)",x2:"x^2",x1:"1/x"}},repeat:{label:"Repeat",type:"number"},val:{label:"Value",width:300,type:"dropdowninput"}};this.selectColDlg=scil.Form.createDlgForm("Select Field",g,[{label:"Continue",onclick:function(){j.selectColumn2()}},"&nbsp;",{label:"Negative",title:"Set as Negative Control",onclick:function(){j.setControl(j.selectColDlg.range,JSDraw2.Plate.kNegative);j.selectColDlg.hide()}},{label:"Positive",title:"Set as Positive Control",onclick:function(){j.setControl(j.selectColDlg.range,JSDraw2.Plate.kPositive);j.selectColDlg.hide()}},{label:"Dose",title:"Set as Dose Control",onclick:function(){j.setControl(j.selectColDlg.range,"dose");j.selectColDlg.hide()}},])}this.selectColDlg.show2({title:d,owner:this});this.selectColDlg.callback=c;this.selectColDlg.range=n;this.selectColDlg.form.buttons[2].style.display=q?"":"none";this.selectColDlg.form.buttons[3].style.display=q?"":"none";this.selectColDlg.form.buttons[4].style.display=q?"":"none";scil.Utils.getParent(this.selectColDlg.form.fields.op,"TR").style.display=l?"":"none";scil.Utils.getParent(this.selectColDlg.form.fields.repeat,"TR").style.display=l?"":"none";scil.Utils.getParent(this.selectColDlg.form.fields.val,"TR").style.display=l?"":"none";var h=this.plate.getFields();if(f!=null){h=scil.Utils.insertAfterDict(h,f,"")}scil.Utils.listOptions(this.selectColDlg.form.fields.col,h,null,true,false)},selectColumn2:function(){var c=this.selectColDlg.form.getData();if(scil.Utils.isNullOrEmpty(c.col)){scil.Utils.alert("Please select an attribute");return}if(c.col=="[all]"){c.col=null}if(this.selectColDlg.callback(c.col,c.op,c.val,c.range,c.repeat)!=false){this.selectColDlg.hide()}},onchangecol:function(){var c=this.selectColDlg.form.fields;var g=c.col.value;var f=null;for(var d=0;d<this.plate.jss.columns.length;++d){if(this.plate.jss.columns[d].key==g){f=this.plate.jss.columns[d].items;break}}c.val.jsd.setItems(f==null?[]:f)}});scil.apply(JSDraw2.Plate.SelectBox,{dragdelta:null,dragstart:null,_moveSelected:function(h){var l=this.dragdelta;if(l==null){return}var w=this.dragdelta.target;var u=this.dragstart.source;if(w==u&&l.drow==0&&l.dcol==0){return}if(w.viewonly()){return}var n=u.getRange();var f=n.c1;var g=n.c2;var q=n.r1;var t=n.r2;var j={};for(var d=f;d<=g;++d){for(var n=q;n<=t;++n){j[d+"-"+n]=u.plate.getWellData2(d,n);if(!h){u.plate.saveWellData2(d,n,null)}}}for(var d=f;d<=g;++d){for(var n=q;n<=t;++n){w.plate.saveWellData2(d+l.dcol,n+l.drow,j[d+"-"+n])}}if(u!=w){u.select(null)}w.select({r1:q+l.drow,c1:f+l.dcol,r2:t+l.drow,c2:g+l.dcol})},showDragbox:function(n,j,c){var d=c-this.dragstart.iCol;var f=j-this.dragstart.iRow;var l=this.dragstart.source;var h=l.getRange();if(h==null){return}if(h.r1+f<0){f=-h.r1}if(h.r2+f>=n.plate.rows){f=n.plate.rows-h.r2-1}if(h.c1+d<0){d=-h.c1}if(h.c2+d>=n.plate.cols){d=n.plate.cols-h.c2-1}if(this.dragdelta!=null&&this.dragdelta.target==n&&this.dragdelta.dcol==d&&this.dragdelta.drow==f){return}if(h.r1+f<0||h.r2+f>=n.plate.rows||h.c1+d<0||h.c2+d>=n.plate.cols){return}if(this.dragdelta!=null&&this.dragdelta.target!=n){this.dragdelta.target.copybox.style.display="none"}this.dragdelta={dcol:d,drow:f,target:n};var g=n.getRangeRect({r1:h.r1+f,r2:h.r2+f,c1:h.c1+d,c2:h.c2+d});dojo.style(n.copybox,{left:g.left+"px",top:g.top+"px",width:g.width+"px",height:g.height+"px",zIndex:n.zindex,display:""})}});JSDraw2.Plates.Comparer={plates:null,cols:null,dlg:null,form:null,sheet:null,start:1,show:function(t,h,q){this.fields=h;this.plates=t;this.onchangeqc=q;this.onclick=q==null?null:JSDraw2.Plates.Comparer.setQC;this.cols={};var n=[];for(var j=0;j<this.plates.plate.jss.columns.length;++j){var f=this.plates.plate.jss.columns[j];if(f.key=="position"||f.key=="id"){continue}this.cols[f.key]=f.caption;if(f.type=="float"){n.push(f.key)}}if(h==null){if(this.cols.response!=null||this.cols.results!=null){h=["response","result"]}else{h=n}}this.create();this.dlg.show();var t={all:"All Plates"};for(var l=this.start;l<this.plates.plates.length;++l){t[l]="Plate "+l}scil.Utils.listOptions(this.form.fields.applyto,t);var g={field1:h[0],field2:h[1],field3:h[2],field4:h[3],applyto:"all"};this.form.setData(g);this.reload()},reload:function(){var l=[];var h=this.form.getData();for(var n=1;n<=4;++n){if(!scil.Utils.isNullOrEmpty(h["field"+n])){l.push(h["field"+n])}}var j=this.collectData(l,this.start);var u=this.plates.plates.length;var A=" style='background:#eee'";var y="<table border=1 style='border-collapse:collapse; text-align:center; white-space:nowrap'>";y+="<tr>";y+="<th></th>";for(var q=this.start;q<u;++q){y+="<th colspan="+l.length+(q%2==1?A:"")+">Plate "+q+"</th>"}y+="<th colspan=3"+(u%2==1?A:"")+">Stats</th>";y+="</tr>";y+="<tr>";y+="<th>Well</th>";for(var q=this.start;q<u;++q){for(var n=0;n<l.length;++n){y+="<th"+(q%2==1?A:"")+">"+scil.Utils.escXmlValue(this.cols[l[n]])+"</th>"}}y+="<th"+(u%2==1?A:"")+">Avg</th>";y+="<th"+(u%2==1?A:"")+">Stdev</th>";y+="<th"+(u%2==1?A:"")+">%CV</th>";y+="</tr>";for(var w in j){var x=j[w];y+="<tr w='"+w+"'>";y+="<td>"+w+"</td>";var t=[];for(var q=this.start;q<u;++q){var h=x[q];t[q-this.start]=parseFloat(h[0]);for(var n=0;n<l.length;++n){if(l[n]=="qc"){var f=null;if(h[n]=="Pass"){f="lime"}else{if(h[n]=="Failed"){f="yellow"}else{if(q%2==1){f="#eee"}}}y+="<td p='"+q+"' k='"+scil.Utils.escXmlValue(l[n])+"' style='background:"+f+"'>"+h[n]+"</td>"}else{y+="<td p='"+q+"' k='"+scil.Utils.escXmlValue(l[n])+"'"+(q%2==1?A:"")+">"+h[n]+"</td>"}}}var c=scil.Math.avg(t);var z=scil.Math.stdev(t);var g=z/c*100;y+="<td"+(u%2==1?A:"")+">"+(c==null||isNaN(c)?"":scil.Utils.round(c,2))+"</td>";y+="<td"+(u%2==1?A:"")+">"+(z==null||isNaN(z)?"":scil.Utils.round(z,2))+"</td>";y+="<td"+(u%2==1?A:"")+">"+(g==null||isNaN(g)?"":scil.Utils.round(g,2))+"</td>";y+="</tr>"}y+="</table>";this.sheet.innerHTML=y},create:function(j){if(this.dlg!=null){return}var d=scil.Utils.createElement(null,"div");this.dlg=new scil.Dialog("Plate Comparison",d);this.dlg.show();var n=scil.Utils.createTable(d);var q=scil.Utils.createElement(n,"tr");var g=scil.Utils.createElement(q,"td",null,{verticalAlign:"top"});var l=scil.Utils.createElement(q,"td",null,{verticalAlign:"top"});var h=this;scil.Utils.createElement(g,"div","(Click to change QC value)",{color:"orange"});this.sheet=scil.Utils.createElement(g,"div");scil.connect(this.sheet,"onclick",function(t){h.click(t)});var f={field1:{label:"Field 1",type:"select",items:this.cols},field2:{label:"Field 2",type:"select",items:this.cols},field3:{label:"Field 3",type:"select",items:this.cols},field4:{label:"Field 4",type:"select",items:this.cols},b:{type:"button",text:"Reload",onclick:function(){h.reload()}},c:{label:"",type:"html"},applyto:{label:"Apply To",type:"select"},allqc1:{label:"QC",type:"select",items:["","Pass","Failed"],button:{label:"Set Blank",onclick2:function(t){h.setAllQC(t.value,false)}}},allqc2:{label:"QC",type:"select",items:["","Pass","Failed"],button:{label:"Set All",onclick2:function(t){h.setAllQC(t.value,true)}}}};scil.Utils.createElement(l,"div","&nbsp;");var c=scil.Utils.createElement(l,"div",null,{padding:"10px",border:"solid 1px gray",marginLeft:"10px"});this.form=new scil.Form();this.form.render(c,f)},click:function(c){if(this.onclick==null){return}var g=c.srcElement||c.target;if(g.tagName!="TD"){return}var f=g.getAttribute("p");var h=scil.Utils.getParent(g,"TR").getAttribute("w");var d=g.getAttribute("k");if(!scil.Utils.isNullOrEmpty(f)&&!scil.Utils.isNullOrEmpty(h)){this.onclick(this.plates,f,h,d,g)}},collectData:function(d,q){var c={};var g=this.plates.plate.jss;for(var f=q;f<this.plates.plates.length;++f){this.plates.choosePlate(f);for(var l=0;l<g.getRowCount();++l){var n=[];for(var h=0;h<d.length;++h){n[h]=g.getCellValue(l,d[h])}var j=g.getCellValue(l,"position");if(c[j]==null){c[j]=[]}c[j][f]=n}}return c},setQC:function(f,d,l,c,h){if(c!="qc"){return}f.choosePlate(d);var g=f.plate.getWellData(l,"qc");var j=g=="Pass"?"Failed":"Pass";f.plate.setWellData(l,j,"qc");h.innerHTML=j;if(this.onchangeqc!=null){this.onchangeqc()}},setAllQC:function(h,c){var f=this;var d=this.form.fields.applyto.value;var g=d=="all"||d==""?"all plates":"plate "+d;scil.Utils.confirmYes("Set "+(c?"all":"blank")+" QC on "+g+" values to '"+h+"'",function(){f.setAllQC2(h,c)})},setAllQC2:function(t,d){var h=this.form.fields.applyto.value;var j=0;for(var g=1;g<this.plates.plates.length;++g){if(!(h=="all"||h==""||h==g)){continue}this.plates.choosePlate(g);for(var l=0;l<this.plates.plate.rows;++l){for(var f=0;f<this.plates.plate.cols;++f){var q=this.plates.plate.getWellData2(f,l,"qc");if(!d&&!scil.Utils.isNullOrEmpty(q)){continue}++j;this.plates.plate.setWellData2(f,l,t,"qc")}}}if(j>0){if(this.onchangeqc!=null){this.onchangeqc()}this.reload()}}};JSDraw2.Plates.TableEditor={dlg:null,plates:null,plate:null,show:function(t){if(t.jss==null){this.plates=t;this.plate=t.plate}else{this.plates=null;this.plate=t}var n={"":""};var g=this.plate.jss.columns;for(var l=0;l<g.length;++l){var f=g[l];if(f.key!="id"&&f.key!="position"){n[g[l].key]=g[l].caption}}var h=[];for(var f=0;f<this.plate.cols;++f){h.push({key:"c"+(f+1),caption:f+1,width:65})}var d=[{label:"Save",onclick:function(){q.save()}}];if(this.plates!=null){d.push({label:"Previous Plate",onclick:function(){q.nextplate(-1)}});d.push({label:"Next Plate",onclick:function(){q.nextplate(+1)}})}var q=this;var j={field:{leading:scil.Lang.res("Select Field")+":",str:" ",type:"select",items:n,onchange:function(){q.selectField()},button:d},table:{type:"jsdraw.table",toolbar:false,selectbox:true,idasletter:true,rows:this.plate.rows,columns:h}};this.dlg=scil.Form.createDlgForm("Data Editor",j,null,{hidelabel:true});this.dlg.show()},selectField:function(){var f=this.dlg.form.fields.field.value;if(f==""){return}var h=this.plate.barcode;this.dlg.setTitle("Data Editor"+(scil.Utils.isNullOrEmpty(h)?"":" - "+h));var d=this.dlg.form.fields.table.jsd;for(var c=0;c<this.plate.jss.getRowCount();++c){var g=this.plate.jss.getCellValue(c,"position");var j=this.plate.jss.getCellValue(c,f);var l=this.plate.pos2Xy(g);d.setCellValue(l.y-1,l.x,j)}},save:function(){var g=this.dlg.form.fields.field.value;if(g==""){return}var h=new JSDraw2.Matrix();var f=this.dlg.form.fields.table.jsd;for(var j=0;j<f.getRowCount();++j){var l=[];h.data[j]=l;for(var d=1;d<f.getColCount();++d){l[d-1]=f.getCellValue(j,d)}}this.plate.setMatrix(h,g)},nextplate:function(c){if(this.plates.nextPlate(c)){this.selectField()}else{scil.Utils.alert("Out of range")}}};JSDraw2.Plates.Chart={show:function(w,g,j){if(g==null){g="response"}var d=scil.Utils.createElement(null,"div");var f=new scilligence.Dialog("Plate Chart",d);f.show();var t=0;var A=null;var z=null;var y=[];for(var q=1;q<w.plates.length;++q){if(j!=null&&j!=q){continue}var c=[];w.choosePlate(q);var l=w.plate.jss;for(var h=0;h<l.getRowCount();++h){var u=l.getCellValue(h,"position");var x=l.getCellValue(h,g);x=parseFloat(x);if(A==null||A>x){A=x}if(z==null||z<x){z=x}++t;c.push({x:h+1,y:x,size:1})}y.push({label:"Plate "+q,xydata:c})}new scil.Chart(d,{type:"scatter",shadow:false,width:800,height:300,xtitle:"Well",ytitle:g,series:y,onclick:function(n){}});f.moveCenter()}};JSDraw2.PlateReader={onbarcode:null,readers:{"":null,"Two Channels (List)":[{type:"List",sheet:0,barcodeposition:"A",col_position:"B",col_response:"C",fieldkey:"alpha"},{type:"List",sheet:0,barcodeposition:"A",col_position:"B",col_response:"D",fieldkey:"beta"}],"Demo (Matrix)":{type:"Matrix",barcodeposition:"1",startposition:"C50",linesperplate:65},"Demo Spread (List)":{type:"List",sheet:0,barcodeposition:"1",col_row:"C",col_column:"D",col_response:"I"},},read:function(j,h,c){if(c==null){scil.Utils.alert("Unknown contents in raw file");return 0}if(typeof(h)=="string"){if(this.readers[h]==null){scil.Utils.alert("Reader, "+h+", is not defined");return 0}else{h=this.readers[h]}}else{if(!scil.Utils.isNullOrEmpty(h.reader)){var l=this.readers[h.reader];if(l!=null){for(var f in h){var q=h[f];if(!scil.Utils.isNullOrEmpty(q)){l[f]=q}}h=l}}}if(h==null){scil.Utils.alert("parser is not set yet");return 0}var g=0;if(h.length>0){for(var d=0;d<h.length;++d){g+=this.readOne(j,h[d],c)}}else{g+=this.readOne(j,h,c)}return g},readOne:function(f,d,c){if(scil.Utils.isNullOrEmpty(d.barcodeposition)){scil.Utils.alert("*barcodeposition* is not defined");return 0}if(scil.Utils.isNullOrEmpty(d.reader)){if(!scil.Utils.isNullOrEmpty(d.startposition)){d.type="Matrix"}else{if(!scil.Utils.isNullOrEmpty(d.col_response)&&(!scil.Utils.isNullOrEmpty(d.col_position)||(!scil.Utils.isNullOrEmpty(d.col_row)&&!scil.Utils.isNullOrEmpty(d.col_column)))){d.type="List"}}}if(d.type=="Matrix"){return new JSDraw2.PlateReader.Matrix(d,JSDraw2.PlateReader.onplate).read(c,f)}else{if(d.type=="List"){return new JSDraw2.PlateReader.List(d,JSDraw2.PlateReader.onplate).read(c,f)}else{scil.Utils.alert("Cannot recognize the Reader");return 0}}},onplate:function(g,f,c,d,h){if(scil.Utils.isNullOrEmpty(c)){return}if(scil.Utils.isNullOrEmpty(d)){d="response"}if(c=="[[1]]"){if(g.choosePlate(1)!=null){g.plate.setFieldData(JSDraw2.Plate.kKnockout,"");g.plate.setMatrix(f,d)}}else{if(g.selectPlateByBarcode(c)!=null){g.plate.setFieldData(JSDraw2.Plate.kKnockout,"");g.plate.setMatrix(f,d)}}}};JSDraw2.PlateReader.List=scil.extend(scil._base,{constructor:function(d,c){this.options=d;this.onplate=c},read:function(f,y){if(scil.Utils.isNullOrEmpty(f)){return 0}var x=this.options;if(scil.Utils.isNullOrEmpty(x.col_response)||scil.Utils.isNullOrEmpty(x.col_position)&&(scil.Utils.isNullOrEmpty(x.col_row)||scil.Utils.isNullOrEmpty(x.col_column))){return 0}var h=scil.Utils.letter2num(x.barcodeposition)-1;var l=scil.Utils.letter2num(x.col_position)-1;var q=scil.Utils.letter2num(x.col_row)-1;var j=scil.Utils.letter2num(x.col_column)-1;var n=scil.Utils.letter2num(x.col_response)-1;x.leadinglines=parseInt(x.leadinglines);if(!(x.leadinglines>0)){x.leadinglines=0}var D=JSDraw2.Matrix.detectSeparator(f);var u=f.split("\n");var z=0;var d=0;var t=null;var w=new JSDraw2.Matrix();for(var g=x.leadinglines;g<u.length;++g){var C=u[g].split(D);var c=null;if(x.barcodeposition!="1"){c=C[h];if(JSDraw2.PlateReader.onbarcode!=null){c=JSDraw2.PlateReader.onbarcode(c)}if(scil.Utils.isNullOrEmpty(c)){continue}}var B=C[n];var A=null;if(l>0){A=C[l]}else{A=C[q]+C[j]}if(t!=c){if(z>1){w.rotate();this.onplate(y,w,t,x.fieldkey,this)}++d;t=c;w=new JSDraw2.Matrix();z=0}++z;w.setValue(A,null,B)}w.rotate();if(x.barcodeposition=="1"){if(z>1){this.onplate(y,w,"[[1]]",x.fieldkey,this)}return 1}else{if(t!=null){if(z>1){this.onplate(y,w,t,x.fieldkey,this)}++d}}return d}});JSDraw2.PlateReader.Matrix=scil.extend(scil._base,{constructor:function(d,c){this.options=d;this.onplate=c},read:function(f,t){if(scil.Utils.isNullOrEmpty(f)){return 0}var q=this.options;if(scil.Utils.isNullOrEmpty(q.barcodeposition)||scil.Utils.isNullOrEmpty(q.startposition)){return 0}q.linesperplate=parseInt(q.linesperplate);if(!(q.linesperplate>0)){q.linesperplate=0}q.leadinglines=parseInt(q.leadinglines);if(!(q.leadinglines>0)){q.leadinglines=0}var u=JSDraw2.Matrix.detectSeparator(f);var h=f.split("\n");var d=0;var w=q.leadinglines;var l=q.linesperplate>0?Math.floor(h.length/q.linesperplate):1;for(var g=0;g<l;++g){var x=new JSDraw2.Matrix();JSDraw2.Matrix.parseLines(x,h,w+g*q.linesperplate,q.linesperplate,u);var j=x.subset(q.startposition,t.plate.rows,t.plate.cols);if(q.barcodeposition=="1"){this.onplate(t,j,"[[1]]",q.fieldkey,this);return 1}else{var c=x.getValue(q.barcodeposition);if(JSDraw2.PlateReader.onbarcode!=null){c=JSDraw2.PlateReader.onbarcode(c)}this.onplate(t,j,c,q.fieldkey,this);++d}}return d}});JSDraw2.Formulation=scil.extend(scil._base,{constructor:function(f,h){this.jss=null;this.reference=null;this.refered=[];this.inEvent=false;if(h==null){h={}}this.options=h;if(typeof(f)=="string"){f=scil.byId(f)}var d=this.getColumns();var c=this.options.viewonly?["save"]:["new","save","|","insertbefore","insertafter","|","del"];if(this.options.buttons!=null){c=c.concat(this.options.buttons)}if(this.options.hidecols){c.push("|");c.push("hidecols")}var g=this;this.jss=new JSDraw2.Table("",{units:{concentration:"mg/mL"},enablemobiledata:this.options.enablemobiledata,viewonly:this.options.viewonly,toolbar:c,columns:d,width:this.options.width,units:this.options.units,sortable:false,fixedcolumns:true,onAddRow:function(j,l){g.onaddrow(l);if(g.options.onaddrow!=null){g.options.onaddrow(j,l)}},onCellChanged:function(n,j,l){g.oncellchanged(n,j);if(g.options.oncellchange!=null){g.options.oncellchange(l,n,j)}},onDelRow:function(j,l){if(g.options.ondelrow!=null){g.options.ondelrow(j,l)}}},f)},getColumns:function(){var c=this.options.columns!=null?this.options.columns:scil.clone(JSDraw2.Formulation.kFields);if(c.group!=null){if(this.options.groups==null){delete c.group}else{if(c.group.items==null){c.group.items=this.options.groups}}}if(this.options.composition==false){delete c.composition}if(c.role!=null&&c.role.items==null){c.role.items=this.options.roles==null?JSDraw2.Formulation.kRoles:this.options.roles}if(c.parent!=null&&c.parent.autosuggesturl==null){c.parent.autosuggesturl=this.options.parentsuggest}if(c.batch!=null&&c.batch.autosuggesturl==null){c.batch.autosuggesturl=this.options.batchsuggest||this.options.compoundsuggest}var f=this.options.mode;if(c.composition!=null){c.composition.options.mode=f}if(f=="parent"){if(c.batch!=null){c.batch.viewonly=true}}else{if(f=="batch"){if(c.role!=null){c.role.viewonly=true}if(c.parent!=null){c.parent.viewonly=true}if(c.eq!=null){c.eq.viewonly=true}if(c.mass!=null){c.mass.viewonly=true}if(c.reference!=null){c.reference.viewonly=true}if(c.batch!=null&&c.parent!=null&&this.options.compoundsuggest!=null){var d=this;c.batch.type="select";c.batch.onedit=function(g,n,h){var j=h.getCellPos(n);var l=h.getCellValue(j.iRow,"parent");g.items=null;g.listurl=d.options.compoundsuggest+"&parent="+l}}}else{delete c.actualamount;delete c.weighid;delete c.balanceno}}return c},referTo:function(c){this.reference=c;c.refered.push(this)},clear:function(){this.jss.clear()},getXml:function(){return this.jss.getXml()},setXml:function(c){this.jss.setXml(c)},onaddrow:function(c){if(this.jss.getRowCount()==1&&this.reference==null){this.jss.setCellValue(c,"reference",true)}},oncellchanged:function(q,f){if(this.inEvent){return}var j=this;if(this.options.disablecalculation){var d=this.jss.columns[f];if(d.key=="batch"&&!scil.Utils.isNullOrEmpty(this.options.compoundlookup)){var g=this.getRowValues(q);scil.Utils.jsonp(this.options.compoundlookup,function(c){if(c==null){c={}}if(c.compoundid!=null){g.batch=c.compoundid}g.structure=c.sketch;g.mw=c.mw+(c.saltmw>0?c.saltmw:0);g.salt=c.salt;g.moles=g.mass/g.mw;g.units=j.options.units;j.setRowValues(g);if(j.options.oncellchange!=null){j.options.oncellchange(j.jss,q,f)}},{compoundid:g.batch})}else{this.onchange(q,f)}return}var j=this;var d=this.jss.columns[f];var g=this.getRowValues(q);if(this.reference!=null){q.reference=null}var t=(g.batch+"").toLowerCase();if(t!=null&&t!=""&&scil.Utils.indexOf(JSDraw2.solvents,t,true)>=0){g.role="Solvent"}if(d.key=="reference"){if(this.reference!=null||g.row=="Solvent"){g.reference=false}}if(g.role=="Solvent"){this.updateRow(g);this.onchange(q,f);return}switch(d.key){case"batch":if(!scil.Utils.isNullOrEmpty(this.options.compoundlookup)){scil.Utils.jsonp(this.options.compoundlookup,function(c){if(c==null){c={}}if(c.compoundid!=null){g.batch=c.compoundid}g.structure=c.sketch;g.mw=c.mw+(c.saltmw>0?c.saltmw:0);g.salt=c.salt;g.molchanged=true;g.moles=g.mass/g.mw;g.units=j.options.units;j.updateRow(g);j.onchange(q,f)},{compoundid:g.batch})}return;case"moles":g.mass=g.mw*g.moles;this.calcVolume(g);g.molchanged=true;break;case"mass":g.gross=g.mass/(g.purity>0?g.purity:1);g.moles=g.mass/g.mw;this.calcVolume(g);g.molchanged=true;break;case"purity":g.gross=g.mass/(g.purity>0?g.purity:1);g.moles=g.mass/g.mw;this.calcVolume(g);g.molchanged=true;break;case"gross":g.mass=g.gross*(g.purity>0?g.purity:1);g.moles=g.mass/g.mw;this.calcVolume(g);g.molchanged=true;break;case"density":g.concentration=null;if(g.volume==null){g.volume=g.mass/g.density}else{g.mass=g.volume*g.density;g.gross=g.mass/(g.purity>0?g.purity:1);g.moles=g.mass/g.mw;g.molchanged=true}break;case"concentration":g.density=null;if(g.concentrationbyweight){g.density=null;if(g.volume==null){g.volume=g.mass/g.concentration}else{g.mass=g.volume*g.concentration;g.gross=g.mass/(g.purity>0?g.purity:1);g.moles=g.mass/g.mw;g.molchanged=true}}else{if(g.volume==null){g.volume=g.moles/g.concentration}else{g.moles=g.volume*g.concentration;g.mass=g.moles*g.mw;g.gross=g.mass/(g.purity>0?g.purity:1);g.molchanged=true}}break;case"volume":if(g.density>0){g.mass=g.volume*g.density;g.gross=g.mass/(g.purity>0?g.purity:1);g.moles=g.mass/g.mw;g.concentration=null;g.molchanged=true}else{if(g.concentration>0){if(g.concentrationbyweight){g.mass=g.volume*g.concentration;g.gross=g.mass/(g.purity>0?g.purity:1);g.moles=g.mass/g.mw}else{g.moles=g.volume*g.concentration;g.mass=g.moles*g.mw;g.gross=g.mass/(g.purity>0?g.purity:1)}g.density=null;g.molchanged=true}}break;case"ratio":if(scil.Utils.isTrue(g.reference)){this.updateRow(g);this.onchange(q,f);g.molchanged=true}else{g.moles=null;g.molchanged=true}break;case"eq":case"grosseq":if(scil.Utils.isTrue(g.reference)){if(d.key=="eq"){g.grosseq=g.eq}else{g.eq=g.grosseq}for(var h=0;h<this.jss.getRowCount();++h){if(h==q){continue}var l=this.getRowValues(h);this.jss.setCellValueAsNumber(h,"ratio",l.eq/l.mw/(g.eq/g.mw)*g.ratio)}this.updateRow(g);this.onchange(q,f);g.molchanged=true}else{if(g.eq>0){var n=this.getReferenceRowValues();if(n!=null){if(d.key=="eq"){g.grosseq=(n.grosseq/n.eq)*g.eq/(g.purity>0?g.purity:1)}else{g.eq=(n.eq/n.grosseq)*g.grosseq*(g.purity>0?g.purity:1)}if(n.mass>0){g.mass=n.mass*g.eq/n.eq;g.gross=g.mass/(g.purity>0?g.purity:1);this.calcVolume(g);g.moles=g.mass/g.mw}else{g.moles=null}g.ratio=n.ratio*(g.eq/g.mw)/(n.eq/n.mw);g.grosseq=n.grosseq*g.gross/n.gross}}else{g.moles=null}g.molchanged=true}break}this.updateRow(g);this.onchange(q,f)},getConcentration:function(){var c=this.getReferenceRowValues();if(!(c!=null&&c.mass>0)){return null}var d=this.jss.getColSum("volume");return d>0?c.mass/d:null},calcVolume:function(c){if(c.density>0){c.volume=c.mass/c.density;c.concentration=null}else{if(c.concentration>0){if(c.concentrationbyweight){c.volume=c.mass/c.concentration}else{c.volume=c.moles/c.concentration}c.density=null}}},onchange:function(d,c){if(this.options.onchange!=null){this.options.onchange(d,c)}},updateByReference:function(d){this._updateByReference(d);for(var c=0;c<this.refered.length;++c){this.refered[c]._updateByReference(d)}},_updateByReference:function(f){for(var d=0;d<this.jss.getRowCount();++d){var c=this.getRowValues(d);if(scil.Utils.isTrue(c.reference)){continue}if(c.role=="Solvent"){c.volume=f.mass/c.concentration;this.updateRow(c)}else{c.mass=c.eq*f.mass/f.eq;c.gross=c.mass/(c.purity>0?c.purity:1);c.moles=c.mass/c.mw;c.ratio=c.moles*f.ratio/f.moles;c.grosseq=c.gross*f.grosseq/f.gross;this.calcVolume(c);this.updateRow(c)}}},updateRow:function(c){this.inEvent=true;c.units={concentration:c.concentrationbyweight?"g/L":"M"};if(c.molchanged){if(scil.Utils.isTrue(c.reference)){this.jss.setRowValuesAsNumber(c.row,c);this.updateByReference(c)}else{var d=this.getReferenceRowValues();if(d!=null){if(!(c.mass>0)){c.mass=d.mass/d.eq*c.eq;c.gross=c.mass/(c.purity>0?c.purity:1)}c.moles=c.mass/c.mw;if(!isNaN(c.mass)){c.eq=c.mass/d.mass*d.eq}c.ratio=c.moles/d.moles*d.ratio;c.grosseq=c.gross/d.gross*d.grosseq}this.setRowValues(c)}}else{this.setRowValues(c)}this.inEvent=false},setRowValues:function(c){if(c.role=="Solvent"){c.salt=c.moles=c.mass=c.gross=c.mw=c.density=c.concentration=c.eq=c.ratio=c.grosseq="-"}this.jss.setRowValuesAsNumber(c.row,c)},getRowValues:function(d){var c=this.jss.getRowValuesAsNumber(d);if(c!=null){var f=this.jss.getCellValue(d,"concentration");if(f!=null){c.concentrationbyweight=f.indexOf("g")>0}c.row=d}return c},getReferenceRowValues:function(){if(this.reference!=null&&this.reference!=this){return this.reference.getReferenceRowValues()}var c=this.jss.getRowByColValue("reference",true);return c==null?null:this.getRowValues(c)}});scil.apply(JSDraw2.Formulation,{kRoles:["","API","Additive","Excipient","Solvent"],kFields:{group:{label:"Group",width:80,type:"select"},role:{label:"Role",tooltips:"Ingredient Role",type:"select",width:70},parent:{label:"Parent",width:120,minautowidth:200},batch:{label:"Batch",width:120,minautowidth:200},composition:{label:"Composition",type:"subform",width:120,options:{caption:"Composition",fields:{table:{label:"Table",type:"jsdraw.fm"}}}},concentration:{label:"Stock Conc.",tooltips:"Stock Concentration",type:"density",width:100},density:{label:"Density",type:"density",width:80},volume:{label:"Volume",tooltips:"Volume",type:"volume",width:80},gross:{label:"Gross",tooltips:"Gross Weight",type:"mass",width:70},purity:{label:"Purity",type:"percent",width:90},mass:{label:"Mass",tooltips:"Net Mass",type:"mass",width:70},eq:{label:"Ratio",tooltips:"Net Mass Ratio",type:"percent",width:80},actualamount:{label:"Act. Amount",type:"mass",width:80,viewonly:true},balanceno:{label:"Balance",width:80,viewonly:true},weighid:{label:"Weigh ID",width:80,viewonly:true},reference:{label:"Ref.",tooltips:"Reference",type:"radio",width:40}}});JSDraw2.AssayCurve=scilligence.extend(scil._base,{constructor:function(f){this.T="ASSAYCURVE";this._rect=f;this.rawconcentrations=[];this.rawresponses=[];this.rawmasks=[];this.concentrations=[];this.responses=[];this.standarderrors=[];this.masks=[];this.hillslope=null;this.r2=null;this.x50=null;this.ic50=null;this.icx=null;this.calcicx=null;this.showas=null;this.lineshape="I";this.y0=null;this.yinf=null;this.title=null;this.xlabel=null;this.ylabel=null;this.xaxis=null;this.fitmode="curve";this.fixy0=false;this.fixyinf=false;this.average=true;this.x1=null;this.x2=null;this.y1=null;this.y2=null;this.color=null;this.selected=false;this.points=null;this.pointsize=null;this.spots=null;this.curveonly=false;this.curveline=true;this.icxline=false;this.showline="";this.inactiverange=null;this.datashape=null;var g="<i i='1' x='ASSAYCURVE' p='12.957 -12.393 12.480 9.360' concentration='7e-10;3.7e-9;9.15e-8;0.000002286;0.0000114293' response='99.929;97.5883;69.96;6.97;1.69' se='' rawconcentration='' rawresponse='' slope='1.1' r2='0.99989' x50='-6.7066' ic50='1.965e-7' y0='99.545' yinf='0.92251' xlabel='Concentration (uM)' ylabel='Response' xaxis='log' fitmode='curve' average='1' curveonly='0' curveline='1' icxline='0'></i>";var c=scil.Utils.parseXml(g);this.readHtml(c.firstChild);if(f!=null){this._rect=f}},emax:function(){return this.getMax(this.responses)},emin:function(){return this.getMin(this.responses)},getMax:function(d){var f=null;for(var c=0;c<d.length;++c){if(this.masks!=null&&this.masks[c]){continue}if(f==null||f<d[c]){f=d[c]}}return f},getMin:function(d){var f=null;for(var c=0;c<d.length;++c){if(this.masks!=null&&this.masks[c]){continue}if(f==null||f>d[c]){f=d[c]}}return f},isEmpty:function(){return this.concentrations==null||this.concentrations.length==0},html:function(c){return JSDraw2.AssayCurve.getXml(this,c)},readHtml:function(f){var l=JSDraw2.Rect.fromString(f.getAttribute("p"));this._rect=l;this.hillslope=this.tonumber(f.getAttribute("slope"));this.r2=this.tonumber(f.getAttribute("r2"));this.x50=this.tonumber(f.getAttribute("x50"));this.ic50=this.tonumber(f.getAttribute("ic50"));this.icx=this.tonumber(f.getAttribute("icx"));this.calcicx=this.tonumber(f.getAttribute("calcicx"));this.showas=f.getAttribute("showas");this.lineshape=f.getAttribute("lineshape");this.y0=this.tonumber(f.getAttribute("y0"));this.yinf=this.tonumber(f.getAttribute("yinf"));this.x1=this.tonumber(f.getAttribute("x1"));this.x2=this.tonumber(f.getAttribute("x2"));this.y1=this.tonumber(f.getAttribute("y1"));this.y2=this.tonumber(f.getAttribute("y2"));this.title=f.getAttribute("title");this.xlabel=f.getAttribute("xlabel");this.ylabel=f.getAttribute("ylabel");this.xaxis=f.getAttribute("xaxis");this.fitmode=f.getAttribute("fitmode");this.fixy0=scil.Utils.isTrue(f.getAttribute("fixy0"));this.fixyinf=scil.Utils.isTrue(f.getAttribute("fixyinf"));this.average=!scil.Utils.isFalse(f.getAttribute("average"));this.curveonly=scil.Utils.isTrue(f.getAttribute("curveonly"));this.curveline=!scil.Utils.isFalse(f.getAttribute("curveline"));this.icxline=!scil.Utils.isFalse(f.getAttribute("icxline"));this.showline=f.getAttribute("showline");this.inactiverange=f.getAttribute("inactiverange");this.datashape=f.getAttribute("datashape");this.concentrations=this.tonumberarray(f.getAttribute("concentration"));this.responses=this.tonumberarray(f.getAttribute("response"));this.standarderrors=this.tonumberarray(f.getAttribute("se"));var j=this.tonumberarray(f.getAttribute("mask"));if(j!=null){this.masks=[];for(var h=0;h<j.length;++h){this.masks[h]=j[h]==1}}this.rawconcentrations=this.tonumberarray(f.getAttribute("rawconcentration"));this.rawresponses=this.tonumberarray(f.getAttribute("rawresponse"));var j=this.tonumberarray(f.getAttribute("rawmask"));if(j!=null){this.rawmasks=[];for(var h=0;h<j.length;++h){this.rawmasks[h]=j[h]==1}}var n=f.getElementsByTagName("s");if(n!=null){this.spots=[];for(var h=0;h<n.length;++h){var l=parseFloat(n[h].getAttribute("r"));var d=parseFloat(n[h].getAttribute("c"));if(!isNaN(l)&&!isNaN(d)){this.spots.push({r:l,c:d,color:f.getAttribute("color")})}}}return true},getMask:function(c){return this.masks[c]},maskSamplePoint:function(c){if(c>=0&&c<=this.responses.length){this.masks[c]=this.masks[c]?null:true;return true}return false},reportIC50:function(d,c){if(d==null){d=1}var f=this.inactiveRangeValue(d,c);if(f!=null){return f}if(this.ic50==null||isNaN(this.ic50)){return null}return this.toStr(this.ic50*d,c)},toStr:function(c,f){if(f>0){return scil.Utils.roundStr(c,f,false)}else{return c+""}},inactiveRangeValue:function(u,g){if(u==null){u=1}if(this.ic50!=null&&!isNaN(this.ic50)){var j=this.getMax(this.concentrations);if(this.ic50>j){return">"+this.toStr(j*u,g)}var l=this.getMin(this.concentrations);if(this.ic50<l){return"<"+this.toStr(l*u,g)}}var t=this.inactiverange;if(scil.Utils.isNullOrEmpty(t)){return null}t=scil.Utils.unescXmlValue(t);var w=unescape(t).replace(/,/g,";").split(";");for(var h=0;h<w.length;++h){var q=scil.Utils.trim(w[h]);if(q==""){continue}var n=null;var f=null;var d=q.length>1?q.substr(0,1):null;if(d==">"||d=="<"){n=d;f=parseFloat(q.substr(1))}else{return null}if(!(f>0&&f<100)){return null}if(n=="<"){if(this.emax()<f){var j=this.getMax(this.concentrations);var l=this.getMin(this.concentrations);return l==j?null:">"+this.toStr(j*u,g)}}else{if(n==">"){if(this.emin()>f){var j=this.getMax(this.concentrations);var l=this.getMin(this.concentrations);return j==l?null:"<"+this.toStr(l*u,g)}}}}return null},hitSpot:function(d){this.curspot=null;if(d==null||this.points==null||!(this.pointsize>0)){return null}for(var c=0;c<this.points.length;++c){if(d.distTo(this.points[c])<this.pointsize*2){this.curspot=c;break}}return this.curspot},tonumber:function(c){if(c==null||isNaN(c)){return null}return parseFloat(c)},tonumberarray:function(f){if(scil.Utils.isNullOrEmpty(f)){return[]}var d=[];var g=f.indexOf(";")>=0?f.split(";"):f.split(" ");for(var c=0;c<g.length;++c){d.push(this.tonumber(g[c]))}return d},clone:function(){var c=new JSDraw2.AssayCurve(this._rect.clone());this.copyTo(c);return c},copyTo:function(c){c.concentrations=scil.clone(this.concentrations);c.responses=scil.clone(this.responses);c.standarderrors=scil.clone(this.standarderrors);c.masks=scil.clone(this.masks);c.rawconcentrations=scil.clone(this.rawconcentrations);c.rawresponses=scil.clone(this.rawresponses);c.rawmasks=scil.clone(this.rawmasks);c.responsed=this.responsed;c.hillslope=this.hillslope;c.r2=this.r2;c.x50=this.x50;c.ic50=this.ic50;c.icx=this.icx;c.calcicx=this.calcicx;c.showas=this.showas;c.lineshape=this.lineshape;c.y0=this.y0;c.yinf=this.yinf;c.id=this.id;c.color=this.color;c.title=this.title;c.xlabel=this.xlabel;c.ylabel=this.ylabel;c.xaxis=this.xaxis;c.fitmode=this.fitmode;c.fixy0=this.fixy0;c.fixyinf=this.fixyinf;c.x1=this.x1;c.x2=this.x2;c.y1=this.y1;c.y2=this.y2;c.average=this.average;c.curveonly=this.curveonly;c.curveline=this.curveline;c.showline=this.showline;c.inactiverange=this.inactiverange;c.datashape=this.datashape;c.icxline=this.icxline;c.spots=scil.clone(this.spots)},flipY:function(c){},flipX:function(c){},scale:function(d,c){this._rect.scale(d,c)},offset:function(c,d){this._rect.offset(c,d)},rect:function(){return this._rect.clone()},toggle:function(c,d){return this._rect.contains(c)||this._rect.cornerTest(c,d)!=null},drawCur:function(f,d,c){this._drawAnchor(f,d/2,c)},draw:function(g,d,f,c){new JSDraw2.AssayCurveDrawer(this,g,d,c,this._rect.clone()).draw(this)},drawSelect:function(c){c.draw(this,this._rect.fourPoints())},_drawAnchor:function(f,d,c){r=this._rect;f.createCircle({cx:r.left,cy:r.top,r:d}).setFill(c);f.createCircle({cx:r.right(),cy:r.top,r:d}).setFill(c);f.createCircle({cx:r.right(),cy:r.bottom(),r:d}).setFill(c);f.createCircle({cx:r.left,cy:r.bottom(),r:d}).setFill(c)},cornerTest:function(c,d){return this._rect.cornerTest(c,d)},resize:function(c,f){this._rect.moveCorner(c,f)},setAssayCurveRawData:function(c){JSDraw2.AssayCurve.showDlg(this,c,c.options.viewonly)},maskDataPoints:function(c){JSDraw2.QCCurve.show(c,this)},setAssayCurveOnly:function(c){c.pushundo();this.curveonly=!this.curveonly;c.refresh(true)},setIC50CurveLine:function(c){c.pushundo();this.curveline=!this.curveline;c.refresh(true)},setICxCurveLine:function(c){c.pushundo();this.icxline=!this.icxline;c.refresh(true)},setDisplayRange:function(){var g=JSDraw2.AssayCurve.toNumber(this.y1);var h=JSDraw2.AssayCurve.toNumber(this.y2);if(g==null||h==null){var c=JSDraw2.AssayCurve.getRange(this.responses);this.y1=c.min;this.y2=c.max}var d=JSDraw2.AssayCurve.toNumber(this.x1);var f=JSDraw2.AssayCurve.toNumber(this.x2);if(d==null||f==null){var c=JSDraw2.AssayCurve.getRange(this.concentrations);this.x1=c.min;this.x2=c.max}},getShowAs:function(){if(!scil.Utils.isNullOrEmpty(this.showas)){return this.showas}if(!isNaN(this.y0)&&!isNaN(this.yinf)){return this.y0>this.yinf?"IC":"EC"}return"IC"},ic50Label:function(){var c=this.getShowAs();if(c.length>2&&c.substr(0,1)=="["&&c.substr(c.length-1,1)=="]"){return c.substr(1,c.length-2)}return c+"50"},icxLabel:function(){var c=this.getShowAs();if(c.length>2&&c.substr(0,1)=="["&&c.substr(c.length-1,1)=="]"){return c.substr(1,c.length-2)}return c+(this.calcicx>0?this.calcicx:"50")},calculateResponse:function(c){return JSDraw2.AssayCurve.getResponse(this,c)},calculateConcentration:function(c){return JSDraw2.AssayCurve.getConcentration(this,c)}});scil.apply(JSDraw2.AssayCurve,{dlg:null,viewonlydlg:null,viewonly:false,kReportAs:["","IC","EC","LD","LC","[t1/2]"],kIntersections:["","90","80","70","60","50"],cast:function(c){return c!=null&&c.T=="ASSAYCURVE"?c:null},toNumber:function(c){if(c==null){return null}c=parseFloat(c);if(isNaN(c)){return null}return c},menuSetShowCurve:function(g,f,d){var c=JSDraw2.AssayCurve.cast(g);if(c==null){return false}var h=c.showline=="data"||c.showline=="curve"?c.showline:"";if(f!="data"&&f!=="curve"){f=""}if(h==f){return false}d.pushundo();c.showline=f;d.refresh(true)},getRange:function(d){var g=null;var f=null;for(var c=0;c<d.length;++c){if(d[c]==null||isNaN(d[c])){continue}if(g==null){g=f=d[c]}else{if(f<d[c]){f=d[c]}else{if(g>d[c]){g=d[c]}}}}return{min:g,max:f}},getResponse:function(d,c){c=scil.Math.log10(c);var g=d.x50;var j=d.y0;var l=d.yinf;var f=d.hillslope;var h=j+(l-j)/(1+Math.exp(Math.LN10*f*(g-c)));return h},getConcentration:function(d,f){var h=d.x50;var j=d.y0;var l=d.yinf;var g=d.hillslope;var c=h-Math.log((l-j)/(f-j)-1)/Math.LN10/g;return Math.pow(10,c)},showDlg:function(c,f,j){this.viewonly=j;var d=null;var g={data:{label:"Data",type:"textarea",width:500,height:150,colspan:2},ic50:{label:"IC50",type:"number",width:100,viewonly:true},hillslope:{label:"Hill Slope",type:"number",width:100,viewonly:true},x50:{label:"logEC50",type:"number",width:100,viewonly:true},r2:{label:"R2",type:"number",width:100,viewonly:true},icx:{label:"ICx",type:"number",width:100,viewonly:true},calcicx:{label:"X of ICx",type:"dropdowninput",width:100,items:this.kIntersections},y0:{label:"Y0",type:"number",width:100},fixy0:{label:"Fix Y0",type:"checkbox"},yinf:{label:"Y-Inflection",type:"number",width:100},fixyinf:{label:"Fix Y-Inflection",type:"checkbox"},x1:{label:"Display Range X1",type:"number",width:100},x2:{label:"-X2",type:"number",width:100},y1:{label:"Display Range Y1",type:"number",width:100},y2:{label:"-Y2",type:"number",width:100},title:{label:"Chart Title",width:150},fitmode:{label:"Chart Type",type:"select",sort:false,width:104,items:{curve:"Fitted Curve",fitline:"Fitted Line",line:"Unfitted Line",dot:"Dot",bar:"Bar"}},xlabel:{label:"X Axis Label",width:150},xaxis:{label:"X Axis",type:"select",items:["log","linear"],width:104},ylabel:{label:"Y Axis Label",width:150},average:{label:"Average Repeat",type:"checkbox"},showas:{label:"Show As",type:"select",items:this.kReportAs,width:100},lineshape:{label:"Fit Line Shape",type:"select",items:["","I","L"],width:104},inactiverange:{label:"Inactive Range",allowhtml:true,width:100,str:"% (e.g.>50)"},datashape:{label:"Data Shape",type:"select",items:["","circle","square","timer","diamond","triangle","delta"],width:104}};if(j){if(this.viewonlydlg==null){var h=this;g.data.type="html";g.data.height=null;this.viewonlydlg=scil.Form.createDlgForm("View Raw Assay Data",g,null,{viewonly:true,owner:f,lang:JSDraw2.Language})}d=this.viewonlydlg}else{if(this.dlg==null){var h=this;this.dlg=scil.Form.createDlgForm("Set Raw Curve Data",g,[{src:scil.App.imgSmall("submit.png"),label:"Save",onclick:function(){h.saveData()}}," ",{src:scil.App.imgSmall("properties.png"),label:"Fit",onclick:function(){h.fit()}}],{lang:JSDraw2.Language})}d=this.dlg}d.show2({owner:f});d.curve=c;d.ed=f;if(j){d.form.items.ic50.td1.innerHTML=c.ic50Label();d.form.items.icx.td1.innerHTML=c.icxLabel()}this.setCurveData(d.form,c)},maskPoint:function(f,d){var g=f.jsd;var c=g==null?null:JSDraw2.AssayCurve.cast(g.m.graphics[0]);if(c==null){return}var h=g.eventPoint(d);var j=c.hitSpot(h);if(j!=null){c.maskSamplePoint(j);g.refresh()}},fit:function(){var f=this.dlg.ed;var c=this.getCurveData(this.dlg.form);c.ic50=null;c.icx=null;c.hillslope=null;c.r2=null;c.curveline=this.dlg.curve==null?true:this.dlg.curve.curveline;if(c.calcicx=="50"){c.calcicx=null}var l=JSDraw2.AssayCurve.getXml(c);var g=this;if(JSDraw2.AssayCurve.onFit!=null){var h=JSDraw2.AssayCurve.onFit(l);this.fit2(h)}else{var j=scil.Utils.serviceAvailable()?JSDrawServices.url:null;if(j==null){scil.Utils.alert("JSDraw wev service is required to do curve fitting");return}scil.Utils.ajax(j+"?cmd=curve.fit",function(d){g.fit2(d)},{data:l})}},fit2:function(f){if(f==""||f==null){scil.Utils.alert("Curve fitting failed.  Please double check the input data and try it again.");return}var d=new JSDraw2.Mol();d.setXml(f.data);var c=JSDraw2.AssayCurve.cast(d.graphics[0]);if(c!=null){this.saveData(c)}else{scil.Utils.alert("Cannot read result curve")}},saveData:function(h){var g=this.dlg.ed;var f=this.getCurveData(this.dlg.form);if(!g.options.viewonly){g.pushundo()}if(this.dlg.curve==null){this.dlg.curve=new JSDraw2.AssayCurve(new JSDraw2.Rect(0,0,g.bondlength*8,g.bondlength*6));g.m.addGraphics(this.dlg.curve);g.fitToWindow()}var c=this.dlg.curve;if(h!=null){h.copyTo(c)}else{if(c.concentrations==null||f.fitmode!="curve"){c.concentrations=f.concentrations;c.responses=f.responses;c.masks=f.masks;c.hillslope=parseFloat(f.hillslope);c.r2=parseFloat(f.r2);c.x50=parseFloat(f.x50);c.ic50=parseFloat(f.ic50);c.icx=parseFloat(f.icx);c.calcicx=parseInt(f.calcicx);c.rawconcentrations=null;c.rawresponses=null;c.rawmasks=null;c.standarderrors=null}else{c.rawconcentrations=f.concentrations;c.rawresponses=f.responses;c.rawmasks=f.masks}c.y0=parseFloat(f.y0);c.yinf=parseFloat(f.yinf);c.fixy0=f.fixy0;c.fixyinf=f.fixyinf;c.x1=f.x1;c.x2=f.x2;c.y1=f.y1;c.y2=f.y2;c.title=f.title;c.xlabel=f.xlabel;c.ylabel=f.ylabel;c.xaxis=f.xaxis;c.fitmode=f.fitmode;c.average=f.average;c.showas=f.showas;c.lineshape=f.lineshape;c.inactiverange=f.inactiverange;c.datashape=f.datashape}if(g.options.onfitresult!=null){g.options.onfitresult(c)}this.dlg.hide();g.refresh(true)},setCurveData:function(d,j){if(j==null){d.setData({fitmode:"curve",xaxis:"log",average:true});return}var c;var h;var g;if(j.rawconcentrations!=null&&j.rawconcentrations.length>0){c=j.rawconcentrations;h=j.rawresponses;g=j.rawmasks}else{c=j.concentrations;h=j.responses;g=j.masks}var l="";for(var f=0;f<c.length;++f){l+=c[f];if(g!=null&&g[f]){l+="\t("+h[f]+")"}else{l+="\t"+h[f]}l+="\r\n"}if(this.viewonly){l=(j.xlabel==null?"":j.xlabel)+"\t"+(j.ylabel==null?"":j.ylabel)+"\r\n"+l;l=scil.FieldTabText.table2Html(l)}if(j.fitmode==null){j.fitmode="curve"}if(j.xaxis==null){j.xaxis="log"}j.data=l;d.setData(j);j.data=null},getCurveData:function(f){var c=f.getData();var j=[];var h={};this.splitData(c.data,j,h);c.concentrations=[];c.responses=[];c.masks=[];for(var g=0;g<j.length;++g){var l=j[g];if(l==null||isNaN(l.x)||isNaN(l.y)){continue}c.concentrations.push(l.x);c.responses.push(l.y);c.masks.push(l.m)}if(!scil.Utils.isNullOrEmpty(h.x)||!scil.Utils.isNullOrEmpty(h.y)){c.xlabel=h.x;c.ylabel=h.y}return c},splitData:function(u,l,j){if(u==null){return}u=scil.Utils.trim(u);if(u==""){return}var w=u.split("\n");if(w.length==1){w=u.split("|")}var d=null;if(w.length==2){d=this.detectSeparator(u);if(d!=null){var x=scil.Utils.trim(w[0]).split(d);var y=scil.Utils.trim(w[1]).split(d);if(x.length==y.length){for(var g=0;g<x.length;++g){var n=this.parsePoint(x[g],y[g]);if(!isNaN(n.x)&&!isNaN(n.y)){l.push(n)}}}}}else{var f=0;var t=[];for(var g=0;g<w.length;++g){var u=scil.Utils.trim(w[g]);if(u==""){continue}if(d==null){d=this.detectSeparator(u)}var q=[];var y=u.split(d);if(y!=null&&y.length>=2){t.push(q);for(var h=1;h<y.length;++h){var n=this.parsePoint(y[0],y[h]);if(g==0&&h==1&&(isNaN(n.x)||isNaN(n.y))){j.x=y[0];j.y=y[1];break}else{q.push(n)}}}if(q.length>f){f=q.length}}for(var g=0;g<f;++g){for(var h=0;h<t.length;++h){l.push(t[h][g])}}}},splitStr:function(c){if(c==null){return null}c=c.replace(/[ ]{2,1000}/g," ").replace(/[,|\t| ]/g,";");return c.split(";")},detectSeparator:function(d){var c=d.indexOf(";");if(c>0){return";"}c=d.indexOf(",");if(c>0){return","}c=d.indexOf("\t");if(c>0){return"\t"}c=d.indexOf(" ");if(c>0){return" "}return null},parsePoint:function(d,f){var c=false;if(d.length>2&&d.substr(0,1)=="("&&d.substr(d.length-1)==")"){c=true;d=d.substr(1,d.length-2)}if(f.length>2&&f.substr(0,1)=="("&&f.substr(f.length-1)==")"){c=true;f=f.substr(1,f.length-2)}return{x:parseFloat(d),y:parseFloat(f),m:c}},getXml:function(d,q,c){var f=false;var j="";if(d.masks!=null){for(var h=0;h<d.masks.length;++h){if(h>0){j+=";"}j+=d.masks[h]?1:0;if(d.masks[h]){f=true}}}if(!f&&c==false){f=true;j="0";for(var h=1;h<d.concentrations.length;++h){j+=";0"}}var g=false;var l="";if(d.rawmasks!=null){for(var h=0;h<d.rawmasks.length;++h){if(h>0){l+=";"}l+=d.rawmasks[h]?1:0;if(d.rawmasks[h]){g=true}}}var n="<i";if(d.id!=null){n+=" i='"+d.id+"'"}if(d.T!=null){n+=" x='"+d.T+"'"}if(d._rect!=null){n+=" p='"+d._rect.toString(q)+"'"}if(d.concentrations!=null){n+=" concentration='"+scil.Utils.array2str(d.concentrations,";")+"'"}if(d.responses!=null){n+=" response='"+scil.Utils.array2str(d.responses,";")+"'"}if(d.standarderrors!=null){n+=" se='"+scil.Utils.array2str(d.standarderrors,";")+"'"}if(f){n+=" mask='"+j+"'"}if(d.rawconcentrations!=null){n+=" rawconcentration='"+scil.Utils.array2str(d.rawconcentrations,";")+"'"}if(d.rawresponses!=null){n+=" rawresponse='"+scil.Utils.array2str(d.rawresponses,";")+"'"}if(g){n+=" rawmask='"+l+"'"}if(d.hillslope!=null){n+=" slope='"+d.hillslope+"'"}if(d.r2!=null){n+=" r2='"+d.r2+"'"}if(d.x50!=null){n+=" x50='"+d.x50+"'"}if(d.ic50!=null){n+=" ic50='"+d.ic50+"'"}if(d.icx!=null){n+=" icx='"+d.icx+"'"}if(d.calcicx>0){n+=" calcicx='"+d.calcicx+"'"}if(d.y0!=null){n+=" y0='"+d.y0+"'"}if(d.yinf!=null){n+=" yinf='"+d.yinf+"'"}if(d.x1!=null){n+=" x1='"+d.x1+"'"}if(d.x2!=null){n+=" x2='"+d.x2+"'"}if(d.y1!=null){n+=" y1='"+d.y1+"'"}if(d.y2!=null){n+=" y2='"+d.y2+"'"}if(d.color!=null){n+=" clr='"+d.color+"'"}if(!scil.Utils.isNullOrEmpty(d.title)){n+=" title='"+scil.Utils.escXmlValue(d.title)+"'"}if(!scil.Utils.isNullOrEmpty(d.xlabel)){n+=" xlabel='"+scil.Utils.escXmlValue(d.xlabel)+"'"}if(!scil.Utils.isNullOrEmpty(d.ylabel)){n+=" ylabel='"+scil.Utils.escXmlValue(d.ylabel)+"'"}if(!scil.Utils.isNullOrEmpty(d.xaxis)){n+=" xaxis='"+scil.Utils.escXmlValue(d.xaxis)+"'"}if(!scil.Utils.isNullOrEmpty(d.fitmode)){n+=" fitmode='"+scil.Utils.escXmlValue(d.fitmode)+"'"}if(!scil.Utils.isNullOrEmpty(d.showas)){n+=" showas='"+scil.Utils.escXmlValue(d.showas)+"'"}if(!scil.Utils.isNullOrEmpty(d.lineshape)){n+=" lineshape='"+scil.Utils.escXmlValue(d.lineshape)+"'"}if(!scil.Utils.isNullOrEmpty(d.showline)){n+=" showline='"+scil.Utils.escXmlValue(d.showline)+"'"}if(!scil.Utils.isNullOrEmpty(d.inactiverange)){n+=" inactiverange='"+scil.Utils.escXmlValue(d.inactiverange)+"'"}if(!scil.Utils.isNullOrEmpty(d.datashape)){n+=" datashape='"+scil.Utils.escXmlValue(d.datashape)+"'"}if(d.fixy0){n+=" fixy0='1'"}if(d.fixyinf){n+=" fixyinf='1'"}n+=" average='"+(d.average?1:0)+"'";n+=" curveonly='"+(d.curveonly?1:0)+"'";n+=" curveline='"+(d.curveline?1:0)+"'";n+=" icxline='"+(d.icxline?1:0)+"'";n+=">";if(d.spots!=null){for(var h=0;h<d.spots.length;++h){var t=d.spots[h];n+="<s r='"+t.r+"' c='"+t.c+"'";if(t.color!=null&&t.color!=""){n+=" color='"+t.color+"'"}n+="/>"}}n+="</i>";return n}});JSDraw2.AssayCurveDrawer=scil.extend(scil._base,{constructor:function(c,g,f,d){this.surface=g;this.linewidth=f;this.fontsize=d;this.minX=null;this.maxX=null;this.minY=null;this.maxY=null;this.scalex=0;this.scaley=0;this.r=3;this.margin=30;this.rect=c._rect.clone();this.margin=this.rect.width/10;if(this.margin>50){this.margin=50}this.r=this.margin/7.5},draw:function(h){h.pointsize=this.r;var g=h.color==null||h.color==""?"black":h.color;var A=this.rect.clone().inflate(-this.margin,-this.margin).offset(this.margin/2,0);if(A.width<=0||A.height<=0){return}if(!h.curveonly){JSDraw2.Drawer.drawRect(this.surface,A,g,this.linewidth/2)}if(h.isEmpty()){return}var l=h.fitmode==null||h.fitmode==""?"curve":h.fitmode;var F=this.calcXYValues(h,l);var n=this.r*2.5;var q=this.r*2;if(l=="curve"){if(h.showline!="data"){this.sampleFunctionToLine(h,Math.max(10,Math.round((this.rect.width-2*this.margin)/5)),g,F.xaxis)}}else{if(l=="line"||l=="fitline"){this.drawline(F.ls==null?h.points:F.fitpoints,g);if(F.ls!=null){var f=A.center();if(!scil.Utils.isNullOrEmpty(F.ls.formular)){JSDraw2.Drawer.drawText2(this.surface,new JSDraw2.Point(f.x,A.top+this.margin/2),F.ls.formular,g,n)}if(F.ls.r2!=null&&F.ls.r2>0){JSDraw2.Drawer.drawText2(this.surface,new JSDraw2.Point(f.x,A.top+this.margin/2+n*1.2),"R² = "+scil.Utils.round(F.ls.r2,4),g,n);JSDraw2.Drawer.drawText2(this.surface,new JSDraw2.Point(f.x,A.top+this.margin/2+n*2.4),"R = "+scil.Utils.round(Math.sqrt(F.ls.r2),4),g,n)}}}else{if(l=="bar"){this.drawbar(h.points,this.rect.bottom()-this.margin,2*this.r,g)}}}var E=this.linewidth/4;var D=h.average?h.standarderrors:null;if(h.showline!="curve"){for(var t=0;t<h.points.length;++t){var u=h.points[t];var C=D==null?null:D[t];if(C>0){var j=(C*this.scaley*this.r)/2;var x=new JSDraw2.Point(u.x,u.y-j);var y=new JSDraw2.Point(u.x,u.y+j);JSDraw2.Drawer.drawLine(this.surface,x,y,g,E);JSDraw2.Drawer.drawLine(this.surface,new JSDraw2.Point(x.x-this.r,x.y),new JSDraw2.Point(x.x+this.r,x.y),g,E);JSDraw2.Drawer.drawLine(this.surface,new JSDraw2.Point(y.x-this.r,y.y),new JSDraw2.Point(y.x+this.r,y.y),g,E)}if(l!="bar"){if(u.y!=null&&!isNaN(u.y)){this.drawSamplePoint(h,t,u,g,E)}}}}if(h.spots!=null){for(var t=0;t<h.spots.length;++t){var B=h.spots[t];var u=this.toScreenPoint(B.x,B.r);var g=B.color==null?"red":B.color;var z=(B.scale==null?2:B.scale)*this.r;var f=JSDraw2.Drawer.drawEllipse(this.surface,new JSDraw2.Rect(u.x-z,u.y-z,2*z,2*z),g,this.linewidth/2);f.setFill(g)}}if(l=="curve"){if(h.curveline){this.drawFitLine(h,F,JSDraw2.AssayCurve.toNumber(h.ic50),n,h.ic50Label())}if(h.icxline&&h.calcicx>0){this.drawFitLine(h,F,JSDraw2.AssayCurve.toNumber(h.icx),n,h.icxLabel())}}if(!h.curveonly){this.drawAxis(h,F,A)}},drawSamplePoint:function(g,h,j,f,n){var d=null;var l=[];switch(g.datashape){case"square":l.push({x:j.x-this.r*0.75,y:j.y-this.r*0.75});l.push({x:j.x+this.r*0.75,y:j.y-this.r*0.75});l.push({x:j.x+this.r*0.75,y:j.y+this.r*0.75});l.push({x:j.x-this.r*0.75,y:j.y+this.r*0.75});break;case"timer":l.push({x:j.x-this.r,y:j.y-this.r});l.push({x:j.x+this.r,y:j.y-this.r});l.push({x:j.x-this.r,y:j.y+this.r});l.push({x:j.x+this.r,y:j.y+this.r});break;case"diamond":l.push({x:j.x,y:j.y-this.r});l.push({x:j.x+this.r,y:j.y});l.push({x:j.x,y:j.y+this.r});l.push({x:j.x-this.r,y:j.y});break;case"triangle":l.push({x:j.x,y:j.y-this.r});l.push({x:j.x+this.r,y:j.y+this.r});l.push({x:j.x-this.r,y:j.y+this.r});break;case"delta":l.push({x:j.x,y:j.y+this.r});l.push({x:j.x+this.r,y:j.y-this.r});l.push({x:j.x-this.r,y:j.y-this.r});break;case"circle":default:d=JSDraw2.Drawer.drawEllipse(this.surface,new JSDraw2.Rect(j.x-this.r,j.y-this.r,2*this.r,2*this.r),f,n);break}if(d==null){d=JSDraw2.Drawer.drawPolygon(this.surface,l,f,n)}if(!g.masks[h]){d.setFill(f)}},drawFitLine:function(g,A,j,h,t){var f=g.color==null||g.color==""?"blue":g.color;var l=g.inactiveRangeValue();if(l!=null){var d=this.rect.center();l=g.reportIC50(1,2);JSDraw2.Drawer.drawText(this.surface,new JSDraw2.Point(d.x,d.y),t+" = "+l,f,h,"center");return}if(j==null){return}var u=scil.Math.log10(j);var w=this.toScreenPoint(u,this.minY);var x=this.toScreenPoint(u,this.maxY);if(g.lineshape=="L"){var z=g.xaxis==null||g.xaxis==""?"log":g.xaxis;var B=JSDraw2.AssayCurve.getResponse(g,z=="log"?Math.pow(10,u):u);var n=this.toScreenPoint(this.minX,B);var q=this.toScreenPoint(u,B);JSDraw2.Drawer.drawLine(this.surface,w,q,f,this.linewidth/2);JSDraw2.Drawer.drawLine(this.surface,n,q,f,this.linewidth/2)}else{JSDraw2.Drawer.drawLine(this.surface,w,x,f,this.linewidth/2)}if(A.yValues[0]>A.yValues[A.yValues.length-1]){JSDraw2.Drawer.drawText(this.surface,new JSDraw2.Point(x.x+this.r,x.y+4*this.r),t+" = "+this.toStr(j,2),f,h);JSDraw2.Drawer.drawText(this.surface,new JSDraw2.Point(x.x+this.r,x.y+8*this.r),"Hill Slope = "+this.toStr(g.hillslope,2),f,h);JSDraw2.Drawer.drawText(this.surface,new JSDraw2.Point(x.x+this.r,x.y+12*this.r),"R2 = "+this.toStr(g.r2,2),f,h)}else{JSDraw2.Drawer.drawText(this.surface,new JSDraw2.Point(w.x+this.r,w.y-14*this.r),t+" = "+this.toStr(j,2),f,h);JSDraw2.Drawer.drawText(this.surface,new JSDraw2.Point(w.x+this.r,w.y-10*this.r),"Hill Slope = "+this.toStr(g.hillslope,2),f,h);JSDraw2.Drawer.drawText(this.surface,new JSDraw2.Point(w.x+this.r,w.y-6*this.r),"R2 = "+this.toStr(g.r2,2),f,h)}},drawAxis:function(g,D,z){var f=g.color==null||g.color==""?"black":g.color;var h=g.fitmode==null||g.fitmode==""?"curve":g.fitmode;var j=this.r*2.5;var l=this.r*2;var q=Math.round((this.rect.width-2*this.margin)/this.r/13);var A=(this.maxY-this.minY)/q;if(A!=0){for(var n=0;n<=q;++n){var E=this.minY+A*n;var u=this.toScreenPoint(this.minX,E);var w=new JSDraw2.Point(u.x-this.r,u.y);JSDraw2.Drawer.drawLine(this.surface,u,w,f,this.linewidth/4);w.x-=this.r/2;w.y-=this.r*2;JSDraw2.Drawer.drawText(this.surface,w,this.toStr(E,1),f,l,"right")}}A=(this.maxX-this.minX)/q;for(var n=0;n<=q;++n){var C=this.minX+A*n;var u=this.toScreenPoint(C,this.minY);if(u.y==null){u.y=z.bottom()}var w=new JSDraw2.Point(u.x,u.y+this.r);JSDraw2.Drawer.drawLine(this.surface,u,w,f,this.linewidth/4);w.y+=this.r*1.5;JSDraw2.Drawer.drawText2(this.surface,w,this.toStr(D.xaxis=="log"?Math.pow(10,C):C,1),f,l)}var d=z.center();if(g.title!=null&&g.title!=""){JSDraw2.Drawer.drawText2(this.surface,new JSDraw2.Point(d.x,z.top-this.margin/2),g.title,f,j)}if(g.xlabel!=null&&g.xlabel!=""){JSDraw2.Drawer.drawText2(this.surface,new JSDraw2.Point(d.x,z.bottom()+this.margin*0.7),g.xlabel,f,l)}if(g.ylabel!=null&&g.ylabel!=""){var B=JSDraw2.Drawer.drawText2(this.surface,new JSDraw2.Point(z.left-this.margin*1.3,d.y),g.ylabel,f,l,-Math.PI/2)}},calcXYValues:function(d,g){var u=d.responses;var c=d.concentrations;if(!d.average&&d.rawresponses!=null&&d.rawresponses.length>1&&d.rawconcentrations!=null&&d.rawconcentrations.length>1){u=d.rawresponses;c=d.rawconcentrations}var G=scil.clone(u);var E=JSDraw2.AssayCurve.toNumber(d.y1);var F=JSDraw2.AssayCurve.toNumber(d.y2);if(E!=null&&F!=null){this.minY=Math.min(E,F);this.maxY=Math.max(E,F)}else{var w=JSDraw2.AssayCurve.getRange(G);this.minY=w.min;this.maxY=w.max;if(!isNaN(d.y0)){this.minY=Math.min(d.y0,this.minY);this.maxY=Math.max(d.y0,this.maxY)}if(!isNaN(d.yinf)){this.minY=Math.min(d.yinf,this.minY);this.maxY=Math.max(d.yinf,this.maxY)}}if(d.spots!=null){for(var l=0;l<d.spots.length;l++){var y=d.spots[l];var z=scil.Math.log10(y.c);y.x=z}}var C=d.xaxis==null||d.xaxis==""?"log":d.xaxis;var D=scil.clone(c);if(C=="log"){for(var l=0;l<D.length;l++){var z=scil.Math.log10(D[l]);D[l]=z}}var A=JSDraw2.AssayCurve.toNumber(d.x1);var B=JSDraw2.AssayCurve.toNumber(d.x2);if(A!=null&&B!=null){if(C=="log"){A=scil.Math.log10(A);B=scil.Math.log10(B)}this.minX=Math.min(A,B);this.maxX=Math.max(A,B)}else{var w=JSDraw2.AssayCurve.getRange(D);this.minX=w.min;this.maxX=w.max}this.scalex=(this.rect.width-2*this.margin)/(this.maxX-this.minX);this.scaley=(this.rect.height-2*this.margin)/(this.maxY-this.minY);var n=null;if(g=="bar"){var f=6*this.r/this.scalex;this.minX-=f;this.maxX+=f;this.scalex=(this.rect.width-2*this.margin)/(this.maxX-this.minX)}else{if(g=="fitline"){n=scil.Math.lsfit(D,G)}}d.points=[];var h=[];for(var j=0;j<D.length;++j){var q=this.toScreenPoint(D[j],G[j]);d.points[j]=q;if(n!=null){var t=this.toScreenPoint(D[j],n.yvalues[j]);h[j]=t}}return{xaxis:C,fitpoints:h,xValues:D,yValues:G,ls:n}},toStr:function(c,f){return c==null||isNaN(c)?"":scil.Utils.roundStr(c,f)},roundToSignificantDigits:function(c,f){if(c==null||isNaN(c)){return null}if(c==0){return 0}var g=Math.pow(10,Math.floor(scil.Math.log10(Math.abs(c)))+1);return g*scil.Utils.round(c/g,f+1)},toScreenPoint:function(d,g){var f=this.margin*1.5+this.scalex*(d-this.minX);var h=this.rect.height-this.margin-(this.scaley*(g-this.minY));var c=new JSDraw2.Point(f+this.rect.left,h+this.rect.top);if(g==null||isNaN(h)){c.y=null}return c},sampleFunctionToLine:function(d,j,c,q){var h=null;var l=(this.maxX-this.minX)/(j-1);for(var f=0;f<j;f++){var n=this.minX+l*f;var t=JSDraw2.AssayCurve.getResponse(d,q=="log"?Math.pow(10,n):n);var g=this.toScreenPoint(n,t);if(g.x==null||g.y==null){h=null;continue}if(h!=null){JSDraw2.Drawer.drawLine(this.surface,h,g,c,this.linewidth/2)}h=g}},drawline:function(h,c){var j=h[0].x>h[h.length-1].x;for(var d=1;d<h.length;++d){var f=j?h[d]:h[d-1];var g=j?h[d-1]:h[d];if(f.y==null||isNaN(f.y)||g.y==null||isNaN(g.y)){continue}if(f.x<g.x){JSDraw2.Drawer.drawLine(this.surface,f,g,c,this.linewidth/2)}}},drawbar:function(h,n,l,c){var j=this.detectSeries(h);if(j!=null&&j.length<=5&&j.length>1){var d=["red","green","blue","yellow","purple"];l/=2;for(var g=0;g<j.length;++g){var f=l*2*g-j.length*l;this.drawBarSeries(j[g],n,l,d[g],f)}}else{this.drawBarSeries(h,n,l,c,-l)}},drawBarSeries:function(j,n,l,d,f){for(var g=0;g<j.length;++g){var h=j[g];if(h.y==null||isNaN(h.y)){continue}var c=JSDraw2.Drawer.drawRect(this.surface,new JSDraw2.Rect(h.x+f,h.y,l*2,Math.abs(n-h.y)),d,this.linewidth/2);if(c!=null){c.setFill(d)}}},detectSeries:function(d){var g=[];var f=[d[0]];for(var c=1;c<d.length;++c){if(d[c-1].x>=d[c].x){if(f.length>0){g.push(f);f=[]}}f.push(d[c])}if(f.length>0){g.push(f)}return g}});JSDraw2.HeatMap=scil.extend(scil._base,{constructor:function(f,d){this.kBorderColor="#eee";this.kHighlightColor="red";this.options=d==null?{}:d;this.tbody=scil.Utils.createTable(f,0,0,{border:"solid 1px #eee"});this.setData(this.options.data);var c=this;if(this.options.clickable||this.options.onclick!=null){scil.connect(this.tbody.parentNode,"onclick",function(g){c.click(g)})}},click:function(d){var j=d.target||d.srcElement;if(j.tagName!="TD"){return}var h=parseInt(j.getAttribute("r"));var c=parseInt(j.getAttribute("c"));if(!(h>=0)||!(c>=0)){return}var g=j.style.borderColor==this.kHighlightColor;if(this.options.canclick==null||this.options.canclick(h,c,g,this,d)==false){return}if(g){j.style.borderColor=this.kBorderColor}else{j.style.borderColor=this.kHighlightColor}if(this.options.onclick!=null){this.options.onclick(h,c,!g,this,d)}},clear:function(){this.data=null;scil.Utils.removeAll(this.tbody)},setData:function(l){this.clear();this.data=l;if(l==null||l.rows==null){return}var j=JSDraw2.ColorProfile.colors[l.colorprofile];if(j==null){j=JSDraw2.ColorProfile.defaultprofile}var C=null;var d="solid 2px "+this.kBorderColor;if(l.low==null||l.high==null){var u=null;var n=null;for(var q=0;q<l.rows.length;++q){var x=l.rows[q];for(var t=0;t<x.length;++t){var y=x[t];if(scil.Utils.isNullOrEmpty(y)){continue}var D=parseFloat(x[t]);if(u==null){u=n=D}else{if(D<u){u=D}else{if(D>n){n=D}}}}}if(l.low==null&&u!=null&&!isNaN(u)){l.low=u}if(l.high==null&&n!=null&&!isNaN(n)){l.high=n}}var h=this.options.cellwidth;if(!(h>0)){h=50}var g=this.options.cellheight;if(!(g>0)){g=16}var z={i:0,colors:{}};for(var q=0;q<l.rows.length;++q){var x=l.rows[q];var w=l.masks==null?null:l.masks[q];if(q==0){var B=scil.Utils.createElement(this.tbody,"tr",null,{height:g});scil.Utils.createElement(B,"td",null,{width:h});for(var t=0;t<x.length;++t){var A=scil.Utils.createElement(B,"td");scil.Utils.createElement(A,"div",t+1,{textAlign:"center",background:"#ccc",color:"#fff",minWidth:h+"px",border:d})}}var B=scil.Utils.createElement(this.tbody,"tr",null,{height:g});for(var t=0;t<x.length;++t){if(t==0){scil.Utils.createElement(B,"td",scil.Utils.num2letter(q+1),{textAlign:"center",color:"#fff",background:"#ccc",border:d})}var f=j.calculate(x[t],z,this.data);var A=scil.Utils.createElement(B,"td",x[t],{textAlign:"center",background:f,border:d},{r:q,c:t});if(w!=null&&scil.Utils.isTrue(w[t])){A.style.borderColor=this.kHighlightColor}}}}});JSDraw2.ColorProfile=scil.extend(scil._base,{constructor:function(d,g,f,c){this.lowcolor=d!=null?d:{r:125,g:255,b:0};this.highcolor=g!=null?g:{r:255,g:125,b:0};this.log=f;this.colors=c!=null?c:["#C00","#F00","#C03","#F03","#C06","#F06","#C09","#F09","#C0C","#F0C","#C0F","#F0F","#C30","#F30","#C33","#F33","#C36","#F36","#C39","#F39","#C3C","#F3C","#C3F","#F3F","#C60","#F60","#C63","#F63","#C66","#F66","#C69","#F69","#C6C","#F6C","#C6F","#F6F","#C90","#F90","#C93","#F93","#C96","#F96","#C99","#F99","#C9C","#F9C","#C9F","#F9F","#CC0","#FC0","#CC3","#FC3","#CC6","#FC6","#CC9","#FC9","#CCC","#FCC","#CCF","#FCF","#CF0","#FF0","#CF3","#FF3","#CF6","#FF6","#CF9","#FF9","#CFC","#FFC","#CFF"]},nextcolor:function(d){++d.i;var c=this.colors.length;return this.colors[c-(d.i-1)%c-1]},calculate:function(l,w,q){if(scil.Utils.isNullOrEmpty(l)){return null}if(typeof(l)=="string"){v=parseFloat(l)}else{v=l}if(isNaN(v)){if(typeof(l)=="string"){var f=w.colors[l];if(f==null){f=this.nextcolor(w);w.colors[l]=f}return f}else{return null}}if(v<q.low){v=q.low}if(v>q.high){v=q.high}var u;if(this.log){u=(scil.Math.log10(v)-scil.Math.log10(q.low))/(scil.Math.log10(q.high)-scil.Math.log10(q.low))}else{u=(v-q.low)/(q.high-q.low)}var n=this.lowcolor.r+Math.round((this.highcolor.r-this.lowcolor.r)*u);var h=this.lowcolor.g+Math.round((this.highcolor.g-this.lowcolor.g)*u);var c=this.lowcolor.b+Math.round((this.highcolor.b-this.lowcolor.b)*u);var t=n.toString(16);var j=h.toString(16);var d=c.toString(16);return"#"+(t.length==1?"0"+t:t)+(j.length==1?"0"+j:j)+(d.length==1?"0"+d:d)}});scil.apply(JSDraw2.ColorProfile,{defaultprofile:new JSDraw2.ColorProfile(),colors:{"Red-Green":new JSDraw2.ColorProfile({r:255,g:125,b:0},{r:125,g:255,b:0}),"Red-Green (Log)":new JSDraw2.ColorProfile({r:255,g:125,b:0},{r:125,g:255,b:0},true),"Green-Red":new JSDraw2.ColorProfile({r:125,g:255,b:0},{r:255,g:125,b:0}),"Green-Red (Log)":new JSDraw2.ColorProfile({r:125,g:255,b:0},{r:255,g:125,b:0},true)}});JSDraw2.CurveMap=scil.extend(scil._base,{constructor:function(d,c){this.tbody=scil.Utils.createTable(d,null,null,{border:"solid 1px #eee"});this.setData(c)},clear:function(){this.options=null;this.destroy();scil.Utils.removeAll(this.tbody)},destroy:function(){for(var c=0;c<this.tbody.childNodes.length;++c){var f=this.tbody.childNodes[c];for(var d=0;d<f.childNodes.length;++d){var g=f.childNodes[d];if(g.jsd!=null){g.jsd.destroy();g.jsd=null}}}},setData:function(q){this.clear();this.options=q;if(q==null||q.rows==null){return}var f=this.options.cellwidth;if(!(f>0)){f=80}var d=this.options.cellheight;if(!(d>0)){d=60}var c=this.options.cellborder;if(c==null){c="solid 1px #eee"}var g=null;var n=null;if(q.curve!=null){n=new JSDraw2.Mol();n.setXml(q.curve);if(n.isEmpty()||n.graphics.length!=1){n=null}g=JSDraw2.AssayCurve.cast(n.graphics[0]);if(g==null){n=null}}for(var j=0;j<q.rows.length;++j){var t=q.rows[j];if(j==0){var w=scil.Utils.createElement(this.tbody,"tr");scil.Utils.createElement(w,"td");for(var l=0;l<t.length;++l){scil.Utils.createElement(w,"td",l+1,{textAlign:"center",background:"#ccc",color:"#fff",border:c})}}var w=scil.Utils.createElement(this.tbody,"tr");for(var l=0;l<t.length;++l){if(l==0){scil.Utils.createElement(w,"td",scil.Utils.num2letter(j+1),{textAlign:"center",color:"#fff",background:"#ccc",border:c})}var u=scil.Utils.createElement(w,"td",null,{border:c});var h=scil.Utils.createElement(u,"div",null,{width:f,height:d});u.jsd=new JSDraw2.Editor(h,{viewonly:true,dataformat:"xml"});if(q.concentration>0&&typeof(t[l])=="number"){t[l]={c:q.concentration,r:t[l]}}if(t[l]==null||t[l].c==null||t[l].r==null||n==null){h.innerHTML="&nbsp;";continue}else{g.spots=[t[l]];u.jsd.setMol(n.clone())}}}}});JSDraw2.SequenceBuilder={dlg:null,ed:null,lastsequence:null,separator:".",_timeout:null,kFilterTimeout:1000,show:function(d,h,g){this.ed=d;this.create();var f=this.lastsequence==null?{expand:JSDraw2.defaultoptions==null?null:JSDraw2.defaultoptions.expandpeptides,nterminal:"H-",cterminal:"-OH"}:this.lastsequence;this.dlg.show2({title:"Add "+g,owner:d});var c={type:h,sequence:f.sequence,expand:f.expand,nterminal:f.nterminal,cterminal:f.cterminal};this.dlg.form.setData(c);scil.Utils.getParent(this.dlg.form.fields.nterminal,"TR").style.display=h==JSDraw2.BIO.AA?"":"none";scil.Utils.getParent(this.dlg.form.fields.cterminal,"TR").style.display=h==JSDraw2.BIO.AA?"":"none";scil.Utils.getParent(this.dlg.form.fields.aminoacids,"TR").style.display=h==JSDraw2.BIO.AA?"":"none";scil.Utils.getParent(this.dlg.form.fields.search,"TR").style.display=h==JSDraw2.BIO.AA?"":"none";this.dlg.moveCenter()},create:function(){if(this.dlg!=null){return}this.nterminals=["H"].concat(scil.Utils.getDictKeys(JSDraw2.SuperAtoms.nterminals));this.cterminals=["OH","NH2"].concat(scil.Utils.getDictKeys(JSDraw2.SuperAtoms.cterminals));var n=this;var g={aminoacids:{label:"Amino Acids",type:"div"},search:{label:"Search"},hint:{type:"note",str:"Please type the sequence below:"},nterminal:{label:"N-Terminal",type:"select",items:this.nterminals,sort:false},sequence:{label:"Sequence",width:600},cterminal:{label:"C-Terminal",type:"select",items:this.cterminals,sort:false},expand:{label:"Expand",type:"checkbox",str:"Expand All Nodes"},rxn:{label:"Reaction",type:"select",sort:false,items:{"":"",reactant:"Add as Reactant",product:"Add as Product"}},type:{type:"hidden"}};this.dlg=scil.Form.createDlgForm("Sequence Builder",g,{src:scil.App.imgSmall("submit.png"),label:"Add",onclick:function(){n.createBioSequence2()}},{lang:JSDraw2.Language,onenter:function(){n.createBioSequence2()}});var f=this.dlg.form.fields.aminoacids;var q=scil.Utils.createTable(f,0,1);this.mols=[];for(var h=0;h<2;++h){var u=scil.Utils.createElement(q,"tr");for(var l=0;l<11;++l){var t=scil.Utils.createElement(u,"td");var c=scil.Utils.createElement(t,"div",null,{border:"solid 1px #eee"});var f=scil.Utils.createElement(c,"div",null,{width:80,height:65});label=scil.Utils.createElement(c,"div","&nbsp;",{background:"#eee",textAlign:"center"});var j=new JSDraw2.Editor(f,{viewonly:true});this.mols.push({td:t,label:label,jsd:j})}}this.aas=this.sortDict(JSDraw2.SuperAtoms.AminoAcids);this.listAA(this.aas);dojo.connect(q.parentNode,"onclick",function(d){n.selectAA(d)});dojo.connect(this.dlg.form.fields.search,"onkeyup",function(d){n.filter()})},clearFilter:function(){if(this._timeout!=null){clearTimeout(this._timeout);this._timeout=null}},filter:function(){this.clearFilter();var c=this;this._timeout=setTimeout(function(){c.filter2()},this.kFilterTimeout)},filter2:function(){this.clearFilter();this.listAA(this.dlg.form.fields.search.value)},listAA:function(q){var h=this.aas;if(q!=null&&q.length>0){q=q.toLowerCase();h={};var l=0;for(var g in this.aas){if(g!=null&&g.toLowerCase().indexOf(q)>=0){h[g]=this.aas[g];if(++l>=this.mols.length){break}}}}for(var d=0;d<this.mols.length;++d){this.mols[d].td.removeAttribute("aa");this.mols[d].label.innerHTML="&nbsp;";this.mols[d].jsd.clear(true)}var f=0;for(var c in h){var j=h[c];this.mols[f].td.setAttribute("aa",c);this.mols[f].label.innerHTML=c;this.mols[f].jsd.setMolfile(j.getMolfile());if(f+1>=this.mols.length){break}++f}},sortDict:function(c){var g=[];for(var f in c){g[g.length]=f}g.sort();var h={};for(var d=0;d<g.length;d++){h[g[d]]=c[g[d]]}return h},selectAA:function(c){var g=c.target||c.srcElement;var h=scil.Utils.getParent(g,"TD");var d=h.getAttribute("aa");if(d==null||d==" "||d=="&nbsp;"){return}var f=this.dlg.form.fields.sequence;if(f.value!=""){f.value+=this.separator}f.value+=d},createBioSequence2:function(){var c=this.dlg.form.getData();if(scil.Utils.isNullOrEmpty(c.nterminal)&&scil.Utils.isNullOrEmpty(c.cterminal)){var f=c.sequence.replace(/[\.]/g,"-").split("-");if(scil.Utils.indexOf(this.nterminals,f[0])>=0){c.nterminal=f[0];f.splice(0,1)}if(scil.Utils.indexOf(this.cterminals,f[f.length-1])>=0){c.cterminal=f[f.length-1];f.splice(f.length-1,1)}if(!scil.Utils.isNullOrEmpty(c.nterminal)||!scil.Utils.isNullOrEmpty(c.cterminal)){c.sequence=scil.Utils.array2str(f,this.separator)}}this.lastsequence=c;this.ed.createAA2(c.sequence,c.type,c.expand,c.rxn,c.nterminal,c.cterminal);this.dlg.hide()}};JSDraw2.ChemdrawPopup={delaytime:100,dlg:null,chemdraw:null,editor:null,loading:'<CDXML CreationProgram="MolEngine"><font id="1" charset="iso-8859-1" name="Arial" /><page id="2"><fragment id="3" /><t id="4" p="0.00 0.90" BoundingBox="0.00 0.90 3.38 0.00"><s font="1">Loading ...</s></t></page></CDXML>',show:function(c){this.editor=c;if(this.dlg==null){this.create(800,400,this.loading,"text/xml");this.dlg.show(null,null,null,true,this.editor);this.convertFileAndSetChemDraw(this.editor.getXml())}else{this.dlg.show(null,null,null,true,c);this._setChemDrawData("text/xml",this.loading);if(this.editor!=null){var f=this.editor.getXml();var d=this;setTimeout(function(){d.convertFileAndSetChemDraw(f)},this.delaytime)}}this.dlg.moveCenter()},convertFileAndWaite:function(f,c){if(scil.Utils.isNullOrEmpty(f)){return f}var d=scil.Utils.ajaxwait(JSDrawServices.url+"?cmd=convertfile",{input:f,outputformat:c});return d==null?null:d.output},convertFileAndSetChemDraw:function(f){if(scil.Utils.isNullOrEmpty(f)){this.clear();return}var c=this;this._setChemDrawData("text/xml",this.loading);var d=scil.Utils.ajax(JSDrawServices.url+"?cmd=convertfile",function(g){c._setChemDrawData("text/xml",g==null?null:g.output)},{input:f,outputformat:"cdxml"})},save:function(){if(this.editor!=null){var c=this.convertFileAndWaite(this._getChemDrawData("text/xml"),"jsdraw");this.editor.setXml(c);this.clear()}this.dlg.hide()},create:function(x,j,c,q){if(this.dlg!=null){return}var n=this;var g={cd:{type:"div"}};this.dlg=scil.Form.createDlgForm("ChemDraw Editor",g,{src:scil.App.imgSmall("submit.png"),label:"Save",onclick:function(){n.save()}},{hidelabel:true});var t=this.dlg.form.fields.cd;try{if(this.chemdraw==null){if(c!=null){c=q+";base64,"+JSDraw2.Base64.encode(c)}if(scil.Utils.isIE){if(JSDraw2.ChemDraw.isCDActiveXInstalled()==false){this.chemdraw=false}else{var d=scil.Utils.createElement(t,"div");var u='<param NAME="ShowToolsWhenVisible" VALUE="1">';if(c!=null){u+="<param NAME='DataURL' VALUE=\"data:"+c+'"/>'}var l="<object classid='"+JSDraw2.ChemDraw.CD_CONTROL_CLSID+"' style='border:solid 1px #ddd; width:"+(x>0?x:700)+"px;height:"+(j>0?j:350)+"px;'>"+u+"</object>";d.innerHTML=l;this.chemdraw=d.firstChild;if(this.chemdraw.Objects==null){this.chemdraw=false}}if(this.chemdraw==false){scil.Utils.removeAll(d);scil.Utils.createElement(t,"div",scil.Utils.isIE>=11?"ChemDraw is not supported on IE 11+":"ChemDraw is not installed",{width:(x>0?x:700)+"px",height:(j>0?j:350)+"px",color:"red",padding:20,border:"solid 1px #ddd"})}}else{var d=scil.Utils.createElement(t,"div");var l="<embed type='chemical/x-cdx' showtoolswhenvisible=1 style='border:solid 1px #ddd; width:"+(x>0?x:700)+"px;height:"+(j>0?j:350)+"px;' dataurl='data:"+c+"'></embed>";d.innerHTML=l;this.chemdraw=d.firstChild}}}catch(f){this.chemdraw=false;scil.Utils.createElement(t,"div",f.message,{color:"red"})}},_getChemDrawData:function(g){try{if(scil.Utils.isIE){if(g=="chemical/cdx"||g=="chemical/x-cdx"){this.chemdraw.DataEncoded=true;var c=this.chemdraw.Objects.Data("chemical/cdx");this.chemdraw.DataEncoded=false;return c}return this.chemdraw.Objects.Count==0?null:this.chemdraw.Objects.Data(g)}else{var d=this._chemdrawMimetype2Dt(g);return d==-1?null:this.chemdraw.getData(d)}}catch(f){return null}},clear:function(){try{if(scil.Utils.isIE){this.chemdraw.Objects.clear()}else{this.chemdraw.clear()}}catch(c){}},_setChemDrawData:function(g,c){this.clear();if(scil.Utils.isNullOrEmpty(c)){return}try{if(scil.Utils.isIE){if(g=="chemical/cdx"||g=="chemical/x-cdx"){this.chemdraw.DataEncoded=true;this.chemdraw.Objects.Data("chemical/cdx")=c;this.chemdraw.DataEncoded=false}else{this.chemdraw.Objects.Data(g)=c}}else{var d=this._chemdrawMimetype2Dt(g);if(d!=-1){this.chemdraw.putData(d,c)}else{alert("Unknown file format: "+g)}}}catch(f){alert(scil.Utils.isNullOrEmpty(f.message)?"Failed to set ChemDraw data":f.message)}},_chemdrawMimetype2Dt:function(c){switch(c){case"chemical/x-cdx":case"chemical/cdx":return 0;case"chemical/x-mdl-molfile":case"chemical/x-mdl-rxn":case"chemical/mdl-molfile":case"chemical/mdl-rxn":return 1;case"chemical/x-daylight-smiles":case"chemical/daylight-smiles":return 2;case"chemical/x-questel-f1":case"chemical/questel-f1":return 3;case"chemical/x-questel-f1-query":case"chemical/questel-f1-query":return 4;case"text/xml":return 5;case"chemical/x-name":return 6;case"chemical/x-cml":case"chemical/cml":return 7;case"chemical/x-inchi":case"chemical/inchi":return 8;default:return -1}}};JSDraw2.Spectrum=scilligence.extend(scil._base,{constructor:function(d,c){this.T="SPECTRUM";this._rect=d;this.color=null;this.selected=false;this.data=c;this.attributes={}},isEmpty:function(){return this.data==null},html:function(f){var d="<i";if(this.id!=null){d+=" i='"+this.id+"'"}if(this.T!=null){d+=" x='"+this.T+"'"}if(this._rect!=null){d+=" p='"+this._rect.toString(f)+"'"}if(this.color!=null){d+=" clr='"+curve.color+"'"}d+=">";if(this.data!=null){d+=this.data.toXml()}if(this.attributes!=null){for(var c in this.attributes){d+="<att n='"+scil.Utils.escXmlValue(c)+"'>"+scil.Utils.escXmlValue(this.attributes[c])+"</att>"}}d+="</i>";return d},readHtml:function(f){var l=JSDraw2.Rect.fromString(f.getAttribute("p"));this._rect=l;var d=null;var q=scil.Utils.getElements(f,"xy");var t=q!=null&&q.length>0?null:scil.Utils.getElements(f,"yy");if(t!=null&&t.length>0){d=new JSDraw2.Spectrum.YY();d.fromXml(t[0])}else{if(q!=null&&q.length>0){d=new JSDraw2.Spectrum.XY();d.fromXml(q[0])}}this.data=d;var c=scil.Utils.getElements(f,"att");if(c!=null){for(var h=0;h<c.length;++h){var j=c[h].getAttribute("n");var n=c[h].text||c[h].textContent;if(j!=null){this.attributes[j]=n}}}return true},clone:function(){var c=new JSDraw2.Spectrum(this._rect.clone());this.copyTo(c);return c},copyTo:function(c){if(this.data!=null){c.data=this.data.clone()}},flipY:function(c){},flipX:function(c){},scale:function(d,c){this._rect.scale(d,c)},offset:function(c,d){this._rect.offset(c,d)},rect:function(){return this._rect.clone()},toggle:function(c,d){return this._rect.contains(c)||this._rect.cornerTest(c,d)!=null},drawCur:function(f,d,c){this._drawAnchor(f,d/2,c)},draw:function(q,g,h,d){var c=this.color;if(c==null||c==""){c="blue"}var n=this._rect.clone().inflate(-d,-d).offset(d/2,0);var t=this.attributes.TITLE;if(!scil.Utils.isNullOrEmpty(t)){JSDraw2.Drawer.drawText(q,new JSDraw2.Point(n.center().x,n.top-d*1.5),t,"black",d,"middle")}JSDraw2.Drawer.drawText(q,n.bottomleft().offset(-d/5,-d*0.4),0,"black",d/2,"right");JSDraw2.Drawer.drawText(q,n.topleft().offset(-d/5,-d*0.4),100,"black",d/2,"right");for(var f=1;f<10;++f){var j=new JSDraw2.Point(n.left,n.top+n.height*f/10);var l=new JSDraw2.Point(n.right(),j.y);JSDraw2.Drawer.drawLine(q,j,l,"#ddd",g/2);JSDraw2.Drawer.drawText(q,j.offset(-d/5,-d*0.4),(10-f)*10,"black",d/2,"right")}JSDraw2.Drawer.drawRect(q,n,"black",g/2);if(this.data!=null){this.data.draw(q,n,c,g,d)}},drawSelect:function(c){c.draw(this,this._rect.fourPoints())},_drawAnchor:function(f,d,c){r=this._rect;f.createCircle({cx:r.left,cy:r.top,r:d}).setFill(c);f.createCircle({cx:r.right(),cy:r.top,r:d}).setFill(c);f.createCircle({cx:r.right(),cy:r.bottom(),r:d}).setFill(c);f.createCircle({cx:r.left,cy:r.bottom(),r:d}).setFill(c)},cornerTest:function(c,d){return this._rect.cornerTest(c,d)},resize:function(c,f){this._rect.moveCorner(c,f)},setSpectrumData:function(c){var d=this;scil.Utils.prompt2({caption:"Set Spectrum Data",message:"Please paste spectrum data (JDX/XYD) below",multiline:true,height:400,callback:function(g,f){if(f!=null){f.value=""}d.setSpectrumData2(c,g)}})},setSpectrumDataFromFile:function(c){var d=this;scil.Utils.uploadFile("Set Spectrum Data","Please select a JDX/XYD file",JSDrawServices.url+"?cmd=openfile",function(h){var f=null;if(h.filename!=null){var g=h.filename.lastIndexOf(".");f=h.filename.substr(g+1).toLowerCase()}d.setSpectrumData2(c,JSDraw2.Base64.decode(h.base64),f)})},setSpectrumData2:function(c,g,d){var f=scil.Utils.isNullOrEmpty(d)||d=="jdx"?JSDraw2.Spectrum.parseJDX(g):null;if(f==null){f=scil.Utils.isNullOrEmpty(d)||d=="xyd"?JSDraw2.Spectrum.parseXYD(g):null}if(f==null||f.error!=null){if(c!=null){scil.Utils.alert("Cannot parse this spectrum"+(f==null?"":": "+f.error))}return}if(c!=null){c.pushundo()}this.data=f.data;this.attributes=f.attributes;if(c!=null){c.refresh(true)}},viewAttributes:function(c){var h=" style='background:#eee'";var g="<table cellspacing=0 cellpadding=1 style='border: solid 1px #ddd;background: fff;'>";g+="<tr"+h+"><th>Name</th><th>Value</th></tr>";var d=0;for(var f in this.attributes){g+="<tr"+(++d%2==1?"":h)+"><td>"+f+"</td><td>"+this.attributes[f]+"</td></tr>"}g+="</table>";scil.Utils.alert2(g,JSDraw2.Language.res("Spectrum Attributes"))}});scil.apply(JSDraw2.Spectrum,{cast:function(c){return c!=null&&c.T=="SPECTRUM"?c:null},parseXYD:function(f){if(f==null){return null}var d=f.split("\n");data=new JSDraw2.Spectrum.YY();var c=data.readData(d,0);return{data:data,attributes:{},error:c}},parseJDX:function(w){if(w==null){return null}var l=0;var c={};var h=null;var u=w.split("\n");for(l=0;l<u.length;++l){var t=u[l];if(!scil.Utils.startswith(t,"##")){continue}t=t.substr(2);var q=t.indexOf("=");if(q<=0){continue}var n=scil.Utils.trim(t.substr(0,q));var x=scil.Utils.trim(t.substr(q+1));if(n=="XYDATA"||n=="PEAK TABLE"){h=x;break}else{c[n]=x}}var d=null;if(h=="(XY..XY)"){d=new JSDraw2.Spectrum.XY()}else{if(h=="(X++(Y..Y))"){d=new JSDraw2.Spectrum.YY()}else{return null}}var f=parseFloat(c.DELTAX);var j=parseFloat(c[".OBSERVE FREQUENCY"]);var g=d.readData(u,l+1,f,j);return{data:d,attributes:c,error:g}},drawYGrid:function(u,q,t,z,y,g,d){if(z!=null&&y!=null&&!isNaN(z)&&!isNaN(y)&&z!=y){var c=Math.floor((y-z)/10);var n=Math.ceil(z);for(var f=0;f<20;++f){var l=n+c*f;var w;if(t){w=q.right()-(l-z)*q.width/(y-z);if(w<q.left){break}}else{w=q.left+(l-z)*q.width/(y-z);if(w>q.right()){break}}var h=new JSDraw2.Point(w,q.top);var j=new JSDraw2.Point(w,q.bottom());if(Math.abs(w-q.left)>=1||Math.abs(w-q.right())>=1){JSDraw2.Drawer.drawLine(u,h,j,"#ddd",g/2)}JSDraw2.Drawer.drawText(u,j,l,"black",d/2,"middle")}}else{for(var f=0;f<10;++f){var h=new JSDraw2.Point(q.left+q.width*f/10,q.top);var j=new JSDraw2.Point(h.x,q.bottom());JSDraw2.Drawer.drawLine(u,h,j,"#ddd",g/2)}}}});JSDraw2.Spectrum.YY=scil.extend(scil._base,{constructor:function(c,g,f,d){this.T="YY";this.xmin=g;this.xmax=f;this.xdelta=d;this.ymin=null;this.ymax=null;this.setData(c)},setData:function(c,h,g,f){this.xmin=isNaN(h)?null:h;this.xmax=isNaN(g)?null:g;this.xdelta=isNaN(f)?null:f;this.ymin=null;this.ymax=null;this.data=c;if(c!=null&&c.length<2){c=null}if(c==null){return}this.ymin=this.ymax=c[0];for(var d=1;d<c.length;++d){if(c[d]>this.ymax){this.ymax=c[d]}else{if(c[d]<this.ymin){this.ymin=c[d]}}}},clone:function(){var c=new JSDraw2.Spectrum.YY(null,this.xmin,this.xmax,this.xdelta);c.ymin=this.ymin;c.ymax=this.ymax;c.data=scil.clone(this.data);return c},toXml:function(){var c="<yy";if(this.xmin!=null){c+=" xmin='"+this.xmin+"'"}if(this.xmax!=null){c+=" xmax='"+this.xmax+"'"}if(this.xdelta!=null){c+=" xdelta='"+this.xdelta+"'"}if(this.ymin!=null){c+=" ymin='"+this.ymin+"'"}if(this.ymax!=null){c+=" ymax='"+this.ymax+"'"}if(this.data!=null){c+=" data='"+scil.Utils.array2str(this.data," ")+"'"}c+=" />";return c},fromXml:function(c){if(c==null){return}var d="0 "+c.getAttribute("data");this.readData([d],0);this.xmin=this.readValue(c,"xmin");this.xmax=this.readValue(c,"xmax");this.xdelta=this.readValue(c,"xdelta")},readValue:function(c,d){var f=c==null?null:parseFloat(c.getAttribute(d));return isNaN(f)?null:f},draw:function(t,j,c,g,d){if(this.data==null){return}var q=true;var n=true;JSDraw2.Spectrum.drawYGrid(t,j,n,this.xmin,this.xmax,g,d);var l=Math.round(this.data.length/j.width);if(l<1){l=1}var w=(q?-1:+1)*(j.width/this.data.length)*l;var u=n?j.right():j.left;var A=q?j.bottom():j.top;var B=(q?-1:+1)*j.height/(this.ymax-this.ymin);var h=[];for(var f=0;f<this.data.length;f+=l){var z=A+(this.getMax(this.data,f,l)-this.ymin)*B;h.push({x:u,y:z});u+=w}t.createPolyline(h).setStroke({color:c,width:g/2})},getMax:function(c,f,g){var h=c[f];var g=Math.min(f+g,c.length);for(var d=f;d<g;++d){if(c[d]>h){h=c[d]}}return h},readData:function(u,f,x,d){var c=null;var h=null;var l=null;if(x!=null&&isNaN(x)){x=null}if(d!=null&&isNaN(d)){d=null}var j=[];while(f<u.length){s=u[f];if(scil.Utils.startswith(s,"##")){break}s=scil.Utils.trim(s.replace(/[\-]/g," -")).replace(/[,]/g," ").replace(/[ ]+/g," ");var q=s.split(" ");if(q.length>=2){for(var g=1;g<q.length;++g){var B=parseFloat(q[g]);if(isNaN(B)){return"Error in line "+f}j.push(B)}if(c==null){c=q[0]}else{h=q[0];l=q.length-1;if(x==null){x=(parseFloat(h)-parseFloat(c))/l}}}++f}var A=parseFloat(c);var z=parseFloat(h)+(l-1)*x;if(d!=null){A/=d;z/=d}if(A>z){var w=A;A=z;z=w;j.reverse()}this.setData(j,A,z,x)}});JSDraw2.Spectrum.XY=scil.extend(scil._base,{constructor:function(c){this.T="XY";this.xmin=null;this.xmax=null;this.ymin=null;this.ymax=null;this.setData(c)},setData:function(f){if(f!=null&&f.length<2){f=null}this.data=f;if(f==null){return}this.xmin=this.xmax=f[0].x;this.ymin=this.ymax=f[0].y;for(var g=1;g<f.length;++g){var c=f[g];if(c.x>this.xmax){this.xmax=c.x}else{if(c.x<this.xmin){this.xmin=c.x}}if(c.y>this.ymax){this.ymax=c.y}else{if(c.y<this.ymin){this.ymin=c.y}}}},clone:function(){var d=new JSDraw2.Spectrum.XY(null);d.xmin=this.xmin;d.xmax=this.xmax;d.ymin=this.ymin;d.ymax=this.ymax;if(this.data!=null){d.data=[];for(var c=0;c<this.data.length;++c){d.data.push(scil.clone(this.data[c]))}}return d},toXml:function(){var d="<xy";if(this.xmin!=null){d+=" xmin='"+this.xmin+"'"}if(this.xmax!=null){d+=" xmax='"+this.xmax+"'"}if(this.ymin!=null){d+=" ymin='"+this.ymin+"'"}if(this.ymax!=null){d+=" ymax='"+this.ymax+"'"}if(this.data!=null){var f="";for(var c=0;c<this.data.length;++c){if(c>0){f+=" "}f+=this.data[c].x+","+this.data[c].y}d+=" data='"+f+"'"}d+=" />";return d},fromXml:function(c){if(c==null){return}var d=c.getAttribute("data");this.readData([d],0)},draw:function(w,q,c,j,g){if(this.data==null){return}var u=true;var t=true;JSDraw2.Spectrum.drawYGrid(w,q,t,this.xmin,this.xmax,j,g);var A=t?q.right():q.left;var B=(t?-1:+1)*q.width/(this.xmax-this.xmin);var D=u?q.bottom():q.top;var E=(u?-1:+1)*q.height/(this.ymax-this.ymin);for(var h=0;h<this.data.length;++h){var f=this.data[h];var z=A+(f.x-this.xmin)*B;var C=D+(f.y-this.ymin)*E;if(Math.abs(C-D)>=0.5){var l=new JSDraw2.Point(z,C);var n=new JSDraw2.Point(z,D);JSDraw2.Drawer.drawLine(w,l,n,c,j/2)}}},readData:function(h,c){var f=[];while(c<h.length){s=h[c];if(scil.Utils.startswith(s,"##")){break}s=scil.Utils.trim(s.replace(/[\-]/g," -")).replace(/[,]/g," ").replace(/[ ]+/g," ");var g=s.split(" ");if(g.length>=2){for(var d=0;d+1<g.length;d+=2){var j=parseFloat(g[d]);var l=parseFloat(g[d+1]);if(isNaN(j)||isNaN(l)){return"Error in line "+c}f.push({x:j,y:l})}}++c}this.setData(f)}});JSDraw2.ColorCoding={show:function(h,x,q){if(h==null||q==null||q.colorcoding==null){return}var u=JSDraw2.Table.parseValueUnit(x);var w=u==null?null:u.value;var d=q.colorcoding;var f=null;if(w!=null&&!isNaN(w)){if(d.onColorCode!=null){f=q.onColorCode(w)}else{if(w<d.min.value){w=d.min.value}if(w>d.max.value){w=d.max.value}var n=this.str2color(d.min.color);var l=this.str2color(d.max.color);var t=n.r+(l.r-n.r)*(w-d.min.value)/(d.max.value-d.min.value);var j=n.g+(l.g-n.g)*(w-d.min.value)/(d.max.value-d.min.value);var c=n.b+(l.b-n.b)*(w-d.min.value)/(d.max.value-d.min.value);f=this.color2str(t,j,c)}}h.style.backgroundColor=f==null?"":f},str2color:function(c){if(typeof c==="number"){return(c|0)}if(typeof c==="string"&&c[0]==="#"){c=c.slice(1)}var d=parseInt(c,16);return{r:(d&16711680)>>16,g:(d&65280)>>8,b:d&255}},color2str:function(f,d,c){f=Math.round(f).toString(16);d=Math.round(d).toString(16);c=Math.round(c).toString(16);return"#"+(f.length==1?"0"+f:f)+(d.length==1?"0"+d:d)+(c.length==1?"0"+c:c)}};JSDraw2.Matrix=scil.extend(scil._base,{constructor:function(c,f){this.data=[];if(c!=null){if(f==null){f=JSDraw2.Matrix.detectSeparator(c)}var d=c.split("\n");JSDraw2.Matrix.parseLines(this,d,0,-1,f)}},invert:function(){var f=[];var n=this.data.length;var c=this.data[0].length;for(var g=0;g<n;++g){var j=this.data[g];if(j==null){continue}var l=f[n-g-1]=[];for(var h=0;h<c;++h){l[c-h-1]=j[h]}}this.data=f;return this},flipH:function(){var f=[];var l=this.data.length;var c=this.data[0].length;for(var g=0;g<l;++g){var j=this.data[g];if(j==null){continue}f[g]=r=[];for(var h=0;h<c;++h){r[c-h-1]=j[h]}}this.data=f;return this},flipV:function(){var c=[];var h=this.data.length;for(var f=0;f<h;++f){var g=this.data[f];c[h-f-1]=scil.clone(g)}this.data=c;return this},rotate:function(){var c=[];for(var f=0;f<this.data.length;++f){var h=this.data[f];if(h==null){continue}for(var g=0;g<h.length;++g){if(c[g]==null){c[g]=[]}c[g][f]=h[g]}}this.data=c;return this},toCSV:function(h){if(h==null){h="\t"}var g="";for(var c=0;c<this.data.length;++c){if(c>0){g+="\n"}var f=this.data[c];if(f==null){continue}for(var d=0;d<f.length;++d){if(d>0){g+=h}g+=f[d]}}return g},process:function(c){for(var d=0;d<this.data.length;++d){var g=this.data[d];if(g==null){continue}for(var f=0;f<g.length;++f){g[f]=c(g[f])}}},convertToNumbers:function(){this.process(function(c){return c==null||isNaN(c)?null:parseFloat(c)})},html:function(C,A,l,h){var d="solid 1px #ccc";var g="padding:0 3px 0 3px;white-space:nowrap;border-bottom:"+d+";border-right:"+d+";";var n=" style='text-align:center;background:#ddd';border-bottom:"+d+";border-right:"+d+"'";var B=A==null?null:A.tablestyle;if(B==null){B=""}var q="<table cellspacing=0 style='border-left:"+d+";border-top:"+d+";"+(l>0?"table-layout:fixed;overflow:hidden;":"")+B+"'>";if(l>0){var y=this.data[0];for(var u=0;u<y.length;++u){q+="<col width='"+l+"px' />"}}if(C){q+="<tr><th"+n+">&nbsp;</th>";var y=this.data[0];for(var u=0;u<y.length;++u){q+="<td"+n+">"+scil.Utils.num2letter(u+1)+"</td>"}q+="</tr>"}for(var t=0;t<this.data.length;++t){var w=this.data[t];if(w==null){w=[]}if(w.length==0){w.push(null)}q+="<tr"+(t%2==0?" style='background:#eee;'":"")+">";if(C){q+="<td"+n+">"+(t+1)+"</td>"}for(var u=0;u<w.length;++u){var z=A==null?null:A.getValue(t,u);var x=scil.Utils.escXmlValue(w[u]);if(scil.Utils.isNullOrEmpty(x)){x="&nbsp;"}if(z!=null){x="<div style='"+z+"'>"+x+"</div>"}var j=g;if(h!=null){var f=h.getColor(x);if(f!=null){j+="background-color:"+f+";"}}q+="<td style='"+j+"'>"+x+"</td>"}q+="</tr>"}q+="</table>";return q},getAverage:function(c){var f=0;var g=0;for(var d=0;d<c.length;++d){var h=this.getNumber(c[d]);if(h!=null&&!isNaN(h)){++f;g+=h}}return f==0?null:g/f},subset:function(h,l,c){var g=this.position2xy(h);if(g==null){return null}var j=new JSDraw2.Matrix();for(var d=0;d<l;++d){for(var f=0;f<c;++f){j.setValue(d,f,this.getValue(g.row+d,g.col+f))}}return j},setValues:function(c,f){if(c==null){return}for(var d=0;d<c.length;++d){this.setValue(c[d],null,f)}},setValue:function(f,c,g){if(c==null&&typeof(f)=="string"){var d=this.position2xy(f);if(d==null){return null}f=d.row;c=d.col}if(this.data[f]==null){this.data[f]=[]}this.data[f][c]=g},getNumber:function(d,c){var f=this.getValue(d,c);if(typeof(f)!="number"){f=parseFloat(f);if(isNaN(f)){f=null}}return f},getValue:function(g,c){if(c==null&&typeof(g)=="string"){var f=this.position2xy(g);if(f==null){return null}g=f.row;c=f.col}var d=this.data[g];return d==null?null:d[c]},position2xy:function(f){if(f==null){return null}var d=f.replace(/^[A-Z|a-z]+/,"");if(d==f||!new RegExp("^[0-9]+$").test(d)){return null}var c=f.substr(0,f.length-d.length);return{col:scil.Utils.letter2num(c)-1,row:parseInt(d)-1}}});scil.apply(JSDraw2.Matrix,{parseLines:function(g,f,q,d,l,h){for(var c=0;c<f.length;++c){if(d>0&&c>=d){break}var j=scil.Utils.rtrim(f[c+q]);if(h!=null){j=h(j)}var n=j.split(l);g.data.push(n)}},detectSeparator:function(c){if(c.indexOf("\t")>=0){return"\t"}else{return","}},maskDataPoints:function(h,c,l){if(this.maskDlg==null){var g=scil.Utils.createElement(null,"div");scil.Utils.createElement(g,"div",scil.Lang.res("Click the number to exclude it"),{textAlign:"center",color:"orange"});this.maskDlg=new scilligence.Dialog("Exclude Data Points",g);this.maskDlg.data=scil.Utils.createElement(g,"div",null,{paddingLeft:"50px"});var f=scil.Utils.createElement(g,"div",null,{paddingTop:"20px",textAlign:"center"});var j=this;scil.connect(this.maskDlg.data,"onclick",function(d){j.maskOnePoint(d)});scil.Utils.createButton(f,{label:"Save",onclick:function(){j.maskDataPoints2()}});if(l!=null){scil.Utils.createButton(f," ");scil.Utils.createButton(f,{label:"Previous",onclick:function(){j.maskDlg.nextfun(-1)}});scil.Utils.createButton(f,{label:"Next",onclick:function(){j.maskDlg.nextfun(+1)}});scil.Utils.createButton(f," ");scil.Utils.createButton(f,{label:"Finish",onclick:function(){j.maskDlg.hide()}})}}this.maskDlg.show();this.maskDlg.data.innerHTML=h.html();this.maskDlg.moveCenter();this.maskDlg.m=h;this.maskDlg.callback=c;this.maskDlg.nextfun=l;return this.maskDlg},maskDataPoints2:function(){var c=[];var j=this.maskDlg.data.getElementsByTagName("TR");for(var d=0;d<j.length;++d){var h=j[d];var g=[];for(var f=0;f<h.childNodes.length;++f){g[f]=h.childNodes[f].innerHTML}c.push(g)}this.maskDlg.m.data=c;if(this.maskDlg.callback!=null){if(this.maskDlg.callback(this.maskDlg.m)==false){return}}this.maskDlg.hide()},maskOnePoint:function(c){var f=c.srcElement||c.target;if(f.tagName=="TD"){var d=f.innerHTML;if(d!=""){if(d.substr(0,1)=="("){f.innerHTML=d.substr(1,d.length-2);f.style.backgroundColor=""}else{f.innerHTML="("+d+")";f.style.backgroundColor="yellow"}}}}});JSDraw2.ReactionBlock=scil.extend(scil._base,{constructor:function(c){this.options=c==null?{}:c},renderXml:function(c){if(this.options.shape=="circle"){return this.renderCircle(c)}else{if(this.options.shape=="rectangle"){return this.renderReactangle(c)}else{return null}}},renderReactangle:function(C){var d=this.options.color==null?"#808000":this.options.color;var A=this.options.textcolor==null?"#0000ff":this.options.textcolor;var g=0;var u=this.options.radius>0?this.options.radius:1;var h=this.options.gap>0?this.options.gap:1;if(typeof(u)=="string"){u=parseFloat(u)}if(typeof(h)=="string"){h=parseFloat(h)}var z=this.parseSlots(this.options.slots);var x=z.rows;var f=z.cols;var D=h*(f+1)+f*2*u;var j=h*(x+1)+x*2*u;var q=new JSDraw2.Rect(0,0,D,j);var E="<i i='"+(++g)+"' x='SHAPE' type='rectangle' fill='solid' p='"+q.toString()+"' clr='"+d+"'></i>";for(var w=1;w<=x;++w){var n=scil.Utils.num2letter(w);for(var c=1;c<=f;++c){var l=new JSDraw2.Point((h+u)*c+u*(c-1),(h+u)*w+u*(w-1));var t=new JSDraw2.Rect(l.x-u,l.y-u,2*u,2*u);var y=n+c;var B=C==null?null:C[y];if(B==null){B=y}var y="<i i='"+(++g)+"' x='SHAPE' type='ellipse' fill='solid' p='"+t.toString()+"' clr='#ffffff' textcolor='"+A+"' fontsize='"+(this.options.fontsize>0?this.options.fontsize:1)+"'>"+B+"</i>";E+=y}}return"<div version='5.0' class='JSDraw' app='JSDraw V5.1.1' bondlength='1.56'>"+E+"</div>"},renderCircle:function(F){var f=this.options.color==null?"#808000":this.options.color;var D=this.options.textcolor==null?"#0000ff":this.options.textcolor;var t=this.parseSlots(this.options.slots);var g=0;var A=this.options.radius>0?this.options.radius:1;var h=this.options.gap>0?this.options.gap:1;if(typeof(A)=="string"){A=parseFloat(A)}if(typeof(h)=="string"){h=parseFloat(h)}var C=(t.length+1)*h+t.length*2*A;if(t[t.length-1]==1){C-=h+A}var y=new JSDraw2.Rect(0,0,C*2,C*2);var d=y.center();var G="<i i='"+(++g)+"' x='SHAPE' type='ellipse' fill='solid' p='"+y.toString()+"' clr='"+f+"'></i>";for(var l=0;l<t.length;++l){var u=t[l];var q=l+1;var x=scil.Utils.num2letter(q);for(var j=0;j<u;++j){var w;if(u==1&&l==t.length-1){w=d.clone()}else{w=new JSDraw2.Point(C*2-(h+A)*q-A*l,d.y);w=w.rotateAround(d,-360/u*j)}var z=new JSDraw2.Rect(w.x-A,w.y-A,2*A,2*A);var B=x+(j+1);var E=F==null?null:F[B];if(E==null){E=B}var B="<i i='"+(++g)+"' x='SHAPE' type='ellipse' fill='solid' p='"+z.toString()+"' clr='#ffffff' textcolor='"+D+"' fontsize='"+(this.options.fontsize>0?this.options.fontsize:1)+"'>"+E+"</i>";G+=B}}return"<div version='5.0' class='JSDraw' app='JSDraw V5.1.1' bondlength='1.56'>"+G+"</div>"},parseSlots:function(h){if(this.options.shape=="circle"){if(scil.Utils.isNullOrEmpty(h)){h="10, 8"}var j=h.split(",");var f=[];for(var d=0;d<j.length;++d){var l=parseInt(j[d]);f.push(l>0?l:0)}return f}else{if(this.options.shape=="rectangle"){if(scil.Utils.isNullOrEmpty(h)){h="5*5"}var j=h.split("*");var g=parseInt(j[0]);var c=parseInt(j[1]);return{rows:g>0?g:5,cols:c>0?c:5}}}}});scil.apply(JSDraw2.ReactionBlock,{show:function(d,f,c){this.options=d;this.ongetvalues=c;this.create(f);this.dlg.show();this.dlg.form.setData(this.options);this.onSelectProperty()},create:function(f){if(this.dlg!=null){return}var d=this;var c={shape:{label:"Block Shape",type:"select",items:["circle","rectangle"]},color:{label:"Block Color",type:"color"},slots:{label:"Slot Count",str:"Circle: 25, 18, 9; Rectangle: 8*4"},radius:{label:"Slot Size",type:"number"},gap:{label:"Slot Gap",type:"number"},property:{label:"View Property",type:"select",items:f},sketch:{label:"Layout",type:"jsdraw",width:800,height:500,viewonly:true}};this.dlg=scil.Form.createDlgForm("Reaction Block",c,null,{onchange:function(g){d.onSelectProperty(g)}})},onSelectProperty:function(c){if(c==this.dlg.form.fields.sketch){return}this.options=this.dlg.form.getData();var d=new JSDraw2.ReactionBlock(this.options);var f=null;if(this.ongetvalues!=null){f=this.ongetvalues(this.dlg.form.fields.property.value)}this.dlg.form.fields.sketch.jsd.setXml(d.renderXml(f))}});JSDraw2.QCCurve={dlg:null,jsd:null,curve:null,show:function(d,c){this.jsd=d;this.curve=c;this.create();this.dlg.show();this.loadNext()},loadNext:function(){var c=new JSDraw2.Mol();c.graphics.push(this.curve.clone());this.dlg.form.setData({curve:c.getXml()});this.dlg.show();this.updateSummary()},updateSummary:function(){var g=null;var d=null;var f=null;var h=null;var j=null;var c=this.dlg.form.fields.curve.jsd.m.graphics[0];if(c!=null){g=c.ic50Label()+"="+c.ic50+"; Y0="+c.y0+"; Y-inf="+c.yinf+"; hillslope="+c.hillslope+"; R<sup>2</sup>="+c.r2;if(c.fixy0){d=c.y0}if(c.fixyinf){f=c.yinf}h=c.y1;j=c.y2}this.dlg.form.setFieldValue("summary",g);this.dlg.form.setFieldValue("fixy0",d);this.dlg.form.setFieldValue("fixyinf",f);this.dlg.form.setFieldValue("y1",h);this.dlg.form.setFieldValue("y2",j)},fit:function(){var f=this.dlg.form.getData();this.dlg.form.setFieldValue("was","<div style='color:gray'>"+f.summary+"</div>");this.dlg.form.setFieldValue("summary",null);var g=this.dlg.form.fields.curve.jsd;var c=g.m.graphics[0].clone();if(!isNaN(f.fixy0)){c.y0=f.fixy0;c.fixy0=true}else{c.y0=null;c.fixy0=false}if(!isNaN(f.fixyinf)){c.yinf=f.fixyinf;c.fixyinf=true}else{c.yinf=null;c.fixyinf=false}var l=JSDraw2.AssayCurve.getXml(c);var h=this;var j=JSDrawServices.url;scil.Utils.ajax(j+"?cmd=curve.fit",function(d){g.setXml(d.data);g.refresh();h.updateSummary()},{data:l},{showprogress:true})},display:function(){var g=this.dlg.form.fields.curve.jsd;var c=g.m.graphics[0];var f=this.dlg.form.getData();if(!isNaN(f.y1)||!isNaN(f.y2)){if(isNaN(f.y1)){f.y1=c.y0;this.dlg.form.setFieldValue("y1",f.y1)}if(isNaN(f.y2)){f.y2=c.yinf;this.dlg.form.setFieldValue("y2",f.y2)}c.y1=parseFloat(f.y1);c.y2=parseFloat(f.y2)}else{c.y1=null;c.y2=null}g.refresh(true)},save:function(){var c=this.dlg.form.fields.curve.jsd.m.graphics[0];c.copyTo(this.curve);this.jsd.refresh(true);if(this.jsd.options.onfitresult!=null){this.jsd.options.onfitresult(c,this.jsd)}this.dlg.hide()},create:function(){if(this.dlg!=null){return}var d=this;var c={curve:{label:"Curve",type:"jsdraw",style:{border:"solid 1px #ddd"},width:800,height:400,viewonly:true,colspan:3,onclick:function(g,j,h,f){JSDraw2.AssayCurve.maskPoint(d.dlg.form.fields.curve,f)},leading:"<div style='color:orange;text-align:center;'>Click points to exclue them</div>"},was:{label:"Was",type:"html",colspan:3},summary:{label:"Summary",type:"html",colspan:3},fixy0:{label:"Fix Y0",type:"number",width:80},y1:{label:"Display Y1",type:"number",width:80},t1:{viewonly:true},fixyinf:{label:"Fix Y-inf",type:"number",width:80,button:{label:"Re-Fit",onclick:function(){d.fit()}}},y2:{label:"Display Y2",type:"number",width:80,button:{label:"Display",onclick:function(){d.display()}}},t2:{viewonly:true}};this.dlg=scil.Form.createDlgForm("QC Curve",c,[{icon:"img/save.gif",label:"Save",onclick:function(){d.save()}}],{centerbuttons:true,colspan:3})}};scil.Menu={timeout:scilligence.Utils.isTouch||window.navigator.msPointerEnabled?2000:500,closetimer:0,menuitem:null,isOpen:function(){return scil.Menu.menuitem!=null&&scil.Menu.menuitem.style.display!="none"},open:function(f,d){scil.Menu.cancelclosetime();if(scil.Menu.menuitem){scil.Menu.menuitem.style.display="none"}scil.Menu.menuitem=document.getElementById(f);scil.Menu.menuitem.style.display="";if(d!=null){var c=scil.Utils.getOffset(d,true,true);scil.Menu.menuitem.style.margin="";scil.Menu.menuitem.style.top=(c.y-(c.absolute!=null?c.absolute.y:0)+d.offsetHeight)+"px";scil.Menu.menuitem.style.left=(c.x-(c.absolute!=null?c.absolute.x:0)+d.offsetWidth/2-scil.Menu.menuitem.offsetWidth/2)+"px"}},close:function(){if(scil.Menu.menuitem){scil.Menu.menuitem.style.display="none"}},openOrClose:function(c){if(scil.Menu.menuitem==null||scil.Menu.menuitem.style.display=="none"){this.open(c)}else{this.close()}},closetime:function(){scil.Menu.closetimer=window.setTimeout(scil.Menu.close,scil.Menu.timeout)},cancelclosetime:function(){if(scil.Menu.closetimer){window.clearTimeout(scil.Menu.closetimer);scil.Menu.closetimer=null}}};JSDraw2.Menu=scil.Menu;scil.Dialog=scil.extend(scil._base,{constructor:function(f,c,d){this.options=d==null?{}:d;this.lang=this.options.lang==null?scil.Lang:this.options.lang;this.id=this.options.id;if(this.id==null||this.id==""){if(scil.Dialog._idincrease==null){scil.Dialog._idincrease=0}this.id="__jsdialog"+(++scil.Dialog._idincrease)}if(scil.Dialog._allitems==null){scil.Dialog._allitems={}}scil.Dialog._allitems[this.id]=this;this.parentWindow=this.options.parentWindow==null?window:this.options.parentWindow;this.body=c;this.title=f;this.WRAPPER="content";this.dialog=null;this.dialogmask=null;this.movingSt=null;this.__isdialog=true},isVisible:function(){return this.dialog!=null&&this.dialog.style.display!="none"},isFrom:function(c){if(!this.isVisible()){return false}return scil.Utils.isChildOf(c,this.dialog)},show2:function(c){if(c==null){c={}}this.show(c.title,c.zindex,c.modal,c.immediately,c.owner)},show:function(h,l,f,c,g){this.owner=g;if(this.isVisible()){if(h!=null&&this.dialog.titleElement!=null){this.dialog.titleElement.innerHTML=this.lang.res(h)}return}if(f==null){f=this.options.modal==null?true:this.options.modal}if(this.dialog==null){this._create()}this.movingSt=null;if(h!=null&&this.dialog.titleElement!=null){this.setTitle(h)}var d=scil.Utils.getMaxZindex();if(JSDraw2.defaultoptions.minDlgZindex>0&&d<JSDraw2.defaultoptions.minDlgZindex){d=JSDraw2.defaultoptions.minDlgZindex}var j=l==null?d+10:l;this.dialog.style.display="";this.dialogmask.style.display="";this.dialogmask.style.minHeight="100%";this.dialogmask.style.height="100%";this.dialogmask.style.width="100%";if(j>0){this.dialogmask.style.zIndex=j+1;this.dialog.style.zIndex=j+2}if(!f){this.dialog.style.zIndex=j+1;this.dialogmask.style.display="none"}this.dialog.style.borderColor=f?"#fff":JSDraw2.Skin.dialog.bkcolor;this.dialog.style.display="";this.moveCenter();scil.Dialog.stack.push(this);if(this._scilform&&this.form!=null&&this.form.fields!=null){this.form.focus()}if(!c&&scil.Dialog.animation){scil.Animation.zoomin(this.dialog,1000)}},setTitle:function(c){this.dialog.titleElement.innerHTML=this.lang.res(c)},moveCenter:function(u,w){this.dialog.style.width="";this.updateWidth();var c=dojo.window.getBox();var t=c.w;var h=c.h;var j=c.l;var n=c.t;var g=this.dialog.offsetWidth;var f=this.dialog.offsetHeight;var q=Math.round(n+(h-f)/2);var l=Math.round(j+(t-g)/2);if(w==null){w=Math.max(n,q)}if(u==null){u=Math.max(j,l)}dojo.style(this.dialog,{top:w+"px",left:u+"px"});this.scroll();this.applySize()},_create:function(){if(this.dialog!=null){return}var f=this;var n=this.parentWindow.document.body;var t=200;var j=scilligence.Utils.createTable(n,0,0,{position:"absolute",borderRadius:JSDraw2.Skin.kBorderRadius,zIndex:t,backgroundColor:JSDraw2.Skin.dialog.bkcolor,boxShadow:JSDraw2.Skin.dialog.boxshadow});this.dialog=j.parentNode;this.dialog.setAttribute("__scilligence_dlg",this.id);var q,l;var c="0";if(this.options.notitle){c="5px"}else{q=scilligence.Utils.createElement(j,"tr",null,{height:"40px"});l=scilligence.Utils.createElement(q,"td",this.lang.res(this.title),{paddingLeft:"10px",fontWeight:"bold",color:scil.App==null||scil.App.config==null?"":scil.App.config.text});this.dialog.titleElement=l;l=scilligence.Utils.createElement(q,"td",null,{textAlign:"right",verticalAlign:"top"});if(!this.options.noclose){var d=scilligence.Utils.createElement(l,"img",null,{cursor:"pointer",marginRight:"15px",borderRadius:"0 0 5px 5px"},{title:JSDraw2.Language.res("Close"),src:scil.Utils.imgSrc("img/dlgclose.jpg")});dojo.connect(scilligence.Utils.isIpad?l:d,"onclick",function(u){f.hide();u.preventDefault()})}if(this.options.movable!=false){if(scilligence.Utils.isTouch){dojo.connect(q,"ontouchstart",function(u){if(u.touches.length==1){f.startMove(u.touches[0])}});dojo.connect(n,"ontouchmove",function(u){if(u.touches.length==1&&f.move(u.touches[0])){u.preventDefault();return false}});dojo.connect(n,"ontouchend",function(){f.endMove()})}else{q.style.cursor="move";dojo.connect(q,"onmousedown",function(u){f.startMove(u)});dojo.connect(n,"onmousemove",function(u){f.move(u)});dojo.connect(n,"onmouseup",function(){f.endMove()})}}}q=scil.Utils.createElement(j,"tr");l=scil.Utils.createElement(q,"td",null,{padding:c+" 5px 5px 5px"});l.colSpan=2;var h={background:"#fff",padding:"5px"};if(this.options.bodystyle!=null){scil.apply(h,this.options.bodystyle)}this.divbody=scil.Utils.createElement(l,"div",null,h);if(typeof this.body=="string"){this.divbody.innerHTML="<div>"+this.body+"</div>"}else{this.divbody.appendChild(this.body)}this.applySize();var g=this.options.opacity>0?this.options.opacity:35;this.dialogmask=scilligence.Utils.createElement(n,"div",null,{position:"absolute",top:"0",left:"0",minHeight:"100%",height:"100%",width:"100%",background:"#999",opacity:g/100,filter:"alpha(opacity="+g+")",zIndex:t-1});dojo.connect(window,"onresize",function(){f.resize()});dojo.connect(window,"onscroll",function(){f.scroll()});if(this.options.fixtransparentissue&&dojox.gfx.renderer=="silverlight"){this.dialogmask.style.backgroundColor="white";this.dialogmask.style.opacity="1.0";this.dialogmask.style.filter="alpha(opacity=100)"}},applySize:function(){var c=dojo.window.getBox();c.w-=30;c.h-=50;if(this.options.notitle){c.h-=20}var g=this.options.width;var f=this.options.height;if(g>0&&g>c.w){g=c.w}if(f>0&&f>c.h){f=c.h}if(g>0){this.divbody.style.width=g+"px"}if(f>0){this.divbody.style.height=f+"px"}this.divbody.style.maxWidth=c.w+"px";this.divbody.style.maxHeight=c.h+"px";this.divbody.style.overflow="auto"},scroll:function(){if(!this.isVisible()||this.dialogmask==null||this.dialogmask.style.display=="none"){return}var f=dojo.window.getBox();var g=Math.max(f.w+f.l,this.dialog.offsetLeft+this.dialog.offsetWidth);var c=Math.max(f.h+f.t,this.dialog.offsetTop+this.dialog.offsetHeight);if(this.dialogmask.offsetWidth<=g){this.dialogmask.style.width=g+"px"}if(this.dialogmask.offsetHeight<=c){this.dialogmask.style.height=c+"px"}},resize:function(){this.scroll()},moveTo:function(c,d){scil.Utils.moveToScreen(c,d,this.dialog)},startMove:function(c){this.movingSt=null;var d=c.srcElement||c.target;if(d.tagName=="IMG"){return}this.movingSt=new JSDraw2.Point(c.clientX,c.clientY)},move:function(d){if(this.movingSt==null||(d.which||d.button)!=1){return false}var c=new JSDraw2.Point(d.clientX-this.movingSt.x,d.clientY-this.movingSt.y);var g=scilligence.Utils.parsePixel(this.dialog.style.top)+c.y;var f=scilligence.Utils.parsePixel(this.dialog.style.left)+c.x;this.moveTo(f,g);this.movingSt=new JSDraw2.Point(d.clientX,d.clientY);return true},endMove:function(){this.movingSt=null},updateWidth:function(c){this.dialog.style.width=(this.dialog.firstChild.firstChild.offsetWidth+2)+"px"},hide:function(c){if(this.options.onhide!=null){this.options.onhide()}if(!c&&scil.Dialog.animation){var d=this;scil.Animation.zoomout(this.dialog,1000,function(){d.close()})}else{this.close()}scil.Dialog.stack.pop();scil.AutoComplete.hideAll()},close:function(){if(this.dialog==null){return}this.dialog.style.display="none";this.dialogmask.style.display="none";this.dialogmask.style.width="0px";this.dialogmask.style.height="0px"}});scil.apply(scil.Dialog,{animation:false,stack:[],keydown:function(c){if(c.keyCode==27&&this.stack.length>0){this.stack[this.stack.length-1].hide()}},get:function(c){if(scil.Dialog._allitems==null){scil.Dialog._allitems={}}return scil.Dialog._allitems[c]},getDialog:function(c){while(c!=null){var f=scil.Utils.getParent(c,"TABLE");if(f==null){return null}var d=f.getAttribute("__scilligence_dlg");if(d!=null){return this.get(d)}c=f.parentNode}return null}});scil.onload(function(){dojo.connect(document.body,"onkeydown",function(c){scil.Dialog.keydown(c)})});JsDialog=JSDraw2.Dialog=scil.Dialog;scil.ColorPicker=scil.extend(scilligence._base,{constructor:function(c,f){if(typeof c=="string"){c=document.getElementById(c)}this.input=c;this.input.style.border="solid 1px gray";c.readOnly=true;if(!f){var d=this;dojo.connect(c,"onclick",function(){scil.ColorPicker.show(function(g){d.setValue(g)})})}},setValue:function(d){if(typeof(d)!="string"){d=""}this.input.style.backgroundColor=d;this.input.value=d}});scil.apply(scil.ColorPicker,{dlg:null,callback:null,width:700,show:function(c){this.callback=c;this.create();this.dlg.show()},select:function(c){var d=c.target||c.srcElement;if(d.tagName!="TD"){return}if(this.callback!=null){this.callback(d.title)}this.dlg.hide()},create:function(u){if(this.dlg!=null){return}if(!(u>0)){u=5}var j=scil.Utils.createElement(null,"div",null,{width:"700px"});var h=Math.round(256/u);var B=Math.round(this.width/u/u)+"px";var l="2px";var x=scil.Utils.createTable(j);var y=null;for(var w=0;w<256;w+=h){var z=scil.Utils.createElement(x,"tr");for(var q=0;q<256;q+=h){for(var d=0;d<256;d+=h){var f="#"+scil.Utils.padLeft(w.toString(16),2,"0")+scil.Utils.padLeft(q.toString(16),2,"0")+scil.Utils.padLeft(d.toString(16),2,"0");y=scil.Utils.createElement(z,"td","&nbsp;",{background:f,width:B,height:B,fontSize:l,cursor:"pointer"},{title:f})}}var f="#"+scil.Utils.padLeft(w.toString(16),2,"0")+scil.Utils.padLeft(w.toString(16),2,"0")+scil.Utils.padLeft(w.toString(16),2,"0");y=scil.Utils.createElement(z,"td","&nbsp;",{background:f,width:B,height:B,fontSize:l,cursor:"pointer"},{title:f})}scil.Utils.unselectable(x.parentNode);var A="#ffffff";y.style.color=A;y.style.background=A;y.title=A;x.parentNode.setAttribute("align","center");var t=this;scil.Utils.connect(x,"onclick",function(c){t.select(c)});this.dlg=new scil.Dialog(scil.Utils.res("Choose Color"),j)}});JSDraw2.ColorPicker=scil.ColorPicker;scil.ColorPicker2=scil.extend(scilligence._base,{constructor:function(c,f){if(typeof c=="string"){c=document.getElementById(c)}this.options=f==null?{}:f;this.input=c;this.disablepopup=false;this.input.style.border="solid 1px gray";this.input.readOnly=true;if(!this.options.viewonly){var d=this;dojo.connect(c,"onclick",function(){scilligence.ColorPicker2.show(d)})}},setValue:function(d){if(typeof(d)!="string"){d=""}this.input.style.backgroundColor=d;this.input.value=d},getValue:function(){return this.input.value},show:function(){scilligence.ColorPicker2.show(this)},hide:function(){scilligence.ColorPicker2.hide()}});scilligence.apply(scilligence.ColorPicker2,{cellwidth:8,rows:5,dropdown:null,area:null,title:null,dp:null,show:function(c){if(c.disablepopup){return}this.create();this.dp=c;var f=scil.Utils.getZindex(c.input);this.dropdown.style.zIndex=f==null?10:f+1;scil.ColorPicker2.dropdown.style.display="";var d=JsUtils.getOffset(c.input,false);scil.ColorPicker2.dropdown.style.left=d.x+"px";scil.ColorPicker2.dropdown.style.top=(d.y+c.input.offsetHeight)+"px"},hide:function(){if(scilligence.ColorPicker2.dropdown!=null){scilligence.ColorPicker2.dropdown.style.display="none";if(this.dp!=null&&this.dp){this.dp.input.focus()}}this.dp=null},isDropdownVisible:function(){return scilligence.ColorPicker2.dropdown!=null&&scilligence.ColorPicker2.dropdown.style.display!="none"},clickOut:function(c){var f=c.srcElement||c.target;if(this.dp!=null&&f==this.dp.input){return}var d=JsUtils.getParent(f,"TBODY");if(d!=this.area&&d!=this.header){this.hide()}},create:function(){if(this.dropdown!=null){return}var n=this;dojo.connect(document,"onclick",function(c){n.clickOut(c)});var u=scil.Utils.createTable(document.body,0,1,{border:JSDraw2.Skin.dialog.border,backgroundColor:JSDraw2.Skin.dialog.bkcolor,textAlign:"center",display:"none",position:"absolute"});this.dropdown=u.parentNode;dojo.connect(this.dropdown,"onclick",function(c){n.select(c.srcElement||c.target)});var j=JsUtils.createElement(JsUtils.createElement(u,"tr"),"td",null,{padding:"5px"});var t=scil.Utils.createTable(j,0,0,{backgroundColor:"#fff"});var h=Math.round(256/this.rows);var w=scil.Utils.createElement(t,"tr");for(var q=0;q<256;q+=h){var f="#"+scil.Utils.padLeft(q.toString(16),2,"0")+scil.Utils.padLeft(q.toString(16),2,"0")+scil.Utils.padLeft(q.toString(16),2,"0");scil.Utils.createElement(w,"td","&nbsp;",{background:f,width:this.cellwidth,height:this.cellwidth,fontSize:"1px",cursor:"pointer"},{title:f,colSpan:4})}scil.Utils.createElement(w,"td","&nbsp;",{background:"#eee",height:this.cellwidth,fontSize:"1px",cursor:"pointer",backgroundImage:"url(data:image/png;base64,R0lGODlhBgAGAIAAAP///39/fyH5BAAAAAAALAAAAAAGAAYAAAIKjIEWCMrs0pGhAAA7)"},{nocolor:1,title:"No Color",colSpan:h-this.rows*4});for(var q=0;q<256;q+=h){var w=scil.Utils.createElement(t,"tr");for(var l=0;l<256;l+=h){for(var d=0;d<256;d+=h){var f="#"+scil.Utils.padLeft(q.toString(16),2,"0")+scil.Utils.padLeft(l.toString(16),2,"0")+scil.Utils.padLeft(d.toString(16),2,"0");td=scil.Utils.createElement(w,"td","&nbsp;",{background:f,width:this.cellwidth,height:this.cellwidth,fontSize:"1px",cursor:"pointer"},{title:f})}}}scil.Utils.unselectable(t.parentNode);var x="#ffffff";td.style.color=x;td.style.background=x;td.title=x;t.parentNode.setAttribute("align","center")},select:function(c){if(c.tagName!="TD"||c.style.cursor!="pointer"){return}this.dp.setValue(c.getAttribute("nocolor")=="1"?"":c.title);try{if(this.dp.input.onchange!=null){this.dp.input.onchange()}if("createEvent" in document){var d=document.createEvent("HTMLEvents");d.initEvent("change",false,true);this.dp.input.dispatchEvent(d)}else{this.dp.input.fireEvent("onchange")}}catch(c){}this.hide()}});scil.ContextMenu=scil.extend(scil._base,{constructor:function(f,c,h,d,g){this.document=d==null?document:d;this.tbody=null;this.callback=c;this.submenus={};this.items=f;this.cur=null;this.parentMenu=h;this.obj=null;this.lang=g!=null?g:scil.Lang},isFrom:function(c){if(this.tbody==null){return false}if(scil.Utils.isChildOf(c,this.tbody.parentNode)){return true}for(var d in this.submenus){if(this.submenus[d].isFrom(c)){return true}}return false},show:function(j,l,g,c,d){this.hide();this._create(c);this.obj=g;var f=scil.Utils.getMaxZindex();var h=this.tbody.parentNode;h.style.display="";h.style.zIndex=f>0?f+1:100;scil.Utils.moveToScreen(j,l,h,d)},hide:function(c){if(this.tbody==null||this.tbody.parentNode.style.display=="none"){return false}this.tbody.parentNode.style.display="none";for(var d in this.submenus){this.submenus[d].hide()}this.setCur(null);if(c&&this.parentMenu!=null){this.parentMenu.hide(c)}return true},isVisible:function(){return this.tbody!=null&&this.tbody.parentNode.style.display!="none"},_create:function(c){if(c!=null){this.items=c}if(this.tbody==null){var d=this;this.tbody=scil.Utils.createTable(this.document.body,0,0,{position:"absolute",display:"none",backgroundColor:"#eee",color:"#000",border:"solid 1px #ddd",boxShadow:JSDraw2.Skin.menu.boxshadow});this.tbody.setAttribute("jspopupmenu","1");dojo.connect(this.tbody.parentNode,"onmousedown",function(f){if(f.button!=2){d.click(f)}});dojo.connect(this.tbody.parentNode,"onmouseover",function(f){d.hilit(f)});dojo.connect(this.document.body,"onmousedown",function(f){d.clickOut(f)});this._createItems()}else{if(c!=null){this._createItems()}}},_createItems:function(){scil.Utils.removeAll(this.tbody);for(var d=0;d<this.items.length;++d){var f=this.items[d];if(f=="-"){if(d==0||this.items[d-1]=="-"||d==this.items.length-1){continue}var l=scil.Utils.createElement(this.tbody,"tr");scil.Utils.createElement(l,"td",null,{textAlign:"center",width:"20px",backgroundColor:"#f5f5f5"});scil.Utils.createElement(l,"td","<hr style='margin:0;padding:0'>",{padding:"0 2px 0 2px"}).colSpan=3}else{if(typeof f=="string"){f={caption:f}}if(f.key==null){f.key=f.caption}var j=f.children!=null&&f.children.length>0;var c=f.bg==null?"#eee":f.bg;var l=scil.Utils.createElement(this.tbody,"tr",null,{backgroundColor:c},f.disabled?null:{menukey:f.key});scil.Utils.createElement(l,"td",f.checked?"&#10004;":null,{textAlign:"center",width:"20px",backgroundColor:"#f5f5f5"});var h={padding:"1px 3px 1px 3px",color:f.disabled?"gray":""};var g=f.nottranslate?f.caption:this.lang.res(f.caption);if(f.icon!=null){g="<img src='"+f.icon+"'>"+g}scil.Utils.createElement(l,"td",g,h);h.fontSize="75%";h.paddingLeft="10px";scil.Utils.createElement(l,"td",f.shortcut==null?"":f.shortcut,h);scil.Utils.createElement(l,"td",j?"&rsaquo;":null,{textAlign:"right",width:"30px",paddingRight:"5px"});if(j){this.submenus[f.key]=new scil.ContextMenu(f.children,f.callback==null?this.callback:f.callback,this,this.document)}else{delete this.submenus[f.key]}}}},hilit:function(c){var d=scil.Utils.getParent(c.srcElement||c.target,"TR");if(d!=null&&d.getAttribute("menukey")!=null){this.setCur(d)}},setCur:function(g){if(this.cur!=null){this.cur.childNodes[0].style.backgroundColor="#f5f5f5";this.cur.childNodes[1].style.backgroundColor="";this.cur.childNodes[2].style.backgroundColor="";this.cur.childNodes[3].style.backgroundColor="";var f=this.submenus[this.cur.getAttribute("menukey")];if(f!=null){f.hide()}}this.cur=g;if(g!=null){g.childNodes[0].style.backgroundColor="#aaf";g.childNodes[1].style.backgroundColor="#aaf";g.childNodes[2].style.backgroundColor="#aaf";g.childNodes[3].style.backgroundColor="#aaf";var f=g==null?null:this.submenus[g.getAttribute("menukey")];if(f!=null){var c=scil.Utils.getOffset(g.childNodes[3],false);var d=scil.Utils.getOffset(g.childNodes[0],false);f.show(c.x+g.childNodes[3].offsetWidth+1,c.y,null,null,d.x)}}},getCallbackObj:function(){return this.parentMenu==null?this.obj:this.parentMenu.getCallbackObj()},click:function(c){var f=scil.Utils.getParent(c.srcElement||c.target,"TR");var d=f==null?null:f.getAttribute("menukey");if(this.submenus[d]!=null){return}if(d!=null&&this.callback!=null){this.callback(d,this.getCallbackObj(),f.childNodes[0].innerHTML!="")}this.hide(true);c.preventDefault()},clickOut:function(c){var d=scil.Utils.getParent(c.srcElement||c.target,"TBODY");if(d!=null&&d.getAttribute("jspopupmenu")=="1"){return}this.hide()}});scil.apply(scil.ContextMenu,{isFromContextMenu:function(c){var d=scil.Utils.getParent(c,"TBODY");return d!=null&&d.getAttribute("jspopupmenu")=="1"}});JSDraw2.ContextMenu=scil.ContextMenu;scil.Form=scil.extend(scil._base,{constructor:function(c){if(typeof(c)=="boolean"){this.options={viewonly:c}}else{if(c==null){this.options={}}else{this.options=c}}this.lang=this.options.lang==null?scil.Lang:this.options.lang;this.viewonly=this.options.viewonly;this.items=null;this.tbody=null;this.fields=null;this.buttons=null},destory:function(){this.items=null;scil.Utils.removeAll(this.tbody);this.tbody=null;this.fields=null;this.buttons=null},getXml:function(f){var g=f?"":"<data>\n";for(var d in this.fields){var c=this.fields[d];var h=scil.Form.getFieldData(c,this.items[d]);if(h!=null&&h!=""){g+="<i n='"+scil.Utils.escXmlValue(d)+"'>";if(c.stype=="jsdraw"||c.stype=="xdraw"||c.stype=="jsdraw.table"||c.stype=="jsdraw.se"||c.stype=="jsdraw.fm"||c.stype=="table"||c.stype=="plate"||c.stype=="plates"){g+=h}else{g+=scil.Utils.escXmlValue(h)}g+="</i>\n"}}if(!f){g+="</data>"}return g},setXml:function(f){try{var c=scil.Form.xml2Json(f);this.setData(c)}catch(d){alert("Error raised when setting form data: "+d.message)}},getData:function(f){var g={};for(var d in this.fields){var c=this.fields[d];if(c!=null&&this.items[d].type!="rawfile"){var h=scil.Form.getFieldData(c,this.items[d]);if(f||!scil.Utils.isNullOrEmpty(h)){g[d]=h}}}return g},setData:function(d,j){this.setDirty(false);var c=this.viewonly&&this.options.autohiderows&&!scil.Utils.isDictEmpty(d);for(var g in this.fields){var f=this.fields[g];var h=this.items[g];if(f==null||h==null){continue}if(h.td1!=null){this.autoHideRow(h.td1.parentNode,false)}var l=null;if(d!=null){l=d[g];if(l==null&&h!=null){if(h.alternativekey!=null){l=d[h.alternativekey]}if(l==null&&h.was!=null){l=d[h.was]}}}if(j){if(l!=null){scil.Form.setFieldData(f,h,this.viewonly,l,d)}}else{scil.Form.setFieldData(f,h,this.viewonly,l,d)}if(c&&h.type!="hidden"&&h.autohide!=false&&h.td1!=null){if(j&&scil.Utils.isNullOrEmpty(l)){l=this.getFieldValue(g)}if(scil.Utils.isNullOrEmpty(l)){this.autoHideRow(h.td1.parentNode,true)}}}this.setDirty(false)},showAllRows:function(){for(var c in this.fields){var d=this.items[c];if(d!=null&&d.td1!=null){this.autoHideRow(d.td1.parentNode,false)}}},autoHideRow:function(g,c){if(g==null){return}if(c){if(g.style.display!="none"){g.setAttribute("autohide",g.style.display);g.style.display="none"}}else{var d=g.getAttribute("autohide");if(d!=null){g.removeAttribute("autohide");g.style.display=d}}},setFieldValue:function(f,g,c){var d=this.fields[f];scil.Form.setFieldData(this.fields[f],this.items[f],this.viewonly,g,c)},clear:function(){this.setData({})},onchange:function(d,c){this.dirty=true;if(this.options.onchange!=null){this.options.onchange(d,this,c)}this.onformula(d.getAttribute("key"))},onformula:function(d){var h=[d];while(h.length>0){var c=h[0];h.splice(0,1);for(var g in this.items){var f=this.items[g].formula;if(g==d||scil.Utils.isNullOrEmpty(f)){continue}if(f.indexOf("{"+c+"}")>=0){if(this.updateValueByFormula(g)){h.push(g)}}}}},updateValueByFormula:function(c){if(this.items[c]==null){return false}var d=this.items[c].formula;if(scil.Utils.isNullOrEmpty(d)){return false}if(this.items[c].type=="jsdraw.table"){return this.fields[c].jsd.applyFormula(d,this)}else{var f=scil.Form.evalFormula(d,this);if(f==null){return false}var g=this.getFieldValue(c);if(g==f){return false}this.setFieldValue(c,f);return true}},setDirty:function(c){this.dirty=c==null||c==true?true:false},preventUnsaved:function(d){var c=this;scil.connect(window,"onbeforeunload",function(f){if(c.dirty){if(d==null){d="WARNING: Form data are not saved yet."}var g=scil.Lang.res(d);if(f!=null){f.returnValue=g}return g}})},switchForm:function(g){if(this.options.alternativeforms==null){return false}if(this.alternativeforms==null){this.alternativeforms={};this.alternativeforms[""]={tbody:this.tbody,fields:this.fields,items:this.items}}if(this.alternativeforms[g]==null){var d=this.options.alternativeforms[g];if(d!=null){this.render2(d,this.parent,this.renderoptions);this.alternativeforms[g]={tbody:this.tbody,fields:this.fields,items:this.items}}}var c=this.alternativeforms[g];if(c==null){c=this.alternativeforms[""]}this.tbody=c.tbody;this.fields=c.fields;this.items=c.items;for(var f in this.alternativeforms){this.alternativeforms[f].tbody.parentNode.style.display=f==g?"":"none"}return true},selectrow:function(c){this.highlightrow(this.items[c])},onselectrow:function(c){var g=c.target||c.srcElement;var h=scil.Utils.getParent(g,"TD");var d=null;for(var f in this.items){if(this.items[f]!=null&&(this.items[f].td1==h||this.items[f].td2==h)){d=this.items[f];break}}this.highlightrow(d)},highlightrow:function(c){if(this.currentrow==c){return}if(this.currentrow!=null){this.currentrow.td1.style.backgroundColor=this.currentrowbckcolor;if(this.currentrow.td2!=null){this.currentrow.td2.style.backgroundColor=""}}if(c!=null){this.currentrowbckcolor=c.td1.style.backgroundColor;c.td1.style.backgroundColor=JSDraw2.Skin.form.rowselectcolor;if(c.td2!=null){c.td2.style.backgroundColor=JSDraw2.Skin.form.rowselectcolor}}this.currentrow=c;if(this.options.onselectrow!=null){this.options.onselectrow(c)}},render:function(f,c,d){this.parent=f;this.renderoptions=d;this.render2(c,this.parent,this.renderoptions)},render2:function(u,z,y){var c=y==null?null:y.align;var f=y==null?null:y.buttons;var q=typeof(y)=="boolean"?y:(y==null?true:y.immediately!=false);this.tbody=null;this.fields={};this.items={};this.buttons=[];for(var w in u){var t=u[w];if(t==null){continue}this.items[w]=t;if(t.label==null&&t.caption!=null){t.label=t.caption}if(JSDraw2.Table!=null&&scil.Utils.indexOf(JSDraw2.Table.kNumberColumns,t.type)>=0){t.type="number";if(t.unit==null){t.unit=JSDraw2.Table.kDefaultUnits[t.type]}}}if(this.options.usepostform){var j=JsUtils.createElement(z,"div","<form method='post' enctype='multipart/form-data'></form>");this.postform=j.firstChild;z=this.postform}var h=false;var g=this.options.cols;if(!(g>0)){if(!(g>1)){g=1}for(var n in this.items){var t=this.items[n];if(t.newcolumn){h=true;break}else{if(t.colspan>g){g=t.colspan}}}}this.tbody=scil.Utils.createTable(z,JSDraw2.Skin.form.spacing);if(h){this.columnLayout(y,q)}else{this.classicLayout(y,q,g)}if(this.options.onselectrow!=null){var x=this;dojo.connect(this.tbody.parentNode,"onclick",function(C){x.onselectrow(C)})}if(c!=null){this.tbody.parentNode.setAttribute("align",c)}if(f!=null){var B=scil.Utils.createElement(this.tbody,"tr");scil.Utils.createElement(B,"td","&nbsp;");B=scil.Utils.createElement(this.tbody,"tr");this.buttonTR=B;if(y==null||!y.vertical){scil.Utils.createElement(B,"td")}var A=scil.Utils.createElement(B,"td",null,{whiteSpace:"nowrap"},{colspan:this.options.colspan>1?this.options.colspan*2-1:null});if(y.centerbuttons){A.style.textAlign="center"}if(f.length>0){for(var l=0;l<f.length;++l){var d=f[l];if(d==" "){scil.Utils.createElement(A,"span","&nbsp;")}else{this.buttons.push(scil.Utils.createButton(A,d,this.lang))}}}else{this.buttons.push(scil.Utils.createButton(A,f,this.lang))}}for(var w in this.items){if(this.items[w]!=null&&this.items[w].type=="group"&&this.items[w].group!=null&&this.items[w].collapsed){scil.Form.expand({target:this.items[w].group})}}},columnLayout:function(t,h){var n=[];var q=0;var c=0;var l=null;for(var g in this.items){var j=this.items[g];if(typeof(j)=="function"){continue}var u=null;if(j.type=="hidden"){}else{if(j.type=="group"||j.colspan>1){u=scil.Utils.createElement(this.tbody,"tr");n.push({item:j});c=0}else{if(j.newcolumn){++c;if(c>q){q=c}if(n[n.length-1]!=null){u=n[n.length-1].item.td1.parentNode.nextSibling}else{u=this.tbody.childNodes[0]}}else{if(c>0){u=l==null?null:l.nextSibling}}if(u==null){u=scil.Utils.createElement(this.tbody,"tr")}if(u.childNodes.length<c*2){for(var f=u.childNodes.length;f<c*2;++f){scil.Utils.createElement(u,"td")}}}}var d=this.newField(j,u,h,(t==null?null:t.hidelabel),(t==null?null:t.vertical));if(d!=null){j.field=this.fields[g]=d;d.setAttribute("key",g)}if(d!=null&&this.options.onenter!=null&&d.tagName=="INPUT"){this.connectKeyEnter(d,this.options.onenter)}if(u!=null){l=u}}for(var f=0;f<n.length;++f){if(n[f].item.td2!=null){n[f].item.td2.colSpan=(q+1)*2-1}else{n[f].item.td1.colSpan=(q+1)*2}}},classicLayout:function(n,h,c){var q=null;var d=c;var l=null;for(var g in this.items){var j=this.items[g];if(typeof(j)=="function"){continue}if(j.type=="group"){q=scil.Utils.createElement(this.tbody,"tr");d=c}else{if(l!=null&&l.type=="group"||!(q!=null&&c>1&&d<c)){q=scil.Utils.createElement(this.tbody,"tr");d=j.colspan>0?j.colspan:1}else{d+=j.colspan>0?j.colspan:1}}var f=this.newField(j,q,h,(n==null?null:n.hidelabel),(n==null?null:n.vertical));if(f!=null){j.field=this.fields[g]=f;f.setAttribute("key",g)}if(j.type=="group"&&c>1){j.td1.colSpan=c*2}else{if(j.colspan>1){j.td2.colSpan=(j.td2.colSpan>0?j.td2.colSpan:1)+(j.colspan-1)*2}}if(f!=null&&this.options.onenter!=null&&f.tagName=="INPUT"){this.connectKeyEnter(f,this.options.onenter)}}},post:function(q,l,c){if(this.postform==null){return}for(var j in this.fields){var g=this.fields[j];if(scil.Utils.isNullOrEmpty(g.getAttribute("name"))){g.setAttribute("name",j)}}var d=null;if(l!=null){var h=this.getData();if(h==null){h={}}d={};for(var j in l){var t=l[j];var n=typeof(t);if(t!=null&&n!="function"&&n!="object"&&scil.Utils.isNullOrEmpty(h[j])){d[j]=t}}}scil.Utils.ajaxUploadFile(this.postform,q,d,c)},postForm:function(f,d,c){this.post(f,d,c)},checkRequiredFields:function(){var d=this.fields;var h=0;for(var g in this.items){var f=this.items[g];var c=d[g];if(f==null||c==null||f.td1==null){continue}f.td1.style.backgroundColor=JSDraw2.Skin.form.labelstyles.backgroundColor;if(f.type=="jsdraw.table"){h+=c.jsd.checkRequiredFields(0)}if(!f.required){continue}var j=scil.Form.getFieldData(c,f);if(scil.Utils.isNullOrEmpty(j,true)){f.td1.style.backgroundColor="red";++h}}return h},resetRequiredFields:function(){var d=this.fields;for(var g in this.items){var f=this.items[g];var c=d[g];if(f==null||c==null){continue}f.td1.style.backgroundColor=JSDraw2.Skin.form.labelstyles.backgroundColor}},connectKeyEnter:function(c,d){dojo.connect(c,"onkeydown",function(f){if(f.keyCode==13){d(c);f.preventDefault()}})},newField:function(g,j,f,d,l){var h=this;if(!this.viewonly){if(g.type=="jsdraw"||g.type=="xdraw"){if(JSDraw2.defaultoptions!=null&&JSDraw2.defaultoptions.usexdraw){g.type="xdraw"}if(g.options!=null){g.options.ondatachange=function(){h.onchange(c)}}else{g.ondatachange=function(){h.onchange(c)}}}else{if(g.type=="jsdraw.table"||g.type=="jsdraw.se"||g.type=="jsdraw.fm"||g.type=="table"||g.type=="plate"||g.type=="plates"||g.type=="tabtext"||g.type=="richtext"||g.type=="plaintext"||g.type=="templatetext"){if(g.options!=null){g.options.onchange=function(q,n){h.onchange(c,n)}}else{g.onchange=function(q,n){h.onchange(c,n)}}}}}var c=this.newField2(g,j,f,d,l);if(c==null){return null}if(!this.viewonly){if(c.tagName=="INPUT"||c.tagName=="TEXTAREA"){scil.connect(c,"onchange",function(){h.onchange(c)})}else{if(c.tagName=="SELECT"&&!JSDraw2.__touchmolapp){scil.connect(c,scil.Utils.isIE&&scil.Utils.isIE<9?"onclick":"onchange",function(){h.onchange(c)})}}if(c.tagName=="INPUT"&&g.mobiledata!=null&&g.type!="number"){new scil.MobileData(c,{category:g.mobiledata,url:scil.MobileData.getDefaultUrl(false)})}}return c},newField2:function(l,t,j,h,u){if(t==null&&l.type=="hidden"){var q=scil.Utils.createElement(this.parent,"div",null,{display:"none"});var g=scil.Form.createField(q,l,this.viewonly,l.value,null,j,null,this);return g}var n=scil.Utils.isNullOrEmpty(l.label)?"&nbsp;":this.lang.res(l.label)+(l.colon==false||l.label=="-"?"":":");if(l.type=="group"){if(this.tbody.childNodes.length>0){scil.Utils.createElement(scil.Utils.createElement(this.tbody,"tr"),"td","&nbsp;",{fontSize:"50%"},{colSpan:2});t=scil.Utils.createElement(this.tbody,"tr")}t.style.backgroundImage=scil.Utils.imgSrc("img/header-bg.gif",true);t.style.backgroundRepeat="repeat-x";var c=dojo.clone(JSDraw2.Skin.form.labelstyles);c.textAlign="left";scil.apply(c,{fontWeight:"bold",color:"#555",background:""});if(l.collapsible!=false){scil.apply(c,{backgroundImage:scil.Utils.imgSrc("img/collapse.gif",true),backgroundPosition:"right",backgroundRepeat:"no-repeat"})}var q=scil.Utils.createElement(t,"td",n,c,{colSpan:2});if(l.collapsible!=false){dojo.connect(q,"onclick",function(d){scil.Form.expand(d)})}l.group=q;l.td1=q;return null}else{if(l.type=="note"){var q=scil.Utils.createElement(t,"td",null,null,{colSpan:2});var f=scil.Utils.createElement(q,"div",this.lang.res(l.label||l.str),l.style);if(l.color!=null){f.style.color=l.color}l.td1=q;return null}else{if(h||l.hidelabel){l.td1=scil.Utils.createElement(t,"td")}else{if(l.required){n+="<span style='color:red' title='"+this.lang.res("Required")+"'>*</span>"}if(scil.Utils.isNullOrEmpty(l.icon)){l.td1=scil.Utils.createElement(t,"td",n,JSDraw2.Skin.form.labelstyles)}else{l.td1=scil.Utils.createElement(t,"td");scil.Utils.createElement(l.td1,"img",null,null,{src:l.icon});scil.Utils.createElement(l.td1,"span",n)}if(l.labelstyle!=null){scil.apply(l.td1.style,l.labelstyle)}}if(u){t=scil.Utils.createElement(this.tbody,"tr")}var q=scil.Utils.createElement(t,"td",l.leading,{width:l.tdwidth},{valign:"top"});l.td2=q;var g=scil.Form.createField(q,l,this.viewonly,l.value,null,j,null,this);if(l.type=="hidden"){t.style.display="none";t.setAttribute("hidden","1")}if(l.type=="number"){q.style.whiteSpace="nowrap"}return g}}},getFieldValue:function(c){return scil.Form.getFieldData(this.fields[c],this.items[c])},focus:function(c){scil.Form.focus(this.fields,c)}});scil.apply(scil.Form,{kAvoidXss:true,focus:function(h,l){if(h==null){return}var g=null;if(l==null){for(var j in h){var d=h[j];if(d!=null&&(d.tagName=="INPUT"||d.tagName=="TEXTAREA"||d.tagName=="SELECT")&&!d.disabled&&!d.readOnly){var n=scil.Utils.getParent(d,"TR");if(n!=null&&n.style.display!="none"&&!d.disabled){g=d;break}}}}else{g=h[l]}if(g!=null&&g.style.dislay!="none"&&g.focus!=null){try{g.focus()}catch(c){}}},mergeForm:function(f,g){if(f==null&&g==null){return null}var d={};if(f==null){for(var c in g){if(g[c]!=null){d[c]=g[c]}}return d}if(g==null){for(var c in f){if(f[c]!=null){d[c]=f[c]}}return d}for(var c in f){if(g[c]==null&&f[c]!=null){d[c]=f[c]}}for(var c in g){if(g[c]!=null){d[c]=g[c]}else{delete d[c]}}return d},createElement:function(g,j,d,h,c,f){if(c!=null&&c.title!=null){c.title=scil.Lang.res(c.title)}return scil.Utils.createElement(g,j,d,h,c,f)},expand:function(c){var g=c.target||c.srcElement;if(g.tagName!="TD"){return}var f=g.style.backgroundImage;var d=f.indexOf("expand.gif")>0;if(d){g.style.backgroundImage=scil.Utils.imgSrc("img/collapse.gif",true)}else{g.style.backgroundImage=scil.Utils.imgSrc("img/expand.gif",true)}var h=g.parentNode.nextSibling;while(h!=null&&h.childNodes.length!=1&&h.getAttribute("buttonrow")!="1"){if(h.getAttribute("hidden")!="1"){h.style.display=d?"":"none"}h=h.nextSibling}},_isAllString:function(f){if(f==null||typeof(f)!="object"){return false}if(f.length>0){return true}var d=0;for(var c in f){if(typeof(f[c])!="string"){return false}++d}return d>0},_getListItems:function(c){if(typeof(c.items)=="function"){c.items=c.items()}var d=c.items;if(d==null&&c.options!=null&&c.options.items!=null){d=c.options.items;c.items=d;c.options.items=null}if(d==null&&this._isAllString(c.options)){d=c.options;c.items=d;c.options=null}return d},createField:function(C,u,G,E,F,t,n,l){var D="input";var x=u.type;if(C!=null&&(x=="input"||x=="select"||x=="date"||x=="color"||x=="radio"||x=="checkbox"||x==null)){C.style.whiteSpace="nowrap"}if(G&&(x==null||x=="input"||x=="select"||x=="editableselect"||x=="htmltext"||x=="multiselect"||x=="dropdowninput"||x=="dropdowncheck"||x=="date")&&u.template==null&&(n||u.unit==null)){x="html"}switch(x){case"":case"date":case"color":case"editableselect":case"dropdowninput":case"dropdowncheck":case"multiselect":D="input";break;case"hidden":D=u.render!=null?"div":"input";break;case"password":D="password";break;case"rawfile":D="file";break;case"number":D=G?"span":"input";break;case"htmltext":D="texarea";break;case"jsdraw":case"xdraw":case"jsdraw.fm":case"jsdraw.se":case"jsdraw.table":case"plate":case"plates":case"table":case"tabtext":case"richtext":case"plaintext":case"html":case"fileshelf":case"file":case"filepath":case"filelink":case"filedblink":case"subform":case"checklist":case"image":case"curve":case"sketches":case"code":case"signature":case"okta":case"azure":case"templatetext":D="div";break;case"button":D="button";break;case"postfile":D="file";break;case"user":D="input";if(u.autosuggesturl==null){u.autosuggesturl="Ajax.ashx?cmd=user.suggest"}break;default:if(x!=null){D=x}break}if(u.viewonly){G=u.viewonly}if(G){if(D=="textarea"){D="div"}}if(typeof(C)=="string"){C=scil.byId(C)}var h;if(x=="checkbox"){var B=scil.Utils.createElement(C,"label",null,{whiteSpace:"nowrap"});h=scil.Utils.createElement(B,D,null,u.style,u.attributes);if(u.str!=null&&l!=null&&!n){scil.Utils.createElement(B,"span",l.lang.res(u.str))}}else{h=scil.Utils.createElement(C,D,null,u.style,u.attributes);if(G&&D=="div"&&(u.type=="htmltext"||u.type=="textarea")&&u.width!=null&&(u.style==null||u.style.maxWidth==null)){if(typeof(u.width)=="number"){h.style.maxWidth=u.width+"px"}else{h.style.maxWidth=u.width}h.style.wordWrap="break-word"}}if(u.type=="select"){this._getListItems(u)}if(D=="select"){var z=this._getListItems(u);if(z!=null){var c=u.addblank;if(c==null){if(z.length==null){c=true;for(var y in z){if(z[y]==null||z[y]==""){c=false;break}}}else{if(z.length==0||z[0]!=null&&z[0]!=""){c=true}}}if(c){scil.Utils.listOptions(h,[""])}scil.Utils.listOptions(h,z,E,null,u.sort!=false?true:false)}else{if((u.url||u.listurl)!=null){scil.Form.listOptions(h,(u.url||u.listurl),u.addblank,null,E)}}}if(G){if(u.copytext){if(h.tagName=="DIV"){h.style.width="";h.style.display="inline"}this.createFieldButton(C,{src:"jsdraw/img/copy.gif",title:"Copy Text",onclick:function(d){scil.Clipboard.copy(scil.Utils.getInnerText(h))}},l,h)}}else{if(u.button!=null){if(u.buttonnewline==null&&h.tagName=="TEXTAREA"&&u.width>500){u.buttonnewline=true}var g=u.buttonnewline?scil.Utils.createElement(C,"div"):C;if(u.button.length>0){for(var q=0;q<u.button.length;++q){this.createFieldButton(g,u.button[q],l,h)}}else{this.createFieldButton(g,u.button,l,h)}}}if(u.button2!=null){if(u.buttonnewline==null&&h.tagName=="TEXTAREA"&&u.width>500){u.buttonnewline=true}var g=u.buttonnewline?scil.Utils.createElement(C,"div"):C;scil.Utils.createButton(C,u.button2)}if((!n||n=="card"&&!scil.Utils.isNullOrEmpty(E))&&(u.str!=null||u.unit!=null)&&x!="checkbox"){u.fieldunit=scil.Utils.createElement(C,"span","&nbsp;"+(u.str||u.unit),{whiteSpace:"nowrap"})}if(n!="card"){var H=n&&u.listwidth!=null?u.listwidth:u.width;if(H!=null&&H>0){h.style.width=H+"px"}}if(u.height>0&&!(G&&D=="div"&&(u.type=="htmltext"||u.type=="textarea"))){h.style.height=u.height+"px"}if(u.align!=null){h.style.textAlign=u.align}if(G){if(D=="input"||D=="password"){h.readOnly=true;h.style.border="none"}else{if(D=="checkbox"||D=="select"){h.disabled=true}}}else{if(u.readonly||u.viewonly){if(D=="input"){h.readOnly=true}else{if(D=="checkbox"||D=="radio"||D=="select"){h.disabled=true}}}}if(D!="div"||x=="textarea"||x=="html"){h.style.color=JSDraw2.Skin.form.fieldcolor}h.stype=x;var f=scil.clone(u);if(u.options!=null){scil.apply(f,u.options)}if(G){f.viewonly=G}if(x=="jsdraw"||x=="xdraw"){var j=function(){if(x=="xdraw"){h.style.height=""}h.jsd=x=="jsdraw"||G?new JSDraw2.Editor(h,f):new scil.XDraw(h,f);if(!scil.Utils.isNullOrEmpty(E)){scil.Form.setFieldData(h,u,G,E)}};if(t){j()}else{scil.ready(j)}}else{if(x=="jsdraw.table"){var j=function(){h.jsd=new JSDraw2.Table(null,f,h);if(E!=null){h.jsd.setXml(E)}if(u.rows>0){for(var d=h.jsd.getRowCount();d<u.rows;++d){h.jsd.insert()}}};if(t){j()}else{scil.ready(j)}}else{if(x=="plate"||x=="plates"){var j=function(){if(f.hidetable==null){f.hidetable=true}if(x=="plate"){h.jsd=new JSDraw2.Plate(h,f)}else{h.jsd=new JSDraw2.Plates(h,f)}if(E!=null){h.jsd.setXml(E)}};if(t){j()}else{scil.ready(j)}}else{if(x=="jsdraw.se"){var j=function(){h.jsd=new JSDraw2.SequenceEditor(h,f);if(E!=null){h.jsd.setXml(E)}};if(t){j()}else{scil.ready(j)}}else{if(x=="jsdraw.fm"){var j=function(){h.jsd=new JSDraw2.Formulation(h,f);if(E!=null){h.jsd.setXml(E)}};if(t){j()}else{scil.ready(j)}}else{if(x=="table"){h.jsd=new scil.Table(f);h.jsd.render(h,u.columns);if(E!=null){h.jsd.setXml(E)}}else{if(x=="tabtext"){h.jsd=new scil.FieldTabText(h,f);if(E!=null){h.jsd.setXml(E)}}else{if(x=="code"){h.style.marginBottom="4px";h.jsd=new scil.FieldCode(h,f);if(E!=null){h.jsd.setValue(E)}}else{if(x=="signature"){h.jsd=new scil.FieldSignature(h,f);if(E!=null){h.jsd.setValue(E)}}else{if(x=="okta"){h.jsd=new scil.FieldOKTA(h,f);if(E!=null){h.jsd.setValue(E)}}else{if(x=="azure"){h.jsd=new scil.FieldAzure(h,f);if(E!=null){h.jsd.setValue(E)}}else{if(x=="richtext"){h.jsd=new scil.FieldRichText(h,f);if(E!=null){h.jsd.setXml(E)}}else{if(x=="plaintext"){h.jsd=new scil.FieldPlainText(h,f);if(E!=null){h.jsd.setXml(E)}}else{if(x=="subform"){h.jsd=new scil.FieldSubform(h,f);if(E!=null){h.jsd.setXml(E)}}else{if(x=="checklist"){h.jsd=new scil.FieldChecklist(h,f);if(E!=null){h.jsd.setXml(E)}}else{if(x=="file"||x=="filelink"||x=="filedblink"||x=="filepath"||x=="image"){if(x=="file"){h.jsd=new scil.FieldFile(h,f)}else{if(x=="image"){h.jsd=new scil.FieldImage(h,f)}else{if(x=="filelink"||x=="filedblink"||x=="filepath"){f.cmd=x;h.jsd=new scil.FieldFileLink(h,f)}}}if(u.render!=null){E=u.render(E,F)}if(E!=null){h.jsd.setXml(E)}}else{if(x=="sketches"){h.jsd=new scil.FieldSketches(h,f);if(u.render!=null){E=u.render(E,F)}if(E!=null){h.jsd.setXml(E)}}else{if(x=="fileshelf"){h.jsd=new scil.FileShelf(h,f);if(E!=null){h.jsd.list(E)}}else{if(x=="curve"){h.jsd=new scil.FieldCurve(h,f);if(E!=null){h.jsd.setXml(E)}}else{if(x=="number"){h.jsd=new scil.FieldNumber(h,f);this.setFieldData(h,u,G,E,F)}else{if(x=="templatetext"){h.jsd=new scil.FieldTemplateText(h,f);this.setFieldData(h,u,G,E,F)}else{if(x=="date"){if(!G&&!u.viewonly){new scil.DatePicker(h,u.options)}if(E!=null){if(E=="{today}"){E=scil.Utils.dateStr(new Date(),true,"yyyy-mm-dd")}}this.setFieldData(h,u,G,E,F)}else{if(x=="color"){h.jsd=new scil.ColorPicker2(h,{viewonly:G});this.setFieldData(h,u,G,E,F)}else{if(x=="button"){h.innerHTML=u.text}else{if(E!=null||x=="html"&&(u.template!=null||u.render!=null)){this.setFieldData(h,u,G,E,F)}}}}}}}}}}}}}}}}}}}}}}}}}if(u.type=="html"&&D=="div"){h.style.whiteSpace="nowrap"}if(x=="img"&&u.src!=null){h.src=u.src}if(u.title!=null){h.setAttribute("title",u.title)}if(u.onclick!=null){dojo.connect(h,"onclick",function(d){u.onclick(h,u,l,d)})}if(h.tagName=="INPUT"){if(u.onenter!=null){dojo.connect(h,"onkeydown",function(d){if(d.keyCode==13){u.onenter(h);d.preventDefault()}})}else{if(scil.Utils.isIE&&scil.Utils.isIE<9){dojo.connect(h,"onkeydown",function(d){if(d.keyCode==13){d.preventDefault()}})}}}if(x=="password"&&scil.Form.encryptpasswordonblur){dojo.connect(h,"onblur",function(d){h.value=scil.Form.encryptpassword(h.value)})}if(u.autosuggest!=null&&u.autosuggest!=""&&h.tagName=="INPUT"){h.jsd=new scil.AutoComplete(h,u.autosuggest,u.options,n?null:l)}else{if(u.autosuggesturl!=null&&u.autosuggesturl!=""&&h.tagName=="INPUT"){h.jsd=new scil.AutoComplete(h,u.autosuggesturl,u.options,n?null:l)}}var A=u.options;if(A==null){A={}}if(u.items!=null){A.items=u.items}if(u.url!=null){A.url=u.url}if(u.listurl!=null){A.url=u.listurl}if(u.autosuggest!=null){A.autosuggest=u.autosuggest}if(!G&&x=="editableselect"){h.jsd=new scil.EditableSelect(h,A)}else{if(!G&&x=="dropdowninput"){h.jsd=new scil.DropdownInput(h,A)}else{if(!G&&x=="dropdowncheck"){h.jsd=new scil.DropdownCheck(h,A)}else{if(!G&&x=="multiselect"){h.jsd=new scil.DropdownCheck(h,A)}else{if(!G&&x=="htmltext"){if(f.buttons==null){f.buttons=[]}else{if(typeof(f.buttons)=="string"){f.buttons=[f.buttons]}}if(f.extrabuttons!=null){f.buttons.push(f.extrabuttons)}if(E!=null&&E==""){h.value=E}scil.Richtext.initTinyMCE(h,f)}}}}}if(h.tagName=="INPUT"||h.tagName=="SELECT"||h.tagName=="TEXTAREA"){if(u.onchange!=null){dojo.connect(h,"onchange",function(){u.onchange(h,l)})}if(u.onfocus!=null){dojo.connect(h,"onfocus",function(){u.onfocus(h,l)})}if(u.onblur!=null){dojo.connect(h,"onblur",function(){u.onblur(h,l)})}if(h.tagName=="INPUT"&&!G){if(!scil.Utils.isNullOrEmpty(u.placeholder)){h.setAttribute("placeholder",scil.Lang.res(u.placeholder))}else{if(l.options.labelinbox){h.setAttribute("placeholder",scil.Lang.res(u.label))}}h.setAttribute("autocomplete","off")}}if(u.padding>=0&&(h.tagName=="INPUT"||h.tagName=="DIV")){h.style.paddingLeft=h.style.paddingRight=u.padding+"px"}if(h.tagName=="INPUT"&&h.disabled!=true&&u.type!="checkbox"&&u.type!="radio"){dojo.connect(h,"onfocus",function(){h.select()})}if(h.jsd!=null){h.jsd.parentform=l}return h},createFieldButton:function(h,d,g,f){var c=scil.Utils.createButton(h,d);if(c!=null){d.dom=c;if(d.onclick2!=null){dojo.connect(c,"onclick",function(){d.onclick2(f,g)})}else{if(d.ajaxurl!=null){dojo.connect(c,"onclick",function(){scil.Utils.ajax(d.ajaxurl,function(j){if(d.append!=null){f.value+=j+d.append}else{f.value=j}},{q:f.value})})}}}},getFieldData:function(d,f){if(d==null){return null}if(d.tagName=="INPUT"&&d.getAttribute("novalue")=="empty"){return null}if(d.stype=="jsdraw"){if(f!=null&&f.dataformat!=null){return d.jsd.getData(f.dataformat)}else{return d.jsd.getXml()}}if(d.stype=="xdraw"||d.stype=="jsdraw.se"||d.stype=="jsdraw.fm"||d.stype=="table"||d.stype=="plate"||d.stype=="plates"){return d.jsd.getXml()}else{if(d.stype=="jsdraw.table"){if(d.jsd.getRowCount()==0){return null}return d.jsd.getXml()}else{if(d.type=="checkbox"||d.type=="radio"){return d.checked}else{if(d.stype=="htmltext"){var c=scil.Form.getEd(d);return c==null?d.innerHTML:scil.Richtext.getHtml(c)}else{if(d.stype=="file"||d.stype=="filelink"||d.stype=="filedblink"||d.stype=="filepath"||d.stype=="image"||d.stype=="curve"||d.stype=="sketches"){return d.jsd.getXml()}else{if(d.stype=="tabtext"||d.stype=="richtext"||d.stype=="plaintext"||d.stype=="subform"||d.stype=="checklist"){return d.jsd.getXml()}else{if(d.stype=="code"){return d.jsd.getValue()}else{if(d.stype=="templatetext"){return d.jsd.getValue()}else{if(d.stype=="signature"){return d.jsd.getValue()}else{if(d.stype=="okta"){return d.jsd.getValue()}else{if(d.stype=="azure"){return d.jsd.getValue()}else{if(d.stype=="number"){return d.jsd.getValue()}else{if(d.type=="password"){return d.value==""?"":(f.encrypt!=false&&JSDraw2.password!=null&&JSDraw2.password.encrypt&&scil.Form.encryptpassword!=null?scil.Form.encryptpassword(d.value):d.value)}else{if(d.stype=="postfile"||d.stype=="button"){return null}else{if(d.value==null&&d.getAttribute!=null){return d.getAttribute("originalvalue")}if(d.value==""){return null}if(scil.Form.kAvoidXss&&(d.tagName=="INPUT"||d.tagName=="TEXTAREA")&&f!=null&&!f.allowhtml){return scil.Form.makeSafeHtml(d.value)}else{return d.value}}}}}}}}}}}}}}}},makeSafeHtml:function(c){if(c==null||typeof(c)!="string"||c.indexOf("<")<0||c.indexOf(">")<0){return c}return c.replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;")},setFieldData:function(d,g,t,n,q){if(g==null){return}if(t&&d.stype=="html"&&(g.type==null||g.type=="input"||g.type=="select")){n=this.makeSafeHtml(n)}var j=n;if(g.render!=null){n=g.render(n,q)}if(t&&g.maxlength>0&&typeof(n)=="string"&&n.length>g.maxlength){n=n.substr(0,g.maxlength-3)+"..."}if(d.stype=="jsdraw"||d.stype=="xdraw"||d.stype=="jsdraw.table"||d.stype=="jsdraw.se"||d.stype=="jsdraw.fm"||d.stype=="plate"||d.stype=="plates"){if(d.stype=="jsdraw"||d.stype=="xdraw"||d.stype=="jsdraw.table"&&g.options!=null&&g.options.spreadsheet){d.jsd.clear(true)}else{d.jsd.clear()}if(g.type=="jsdraw"){if(g.dataformat!=null){d.jsd.setData(n,g.dataformat)}else{if(!(n==null||typeof(n)=="string"&&n=="")){d.jsd.setXml(n)}}}else{if(n!=null&&n.rows!=null&&d.stype=="jsdraw.table"){d.jsd.setJson(n)}else{if(!(n==null||typeof(n)=="string"&&n=="")){d.jsd.setXml(n)}}if(d.stype=="jsdraw.table"&&g.options!=null&&g.options.spreadsheet){d.jsd.createTable()}if(d.stype=="jsdraw.table"&&g.rows>0){for(var f=d.jsd.getRowCount();f<g.rows;++f){d.jsd.insert()}}}}else{if(d.stype=="table"){if(n!=null&&(typeof(n)=="string"||typeof(n)=="object"&&n.tagName=="table")){d.jsd.setXml(n)}else{if(n!=null&&n.length>0){d.jsd.setData(n)}else{d.jsd.setData([])}}}else{if(g.type=="tabtext"||g.type=="richtext"||g.type=="plaintext"){d.jsd.setXml(n)}else{if(g.type=="checkbox"||g.type=="radio"){d.checked=scil.Utils.isTrue(n)}else{if(g.type=="select"){if(t){var h=this._getListItems(g);if(h!=null&&h.length==null){n=h[n]}this._setInnerHTML(d,n,j)}else{scil.Utils.selectOption(d,n)}}else{if(g.type=="date"){if(typeof(n)=="string"&&!scil.Utils.isNullOrEmpty(n)&&!isNaN(n)){n=parseFloat(n);if(isNaN(n)){n=null}}var l=g.timeformat==null?scil.Utils.dateStr(n,true,g.dateformat):scil.Utils.timeStr(n,true,g.timeformat);if(t){if(d.tagName=="INPUT"){d.value=l}else{this._setInnerHTML(d,l,j)}}else{d.value=l}}else{if(g.type=="templatetext"){d.jsd.setValue(n)}else{if(g.type=="color"){d.jsd.setValue(n)}else{if(d.stype=="code"){d.jsd.setValue(n)}else{if(d.stype=="signature"){d.jsd.setValue(n)}else{if(d.stype=="okta"){d.jsd.setValue(n)}else{if(d.stype=="azure"){d.jsd.setValue(n)}else{if(d.stype=="number"){return d.jsd.setValue(n)}else{if(d.stype=="html"){if(n!=null&&typeof(n)=="object"){j=n=scil.Utils.getOuterXml(n)}var l=n==null?"":n;if(g!=null&&g.template!=null){l=this.renderTemplate(g.template,n,q)}else{if(typeof(l)=="string"&&l.match(/^((http[s]?)|(ftp)):[\/]{2}.+$/i)!=null){l="<a target=_blank href='"+l+"'>"+l+"</a>"}}this._setInnerHTML(d,l,g.noorignalvalue?null:j)}else{if(d.stype=="file"||d.stype=="filelink"||d.stype=="filedblink"||d.stype=="filepath"||d.stype=="image"||d.stype=="curve"||d.stype=="sketches"||d.stype=="subform"||d.stype=="checklist"){d.jsd.setXml(n)}else{if(d.stype=="fileshelf"){d.jsd.list(n)}else{if(g.type=="htmltext"){if(n!=null&&typeof(n)=="object"){j=n=scil.Utils.getOuterXml(n)}if(t){this._setInnerHTML(d,d.innerHTML=n==null?"":n,j,true)}else{var c=scil.Form.getEd(d);if(c!=null&&c.dom!=null){c.setContent(n==null?"":n)}else{d.value=n==null?"":n}}}else{if(d.stype=="textarea"){if(d.tagName=="TEXTAREA"){d.value=n==null?"":n}else{this._setInnerHTML(d,this.wrapTextarea(n),j,true)}}else{if(d.stype!="div"&&d.stype!="button"){if(d.stype=="hidden"&&n!=null&&typeof(n)=="object"&&n.tagName!=null){n=scil.Utils.getOuterXml(n)}if(d.tagName=="INPUT"||d.tagName=="TEXTAREA"){d.value=n==null?"":n}else{if(d.tagName=="DIV"){this._setInnerHTML(d,n==null?"":n,j)}}}}}}}}}}}}}}}}}}}}}if(g.onrendered!=null){g.onrendered(d,n)}},wrapTextarea:function(c){var d="white-space: -moz-pre-wrap; white-space: -pre-wrap; white-space: -o-pre-wrap; white-space: pre-wrap; word-wrap: break-word;";return c==null?"":"<pre style='margin:0;padding:0;"+d+"'>"+scil.Utils.escapeHtml(c)+"</pre>"},_setInnerHTML:function(d,g,f,c){if(g==null){g=""}else{if(c){g+="<div style='clear:both'></div>"}}d.innerHTML=g;if(f!=null&&(f+"")!=""){d.setAttribute("originalvalue",f)}else{d.removeAttribute("originalvalue")}},renderTemplate:function(f,l,n){s=f.replace(/\{\?\}/g,l==null?"":l);if(n==null){return s}var h=s.match(/\{\{[a-z|0-9]+\}\}/ig);if(h==null){return s}for(var c=0;c<h.length;++c){var g=h[c];var d=g.substr(2,g.length-4);var j=n[d];s=s.replace(g,j==null?"":j)}return s},listOptions:function(d,g,c,f,h){scil.Utils.jsonp(g,function(j){if(c){scil.Utils.listOptions(d,[""])}var l=d.getAttribute("_value");if(scil.Utils.isNullOrEmpty(l)){l=h}scil.Utils.listOptions(d,j,l,false,f);d.removeAttribute("_value")})},create:function(j,l,h,c,t){if(typeof l=="string"){l=dojo.byId(l)}var d=scil.Utils.createElement(l,"div");var f=new scil.Form(t);f.render(d,h);if(c!=null){var q=scil.Utils.createElement(f.tbody,"tr");var n=scil.Utils.createElement(q,"td");n=scil.Utils.createElement(q,"td");if(c.length==null){scil.Utils.createButton(n,c)}else{for(var g=0;g<c.length;++g){scil.Utils.createButton(n,c[g])}}}if(j.load!=null){scil.onload(function(){j.load()})}return f},createForm2:function(h,f,c,g){if(g==null){g={}}var d=null;if(c!=null){g.buttons=c}if(g.tabs!=null){d=new scil.TabbedForm(g).render(h)}else{d=new scil.Form(g);d.render(h,f,g)}return d},_connetOnClick:function(c,d){dojo.connect(c,"onclick",function(){d()})},createDlgForm:function(f,j,d,l){var c={};if(typeof(l)=="number"){c.width=l+"px";l=null}else{if(l!=null&&l.width>0){c.width=l.width+"px"}}var g=scil.Utils.createElement(null,"div",null,c);var h=new JSDraw2.Dialog(f,g,l);h.show2({immediately:true,modal:l==null?null:l.modal});h.form=this.createForm2(g,j,d,l);h._scilform=true;h.moveCenter();if(l!=null&&l.oncreated){l.oncreated(h.form)}return h},createFormDlg:function(d,f,c,g){return this.createDlgForm(d,f,c,g)},createTabDlgForm:function(c,d){return this.createDlgForm(c,null,null,d)},createForm:function(u,g,w,f,l,j){var y={verticalAlign:"top",whiteSpace:"nowrap"};var z={textAlign:"left"};if(f){y.border="solid 1px #f0f0f0";y.backgroundColor="#f5f5f5"}var A=scil.Utils.createTable();var x=false;for(var n=0;n<u.length;++n){if(u[n].required){x=true;break}}if(x){var C=scil.Utils.createElement(A,"tr");scil.Utils.createElement(C,"td");scil.Utils.createElement(C,"td","<span style='color:red;font-weight:bold'>* indicates required field</span>",z)}for(var n=0;n<u.length;++n){var t=u[n];var C=scil.Utils.createElement(A,"tr");var B=scil.Utils.createElement(C,"td",t.label+(t.required?"<b style='color:red'>*</b>":""),y);if(t.colspan){B.colSpan=2}else{B=scil.Utils.createElement(C,"td",null,z);if(t.tag!=null){var q=scil.Utils.createElement(B,t.tag);if(t.tag=="select"){scil.Utils.listOptions(q,t.options)}if(t.width!=null){q.style.width=t.width+"px"}if(t.height!=null){q.style.height=t.height+"px"}if(t.id!=null){q.id=t.id}if(t.tag=="hidden"){C.style.display="none"}if(t.align!=null){q.style.textAlign=t.align}if(t.id==j){dojo.connect(q,"onkeydown",function(D){if(D.keyCode==13){w();D.preventDefault()}})}}if(t.span!=null){scil.Utils.createElement(B,"span",t.span)}}}var C=scil.Utils.createElement(A,"tr");scil.Utils.createElement(C,"td","&nbsp;");C=scil.Utils.createElement(A,"tr");scil.Utils.createElement(C,"td");var B=scil.Utils.createElement(C,"td");if(g!=null){if(typeof(g)=="string"){var c=scil.Utils.createElement(B,"button",g);dojo.connect(c,"onclick",w)}else{if(g!=null&&typeof(g)=="object"&&g.length>0){var h=[];for(var n=0;n<g.length;++n){var d=g[n];var c=scil.Utils.createElement(B,"button",d.caption);if(d.id!=null){c.id=d.id}this._connetOnClick(c,d.onclick)}}}}if(l!=null){scil.Utils.createElement(B,"span",l)}return A.parentNode},fillForm:function(c,f){for(k in c){var d=dojo.byId((f==null?"":f)+k);if(d!=null){if(d.tagName=="SELECT"){JsUtils.selectOption(d,c[k])}else{d.value=c[k]==null?"":c[k]}}}},collectFormData:function(g){var h={};var d=g.getElementsByTagName("input");for(var c=0;c<d.length;++c){var f=d[c];var q=(f.getAttribute("type")+"").toLowerCase();switch(q){case"radio":case"checkbox":if(f.checked){this._addValue(h,f.id,f.value==null||f.value.length==0?"true":f.value)}break;case"button":break;default:this._addValue(h,f.id,f.value);break}}var l=g.getElementsByTagName("textarea");for(var c=0;c<l.length;++c){var f=l[c];this._addValue(h,f.id,f.value)}var j=g.getElementsByTagName("select");for(var c=0;c<j.length;++c){var f=j[c];this._addValue(h,f.id,f.value)}return h},_addValue:function(c,d,g){if(d==null||d.length==0){return}var f=d.lastIndexOf(".");if(f>0){d=d.substr(f+1)}c[d]=g},toAmount:function(d,c){if(d==null||d==0){return"-"}else{if(d>=1000){return(d/1000)+(c?"L":"kg")}else{if(d<0.001&&c){return(d*1000000)+"ug"}else{if(d<1){return(d*1000)+(c?"uL":"mg")}else{return d+(c?"mL":"g")}}}}},processAmount:function(d){if(!(d.amount>0)){d.amount=null}if(!(d.amountleft>0)){d.amountleft=null}var f=d.amount==null?d.amountleft:d.amount;if(f<=0){f=null}if(f===null){d.unit=d.isliquid?"L":"kg"}else{if(f>=1000){d.amount/=1000;d.amountleft/=1000;d.unit=d.isliquid?"L":"kg"}else{if(f<0.001&&!d.isliquid){d.amount*=1000000;d.amountleft*=1000000;d.unit="ug"}else{if(f<1){d.amount*=1000;d.amountleft*=1000;d.unit=d.isliquid?"uL":"mg"}else{d.unit=d.isliquid?"mL":"g"}}}}},setButtonValueByKey:function(c,f,g){if(c==null){return}for(var d=0;d<c.length;++d){if(c[d].key==f){c[d].b.value=g==null?"":g;break}}},getButtonValueByKey:function(c,f){if(c==null){return null}for(var d=0;d<c.length;++d){if(c[d].key==f){return c[d].b.value}}return null},getButtonValuesByKey:function(c,g,d){if(d==null){d={}}for(var f=0;f<g.length;++f){d[g[f]]=this.getButtonValueByKey(c,g[f])}return d},createToolbarButtons:function(g,c,f,j,h){if(g==null||c==null){return}var l=null;if(j!=null){l=scil.Utils.createElement(scil.Utils.createTable2(g,null,{cellSpacing:0,cellPadding:0,align:j}),"tr")}for(var d=0;d<c.length;++d){if((d==0||c[d-1]=="-"||c[d-1]=="|")&&(c[d]=="-"||c[d]=="|")){continue}if(c[d].imgheight==40){c[d].imgheight=25;if(c[d].padding==null){c[d].padding=8}}if(j!=null){g=scil.Utils.createElement(l,"td")}this._createButton(g,c[d],d==0?3:f,c[d]!=null&&h!=null&&h==c[d].label)}},_createButton:function(h,d,g,j){if(d==null){return}if(d.padding!=null){g=d.padding}else{if(typeof(g)!="number"||g<=0){g=4}}if(typeof(d)=="string"){scil.Utils.createElement(h,"span",(d=="-"?"|":d),{marginLeft:g+"px",marginRight:g+"px"});return}if(d.label=="-"){d.colon=false;g=0}if(j){h.style.borderBottom="solid 3px white"}d.label=scil.Lang.res(d.label);d.caption=scil.Lang.res(d.caption);d.title=scil.Lang.res(d.title);var c=null;var l=d.colon==false?"":":";var f;if(d.type=="select"){if(d.label!=null){f=scil.Utils.createElement(h,"span",d.label+l,d.labelstyle);f.style.marginLeft=g+"px";g=0}c=scil.Utils.createElement(h,"select",null,d.styles,d.attributes);if(d.url!=null){scil.Form.listOptions(c,d.url,d.addblank,d.sort,d.value)}else{scil.Utils.listOptions(c,d.items||d.options,d.value,null,null,d.sort)}if(d.onchange!=null){dojo.connect(c,"onchange",function(n){d.onchange(n)})}if(d.autoshrink==null){d.autoshrink=JSDraw2.Skin.toolbar.autoshrink}if(d.autoshrink>0&&scil.AutoShrink!=null){new scil.AutoShrink(c,d,true)}}else{if(d.type=="input"||d.type=="date"||d.type=="color"||d.type=="editableselect"||d.type=="dropdowninput"){if(d.label!=null){f=scil.Utils.createElement(h,"span",d.label+l,d.labelstyle);f.style.marginLeft=g+"px";g=0}c=scil.Utils.createElement(h,"input",null,d.styles,d.attributes);if(d.onenter!=null){dojo.connect(c,"onkeydown",function(n){if(n.keyCode==13){d.onenter(c)}})}if(d.onchange!=null){dojo.connect(c,"onchange",function(n){d.onchange(n)})}if(d.autosuggesturl!=null){new scil.AutoComplete(c,d.autosuggesturl,{onsuggest:d.onsuggest})}if(d.type=="date"){new scil.DatePicker(c)}else{if(d.type=="color"){new scil.ColorPicker2(c)}else{if(d.type=="editableselect"){new scil.EditableSelect(c,d)}else{if(d.type=="dropdowninput"){new scil.DropdownInput(c,d)}}}}if(d.value!=null){c.value=d.value}if(d.autoshrink==null){d.autoshrink=JSDraw2.Skin.toolbar.autoshrink}if(d.autoshrink>0){new scil.AutoShrink(c,d,true)}}else{c=scil.Utils.createButton(h,d)}}c.style.marginLeft=g+"px";c.style.marginRight=g+"px";d.b=c;if(f!=null&&d.onclicklabel!=null){f.style.color="blue";f.style.cursor="pointer";f.style.textDecoration="underline";scil.connect(f,"onclick",function(n){d.onclicklabel(d,n)})}},getEd:function(c){return tinymce.get(c.id)},dict2formxml:function(c){return this.json2xml(c)},json2xml:function(c,f){if(c==null){return null}var g=f?"":"<data>\n";for(var d in c){var h=c[d];if(h!=null&&h!=""){g+="<i n='"+scil.Utils.escXmlValue(d)+"'>";g+=scil.Utils.escXmlValue(h);g+="</i>\n"}}if(!f){g+="</data>"}return g},encryptpassword:function(g){if(scil.Utils.isNullOrEmpty(g)){return null}if(g.length>4&&g.substr(0,3)=="(?|"&&g.substr(g.length-1)==")"){return g}var f=CryptoJS.enc.Utf8.parse(JSDraw2.password!=null&&JSDraw2.password.key!=null?JSDraw2.password.key:"PSVJQRk9qTEp!6U1dWUZ%RVFG=1VVT0=");var d=CryptoJS.enc.Utf8.parse(JSDraw2.password!=null&&JSDraw2.password.iv!=null?JSDraw2.password.iv:"!WlSLVE2ZU+NaW?=");var c=CryptoJS.AES.encrypt(g,f,{iv:d,mode:CryptoJS.mode.CBC,padding:CryptoJS.pad.Pkcs7});return"(?|"+c+")"},xml2Json:function(n){var j=null;if(typeof n=="object"){j=n}else{if(typeof n=="string"){var d=scil.Utils.parseXml(n);if(d!=null){j=d.documentElement||d.firstElementChild}}}if(j==null||j.childNodes==null){return null}var c={};for(var g=0;g<j.childNodes.length;++g){var f=j.childNodes[g];if(f.tagName!="i"){continue}var h=f.getAttribute("id");if(h==null){h=f.getAttribute("n")}var l=scil.Utils.getFirstElement(f);if(l!=null&&scil.Utils.isIE&&scil.Utils.isIE<9){l=l.xml}c[h]=l!=null?l:(f.text||f.textContent)}return c},evalFormula:function(formula,form,jss,irow){if(scil.Utils.isNullOrEmpty(formula)){return null}var ss=scil.Form.splitVars(formula);var expression="";for(var i=0;i<ss.length;++i){var s=ss[i];if(scil.Utils.startswith(s,"{")&&scil.Utils.endswith(s,"}")){var k=s.substr(1,s.length-2);if(k.substr(0,1)=="."){s=jss.getCellValue(irow,k.substr(1))}else{var type=form.items[k].type;if(type=="jsdraw.table"||type=="jsdraw"||type=="jsdraw.se"){s="form.fields['"+k+"'].jsd"}else{s=form.getFieldValue(k)}}}s=s.trim();if(scil.Utils.endswith(s,"%")){var s2=s.substr(0,s.length-1);if(!isNaN(s2)){s=parseFloat(s2)/100}}expression+=s}try{return eval(expression)}catch(e){return null}},splitVars:function(f){var d=[];var c;while((c=f.indexOf("{"))>=0){if(c>0){d.push(f.substr(0,c));f=f.substr(c)}c=f.indexOf("}");if(c<0){break}d.push(f.substr(0,c+1));f=f.substr(c+1)}if(!scil.Utils.isNullOrEmpty(f)){d.push(f)}return d},ext2Icon:function(d){if(d==null){return"unknown"}var f=d.lastIndexOf(".");if(f<0){return"unknown"}var c=d.substr(f+1).toLowerCase();switch(c){case"avi":case"bmp":case"c":case"cab":case"cdx":case"cer":case"chm":case"dll":case"doc":case"eps":case"exe":case"fasta":case"fdf":case"gif":case"hlp":case"htm":case"iso":case"jar":case"java":case"jdx":case"jpg":case"js":case"jsdraw":case"mdb":case"mht":case"molengine":case"mov":case"mp3":case"mrv":case"msg":case"msi":case"pdb":case"pdf":case"pic":case"ppt":case"ps":case"py":case"pyc":case"rm":case"sdf":case"skc":case"sql":case"swf":case"txt":case"vbs":case"vsd":case"xls":case"xml":case"xps":case"zip":return c;case"docx":case"rtf":return"doc";case"dx":return"jdx";case"oxps":return"xps";case"pptx":return"ppt";case"xlsx":case"csv":return"xls";case"jpeg":return"jpg";case"svg":case"tif":case"tiff":return"pic";case"mp4":case"wmv":return"mov";case"wav":return"avi";case"png":case"wmf":case"emf":return"bmp";case"html":case"shtml":case"xhtml":return"htm";case"gz":return"zip";case"cdxml":return"cdx";case"tgf":return"skc";case"mol":case"rxn":case"jsd":case"jssdf":return"jsdraw";case"cs":case"vb":case"cpp":case"c":case"aspx":case"asp":return"script";case"config":return"xml";default:return"unknown"}}});scil.AutoComplete=scil.extend(scilligence._base,{constructor:function(c,h,g,d){this.input=null;this.auto=null;this.url=h;this.sugid=0;this.disabled=false;this.options=g==null?{}:g;this.form=d;var f=this;this.input=typeof(c)=="string"?document.getElementById(c):c;if(this.input.tagName=="INPUT"){scil.connect(this.input,"onkeyup",function(j){f.keydown(j)});this.auto=scil.Utils.createElement(document.body,"div",null,{display:"none",overflowX:"hidden",overflowY:"auto",maxHeight:"400px",backgroundColor:"white",border:"solid 1px gray",position:"absolute"});scil.connect(document.body,"onmousedown",function(j){var l=j.srcElement||j.target;if(l!=f.q&&!scil.Utils.isChildOf(l,f.auto)&&l!=f.auto){f.clickout()}});if(this.options.listedonly){scil.connect(this.input,"onblur",function(j){f.validateList()})}}scil.AutoComplete._all.push(this)},validateList:function(){var c=this.input.value;if(this.items==null||scil.Utils.indexOf(this.items,c)<0){this.input.value=""}},isVisible:function(){return this.auto!=null&&this.auto.style.display==""},hide:function(){if(this.auto!=null){this.auto.style.display="none"}},keydown:function(e){if(this.disabled||this.input==null||this.url==null||this.url==""){return}if(this.input.value.length<1||e.keyCode==27||(e.ctrlKey||e.metaKey)){this.auto.style.display="none";return}if(!this.isVisible()&&e.keyCode==13){return}if(e.keyCode==38||e.keyCode==40||e.keyCode==13){this.highlight(e);return}var sugid=++this.sugid;if(scil.Utils.startswith(this.url,"data:")){var ret=this.filterlist(this.url.substr(5).split(","),this.input.value);this.list(ret,sugid)}else{if(scil.Utils.startswith(this.url,"javascript:")){var s=this.url.substr(11);var fn=scil.Utils.eval(s);var items=fun(this);var ret=this.filterlist(items,this.input.value);this.list(ret,sugid)}else{var me=this;var args={q:this.input.value};if(this.options.onsuggest!=null){this.options.onsuggest(args,this.form,this)}scil.Utils.jsonp(this.url,function(ret){me.list(ret.items==null?ret:ret.items,sugid)},args)}}},filterlist:function(d,f){var g=[];if(f!=null&&f!=""&&d!=null){f=f.toLowerCase();for(var c=0;c<d.length;++c){if(d[c].toLowerCase().indexOf(f)>=0){g.push(scil.Utils.trim(d[c]))}}}return g},isParentHidden:function(d){var c=d;while(c!=null&&c.style!=null){if(c.style.display=="none"||c.style.visibility=="hidden"){return true}c=c.parentNode}return false},list:function(f,h){if(f==null||f.length==0||h!=this.sugid||this.isParentHidden(this.input)){this.items=null;this.auto.style.display="none";return}if(this.auto.style.display!=""){this.position()}this.items=f;scilligence.Utils.removeAll(this.auto);var g=this;for(var d=0;d<f.length;++d){var c=scilligence.Utils.createElement(this.auto,"div",f[d]);dojo.connect(c,"onclick",function(j){g.click(j)});dojo.connect(c,"onmouseover",function(j){g.mouseover(j)});dojo.connect(c,"onmouseout",function(j){g.mouseout(j)})}},position:function(){var c=scil.Utils.getOffset(this.input,true,true);this.auto.style.position=c.fixedposition?"fixed":"absolute";var g=scil.Utils.getZindex(this.input)+1;var f=this.input.offsetWidth;if(this.options.minautowidth>0&&this.options.minautowidth>f){f=this.options.minautowidth}if(f<100){f=100}var d=scil.Utils.isFixedPosition(this.input)?"fixed":"absolute";dojo.style(this.auto,{zIndex:g,position:d,display:"",width:(f-2)+"px",left:c.x+"px",top:(c.y+this.input.offsetHeight)+"px"})},highlight:function(d){if(this.auto==null||this.auto.style.display=="none"){return}d.preventDefault();if(d.keyCode==27){this.hide();return}var c=this.auto.childNodes;var j=null;for(var f=0;f<c.length;++f){var g=c[f];if(g.getAttribute("sel")=="1"){j=f;break}}if(d.keyCode==13){if(j!=null){this.clickItem(c[j])}return}var h=null;if(d.keyCode==38||d.keyCode==40){if(j==null){h=0}else{if(d.keyCode==38){h=j-1;if(h<0){h=c.length-1}}else{h=j+1;if(h>=c.length){h=0}}}d.preventDefault()}if(h!=null&&h!=j){if(j!=null){this._hilitItem(c[j],false)}this._hilitItem(c[h],true)}},mouseover:function(c){this._hilitItem(c.srcElement||c.target,true)},mouseout:function(c){this._hilitItem(c.srcElement||c.target,false)},_hilitItem:function(d,c){if(c){d.style.backgroundColor="#ddf";d.setAttribute("sel","1")}else{d.style.backgroundColor="white";d.removeAttribute("sel")}},getItemValue:function(d){var c=scil.Utils.unescXmlValue(d.innerHTML);if(c=="&nbsp;"){c=""}return c},click:function(c){var d=c.srcElement||c.target;this.clickItem(d)},clickItem:function(d){var c=this.getItemValue(d);if(this.options.onSetValue!=null){this.options.onSetValue(this.input,c)}else{if(this.options.overwrite=="unit"){this.input.value=this.changeUnit(this.input.value,c)}else{if(this.options.overwrite==false){this.input.value+=c}else{this.input.value=c}}}this.hide();if(this.options.overwrite){this.input.select()}this.input.focus();if(this.options.onclickitem!=null){this.options.onclickitem(c)}scil.Utils.fireEvent(this.input,"change",false,true)},clickout:function(c){if(this.auto.style.display==""){this.auto.style.display="none"}}});scil.apply(scil.AutoComplete,{_all:[],hideAll:function(){for(var c=0;c<this._all.length;++c){this._all[c].hide()}}});document.write('<style type="text/css">input._scil_dropdown::-ms-clear {display: none;}</style>');scil.DropdownInput=scil.extend(scilligence._base,{constructor:function(c,f){this.auto=null;this.options=f==null?{}:f;this.input=typeof(c)=="string"?document.getElementById(c):c;this.itemschanged=true;this.sugid=0;this.suggestlength=this.options.suggestlength>0?this.options.suggestlength:1;if(this.options.autosuggest==""){this.options.autosuggest=null}var d=this;this.input.style.background="#fff "+scil.Utils.imgSrc("img/dropdown.gif",true)+" no-repeat right center";this.input.style.border="solid 1px #999";this.input.style.padding="2px";this.input.className="_scil_dropdown";this.updateReadonly();dojo.connect(this.input,"onkeyup",function(g){d.keyup(g)});dojo.connect(this.input,"onclick",function(g){d.clickMe(g)})},updateDropdown:function(c){if(c!=null){this.options.readonly=c;this.updateReadonly()}this.input.style.backgroundImage=this.options.items==null?"":scil.Utils.imgSrc("img/dropdown.gif",true)},updateReadonly:function(){this.input.readOnly=this.options.readonly;this.input.style.backgroundColor=this.options.readonly?"#eee":"#fff"},keyup:function(e){if(this.disabled||this.input==null||this.options.autosuggest==null&&this.options.onFilter==null&&this.options.items==null){return}if(this.options.readonly){if(this.options.items!=null){this.highlight(e)}return}if(this.input.value.length<this.suggestlength||e.keyCode==9||e.keyCode==13){if(this.auto!=null){this.auto.style.display="none"}return}var sugid=++this.sugid;if(this.options.onFilter!=null){var ret=this.options.onFilter(this.input.value);this.list(ret,sugid);this.itemschanged=true}else{if(scil.Utils.startswith(this.options.autosuggest,"data:")){var ret=this.filterlist(this.options.autosuggest.substr(5).split(","),this.input.value);this.list(ret,sugid);this.itemschanged=true}else{if(scil.Utils.startswith(this.options.autosuggest,"javascript:")){var s=this.options.autosuggest.substr(11);var fn=scil.Utils.eval(s);var items=fn(this);var ret=this.filterlist(items,this.input.value);this.list(ret,sugid);this.itemschanged=true}else{if(this.options.items!=null&&this.options.autosuggest==null){var ret=this.filterlist(this.options.items,this.input.value);this.list(ret,sugid);this.itemschanged=true}else{if(this.options.autosuggest!=null){var me=this;var args={q:this.input.value};if(this.options.onsuggest!=null){this.options.onsuggest(args)}scil.Utils.jsonp(this.options.autosuggest,function(ret){me.list(ret.items==null?ret:ret.items,sugid);me.itemschanged=true},args)}}}}}},filterlist:function(d,f){var g=[];if(f!=null&&f!=""&&d!=null){f=f.toLowerCase();for(var c=0;c<d.length;++c){if(d[c].toLowerCase().indexOf(f)>=0){g.push(scil.Utils.trim(d[c]))}}}return g},clickMe:function(c){if(this.options.items==null){return}var d=c.srcElement||c.target;if(d.offsetWidth-(c.offsetX==null?c.layerX:c.offsetX)<16){this.show()}},setItems:function(c){if(c==null){return}this.options.items=c;this.itemschanged=true},isChildOf:function(c){return c==this.input||JsUtils.isChildOf(c,this.auto)},isDropdownVisible:function(){return this.auto!=null&&this.auto.style.display==""},isVisible:function(){return this.input!=null&&this.input.style.display==""},show:function(){if(this.auto==null){var c=this;var d=scil.Utils.isFixedPosition(this.input)?"fixed":"absolute";this.auto=scil.Utils.createElement(document.body,"div",null,{display:"none",backgroundColor:"white",overflowX:"hidden",overflowY:"auto",maxHeight:"400px",border:"solid 1px gray",position:d,zIndex:99999});dojo.connect(document.body,"onmousedown",function(f){var g=f.srcElement||f.target;if(g!=c.q&&g.parentNode!=c.auto&&g!=c.auto){c.clickout()}})}if(this.itemschanged){this.list(this.options.items,++this.sugid)}this.auto.style.display="";this.auto.style.zIndex=scil.Utils.getZindex(this.input)+1;this.updateDropdownSize()},highlight:function(g){if(this.auto==null||this.auto.style.display=="none"){if(g.keyCode==13||g.keyCode==40){this.show();g.preventDefault()}return}g.preventDefault();if(g.keyCode==27){this.hide();return}var f=this.auto.childNodes;var n=null;for(var h=0;h<f.length;++h){var j=f[h];if(j.getAttribute("sel")=="1"){n=h;break}}if(g.keyCode==13){if(n!=null){this.clickItem(f[n])}return}var l=null;if(g.keyCode==38||g.keyCode==40){if(n==null){l=0}else{if(g.keyCode==38){l=n-1;if(l<0){l=f.length-1}}else{l=n+1;if(l>=f.length){l=0}}}g.preventDefault()}else{if(g.char!=null){var d=g.char.toLowerCase();l=this.findNextMatch(d,n==null?0:n+1,f.length);if(l==null&&n!=null){l=this.findNextMatch(d,0,n)}}}if(l!=null&&l!=n){if(n!=null){this._hilitItem(f[n],false)}this._hilitItem(f[l],true)}},findNextMatch:function(d,l,f){for(var g=l;g<f;++g){var h=this.auto.childNodes[g];if(h.innerHTML){var j=this.getItemValue(h);if(j.length>0&&j.substr(0,1).toLowerCase()==d){return g}}}return null},updateDropdownSize:function(){if(!this.isDropdownVisible()){return}var c=scil.Utils.getOffset(this.input,true,true);var d=this.input.offsetWidth;if(this.options.minautowidth>0&&this.options.minautowidth>d){d=this.options.minautowidth}if(d<100){d=100}dojo.style(this.auto,{left:c.x+"px",top:(c.y+this.input.offsetHeight)+"px",width:(d-2)+"px"})},hide:function(){if(this.auto!=null&&this.auto.style.display!="none"){this.auto.style.display="none"}},isParentHidden:function(d){var c=d;while(c!=null&&c.style!=null){if(c.style.display=="none"||c.style.visibility=="hidden"){return true}c=c.parentNode}return false},list:function(f,j){if(f==null||f.length==0||j!=this.sugid||this.isParentHidden(this.input)){if(this.auto!=null){scilligence.Utils.removeAll(this.auto);this.auto.style.display="none"}return}if(this.auto==null||this.auto.style.display=="none"){this.itemschanged=false;this.show()}this.itemschanged=false;scilligence.Utils.removeAll(this.auto);if(f==null||f.length==0){return}var g=this;for(var d=0;d<f.length;++d){var h=f[d];var c=scilligence.Utils.createElement(this.auto,"div",scil.Utils.isNullOrEmpty(h)?"&nbsp;":h,{padding:"2px",textAlign:this.options.align});dojo.connect(c,"onclick",function(l){g.click(l)});dojo.connect(c,"onmouseover",function(l){g.mouseover(l)});dojo.connect(c,"onmouseout",function(l){g.mouseout(l)})}},mouseover:function(c){this._hilitItem(c.srcElement||c.target,true)},mouseout:function(c){this._hilitItem(c.srcElement||c.target,false)},_hilitItem:function(d,c){if(c){d.style.backgroundColor="#ddf";d.setAttribute("sel","1")}else{d.style.backgroundColor="white";d.removeAttribute("sel")}},clickout:function(c){this.hide()},click:function(c){var d=c.srcElement||c.target;this.clickItem(d)},getItemValue:function(d){var c=scil.Utils.htmlDecode(d.innerHTML);if(c=="&nbsp;"){c=""}return c},clickItem:function(d){var c=this.getItemValue(d);if(this.options.onSetValue!=null){this.options.onSetValue(this.input,c)}else{if(this.options.overwrite=="unit"){this.input.value=this.changeUnit(this.input.value,c)}else{if(this.options.overwrite==false){this.input.value+=c}else{this.input.value=c}}}this.hide();if(this.options.overwrite){this.input.select()}this.input.focus();if(this.options.onclickitem!=null){this.options.onclickitem(c)}scil.Utils.fireEvent(this.input,"change",false,true)},changeUnit:function(d,f){var c=JSDraw2.Table.parseValueUnit(d);if(c==null||c.value==null){return""}return c.value+(f==null?"":f)}});scil.EditableSelect=scil.extend(scil._base,{constructor:function(c,f){this.q=null;this.auto=null;this.options=f==null?{}:f;this.disabled=false;var d=this;if(this.options.items==null&&(this.options.url!=null||this.options.listurl!=null)){scil.Utils.jsonp(this.options.url||this.options.listurl,function(g){d.options.items=g})}this.q=typeof(c)=="string"?document.getElementById(c):c;dojo.connect(this.q,"onkeyup",function(g){d.keyup(g)});dojo.connect(this.q,"onmousedown",function(g){d.showList()});this.auto=scil.Utils.createElement(document.body,"div",null,{display:"none",backgroundColor:"white",border:"solid 1px gray",position:"absolute",zIndex:99999});dojo.connect(document.body,"onmousedown",function(g){var h=g.srcElement||g.target;if(h!=d.q&&h.parentNode!=d.auto){d.clickout()}})},keyup:function(c){if(this.disabled||this.q==null){return}if(c.keyCode==9||c.keyCode==13){this.auto.style.display="none";return}this.showList()},showList:function(){var c=this.filter(this.options.items,this.q.value);this.list(c)},filter:function(d,f){if(f==null||f==""){return d}f=f.toLowerCase();var g=[];for(var c=0;c<d.length;++c){var h=d[c];if(h.length>=f.length&&h.substr(0,f.length).toLowerCase()==f){g.push(h)}}return g},isParentHidden:function(d){var c=d;while(c!=null&&c.style!=null){if(c.style.display=="none"||c.style.visibility=="hidden"){return true}c=c.parentNode}return false},list:function(f){if(f==null||f.length==0||this.isParentHidden(this.q)){this.auto.style.display="none";return}if(this.auto.style.display!=""){var h=scilligence.Utils.getOffset(this.q,true);var l=scil.Utils.getZindex(this.q)+1;var j=scil.Utils.isFixedPosition(this.q)?"fixed":"absolute";dojo.style(this.auto,{zIndex:l,position:j,display:"",width:this.q.offsetWidth+"px",left:(h.x)+"px",top:(h.y+this.q.offsetHeight)+"px"})}scilligence.Utils.removeAll(this.auto);var g=this;for(var d=0;d<f.length;++d){var c=scilligence.Utils.createElement(this.auto,"div",f[d]);dojo.connect(c,"onclick",function(n){g.click(n)});dojo.connect(c,"onmouseover",function(n){g.mouseover(n)});dojo.connect(c,"onmouseout",function(n){g.mouseout(n)})}},mouseover:function(c){var d=c.srcElement||c.target;d.style.backgroundColor="#ddddff"},mouseout:function(c){var d=c.srcElement||c.target;d.style.backgroundColor="white"},click:function(c){var d=c.srcElement||c.target;this.q.value=d.innerHTML;this.auto.style.display="none";scil.Utils.fireEvent(this.q,"change",false,true)},clickout:function(c){if(this.auto.style.display==""){this.auto.style.display="none"}}});scil.EditableForm=scil.extend(scilligence._base,{constructor:function(c){this.table=c;this.dlg=null;this.form=null;this.id=null},show:function(f,d){this.id=null;this.create();if(f==null){this.dlg.show(this.table.getDisplayName());this.form.setData(d)}else{var g=this;var c={};c.itemname=this.table.itemname;c[this.table.idcolumn]=f;this.table.ajax(this.table.cmd+".load",function(h){g.show2(h)},c)}},show2:function(c){this.id=c[this.table.idcolumn];this.dlg.show(this.table.getDisplayName());this.form.setData(c)},create:function(){if(this.dlg!=null){return}var g=this;var f={};for(var d in this.table.columns){if(this.table.columns[d]!=null&&this.table.columns[d].inForm!=false){f[d]=this.table.columns[d]}}var c=[{src:scil.App.imgSmall("submit.png"),caption:"Save",onclick:function(){g.save()}},{src:scil.App.imgSmall("del.png"),caption:"Delete",onclick:function(){g.del()}}];this.dlg=scil.Form.createDlgForm("",f,c);this.form=this.dlg.form},save:function(){var c=this.form.getData();c[this.table.idcolumn]=this.id;c.itemname=this.table.itemname;if(this.table.options.onSave!=null){if(this.table.options.onSave(c)==false){return}}var d=this;this.table.ajax(this.table.cmd+".save",function(f){c[d.table.idcolumn]=f[d.table.idcolumn];d.save2(c)},c)},save2:function(c){if(this.id==null){this.table.table.addRow(c)}else{this.table.table.updateRow(this.id,c)}this.dlg.hide()},del:function(){if(!confirm("Confirm to delete this "+this.table.itemname+". Delete?")){return}var d=this;var c={};c.itemname=this.table.itemname;c[this.table.idcolumn]=this.id;this.table.ajax(this.table.cmd+".del",function(f){d.del2()},c)},del2:function(){this.table.table.delRow(this.id);this.dlg.hide()}});scilligence.EditableTable=scilligence.extend(scilligence._base,{constructor:function(g,c,d,f){this.table=null;this.form=new scil.EditableForm(this);this.columns=c;this.options=f==null?{}:f;this.itemname=d;this.cmd=this.options.cmd!=null?this.options.cmd:this.itemname.toLowerCase();this.ajaxurl=this.options.ajaxurl;this.idcolumn=this.options.idcolumn!=null?this.options.idcolumn:this.itemname.toLowerCase()+"id";scil.EditableTable.register(this);if(this.ajaxurl==null){this.ajaxurl="ajax.ashx"}if(typeof(g)=="string"){g=scil.byId(g)}this.pages=scil.Utils.createElement(g,"div");this.init(g)},getDisplayName:function(){if(this.options.displayname!=null){return this.options.displayname}return this.itemname},init:function(l){var h={};for(var g in this.columns){if(this.columns[g]!=null&&this.columns[g].inTable!=false){h[g]=this.columns[g]}}var j=this;if(h[this.idcolumn]==null){h[this.idcolumn]={type:"img",src:scil.App.imgSmall("edit.png"),title:scil.Lang.res("Edit"),iskey:true,onclick:function(n,q){scil.EditableTable.edit2(j,n,q)}}}if(this.options.viewonly){h[this.idcolumn]=null}this.table=scil.Table.create(this,l,h,true,this.options.loadimmediately);var j=this;if(!this.options.viewonly){var d=scil.Utils.createElement(l,"div",null,{marginTop:"10px"});var c;if(this.options.buttons!=null){c=this.options.buttons}else{c={icon:scil.App.imgSmall("add.png"),label:"Add",onclick:function(){j.add()}}}if(c!=false){if(c.length>0){for(var f=0;f<c.length;++f){scil.Utils.createButton(d,c[f])}}else{scil.Utils.createButton(d,c)}}}},setData:function(c){this.table.setData(c)},add:function(){if(this.options.onAdd==null){this.form.show(null,this.options.defaultvalues)}else{this.options.onAdd()}},edit:function(c){if(this.options.onEdit==null){this.form.show(c)}else{this.options.onEdit(c)}},ajax:function(f,d,c){scil.Utils.ajax(this.ajaxurl+"?cmd="+f,d,c)},clear:function(){this.table.clear()},list:function(d){var c=this;this.table.setData(d.rows==null?d:d.rows);scil.Table.listPages(this.pages,d.page,d.pages,function(f){c.load(f)})},load:function(f){var d=this;var c=this.options.args==null?{}:dojo.clone(this.options.args);c.itemname=this.itemname;c.page=f;this.ajax(this.cmd+".list",function(g){d.list(g)},c)}});scilligence.apply(scilligence.EditableTable,{__id:0,__items:{},get:function(c){return this.__items[c]},register:function(c){c.__id=++this.__id;this.__items[c.__id]=c},edit:function(d,c){this.get(d).edit(c)},edit2:function(c,d,f){var g=scil.Utils.getParent(d,"TR");c.edit(g.getAttribute("key"))}});scilligence.Progress={dlg:null,bar:null,msg:null,oncancel:null,show:function(c,f,d,g){this.create();if(f==false){this.cancelbtn.style.display="none";this.oncancel=null}else{if(typeof(f)=="function"){this.cancelbtn.style.display="";this.oncancel=f}}this.msg.innerHTML=d==null?"":d;this.frame.style.display=g==false?"none":"";this.dlg.show(c)},hide:function(){if(this.dlg!=null){this.dlg.hide()}},cancel:function(){if(this.oncancel!=null){this.oncancel()}this.hide()},update:function(f,c){if(f>100){f=100}else{if(!(f>0)){f=0}}var d=Math.round(300*f/100);if(d<0){d=0}this.bar.style.width=d+"px";this.msg.innerHTML=c==null?"":c},create:function(d){if(this.dlg!=null){return false}var c=scilligence.Utils.createElement(null,"div",null,{margin:"5px",width:"320px",textAlign:"center"});this.animator=scilligence.Utils.createElement(c,"div",scil.Utils.imgTag("animator.gif"),{textAlign:"center"});this.msg=scilligence.Utils.createElement(c,"div","&nbsp;",{textAlign:"center"});this.frame=scilligence.Utils.createElement(c,"div",null,{width:"300px",height:"20px",border:"solid 1px #e0e0e0",textAlign:"left"});this.bar=scilligence.Utils.createElement(this.frame,"div","&nbsp;",{width:"1px",height:"20px",backgroundColor:"blue"});this.cancelbtn=scilligence.Utils.createElement(c,"button",scil.Utils.imgTag("cancel.gif")+"Cancel",{marginTop:"10px"});dojo.connect(this.cancelbtn,"onclick",function(){scilligence.Progress.cancel()});this.dlg=new JSDraw2.Dialog("Progress",c);return true}};scil.ProgressCall={cancelled:false,count:0,url:null,ondata:null,onresult:null,show:function(j,d,c,g,h){this.url=j;this.count=d;this.ondata=g;this.onresult=h;var f=true;scil.Progress.show(c,function(){f.cancelled=true});this.callNext(0)},callNext:function(d){var c=this.cancelled?null:this.ondata(d,this.count);if(c==null){scil.Progress.hide();return}if(c.i==null){c.i=d}else{d=c.i}var f=this;scil.Progress.update((d-1)*100/this.count,"Process "+d+" of "+this.count);scil.Utils.ajax(this.url,function(g){f.onresult(d,g);f.callNext(d+1)},c)}};scil.Table=scil.extend(scil._base,{constructor:function(f,c,d){if(f!=null&&typeof(f)=="object"){this.options=f;this.viewonly=this.options.viewonly;this.header=this.options.header}else{this.viewonly=f;this.header=c;if(scil.Table._tableincrease==null){scil.Table._tableincrease=0}this._tableid=++scil.Table._tableincrease;if(typeof(d)=="function"){this.options={onAdd:d}}else{if(d==null){this.options={}}else{this.options=d}}}this.groupIndex=0;this.checkIndex=1;this.dataIndex=2;this._startrow=2;this.tbody=null;this.items=null;this.key=null;this._lastcheck=null},getXml:function(){var h=this.tbody.childNodes.length-this._startrow;if(h==0){return""}var u="<table>\n";for(var d=0;d<h;++d){var q=this.tbody.childNodes[d+this._startrow];var c=false;var l={};var f=this.dataIndex;for(var g in this.items){var t=scil.Form.getFieldData(q.childNodes[f++].field);l[g]=t;if(!c&&t!=null&&t!=""){c=true}}if(!c){continue}u+="<r";if(q.getAttribute("isnew")=="1"){u+=" isnew='1'"}u+=">\n";for(var g in l){var t=l[g];if(t!=null&&t!=""){u+="<i n='"+scil.Utils.escXmlValue(g)+"'>"+scil.Utils.escXmlValue(t)+"</i>\n"}}u+="</r>\n"}u+="</table>";return u},setXml:function(d,c){this.setData(scil.Table.xml2rows(d),c)},getCsv:function(){var l="";var c=0;for(var f in this.items){if(++c>1){l+=","}l+=scil.Utils.escCsvValue(this.items[f].label)}l+="\n";var g=this.tbody.childNodes.length-this._startrow;for(var d=0;d<g;++d){var q=this.tbody.childNodes[d+this._startrow];var h=this.getRowData(q,true);c=0;for(var f in this.items){if(++c>1){l+=","}l+=scil.Utils.escCsvValue(h[f])}l+="\n"}return l},getData:function(c,f,u){if(c==null){var w=[];var q=this.tbody.childNodes.length-this._startrow;for(var d=0;d<q;++d){var x=this.tbody.childNodes[d+this._startrow];var t=this.getRowData(x,u);w.push(t)}return w}else{var q=this.tbody.childNodes.length-this._startrow;c[f+".n"]=q;for(var d=0;d<q;++d){var x=this.tbody.childNodes[d+this._startrow];var l=f+"."+d+".";if(x.getAttribute("isnew")=="1"){c[l+"isnew"]=1}var g=this.dataIndex;for(var h in this.items){c[l+h]=scil.Form.getFieldData(x.childNodes[g++].field)}}}},getRowDataByKey:function(c){var d=this.findRow(c);return this.getRowData(d)},getRowData:function(l,g){if(l==null){return null}if(typeof(l)=="number"){l=this.tbody.childNodes[l+this._startrow];if(l==null){return null}}var f={};if(l.getAttribute("isnew")=="1"){f.isnew=1}var c=this.dataIndex;for(var d in this.items){var h=l.childNodes[c++];var n=h==null?null:scil.Form.getFieldData(h.field,this.items[d]);if(n!=null&&n!=""){f[d]=n}}if(g&&l.childNodes[this.checkIndex].firstChild.checked){f.rowchecked=true}return f},getRowTexts:function(h){if(h==null){return null}if(typeof(h)=="number"){h=this.tbody.childNodes[h+this._startrow];if(h==null){return null}}var g={};if(h.getAttribute("isnew")=="1"){g.isnew=1}var d=this.dataIndex;for(var f in this.items){var c=h.childNodes[d++];var l=c.text||c.textContent;if(l!=null&&l!=""){g[f]=l}}return g},getCurrentRowData:function(){return this.getRowData(this.currow)},setData:function(d,g,c){if(c!=false){this.clear()}if(d!=null){for(var f=0;f<d.length;++f){this.addRow(d[f],g)}}if(!this.viewonly&&this.options.addrow!=false&&this.options.canadd!=false){this.addRow()}},clear:function(){this.dirty=false;for(var c=this.tbody.childNodes.length-1;c>=this._startrow;--c){this.tbody.removeChild(this.tbody.childNodes[c])}this.currow=null},render:function(t,n){this.items={};for(var j in n){if(n[j]!=null){this.items[j]=n[j];if(n[j].iskey){this.key=j}}}this._hideCookieCols(this.items);if(this.options.pushleft){this.items[""]={label:"",width:this.options.pushleft>100?this.options.pushleft:scil.Table.kPushLeftWidth}}if(typeof(t)=="string"){t=dojo.byId(t)}var q=this;var f=scil.Utils.createElement(t,"div");if(JSDraw2.Skin.table.cell=="grid"){this.tbody=scilligence.Utils.createTable(f,0,JSDraw2.Skin.table.spacing,{borderCollapse:"collapse"},1)}else{if(JSDraw2.Skin.table.cell=="col"){this.tbody=scilligence.Utils.createTable(f,0,JSDraw2.Skin.table.spacing,{borderCollapse:"collapse"})}else{this.tbody=scilligence.Utils.createTable(f,0,JSDraw2.Skin.table.spacing,{borderRight:JSDraw2.Skin.jssdf.border,borderBottom:JSDraw2.Skin.jssdf.border,borderTop:JSDraw2.Skin.jssdf.border})}}this.tbody.parentNode.setAttribute("bordercolor","#ddd");this.tbody.parentNode.setAttribute("class","scil_table");if(!this.viewonly&&this.options.addrow!=false&&this.options.canadd!=false){var c=scil.Utils.createElement(scil.Utils.createElement(f,"div"),"img",null,null,{src:scil.Utils.imgSrc("img/add.gif"),title:scil.Lang.res("Add")});dojo.connect(c,"onclick",function(){if(q.options.onAdd!=null){q.options.onAdd(q)}else{q.addRow()}})}if(this.options.draggable){var q=this;scil.Utils.unselectable(this.tbody.parentNode);new scil.DnD(this.tbody.parentNode,{onstartdrag:function(A){var B=A.target||A.srcElement;if(B==null||B.style.cursor!="move"){return}var C=scil.Utils.getParent(B,"TR");if(C!=null&&C.parentNode==q.tbody&&(!q.options.grouping||C.getAttribute("newgroup")=="1")){return C}},oncreatecopy:function(B,A){var F=A.src;var E=scil.Utils.getMaxZindex();var G=scil.Utils.createTable(document.body,0,0,{position:"absolute",zIndex:E+1,border:"solid 1px #888",background:"white",opacity:0.8});var H=scil.Utils.createElement(G,"tr");var D=F.childNodes;for(var C=0;C<Math.min(8,D.length);++C){z=D[C].cloneNode(true);z.style.width=D[C].offsetWidth+"px";z.style.height=D[C].offsetHeight+"px";H.appendChild(z)}return G.parentNode},ondrop:function(B,A){if(A.copy!=null){A.copy.parentNode.removeChild(A.copy)}var F=scil.Utils.getParent(B.target||B.srcElement,"TR");if(F!=null&&F.parentNode==q.tbody){if(q.options.ondrop!=null){q.options.ondrop(A.src,F,q)}else{if(A.src!=F){if(q.options.grouping&&F.getAttribute("newgroup")!="1"){return}var D=[A.src];if(q.options.grouping){var E=D[D.length-1].nextSibling;while(E!=null&&E.getAttribute("newgroup")!="1"){D.push(E);E=E.nextSibling}}if(D[D.length-1].nextSibling==F){q.tbody.removeChild(F);q.tbody.insertBefore(F,D[0])}else{for(var C=0;C<D.length;++C){q.tbody.removeChild(D[C])}for(var C=0;C<D.length;++C){q.tbody.insertBefore(D[C],F)}}q.onchange(B,null);q.updateRowColor()}}}}})}var y=scil.clone(scil.Table.headerstyles);y.borderBottom=JSDraw2.Skin.jssdf.border;y.borderLeft=JSDraw2.Skin.jssdf.border;var w=scil.Utils.createElement(this.tbody,"tr");var g=this.options.header0;var u=scil.Utils.createElement(this.tbody,"tr");if(g!=null){scil.Utils.createElement(w,"td",null,{display:this.options.grouping?"":"none"});var z=scil.Utils.createElement(w,"td",null,y);z.style.display=this.options.rowcheck?"":"none";for(var h=0;h<g.length;++h){var l=g[h];if(l==null){scil.Utils.createElement(w,"td")}else{var z=scil.Utils.createElement(w,"td",scil.Lang.res(l.label),y,{colSpan:l.colspan});z.style.textAlign="center"}}}var z=scil.Utils.createElement(u,"td",null,scil.Table.headerstyles);if(this.options.grouping){z.style.width="5px";scil.Utils.createElement(z,"img",null,null,{src:scil.Utils.imgSrc("img/minus.gif")},function(A){q.groupExpandAll(A)})}else{z.style.display="none"}var z=scil.Utils.createElement(u,"td",null,scil.Table.headerstyles);if(this.options.rowcheck){z.style.width="5px";if(this.options.rowcheck!="radio"){scil.Utils.createElement(z,"checkbox",null,null,null,function(A){q.checkAll((A.srcElement||A.target).checked)})}}else{z.style.display="none"}for(var j in this.items){var l=this.items[j];var x=scil.Lang.res(l.label);if(this.options.renderheadertext!=null){x=this.options.renderheadertext(x,l)}if(l.unit!=null&&l.unit!=""){x+=" ("+scil.Lang.res(l.unit)+")"}var z=scil.Utils.createElement(u,"td",null,y,{key:j});var f=scil.Utils.createElement(z,"div",x,{width:"100%"});if(l.width>0){z.style.width=l.width+"px"}if(l.type=="hidden"||l.ishidden){z.style.display="none"}if(l.whitespace!=null){z.style.whiteSpace=l.whitespace}if(l.type=="checkbox"&&l.headercheckbox!=false&&!this.viewonly&&!l.viewonly){var d=scil.Utils.createElement(z,"checkbox");this.connectCheckAll(d,j)}}if(this.header==false){u.style.display="none"}if(!this.viewonly){if(this.options.delrow!=false&&this.options.candel!=false){scil.Utils.createElement(u,"td","&nbsp;",y)}this.addRow()}if(this.options.selectrow){dojo.connect(this.tbody,"onclick",function(A){q.clickRow(A)})}},connectCheckAll:function(c,d){var f=this;dojo.connect(c,"onclick",function(g){f.checkAll((g.srcElement||g.target).checked,d)})},showAllColumns:function(c){for(var d in this.items){this.showColumn(d,true,c)}},autoHideColumns:function(){if(this.options.autohidecolumns!=true){this.showAllColumns(true);return}var f={};var j=this.tbody.childNodes.length-this._startrow;var d=this.dataIndex-1;for(var h in this.items){++d;f[h]=false;if(scil.Utils.isNullOrEmpty(h)){f[h]=true;continue}for(var g=0;g<j;++g){var q=this.tbody.childNodes[g+this._startrow].childNodes[d];var l=q.innerText;if(l!=null&&l!=""&&l!=" "||this.hasCheckedCheckbox(q)||this.hasChild(q,"img")){f[h]=true;break}}}for(var h in f){this.showColumn(h,f[h],true)}},hasChild:function(c,f){var d=c.getElementsByTagName(f);return d!=null&&d.length>0},hasCheckedCheckbox:function(c){var f=c.getElementsByTagName("input");if(f!=null&&f.length>0){for(var d=0;d<f.length;++d){var c=f[d];if(c!=null&&c.checked){return true}}}return false},hidColumn:function(c){return this.showColumn(c,false)},showColumn:function(l,d,c){if(this.options.header0!=null){return false}if(d==null){d=true}var j=this.items[l];if(j==null||j.type=="hidden"){return false}if(c){if(j.ishidden){d=false}}else{j.ishidden=!d}if(this.tbody==null||this.tbody.childNodes.length<=1){return false}var h=this.getColIndex(l);if(h==-1){return false}for(var g=1;g<this.tbody.childNodes.length;++g){this.tbody.childNodes[g].childNodes[h].style.display=d?"":"none"}return true},getColIndex:function(d){var f=this.tbody.childNodes[1];for(var c=0;c<f.childNodes.length;++c){if(f.childNodes[c].getAttribute("key")==d){return c}}return -1},checkAll:function(c,h){var l=this.tbody.childNodes;if(h==null){for(var d=this._startrow;d<l.length;++d){if(l[d].style.display=="none"){l[d].childNodes[this.checkIndex].firstChild.checked=false}else{l[d].childNodes[this.checkIndex].firstChild.checked=c}}}else{var g=this.getColIndex(h);if(g==-1){return false}for(var d=this._startrow;d<l.length;++d){if(l[d].style.display=="none"){l[d].childNodes[this.checkIndex].firstChild.checked=false}else{var n=l[d].childNodes[g];var j=n.getElementsByTagName("input");if(j!=null&&j.length==1){j[0].checked=c}}}}},_isChecked:function(c){return c.childNodes[this.checkIndex].firstChild.checked},getCheckedRows:function(g){var f=[];var d=this.tbody.childNodes;for(var c=this._startrow;c<d.length;++c){if(this._isChecked(d[c])){f.push(c-this._startrow)}}if(f.length==0&&g&&this.currow!=null){for(var c=this._startrow;c<d.length;++c){if(this.currow==d[c]){f.push(c-this._startrow);break}}}return f},getCheckedRows2:function(){return this.getCheckedRows(true)},getCheckedRowData:function(j){var h=[];var g=this.tbody.childNodes;for(var f=this._startrow;f<g.length;++f){if(this._isChecked(g[f])){h.push(this.getRowData(g[f]))}}if(h.length==0&&j){var c=this.getCurrentRowData();if(c!=null){h.push(c)}}return h},getCheckedRowData2:function(){return this.getCheckedRowData(true)},getKey:function(c){return c==null?null:c.getAttribute("key")},checkRow:function(c){if(!this.options.rowcheck){return}if(typeof c=="string"){var d=this._findByKey(c);if(d!=null){d.childNodes[this.checkIndex].firstChild.checked=true}}else{if(typeof c=="object"){var d=c;if(d.tagName=="TR"){d.childNodes[this.checkIndex].firstChild.checked=true}}}},_findByKey:function(d){var f=this.tbody.childNodes;for(var c=this._startrow;c<f.length;++c){if(f[c].getAttribute("key")==d){return f[c]}}return null},checkRows:function(d){if(d==null){return}var f=this.tbody.childNodes;for(var c=0;c<f.length;++c){if(scil.Utils.indexOf(d,f[c].getAttribute("key"))>=0){this.checkRow(f[c],true)}}},getCheckedKeys:function(h){var g=[];var f=this.tbody.childNodes;for(var c=this._startrow;c<f.length;++c){if(this._isChecked(f[c])){g.push(f[c].getAttribute("key"))}}if(g.length==0&&h){var d=this.getCurrentKey();if(d!=null){g.push(d)}}return g},getCheckedKeys2:function(){return this.getCheckedKeys(true)},getCurrentKey:function(){if(this.currow==null){return null}var c=this.currow.getAttribute("key");return c==""?null:c},clickRow:function(c){var d=c.srcElement||c.target;var d;if(d.tagName=="TR"){tr=d}else{if(d.tagName=="A"){return}else{tr=scil.Utils.getParent(d,"TR")}}if(tr!=null&&this.tbody!=tr.parentNode){tr=null}this.selectRow(tr)},selectFirstRow:function(){var c=this.tbody.childNodes[this._startrow];this.selectRow(c)},findRow:function(d){var f=this.tbody.childNodes;for(var c=this._startrow;c<f.length;++c){if(f[c].getAttribute("key")==d){return f[c]}}return null},selectRow:function(f){if(typeof(f)=="string"){f=this.findRow(f)}var c=scil.Utils.indexOf(this.tbody.childNodes,f);if(c<this._startrow){return}var d=this.currow;if(this.currow!=null){this.currow.style.backgroundColor=this.currow.getAttribute("bgcolor")}this.currow=f;if(this.currow!=null){this.currow.style.backgroundColor=scil.App.config.button}if(this.options.onselectrow!=null){this.options.onselectrow(this.currow,d)}},delRow:function(d){var f=this.tbody.childNodes;for(var c=0;c<f.length;++c){if(f[c].getAttribute("key")==d){this.tbody.removeChild(f[c]);if(this.options.onchange!=null){this.options.onchange(this)}this.dirty=true;return true}}return false},updateRow:function(f,c){var g=this.tbody.childNodes;for(var d=this._startrow;d<g.length;++d){if(g[d].getAttribute("key")==f){var j=g[d];if(c==null){c={}}c.rowchecked=this.options.rowcheck&&j.childNodes[this.checkIndex].firstChild.checked;var h=this.addRow(c,null,j);this.tbody.removeChild(j);if(this.currow==j){this.selectRow(h)}return true}}return false},setCellValue2:function(g,c,l){if(this.items[c]==null){return false}var j=null;if(typeof(g)=="number"){j=this.tbody.childNodes[this._startrow+g]}else{if(typeof(g)=="object"&&g.tagName=="TR"){j=g}else{var f=this.tbody.childNodes;for(var d=this._startrow;d<f.length;++d){if(f[d].getAttribute("key")==g){j=f[d];break}}}}if(j==null){return false}for(var d=0;d<j.childNodes.length;++d){var h=j.childNodes[d];if(h.getAttribute("__tid")==c&&h.field!=null){scil.Form.setFieldData(h.field,this.items[c],this.viewonly,l);return true}}return false},getCellValue2:function(g,c){if(this.items[c]==null){return null}var j=null;if(typeof(g)=="number"){j=this.tbody.childNodes[this._startrow+g]}else{var f=this.tbody.childNodes;for(var d=this._startrow;d<f.length;++d){if(f[d].getAttribute("key")==g){j=f[d];break}}}if(j==null){return null}for(var d=0;d<j.childNodes.length;++d){var h=j.childNodes[d];if(h.getAttribute("__tid")==c&&h.field!=null){return scil.Form.getFieldData(h.field)}}return null},_hilitRow:function(c,d){var g=c.target||c.srcElement;if(g.tagName!="TR"){g=scil.Utils.getParent(g,"TR")}if(g==null||g.getAttribute("sciltable")!="1"){return}if(d||g==this.currow){g.style.backgroundColor=scil.App.config.button}else{g.style.backgroundColor=g.getAttribute("bgcolor")}},groupExpandAll:function(c){var g=c.target||c.srcElement;var d=scil.Utils.endswith(g.src,"minus.gif");g.src=scil.Utils.imgSrc("img/"+(d?"plus":"minus")+".gif");this.groupExpandAll2(d)},groupExpandAll2:function(c){var d=this.tbody.childNodes[this._startrow];while(d!=null){d=this.groupExpand(d,c)}},groupExpand:function(l,c){var j=this.getCellValue(l,this.options.grouping);if(scil.Utils.isNullOrEmpty(j)){return null}var d=l.childNodes[this.groupIndex].firstChild;if(d.tagName!="IMG"){return null}if(c==null){c=scil.Utils.endswith(d.src,"minus.gif")}var g=0;while((l=l.nextSibling)!=null){var h=this.getCellValue(l,this.options.grouping);if(j!=h){break}++g;l.style.display=c?"none":""}d.src=scil.Utils.imgSrc("img/"+(c?(g>0?"plus":"plus0"):"minus")+".gif");return l},updateRowColor:function(){var f=this.tbody.childNodes;for(var d=this._startrow;d<f.length;++d){var c=null;if(JSDraw2.Skin.table.cell=="row"){c=d%2==0?JSDraw2.Skin.jssdf.oddcolor:JSDraw2.Skin.jssdf.evencolor}f[d].style.backgroundColor=c;f[d].setAttribute("bgcolor",c)}},addRow:function(E,t,d){if(E==null&&this.options.onAdd!=null){return null}if(this.options.onBeforeAddRow!=null){E=this.options.onBeforeAddRow(E)}var u=this;var f=null;if(JSDraw2.Skin.table.cell=="row"){f=this.tbody.childNodes.length%2==1?JSDraw2.Skin.jssdf.oddcolor:JSDraw2.Skin.jssdf.evencolor}var y=scil.Utils.createElement(null,"tr",null,{backgroundColor:f},{sciltable:"1",bgcolor:f});if(d==null){this.tbody.appendChild(y)}else{this.tbody.insertBefore(y,d)}dojo.connect(this.tbody.parentNode,"onmouseover",function(G){u._hilitRow(G,true)});dojo.connect(this.tbody.parentNode,"onmouseout",function(G){u._hilitRow(G,false)});var x=false;var C=scil.Utils.createElement(y,"td");if(this.options.grouping){var A=E==null?null:E[this.options.grouping];var B=this.getCellValue(y.previousSibling,this.options.grouping);if(scil.Utils.isNullOrEmpty(A)||A!=B){x=true;y.setAttribute("newgroup","1");var n=scil.Utils.createElement(C,"img",null,null,{title:"Expand/Collapse All",src:scil.Utils.imgSrc("img/minus.gif")});scil.connect(n,"onclick",function(G){u.groupExpand(y)})}}else{C.style.display="none"}var C=scil.Utils.createElement(y,"td");if(this.options.rowcheck){var w=this.options.rowcheck=="radio"?"__scil_table_"+this._tableid+"_radio":null;var h=this.options.rowcheck=="radio"?"radio":"checkbox";var g=scil.Utils.createElement(C,h,null,null,{name:w});g.checked=E==null?false:E.rowchecked;if(this.options.onrowcheck!=null){dojo.connect(g,"onchange",function(){u.options.onrowcheck(y,g.checked)})}if(h=="checkbox"){scil.connect(g,"onclick",function(G){u.checkedClick(G)})}}else{C.style.display="none"}if(E==null){y.setAttribute("isnew","1")}else{if(this.key!=null&&E[this.key]!=null){y.setAttribute("key",E[this.key])}}for(var l in this.items){var q=this.items[l];var C=scil.Utils.createElement(y,"td",null,q.styles,q.attributes);C.style.borderLeft=JSDraw2.Skin.jssdf.border;var F=this.viewonly||q.viewonly||t!=null&&t[l];var D=E==null?q.value:E[l];if(q.type=="hidden"||q.ishidden){C.style.display="none";if(q.type=="jsdraw"){D=null}}var z=false;if(q.renderTd!=null){z=q.renderTd(C,D,E,q)}if(!z&&!(F&&this.options.notshowifnovalue&&scil.Utils.isNullOrEmpty(D))){C.field=scil.Form.createField(C,q,F,D,E,true,true,this);if(F&&q.type!="img"){C.field.style.width="100%";if(q.maxwidth>0){C.field.style.maxWidth=q.maxwidth+"px";C.field.style.overflow="hidden";C.field.style.textOverflow="ellipsis";scil.connect(C,"onmouseenter",function(G){var I=(G.srcElement||G.target).firstChild;if(I!=null&&I.tagName=="DIV"){var H=null;if(I.offsetWidth<I.scrollWidth){H=scil.Utils.getInnerText(I)}I.title=H==null?"":H}})}}else{if(C.field.tagName=="INPUT"||C.field.tagName=="SELECT"||C.field.tagName=="TEXTAREA"){this._connectOnchange(C.field,q);if(q.addrowonenter&&d==null){C.field.focus()}}}}if(q.whitespace!=null){C.style.whiteSpace=q.whitespace}C.setAttribute("__tid",l);this.connectKeydown(C,q)}if(!this.viewonly&&t==null&&this.options.delrow!=false&&this.options.candel!=false){var C=scil.Utils.createElement(y,"td");C.style.borderLeft=JSDraw2.Skin.jssdf.border;if(!this.options.grouping||x){var c=scil.Utils.createElement(C,"img",null,null,{src:scil.Utils.imgSrc("img/del.gif"),title:scil.Lang.res("Delete")});dojo.connect(c,"onclick",function(){u.removeRow(this)})}}if(this.options.onAddRow!=null){this.options.onAddRow(y,E)}if(x&&this.options.grouplinestyle!=null){for(var j=0;j<y.childNodes.length;++j){y.childNodes[j].style.borderTop=this.options.grouplinestyle}}return y},checkedClick:function(d){var c=d.srcElement||d.target;if(!c.checked){return}if(d.shiftKey){var j=this.tbody.childNodes;var n=scil.Utils.indexOf(j,scil.Utils.getParent(this._lastcheck,"TR"));var g=scil.Utils.indexOf(j,scil.Utils.getParent(c,"TR"));if(l!=-1&&f!=-1){var l=Math.min(n,g);var f=Math.max(n,g);for(var h=l;h<=f;++h){if(j[h].style.display=="none"){j[h].childNodes[this.checkIndex].firstChild.checked=false}else{j[h].childNodes[this.checkIndex].firstChild.checked=true}}}}this._lastcheck=c},_connectOnchange:function(c,d){var f=this;dojo.connect(c,"onchange",function(g){f.onchange(g,d)})},setCellValue:function(g,d,h){for(var c=0;c<g.childNodes.length;++c){var f=g.childNodes[c];if(f.field!=null&&f.getAttribute("__tid")==d){scil.Form.setFieldData(f.field,this.items[d],this.viewonly,h);break}}},getCellValue:function(g,d){for(var c=0;c<g.childNodes.length;++c){var f=g.childNodes[c];if(f.field!=null&&f.getAttribute("__tid")==d){return scil.Form.getFieldData(f.field)}}return null},connectKeydown:function(f,c){if(this.viewonly||f.field==null||f.field.tagName!="INPUT"||!c.addrowonenter){return}var d=this;dojo.connect(f.field,"onkeydown",function(g){if(g.keyCode==13){var h=scil.Utils.getParent(f,"TR");if(typeof(c.addrowonenter)=="function"){c.addrowonenter(f,c,d)}if(d.tbody.childNodes[d.tbody.childNodes.length-1]==h){d.addRow()}}})},onchange:function(c,d){this.dirty=true;if(this.options.onchange!=null){this.options.onchange(this,c,d)}},removeRow:function(c){var d=this;scil.Utils.confirmYes("Delete this row?",function(){var g=scilligence.Utils.getParent(c,"TR");if(d.options.grouping){do{var f=g.nextSibling;g.parentNode.removeChild(g);g=f}while(g!=null&&g.getAttribute("newgroup")!="1")}else{g.parentNode.removeChild(g)}if(d.options.onchange!=null){d.options.onchange(this)}d.dirty=true})},selectColumns:function(d,c,f){scil.Table.selectColumns(this,d,c,f)},allColsForDownload:function(){return scil.Table.allColsForDownload(this)},showHideColumns:function(){var c=this;this.selectColumns("Show/Hide Columns",function(d){c.showHideColumns2(d)},function(d){return !d.ishidden})},showHideColumns2:function(c){for(var d in this.items){this.showColumn(d,c==null||d==""||this.hasCol(c,d))}var f=scil.Utils.array2str(c,",");if(!scil.Utils.isNullOrEmpty(this.options.hidecolumncookiekey)){scil.Utils.createCookie(this.options.hidecolumncookiekey+"_scil_table_hidecols",f,3650)}},hasCol:function(c,f){for(var d=0;d<c.length;++d){if(c[d].key==f){return true}}return false},_hideCookieCols:function(d){if(scil.Utils.isNullOrEmpty(this.options.hidecolumncookiekey)){return}var g=scil.Utils.readCookie(this.options.hidecolumncookiekey+"_scil_table_hidecols");if(scil.Utils.isNullOrEmpty(g)){return}var h=g.split(",");for(var f=0;f<h.length;++f){var c=d[h[f]];if(c!=null){d[h[f]].ishidden=true}}}});scil.apply(scil.Table,{kPushLeftWidth:5000,headerstyles:{whiteSpace:"nowrap",verticalAlign:"top",backgroundColor:"#d5d7d8"},allColsForDownload:function(h){var g=[];for(var f in h.items){if(!scil.Utils.isNullOrEmpty(f)&&h.items[f]!=null&&h.items[f].type!="hidden"){var d=h.items[f];g.push({key:f,caption:d.label,type:d.type,width:d.width})}}return g},selectColumns:function(q,d,c,f){if(q.selColDlg==null){var g={caption:{label:"Caption",width:400},key:{label:"Key",width:100,iskey:true}};var l=this;var h={table:{type:"table",columns:g,options:{rowcheck:true,viewonly:true}}};q.selColDlg=scil.Form.createDlgForm("Select Columns",h,{label:"OK",onclick:function(){l.selectColumns2(q)}},{hidelabel:true})}q.selColDlg.show(d);q.selColDlg.callback=c;var n=[];for(var j in q.items){if(q.items[j]!=null&&!scil.Utils.isNullOrEmpty(j)&&q.items[j].type!="hidden"){n.push({caption:q.items[j].label,key:j,rowchecked:f==null?null:f(q.items[j],j)})}}q.selColDlg.form.setData({table:n});q.selColDlg.moveCenter()},selectColumns2:function(j){var l=[];var n=j.selColDlg.form.fields.table.jsd;var h=n.getData(null,null,true);for(var f=0;f<h.length;++f){if(h[f].rowchecked==true){var g=h[f].key;var d=j.items[g];l.push({key:g,caption:d.label,type:d.type,width:d.width})}}if(j.selColDlg.callback!=null){j.selColDlg.callback(l)}j.selColDlg.hide()},create:function(g,h,d,l,f){if(typeof h=="string"){h=dojo.byId(h)}var c=scil.Utils.createElement(h,"div");var j=new scil.Table(l);j.render(c,d);if(f!=false&&g.load!=null){scil.onload(function(){g.load()})}return j},listPages:function(c,l,t,j){if(c==null){return}scil.Utils.removeAll(c);c.style.clear="left";c.style.display="";if(!(l>=1)||!(t>1)){c.style.display="none";return}--l;var q,f;if(t<=10){q=0;f=t}else{q=l-5;if(q<0){q=0}f=q+10;if(l<=5){++f}if(f>t){f=t}if(t-l>6){if(t>12&&l>=7){++q}if(f-q<9){q=f-9;if(q<0){q=0}}}else{q=t-11;if(q<0){q=0}}}var u=25;if(t>10){var h=Math.ceil(scil.Utils.log10(t));if(h>3){u=11*h}else{if(h>2){u=13*h}else{u=15*h}}}var d=this.createPage(c,scil.Lang.res("Previous"),l>0?l:null,j);d.style.padding="0 3px 0 3px";if(q>0){this.createPage(c,1,1,j,u);if(q>1){this.createPage(c,"...",null,j,u)}}for(var g=q;g<l;++g){this.createPage(c,g+1,g+1,j,u)}this.createPage(c,l+1,null,j,u,true);for(var g=l+1;g<f;++g){this.createPage(c,g+1,g+1,j,u)}if(f<t){if(f+1<t){this.createPage(c,"...",null,j,u)}this.createPage(c,t,t,j,u)}d=this.createPage(c,scil.Lang.res("Next"),l+1<t?l+2:null,j);d.style.padding="0 3px 0 3px";d.style["float"]="unset"},createPage:function(d,h,l,j,q,g){var c=null;var n={border:"1px solid #ccc",display:"table","float":"left",width:q==null?"":q+"px",textAlign:"center",margin:"1px",whitespace:"nowrap"};if(JSDraw2.Skin.kRoundish){n.borderRadius=JSDraw2.Skin.kBigRadius}if(l!=null){n.color="#333";n.background="";n.cursor="pointer";c=function(){j(l)}}else{if(g){n.color="#fff";n.background=scil.App.config.frame}else{n.color="#ccc";n.background=""}}var f=scil.Utils.createElement(d,"div",h,n,null,l==null?null:c);scil.Utils.unselectable(f);return f},rows2xml:function(g){if(g==null){return null}var h="<table>";for(var c=0;c<g.length;++c){var f=g[c];h+="<r>";for(var d in f){var j=f[d];if(!scil.Utils.isNullOrEmpty(j)){h+="<i n='"+scil.Utils.escXmlValue(d)+"'>"+scil.Utils.escXmlValue(j)+"</i>"}}h+="</r>"}h+="</table>";return h},xml2rows:function(w){var q=null;if(typeof w=="object"){q=w}else{if(typeof w=="string"){var f=scil.Utils.parseXml(w);if(f!=null){q=f.documentElement||f.firstElementChild}}}var d=[];try{if(q!=null&&q.getElementsByTagName==null){q=null}}catch(g){}if(q!=null){var u=q.getElementsByTagName("r");for(var h=0;h<u.length;++h){var t={};var c=u[h].getElementsByTagName("i");for(var l=0;l<c.length;++l){var g=c[l];var n=g.getAttribute("n");t[n]=g.text||g.textContent}d.push(t)}}return d}});scil.Table.Print=scil.extend(scil._base,{constructor:function(d,c){this.dlg=null;this.iframe=null;this.source=d;this.table=null;this.options=c==null?{}:c;this.createDlg()},showTable:function(){var c=this.iframe.contentWindow.document.body;var g=scil.clone(this.source.options);g.viewonly=true;this.table=new scil.Table(g);var d={};for(var f in this.source.items){d[f]=scil.clone(this.source.items[f])}this.table.render(c,d);var h=null;if(this.options.checkedonly){h=this.source.getCheckedRowData()}else{h=this.source.getData()}this.table.setData(h)},createDlg:function(){var d=this;var f=scil.Utils.createElement(null,"div");var g=scil.Utils.createElement(f,"div",null,{textAlign:"center",marginBottom:"5px"});scil.Utils.createButton(g,{label:"Print Table",onclick:function(){if(scil.Utils.isIE){d.iframe.contentWindow.document.execCommand("print",false,null)}else{d.iframe.contentWindow.print()}}});scil.Utils.createElement(g,"span","&nbsp;");scil.Utils.createButton(g,{label:"Hide Columns",type:"a",onclick:function(){d.table.showHideColumns()}});this.iframe=scil.Utils.createElement(f,"iframe",null,{border:"solid 1px gray",width:this.options.width>0?this.options.width:800,height:this.options.height>0?this.options.height:500},{frameBorder:0});scil.connect(this.iframe,"onload",function(){d.iframe.contentWindow.document.write("<html><body></body></html>");d.showTable()});var c=new scilligence.Dialog(this.options.title==null?"Print Preview":this.options,f);c.show();return c}});scil.Tree=scil.extend(scil._base,{constructor:function(g,f,h,c){this.container=g;this.options=f==null?{}:f;this.solo=h!=null?h:this.options.solo;this.dropdown=c!=null?c:this.options.dropdown;this.onAddItem=null;this.onSelectItem=null;this.onExpandItem=null;this.cur=null;this.margin=28;this.idname="id";var d=this;scil.Utils.removeAll(g)},clear:function(){scil.Utils.removeAll(this.container)},reloadCur:function(){if(this.cur==null){return}this.reload(this.cur)},reload:function(d){if(d==null){return false}d.removeAttribute("loaded");if(d.firstChild.nextSibling!=null){d.removeChild(d.firstChild.nextSibling)}if(!d.item.leaf){var c=this._expand(d);this.onExpand(c)}return true},getCurRoot:function(){return this.getRoot(this.cur)},getRoot:function(d){if(d==null){return null}var c=this.getParent(d);var f=d;while(c!=null){f=c;c=this.getParent(f)}return f},getParent:function(c){return c.parentNode==null||c.parentNode==this.container?null:c.parentNode.parentNode},add:function(t,h){if(h==null){return null}if(h.length!=null){for(var f=0;f<h.length;++f){this.add(t,h[f])}return null}if(h._more){h.leaf=true}if(this.options.onAddItem!=null){h=this.options.onAddItem(h)}else{if(this.onAddItem!=null){h=this.onAddItem(h)}}var q=null;if(t==null){q=scilligence.Utils.createElement(this.container,"div")}else{var d=t.firstChild.nextSibling;if(d==null){d=scil.Utils.createElement(t,"div",null,{marginLeft:this.margin+"px"})}q=scil.Utils.createElement(d,"div")}q.item=h;var c;if(h.leaf||h.disabled){if(h.leaf==2){c={src:scil.Utils.imgSrc("img/plus2.gif")}}else{c={src:scil.Utils.imgSrc("img/blank.gif")}}}else{c={src:scil.Utils.imgSrc("img/plus.gif"),title:"Expand"}}var j=scil.Utils.createElement(q,"div",null,{padding:scil.Tree.kPadding,whiteSpace:"nowrap"});var g=scil.Utils.createElement(j,"img",null,{width:"16px"},c);var l=this;dojo.connect(g,"onclick",function(n){l.onExpand(n.srcElement||n.target)});if(this.dropdown){scil.Utils.createElement(j,"img",null,null,{src:h.shortcut?"img/status_shortcut.gif":"img/status_"+(h.status==null||h.status==""?"open":h.status)+".gif"})}if(h.icon!=null){if(h.icon.indexOf("/")<0){h.icon="img/icons/"+h.icon+".gif"}scil.Utils.createElement(j,"img",null,{paddingRight:this.options.icongap},{src:h.icon})}var u=h.name;if(h.translate||h.translate!=false&&this.options.translate){u=scil.Lang.res(u)}scil.Utils.createElement(j,"span",h._more?"<u style='color:blue;cursor:pointer'>more...</u>":u,null,{title:h.tooltip||h.title});j.className="tbar";if(h.disabled){j.style.color="gray";j.setAttribute("disabled","on")}else{j.style.cursor="pointer";dojo.connect(j,"onclick",function(n){if((n.target||n.srcElement)!=j.firstChild){l.onclick(j.parentNode)}})}this.add(q,h.children);if(t!=null){this.expand(t,true)}if(h.expand==false){this.expand(q,false)}if(h.selected){this.select(q)}return q},onclick:function(node){if(node==null){return}if(node.item!=null&&node.item.onclick!=null){var onclick=node.item.onclick;if(typeof(onclick)=="string"){var fn=scil.Utils.eval("function(node){"+onclick+"}");if(fn(node)==true){this.select(node)}}else{if(node.item.onclick(node)==true){this.select(node)}}}else{this.select(node)}},expand:function(h,d){var c=h.firstChild;var g=c.firstChild;if(c.nextSibling==null){g.src="img/blank.gif";g.removeAttribute("title")}else{c.nextSibling.style.display=d?"":"none";this._expand(h,d)}},_expand:function(g,c){var d=g.firstChild.firstChild;d.src=scil.Utils.imgSrc(c?"img/minus.gif":"img/plus.gif");d.setAttribute("title",c?"Shrink":"Expand");return d},shrinkSiblings:function(f){var d=f.parentNode.childNodes;for(var c=0;c<d.length;++c){if(d[c]!=f){this.expand(d[c],false)}}},onExpand:function(g){if(g==null){return null}var c=g.parentNode;if(c.tagName!="DIV"||c.className!="tbar"){return}var d=null;var h=c.parentNode;if(h!=null&&h.item!=null&&h.item.leaf){return}if(this.options.url==null||h.getAttribute("loaded")=="1"||c.nextSibling!=null){d=c.nextSibling==null||c.nextSibling.style.display=="none";this.expand(h,d);if(d&&this.solo){this.shrinkSiblings(h)}return}if(this.onExpandItem!=null){if(this.onExpandItem(h,d)){return}}this.loadNodes(h)},afterAjaxCall:function(h,f,d,c){if(this.options.onAfterAjaxCall!=null){this.options.onAfterAjaxCall(h,c)}if(f.item._more){var g=f.parentNode;g.removeChild(f);f=g.parentNode}else{if(f.getAttribute("loaded")=="1"){if(d!=null){d(f)}return}f.setAttribute("loaded","1")}if(h.rows!=null&&h.rows.length>0){this.add(f,h.rows)}else{if(h.length>0){this.add(f,h)}}this.expand(f,true);if(d!=null){d(f)}},loadNodes:function(j,g){var h=this;if(j.item.children!=null){this.afterAjaxCall(j.item.children,j,g,null);return}var f=function(){j.firstChild.firstChild.src=scil.Utils.imgSrc("img/animatorsmall.gif")};var c=function(){j.firstChild.firstChild.src=scil.Utils.imgSrc("img/plus.gif")};var d=j.item;if(d._more){var l=this.getParent(j);d=scil.clone(l.item);scil.apply(d,j.item)}if(this.onAjaxData!=null){d=this.onAjaxData(j)}if(this.options.url!=null&&this.options.url!=""){scil.Utils.ajax(this.options.url,function(n){h.afterAjaxCall(n,j,g,d)},d,{popup:false,beforeload:f,afterload:c})}},select:function(d){if(typeof d=="string"){d=this.find(null,d)}if(d==null){return null}if(d.item!=null&&d.item.selectable==false){if(d.firstChild!=null){this.onExpand(d.firstChild.firstChild)}return}if(d.item!=null&&d.item._more){this.loadNodes(d);return}if(this.cur!=null){this.cur.firstChild.style.background=""}this.cur=d;if(this.dropdown&&this.cur!=null){this.cur.firstChild.style.background=scil.App.config.button}this.cur.firstChild.style.background=scil.App.config.button;if(this.onSelectItem!=null){var c=null;if(this.cur!=null){c=this.cur.firstChild.nextSibling==null}this.onSelectItem(this.cur,c)}},getIconText:function(d){if(d==null){return null}var c=d.firstChild.childNodes[2];if(c.tagName=="SPAN"){return c.innerHTML}return"<img src='"+c.src+"'>"+c.nextSibling.innerHTML},setCurrent:function(f,c){var d=this.find(null,f,c);if(d!=null){this.select(d)}return d},find:function(q,t,j){var g=q==null?this.container:q.firstChild.nextSibling;if(g==null){return null}if(j==null){j="id"}var f=g.childNodes;for(var h=0;h<f.length;++h){var l=f[h];if(l.item!=null&&l.item[j]==t){return l}var d=this.find(l,t,j);if(d!=null){return d}}return null},getChildren:function(d){var c=d==null?this.container:d.firstChild.nextSibling;return c==null?null:c.childNodes},getParent:function(c){return c.parentNode.parentNode}});scil.apply(scil.Tree,{kPadding:"3px 0 3px 0"});scil.DatePicker=scil.extend(scilligence._base,{constructor:function(c,f){if(typeof c=="string"){c=document.getElementById(c)}this.input=c;this.disablepopup=false;this.options=f==null?{}:f;var d=this;dojo.connect(c,"onclick",function(){scilligence.DatePicker.show(d)})},getFormat:function(){var c=scil.Utils.isNullOrEmpty(this.options.dateformat)?JSDraw2.defaultoptions.dateformat:this.options.dateformat;if(scil.Utils.isNullOrEmpty(c)){c="yyyy-mm-dd"}return c},formatDate:function(c){return scil.Utils.dateStr(c,true,this.getFormat())},show:function(){if(this.options.startdate=="today"){this.options.startdate=scil.Utils.today()}if(this.options.enddate=="today"){this.options.enddate=scil.Utils.today()}scilligence.DatePicker.show(this)},hide:function(){scilligence.DatePicker.hide()}});scilligence.apply(scilligence.DatePicker,{cellwidth:30,dropdown:null,area:null,title:null,dp:null,year:null,month:null,date:null,show:function(c){if(c.disablepopup){return}this.create();this.dp=c;this.date=this.setDate(c.input.value);this.year=this.date.getFullYear();this.month=this.date.getMonth()+1;this.loadMonth(this.year,this.month);var f=scil.Utils.getZindex(c.input);this.dropdown.style.zIndex=f==null?10:f+1;scil.DatePicker.dropdown.style.display="";var d=JsUtils.getOffset(c.input,true,true);scil.DatePicker.dropdown.style.left=d.x+"px";scil.DatePicker.dropdown.style.top=(d.y+c.input.offsetHeight)+"px"},setDate:function(d){var c=this.parseDate(d);return c==null?new Date():c},parseDate:function(c){if(c==null){return null}var d=c.split("-");if(d.length!=3){return null}if(d[2].length==4){if(d[0]==3){return scil.Utils.time(d[2]+"-"+d[0]+"-"+d[1])}return scil.Utils.time(d[2]+"-"+d[1]+"-"+d[0])}else{return scil.Utils.time(c)}},hide:function(){if(scilligence.DatePicker.dropdown!=null){scilligence.DatePicker.dropdown.style.display="none";if(this.dp!=null&&this.dp){this.dp.input.focus()}}this.dp=null},isDropdownVisible:function(){return scilligence.DatePicker.dropdown!=null&&scilligence.DatePicker.dropdown.style.display!="none"},clickOut:function(c){var f=c.srcElement||c.target;if(this.dp!=null&&f==this.dp.input){return}var d=JsUtils.getParent(f,"TBODY");if(d!=this.area&&d!=this.header){this.hide()}},create:function(){if(this.dropdown!=null){return}var f=this;dojo.connect(document,"onclick",function(j){f.clickOut(j)});var g=scil.Utils.createTable(document.body,0,1,{border:JSDraw2.Skin.dialog.border,backgroundColor:JSDraw2.Skin.dialog.bkcolor,textAlign:"center",display:"none",position:"absolute"});this.dropdown=g.parentNode;dojo.connect(this.dropdown,"onclick",function(j){f.select(j.srcElement||j.target)});var c=JsUtils.createElement(JsUtils.createElement(g,"tr"),"td",null,{padding:"5px"});this.area=scil.Utils.createTable(c,0,0,{backgroundColor:"#fff"});var d=JsUtils.createElement(JsUtils.createElement(this.area,"tr",null,{backgroundColor:"#ddd"}),"td",null,null,{colSpan:7});var h=JsUtils.createElement(this.area,"tr");JsUtils.createElement(h,"td","Su",{width:this.cellwidth,color:"gray"});JsUtils.createElement(h,"td","Mo",{width:this.cellwidth});JsUtils.createElement(h,"td","Tu",{width:this.cellwidth});JsUtils.createElement(h,"td","We",{width:this.cellwidth});JsUtils.createElement(h,"td","Th",{width:this.cellwidth});JsUtils.createElement(h,"td","Fr",{width:this.cellwidth});JsUtils.createElement(h,"td","Sa",{width:this.cellwidth,color:"gray"});this.header=scil.Utils.createTable(d,0,0,{width:"100%"});h=JsUtils.createElement(this.header,"tr");JsUtils.createElement(h,"td","&lt;",{cursor:"pointer",color:"blue",textDecoration:"none"},{title:JSDraw2.Language.res("Previous Month")});JsUtils.createElement(h,"td","&lt;&lt;",{cursor:"pointer",color:"blue",textDecoration:"none"},{colSpan:2,title:JSDraw2.Language.res("Previous Year")});this.title=JsUtils.createElement(h,"td",null,{textAlign:"center",fontWeight:"bold"});JsUtils.createElement(h,"td","&gt;&gt;",{cursor:"pointer",color:"blue",textDecoration:"none"},{colSpan:2,title:JSDraw2.Language.res("Next Year")});JsUtils.createElement(h,"td","&gt;",{cursor:"pointer",color:"blue",textDecoration:"none"},{title:JSDraw2.Language.res("Next Month")})},select:function(d){if(d.tagName!="TD"||d.style.cursor!="pointer"){return}if(d.innerHTML=="&lt;"||d.innerHTML=="<"){--this.month;if(this.month==0){--this.year;this.month=12}this.loadMonth(this.year,this.month)}else{if(d.innerHTML=="&gt;"||d.innerHTML==">"){++this.month;if(this.month==13){++this.year;this.month=1}this.loadMonth(this.year,this.month)}else{if(d.innerHTML=="&lt;&lt;"||d.innerHTML=="<<"){--this.year;this.loadMonth(this.year,this.month)}else{if(d.innerHTML=="&gt;&gt;"||d.innerHTML==">>"){++this.year;this.loadMonth(this.year,this.month)}else{var c=parseInt(d.innerHTML);this.dp.input.value=this.dp.formatDate(new Date(this.year,this.month-1,c));try{if(this.dp.input.onchange!=null){this.dp.input.onchange()}scil.Utils.fireEvent(this.dp.input,"change",false,true)}catch(d){}this.hide()}}}}},loadMonth:function(q,g){var l=this.area;for(var f=l.childNodes.length-1;f>=2;--f){l.removeChild(l.childNodes[f])}var c=new Date(q,g-1,1);var d=c.getDay();var j=new Date(g==12?q+1:q,g==12?0:g,1);var n=Math.round((j.getTime()-c.getTime())/1000/60/60/24);for(var f=0;f<d;++f){this.loadDay(null)}for(var f=0;f<n;++f){this.loadDay(f+1,this.makeDate(q,g,f+1))}var h=["January","February","March","April","May","June","July","August","September","October","November","December"];this.title.innerHTML=JSDraw2.Language.res(h[g-1])+", "+q},makeDate:function(g,f,c){var d=new Date(g,f-1,c);return d},loadDay:function(c,d){var g=this.area;var h=g.childNodes[g.childNodes.length-1];if(h.childNodes.length==7){h=JsUtils.createElement(g,"tr")}var f={};if(c!=null){f.cursor="pointer"}if(h.childNodes.length==0||h.childNodes.length==6){f.color="gray"}if(c==this.date.getDate()){f.textDecoration="underline";if(this.year==this.date.getFullYear()&&this.month==this.date.getMonth()+1){f.backgroundColor="yellow"}}if(d!=null&&(this.dp.options.startdate!=null&&d<this.dp.options.startdate||this.dp.options.enddate!=null&&d>this.dp.options.enddate)){f.color="#ccc";f.cursor=""}JsUtils.createElement(h,"td",c,f)}});scil.Dropdown=scilligence.extend(scil._base,{constructor:function(c,f){this.e=null;this.drop=null;this.selected=null;this.onselect=f;this.tree=null;var d=this;this.e=typeof(c)=="string"?document.getElementById(c):c;this.e.innerHTML="&nbsp;";dojo.style(this.e,{border:"solid 1px #7F9DB9",padding:"1px 5px 1px 5px",backgroundImage:scil.Utils.imgSrc("img/dropdown.gif",true),backgroundRepeat:"no-repeat",backgroundPosition:"right center"});dojo.connect(this.e,"onmousedown",function(h){d.show(true)});if(!JsUtils.isIE){var g=JsUtils.styleRect(this.e);if(g.width>0){this.e.style.width=(g.width-12)+"px"}}this.drop=JsUtils.createElement(document.body,"div",null,{display:"none",backgroundColor:"white",border:"solid 1px gray",position:"absolute",zIndex:999});dojo.connect(document.body,"onmousedown",function(h){var j=h.srcElement||h.target;if(d.drop.style.display!="none"&&j!=d.e&&!scilligence.Utils.isChildOf(j,d.drop)){d.show(false)}});dojo.connect(document.body,"onkeydown",function(h){if(h.keyCode==27){d.show(false)}});this.tree=new scilligence.Tree(this.drop,null,true,true);this.tree.onSelectItem=function(j,h){d.onSelectItem(j,h)}},onSelectItem:function(f,d){if(!d){if(f!=null){this.tree.expand(f,true);this.tree.shrinkSiblings(f)}return}var c=f.item.id;this.setValue(c,this.tree.getIconText(f));this.show(false);if(this.onselect!=null){this.onselect(this.selected)}},setValue:function(d,c){this.selected=d;this.e.innerHTML=c==null||c==""?"&nbsp;":c},getValue:function(){return this.selected},getItem:function(d){var f=this.drop.childNodes;for(var c=0;c<f.length;++c){if(f[c].getAttribute("key")==d){return f[c]}}return null},list:function(g,d,c){var j=this;if(d){this.tree.clear()}for(var h in g){var f=g[h];if(typeof f=="string"){g[h]={name:f,id:f,leaf:true}}}this.tree.add(null,g)},show:function(c){if(!c){if(this.drop.style.display!="none"){this.drop.style.display="none"}return}if(this.drop.style.display!=""){var h=scil.Utils.getZindex(this.e);if(!(h>0)){h=999}var d=JsUtils.getOffset(this.e);var g=scil.Utils.getScrollOffset(this.drop);dojo.style(this.drop,{zIndex:h+1,display:"",width:(this.e.offsetWidth-(JsUtils.isIE?0:2))+"px",left:(d.x+g.x-(JsUtils.isIE?1:0))+"px",top:(d.y+g.y+this.e.offsetHeight)+"px"})}}});scil.DropdownCheck=scil.extend(scil._base,{constructor:function(c,g,j){this.e=null;this.drop=null;this.disabledropdown=false;var d=null;if(g!=null){if(g.length>0){d=g}else{d=g.items;this.options=g}}if(this.options==null){this.options={}}var f=this;this.e=typeof(c)=="string"?document.getElementById(c):c;if(this.e.tagName!="INPUT"){this.e.innerHTML="&nbsp;"}dojo.connect(this.e,"onmousedown",function(l){f.show(true)});if(!JsUtils.isIE){var h=JsUtils.styleRect(this.e);if(h.width>0){this.e.style.width=(h.width-12)+"px"}}this.drop=JsUtils.createElement(document.body,"div",null,{display:"none",backgroundColor:"white",border:"solid 1px gray",position:"absolute",maxHeight:"300px",overflowY:"scroll",zIndex:999});dojo.connect(document.body,"onmousedown",function(l){var n=l.srcElement||l.target;if(f.drop.style.display!="none"&&n!=f.e&&n!=f.drop&&!scilligence.Utils.isChildOf(n,f.drop)){f.show(false)}});dojo.connect(document.body,"onkeydown",function(l){if(l.keyCode==27){f.show(false)}});if(j!=null){this.e.value=j}if(d!=null){this.updateList(d)}else{if(g.url!=null||g.listurl!=null){var f=this;scil.Utils.jsonp(g.url||g.listurl,function(l){f.updateList(l)})}}},showDropdown:function(){this.e.setAttribute("readOnly","readonly");dojo.style(this.e,{border:"solid 1px #7F9DB9",padding:"1px 5px 1px 5px",backgroundImage:scil.Utils.imgSrc("img/dropdown.gif",true),backgroundRepeat:"no-repeat",backgroundPosition:"right center"})},updateList:function(h){scil.Utils.removeAll(this.drop);if(h==null){return}var j=this;var t=this.parseValues(this.e.value);var l=JsUtils.createTable(this.drop,0,0,{width:"100%"});var d=h;if(h.length>0){d={};for(var f=0;f<h.length;++f){d[h[f]]=h[f]}}for(var g in d){var q=JsUtils.createElement(l,"tr");var n=JsUtils.createElement(q,"td",null,{width:"5%"});if(g=="-"){n.setAttribute("colSpan",2);JsUtils.createElement(n,"hr",null,{padding:0,marginTop:"2px",marginBottom:"2px"})}else{var c=JsUtils.createElement(n,"checkbox",null,null,{_key:scil.Utils.unescXmlValue(g)});if(t[g]){c.checked=true}dojo.connect(c,"onchange",function(){j.itemChecked()});JsUtils.createElement(q,"td",d[g],{width:"95%"})}}},parseValues:function(f){if(scil.Utils.isNullOrEmpty(f)){return{}}var g=f.split(",");var d={};for(var c=0;c<g.length;++c){d[g[c]]=true}return d},updateChecks:function(){var g=this.parseValues(this.e.value);var d=this.drop.getElementsByTagName("input");for(var c=0;c<d.length;++c){var f=d[c].getAttribute("_key");d[c].checked=g[f]==true}},itemChecked:function(){var g="";var d=this.drop.getElementsByTagName("input");for(var c=0;c<d.length;++c){if(d[c].checked){var f=d[c].getAttribute("_key");g+=(g==""?"":",")+f}}this.e.value=g},isFromDrop:function(c){return c!=null&&scil.Utils.isChildOf(c.srcElement||c.target,this.drop)},isDropdownVisible:function(){return this.drop!=null&&this.drop.style.display==""},hide:function(){this.show(false)},show:function(c){if(c==null){c=true}if(!c){if(this.drop.style.display!="none"){this.drop.style.display="none";if(this.options.onhide!=null){this.options.onhide(this)}}return}if(this.disabledropdown){return}this.showDropdown();if(this.drop.style.display!=""){var g=scil.Utils.getZindex(this.e);if(!(g>0)){g=999}var d=JsUtils.getOffset(this.e,true,true);dojo.style(this.drop,{zIndex:g+1,display:"",width:(this.e.offsetWidth-(JsUtils.isIE?0:2))+"px",left:(d.x+(JsUtils.isIE?1:0))+"px",top:(d.y+this.e.offsetHeight)+"px"})}this.updateChecks()}});scilligence.DropdownButton=scilligence.extend(scilligence._base,{constructor:function(c,g){this.auto=null;this.options=g==null?{}:g;var f=this;this.button=typeof(c)=="string"?document.getElementById(c):c;dojo.connect(this.button,"onclick",function(){f.show()});var h=this.options.dropdown==null?"&#9660;":this.options.dropdown;if(this.button.tagName=="TABLE"){var d=this.button.getElementsByTagName("TD");var j=d[d.length-1];scil.Utils.createElement(j,"span",h)}else{if(this.options.expandright){scil.Utils.createElement(this.button,"span",h,{fontSize:"70%"})}else{scil.Utils.createElement(this.button,"span",h,{fontSize:"70%"})}}},isVisible:function(){return this.auto!=null&&this.auto.style.display!="none"},show:function(){if(this.isVisible()){return}if(this.options.onshowdropdown!=null){if(this.options.onshowdropdown(this)=="cancel"){return}}this.show2()},show2:function(){if(this.auto==null){var d=this;var j=this.options.width;if(!(j>0)&&scil.Utils.isIE&&scil.Utils.isIE<=8){j=200}var f=scil.Utils.isFixedPosition(this.button)?"fixed":"absolute";var g={borderRadius:"1px",border:JSDraw2.Skin.dialog.border,backgroundColor:JSDraw2.Skin.dialog.bkcolor,display:"none",position:f,width:j,boxShadow:JSDraw2.Skin.menu.boxshadow};if(this.options.framecolor!=null){g.backgroundColor=this.options.framecolor}var h=scil.Utils.createTable(document.body,0,1,g);this.auto=h.parentNode;scil.Animation.makeExpandable(this.auto,null,"0px");var c=JsUtils.createElement(JsUtils.createElement(h,"tr"),"td",null,{padding:"5px"});this.area=scil.Utils.createElement(c,"div",null,{backgroundColor:"#fff"});dojo.connect(document.body,"onmousedown",function(l){var n=l.srcElement||l.target;if(n!=d.q&&!scil.Utils.isChildOf(n,d.auto)){d.clickout()}});this.list(this.options.items,this.options.form)}this.position();scil.Animation.expandY(this.auto,this.itemcount*30)},hide:function(){if(this.isVisible()){scil.Animation.expandY(this.auto,0)}},resetItems:function(c){this.options.items=c;this.auto=null},position:function(){var c=scil.Utils.getOffset(this.button,true,true);this.auto.style.position=c.fixedposition?"fixed":"absolute";var g=scil.Utils.getZindex(this.button)+1;var d,f;if(this.options.expandright){d=c.x+this.button.offsetWidth;f=c.y}else{d=c.x;f=c.y+this.button.offsetHeight}dojo.style(this.auto,{zIndex:g,display:"",x:0,y:0});scil.Utils.moveToScreen(d,f,this.auto)},list:function(g,c){if(g==null||g.length==0){return}if(this.auto.style.display!=""){this.position()}if(g.length==null){var j=[];for(var h in g){j.push({label:g[h],key:h})}g=j}this.itemcount=0;scil.Utils.removeAll(this.area);var l=this;for(var d=0;d<g.length;++d){var f=g[d];if(f=="-"&&(d==0||g[d-1]=="-"||d==g.length-1)||scil.Utils.isNullOrEmpty(f)){continue}++this.itemcount;f.form=c;this.createItem(f)}},createItem:function(f){if(f=="-"){var l={margin:0,padding:0,borderColor:scil.App.config==null?null:scil.App.config.frame};if(this.options.framecolor!=null){l.borderColor=this.options.framecolor}scil.Utils.createElement(this.area,"hr",null,l);return}if(typeof(f)=="string"){f={label:f}}if(f==null||f.type=="hidden"){return}var g=this.options.translate?scil.Lang.res(f.label):f.label;if(f.key==null&&g!=f.label){f.key=f.label}var c=scil.Utils.createElement(this.area,"div",null,{padding:"3px 10px 3px 10px",backgroundColor:f.bgcolor,paddingLeft:f.paddingleft==null?null:f.paddingleft,color:JSDraw2.Skin.menu.color,cursor:"pointer"},{url:f.url,key:f.key,bgcolor:f.bgcolor,title:f.tooltip||f.title});var d=c;if(f.items!=null&&f.items.length>0){var n=scil.Utils.createTable(c,0,0,{width:"100%"});var q=scil.Utils.createElement(n,"tr");d=scil.Utils.createElement(q,"td",null,{textAlign:"left"});scil.Utils.createElement(q,"td","&#9658;",{paddingLeft:"10px",textAlign:"right"})}var j=f.pinicon==null?"data:image/png;base64,R0lGODlhBwAJAIAAAP///wAAACH5BAEAAAAALAAAAAAHAAkAAAIHhI+py+1cAAA7":f.pinicon;scil.Utils.createElement(d,"img",null,null,{src:j});if(f.icon!=null){scil.Utils.createElement(d,"img",null,{marginRight:"5px"},{src:f.icon,width:f.imagewidth})}if(g!=null){scil.Utils.createElement(d,"span",g)}var h=this;if(f.items!=null&&f.items.length>0){f.expandright=true;f.dropdown="";f.framecolor=this.options.framecolor;new scil.DropdownButton(c,f)}else{if(f.key==null&&f.label!=null){f.key=f.label}dojo.connect(c,"onclick",function(t){if(f.onclick!=null){f.onclick(t,f)}h.click(t,c)})}dojo.connect(c,"onmouseover",function(t){h.mouseover(t,c)});dojo.connect(c,"onmouseout",function(t){h.mouseout(t,c)})},getItem:function(c){var d=c.srcElement||c.target;if(d.tagName!="DIV"){d=scil.Utils.getParent(d,"DIV")}return d},mouseover:function(d){var c=this.getItem(d);c.style.backgroundColor="#ddf";c.style.color=JSDraw2.Skin.menu.highlightcolor},mouseout:function(f){var d=this.getItem(f);var c=d.getAttribute("bgcolor");d.style.backgroundColor=scil.Utils.isNullOrEmpty(c)?"#fff":c;d.style.color=JSDraw2.Skin.menu.color},clickout:function(c){this.hide()},click:function(c){var f=this.getItem(c);var g=f.getAttribute("url");var d=f.getAttribute("key");if(this.options.callback!=null){this.options.callback(d==null||d==""?f.innerText||f.textContent:d,g,this)}else{if(this.options.onclick!=null){this.options.onclick(d==null||d==""?f.innerText||f.textContent:d,g,this)}else{if(g!=null){if(this.options.target==null){window.location=g}else{window.open(g,this.options.target)}}}}this.hide()}});scil.User={form:null,medlg:null,_timer:null,phonecarriers:["","AT&T","T-Mobile","Verizon","Sprint","XFinity","GoogleFi"],countrycodes:{"":"","+43":"Austria +43","+32":"Belgium +32","+55":"Brazil +55","+1":"Canada +1","+86":"China +86","+45":"Denmark +45","+358":"Finland +358","+33":"France +33","+49":"Germany +49","+299":"Greenland +299","+852":"Hong Kong +852","+91":"India +91","+353":"Ireland +353","+39":"Italy +39","+81":"Japan +81","+82":"Korea +82","+52":"Mexico +52","+64":"New Zealand +64","+47":"Norway +47","+48":"Poland +48","+351":"Portugal +351","+65":"Singapore +65","+34":"Spain +34","+268":"Swaziland +268","+46":"Sweden +46","+41":"Switzerland +41","+44":"UK +44","+1":"US +1"},backgroundimages:30,kMFADyas:30,kMFAOptions:{"":"",sms:"By SMS",email:"By Email"},kRememberDevice:true,backgrounditems:{},fields:{error:{type:"html",hidelabel:true,render:function(c){return"<div title='"+scil.Utils.escXmlValue(c)+"' style='width:200px;color:red;overflow:hidden;text-overflow:ellipsis;'>"+(c==null?"":c)+"</div>"},labelstyle:{background:"",border:"",verticalAlign:"middle"}},email:{label:"Email",width:200,style:{padding:"6px",textAlign:"left"},labelstyle:{background:"",border:"",verticalAlign:"middle"}},password:{label:"Password",emailfield:"email",type:"password",width:200,style:{padding:"6px",textAlign:"left",whiteSpace:"nowrap"},labelstyle:{background:"",border:"",verticalAlign:"middle"}},mfacode:{type:"hidden"}},viewButtons:null,onSetLoginData:null,onlogin:null,options:{kAjax:"ajax.ashx?cmd=",kCookieKey:"__scil_login_email",kMFACodeKey:"__scil_mfacode",loginpage:"Login.aspx",homepage:"Home.aspx",object:"user",timeout:0,roles:null,findpassword:true,logindlgdisabled:false,},getFields:function(){if(scil.OktaUI.enabled){scil.apply(this.fields.password,{type:"okta",width:120,onfinish:function(){scil.User.login()}})}else{if(scil.AzureUI.enabled){scil.apply(this.fields.password,{type:"azure",width:120,onfinish:function(){scil.User.login()}})}}return this.fields},changePassword:function(c){if(this.changePwdDlg==null){var d={currentpassword:{label:"Current Password",type:"password"},password:{label:"New Password",type:"password"},password2:{label:"Confirm Password",type:"password"}};var f=this;this.changePwdDlg=scil.Form.createDlgForm("Change Password",d,{label:"Save",onclick:function(){f.changePassword2()}})}this.changePwdDlg.show();this.changePwdDlg.callback=c},changePassword2:function(){var d=this;var c=this.changePwdDlg.form.getData();scil.Utils.ajax("ajax.ashx?cmd=user.changepassword",function(){d.changePwdDlg.hide();if(d.changePwdDlg.callback!=null){d.changePwdDlg.callback()}},c)},isAdmin:function(){var c=scil.App.config==null?null:scil.App.config.title;return c!=null&&scil[c]!=null&&scil[c].user!=null&&scil[c].user.isadmin},init:function(l,c,f,n,j){scil.ready(function(){var q=scil.byId("__scil_main");q.setAttribute("width","");q.setAttribute("align","center");scil.User.init2(l,c,f,n,j)});if(this.backgroundimages>0&&this.canusebackground()){var d=new Date();var g;var h=d.getFullYear()+"-"+(d.getMonth()+1)+"-"+d.getDate();if(this.backgrounditems[h]!=null){g=this.backgrounditems[h]}else{g=(d.getDate()%this.backgroundimages)+".jpg"}document.body.style.backgroundImage="url(background/"+g+")";document.body.style.backgroundSize="100%"}},canusebackground:function(){return true},getSavedEmail:function(){return JsUtils.readCookie(this.options.kCookieKey)},init2:function(h,c,d,n,g){if(typeof h=="string"){h=dojo.byId(h)}if(g!=null){scil.apply(this.options,g)}var f=this;var j=scil.Utils.createTable(h,0,0,{background:"rgba(255,255,255,0.9)",border:"solid 1px "+scil.App.config.frame,borderRadius:"5px",margin:"50px 0 0 0",boxShadow:JSDraw2.Skin.dialog.boxshadow});var l=scil.Utils.createElement(scil.Utils.createElement(j,"tr"),"td");scil.Utils.createElement(l,"img",null,{width:200,margin:"70px 70px 20px 70px"},{src:scil.App.imgBig(scil.App.config.logo)});l=scil.Utils.createElement(scil.Utils.createElement(j,"tr"),"td",null,{padding:"0 0 10px 0"});this.table=j.parentNode;this.form=new scil.Form({labelinbox:true});this.form.render(l,this.getFields(),{buttons:this.getLoginButtons(),align:"center",hidelabel:true});dojo.connect(this.form.fields.password,"onkeydown",function(q){if(q.keyCode==13&&f.form.fields.email.value!=""){f.login();q.preventDefault()}});this.setFormData(this.form);if(scil.OktaUI.enabled){this.form.fields.password.jsd.show()}else{scil.Animation.translateY(j.parentNode,500)}},setFormData:function(d){var c={email:JsUtils.readCookie(this.options.kCookieKey),mfacode:JsUtils.readCookie(this.options.kMFACodeKey),password:""};if(this.onSetLoginData!=null){this.onSetLoginData(c,d)}d.setData(c);if(c.email==null||c.email==""){d.fields.email.focus()}else{d.fields.password.focus()}},getLoginButtons:function(c){var f=this;var d=[{src:scil.App.imgSmall("key.png"),label:"Login",width:216,style:{padding:"8px"},onclick:function(){f.login(null)}}];if(this.options.findpassword){d.push({label:"<div style='font-size:80%;text-align:right;padding-top:8px'>Reset Password</div>",type:"a",onclick:function(){f.showFindpassword()}})}d.push({label:"<div style='font-size:60%;text-align:center;padding-top:20px'><img src='"+scil.App.imgBig("Scilligence.png")+"'/><br>Powered by Scilligence</div>",type:"a",url:"https://www.scilligence.com",target:"_blank"});if(this.onLoginButtons!=null){this.onLoginButtons(d)}return d},showFindpassword:function(){if(this.findpasswordDlg==null){var d=this;var c={email:{label:"Email",width:260}};this.findpasswordDlg=scil.Form.createDlgForm("Reset Password",c,{src:scil.App.imgSmall("email.png"),label:"Send Me Email",onclick:function(){d.findpassword()}})}this.findpasswordDlg.show()},showResetPassword:function(){if(this.resetpasswordDlg==null){var f=this;var c={email:{label:"Email",width:260},data:{type:"hidden"},password:{label:"Password",type:"password",width:260},password2:{label:"Confirm Password",type:"password",width:260}};this.resetpasswordDlg=scil.Form.createDlgForm("Reset Password",c,{src:scil.App.imgSmall("submit.png"),label:"Change Password",onclick:function(){f.resetPassword()}})}var h=window.location+"";var d=h.indexOf("?");h=h.substr(d+1);var g=h.indexOf(",");this.resetpasswordDlg.show();this.resetpasswordDlg.form.setData({email:h.substr(0,g),data:h.substr(g+1)})},findpassword:function(){var d=this;var c=this.findpasswordDlg.form.fields.email.value;if(c.length>0){scil.Utils.ajax(this.options.kAjax+"user.findpassword",function(f){d.findpasswordDlg.hide();alert("A verification email has been sent to your email box:\n\n"+c+"\n\nIt will lead you to set a new password.")},{email:c})}},resetPassword:function(){var c=this.resetpasswordDlg.form.getData();if(c.password!=c.password2){alert("Password not matches confirmed password");return}var d=this;scil.Utils.ajax(this.options.kAjax+"user.resetpassword",function(f){d.resetpasswordDlg.hide();scil.Utils.alert("Password is set successfully.");window.location=d.options.loginpage},c)},needLogin:function(c){if(c!=null&&c.errcode=="NeedLogin"){scil.Utils.alert("Your session has timed out. Please log in.");this.showLoginDlg();return true}return false},onAjax:function(){if(this.form==null){this.resetTimeout()}},resetTimeout:function(){if(this._timer!=null){clearTimeout(this._timer);this._timer=null}if(JSDraw2.defaultoptions.sessiontimeout>0){this._timer=setTimeout(function(){scil.User.timeout()},JSDraw2.defaultoptions.sessiontimeout*60*1000)}},timeout:function(){if(this._timer!=null){clearTimeout(this._timer);this._timer=null}this.showLoginDlg()},getEditFields:function(d){var c=this.getListFields(d?false:true);if(d){if(c.manager!=null){c.manager.type="html"}if(c.roles!=null){c.roles.type="html"}if(c.isadmin!=null){c.isadmin.viewonly=true}if(c.employeeno!=null){c.employeeno.viewonly=true}if(c.site!=null){c.site.viewonly=true;c.site.type=null}if(c.expiry!=null){c.expiry.viewonly=true}c.active=null;if(scil.pmf!=null){c.emailusername={label:"Email Username"};c.emailpassword={label:"Email Password",type:"password"}}}return c},getListFields:function(d){var c={userid:{label:"User ID",viewonly:true,width:100,iskey:true},email:{label:"Email",required:true,width:250},firstname:{label:"First Name",required:true,width:200},lastname:{label:"Last Name",required:true,width:200},phone:{label:"Mobile Phone",type:"number",isnumber:false,prefixes:this.countrycodes,width:150},employeeno:{label:"Employee No",width:200},manager:{label:"Manager",width:200,autosuggesturl:this.options.kAjax+"user.suggest"},site:{label:"Site",width:200,type:"select",items:scil.UserManager.sites},dept:{label:"Dept.",width:200,type:"select",items:scil.UserManager.departments},active:{label:"Active",type:"checkbox"},isadmin:{label:"Admin",type:"checkbox"},roles:this.options.roles==null?null:{label:"User Roles",type:"dropdowncheck",items:this.options.roles},expiry:{label:"Expiration",type:"date"}};if(d){c.passwordexpiration={label:"Password Expiration",type:"html",render:function(f){if(f==null){return""}if(f<=0){return"<span style='color:red'>Expired</span>"}return"<span style='color:"+(f<=10?"red":"")+"'>In "+f+" day(s)"}};c.password={label:"Password",width:150,type:"password",inTable:false};c.password2={label:"Confirm Password",width:150,type:"password",inTable:false}}if(this.onGetListFields!=null){this.onGetListFields(c)}return c},manageUsers:function(h,c,d){var g=this;var f=this.getListFields(true);scil.apply(f,d);f.userid=null;return new scil.EditableTable(h,f,"User",{category:c,onSave:function(j){return g.onSaveUser(j)}})},onSaveUser:function(c){if(c!=null&&c.password!=c.password2){scil.Utils.alert("Password not matched");return false}return true},showMe:function(){var c=this;scil.Utils.ajax(this.options.kAjax+this.options.object+".loadme",function(d){c.showMe2(d)})},showMe2:function(f){if(this.medlg==null){var d=this;var c=[{src:scil.App.imgSmall("submit.png"),label:"Save",onclick:function(){d.saveMe()}}];this.medlg=scil.Form.createDlgForm("Me",this.getEditFields(true),c)}if(this.onShowMe!=null){this.onShowMe(f)}this.medlg.show();this.medlg.form.setData(f)},saveMe:function(){var c=this.medlg.form.getData();if(c.password!=c.password2){scil.Utils.alert("Password not matched");return}if(this.onSaveMe!=null){this.onSaveMe(c)}var d=this;scil.Utils.ajax(this.options.kAjax+this.options.object+".saveme",function(f){d.medlg.hide()},c)},showUser:function(d){var c=this;scil.Utils.ajax(this.options.kAjax+this.options.object+".load",function(f){c.showUser2(f)},{userid:d})},showUser2:function(d){if(this.userdlg==null){var c=this;this.userdlg=scil.Form.createDlgForm("User",this.getEditFields(true),this.viewButtons,{viewonly:true})}if(this.onShowUser!=null){this.onShowUser(d)}this.userdlg.show();this.userdlg.form.setData(d)},showLicenseMsg:function(f,c){var g=null;var d="Please contact Scilligence Support (<a href='mailto:support@scilligence.com'>SUPPORT@SCILLIGENCE.COM</a>)";if(f<0){g="Your software license has expired. "+d+"."}else{g="Your software license has expired. "+d+" within ("+f+") "+(f<2?"day":"days")+" to prevent disruption of service."}scil.Utils.alert2(g,"License Expiration",c)},timeoutButton:function(c,d){c.disabled=true;c.style.color="gray";c.innerHTML=scil.Lang.res("Resend in ")+d+scil.Lang.res(" second(s)");if(--d<=0){c.style.color="green";c.disabled=false;c.innerHTML=scil.Lang.res("Resend")}else{setTimeout(function(){scil.User.timeoutButton(c,d)},1000)}},mfasendcode:function(d){var c=this.mfadlg.form.getData();scil.Utils.ajax(this.options.kAjax+this.options.object+".mfa.issuecode",function(g){var f=d.target||d.srcElement;scil.User.timeoutButton(f,scil.User.kMFADyas)},c)},mfaverify:function(g,c){if(this.mfadlg==null){var f=this;var d={userid:{type:"hidden"},mfasession:{type:"hidden"},method:{label:"Verify Method",type:"select",items:this.kMFAOptions,button:{label:"Send",onclick:function(h){f.mfasendcode(h)}}},mfacode:{label:"Code Recieved"}};if(scil.User.kRememberDevice){d.remember={type:"checkbox",str:"Remember this device"}}this.mfadlg=scil.Form.createDlgForm("MFA",d,{label:"Verify",onclick:function(){f.mfaverify2()}})}this.mfadlg.show();this.mfadlg.form.setData(g);this.mfadlg.callback=c},mfaverify2:function(){var d=this;var c=this.mfadlg.form.getData();if(scil.Utils.isNullOrEmpty(c.mfacode)){scil.Utils.alert("Please enter MFA code");return}scil.Utils.ajax(this.options.kAjax+this.options.object+".mfa.verify",function(f){d.mfadlg.hide();if(c.remember){var g=scil.Form.encryptpassword(f.mfacode);JsUtils.createCookie(d.options.kMFACodeKey,g,30)}if(d.mfadlg.callback!=null){d.mfadlg.callback(f.mfacode)}else{d.login(null,null,f.mfacode)}},c)},login:function(j,f,h){var d=null;if(this.form!=null){d=this.form}else{if(this.dlg!=null){d=this.dlg.form}else{return null}}var g=this;d.setFieldValue("error","");var c=d.getData();if(h!=null){c.mfacode=h}scil.Utils.ajax(this.options.kAjax+this.options.object+".login",function(l){if(l.mfaverify){g.mfaverify(l)}else{if(g.onAjaxCall!=null&&g.onAjaxCall(l,d)){return}g.login2(l,c)}},c,{showprogress:true,onError:function(l){if(g.form!=null){d.setFieldValue("error",l.error||l.message);scil.Animation.shake(g.table,function(){d.fields.password.focus()})}else{if(g.dlg!=null){d.setFieldValue("error",l.error||l.message);scil.Animation.shake(g.dlg.dialog,function(){d.fields.password.focus()})}}}})},login2:function(f,c){JsUtils.createCookie(this.options.kCookieKey,c.email,365);var d=this;if(f!=null&&f.passwordexpiration>0){scil.Utils.confirm("Your password is going to expire in "+f.passwordexpiration+" day(s).  Change it now?",function(g){if(g){d.changePassword(function(){d.login3()})}else{d.login3()}})}else{if(f!=null&&f.licexpdays!=null){this.showLicenseMsg(f.licexpdays,function(){d.login3()})}else{this.login3()}}},login3:function(){if(this.onlogin!=null){this.onlogin()}else{if(this.dlg!=null){this.dlg.hide()}else{var d=window.location+"";var c=d.indexOf("?");if(c>0){window.location=d.substr(c+1)}else{window.location=this.options.homepage}}}},logout:function(){var c=this;scil.Utils.confirmYes("Log out?",function(){scil.Utils.ajax(c.options.kAjax+c.options.object+".logout",function(){c.logout2()})})},logout2:function(){window.location=this.options.loginpage},showLogin:function(){window.location=this.options.loginpage},showLoginDlg:function(){if(this.options.logindlgdisabled){window.open(this.options.loginpage,"_blank");return true}if(this.form!=null){return}var c=scil.clone(this.fields);for(var d in c){c[d].labelstyle=null}if(this.dlg==null){this.dlg=scil.Form.createDlgForm("Login",c,this.getLoginButtons(true),{onenter:function(){scil.User.login(null)},labelinbox:true,hidelabel:true})}this.dlg.show();this.setFormData(this.dlg.form)},getAuthorName:function(){return null},getAuthorID:function(){return null}};scil.Login=scil.User;scil.UserManager={cmd:"user",sites:[],departments:[],projectcategories:[],tabs:null,categories:[{name:"Admin",category:"admin",leaf:true},{name:"Active",category:"active",leaf:true},{name:"Inactive",category:"inactive",leaf:true}],init:function(d){var f={caption:"Users",key:"category",name:"name",root:{selectable:true,name:"Users",icon:scil.App.imgSmall("categories.png"),expanded:true,children:this.categories}};this.page=new scil.Page(d,f);if(this.tabs==null){this.users=this.page.addForm(this.tableForm(),this.page.tree)}else{this.tabs=this.page.addTabs();this.users=this.tabs.addForm(this.tableForm(),this.page.tree);for(var c=0;c<this.tabs.length;++c){this.tabs.addForm(this.tabs[c])}}this.users.refresh()},refresh:function(c){this.users.refresh()},tableForm:function(){var c=this;this.buttons=["-",{src:"JSDraw/img/key.gif",title:"Show License",onclick:function(){c.showLicense()}},"-",{type:"input",key:"fullname",label:"Full Name",styles:{width:100},autosuggesturl:"ajax.ashx?cmd=user.suggestall",onenter:function(){c.refresh()}},{type:"input",key:"email",label:"Email",styles:{width:100},autosuggesturl:"ajax.ashx?cmd=user.suggestemail",onenter:function(){c.refresh()}},{type:"input",key:"manager",label:"Manager",styles:{width:100},autosuggesturl:"ajax.ashx?cmd=user.suggestall",onenter:function(){c.refresh()}},{type:"input",label:"Employee No",key:"employeeno",styles:{width:100},onenter:function(){c.refresh()}},{type:"select",key:"dept",label:"Dept.",items:scil.UserManager.departments,styles:{width:100},onchange:function(){c.refresh()}},{type:"select",label:"Site",key:"site",items:scil.UserManager.sites,styles:{width:100},onchange:function(){c.refresh()}},{type:"input",label:"Role",key:"role",styles:{width:100},onenter:function(){c.refresh()}},"-",{type:"select",key:"countperpage",label:"Count",items:["",10,25,50,100],onchange:function(){c.refresh()}}];return{caption:"Users",key:"userid",object:this.cmd,"import":true,importcaption:"Import Users",onimported:function(d){scil.Utils.alert(d)},buttons:this.buttons,columns:scil.User.getListFields(false),formcaption:"User",savedoc:false,pushleft:true,fields:scil.User.getListFields(true)}},showLicense:function(){scil.Utils.ajax("ajax.ashx?cmd=license.show",function(c){scil.Utils.alert(c)})}};scil.HomePage={q:null,options:null,columns:[],div:null,onloaded:null,init:function(c,f){var d=this;scil.ready(function(){d.init2(c,f)})},init2:function(j,q){if(typeof j=="string"){j=scil.byId(j)}this.options=q;this.div=j;if(this.options.quickstart!=null){this.showQuickstart(this.options.quickstart)}if(this.oninit!=null){this.oninit(this.options)}if(!this.options.notifications||this.notice!=null){this.notification=scil.Utils.createElement(j,"div",null,{display:"none",marginBottom:"15px",border:"solid 1px "+scil.App.config.frame,borderRadius:JSDraw2.Skin.kBorderRadius,background:"yellow",padding:"5px"})}var n=this;var u=scil.Utils.createTable(j,0,0);u.parentNode.setAttribute("align","center");var g=this.options.columns==null?0:this.options.columns.length;var h=g>1?(g*2-1):g;if(this.options.search!=null){var z=scil.Utils.createElement(u,"tr");var y=scil.Utils.createElement(z,"td",null,{padding:"20px"},{colSpan:h});var w=scil.Utils.createTable(y,0,0);w.parentNode.setAttribute("align","center");var B=scil.Utils.createElement(w,"tr");var x=scil.Utils.createElement(B,"td",null,{border:"solid 1px "+scil.App.config.line,borderRadius:JSDraw2.Skin.kBigRadius+" 0 0 "+JSDraw2.Skin.kBigRadius});this.q=scil.Utils.createElement(x,"input",null,{width:"300px",padding:"7px 10px 7px 10px",border:0});if(this.options.search.autosuggesturl!=null){this.q_auto=new scil.AutoComplete(this.q,this.options.search.autosuggesturl)}dojo.connect(this.q,"onkeyup",function(c){if(c.keyCode==13&&!n.q_auto.isVisible()){n.search()}});var x=scil.Utils.createElement(B,"td",null,{border:"solid 1px "+scil.App.config.line,borderLeft:0,borderRadius:"0 "+JSDraw2.Skin.kBigRadius+" "+JSDraw2.Skin.kBigRadius+" 0",padding:"0 10px 0 10px",background:scil.App.config.button});scil.Utils.createButton(x,{label:this.options.search.label,tagname:"span",type:"a",onclick:function(){n.search()}});B=scil.Utils.createElement(w,"tr");scil.Utils.createElement(B,"td",this.options.search.hints,{color:"#aaa"})}var A=scil.Utils.createElement(u,"tr");var B=scil.Utils.createElement(u,"tr");if(g>0){for(var l=0;l<this.options.columns.length;++l){var d=this.options.columns[l];if(l>0){scil.Utils.createElement(scil.Utils.createElement(A,"td"),"div",null,{width:20});scil.Utils.createElement(scil.Utils.createElement(B,"td"),"div",null,{width:20})}var t=d.padding==null?"5px":d.padding;var f=scil.Utils.createElement(A,"td",scil.Lang.res(d.caption),{width:d.width,padding:t,border:"solid 1px "+scil.App.config.frame,borderTopLeftRadius:JSDraw2.Skin.kBorderRadius,borderTopRightRadius:JSDraw2.Skin.kBorderRadius});var x=scil.Utils.createElement(B,"td",null,{width:d.width,padding:t,border:"solid 1px "+scil.App.config.frame,borderBottomLeftRadius:JSDraw2.Skin.kBorderRadius,borderBottomRightRadius:JSDraw2.Skin.kBorderRadius},{valign:"top"});this.columns[l]={caption:f,area:scil.Utils.createTable(x)}}}if(this.options.onloaded!=null){var z=scil.Utils.createElement(u,"tr");this.bottom=scil.Utils.createElement(z,"td",null,null,{colSpan:h})}this.load()},showQuickstart:function(g){if(scil.Utils.readCookie("__quickstart")=="hide"){return}var c=this.options.background;if(c==null){c="yellow"}var f=scil.Utils.createElement(this.div,"div",null,{textAlign:"center",marginTop:"30px",background:c,padding:"10px"});scil.Utils.createElement(f,"a",scil.Lang.res("Quick Start Manual"),null,{target:"_blank",href:g});scil.Utils.createElement(f,"span"," (");scil.Utils.createButton(f,{label:"Hide",type:"a",onclick:function(){scil.Utils.createCookie("__quickstart","hide");f.style.display="none"}});scil.Utils.createElement(f,"span",")")},search:function(){if(this.q.value==""){scil.Utils.alert("No input!");return}window.location=this.options.search.url+escape(this.q.value)},load:function(){if(this.options.columns==null||this.options.columns.length==0){if(this.options.onloaded!=null){this.options.onloaded(this.bottom)}return}var c=this;scil.Utils.ajax(this.options.ajaxurl,function(d){c.loadData(d);if(c.options.onloaded!=null){c.options.onloaded(c.bottom)}if(c.onloaded!=null){c.onloaded(c)}})},renderNotification:function(f){if(f.notifications!=null&&f.notifications.length>0||this.options.notice!=null){this.notification.style.display="";if(this.notice!=null){scil.Utils.createElement(this.notification,"div",this.notice,{textAlign:"center"})}if(f.notifications!=null&&f.notifications.length>0){var g=scil.Utils.createTable(this.notification);g.parentNode.setAttribute("align","center");for(var c=0;c<f.notifications.length;++c){var d=f.notifications[c];var j=scil.Utils.createElement(g,"tr");scil.Utils.createElement(j,"td",(c+1)+".");scil.Utils.createElement(j,"td",scil.Utils.isNullOrEmpty(d.category)?null:"["+d.category+"]");var h=scil.Utils.createElement(j,"td");if(scil.Utils.isNullOrEmpty(d.link)){h.innerHTML=d.text}else{scil.Utils.createElement(h,"a",d.text,null,{href:d.link})}}}}},loadData:function(t){var d=this.options.columns==null?0:this.options.columns.length;var f=d>1?(d*2-1):d;this.renderNotification(t);for(var h=0;h<d;++h){var c=this.options.columns[h];var g=this.columns[h];var n=t[c.section];if(n==null){n=c.items}if(c.onrendercolumn!=null){c.onrendercolumn(g,t,c)}if(n==null){continue}for(var q=0;q<n.length;++q){var l=n[q];var w=scil.Utils.createElement(g.area,"tr");if(c.render!=null){c.render(w,l);continue}var u=scil.Utils.createElement(w,"td");if(l.icon!=null){scil.Utils.createElement(u,"img",null,{paddingRight:"5px"},{src:l.icon})}if(l=="-"||l=="|"){scil.Utils.createElement(u,"hr",null,{margin:0})}else{if(l.onclick!=null){scil.Utils.createButton(u,l)}else{if(c.text==null&&c.id==null){scil.Utils.createElement(u,"a",l,null,{href:c.link+l})}else{scil.Utils.createElement(u,"a",l[c.text],null,{href:c.link+l[c.id]})}}}}if(c.lastline!=null){var w=scil.Utils.createElement(g.area,"tr");scil.Utils.createElement(scil.Utils.createElement(w,"td"),"div",c.lastline)}}}};scil.Popup=scil.extend(scil._base,{constructor:function(c,f){if(typeof(c)=="string"){this.a=scil.byId(c)}else{this.a=c}if(f==null){this.options={}}else{this.options=f}if(this.a!=null){var d=this;dojo.connect(this.a,"onmouseout",function(){scil.Popup.hide()});dojo.connect(this.a,"onmouseover",function(g){scil.Popup.show(d,g)})}scil.Popup.init()},getHtml:function(c){if(this.options.ongethtml2!=null){return this.options.ongethtml2(this,c)}if(this.options.html==null){if(this.options.ongethtml!=null){this.options.html=this.options.ongethtml(this)}}return this.options.html},getCaption:function(c){if(this.options.ongetcaption2!=null){return this.options.ongetcaption2(this,c)}return this.options.caption}});scil.apply(scil.Popup,{current:null,inited:null,show:function(g,d){this.hide();this.current=g;e=new scil.Popup.Event(d);var c=this.current.getCaption(d);var f=this.current.getHtml(d);if(scil.Utils.isNullOrEmpty(f)){this.hide();return}this.create();this.area.innerHTML="";this.title.innerHTML="";this.div.style.display="";this.title.innerHTML=c==null?"":c;this.area.innerHTML=f;if(e!=null){this.move(e)}},hide:function(){this.current=null;if(this.div!=null){this.title.innerHTML="";this.area.innerHTML="";this.div.style.display="none"}},move:function(c){if(this.current==null){return}if(this.div==null||this.div.style.display=="none"){return}var d=c.srcElement==null?c.target:c.srcElement;if(this.current.a==d||this.isChildOf(d,this.current.a)){this.moveto(c);return}if(this.isChildOf(d,this.div)){return}this.hide()},moveto:function(c){this.create();var f=this.scrollLeft();var g=this.scrollTop();var n=0;var l=0;if(document.all==null){n=window.innerWidth;l=window.innerHeight}else{n=document.documentElement.clientWidth;l=document.documentElement.clientHeight}var j=this.div.offsetWidth;var d=this.div.offsetHeight;var q=c.clientX+f+10;var t=c.clientY+g+20;if(q-f+j>n&&q-f-j>0){q-=j+15}if(t-g+d>l&&t-g-d>0){t-=d+25}this.div.style.left=q+"px";this.div.style.top=t+"px"},isChildOf:function(c,d){while(c!=null){if(c==d){return true}c=c.parentNode}return false},scrollLeft:function(c){return this.filterResults(window.pageXOffset?window.pageXOffset:0,document.documentElement?document.documentElement.scrollLeft:0,document.body?document.body.scrollLeft:0)},scrollTop:function(c){return this.filterResults(window.pageYOffset?window.pageYOffset:0,document.documentElement?document.documentElement.scrollTop:0,document.body?document.body.scrollTop:0)},filterResults:function(g,d,c){var f=g?g:0;if(d&&(!f||(f>d))){f=d}return c&&(!f||(f>c))?c:f},init:function(){if(this.inited==true){return}this.inited=true;dojo.connect(document,"onmousemove",function(c){scil.Popup.move(c)})},create:function(){if(this.div!=null){return}this.div=document.createElement("div");this.div.style.display="none";this.div.style.whiteSpace="nowrap";this.div.style.backgroundColor="white";this.div.style.borderStyle="solid";this.div.style.borderColor="#f0f0f0 #a0a0a0 #a0a0a0 #f0f0f0";this.div.style.borderWidth="2px";this.div.style.position="absolute";this.div.style.zIndex=scil.Utils.getMaxZindex();this.div.style.textAlign="left";document.body.appendChild(this.div);var c=document.createElement("div");c.style.border="1px solid highlight";c.style.padding="1px";this.div.appendChild(c);this.title=document.createElement("div");this.title.style.textAlign="center";this.title.style.border=JSDraw2.Skin.dialog.border;this.title.style.backgroundColor=JSDraw2.Skin.dialog.bkcolor;this.title.style.color="white";c.appendChild(this.title);this.area=document.createElement("div");this.area.style.padding="2px";this.area.style.backgroundColor="white";c.appendChild(this.area)}});scil.Popup.Event=scil.extend(scil._base,{constructor:function(c){this.clientX=c.clientX;this.clientY=c.clientY;this.srcElement=c.target||c.srcElement}});scil.Help={tree:null,searchbox:null,init:function(j,h,f,d){this.options=h==null?{}:h;this.options.editable=d;if(typeof(j)=="string"){j=scil.byId(j)}if(this.options.title!=null){scil.Utils.createElement(j,"h2",this.options.title,{margin:0,padding:"5px",background:"#aaf",borderBottom:"solid 1px blue"})}var g=this;var c=null;if(this.options.editable){c=[{label:"New",onclick:function(){g.edit(true)}}]}var l={caption:this.options.topmargin>0?null:"TOC",marginBottom:"2px",marginTop:this.options.topmargin>0?"17px":null,buttons:c,onrender:function(n){g.createToc(n)}};this.page=new scil.Page(j,l,{resizable:true,leftwidth:300});this.page.addForm({caption:"Contents",type:"custom",marginBottom:"2px",oncreate:function(n){g.createArea(n)}});if(f>0){this.display(f)}},createToc:function(d){var f=this;var c={url:this.options.url+"?cmd=help.list"};this.tree=new scil.Tree(scil.Utils.createElement(d,"div"),c);this.tree.onAddItem=function(g){return f.onAddItem(g)};this.tree.onSelectItem=function(h,g){return f.onSelectItem(h,g)};this.tree.cur=this.tree.add(null,{name:"Help",leaf:false});this.tree.reloadCur()},createArea:function(f){var d=this;this.searchdiv=scil.Utils.createElement(f,"div",null,{display:"none"});this.pages=scil.Utils.createElement(this.searchdiv,"div");var c=scil.Utils.createElement(this.searchdiv,"div");this.table=new scil.Table(true,false);this.table.render(c,{name:{type:"html",label:"Title",template:"<a href='javascript:scil.Help.display({{helpid}})'>{?}</a>"}});this.displayurl=scil.Utils.createElement(f,"div");this.displaydiv=scil.Utils.createElement(f,"div");this.caption=scil.Utils.createElement(this.displaydiv,"h2");this.detail=scil.Utils.createElement(this.displaydiv,"div");this.editdiv=scil.Utils.createElement(this.displaydiv,"div",null,{display:"none",paddingTop:"10px"});if(this.options.editable){scil.Utils.createElement(this.editdiv,"button","Edit",null,null,function(){d.edit()});scil.Utils.createElement(this.editdiv,"button","Delete",null,null,function(){d.del()})}},del:function(){if(this.detail.item==null){return}var c=this;scil.Utils.confirmYes("Delete this topic?",function(){scil.Utils.ajax(c.options.url+"?cmd=help.del",function(d){scil.Utils.alert("Deleted")},{helpid:c.detail.item.helpid})})},edit:function(g){var h=false;if(this.dlg==null){var j=this;var f={helpid:{type:"hidden"},category:{label:"Category",width:300},title:{label:"Title",width:800},body:{label:"Body",type:"htmltext",width:800,height:300}};var d={label:"Save",onclick:function(){j.save()}};this.dlg=scil.Form.createDlgForm("Editor",f,d);h=true}this.dlg.show();if(h&&this.options.tinymce){var c={};c.buttons=[{id:"insertimage",iconurl:scil.Utils.imgSrc("img/add.gif"),tooltips:"Insert Image",onclick:function(l){j.insertImage(l)}}];c.buttons1="bold,italic,underline,strikethrough,|,fontsizeselect,|,bullist,numlist,|,outdent,indent,|,jsdrawsymbolplugin,|,sub,sup,|,insertimage";scil.Richtext.initTinyMCE(this.dlg.form.fields.body,c)}if(g){this.dlg.form.setData({category:this.detail.item==null?"General":this.detail.item.category});if(!h&&this.options.tinymce){this.getEd().setContent("")}}else{this.dlg.form.setData(this.detail.item);if(!h&&this.options.tinymce){this.getEd().setContent(this.detail.item.body)}}},insertImage:function(c){var d=this;scil.Richtext.saveBookmark(c);scil.Utils.uploadFile("Insert Image","Choose a picture file:",this.options.url+"?cmd=help.uploadimage",function(g){var f="<img src='"+d.options.url+"?imageid="+g.imageid+"'>";scil.Richtext.restoreBookmark(c,f)})},getEd:function(){var c=this.dlg.form.fields.body.id;return tinymce.get(c)},save:function(){var d=this;var c=this.dlg.form.getData();if(this.options.tinymce){c.body=this.getEd().getContent()}scil.Utils.ajax(this.options.url+"?cmd=help.save",function(f){if(f.helpid>0){c.helpid=f.helpid}d.display2(c);d.dlg.hide()},c)},search:function(){var c=this;scil.Utils.jsonp(this.options.url+"?cmd=help.search",function(d){c.list(d)},{q:this.searchbox.value})},list:function(c){this.searchdiv.style.display="";scil.Table.listPages(this.pages,c.page,c.pages,function(d){me.loadPage(d)});this.table.setData(c.rows==null?c:c.rows);this.editdiv.style.display="none";this.display2(null)},onSelectItem:function(d,c){if(!c){return}this.display(d.item.helpid,true)},display:function(c,d){if(d){this.searchdiv.style.display="none"}if(c==null){return}var f=this;this.editdiv.style.display="";scil.Utils.jsonp(this.options.url+"?cmd=help.display",function(g){f.display2(g,c)},{helpid:c})},display2:function(f,c){if(c>0){var g=window.location+"";var d=g.indexOf("?");if(d>0){g=g.substr(0,d)}g+="?helpid="+c;this.displayurl.innerHTML="URL: <a href='"+g+"'>"+g+"</a>"}else{this.displayurl.innerHTML=""}this.caption.innerHTML=f==null?"":f.title;this.detail.innerHTML=f==null?"":f.body;this.detail.item=f},onAddItem:function(c){if(c.name==null&&c.category!=null){c.name=c.category}return c},onLoadNode:function(c){var d=0}};scil.Richtext={__id:0,__buttonid:0,fonts:null,fontsizes:null,kEdId:"__scil_form_richtext_ed",simplebuttons:"bold italic underline forecolor backcolor | alignleft aligncenter | numlist bullist outdent indent",defaultbuttons:"fullscreen | bold italic underline forecolor backcolor | alignleft aligncenter | numlist bullist outdent indent | fontselect fontsizeselect lineheightselect | subscript superscript",defaultplugins:"fullpage searchreplace autolink directionality visualblocks visualchars fullscreen image link media template codesample table charmap hr pagebreak nonbreaking anchor toc insertdatetime advlist lists textcolor wordcount imagetools contextmenu colorpicker textpattern code lineheight",kDatetimeFormats:["%H:%M:%S","%I:%M:%S %p","%Y-%m-%d","%D","%d%b%Y"],generateId:function(){return"__richtext_"+(++this.__id)},saveBookmark:function(c){if(tinymce.isIE){c.focus();c.oln_bookmark=c.selection.getBookmark()}},restoreBookmark:function(c,d){c.focus();if(tinymce.isIE){c.selection.moveToBookmark(c.oln_bookmark)}if(d!=null){c.execCommand("mceInsertContent",false,d)}},initTinyMCE:function(j,c){if(JsUtils.isAndroid&&JsUtils.isAndroid<3||JsUtils.isIpad&&JsUtils.isIpad<5){return null}if(c==null){c={}}var g;if(typeof(j)=="string"){g=j}else{if(j.id==null||j.id==""){j.id=this.generateId()}g=j.id}var l={selector:"#"+g};if(c.css!=null){l.conent_css=c.css}l.plugins=this.defaultplugins;if(c.fonts!=null){l.font_formats=c.fonts}else{if(this.fonts!=null){l.font_formats=this.fonts}}if(c.fontsizes!=null){l.fontsize_formats=c.fontsizes}else{if(this.fontsizes!=null){l.fontsize_formats=this.fontsizes}}l.insertdatetime_formats=this.kDatetimeFormats;if(c.buttons==null){c.buttons=[]}c.buttons.push({tooltips:"Insert Symbol",iconurl:scil.Utils.imgSrc("img/symbol.gif"),onclick:function(n){scil.Richtext.saveBookmark(n);JSDraw2.Symbol.show(true,function(q){JSDraw2.Symbol.hide();scil.Richtext.restoreBookmark(n,q)})}});if(c.mode==null||c.mode!="simple"){c.buttons.push({iconurl:scil.Utils.imgSrc("img/uploadimg.gif"),tooltips:"Import Picture, Word, Chemical File",onclick:function(n){scil.Richtext.importFile(n)}});c.buttons.push({iconurl:scil.Utils.imgSrc("img/benzene.gif"),tooltips:"Insert Structure",onclick:function(n){scil.Richtext.insertStructure(n)}});if(scil.Annotator!=null&&!scil.Annotator.disabled){c.buttons.push({tooltips:"Inline Annotate",iconurl:"img/comment.gif",onclick:function(n){scil.Annotator.edit(n)}})}}if(this.onaddbuttons!=null){this.onaddbuttons(c)}if(c.hidetoolbar){l.toolbar=false}else{var d=this.scanButtons(c.buttons);if(c.buttons1!=null){l.toolbar1=c.buttons1.replace("*",c.mode=="simple"?this.simplebuttons:this.defaultbuttons)+" "+d}else{l.toolbar1=(c.mode=="simple"?this.simplebuttons:this.defaultbuttons)+" "+d}if(c.buttons2!=null){l.toolbar2=this.scanButtons(c.buttons2)}if(c.buttons3!=null){l.toolbar3=this.scanButtons(c.buttons3)}if(c.buttons4!=null){l.toolbar4=this.scanButtons(c.buttons4)}}var h=this;l.setup=function(n){if(c.onsetup!=null){c.onsetup(n)}h.onSetup(n,c,c.onchange,c.oninit)};l.menubar=(c.mode=="full"||c.menubar==true)?true:false;l.statusbar=false;l.branding=false;l.width=c.width;l.height=c.height;l.readonly=c.readonly;if(c.autoresize){l.plugins+=" autoresize";l.autoresize_on_init=true;l.autoresize_bottom_margin=10;l.autoresize_min_height=c.autoresizemin>0?c.autoresizemin:100;if(c.autoresizemax>0){l.autoresize_max_height=c.autoresizemax}}if(c.ice){l.plugins="ice icesearchreplace "+l.plugins;l.ice={user:{name:"Unknown",id:0},preserveOnPaste:"p,a[href],i,em,b,span",deleteTag:"delete",insertTag:"insert"};if(c.trackingbuttons){l.toolbar1+=" ,|,iceacceptall,icerejectall,iceaccept,icereject"}}this.setLang(l);if(this.onbeforeinit!=null){this.onbeforeinit(l,c)}if(c.renderlater){l.selector=null;var f=new tinymce.Editor(g,l,tinymce.EditorManager);tinymce.EditorManager.add(f);return f}else{tinymce.init(l);return tinymce.get(g)}},formatChangeText:function(c,d,f){return scil.Lang.res((c||"Modified")+" by")+" "+d+" ["+scil.Utils.timeStr(f,true)+"]"},setTracking:function(c,d){if(d||d==null){c.execCommand("ice_enable")}else{c.execCommand("ice_disable")}},setLang:function(c){if(scil.Lang.language=="cn"){c.language="zh_CN"}},scanButtons:function(d){var g="";if(d==null){return g}for(var f=0;f<d.length;++f){var c=d[f];if(typeof(c)=="string"){g+=c;continue}if(c.id!=null){continue}c.id="rte"+(++this.__buttonid);if(g==""){g=" | "}else{g+=" "}g+=c.id}return g},onSetup:function(d,c,g,h){if(c.buttons!=null){for(var f=0;f<c.buttons.length;++f){this.addButton(d,c.buttons[f])}}if(c.buttons2!=null){for(var f=0;f<c.buttons2.length;++f){this.addButton(d,c.buttons2[f])}}if(c.buttons3!=null){for(var f=0;f<c.buttons3.length;++f){this.addButton(d,c.buttons3[f])}}if(c.buttons4!=null){for(var f=0;f<c.buttons4.length;++f){this.addButton(d,c.buttons4[f])}}d.on("BeforeSetContent",function(j){var l='<table id="__mce">';if(j!=null&&j.selection&&j.format=="html"&&scil.Utils.startswith(j.content,l)){j.content=j.content.substr(0,l.length-1)+" border='1' style='border-collapse:collapse;width:800px;'>"+j.content.substr(l.length)}});if(scil.Spell.enabled){d.on("contextmenu",function(l){var j=tinyMCE.activeEditor==null||tinyMCE.activeEditor.selection==null?null:tinyMCE.activeEditor.selection.getNode();if(scil.Spell.hasTypo(j)){return false}if(scil.Spell.contextmenu!=null){scil.Spell.contextmenu.hide()}})}d.on("paste",function(j){scil.Richtext.onPaste(d,j)});if(g!=null){d.on("change",function(){g(d)})}d.on("init",function(){if(scil.Spell.enabled){scil.Spell.connectRightClick(d)}if(h!=null){h(d)}});d.addMenuItem("importword",{text:scil.Lang.res("Import Word"),context:"file",onclick:function(){scil.Richtext.importWord(d)}});d.addMenuItem("exportword",{text:scil.Lang.res("Export Word"),context:"file",onclick:function(){scil.Richtext.exportWord(d)}})},importWord:function(c){scil.Utils.uploadFile("Import Word","Select a Word file",JSDrawServices.url+"?cmd=office.importword",function(d){c.setContent(d.html)})},exportWord:function(c){scil.Utils.post(JSDrawServices.url+"?cmd=office.exportword",{html:c.getContent()},"_blank")},addButton:function(d,c){if(c.items!=null){var g=[];for(var f=0;f<c.items.length;++f){g.push(this.addMenuItems(d,c.items[f],c,c.onclick,c.onclick2))}d.addButton(c.id,{type:"menubutton",icon:false,text:c.label||c.text||c.tooltips,title:c.title||c.tooltips,menu:g})}else{d.addButton(c.id,{title:c.title||c.tooltips,image:c.iconurl||c.image||c.img||c.src,context:c.context,onclick:function(){c.onclick(d,c)}})}},addMenuItems:function(d,f,c,g,h){if(g!=null){return{text:f,onclick:function(){g(f)}}}else{return{text:f,onclick:function(){h(d,c,f)}}}},onPaste:function(d,c){if(c==null||c.clipboardData==null||JSDrawServices==null||JSDrawServices.url==null){return}var g=c.clipboardData.getData("text/html");var n=c.clipboardData.getData("text/rtf");if(!scil.Utils.isNullOrEmpty(g)||!scil.Utils.isNullOrEmpty(g)){c.preventDefault();scil.Richtext.saveBookmark(d);scil.Utils.ajax(JSDrawServices.url+"?cmd=paste.cleanhtml",function(t){if(t!=null){scil.Richtext.restoreBookmark(d,JSDraw2.Base64.decode(t.html))}},{html:g,rtf:n});return}var q=c.clipboardData.getData("text/plain");if(!scil.Utils.isNullOrEmpty(q)){var l=new JSDraw2.Mol();l.setXml(q);if(!l.isEmpty()){scil.Utils.ajax(JSDrawServices.url+"?cmd=rte.uploadstructure",function(t){if(t!=null&&t.html!=null){scil.Richtext.restoreBookmark(d,JSDraw2.Base64.decode(t.html))}},{jsdraw:l.getXml()});c.preventDefault();return}}for(var h=0;h<c.clipboardData.items.length;h++){var j=c.clipboardData.items[h];var f=j==null?null:j.getAsFile();if(f==null||!scil.Utils.startswith(j.type,"image/")){continue}c.preventDefault();scil.Richtext.saveBookmark(d);scil.Richtext.postFile(JSDrawServices.url+"?cmd=paste.tohtmltag",function(t){if(t!=null){scil.Richtext.restoreBookmark(d,JSDraw2.Base64.decode(t.html))}},f);return}},showDlg:function(c){if(!this.createDlg(c.text)){this.dlg.show();tinyMCE.get(this.kEdId).setContent(c.text==null?"":c.text)}this.dlg.args=c},createDlg:function(f){if(this.dlg!=null){return false}var d=this;var c={ed:{type:"textarea",value:f,width:700,height:400}};this.dlg=scil.Form.createDlgForm("Richtext Editor",c,{label:"Save",src:scil.App.imgSmall("submit.png"),onclick:function(){d._onsave()}},{hidelabel:true});this.dlg.form.fields.ed.id=this.kEdId;this.initTinyMCE(this.dlg.form.fields.ed);return true},_onsave:function(){s=this.getHtml(tinyMCE.get(this.kEdId));this.dlg.hide();if(this.dlg.args.callback!=null){this.dlg.args.callback(s)}},postFile:function(g,c,d,f){if(d==null){return}if(f==null){f={}}var h=new XMLHttpRequest();h.upload.onprogress=function(j){var l=(j.loaded/j.total)*100;console.log("Uploaded"+l+"%")};h.onload=function(){if(h.status==200){var j=h.response;scil.Utils.ajaxCallback(j,c,f.onError,f.ignoresucceedcheck)}else{if(f.onError!=null){f.onError("Error")}}if(f.showprogress){scil.Progress.hide()}};h.onerror=function(){if(f.onError!=null){f.onError("Error")}if(f.showprogress){scil.Progress.hide()}};h.open("POST",g,true);h.setRequestHeader("Content-Type",d.type);if(f.showprogress){scil.Progress.show((f.caption==null?"Loading ...":f.caption),false,(f.message==null?"Communicating with the server ...":f.message),false)}h.send(d)},importFile:function(c){scil.Richtext.saveBookmark(c);scil.Utils.uploadFile("Import","Choose a file (Picture, Word, Chemical File):",JSDrawServices.url+"?cmd=rte.uploadimage",function(d){if(d!=null&&d.html!=null){scil.Richtext.restoreBookmark(c,JSDraw2.Base64.decode(d.html))}})},importWord:function(c){scil.Richtext.saveBookmark(c);scil.Utils.uploadFile("Import","Choose a Word file:",JSDrawServices.url+"?cmd=rte.uploadword",function(d){if(d!=null&&d.html!=null){scil.Richtext.restoreBookmark(c,JSDraw2.Base64.decode(d.html))}})},insertStructure:function(c){scil.Richtext.saveBookmark(c);var d=scil.Richtext.getStructure(c.selection.getNode());scil.Richtext.showStructure(d,c)},curveFitting:function(g,c,h){var f=this.getSelectTable(g);if(f==null){scil.Utils.alert("No table selected");return}var j=this;scil.Utils.ajax(JSDrawServices.url+"?cmd=rte.uploadcurve",function(d){if(d!=null&&d.html!=null){var l=scil.Utils.createElement(null,"span",JSDraw2.Base64.decode(d.html));var q=scil.Utils.createElement(null,"p",c+":");var n=f.table;if(n.tagName=="TBODY"){n=n.parentNode}n.parentNode.insertBefore(l.firstChild,n.nextSibling);n.parentNode.insertBefore(q,n.nextSibling)}},{data:f.data,fitmode:h})},getStructure:function(c){if(c==null||c.tagName!="IMG"){return null}var d=c.getAttribute("alt");if(scil.Utils.startswith(d,"JSDraw:[")&&scil.Utils.endswith(d,"]")){d=d.substr(8,d.length-9);if(d.substr(0,1)=="*"){d=d.substr(1)}return JSDraw2.Base64.decode(d)}return null},saveStructure:function(c){var d=c.getHtml();scil.Utils.ajax(JSDrawServices.url+"?cmd=rte.uploadstructure",function(f){if(f!=null&&f.html!=null){scil.Richtext.restoreBookmark(c.caller,JSDraw2.Base64.decode(f.html))}},{jsdraw:d})},showStructure:function(f,c){var d=JSDraw.showPopup("JSDraw Editor",c!=null?"Save":"Dismiss",c!=null?function(g){scil.Richtext.saveStructure(g)}:null);d.clear();d.caller=c;d.setHtml(f)},viewStructure:function(c){if(c.button!=2){return}var d=scil.Richtext.getStructure(c.srcElement||c.target);if(d!=null){var f=new scil.ContextMenu(["View Large Structure"],function(){scil.Richtext.showStructure(d)});f.show(c.clientX,c.clientY);c.preventDefault();tinymce.dom.Event.cancel(c)}},getHtml:function(c,d){if(c.dom!=null&&c.dom.doc!=null){this.updateCheckStatus(c.dom.doc.body)}var f=d==null?c.getContent():c.getContent({format:d});return this.getHtmlBody(f)},updateCheckStatus:function(g){var f=g==null?null:g.getElementsByTagName("input");if(f==null){return}for(var d=0;d<f.length;++d){var c=f[d];if(c.type=="checkbox"||c.type=="radio"){if(c.checked){c.setAttribute("checked","checked")}else{c.removeAttribute("checked")}}}},getHtmlBody:function(f){if(scil.Utils.startswith(f,"<!DOCTYPE")){var c=f.indexOf("<body>");if(c>0){c+=6}var d=f.lastIndexOf("</body>");if(d>0){f=scil.Utils.trim(f.substr(c,d-c))}}return f},removeBlankLines:function(d){var c=d.contentDocument.body;this.removeEmptyElements(c,"span");this.removeEmptyElements(c,"p")},removeEmptyElements:function(c,j){var g=c.getElementsByTagName(j);if(g==null){return}for(var d=0;d<g.length;++d){var f=g[d];var h=f.innerText||f.textContent;if((h==null||h==""||h.length==1&&h.charCodeAt(0)==65279)&&!this.hasImgChild(f)){f.parentNode.removeChild(f)}}},hasImgChild:function(d){if(d==null||d.childNodes==null||d.childNodes.length==0){return false}for(var c=0;c<d.childNodes.length;++c){if(d.childNodes[c].tagName=="IMG"){return true}if(this.hasImgChild(d.childNodes[c])){return true}}return false},removeSpaces:function(f){if(f==null||f.childNodes==null||f.childNodes.length==0){return}for(var c=f.childNodes.length-1;c>=0;--c){var d=f.childNodes[c];if(d.nodeName=="#text"&&scil.Utils.trim(d.innerText||d.textContent)==""){f.removeChild(d)}}},isEmptyElement:function(c){if(c==null){return true}c=c.replace(/&nbsp;/ig," ");c=scil.Utils.trim(c);return c.length==0},replaceWithHtml:function(g,d){if(g==null||d==null||d==""){return}var c=scil.Utils.createElement(null,"div",d);var h=g.parentNode;for(var f=0;f<c.childNodes.length;++f){h.insertBefore(c.childNodes[f],g)}h.removeChild(g)},cleanHtml:function(d){d.undoManager.add();scil.Spell.removeTypos(d);var f=scil.Richtext.getHtml(d);if(f==null||f==""){return""}var c=scil.Utils.createElement(null,"div");c.innerHTML=f;this.clearnHtml2(c);d.undoManager.add();d.setContent(c.innerHTML)},hasChildImg:function(c){var d=c.getElementsByTagName("img");return d!=null&&d.length>0},isTable:function(c){var d=c.tagName;return d=="TABLE"||d=="TBODY"||d=="TR"||d=="TD"||d=="TH"},clearnHtml2:function(c){if(c==null||c.style==null){return}if(c.tagName!=null&&c.tagName!="IMG"&&!this.isTable(c)&&!this.hasChildImg(c)&&(!this.isSectionTitle(this.nextElement(c))||!this.isSectionTitle(this.previousElement(c)))){var f=c.innerText||c.textContent;if(f==null||scil.Utils.trim(f).length==0){c.parentNode.removeChild(c);return}}if(c.className!="mceNonEditable"){}c.className="";c.style.padding="";c.style.overflow="";c.style.textIndent="";c.style.lineHeight="";c.style.letterSpacing="";c.style.fontSize="";c.style.fontFamily="";if(c.childNodes!=null){for(var d=c.childNodes.length-1;d>=0;--d){this.clearnHtml2(c.childNodes[d])}}},nextElement:function(c){do{c=c.nextSibling}while(c!=null&&c.tagName==null);return c},previousElement:function(c){do{c=c.previousSibling}while(c!=null&&c.tagName==null);return c},makeArgs:function(f,d){var c={title:d.tooltips,image:d.iconurl};c.onclick=function(){d.onclick(f)};return c},subscriptNumbers:function(g){if(g==null){return null}var f="";var c=g.match(/[0-9]+/);while(c!=null){var d=g.indexOf(c);f+=g.substr(0,d);f+="<sub>"+c+"</sub>";g=g.substr(d+(c+"").length);c=g.match(/[0-9]+/)}if(g!=null){f+=g}return f},insertTableFromRawData:function(c){var d=this;d.saveBookmark(c);var g=this.getSelectTable(c);if(g==null){var f=c.selection.getContent();g={data:this.html2table(f)}}scil.Utils.prompt2({caption:"Insert Table from Raw Data",message:"Please paste raw data below:",multiline:true,defaultvalue:g.data,height:400,callback:function(j){var h=d.raw2tablehtml(j,g.table);if(g.table==null){d.restoreBookmark(c,h)}}})},html2table:function(d,n){if(d==null||d==""){return""}var c=scil.Utils.createElement(null,"div",d);var t=c.getElementsByTagName("tr");if(t==null||t.length==0){return""}var j=[];for(var f=0;f<t.length;++f){var q=t[f].getElementsByTagName("td");var h=[];for(var g=0;g<q.length;++g){h.push(scil.Utils.getInnerText(q[g]))}j.push(h)}if(j.length==0){return""}var l="";for(var f=0;f<j.length;++f){var h=j[f];for(var g=0;g<h.length;++g){l+=(g>0?"\t":"")+h[g]}l+="\n"}return l},getSelectTable:function(d){var c=d.selection.getNode();var n=c==null?null:scil.Utils.getParent(c,"TABLE");if(n==null){return null}var t=n.getElementsByTagName("tr");if(t==null||t.length==0){return null}var j=[];for(var f=0;f<t.length;++f){var q=t[f].getElementsByTagName("td");var h=[];for(var g=0;g<q.length;++g){h.push(scil.Utils.getInnerText(q[g]))}j.push(h)}if(j.length==0){return null}var l="";for(var f=0;f<j.length;++f){var h=j[f];for(var g=0;g<h.length;++g){l+=(g>0?"\t":"")+h[g]}l+="\n"}return{data:l,table:n}},raw2tablehtml:function(j,q){if(j==null||j==""){return""}var l=j.split("\n");if(l.length==1&&j.indexOf("|")>0){l=j.split("|")}var h=[];for(var d=0;d<l.length;++d){j=scil.Utils.trim(l[d]);if(j==""){continue}var g=[];var n;if(j.indexOf("\t")>=0){n=j.split("\t")}else{if(j.indexOf(";")>=0){n=j.split(";")}else{if(j.indexOf(",")>=0){n=j.split(",")}else{if(j.indexOf(" ")>=0){n=j.split(" ")}else{n=[j]}}}}for(var f=0;f<n.length;++f){g.push(scil.Utils.trim(n[f]))}h.push(g)}if(h.length==0){return""}if(q!=null){if(q.firstChild.tagName=="TBODY"){q=q.firstChild}scil.Utils.removeAll(q);for(var d=0;d<h.length;++d){var g=h[d];var t=scil.Utils.createElement(q,"tr",null,{background:d%2==0?"#eee":""});for(var f=0;f<g.length;++f){scil.Utils.createElement(t,"td",g[f])}}return null}else{var c="<table cellspacing=0 cellpadding=2 border=1>";for(var d=0;d<h.length;++d){c+="<tr"+(d%2==0?" style='background:#eee'":"")+">";var g=h[d];for(var f=0;f<g.length;++f){c+="<td>"+scil.Utils.escXmlValue(g[f])+"</td>"}c+="</tr>"}c+="</table>";return c}}};scil.Spell={enabled:false,addButton:function(c,d,g){if(JSDraw2.defaultoptions.spell==false){return}var f=this;c.push({tooltips:"Spell Check",iconurl:d,onclick:function(h){f.removeTypos(h);var j=h.getContent();scil.Utils.ajax(g,function(l){if(l.errors>0){h.setContent(l.content)}},{sentence:j})}})},hasTypo:function(c){return c!=null&&c.tagName=="SPAN"&&c.className=="molenginespell-typo"},onSpellClick:function(d,c){var t=c.srcElement||c.target;if(!this.hasTypo(t)){return false}var h=[];var q=t.getAttribute("suggests");if(q!=null&&q!=""){var j=q.split(",");for(var f=0;f<j.length;++f){h.push({nottranslate:true,caption:j[f],key:j[f]})}}if(h.length>0){h.push("-")}h.push({caption:"Ignore",key:"@"});if(this.contextmenu==null){var l=this;this.contextmenu=new JSDraw2.ContextMenu(h,function(u,w){l.onMenu(d,u,w)})}var g=scil.byId(d.id+"_ifr");var n=scil.Utils.getOffset(g,false);this.contextmenu.show(c.clientX+n.x,c.clientY+n.y,t,h);return true},onMenu:function(d,f,c){d.undoManager.add();if(f!="@"&&f!=null&&typeof(f)!="undefined"){c.innerHTML=f}this.removeTypo(c)},removeTypos:function(d){var c=d.contentDocument.body;this.connectRightClick(d);var g=c.getElementsByTagName("span");if(g==null){return}for(var f=0;f<g.length;++f){this.removeTypo(g[f])}},removeTypo:function(c){if(c.className!="molenginespell-typo"){return}if(c.parentNode.childNodes.length==1){var d=scil.Utils.getInnerText(c);if(d!=null){c.parentNode.innerHTML=d}}else{c.className="";c.removeAttribute("suggests")}},connectRightClick:function(c){if(c.__onmousedown||c.contentDocument==null){return}c.__onmousedown=true;var d=this;scil.Utils.disableContextMenu();dojo.connect(c.contentDocument,"onclick",function(f){if(d.contextmenu!=null){d.contextmenu.hide()}});if(scil.Utils.isIE){dojo.connect(c.contentDocument,"onmouseup",function(f){if(f.button==2){d.onSpellClick(c,f)}});c.contentDocument.oncontextmenu=function(f){return false}}else{c.contentDocument.oncontextmenu=function(f){d.onSpellClick(c,f);return false}}}};scil.BarcodePrinter={dlg:null,onprinted:null,testprinterlink:true,options:{},init:function(c){if(c!=null){this.options=c}},show:function(c){this.show2(c)},show2:function(c){if(this.options.url==null){this.options.url="JSDraw/Service.aspx?cmd=barcode.print"}if(this.options.printers==null){this.options.printers=JSDraw2.bcprinters}if(c!=null&&typeof(c)=="string"){c={barcode:c}}this.create();this.dlg.show();this.args=c==null?{}:c;if(this.args.editable){this.dlg.form.fields.barcode.disabled=false;this.dlg.form.fields.epl.disabled=false}else{this.dlg.form.fields.barcode.disabled=true;this.dlg.form.fields.epl.disabled=true}this.dlg.form.setData(this.args)},edit:function(){this.dlg.form.fields.barcode.disabled=false;this.dlg.form.fields.epl.disabled=false},print:function(){this.print2()},print2:function(g){var d=this.dlg.form.getData();if(scil.Utils.isNullOrEmpty(d.printer)){scil.Utils.alert("Please select a printer");return}var c=this.args;if(c==null){c={}}var f=this;scil.apply(c,d);if(this.onprintdata!=null){this.onprintdata(c)}if(JsUtils.startswith(d.printer,"http://")||JsUtils.startswith(d.printer,"https://")||JsUtils.startswith(d.printer,"//")){if(g){window.open(d.printer,"_blank")}else{scil.Utils.ajax(d.printer,function(){if(f.onprinted!=null){f.onprinted(c)}scil.Utils.alert("Printed Successfully")},c)}}else{if(g){scil.Utils.post(this.options.url,c,"_blank")}else{scil.Utils.ajax(this.options.url,function(){if(f.onprinted!=null){f.onprinted(c)}scil.Utils.alert("Printed Successfully")},c)}}},testPrinter:function(){this.print2(true)},create:function(){if(this.dlg!=null){return}var d={printer:{label:"Select Printer",type:"select",options:this.options.printers},barcode:{label:"Barcode",width:500},epl:{label:"EPL/ZPL",type:"textarea",width:500,height:100},copies:{label:"Number of Copies",width:100}};var f=this;var c=[{src:scil.App.imgSmall("submit.png"),label:"Print",onclick:function(){f.print()}},{src:scil.App.imgSmall("edit.png"),label:"Edit",onclick:function(){f.edit()}}];if(this.testprinterlink!=false){c.push(" ");c.push({label:"Test Printer",type:"a",onclick:function(){f.testPrinter()}})}this.dlg=scil.Form.createDlgForm(scil.Lang.res("Print Barcode"),d,c)}};scil.Lang={token:"translate",key:"scil_lang",current:null,language:null,en:{},cn:{},add:function(d,f){if(d==null){return}var c=f==null?this.en:scil.Lang[f];if(c==null){scil.Lang[f]={}}scil.apply(c,d)},setLang:function(c,d){if(c==null||c==""){scil.Utils.createCookie(this.key,"",-1,true)}else{scil.Utils.createCookie(this.key,c,180,true)}if(d){window.location.reload()}},use:function(c){if(c==null){return}c=c.toLowerCase();if(c=="zh"){c="cn"}this.language=c;this.current=this[c];if(this.current==null){this.current=this.en;this.language=null}JSDraw2.Language.use(c)},res:function(g,d){if(scil.Utils.isNullOrEmpty(g)||typeof(g)!="string"){return g}if(d!=null){var c=this[d];return c==null||c[g]==null?g:c[g]}if(this.current==null){var d=scil.Utils.readCookie(this.key,true);if(d!=null&&d!=""){this.use(d)}if(this.current==null&&this.lang!=null){this.use(this.lang)}if(this.current==null){var d=window.navigator.userLanguage;if(d!=null&&d.length>2){this.use(d.substr(0,2))}if(this.current==null){this.current=this.en}}}var f=this.current==null?null:this.current[g];if(f==null||f==""){f=JSDraw2.Language.res(g)}return f},translate:function(d,g){if(g==null||tag==""){this.translate(d,"span")}else{var f=g.split(",");for(var c=0;c<f.length;++c){this.translate(d,f[c])}}},translate2:function(g,j){if(j==null||j==""){return}var f=(g==null?document:g).getElementsByTagName(j);if(f==null){return}for(var d=0;d<f.length;++d){var c=f[d];if(c.getAttribute(this.token)==null){continue}var h=this.reg(c.innerHTML);if(scil.Utils.isNullOrEmpty(h)){continue}c.innerHTML=h}}};scil.StickyMenu=scil.extend(scil._base,{constructor:function(c,f){this.options=f==null?{}:f;this.hasInner=typeof(window.innerWidth)=="number";this.hasElement=document.documentElement!=null&&document.documentElement.clientWidth;this.menu=typeof(c)=="string"?scil.byId(c):c;var d=scil.Utils.getOffset(this.menu);if(this.menu.style.position!="absolute"){scil.Utils.createElement(this.menu.parentNode,"div","&nbsp;",{left:d.left,top:d.top,width:this.menu.offsetWidth,height:this.menu.offsetHeight})}this.menu.style.position="absolute";this.menu.style.left=(this.options.left>0?this.options.left:d.x)+"px";this.menu.style.top=(this.options.top>0?this.options.top:d.y)+"px";this.menu.style.width=this.menu.offsetWidth+"px";this.menu.style.height=this.menu.offsetHeight+"px";this.init()},computeShifts:function(){this.shiftX=this.hasInner?pageXOffset:this.hasElement?document.documentElement.scrollLeft:document.body.scrollLeft;if(this.targetLeft>0){this.shiftX+=this.targetLeft}else{this.shiftX+=(this.hasElement?document.documentElement.clientWidth:this.hasInner?window.innerWidth-20:document.body.clientWidth)-this.targetRight-this.menu.offsetWidth}this.shiftY=this.hasInner?pageYOffset:this.hasElement?document.documentElement.scrollTop:document.body.scrollTop;if(this.targetTop>0){this.shiftY+=this.targetTop}else{this.shiftY+=(this.hasElement?document.documentElement.clientHeight:this.hasInner?window.innerHeight-20:document.body.clientHeight)-this.targetBottom-this.menu.offsetHeight}},moveMenu:function(){this.computeShifts();if(this.currentX!=this.shiftX||this.currentY!=this.shiftY){this.currentX=this.shiftX;this.currentY=this.shiftY;if(document.layers){this.menu.left=this.currentX;this.menu.top=this.currentY}else{this.menu.style.left=this.currentX+"px";this.menu.style.top=this.currentY+"px"}}this.menu.style.right="";this.menu.style.bottom=""},floatMenu:function(){this.moveMenu();var c=this;setTimeout(function(){c.floatMenu()},200)},supportsFixed:function(){var d=document.createElement("div");d.id="testingPositionFixed";d.style.position="fixed";d.style.top="0px";d.style.right="0px";document.body.appendChild(d);var c=1;if(typeof d.offsetTop=="number"&&d.offsetTop!=null&&d.offsetTop!="undefined"){c=parseInt(d.offsetTop)}if(c==0){return true}return false},init:function(){if(this.supportsFixed()){this.menu.style.position="fixed"}else{var d=document.layers?this.menu:this.menu.style;this.targetLeft=parseInt(d.left);this.targetTop=parseInt(d.top);this.targetRight=parseInt(d.right);this.targetBottom=parseInt(d.bottom);if(document.layers){menu.left=0;menu.top=0}var c=this;dojo.connect(window,"onscroll",function(f){c.moveMenu(f)});this.floatMenu()}}});scil.FilePreviewer={kEmbeddingFirst:false,options:{},show:function(c,d,f){new scil.FilePreviewer.Viewer(c,d,f)},playVideo:function(j,n,g,c,d){if(this.videoDlg==null){var l=this;var f=scil.Utils.createElement(null,"div");this.vDlg=new scilligence.Dialog("Play Video",f,{onhide:function(){l.vDlg.body.innerHTML=""}})}if(!(n>0)){n=800}if(!(g>0)){g=500}this.videos={list:j,callback:d,autoplay:c,w:n,h:g,i:0};this.playNextVideo()},playNextVideo:function(){var h=this.videos.list[this.videos.i++];if(h==null){if(this.videos.callback!=null){this.videos.callback()}return}var c="";if(this.videos.autoplay!=false){c="autoplay"}var d="<video id='jsdrawvideo' width='"+this.videos.w+"' height='"+this.videos.h+"' controls "+c+" controlsList='nodownload'>";d+="<source src='"+h.url+"' type='"+h.mimetype+"'>";d+="</video>";this.vDlg.show("Play "+this.videos.i+"/"+this.videos.list.length+" ["+h.filename+"]");this.vDlg.body.innerHTML=d;this.vDlg.moveCenter();var f=this;var g=this.vDlg.body.firstChild;scil.connect(g,"onended",function(){f.playNextVideo()})}};scil.FilePreviewer.Viewer=scil.extend(scil._base,{constructor:function(c,f,g){this.fileid=c;this.source=g;this.dlg=null;this.parent=null;this.preview=null;this.tbody=null;this.options=f==null?scil.FilePreviewer.options:f;if(c==null){this.show({pages:1})}else{var d=this;scil.Utils.ajax(this.options.url,function(h){if(h.base64!=null){d.showChem(h.filename,JSDraw2.Base64.decode(h.base64))}else{d.show(h)}},{id:c,source:g},{showprogress:true})}},showChem:function(f,c){var d=scil.Utils.getFileExt(f);JSDraw2.Editor.showPopup("Preview","Dismiss",null,{value:c,format:scil.Utils.isSpectraFile(d)?"jdx":"xml"})},show:function(d){this.ret=d;this.create();this.parent.style.width=this.options.width>0?this.options.width+"px":"850px";scil.Utils.removeAll(this.tbody);for(var c=0;c<d.pages;++c){var g=scil.Utils.createElement(this.tbody,"tr");var f=scil.Utils.createElement(g,"td",null,{borderTop:"solid 1px #eee"},{valign:"top"});if(d.pages>1){scil.Utils.createElement(f,"div",c+1,{padding:"5px",border:"solid 1px #eee"})}f=scil.Utils.createElement(g,"td",null,{borderTop:"solid 1px #eee"},{valign:"top"});scil.Utils.createElement(f,"div","page "+(c+1)+" to be loaded",{padding:"20px",textAlign:"center",color:"#ccc"})}this.loadPage(0);this.dlg.show()},scroll:function(f){var q=f;var t=f.srcElement;var n=100*t.scrollTop/(t.scrollHeight-t.clientHeight);var g=this.preview.clientHeight;var l=this.tbody.childNodes;for(var j=0;j<l.length;++j){var u=l[j].childNodes[0];var c=u.offsetTop-this.preview.scrollTop;if(c>=0&&c<=g){this.loadPage(j-1);this.loadPage(j);this.loadPage(j+1);break}}},loadPage:function(q){var t=this.tbody.childNodes[q].childNodes[0];if(t.getAttribute("loaded")=="1"){return}t.setAttribute("loaded",1);var u;if(scil.Utils.startswith(this.options.previewurl,"data:")){u=this.options.previewurl}else{u=this.options.previewurl.replace("{fileid}",this.fileid).replace("{source}",this.source);if(u.indexOf("{page}")>0){u=u.replace("{page}",q)}else{u+=(u.indexOf("?")>0?"&":"?")+"page="+q}}t.nextSibling.innerHTML="<img style='max-width:100%' src='"+u+"'>";var l=this.ret.embeddedfiles;if(l==null||l.length==0){return}var j=[];for(var h=0;h<l.length;++h){var g=l[h];if(l[h].page==q+1){j.push({label:l[h].filename,key:this.fileid+"/"+g.page+":"+g.index+":"+g.filename})}}if(j.length>0){var n=this;var f={label:"[...]",type:"a",items:j,callback:function(c){n.loadChildPage(c)}};scil.Utils.createButton(t,f)}},loadChildPage:function(c){scil.FilePreviewer.show(c,{url:+this.options.url,previewurl:this.options.previewurl})},viewFull:function(){window.open(this.url,"_blank")},create:function(){if(this.dlg!=null){return}this.parent=scil.Utils.createElement(null,"div",null,{width:850,textAlign:"center",whiteSpace:"nowrap"});var f=null;if(scil.FilePreviewer.kEmbeddingFirst){f=scil.Utils.createElement(this.parent,"div");this.preview=scil.Utils.createElement(this.parent,"div")}else{this.preview=scil.Utils.createElement(this.parent,"div");f=scil.Utils.createElement(this.parent,"div")}var g=this;var c=dojo.window.getBox();scil.apply(this.preview.style,{height:(c.h-120)+"px",overflowY:"auto",border:"solid 1px #eee"});scil.connect(this.preview,"onscroll",function(d){g.scroll(d)});this.tbody=scil.Utils.createTable(this.preview,0,0);this.dlg=new scil.Dialog("File Previewer",this.parent)}});scil.App={kCart:"__scil_cart",othermenus:[],apps:[],app:{icon:"./favicon.ico",url:"Home.aspx"},iconsize:40,kCopyrightYear:2020,kSupport:"support@scilligence.com",menugroup:null,oninitmenu:null,kMessageSite:null,usermenuitems:[{label:"Show Me",onclick:function(){scil.Login.showMe()}},{label:"Change Password",onclick:function(){scil.Login.changePassword()}},"-",{label:"Logout",onclick:function(){scil.Login.logout()}}],imgSmall:function(c,f){var d="small/"+c;if(f){d="url("+d+")"}return d},imgBig:function(c){return"icon/"+c},about:function(){if(scil.App.aboutDlg==null){var c=scil.App.config;var d="<table cellspacing=0 cellpadding=0 style='background:#fff;margin:30px;color:gray;font-size:80%'><tr><td colspan=3 align=center><a target='_blank' href='"+c.link+"'><img style='width:200px;margin:50px 90px 0 90px;' border=0 src='"+scil.App.imgBig(c.logo)+"'></a><div style='font-size: 160%;color:gray;margin-bottom:50px'>Version "+JSDraw2.version+"</div></td><tr><tr><td>&copy;"+scil.App.kCopyrightYear+" Scilligence</td><td align=right><a target='_blank' href='http://www.scilligence.com/'>About Us</a></td> <td align=right><a target='_blank'' href='https://www.scilligence.com/web/contact-scilligence/'>Contact Us</a></td> </tr></table>";scil.App.aboutDlg=new JsDialog("About "+c.title,d,{bodystyle:{padding:0}})}scil.App.aboutDlg.show()},betaDisclaimer:function(){scil.Utils.alert2("<div style='width:500px'>"+scil.Lang.res("This is a pre-release Beta test version, which might contain some bugs not captured by our QA.")+"</div>","Beta Declaimer")},applications:{pmf:{app:"P",title:"PMF",logo:"logo-pmf.png",text:"#fff",frame:"rgb(98,62,164)",line:"#999",button:"rgba(98,62,164,0.2)",background:"#8174b5",link:"http://www.scilligence.com/scilligence-pmf"},eln:{app:"E",title:"ELN",logo:"logo-eln.png",text:"#fff",frame:"rgb(59,104,155)",line:"#999",button:"rgba(59,104,155,0.2)",background:"#6666cc",help:"ScilligenceELN.pdf",link:"http://www.scilligence.com/scilligence-eln"},regmol:{app:"R",title:"RegMol",logo:"logo-regmol.png",text:"#fff",frame:"rgb(16,97,98)",line:"#999",button:"rgba(16,97,98,0.2)",background:"#52a3db",help:"RegMol.pdf",link:"http://www.scilligence.com/scilligence-regmol"},inventory:{app:"I",title:"Inventory",logo:"logo-inventory.png",text:"#fff",frame:"rgb(27,81,62)",line:"#999",button:"rgba(27,81,62,0.2)",background:"#6abb67",help:"ScilligenceInventory.pdf",link:"http://www.scilligence.com/scilligence-inventory"},sdms:{app:"S",title:"SDMS",logo:"logo-sdms.png",text:"#fff",frame:"rgb(170,33,43)",line:"#999",button:"rgba(170,33,43,0.2)",background:"#e35521",link:"http://www.scilligence.com/scilligence-sdms"},qmas:{app:"Q",title:"QMS",logo:"logo-qms.png",text:"#fff",frame:"rgb(59,104,155)",line:"#999",button:"rgba(49,104,166,0.2)",background:"#aaaa55",link:"http://www.scilligence.com"},qms:{app:"Q",title:"QMS",logo:"logo-qms.png",text:"#fff",frame:"rgb(59,104,155)",line:"#999",button:"rgba(49,104,166,0.2)",background:"#aaaa55",link:"http://www.scilligence.com/scilligence-qms"},lims:{app:"L",title:"LIMS",logo:"logo-lims.png",text:"#fff",frame:"rgb(75,103,42)",line:"#999",button:"rgba(75,103,42,0.2)",background:"#6666cc",link:"http://www.scilligence.com/scilligence-lims"},focus:{app:"F",title:"Focus",logo:"logo-focus.png",text:"#fff",frame:"rgb(133,38,120)",line:"#999",button:"rgba(133,38,120,0.2)",background:"#05CF05",link:"http://www.scilligence.com/scilligence-focus"},bioassay:{app:"B",title:"BioAssay",logo:"logo-BioAssay.png",text:"#fff",frame:"rgb(59,104,155)",line:"#999",button:"rgba(49,104,166,0.2)",background:"#05CF05",link:"http://www.scilligence.com/scilligence-bioassay"},chrawler:{app:"C",title:"Chrawler",logo:"logo-Chrawler.png",text:"#fff",frame:"rgb(59,104,155)",line:"#999",button:"rgba(49,104,166,0.2)",background:"#00b3b3",link:"http://www.scilligence.com/scilligence-chrawler"},clinical:{app:"C",title:"Clinical",logo:"logo-Clinical.png",text:"#fff",frame:"rgb(59,104,155)",line:"#999",button:"rgba(49,104,166,0.2)",background:"#00b3b3",link:"http://www.scilligence.com"},monomerorg:{app:"M",title:"Monomer.org",logo:"logo-Monomerorg.png",text:"#fff",frame:"rgb(54,77,161)",line:"#999",button:"rgba(54,77,161,0.2)",background:"#cc9900",link:"http://www.monomer.org"},cds2:{app:"R",title:"RDS",logo:"logo-cds2.png",text:"#fff",frame:"rgb(24,97,98)",line:"#999",button:"rgba(24,97,98,0.2)",background:"#06BDF9",link:"http://www.scilligence.com"},rds:{app:"R",title:"RDS",logo:"logo-rds.png",text:"#fff",frame:"rgb(24,97,98)",line:"#999",button:"rgba(24,97,98,0.2)",background:"#06BDF9",link:"http://www.scilligence.com"}},setColors:function(){if(this.config==null){return}scil.Tabs.kHighlightColor=this.config.frame;scil.Tabs.kBorderStyle="solid 1px "+this.config.line;scil.Page.ExplorerForm.kHeaderStyle.background=this.config.frame;document.body.style.color=this.config.color;JSDraw2.Skin.form.fieldcolor=this.config.color;JSDraw2.Skin.dialog.bkcolor=this.config.frame;JSDraw2.Skin.menu.color=this.config.frame;JSDraw2.Skin.dialog.border="1px solid "+this.config.line;var d=scil.byId("__scil_bottomline");if(d!=null){d.style.color=this.config.line;d.style.borderTopColor=this.config.line;var f=d.getElementsByTagName("A");for(var c=0;c<f.length;++c){f[c].style.color=this.config.frame}}},init:function(f,t,c,y,z){if(this.config!=null){return}this.version=z;var u=scil.byId("__scil_toolbar");this.skin=u==null?null:u.getAttribute("skin");this.config=this.skin=="5.1"?this.applications[f]:null;var j=this.config==null?null:this.config.text;if(u!=null){u.style.boxShadow="rgba(0, 0, 0, 0.2) 1px 1px 4px 2px"}var w=scil.byId("__scil_toolbar_app");this.initAppButton(w);this.setColors();if(this.oninitmenu!=null){this.oninitmenu(t,c,y,z)}if(t!=null){if(this.othermenus!=null){for(var n=0;n<this.othermenus.length;++n){t.push(this.othermenus[n])}}if(c!=null){if(this.config==null){t.push("-");t.push({label:"Admin",type:"a",translate:true,items:c})}else{t.push({label:"Admin",type:"b",src:"icon/admin.png",imgheight:40,translate:true,items:c})}}if(this.menugroup==null){var g=scil.byId("__apppoint");this.menugroup=g==null?null:g.getAttribute("menu")}var x=scil.byId("__scil_toolbar_left");x.style.verticalAlign="bottom";var q="<div style='width:30px;height:30px;font-size:24px;;vertical-align:center;background:url("+this.imgBig("circle.png")+");background-size:contain'>"+this.config.app+"</div>";t.splice(0,0,{largetext:q,label:"&#9660;",padding:0,color:this.config.frame,title:this.app.title,type:"b",dropdown:"",items:this.getAppItems()});this._createToolbarButtons(x,t,"left",this.menugroup)}if(y!=null&&y.licexpdays!=null&&scil.Utils.endswith(window.location+"","home.aspx")){this.showLicenseMsg(y.licexpdays)}this.updateRightToolbar(y);var l=scil.byId("__scil_main");if(l!=null){var h=dojo.window.getBox();if(h.h>200){l.style.minHeight=(h.h-200)+"px"}}},cleanButtons:function(d,f){var h=[];for(var g=0;g<d.length;++g){var c=d[g];if(this.config!=null){if(c=="-"||c=="|"){continue}c.type="b";c.float=f;c.imgheight=this.iconsize}else{if(c!="-"&&c!="|"){c.type="a";c.src=null}}h.push(c)}return h},getUserEmail:function(){return this.__user==null?null:this.__user.email},updateRightToolbar:function(h){this.__user=h;var d=this;var f=[];if(h==null){f.push({label:"Login",onclick:function(){scil.Login.showLogin()},src:this.imgBig("user.png"),type:"b",id:"__scil_login"})}else{f.push({label:h.fullname==null?"Me":h.fullname,src:this.imgBig("user.png"),type:"b",id:"__scil_login",translate:true,items:this.usermenuitems});if(h.cartitems!=null){f.push("-");var c=" (<b id='"+this.kCart+"'>"+h.cartitems+"</b>)";f.push({label:scil.Lang.res("Cart")+c,src:this.imgBig("cart.png"),type:"b",translate:true,items:[{label:"Show",onclick:function(){scil.Cart.show()}},"-",{label:"Clear",onclick:function(){scil.Cart.clear(false)}}]})}}if(!scil.MobileData.disabled){f.push({label:"Mobile",src:this.imgBig("mobile.png"),type:"b",translate:true,items:scil.MobileData.getMenuitems()})}if(scil.languages!=null){f.push("-");f.push({label:"Language",src:this.imgBig("language.png"),type:"b",items:scil.languages,onclick:function(j){scil.Lang.setLang(j,true)}})}if(!scil.Utils.isNullOrEmpty(this.config.help)&&h!=null){f.push("-");f.push({label:"Help",target:"_blank",url:this.config.help,src:this.imgBig("help.png"),type:"b"})}var g=scil.byId("__scil_toolbar_right");scil.Utils.removeAll(g);if(this.oncreaterightbuttons!=null){this.oncreaterightbuttons(f)}this._createToolbarButtons(g,f,"right")},_createToolbarButtons:function(g,d,c,h){d=this.cleanButtons(d,c);for(var f=0;f<d.length;++f){if(d!=null&&typeof(d[f])=="object"){d[f].framecolor=JSDraw2.Skin.kToolbarColor}}scil.Form.createToolbarButtons(g,d,2,c,h)},getAppItems:function(){var d={};var g=[];if(this.apps!=null){for(var c in this.apps){var n=this.apps[c];if(typeof(n)!="string"){continue}var l=g;var j=c.indexOf("|");if(j>0){var f=c.substr(0,j);c=c.substr(j+1);if(d[f]==null){d[f]=[]}l=d[f]}if(n=="-"){l.push("-")}else{if(n.indexOf("?")>0){l.push({icon:"jsdraw/img/blank.gif",imagewidth:"16px",label:c,target:"_blank",url:n})}else{if(!scil.Utils.endswith(n,"/")){n+="/"}l.push({icon:n+"favicon.ico",imagewidth:"16px",label:c,target:"_blank",url:n})}}}}for(var h in d){g.push({icon:"jsdraw/img/blank.gif",imagewidth:"16px",label:h,items:d[h],target:"_blank"})}if(g.length>0){g.push("-")}g.push({icon:"jsdraw/img/blank.gif",imagewidth:"16px",label:"About",onclick:scil.App.about,type:"a"});if(this.kMessageSite!=null){g.push("-");g.push({icon:"jsdraw/img/blank.gif",imagewidth:"16px",label:"Message Us",target:"_blank",url:this.kMessageSite,type:"a"})}return g},initAppButton:function(f){if(f==null){return}if(this.config!=null){var d=scil.byId("__scil_toolbar");d.style.background=JSDraw2.Skin.kToolbarColor}else{f.style.width="20px";f.style.borderRight="solid 1px blue";f.style.textAlign="center";f.style.background="#55f";var c={icon:this.app.icon,title:this.app.title,type:"a",dropdown:"",items:items};scil.Utils.createButton(f,c)}}};scil.Cart={kAjax:"Ajax.ashx?cmd=",initButtons:function(f){if(f==null){f=document.body}else{if(typeof(f)=="string"){f=scil.byId(f)}}var d=f.getElementsByTagName("i");if(d==null){return}for(var c=0;c<d.length;++c){this.initButton2(d[c])}},initButton2:function(c){var f=c.getAttribute("sid");var d=c.getAttribute("incart")=="1";var g=c.getAttribute("what");this.initButton(c,f,d,g)},initButton:function(d,f,c,g){if(f!=null&&f!=""&&(scil.Utils.isTrue(c)||scil.Utils.isFalse(c))){d.innerHTML=this.render(scil.Utils.isTrue(c),f,g)}},update:function(d,c){var g=scil.byId(scil.App.kCart);var f=parseInt(g.innerHTML);if(c!=null){g.innerHTML=c}else{g.innerHTML=f+d}},render:function(d,c,f){return"<img align='middle' style='display:block' onclick='scil.Cart.add2cart(event)' incart="+(d?1:0)+" "+(f!=null&&f!=""?" what='"+f+"'":"")+" src='img/cart"+(d==1?"2":"")+".gif' title='"+(d==1?scil.Lang.res("Remove from Cart"):scil.Lang.res("Add to Cart"))+"' sid='"+c+"'/>"},add:function(c){this.add2cart(c)},add2cart:function(f){var d=f.target||f.srcElement;var h=d.getAttribute("sid");var c=d.getAttribute("incart")!="1";var j=d.getAttribute("what");if(!(h>0)){return}var g=this;scil.Utils.ajax(this.kAjax+(c?"cart.add":"cart.remove"),function(l){g.update(c?1:-1);d.setAttribute("incart",c?1:0);d.src="img/cart"+(c?"2":"")+".gif";d.setAttribute("title",c?scil.Lang.res("Remove from Cart"):scil.Lang.res("Add to Cart"))},{id:h,what:j})},clear:function(d){var c=this;scil.Utils.ajax(this.kAjax+"cart.clear",function(f){if(d==false){c.update(0,0)}else{window.location.reload()}})},show:function(){window.open("Cart.aspx","_self")}};scil.Tools={array2Dict:function(d){if(d==null){return null}var f={};for(var c=0;c<d.length;++c){f[d[c]]=scil.Lang.res(d[c])}return f}};scil.ProgressBar=scil.extend(scil._base,{constructor:function(g,f){if(typeof(g)=="string"){g=scil.byId(g)}this.options=f;var c=this.options.height>0?this.options.height:20;var j=this.options.start;var l=scil.Utils.createTable(g,0,0,{border:this.options.border});var n=scil.Utils.createElement(l,"tr");if(j>0){scil.Utils.createElement(scil.Utils.createElement(n,"td"),"div",scil.Utils.imgTag("dit.gif"),{height:c,width:j})}for(var d=0;d<this.options.sections.length;++d){var h=this.options.sections[d];if(h.end>j){scil.Utils.createElement(scil.Utils.createElement(n,"td"),"div",scil.Utils.imgTag("dit.gif"),{height:c,width:h.end-j,backgroundColor:h.color==null?"green":h.color},{title:h.title});j=h.end}}if(j<this.options.width){scil.Utils.createElement(scil.Utils.createElement(n,"td"),"div",scil.Utils.imgTag("dit.gif"),{height:c,width:this.options.width-j})}}});scil.QuickSearch={q:null,options:null,init:function(g){if(this.options!=null){return}this.options=g==null?{}:g;if(this.options.suggesturl==null){this.options.suggesturl="Ajax.ashx?cmd=search.suggest"}if(this.options.searchurl==null){this.options.searchurl="Search.aspx?text="}var h="8px";var d=JSDraw2.Skin.kBigRadius+" 0 0 "+JSDraw2.Skin.kBigRadius;var l="0 "+JSDraw2.Skin.kBigRadius+" "+JSDraw2.Skin.kBigRadius+" 0";var j=scil.byId("__scil_toolbar_middle");if(j==null){j=scil.byId("__scil_toolbar_right")}var n=scil.Utils.createTable(null,0,0,{"float":"left",borderRadius:"2px"});j.insertBefore(n.parentNode,j.firstChild);n.parentNode.setAttribute("align","right");var f=this;var t=scil.Utils.createElement(n,"tr");var q=scil.Utils.createElement(t,"td");this.q=scil.Utils.createElement(q,"input",null,{border:"none",width:120,padding:h,borderRadius:d},{placeholder:"Search"});q=JsUtils.createElement(t,"td",null,{backgroundColor:"white",paddingRight:"3px"});var c=JsUtils.createElement(q,"img",null,{cursor:"pointer",width:"16px",height:"16px"},{src:scil.App.imgSmall("search.png"),title:"Quick Search"});dojo.connect(c,"onclick",function(){f.search()});if(this.options.onadvancedsearch!=null){q=JsUtils.createElement(t,"td",null,{borderLeft:"solid 1px gray",padding:"0 4px 0 4px",background:"#eee"});c=JsUtils.createElement(q,"img",null,{cursor:"pointer",width:"16px",height:"16px"},{src:scil.App.imgSmall("searchstructure.png"),title:"Advanced Search"});dojo.connect(c,"onclick",function(){f.options.onadvancedsearch(f)})}q.style.paddingRight="10px";q.style.borderRadius=l;if(this.options.autosuggest!=false&&this.autosuggest!=false){this.auto=new scil.AutoComplete(this.q,this.options.suggesturl)}new scil.MobileData(this.q,{category:"barcode",url:scil.MobileData.getDefaultUrl(false)});var f=this;dojo.connect(this.q,"onkeyup",function(u){f.onkeyup(u)})},onkeyup:function(c){if(c.keyCode!=13||this.auto.isVisible()){return}this.search()},search:function(){var c=scil.Utils.trim(this.q.value);if(c==""||c==this.token){return}if(this.options.onsearch!=null){this.options.onsearch(c)}else{window.location=this.options.searchurl+scil.Utils.escUrlData(c)}}};scil.Tabs=scil.extend(scil._base,{constructor:function(l,j){var h=this;this.options=j==null?{}:j;this.currenttab=null;this.area=null;if(typeof(l)=="string"){l=dojo.byId(l)}var n;var w=scil.Utils.createTable(l,0,0,{width:"100%",marginBottom:this.options.marginBottom==null?"20px":this.options.marginBottom});this.dom=this.table=w.parentNode;this.vertical=true;var q=this.options.border?null:scil.Tabs.kBorderStyle;var d=this.options.border?"5px":0;var c=this.options.border?scil.Tabs.kBorderStyle:null;var u=this.options.tabgap==null?"4px":this.options.tabgap;switch(this.options.tablocation){case"left":var x=scil.Utils.createElement(w,"tr");n=scil.Utils.createElement(x,"td",null,{borderRight:q,width:"1%",verticalAlign:"top",borderRightWidth:u});this.area=scil.Utils.createElement(x,"td",null,{padding:d,border:c,width:"99%",verticalAlign:"top"});this.vertical=false;break;case"right":var x=scil.Utils.createElement(w,"tr");this.area=scil.Utils.createElement(x,"td",null,{padding:d,border:c,width:"1%",verticalAlign:"top"});n=scil.Utils.createElement(x,"td",null,{borderLeft:q,width:"99%",verticalAlign:"top",borderLeftWidth:u});this.vertical=false;break;case"bottom":this.area=scil.Utils.createElement(scil.Utils.createElement(w,"tr"),"td",null,{padding:d,border:c});n=scil.Utils.createElement(scil.Utils.createElement(w,"tr"),"td",null,{borderTop:q,borderTopWidth:u});break;default:n=scil.Utils.createElement(scil.Utils.createElement(w,"tr"),"td",null,{borderBottom:q,borderBottomWidth:u});this.area=scil.Utils.createElement(scil.Utils.createElement(w,"tr"),"td",null,{padding:d,border:c});break}n.style.borderBottomColor=scil.Tabs.kHighlightColor;if(this.options.forpage){n.style.padding="5px 5px 0 5px";n.style.borderRadius=JSDraw2.Skin.kBorderRadius+" "+JSDraw2.Skin.kBorderRadius+" 0 0";n.style.borderTop="solid 1px "+scil.App.config.line;n.style.borderLeft="solid 1px "+scil.App.config.line;n.style.borderRight="solid 1px "+scil.App.config.line}else{if(scil.App.config!=null){n.style.borderBottom="solid 3px "+scil.App.config.frame}}this.tabcontainer=scil.Utils.createTable(n,0,0);if(this.vertical){this.tr=scil.Utils.createElement(this.tabcontainer,"tr")}if(this.options.showtabs==false){this.tr.style.display="none"}var t=this.options.tabs;if(t!=null){if(t.length>0){for(var f=0;f<t.length;++f){this.addTab(t[f])}}else{for(var g in t){this.addTab(t[g],g)}}}},getLastTab:function(){var c=this.vertical?this.tr.childNodes:this.tabcontainer.childNodes;return c[c.length-1]},resizeClientarea:function(h,c){var f=this.vertical?this.tr.childNodes:this.tabcontainer.childNodes;for(var d=0;d<f.length;++d){var g;if(this.vertical){g=f[d]}else{g=f[d].childNodes[0]}if(g.clientarea==null){continue}if(h>0){g.clientarea.style.width=h+"px";this.options.clientareawidth=h}if(c>0){g.clientarea.style.height=c+"px";this.options.clientareaheight=c}}if(this.options.onresizeclientarea!=null){this.options.onresizeclientarea(h,c,this)}},addTab:function(j,g){if(g==null&&j.key!=null){g=j.key}if(this.vertical){if(this.tr.childNodes.length>0){scil.Utils.createElement(this.tr,"td","&nbsp;")}}else{if(this.tabcontainer.childNodes.length>0){scil.Utils.createElement(scil.Utils.createElement(scil.Utils.createElement(this.tabcontainer,"tr"),"td"),"div",null,{height:5})}}var h=this;var c=j.caption;var d=j.icon;var x=j.tooltip;var l=this.options.tabpadding==null?"8px 10px 3px 10px":this.options.tabpadding;var y=this.vertical?this.tr:scil.Utils.createElement(this.tabcontainer,"tr");var q={padding:l};q.backgroundColor=this.options.forpage?null:"#eee";q.border=this.options.forpage?null:"solid 1px #ddd";switch(this.options.tablocation){case"left":q.borderRight="none";q.borderTopLeftRadius=JSDraw2.Skin.kBorderRadius;q.borderBottomLeftRadius=JSDraw2.Skin.kBorderRadius;break;case"right":q.borderLeft="none";q.borderTopRightRadius=JSDraw2.Skin.kBorderRadius;q.borderBottomRightRadius=JSDraw2.Skin.kBorderRadius;break;case"bottom":q.borderTop="none";q.borderBottomLeftRadius=JSDraw2.Skin.kBorderRadius;q.borderBottomRightRadius=JSDraw2.Skin.kBorderRadius;break;default:q.borderBottom="none";q.borderTopLeftRadius=JSDraw2.Skin.kBorderRadius;q.borderTopRightRadius=JSDraw2.Skin.kBorderRadius;break}var u=scil.Utils.createElement(y,"td",null,q,{key:g||j.tabkey,sciltab:"1"});var t=scil.Utils.createTable2(u,null,{cellSpacing:0,cellPadding:0});var n=(d!=null?"<img src='"+d+"'>":"")+(c==null?"Tab":scil.Lang.res(c));var w=null;switch(this.options.tablocation){case"left":case"right":u._label=scil.Utils.createElement(scil.Utils.createElement(t,"tr"),"td",n,null,{title:x},function(A){h.showTab(u)});w=scil.Utils.createElement(scil.Utils.createElement(t,"tr"),"td");break;case"bottom":default:var z=scil.Utils.createElement(t,"tr");u._label=scil.Utils.createElement(z,"td",n,null,{title:x},function(A){h.showTab(u)});w=scil.Utils.createElement(z,"td");break}if(j.closable){var f=scil.Utils.createButton(w,{src:scil.Utils.imgSrc("img/del2.gif"),title:"Close",style:{},onclick:function(A){h.closeTab(u)}});f.style.marginLeft="10px";u.style.paddingRight="2px";scil.connect(w,"onmouseover",function(){f.style.background="#fff"});scil.connect(w,"onmouseout",function(){f.style.background=""})}if(j.onmenu!=null){scil.connect(u,"onmouseup",function(A){if(scil.Utils.isRightButton(A)){j.onmenu(A)}A.preventDefault()});scil.Utils.disableContextMenu(u)}j.caption=null;j.visible=this.currenttab==null;j.marginBottom=0;j.caption=c;u.clientarea=scil.Utils.createElement(this.area,"div",null,{display:"none",width:this.options.clientareawidth,height:this.options.clientareaheight,overflowY:this.options.clientareaheight>0?"scroll":null});if(j.style!=null){dojo.style(u.clientarea,j.style)}if(this.currenttab==null){this.showTab(u)}if(j.html!=null){u.clientarea.innerHTML=j.html}if(this.options.onCreateTab!=null){this.options.onCreateTab(u,u.clientarea,this)}return u},updateTabLabel:function(c,d){var f=typeof(c)=="string"?this.findTab(c):c;if(f!=null&&f._label!=null){f._label.innerHTML=d}},closeTab:function(c){var g=typeof(c)=="string"?this.findTab(c):c;if(g==null){return}var d=this;if(this.options.onclosetab==null){scil.Utils.confirmYes("Close this tab?",function(){d.removeTab(g)})}else{var f=this.options.onclosetab(g,this);if(f=="cancel"){return}else{this.removeTab(g)}}},currentTabKey:function(){return this.currenttab==null?null:this.currenttab.getAttribute("key")},findTab:function(d){var f=this.vertical?this.tr.childNodes:this.tabcontainer.childNodes;for(var c=0;c<f.length;++c){var g;if(this.vertical){g=f[c]}else{g=f[c].childNodes[0]}if(g.getAttribute("key")==d){return g}}return null},removeTab:function(d){var g=typeof(d)=="string"?this.findTab(d):d;if(g==null){return false}if(this.options.onRemoveTab!=null){if(this.options.onRemoveTab(g,this)=="cancel"){return false}}if(g==this.currenttab){var f=this.allTabsAsArray();var c=scil.Utils.indexOf(f,g);if(c>0){this.showTab(f[c-1])}else{this.showTab(f[c+1])}}g.clientarea.parentNode.removeChild(g.clientarea);delete g.clientarea;if(this.vertical){var h=g.previousSibling;if(h!=null&&h.clientarea==null){h.parentNode.removeChild(h)}g.parentNode.removeChild(g)}else{var j=g.parentNode;var l=j.previousSibling;if(l!=null){l.parentNode.removeChild(l)}j.parentNode.removeChild(j)}return true},allTabsAsArray:function(){var f=[];var d=this.vertical?this.tr.childNodes:this.tabcontainer.childNodes;for(var c=0;c<d.length;++c){var g;if(this.vertical){g=d[c]}else{g=d[c].childNodes[0]}if(g.getAttribute("sciltab")=="1"){f.push(g)}}return f},allTabs:function(){var g={};var f=this.vertical?this.tr.childNodes:this.tabcontainer.childNodes;for(var c=0;c<f.length;++c){var h;if(this.vertical){h=f[c]}else{h=f[c].childNodes[0]}if(h.getAttribute("sciltab")=="1"){var d=h.getAttribute("key");if(d!=null&&d!=""){g[d]=h}}}return g},showTab:function(f){if(typeof(f)=="string"){f=this.findTab(f)}else{if(typeof(f)=="number"){var c=this.allTabsAsArray();f=c[f]}}if(f!=null&&f.tagName!="TD"){f=scil.Utils.getParent(f,"td")}if(f==null||this.currenttab==f){return null}var d=this.currenttab;if(this.options.onBeforeShowTab!=null){if(this.options.onBeforeShowTab(f,d)==false){return f}}if(this.currenttab!=null){this.currenttab.style.backgroundColor=this.options.forpage?"":"#eee";this.currenttab.style.color=""}if(d!=null&&d.clientarea!=null){d.clientarea.style.display="none"}if(scil.App.config!=null){f.style.backgroundColor=scil.App.config.frame}else{f.style.backgroundColor=scil.Tabs.kHighlightColor}f.style.color="#fff";this.currenttab=f;if(f.clientarea!=null){f.clientarea.style.display=""}if(this.options.onShowTab!=null){this.options.onShowTab(f,d,this)}return f},show:function(){this.table.style.display=""},hide:function(){this.table.style.display="none"}});scil.apply(scil.Tabs,{kHighlightColor:"#88f",kBorderStyle:"solid 1px #88f"});scil.TabbedForm=scil.extend(scil._base,{constructor:function(c){this.form=null;this.options=c;this.buttons=[];this.fields={}},render:function(l){if(typeof(l)=="string"){l=dojo.byId(l)}var j=this;this.options.onShowTab=function(t,q){if(!t.rendered&&q!=null){j.renderTabForm(t)}};this.options.onBeforeShowTab=function(t,q){if(j.options.onbeforeshowtab!=null&&t!=q){return j.options.onbeforeshowtab(t,q)}};var f=true;for(var h in this.options.tabs){this.options.tabs[h].tabkey=h}this.tabs=new scil.Tabs(l,this.options);for(var h in this.options.tabs){this.options.tabs[h].tabkey=h;var n=this.tabs.findTab(h);n.form=new scil.Form(this.options);if(!this.options.delayrender||f){this.renderTabForm(n);f=false}}var c=this.options.buttons;if(c!=null){var d=scil.Utils.createElement(l,"div",null,{marginTop:"10px",textAlign:"center"});if(c.length>0){for(var g=0;g<c.length;++g){this.buttons.push(scil.Utils.createButton(d,c[g]))}}else{this.buttons.push(scil.Utils.createButton(d,c))}}return this},setFieldValue:function(f,g,c){var d=this.fields[f];scil.Form.setFieldData(this.fields[f],this.items[f],this.viewonly,g,c)},focus:function(c){scil.Form.focus(this.fields,c)},checkRequiredFields:function(){var f=0;var g=this.tabs.allTabs();for(var d in g){var c=g[d].form;if(c!=null){f+=c.checkRequiredFields()}}return f},resetRequiredFields:function(){var f=this.tabs.allTabs();for(var d in f){var c=f[d].form;if(c!=null){c.resetRequiredFields()}}},renderTabForm:function(g){if(g.rendered){return}var f=g.getAttribute("key");var d=null;if(this.options.tabs!=null&&this.options.tabs[f]!=null){d=this.options.tabs[f].fields}var c=g.clientarea.style.display;g.clientarea.style.display="";g.form.render(g.clientarea,d,this.options.tabs[f]);g.clientarea.style.display=c;scil.apply(this.fields,g.form.fields);g.rendered=true},getCurTabData:function(c){if(this.tabs.currenttab==null||this.tabs.currenttab.form==null){return null}return this.tabs.currenttab.form.getData(c)},getXml:function(f){var g=f?"":"<data>\n";var h=this.tabs.allTabs();for(var d in h){var c=h[d].form;if(c!=null){g+=c.getXml(true)}}if(!f){g+="</data>"}return g},setXml:function(f){try{var c=scil.Form.xml2Json(f);this.setData(c)}catch(d){alert("Error raised when setting form data: "+d.message)}},getData:function(f){if(this.options.getdata=="tab"){return this.getCurTabData(f)}var h={};var j=this.tabs.allTabs();for(var g in j){var d=j[g].form;if(d!=null){var c=d.getData(f);scil.apply(h,c)}}return h},setData:function(c,g){if(this.options.setdata=="tab"){if(this.tabs.currenttab!=null&&this.tabs.currenttab.form!=null){this.tabs.currenttab.form.setData(c,g)}}else{var h=this.tabs.allTabs();for(var f in h){var d=h[f].form;if(d!=null){d.setData(c,g)}}}}});scil.FieldItemBase=scil.extend(scil._base,{constructor:function(g,f){if(typeof(g)=="string"){g=scil.byId(g)}var d=this;this.options=f==null?{}:f;if(!this.options.viewonly&&this.options.maxcount==null){this.options.maxcount=1}var c=scil.Utils.createElement(g,"div",null,{width:this.options.width,height:this.options.height});var j=scil.Utils.createElement(scil.Utils.createTable(c,0,0),"tr");this.links=scil.Utils.createElement(j,"td",null,null,{valign:"center"});if(!this.options.viewonly){var h=scil.Utils.createElement(j,"td");if(this.options.vertical){h.setAttribute("valign","bottom")}this.addbutton=scil.Utils.createButton(h,{src:scil.Utils.imgSrc("img/"+this.getAddIcon()),title:"Add "+this.getTitle(),type:"a",onclick:function(){d.upload()}});if(this.createDnD!=null){this.dndfile=this.createDnD(c)}}this.clear()},getAddIcon:function(){return"add.gif"},addItem:function(g){if(this.options.maxcount>0){var f=this.getItems().length;if(f>=this.options.maxcount){return false}}var h={background:"#eee",border:"solid 1px #eee",borderRadius:"5px"};if(this.options.vertical){h.marginBottom="1px"}else{h.marginRight="1px";h.float="left"}var c=scil.Utils.createElement(this.links,"div",null,h,{fielditem:"1"});if(!this.renderItem(c,g)){this.links.removeChild(c);return false}var d=this;if(!this.options.viewonly){scil.Utils.createButton(c,{src:scil.Utils.imgSrc("img/del2.gif"),title:"Delete",type:"a",onclick:function(){d.delItem(c)}})}this.markChanged("add");this.updateAddButton();return true},delItem:function(c){if(c==null){return}var d=this;scil.Utils.confirmYes("Delete "+this.getTitle()+"?",function(){c.parentNode.removeChild(c);d.markChanged("del");d.updateAddButton()})},markChanged:function(c){if(!this.options.viewonly&&this.options.onchange!=null){this.options.onchange(this,c)}},clear:function(){if(this.links.childNodes!=null&&this.links.childNodes.length>0){scil.Utils.removeAll(this.links);this.markChanged("clear")}this.updateAddButton()},updateAddButton:function(){if(this.addbutton==null||!(this.options.maxcount>0)){return}var c=this.getItems().length;if(c>=this.options.maxcount){this.addbutton.style.display="none";if(this.dndfile!=null){this.dndfile.disabled=true}}else{this.addbutton.style.display="";if(this.dndfile!=null){this.dndfile.disabled=false}}},getItems:function(c){var j=[];for(var f=0;f<this.links.childNodes.length;++f){var h=this.links.childNodes[f];if(h.tagName=="DIV"&&h.getAttribute("fielditem")=="1"){if(c==null){j.push(h)}else{var d={};for(var g=0;g<c.length;++g){d[c[g]]=h.getAttribute(c[g])}j.push(d)}}}return j},getXml:function(){var f="";var d=this.getDataItems();for(var c=0;c<d.length;++c){f+=this.item2Xml(d[c])}return f==""?"":"<files>"+f+"</files>"},setXml:function(g){this.clear();if(scil.Utils.isNullOrEmpty(g)){return}var d=this.parseXml(g);if(d==null&&typeof(g)=="string"){d=this.parseXml(scil.Utils.unescXmlValue(g))}if(d==null){return}for(var f=0;f<d.length;++f){var c=this.xml2Item(d[f]);if(c!=null){this.addItem(c)}}},parseXml:function(g){if(typeof(g)=="string"){var d=g.replace(/<[\/]files>[\r]?[\n]?[\,][ ]?<files>/g,"</files><files>");if(d.length==g.length){var f=d.replace(/<[\/]div>[\r]?[\n]?[\,][ ]?<div[ ]/g,"</div></file><file><div ");if(f.length!=d.length||scil.Utils.startswith(f,"<div ")){d="<files><file>"+f+"</file></files>"}}g=scil.Utils.parseXml("<t>"+d+"</t>")}var c=g==null?null:g.getElementsByTagName("file");return c!=null&&c.length==0?null:c}});scil.FieldFileBase=scil.extend(scil.FieldItemBase,{item2Xml:function(c){if(c==null||scil.Utils.isNullOrEmpty(c.fileid)&&scil.Utils.isNullOrEmpty(c.contents)||scil.Utils.isNullOrEmpty(c.filename)){return""}var d="<file source='"+scil.Utils.escXmlValue(c.source)+"' fileid='"+c.fileid+"'";if(c.contents!=null&&c.contents!="undefined"&&c.contents!="null"){d+=" contents='"+scil.Utils.escXmlValue(c.contents)+"'"}d+=">"+scil.Utils.escXmlValue(c.filename)+"</file>";return d},xml2Item:function(c){return c==null?null:{fileid:c.getAttribute("fileid"),source:c.getAttribute("source"),contents:c.getAttribute("contents"),filename:scil.Utils.unescXmlValue(c.text||c.textContent)}},getDataItems:function(){return this.getItems(["fileid","filename","source","contents"])},download:function(c){if(c==null){if(!this.options.viewonly){if(this.options.onupload!=null){this.options.onupload(this)}else{this.upload()}}}else{if(this.options.ondownload!=null){this.options.ondownload(c,this)}else{this.downloadUrl(c)}}},downloadUrl:function(c){var f=this.getDownloadUrl(c);if(f!=null){window.open(f)}},getDownloadUrl:function(c){if(!scil.Utils.isNullOrEmpty(c.contents)&&c.contents!="undefined"&&c.contents!="null"){var j=c.filename.lastIndexOf(".");var h=c.filename.substr(j+1);return"data:image/"+h+";base64,"+c.contents}var g=this.options.downloadurl;if(g==null||g==""){var f=this.getDefaultOptions();if(f.downloadurl!=null){g=f.downloadurl}}if(g=="disabled"){scil.Utils.alert("File download is disabled by Admin.");return}if((g==null||g=="")&&JSDrawServices!=null){g=JSDrawServices.url+"?cmd=filestore.download&fileid={fileid}&source={source}"}return g==null?null:g.replace("{fileid}",c.fileid).replace("{filename}",scil.Utils.escFileName(c.filename)).replace("{source}",c.source==null?"":scil.Utils.escFileName(c.source))},preview:function(c){if(c==null){return}if(this.options.onpreview!=null){this.options.onpreview(c,this)}else{var f=this.getDefaultOptions();if(f.onpreview!=null){f.onpreview(c,this)}}},upload2:function(g){if(g==null){return}var d="fileid";if(this.options.filekey!=null&&this.options.filekey!=""){d=this.options.filekey}else{var c=this.getDefaultOptions();if(c.filekey!=null&&c.filekey!=""){d=c.filekey}}if(g.length>0){for(var f=0;f<g.length;++f){this.addItem({filename:g[f].filename,fileid:g[f][d],source:g[f].source})}}else{this.addItem({filename:g.filename,fileid:g[d],source:g.source})}if(this.options.onchange!=null){this.options.onchange(this,"upload")}},upload:function(){var d=this;var c=this.getUploadArgs();scil.Utils.uploadFile(c.caption,c.message,c.uploadurl,function(f){d.upload2(f)},c.params,null,c.multiple)},getUploadArgs:function(){var c=scil.clone(this.options);var d=this.getDefaultOptions();if(c.params==null&&d.params!=null){c.params=d.params}if(this.options.onupload!=null){if(this.options.onupload(c.params)==false){return}}c.multiple=this.options.maxcount!=1;if(c.message==null){if(d.message!=null){c.message=d.message}else{c.message="Please specify "+(c.multiple?"files":"a file")}}if(c.caption==null){if(d.caption!=null){c.caption=d.caption}else{c.caption="Upload"}}if(c.uploadurl==null){if(d.uploadurl!=null){c.uploadurl=d.uploadurl}else{if(JSDrawServices!=null){c.uploadurl=JSDrawServices.url+"?cmd=filestore.upload"}}}return c}});scil.FieldFile=scil.extend(scil.FieldFileBase,{getTitle:function(){return"File"},getAddIcon:function(){return"upload.gif"},renderItem:function(c,d){return scil.FieldFile.renderFile(this,c,d)},renderFilename:function(d){if(d==null||d==""){return"not-named"}var c=scil.Form.ext2Icon(d);return scil.Utils.imgTag("ext/"+c+".gif",d)},getDefaultOptions:function(){return scil.FieldFile.defaultoptions},createDnD:function(d){var f=this;var c=this.getUploadArgs();return new scil.DnDFile(d,{url:c.uploadurl,onupload:function(h,g){scil.apply(h,c.params)},callback:function(g){f.upload2(g)}})}});scil.apply(scil.FieldFile,{kDisplayLength:16,defaultoptions:{},renderFile:function(f,d,g){if(g==null||g.fileid==null||g.fileid==""||g.filename==null||g.filename==""){return false}d.setAttribute("fileid",g.fileid);d.setAttribute("source",g.source==null?"":g.source);d.setAttribute("filename",g.filename);var h=g.filename;if(f.options.shortdisplay!=false&&scil.FieldFile.defaultoptions.shortdisplay!=false){h=g.filename.length>scil.FieldFile.kDisplayLength?g.filename.substr(0,scil.FieldFile.kDisplayLength-3)+"...":g.filename}var c=scil.Form.ext2Icon(g.filename);h=scil.Utils.imgTag("ext/"+c+".gif",h);if(f.options.activelink==false){scil.Utils.createElement(d,"span",h,{background:"#fff",color:"gray"},{title:g.filename})}else{if(f.options.downloadable==false){scil.Utils.createElement(d,"span",h,{background:"#fff"},{title:g.filename})}else{scil.Utils.createElement(d,"u",h,{color:"blue",background:"#fff",cursor:"pointer"},{title:g.filename},function(){f.download(g)})}if(f.options.onpreview!=null||f.getDefaultOptions().onpreview!=null){f.prev=scil.Utils.createButton(d,{src:scil.Utils.imgSrc("img/preview.gif"),title:"Preview",type:"a",onclick:function(){f.preview(g)}})}}return true}});scil.FieldFileLink=scil.extend(scil.FieldFileBase,{item2Xml:function(c){if(c==null||c.path==null||c.path==""||c.filename==null||c.filename==""){return""}return"<file path='"+c.path+"'>"+scil.Utils.escXmlValue(c.filename)+"</file>"},xml2Item:function(c){return c==null?null:{path:c.getAttribute("path"),filename:scil.Utils.unescXmlValue(c.text||c.textContent)}},getDataItems:function(){return this.getItems(["path","filename"])},download:function(c){if(c==null){if(!this.options.viewonly){if(this.options.onupload!=null){this.options.onupload(this)}else{this.upload()}}}else{if(this.options.ondownload!=null){this.options.ondownload(c,this)}else{this.downloadUrl(c)}}},downloadUrl:function(c){var f=this.getDownloadUrl(c);if(f!=null){window.open(f)}},getDownloadUrl:function(c){var g=this.options.downloadurl;if(scil.Utils.isNullOrEmpty(g)){var f=this.getDefaultOptions();if(f.downloadurl!=null){g=f.downloadurl}}if(scil.Utils.isNullOrEmpty(g)&&JSDrawServices!=null){g=JSDrawServices.url+"?cmd="+this.options.cmd+".download&path={path}&source={source}"}var h=this.options.source;return g==null?null:g.replace("{path}",escape(c.path)).replace("{filename}",escape(c.filename)).replace("{source}",escape(h))},preview:function(c){if(c==null){return}if(this.options.onpreview!=null){this.options.onpreview(c,this)}else{var f=this.getDefaultOptions();if(f.onpreview!=null){f.onpreview(c,this)}}},upload:function(){if(this.options.cmd=="filepath"){this.uploadInput()}else{this.uploadSelect()}},uploadSelect:function(){var c={source:this.options.source};if(this.options.onbeforeselect!=null){this.options.onbeforeselect(c,this)}var d=this;scil.Utils.jsonp(this.getListUrl(),function(f){d.showList(f)},c)},getListUrl:function(){var d=this.options.listurl;if(scil.Utils.isNullOrEmpty(d)){var c=this.getDefaultOptions();if(c.listurl!=null){d=c.listurl}}if(scil.Utils.isNullOrEmpty(d)&&JSDrawServices!=null){d=JSDrawServices.url+"?cmd="+this.options.cmd+".list"}return d},showList:function(f){if(this.selectdlg==null){var c={list:{type:"table",columns:{filename:{label:"File Name",width:200},path:{label:"Path",width:400}},options:{rowcheck:true}}};var d=this;this.selectdlg=scil.Form.createDlgForm("Add Files",c,{label:"Add Selected File(s)",onclick:function(){d.addselectedfiles()}},{viewonly:true,hidelabel:true})}this.selectdlg.show();this.selectdlg.form.fields.list.jsd.setData(f);this.selectdlg.moveCenter()},addselectedfiles:function(){var d=this.selectdlg.form.fields.list.jsd.getCheckedRowData();if(d!=null){for(var c=0;c<d.length;++c){this.addItem(d[c])}}this.selectdlg.hide()},uploadInput:function(){var c=this;scil.Utils.prompt2({caption:"Add File Link",message:"Please input the file path:<br>(e.g. \\serverpathXyz.docx)<br>",callback:function(g){var f=g.lastIndexOf("\\");if(f<=0){f=g.lastIndexOf("/")}if(f<=0){scil.Utils.alert("Invalid file")}else{var d=g.substr(f+1);c.addItem({filename:d,path:g})}}})},getTitle:function(){return"File Link"},getAddIcon:function(){return"filelink.gif"},renderItem:function(c,d){return scil.FieldFileLink.renderFile(this,c,d)},renderFilename:function(d){if(d==null||d==""){return"not-named"}var c=scil.Form.ext2Icon(d);return scil.Utils.imgTag("ext/"+c+".gif",d)},getDefaultOptions:function(){return scil.FieldFileLink.defaultoptions}});scil.apply(scil.FieldFileLink,{defaultoptions:{},renderFile:function(f,d,g){if(g==null||g.path==null||g.path==""||g.filename==null||g.filename==""){return false}d.setAttribute("path",g.path);d.setAttribute("filename",g.filename);var h=g.filename;if(f.options.shortdisplay!=false&&scil.FieldFileLink.defaultoptions.shortdisplay!=false){h=g.filename.length>scil.FieldFile.kDisplayLength?g.filename.substr(0,scil.FieldFile.kDisplayLength-3)+"...":g.filename}var c=scil.Form.ext2Icon(g.filename);h=scil.Utils.imgTag("ext/"+c+".gif",h);if(f.options.activelink==false){scil.Utils.createElement(d,"span",h,{background:"#fff",color:"gray"},{title:g.filename})}else{scil.Utils.createElement(d,"u",h,{color:"blue",background:"#fff",cursor:"pointer"},{title:g.filename},function(){f.download(g)});if(f.options.onpreview!=null||f.getDefaultOptions().onpreview!=null){f.prev=scil.Utils.createButton(d,{src:scil.Utils.imgSrc("img/preview.gif"),title:"Preview",type:"a",onclick:function(){f.preview(g)}})}}return true}});scil.FieldImage=scil.extend(scil.FieldFileBase,{getTitle:function(){return"Image"},getAddIcon:function(){return"uploadimg.gif"},renderItem:function(f,j){if(this.options.activelink==false){return scil.FieldFile.renderFile(this,f,j)}if(j.contents=="undefined"||j.contents=="null"){j.contents=null}if(j==null||scil.Utils.isNullOrEmpty(j.fileid)&&scil.Utils.isNullOrEmpty(j.contents)||scil.Utils.isNullOrEmpty(j.filename)){return false}f.setAttribute("filename",j.filename);if(j.fileid==null){f.removeAttribute("fileid")}else{f.setAttribute("fileid",j.fileid)}if(j.contents==null){f.removeAttribute("contents")}else{f.setAttribute("contents",j.contents)}var n={maxWidth:"100%",background:"#fff",borderRadius:"5px"};if(this.options.viewonly){n.display="block"}if(this.options.vertical){var q=this.options.width>30?this.options.width:200;if(!this.options.viewonly){q-=16}n.width=q}else{var c=this.options.height>5?this.options.height:50;n.height=c}var g=this;var l=this.getDownloadUrl(j);var d=scil.Utils.createElement(f,"img",null,n,{src:l});d.setAttribute("title","Double click to view large image");dojo.connect(d,"ondblclick",function(){scil.FilePreviewer.show(null,{previewurl:l})});return true},getDefaultOptions:function(){return scil.FieldImage.defaultoptions},createDnD:function(d){var f=this;var c=this.getUploadArgs();return new scil.DnDFile(d,{url:c.uploadurl,imageonly:true,onupload:function(g){scil.apply(g,c.params)},callback:function(g){f.upload2(g)}})}});scil.apply(scil.FieldImage,{defaultoptions:{}});scil.FieldCurve=scil.extend(scil._base,{constructor:function(h,g){if(typeof(h)=="string"){h=scil.byId(h)}var f=this;this.options=g==null?{}:g;this.parent=h;var d=JSDrawServices.url;if(!(this.options.width>0)){this.options.width=200}if(!(this.options.height>0)){this.options.height=120}var j=scil.Utils.createTable(h,0,0);var l=scil.Utils.createElement(j,"tr");var c=scil.Utils.createElement(scil.Utils.createElement(l,"td"),"div",null,{border:"solid 1px #eee"});this.jsd=new JSDraw2.Editor(c,{viewonly:true,allowqccurve:this.options.allowqccurve,onfitresult:function(n){f.onfitresult(n)},width:this.options.width,height:this.options.height});this.clear()},onfitresult:function(c){if(this.options.onfitresult!=null){this.options.onfitresult(c,this)}},clear:function(){this.jsd.setXml(null)},setXml:function(c){this.jsd.setXml(c)},getXml:function(){return this.jsd.getXml()}});scil.FieldNumber=scil.extend(scil._base,{constructor:function(c,f){if(typeof(c)=="string"){c=scil.byId(c)}this.options=f==null?{}:f;this.input=c;this.unit=null;this.prefix=null;var d=this;var l=this.options.viewonly||this.input.disabled||this.input.readOnly;if(this.options.allowoperator&&!l){this.auto=new scil.DropdownInput(c,{items:this.options.items==null?["","≥","≤","&lt;","&gt;","±"]:this.options.items,onSetValue:function(n,q){d.onSetOperator(n,q)}})}var j;if((this.options.units!=null||this.options.prefixes!=null)&&!l){var g=JSDraw2.Skin.kBigRadius;var h=scil.Utils.createTable(null,0,0,{border:"solid 1px #ccc",borderRadius:g});this.input.parentNode.insertBefore(h.parentNode,this.input);j=scil.Utils.createElement(h,"tr");if(this.options.prefixes!=null){this.prefix=scil.Utils.createElement(scil.Utils.createElement(j,"td",null),"select");scil.Utils.listOptions(this.prefix,this.options.prefixes,null,true,true);scil.connect(this.prefix,"onchange",function(){scil.Utils.fireEvent(d.input,"change")})}scil.Utils.createElement(j,"td").appendChild(this.input);if(this.options.units!=null){this.unit=scil.Utils.createElement(scil.Utils.createElement(j,"td",null,{borderLeft:"solid 1px #ccc"}),"select",null,{width:this.options.unitwidth});scil.FieldNumber.handleMicroUnits(this.options.units);scil.Utils.listOptions(this.unit,this.options.units,null,true,false);scil.connect(this.unit,"onchange",function(){scil.Utils.fireEvent(d.input,"change")});this.unit.style.border="none"}this.input.style.border="none"}var d=this;if(!l){scil.connect(c,"onchange",function(n){var q=c.value;if(q!=""&&q!=null&&(d.options.accepts==null||!new RegExp(d.options.accepts).test(q))&&(d.options.isnumber!=false&&!scil.Utils.isNumber(q,d.options.allowoperator))){c.value="";scil.Utils.alert("A number is required!")}else{if(d.prefix!=null&&!scil.Utils.isNullOrEmpty(d.prefix.value)){q=d.prefix.value+" "+q}if(d.unit!=null&&!scil.Utils.isNullOrEmpty(d.unit.value)){q+=d.unit.value}d.setValue(q)}})}if(!l&&this.options.mobiledata!=null){var d=this;new scil.MobileData(c,{weighstation:true,url:scil.MobileData.getDefaultUrl(true),onresult:function(n){d.setValue(n.barcode);scil.MobileData.markRecieved(c);return true}});scil.Utils.createButton(scil.Utils.createElement(j,"td"),{label:"&#9878;",title:"Select Weigh Station",type:"a",onclick:function(){scil.MobileData.selectWeighstation()}})}},onSetOperator:function(f,g){if(g==""){return}var h=scil.Utils.trim(f.value);if(g=="±"){if(h.indexOf("±")>=0){return}f.value=h+" ±"}else{var d=h.length>0?h.substr(0,1):null;if(d=="≥"||d=="≤"||d==">"||d=="<"){h=h.substr(1)}f.value=g+h}},clear:function(){this.setDisplayValue("")},setValue:function(d){if(this.prefix!=null){scil.Utils.selectOption(this.prefix,"",true);if(d!=null){var c=d.indexOf(" ");if(c>0){scil.Utils.selectOption(this.prefix,d.substr(0,c),true);d=d.substr(c+1)}}}d=d==null?null:(JSDraw2.Table==null?{value:d}:JSDraw2.Table.splitUnit(d+""));if(d==null){this.setDisplayValue("");return}if(this.options.scale>0&&!isNaN(d.value)){d.value*=this.options.scale}if(this.options.decimal>0){d.value=scil.Utils.round(d.value,this.options.decimal)}if(d.unit2==null){d.unit2=this.options.defaultunit}var f=(d.op==null?"":d.op)+d.value;if(this.options.viewonly&&this.unit==null&&d.unit!=null){f+=d.unit}this.setDisplayValue(f);if(this.unit!=null){scil.Utils.selectOption(this.unit,d.unit2,true)}else{if(JSDraw2.ColorCoding!=null){JSDraw2.ColorCoding.show(this.input,d.value,this.options)}}},setDisplayValue:function(c){if(c==null){c=""}if(this.input.tagName=="INPUT"){this.input.value=c}else{this.input.innerHTML=c}},getDisplayValue:function(){if(this.input.tagName=="INPUT"){return this.input.value}else{return scil.Utils.getInnerText(this.input)}},getValue:function(){var c=scil.Utils.trim(this.getDisplayValue());if(!scil.Utils.isNullOrEmpty(c)&&!isNaN(c)){if(this.options.scale>0){c/=this.options.scale}if(this.prefix!=null&&!scil.Utils.isNullOrEmpty(this.prefix.value)){c=this.prefix.value+" "+c}if(this.unit!=null){c=c+this.unit.value}}return c}});scil.apply(scil.FieldNumber,{microunits:{ug:"μg",uL:"μL",uM:"μM"},handleMicroUnits:function(d){if(d==null){return}for(var c=0;c<d.length;++c){if(this.microunits[d[c]]!=null){d[c]=this.microunits[d[c]]}}}});scil.FieldTextBase=scil.extend(scil.FieldItemBase,{getTitle:function(){return"Text"},renderItem:function(c,g){if(g.data==null||g.data==""){return false}c.setAttribute("data",g.data);var d=this.options.previewlength>0?this.options.previewlength:10;var h=scil.Utils.ltrim(this.html2Text(g.data));h=h.length>d?h.substr(0,d-3)+"...":h;var f=this;scil.Utils.createElement(c,"span",scil.Utils.escXmlValue(h),{color:"blue",background:"#fff"});scil.Utils.createButton(c,{src:scil.Utils.imgSrc("img/preview.gif"),title:"Preview",type:"a",onclick:function(){f.preview(c)}});if(this.renderItem2!=null){this.renderItem2(c,g)}return true},item2Xml:function(c){if(c==null||c.data==null||c.data==""){return""}return"<file>"+scil.Utils.escXmlValue(c.data)+"</file>"},xml2Item:function(c){return c==null?null:{data:scil.Utils.unescXmlValue(c.text||c.textContent)}},getDataItems:function(){return this.getItems(["data"])},getValue:function(){var c=this.getDataItems();return c!=null&&c.length>0?c[0].data:null},preview:function(d){var f=d.getAttribute("data");if(scil.Utils.isNullOrEmpty(f)){return}var c="<div style='min-width:400px'>"+this.formatText(f)+"</div>";scil.Utils.alert2(c,"Preview")}});scil.apply(scil.FieldTextBase,{text2Xml:function(c){if(scil.Utils.isNullOrEmpty(c)){return""}return"<files><file>"+scil.Utils.escXmlValue(c)+"</file></files>"},xml2Text:function(h){var c=scil.Utils.parseXml("<t>"+h+"</t>");var d=c==null?null:c.getElementsByTagName("file");if(d==null){return[]}var g=[];for(var f=0;f<d.length;++f){g.push(scil.Utils.unescXmlValue(d[f].text||d[f].textContent))}return g}});scil.FieldTabText=scil.extend(scil.FieldTextBase,{html2Text:function(c){return c},formatText:function(c){return scil.FieldTabText.table2Html(c)},upload:function(){if(this.options.viewonly){return}var c=this;scil.Utils.prompt2({caption:"Paste Table Data",defaultvalue:this.getValue(),message:"Please paste the data from Excel",multiline:true,height:300,callback:function(d){c.addItem({data:d})}})},renderItem2:function(c,f){var d=this;if(!this.options.viewonly&&this.options.maskdatapoints){scil.Utils.createButton(c,{src:scil.Utils.imgSrc("img/mask.gif"),title:"Exclude Data Points",type:"a",onclick:function(){d.maskDataPoints(c)}})}},maskDataPoints:function(c){var g=c.getAttribute("data");if(scil.Utils.isNullOrEmpty(g)){return}var f=this;var d=new JSDraw2.Matrix(g);JSDraw2.Matrix.maskDataPoints(d,function(){var h=d.toCSV();c.setAttribute("data",h);f.markChanged("mask")})}});scil.apply(scil.FieldTabText,{table2Html:function(d,f,g){if(scil.Utils.isNullOrEmpty(d)){return""}var c=new JSDraw2.Matrix(d,f);return c.html(g)}});scil.FieldRichText=scil.extend(scil.FieldTextBase,{html2Text:function(c){return scil.Utils.html2Text(c)},formatText:function(c){return c},upload:function(){if(this.options.viewonly){return}var c=this;var d=this.getValue();scil.Richtext.showDlg({text:d,callback:function(f){c.addItem({data:f})}})}});scil.FieldSketches=scil.extend(scil.FieldItemBase,{getTitle:function(){return"Sketch"},upload:function(){this.addItem({})},renderItem:function(g,j){var l=this.options.width>30?this.options.width:80;if(!this.options.viewonly){l-=16}var f=this.options.height>5?this.options.height:40;var c={width:l,height:f};if(this.options.viewonly){c.viewonly=true}else{c.popup=true}var d=scil.Utils.createElement(g,"div");g.jsd=new JSDraw2.Editor(d,c);if(j.data!=null){g.jsd.setXml(j.data)}return true},getDataItems:function(){var g=this.getItems();if(g==null){return null}var h=[];for(var f=0;f<g.length;++f){var c=g[f].jsd.getXml();if(c!=null&&c!=""){h.push({data:c})}}return h},item2Xml:function(c){if(c==null||c.data==null||c.data==""){return""}return"<file>"+c.data+"</file>"},xml2Item:function(c){var d=c==null?null:c.getElementsByTagName("div");return d==null||d.length==0?null:{data:d[0]}}});scil.FieldPlainText=scil.extend(scil.FieldTextBase,{html2Text:function(c){return c},formatText:function(c){return scil.Utils.escXmlValue(c)},upload:function(){if(this.options.viewonly){return}var c=this;scil.Utils.prompt2({caption:"Paste Plain Text",defaultvalue:this.getValue(),message:"Please paste plain text",multiline:true,height:300,callback:function(d){c.addItem({data:d})}})}});scil.apply(scil.FieldTabText,{table2Html:function(d,f,g){if(scil.Utils.isNullOrEmpty(d)){return""}var c=new JSDraw2.Matrix(d,f);return c.html(g)}});scil.FieldCode=scil.extend(scil._base,{constructor:function(f,d){if(typeof(f)=="string"){f=scil.byId(f)}this.options=d==null?{}:d;if(this.options.viewonly){this.options.readOnly=true}if(!(this.options.width>0)){this.options.width=600}if(!(this.options.height>0)){this.options.height=80}if(this.options.mode=="xml"){this.options.mode="text/html"}this.options.lineNumbers=true;this.options.extraKeys={F11:function(g){g.setOption("fullScreen",!g.getOption("fullScreen"))}};if(typeof(CodeMirror)=="undefined"){this.textarea=scil.Utils.createElement(f,"textarea",null,{width:this.options.width,height:this.options.height})}else{var c=scil.Utils.createElement(f,"div",null,{width:this.options.width,height:this.options.height,border:"solid 1px gray",marginBottom:"2px"});this.cm=CodeMirror(scil.Utils.createElement(c,"div"),this.options);this.cm.setSize(this.options.width,this.options.height)}},autoFormat:function(){if(this.cm==null){return}if(this.cm.autoFormatRange!=null){var c=this.cm.lineCount();this.cm.autoFormatRange({line:0,ch:0},{line:c})}},getValue:function(){return this.cm==null?this.textarea.value:this.cm.getValue()},setValue:function(c){if(c==null){c=""}if(this.cm==null){this.textarea.value=c}else{this.cm.setValue(c)}if(this.options.autoformat){this.autoFormat()}},clear:function(){this.setValue(null)}});scil.FileShelf=scil.extend(scil._base,{constructor:function(j,h){if(typeof(j)=="string"){j=scil.byId(j)}var g=this;this.options=h==null?{}:h;var l=this.options.width;if(l==null){l=600}var f=JSDrawServices.url;var d=this.options.group;if(this.options.listurl==null){this.options.listurl=f+"?cmd=fileshelf.list&group="+escape(d)+"&q={q}"}if(this.options.downloadurl==null){this.options.downloadurl=f+"?cmd=fileshelf.download&group="+escape(d)+"&path={fileid}"}if(this.options.previewajaxurl==null){this.options.previewajaxurl=f+"?cmd=fileshelf.preview&group="+escape(d)+"&path={path}"}if(this.options.previewpageurl==null){this.options.previewpageurl=f+"?cmd=fileshelf.previewpage&group="+escape(d)+"&path={path}"}var g=this;var c={filename:{label:"File Name",type:"file",width:l==0||this.options.compact?null:l*0.6,render:function(n,q){return"<files><file fileid='"+scil.Utils.escXmlValue(q.path)+"'>"+scil.Utils.escXmlValue(n)+"</file></files>"},options:{shortdisplay:false,downloadurl:this.options.downloadurl,onpreview:function(n){var q=n.fileid;scil.FilePreviewer.show(q,{url:g.options.previewajaxurl.replace("{path}",escape(q)),previewurl:g.options.previewpageurl.replace("{path}",escape(q))})}}}};if(!this.options.compact){c.filesize={label:"File Size",width:l==0?null:l*0.2,render:scil.Utils.formatFilesize};c.created={label:"Created Date",type:"date",width:l==0?null:l*0.2}}this.table=new scil.Table(true,this.options.showheader!=false);this.table.render(j,c);this.list(this.options.q)},list:function(d){this.table.clear();var c=this;if(d!=null&&d!=""){scil.Utils.jsonp(this.options.listurl.replace("{q}",d),function(f){if(f!="null"){c.table.setData(f)}})}}});scil.FieldSubform=scil.extend(scil._base,{constructor:function(g,f){if(typeof(g)=="string"){g=scil.byId(g)}this.options=f==null?null:f;var d=this;var c=this.options.viewonly?null:{src:scil.Utils.imgSrc("img/table.gif"),title:"Edit",onclick:function(){d.edit()}};if(this.options.preview!=false){this.previewspan=scil.Utils.createElement(g,"i",null,{color:"blue",fontSize:"80%"});new scil.TooltipForm(this.previewspan,{caption:"View "+(this.options.caption==null?"Data":this.options.caption),ongetfields:function(){return d.getFields()},ongetkey:function(){return d._valuecount+""},ongetdata:function(){return d.xmldata}})}scil.Utils.createButton(g,c);this.dlg=null;this.xmldata=null;this.fields=null;this._valuecount=0},edit:function(){if(this.options.onedit!=null&&!this.options.viewonly){this.options.onedit(this)}if(this.dlg==null){this.dlg=this.createDlg(this.options.viewonly)}this.dlg.show();this.dlg.form.setXml(this.xmldata);this.dlg.moveCenter()},createDlg:function(h){var g=this;var d=(h?"View":"Edit")+" "+(this.options.caption==null?"Data":this.options.caption);var c={label:h?"Dismiss":"Save",onclick:function(){g.save()}};if(this.fields!=null&&typeof(this.fields)=="object"){this.fields=scil.Utils.json2str(this.fields)}var f=this.getFields();if(f==null){scil.Utils.alert("No fields defined");return}return scil.Form.createDlgForm(d,f,c,h?{modal:false,noclose:true,hidelabel:true,viewonly:true}:null)},getFields:function(){var fields=this.fields!=null?this.fields:this.options.fields;if(typeof(fields)=="string"){fields=scil.Utils.eval(fields)}else{fields=scil.clone(fields)}return fields},save:function(){if(this.options.viewonly){this.dlg.hide();return}this.xmldata=this.dlg.form.getXml();this.dlg.hide();++this._valuecount;if(this.options.onchange!=null){this.options.onchange(this)}if(this.previewspan!=null&&!scil.Utils.isNullOrEmpty(this.xmldata)){var c=scil.Utils.parseXml(this.xmldata);this.preview(scil.Utils.getInnerText(c))}},getXml:function(){var c="";if(this.fields!=null){var d=this.fields;if(typeof(d)=="object"){d=scil.Utils.json2str(d)}c=" fields='"+scil.Utils.escXmlValue(d)+"'"}if(scil.Utils.isNullOrEmpty(c)&&scil.Utils.isNullOrEmpty(this.xmldata)){return null}return"<v"+c+">"+(this.xmldata==null?"":this.xmldata)+"</v>"},setXml:function(d){this.clear();var c=this.parseXml(d);if(c==null&&typeof(d)=="string"){c=this.parseXml(scil.Utils.unescXmlValue(d))}if(c==null){return}this.fields=c.getAttribute("fields");this.xmldata=scil.Utils.getInnerXml(c);this.preview(scil.Utils.getInnerText(c))},preview:function(d){if(this.previewspan==null){return}if(d==null){d=""}else{var c=this.options.previewlength;if(!(c>0)){c=20}if(d.length>c){d=d.substr(0,c-3)+"..."}d+=" "}this.previewspan.innerHTML=d},clear:function(){this.fields=null;this.xmldata=null;++this._valuecount},parseXml:function(d){if(typeof(d)=="string"){d=scil.Utils.parseXml(d)}if(d==null||d.tagName=="v"){return d}var c=d.getElementsByTagName("v");return c!=null?c[0]:null}});scil.FieldSignature=scil.extend(scil._base,{constructor:function(f,d){if(typeof(f)=="string"){f=scil.byId(f)}this.options=d==null?{}:d;this.signature=scil.Utils.createElement(f,"i",null,{fontSize:"85%",background:"#ddd"});this.dlg=null;if(!this.options.viewonly){var c=this;scil.Utils.createElement(f,"span","&nbsp;");scil.Utils.createButton(f,{label:"Sign",onclick:function(){c.sign()}})}},sign:function(d,g){if(this.dlg==null){var f=this;var c={note:{type:"html",template:"Please type your password:"},password:{type:"password",width:400,onenter:function(){f.sign2()}}};this.dlg=scil.Form.createDlgForm("Signature",c,{label:"Sign",onclick:function(){f.sign2()}},{hidelabel:true})}this.dlg.show();this.dlg.form.setData({})},sign2:function(){var c=this.dlg.form.getData();var f=this.options.url;if(f==null){f="ajax.ashx?cmd=user.signature"}var d=this;scil.Utils.ajax(f,function(g){d.setValue(g.signature);d.dlg.hide()},{password:c.password})},setValue:function(c){this.signature.innerHTML=c==null?"":c},getValue:function(){return this.signature.innerHTML}});scil.FieldTemplateText=scil.extend(scil._base,{constructor:function(f,d){if(typeof(f)=="string"){f=scil.byId(f)}var c=this;this.options=d==null?{}:d;this.selector=this.options.selector;if(typeof(this.selector)!="function"){this.selector=function(h){return c.defaultselector(h)}}var g=this.options.style==null?{}:this.options.style;if(this.options.width>0){g.width=this.options.width}if(this.options.height>0){g.height=this.options.height}this.div=scil.Utils.createElement(f,"div",null,g)},defaultselector:function(c){if(c==null){return false}var d=c.style.backgroundColor;d=d.toLowerCase();return d=="yellow"||d=="#ffff00"||d=="#ff0"||d=="rgb(255, 255, 0)"},onchange:function(c){if(this.options.onchange!=null){this.options.onchange(this,c)}},getValue:function(){this.makeEditable(this.div,false);var c=this.div.innerHTML;this.makeEditable(this.div,true);return c},setValue:function(c){this.div.innerHTML=c==null?"":c;this.makeEditable(this.div,true)},getXml:function(){return this.getValue()},setXml:function(c){this.getValue(c)},makeEditable:function(c,d){if(this.options.viewonly||c==null||c.tagName==null||c.style==null){return}var j=this;if(d){if(this.selector(c)){c.setAttribute("contenteditable","true");scil.connect(c,"onkeyup",function(f){j.onchange(f)});return}}else{if(c.getAttribute("contenteditable")=="true"){c.removeAttribute("contenteditable");return}}var h=c.childNodes;if(h==null){return}for(var g=0;g<h.length;++g){this.makeEditable(h[g],d)}}});scil.ConfigEditor={dlg:null,url:null,show:function(c){this.url=c==null?"JSDraw/Service.aspx?cmd=":c;this.create();this.dlg.show();this.load()},load:function(){var c=this;scil.Utils.ajax(this.url+"config.load",function(d){c.setXml(d)})},setXml:function(c){if(this.dlg.form.tabs.currenttab.getAttribute("key")=="tableview"){this.setXmlToTable(c)}else{this.setXmlToTextbox(c)}},getXml:function(){if(this.dlg.form.tabs.currenttab.getAttribute("key")=="tableview"){return this.getXmlFromTable()}else{return this.getXmlFromTextbox()}},setXmlToTextbox:function(d){var c=this.dlg.form.tabs.findTab("textview");c.form.fields.text.jsd.setValue(d)},getXmlFromTextbox:function(){var g=this.dlg.form.tabs.findTab("textview");var f=g.form.fields.text.jsd.getValue();if(scil.Utils.isNullOrEmpty(f)){return""}var c=scil.Utils.parseXml2(f);if(c!=null&&c.error!=null){scil.Utils.alert("Error: "+c.error);return null}return f},setXmlToTable:function(q){var l=this.dlg.form.tabs.findTab("tableview");var g=l.form.fields.table.jsd;g.clear();var c=scil.Utils.parseXml(q);if(c==null){return 0}var j=c.getElementsByTagName("add");if(j==null){return 0}for(var f=0;f<j.length;++f){var d=j[f];var h=d.getAttribute("key");var n=d.getAttribute("value");if(h!=""&&h!=null||n!=""&&n!=null){g.insert(null,{key:h,value:n})}}return j.length},getXmlFromTable:function(){var h=this.dlg.form.tabs.findTab("tableview");var d=h.form.fields.table.jsd;var g="<configuration>\n<appSettings>\n";for(var c=0;c<d.getRowCount();++c){var f=scil.Utils.trim(d.getCellValue(c,"key"));var j=scil.Utils.trim(d.getCellValue(c,"value"));if(f!=""&&j!=""){g+="<add key='"+scil.Utils.escXmlValue(f)+"' value='"+scil.Utils.escXmlValue(j)+"'/>\n"}}g+="</appSettings>\n</configuration>";return g},save:function(){var c=this.getXml();if(c==null){return}scil.Utils.ajax(this.url+"config.save",function(){scil.Utils.alert("Configuration saved")},{xml:c})},restart:function(){var c=this;scil.Utils.confirmYes("Restart the application?",function(){c.restart2(10)})},restart2:function(d){if(d<0){scil.Utils.alert("Refresh the browser page");return}var f=new Date().getTime();var c=this;scil.Utils.ajax(c.url+"config.restart",function(){if(new Date().getTime()-f>500){c.restart2(-1)}else{c.restart2(d-1)}})},create:function(){if(this.dlg!=null){return}var c=this;var d={tabs:{textview:{caption:"Text View",fields:{text:{type:"code",mode:"xml",width:800,height:500}},hidelabel:true},tableview:{caption:"Table View",fields:{table:{type:"jsdraw.table",options:{columns:[{caption:"key",width:200},{caption:"value",width:600}]}}},hidelabel:true}},buttons:[{label:"Save",onclick:function(){c.save()}},{label:"Restart App",onclick:function(){c.restart()}}],onbeforeshowtab:function(g,f){return c.onshowtab(g,f)}};this.dlg=scil.Form.createTabDlgForm("Config Editor",d)},onshowtab:function(g,c){if(this.dlg==null||this.dlg.form==null||this.dlg.form.tabs==null){return}var f=this.dlg.form.tabs.findTab("tableview");var h=this.dlg.form.tabs.findTab("textview");if(g==f){var d=this.getXmlFromTextbox();if(d==null){return false}this.setXmlToTable(this.getXmlFromTextbox())}else{this.setXmlToTextbox(this.getXmlFromTable())}return true}};scil.FloatingBox={targets:[],kFloatingSpeed:30,_hasinner:typeof(window.innerWidth)=="number",_haselement:typeof(document.documentElement)=="object"&&typeof(document.documentElement.clientWidth)=="number",simpleFloating:function(d,c){if(c>0){setTimeout(function(){scil.FloatingBox.simpleFloating(d)},c);return}if(typeof(d)=="string"){d=scil.byId(d)}if(d==null){return}var f=scil.Utils.getOffset(d,false);var g=scil.Utils.createElement(null,"div",null,{width:d.offsetWidth,height:d.offsetHeight});d.parentNode.insertBefore(g,d);d.style.position="fixed";d.style.left=f.x+"px";d.style.top=f.y+"px";d.style.zIndex=1},add:function(c,d){if(d==null){return}if(typeof(c)=="string"){c=scil.byId(c)}c.style.position="absolute";this.targets.push({obj:c,targetLeft:d.left,targetRight:d.right,targetTop:d.top,targetBottom:d.bottom,minLeft:d.minLeft,minTop:d.minTop,centerX:d.centerX,centerY:d.centerY,lockX:d.lockX,lockY:d.lockY,distance:d.distance!=undefined?d.distance:0.07000000000000001,snap:d.snap,ignoreParentDimensions:d.ignoreParentDimensions,updateParentHeight:d.updateParentHeight==undefined?false:d.updateParentHeight,confinementArea:d.confinementArea,confinementAreaId:d.confinementArea!=undefined&&d.confinementArea.substring(0,1)=="#"?d.confinementArea.substring(1):undefined,confinementAreaClassRegexp:d.confinementArea!=undefined&&d.confinementArea.substring(0,1)=="."?new RegExp("(^|\\s)"+d.confinementArea.substring(1)+"(\\s|$)"):undefined})},move:function(c){if(!c.lockX){c.obj.style.left=(c.minLeft!=null&&c.nextX<c.minLeft?c.minLeft:c.nextX)+"px";c.obj.style.right=""}if(!c.lockY){c.obj.style.top=(c.minTop!=null&&c.nextY<c.minTop?c.minTop:c.nextY)+"px";c.obj.style.bottom=""}},scrollLeft:function(c){var d=window.top;return this._hasinner?d.pageXOffset:(this._haselement?d.document.documentElement.scrollLeft:d.document.body.scrollLeft)},scrollTop:function(c){var d=window.top;return this._hasinner?d.pageYOffset:(this._haselement?d.document.documentElement.scrollTop:d.document.body.scrollTop)},windowWidth:function(){return this._haselement?document.documentElement.clientWidth:document.body.clientWidth},windowHeight:function(){if(this._haselement&&this._hasinner){return document.documentElement.clientHeight>window.innerHeight?window.innerHeight:document.documentElement.clientHeight}else{return this._haselement?document.documentElement.clientHeight:document.body.clientHeight}},documentHeight:function(){var f=this._hasinner?window.innerHeight:0;var c=document.body,d=document.documentElement;return Math.max(c.scrollHeight,c.offsetHeight,d.clientHeight,d.scrollHeight,d.offsetHeight,f)},documentWidth:function(){var f=this._hasinner?window.innerWidth:0;var c=document.body,d=document.documentElement;return Math.max(c.scrollWidth,c.offsetWidth,d.clientWidth,d.scrollWidth,d.offsetWidth,f)},calcCornerX:function(c){var d=c.obj.offsetWidth;var f=this.scrollLeft(c)-c.parentLeft;if(c.centerX){f+=(this.windowWidth()-d)/2}else{if(c.targetLeft==undefined){f+=this.windowWidth()-c.targetRight-d}else{f+=c.targetLeft}}if(document.body!=c.obj.parentNode&&f+d>=c.confinedWidthReserve){f=c.confinedWidthReserve-d}if(f<0){f=0}return f},calcCornerY:function(c){var d=c.obj.offsetHeight;var f=this.scrollTop(c)-c.parentTop;if(c.centerY){f+=(this.windowHeight()-d)/2}else{if(c.targetTop===undefined){f+=this.windowHeight()-c.targetBottom-d}else{f+=c.targetTop}}if(document.body!=c.obj.parentNode&&f+d>=c.confinedHeightReserve){f=c.confinedHeightReserve-d}if(f<0){f=0}return f},isConfinementArea:function(d,c){return d.confinementAreaId!=undefined&&c.id==d.confinementAreaId||d.confinementAreaClassRegexp!=undefined&&c.className&&d.confinementAreaClassRegexp.test(c.className)},computeParent:function(c){if(c.ignoreParentDimensions){c.confinedHeightReserve=this.documentHeight();c.confinedWidthReserver=this.documentWidth();c.parentLeft=0;c.parentTop=0;return}var g=c.obj.parentNode;var h=this.offsets(g,c);c.parentLeft=h.left;c.parentTop=h.top;c.confinedWidthReserve=g.clientWidth;var d=g;var f=this.offsets(d,c);if(c.confinementArea==undefined){while(d.clientHeight+f.top<c.obj.scrollHeight+h.top||c.obj.parentNode==d&&c.updateParentHeight&&d.clientHeight+f.top==c.obj.scrollHeight+h.top){d=d.parentNode;f=this.offsets(d,c)}}else{while(d.parentNode!=undefined&&!this.isConfinementArea(c,d)){d=d.parentNode;f=this.offsets(d,c)}}c.confinedHeightReserve=d.clientHeight-(h.top-f.top)},offsets:function(g,f){var h={left:0,top:0};if(window==window.top){return h}var d=window.top.document.body.getElementsByTagName("IFRAME");for(var c=0;c<d.length;c++){if(d[c].contentWindow!=window){continue}g=d[c];while(g.offsetParent){h.left+=g.offsetLeft;h.top+=g.offsetTop;g=g.offsetParent}}return h},doFloatSingle:function(f){if(f.updateParentHeight){f.obj.parentNode.style.minHeight=f.obj.scrollHeight+"px"}var g,h;this.computeParent(f);var c=this.calcCornerX(f);var d=this.calcCornerY(f);if(f.distance==0){f.nextX=c;f.nextY=d;this.move(f);return false}var g=(c-f.nextX)*f.distance;if(Math.abs(g)<0.5&&f.snap||Math.abs(c-f.nextX)<=1){g=c-f.nextX}var h=(d-f.nextY)*f.distance;if(Math.abs(h)<0.5&&f.snap||Math.abs(d-f.nextY)<=1){h=d-f.nextY}if(Math.abs(g)>0||Math.abs(h)>0){f.nextX+=g;f.nextY+=h;this.move(f);return true}return false},doFloat:function(){if(!this.started){this.started=true;for(var d=0;d<this.targets.length;d++){this.initOneBox(this.targets[d])}}var c=false;for(var d=0;d<this.targets.length;d++){if(this.doFloatSingle(this.targets[d])){c=true}}if(c){var g=this;setTimeout(function(){g.doFloat()},c?this.kFloatingSpeed:1000)}},initOneBox:function(c){this.computeParent(c);c.nextX=this.calcCornerX(c);c.nextY=this.calcCornerY(c);this.move(c)}};dojo.connect(window,"onscroll",function(){scil.FloatingBox.doFloat()});scil.ready(function(){if(!scil.Utils.isAndroid&&!scil.Utils.isIpad&&scil.FloatingBox.fixapptoolbar!=false){scil.FloatingBox.simpleFloating("__scil_toolbar",3000)}});scil.BusinessDay={weekholidays:{},weekendworkdays:{},addBusinessDays:function(g,d){var h=Math.abs(d);var l,c=0;var f=(d<0)?-1:1;var j=f*24*60*60*1000;while(c<h){g.setTime(g.getTime()+j);if(this.isWorkday(g)){++c}}return g},getBusinessDays:function(h,j){var d=new Date(h.getFullYear(),h.getMonth(),h.getDate());var g=new Date(j.getFullYear(),j.getMonth(),j.getDate());var l=g>=d;if(!l){var q=g;g=d;d=q}var c=0;var n=24*60*60*1000;d.setTime(d.getTime()+n);while(d<=g){if(this.isWorkday(d)){++c}d.setTime(d.getTime()+n)}return c*(l?1:-1)},isWorkday:function(f){if(f==null){return false}var c=f.getDay();if(c==0||c==6){return this.isWeekendWorkday(f)}else{return !this.isWeekHoliday(f)}return true},getHolidays:function(c){c=c||new Date().getFullYear();if(this.weekholidays[c+""]){return this.weekholidays[c+""]}return null},isWeekHoliday:function(c){var g=c.getFullYear();var h=g+"";if(!this.weekholidays[h]){this.weekholidays[h]=this.getHolidays(g)}var d=this.weekholidays[h];var f=(c.getMonth()+1)+"-"+c.getDate();return d!=null&&d[f]!=null},isWeekendWorkday:function(c){var g=c.getFullYear();var d=this.weekendworkdays[g+""];var f=(c.getMonth()+1)+"-"+c.getDate();return d!=null&&d[f]!=null}};scil.Calendar=scil.extend(scil._base,{constructor:function(d,c){if(typeof(d)=="string"){d=scil.byId(d)}this.parent=d;this.options=c==null?{}:c;if(this.options.cellwidth==null){this.options.cellwidth=100}if(this.options.cellheight==null){this.options.cellheight=65}this.date=new Date();this.events=this.options.events;this.monthview=new scil.Calendar.MonthView(this);this.yearview=new scil.Calendar.YearView(this);this.refresh(this.monthview)},setEvents:function(c){this.events=c;this.refresh()},refresh:function(d,c){if(d==this.monthview){this.monthview.parent.style.display="";this.yearview.parent.style.display="none";if(c>0){this.date.setFullYear(c)}this.curview=d}else{if(d==this.yearview){this.monthview.parent.style.display="none";this.yearview.parent.style.display="";this.curview=d}}if(this.curview!=null){this.curview.refresh()}}});scil.apply(scil.Calendar,{border:"solid 1px #ccc",months:["January","February","March","April","May","June","July","August","September","October","November","December"],weekdays:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]});scil.Calendar.MonthView=scil.extend(scil._base,{constructor:function(c){this.cur=null;this.parent=null;this.calendar=c;var j=this.calendar.parent;var h=this;var q=scil.Utils.createTable(j,0,1,{border:"solid 1px #eee",textAlign:"center"});this.parent=q.parentNode;var d=JsUtils.createElement(JsUtils.createElement(q,"tr"),"td");this.area=scil.Utils.createTable(d,0,0,{backgroundColor:"#fff"});dojo.connect(this.area.parentNode,"onclick",function(w){h.click(w)});dojo.connect(this.area.parentNode,"ondblclick",function(w){h.dblclick(w)});var f=JsUtils.createElement(JsUtils.createElement(this.area,"tr",null,{backgroundColor:"#ddd"}),"td",null,{padding:"5px"},{colSpan:7});var l={width:this.calendar.options.cellwidth,borderRight:scil.Calendar.border,borderBottom:scil.Calendar.border,fontWeight:"bold"};var n=scil.clone(l);n.background="#eee";var u=JsUtils.createElement(this.area,"tr");for(var g=0;g<7;++g){JsUtils.createElement(u,"td",JSDraw2.Language.res(scil.Calendar.weekdays[g]),g==0||g==6?n:l)}this.header=scil.Utils.createTable(f,0,0,{width:"100%"});u=JsUtils.createElement(this.header,"tr");var t=scil.Utils.createElement(u,"td",null,{textAlign:"left"});scil.Utils.createButton(t,{label:"Previous Year",type:"a",onclick:function(){h.nextYear(-1)}});scil.Utils.createElement(t,"span"," | ");scil.Utils.createButton(t,{label:"Previous Month",type:"a",onclick:function(){h.nextMonth(-1)}});scil.Utils.createElement(t,"span"," | ");scil.Utils.createButton(t,{label:"Today",type:"a",color:"gray",onclick:function(){h.setToday()}});this.title=JsUtils.createElement(u,"td",null,{textAlign:"center",fontWeight:"bold",fontSize:"125%"});var t=scil.Utils.createElement(u,"td",null,{textAlign:"right"});if(this.calendar.options.yearview){scil.Utils.createButton(t,{label:"Year View",type:"a",color:"gray",onclick:function(){h.yearview()}});scil.Utils.createElement(t,"span"," | ")}scil.Utils.createButton(t,{label:"Next Month",type:"a",onclick:function(){h.nextMonth(+1)}});scil.Utils.createElement(t,"span"," | ");scil.Utils.createButton(t,{label:"Next Year",type:"a",onclick:function(){h.nextYear(+1)}})},setToday:function(){this.calendar.date=new Date();if(this.calendar.options.onSetToday!=null){this.calendar.options.onSetToday(this.calendar.date)}else{this.refresh()}},yearview:function(){this.calendar.refresh(this.calendar.yearview)},nextYear:function(c){if(c!=1&&c!=-1){return}this.calendar.date=new Date(this.calendar.date.getFullYear()+c,this.calendar.date.getMonth(),this.calendar.date.getDate());if(this.calendar.options.onNextYear!=null){this.calendar.options.onNextYear(this.calendar.date)}else{this.refresh()}},nextMonth:function(c){if(c!=1&&c!=-1){return}var f=this.calendar.date.getFullYear();var d=this.calendar.date.getMonth()+c;if(d<0){d+=12;--f}if(d>11){d-=12;++f}this.calendar.date=new Date(f,d,this.calendar.date.getDate());if(this.calendar.options.onNextMonth!=null){this.calendar.options.onNextMonth(this.calendar.date)}else{this.refresh()}},getObj:function(d){var g=d.target||srcElement;if(g==null||g.tagName!="DIV"){return null}var c=g.getAttribute("cal");if(c!="area"&&c!="top"&&c!="evt"){return null}var f=c=="evt"?g.getAttribute("key"):null;var h=scil.Utils.getParent(g,"TD");return{cal:c,date:h.getAttribute("date"),src:g,key:f}},click:function(c){var d=this.getObj(c);if(d==null){return null}if(d.cal=="area"){if(this.cur!=null){this.cur.style.background=""}this.cur=d.src;if(this.cur!=null){this.cur.style.background=scil.App.config.frame}}c.preventDefault();if(this.calendar.options.onclick!=null){this.calendar.options.onclick(d.date,d.cal,d.key)}},dblclick:function(c){var d=this.getObj(c);if(d==null){return null}c.preventDefault();if(this.calendar.options.ondblclick!=null){this.calendar.options.ondblclick(d.date,d.cal,d.key)}},refresh:function(){var c=this.calendar.date;var w=c.getFullYear();var h=c.getMonth();var q=this.area;for(var g=q.childNodes.length-1;g>=2;--g){q.removeChild(q.childNodes[g])}var d=new Date();var t=d.getFullYear()==w&&d.getMonth()==h?d.getDate():null;d.setFullYear(w,h,1);var f=d.getDay();var l=new Date();l.setFullYear(h==11?w+1:w,h==11?0:h+1,1);var u=Math.round((l.getTime()-d.getTime())/1000/60/60/24);for(var g=0;g<f;++g){this.loadDay(null,false,g==f-1)}var j=0;var x=w+"-"+(h+1)+"-";for(var g=0;g<u;++g){this.loadDay(new Date(w,h,g+1),t==g+1,null,this.getEvents(x+(g+1)))}this.title.innerHTML=JSDraw2.Language.res(scil.Calendar.months[h])+", "+w},getEvents:function(c){if(this.calendar.events==null){return null}var g=[];var f=this.calendar.events;for(var d=0;d<f.length;++d){if(f[d].date==c){g.push(f[d])}}return g},loadDay:function(g,q,t,l){var y=this.area;var A=y.childNodes[y.childNodes.length-1];if(A.childNodes.length==7){A=JsUtils.createElement(y,"tr")}var w={borderRight:g==null?null:scil.Calendar.border,borderBottom:scil.Calendar.border};if(t){w.borderRight=scil.Calendar.border}var B=false;if(g!=null){if(!scil.BusinessDay.isWorkday(g)){w.background="#eee"}else{B=true}}var h=g==null?null:g.getFullYear()+"-"+(g.getMonth()+1)+"-"+g.getDate();var z=JsUtils.createElement(A,"td",null,w,{date:h});scil.Utils.createElement(z,"div",g==null?null:g.getDate(),{background:q?"#5f5":"#eee",textAlign:"right"},B?{cal:"top"}:null);var f=scil.Utils.createElement(z,"div",null,{height:this.calendar.options.cellheight,overflow:"hidden"},B?{cal:"area"}:null);if(l!=null&&l.length>0){var x={cursor:"pointer",fontSize:"80%",width:this.calendar.options.cellwidth,border:"solid 1px #aaf",whiteSpace:"nowrap",textAlign:"left"};for(var n=0;n<l.length;++n){var j=l[n];if(this.calendar.options.onrenderevent!=null){this.calendar.options.onrenderevent(j,width)}else{x.background=scil.Utils.isNullOrEmpty(j.color)?"#ffa":j.color;if(n>0){x.borderTop="none"}var u=j.time!=null?"["+j.time+"] ":"";u+=scil.Utils.isNullOrEmpty(j.label)?"Unnamed":j.label;var c=scil.Utils.createElement(f,"div",u,x,{cal:"evt",key:j.key});if(!scil.Utils.isNullOrEmpty(j.popup)){new scil.Popup(c,{html:j.popup})}else{if(!scil.Utils.isNullOrEmpty(j.title)){c.setAttribute("title",j.title)}}}}}else{f.innerHTML="&nbsp;"}}});scil.Calendar.YearView=scil.extend(scil._base,{constructor:function(c){this.cur=null;this.parent=null;this.calendar=c;var h=this.calendar.parent;var g=this;var j=scil.Utils.createTable(h,0,1,{border:"solid 1px #eee",textAlign:"center"});this.parent=j.parentNode;var d=JsUtils.createElement(JsUtils.createElement(j,"tr"),"td");this.area=scil.Utils.createTable(d,0,0,{backgroundColor:"#fff"});dojo.connect(this.area,"ondblclick",function(n){g.dblclick(n)});var f=JsUtils.createElement(JsUtils.createElement(this.area,"tr",null,{backgroundColor:"#ddd"}),"td",null,{padding:"5px"},{colSpan:6});this.header=scil.Utils.createTable(f,0,0,{width:"100%"});tr=JsUtils.createElement(this.header,"tr");var l=scil.Utils.createElement(tr,"td",null,{textAlign:"left"});scil.Utils.createButton(l,{label:"Prev",type:"a",onclick:function(){g.nextPage(-1)}});this.title=JsUtils.createElement(tr,"td",null,{textAlign:"center",fontWeight:"bold",fontSize:"125%"});var l=scil.Utils.createElement(tr,"td",null,{textAlign:"right"});scil.Utils.createButton(l,{label:"Month View",type:"a",color:"gray",onclick:function(){g.monthview()}});scil.Utils.createElement(l,"span"," | ");scil.Utils.createButton(l,{label:"Next",type:"a",onclick:function(){g.nextPage(+1)}})},monthview:function(){this.calendar.refresh(this.calendar.monthview)},nextPage:function(){},dblclick:function(c){var d=c.target||c.srcElement;var f=scil.Utils.getParent(d,"TD");var g=parseInt(f.getAttribute("year"));this.calendar.refresh(this.calendar.monthview,g)},refresh:function(){var f=this.calendar.date;var t=f.getFullYear();var l=this.area;for(var g=l.childNodes.length-1;g>=1;--g){l.removeChild(l.childNodes[g])}var q=t-10;var j={border:scil.Calendar.border,margin:"5px",width:this.calendar.options.cellwidth,"float":"left"};for(var g=0;g<4;++g){var n=scil.Utils.createElement(this.area,"tr");for(var h=0;h<6;++h){var c=scil.Utils.createElement(scil.Utils.createElement(n,"td"),"div",null,j,{year:q});scil.Utils.createElement(c,"div",q,{background:t==q?"#5f5":"#eee",textAlign:"right"});scil.Utils.createElement(c,"div","&nbsp;",{background:"#fff",textAlign:"right",height:this.calendar.options.cellheight});++q}}this.title.innerHTML=JSDraw2.Language.res("Year")+" "+(t-10)+" - "+(q-1)}});scil.Calendar.WeekView=scil.extend(scil._base,{constructor:function(c){this.cur=null;this.parent=null;this.calendar=c;var h=this.calendar.parent;var g=this;var j=scil.Utils.createTable(h,0,1,{border:"solid 1px #eee",textAlign:"center"});this.parent=j.parentNode;var d=JsUtils.createElement(JsUtils.createElement(j,"tr"),"td");this.area=scil.Utils.createTable(d,0,0,{backgroundColor:"#fff"});dojo.connect(this.area,"ondblclick",function(n){g.dblclick(n)});var f=JsUtils.createElement(JsUtils.createElement(this.area,"tr",null,{backgroundColor:"#ddd"}),"td",null,{padding:"5px"},{colSpan:6});this.header=scil.Utils.createTable(f,0,0,{width:"100%"});tr=JsUtils.createElement(this.header,"tr");var l=scil.Utils.createElement(tr,"td",null,{textAlign:"left"});scil.Utils.createButton(l,{label:"Prev",type:"a",onclick:function(){g.nextPage(-1)}});this.title=JsUtils.createElement(tr,"td",null,{textAlign:"center",fontWeight:"bold",fontSize:"125%"});var l=scil.Utils.createElement(tr,"td",null,{textAlign:"right"});scil.Utils.createButton(l,{label:"Month View",type:"a",color:"gray",onclick:function(){g.monthview()}});scil.Utils.createElement(l,"span"," | ");scil.Utils.createButton(l,{label:"Next",type:"a",onclick:function(){g.nextPage(+1)}})},monthview:function(){this.calendar.refresh(this.calendar.monthview)},nextPage:function(){},dblclick:function(c){var d=c.target||c.srcElement;var f=scil.Utils.getParent(d,"TD");var g=parseInt(f.getAttribute("year"));this.calendar.refresh(this.calendar.monthview,g)},refresh:function(){var f=this.calendar.date;var t=f.getFullYear();var l=this.area;for(var g=l.childNodes.length-1;g>=1;--g){l.removeChild(l.childNodes[g])}var q=t-10;var j={border:scil.Calendar.border,margin:"5px",width:this.calendar.options.cellwidth,"float":"left"};for(var g=0;g<4;++g){var n=scil.Utils.createElement(this.area,"tr");for(var h=0;h<6;++h){var c=scil.Utils.createElement(scil.Utils.createElement(n,"td"),"div",null,j,{year:q});scil.Utils.createElement(c,"div",q,{background:t==q?"#5f5":"#eee",textAlign:"right"});scil.Utils.createElement(c,"div","&nbsp;",{background:"#fff",textAlign:"right",height:this.calendar.options.cellheight});++q}}this.title.innerHTML=JSDraw2.Language.res("Year")+" "+(t-10)+" - "+(q-1)}});scil.FormDesigner={kWidth:1200,kWidthControl:900,kHeight:600,divControl:null,textAreaCode:null,divControlBox:null,divProperty:null,controlsDropDownList:null,id:1,form:null,dlg:null,callback:null,viewonly:false,show:function(d,c){if(this.dlg==null){var g=this;var f=scil.Utils.createElement(null,"div");scil.FormDesigner.init(f);scil.Utils.createButton(scil.Utils.createElement(f,"div",null,{textAlign:"center",paddingTop:"10px"}),{src:scil.App.imgSmall("submit.png"),label:"Save",onclick:function(){g.onsave()}});this.dlg=new scil.Dialog("Form Designer",f)}this.callback=c;this.dlg.show();this.setCode(d)},onsave:function(){if(this.callback!=null){this.callback(this.getCode())}this.dlg.hide()},setCode:function(c){this.textAreaCode.value=c==null?"":c;this.convertCodeToControl()},getCode:function(){return this.textAreaCode.value},init:function(d){var g=this;if(typeof(d)=="string"){d=scil.byId(d)}var j=JsUtils.createElement(d,"table",null,{width:g.kWidth,height:g.kHeight,border:"1px solid #000000",borderCollapse:"collapse"});var t=JsUtils.createElement(j,"tr");var n=JsUtils.createElement(t,"td",null,{border:"1px solid #000000"});g.divControl=JsUtils.createElement(n,"div",null,{width:g.kWidthControl,height:g.kHeight*2/3});g.divControl.style.position="relative";g.divControl.style.float="top";g.divControl.style.overflowY="auto";g.divControl.style.overflowX="auto";g.textAreaCode=JsUtils.createElement(n,"textarea",null,{width:g.kWidthControl-5,height:g.kHeight*1/3-5});g.textAreaCode.onblur=function(){var w=g.controlsDropDownList.value;g.convertCodeToControl();if(this.form!=null){this.form.selectrow(w)}};var q=JsUtils.createElement(t,"td",null,{border:"1px solid #000000"},{valign:"top"});var l=new scil.Tabs(q,{onShowTab:function(y,x){if(y.getAttribute("key")!="properties"){return}var w=g.controlsDropDownList.value;g.insertItem();if(g.selectedIsExitItem(g.controlsDropDownList,w)){g.addProperty(g.controlsDropDownList.value);g.controlsDropDownList.value=w}else{if(g.propertyParent!=null){g.propertyParent.innerHTML=""}}}});var c=l.addTab({caption:"Controls",tabkey:"controls"});var h=l.addTab({caption:"Properties",tabkey:"properties"});var u=g.kWidth-g.kWidthControl+1;var f=g.kHeight-20;g.createControlBox(u,f,c.clientarea);g.createProperty(u,f,h.clientarea)},createControlBox:function(w,f,l){var j=this;j.divControlBox=JsUtils.createElement(l,"div",null,{overflow:"auto",width:w,height:f,border:"1px solid #000000"});var n=JsUtils.createTable(this.divControlBox,null,null,{width:"100%"});n.parentNode.style.borderCollapse="collapse";scil.connect(n.parentNode,"onmouseover",function(){n.parentNode.style.cursor="default"});for(var h in j.controls){var d=j.controls[h];var u=JsUtils.createElement(n,"tr");var q=JsUtils.createElement(u,"td");if(d==null||d=="-"){q.colSpan=2;q.innerHTML="<hr style='margin:2px 0 2px 0'>";continue}var g=JsUtils.createElement(q,"img");var t=JsUtils.createElement(u,"td");g.src=scil.Utils.imgSrc("img/controls/"+d.icon);t.innerHTML=d.label;u.setAttribute("key",h);scil.connect(u,"ondblclick",function(c){var x=c.target||c.srcElement;var y=scil.Utils.getParent(x,"TR");if(y!=null){var z=y.getAttribute("key");j.createControl(z)}});scil.connect(u,"onclick",function(c){for(var x=0;x<n.childNodes.length;x++){n.childNodes[x].style.backgroundColor="#fff"}var y=c.target||c.srcElement;if(y.tagName=="IMG"){y=y.parentNode.parentNode}else{if(y.tagName=="TD"){y=y.parentNode}}if(y.tagName=="TR"){y.style.backgroundColor="#51b4fc"}})}},createControl:function(l){if(!this.controls){return}var l=l.replace(/^\n+|\n+$/g,"");if(!l){return}var c=this.getFormJS(this.textAreaCode.value);if(!c){c={}}var f={};var g=l.replace(".","_")+(++this.id);while(c[g]!=null){g=l+(++this.id)}var q=this.controls[l];for(var n in q){if(n=="attributes"||n=="icon"){continue}f[n]=q[n]}f.type=l;var d={};var h=false;for(var j in c){d[j]=c[j];if(this.controlsDropDownList.value==j){d[g]=f;h=true}}if(!h){d[g]=f}this.changeProperties(d,g)},changeProperties:function(c,d){this.textAreaCode.value=scil.Utils.json2str(c,true);this.convertCodeToControl();if(d){this.controlsDropDownList.value=d;this.form.selectrow(d)}},createProperty:function(g,c,f){var d=this;d.divProperty=JsUtils.createElement(f,"div","&nbsp;",{overflow:"auto",width:g,height:c,border:"1px solid #000000"});d.controlsDropDownList=JsUtils.createElement(d.divProperty,"select",null,{width:g});dojo.connect(d.controlsDropDownList,"onchange",function(h){d.selectedKeyChanged()})},selectedKeyChanged:function(){var c=this.controlsDropDownList.selectedIndex;if(c==0){this.form.selectedIndex=-1;if(this.propertyParent!=null){this.propertyParent.innerHTML=""}return}var d=this.controlsDropDownList.options[c].value;this.addProperty(d);if(this.form!=null){this.form.selectrow(d)}},insertItem:function(){var c=this.getFormJS(this.textAreaCode.value);var l=[];for(var g in c){l.push(g)}this.controlsDropDownList.options.length=0;var d=new Option("\n","\n");this.controlsDropDownList.options.add(d);if(l){for(var f=0;f<l.length;f++){var j=l[f];var h=c[l[f]].label;if(!this.selectedIsExitItem(this.controlsDropDownList,j)){var n=new Option(h,j);this.controlsDropDownList.options.add(n)}}}},selectedIsExitItem:function(c,g){var f=false;for(var d=0;d<c.options.length;d++){if(c.options[d].value==g){f=true;break}}return f},addProperty:function(g){var h=this;var c=this.getFormJS(this.textAreaCode.value);if(!c||!c[g]){return}if(this.propertyParent==null){this.propertyParent=JsUtils.createElement(this.divProperty,"div")}else{this.propertyParent.innerHTML=""}h.createMoveToolBar(this.propertyParent);var d=h.getProperty(g,c[g]);if(!d){return}var f=new scil.Form({viewonly:false});f.render(this.propertyParent,d,{buttons:{label:"Save",width:75,height:25,onclick:function(j){var l=f.getData(true);h.getChangeValues(l)}},immediately:true})},createMoveToolBar:function(l){var n=JsUtils.createElement(l,"div");n.style.background="#f5f5f5";var c=JsUtils.createElement(n,"img",null,{marginLeft:"5px",marginTop:"5px"},{title:JSDraw2.Language.res("Move Up"),src:scil.Utils.imgSrc("img/controls/moveup3.gif")});var d=JsUtils.createElement(n,"img",null,{marginLeft:"5px",marginTop:"5px"},{title:JSDraw2.Language.res("Move Down"),src:scil.Utils.imgSrc("img/controls/movedown3.gif")});var f=JsUtils.createElement(n,"img",null,{marginLeft:"5px",marginTop:"5px"},{title:JSDraw2.Language.res("Move to Top"),src:scil.Utils.imgSrc("img/controls/movetop3.gif")});var g=JsUtils.createElement(n,"img",null,{marginLeft:"5px",marginTop:"5px"},{title:JSDraw2.Language.res("Move to Bottom"),src:scil.Utils.imgSrc("img/controls/movebottom3.gif")});var h=JsUtils.createElement(n,"img",null,{marginLeft:"5px",marginTop:"5px"},{title:JSDraw2.Language.res("Delete"),src:scil.Utils.imgSrc("img/controls/close.gif")});var j=this;dojo.connect(c,"onclick",function(){var q=j.controlsDropDownList.value;j.moveItems(q,-1);c.style.border="#1px solid #000"});dojo.connect(d,"onclick",function(){var q=j.controlsDropDownList.value;j.moveItems(q,1)});dojo.connect(f,"onclick",function(){var q=j.controlsDropDownList.value;j.moveItems(q,"top")});dojo.connect(g,"onclick",function(){var q=j.controlsDropDownList.value;j.moveItems(q,"bottom")});dojo.connect(h,"onclick",function(){JsUtils.confirmYes("Delete this item?",function(){var q=j.controlsDropDownList.value;j.moveItems(q,0)})})},moveItems:function(f,j){var t=f.replace(/^\n+|\n+$/g,"");if(!t){return}var c=this.getFormJS(this.textAreaCode.value);var n=[];for(var l in c){n.push(l)}if(j==-1){for(var g=0;g<n.length;g++){if(n[g]==f&&g>0){var u=n[g];var w=n[g+j];n[g+j]=u;n[g]=w;break}}}else{if(j==1){for(var g=0;g<n.length;g++){if(n[g]==f&&g<n.length-1){var u=n[g];var w=n[g+j];n[g+j]=u;n[g]=w;break}}}else{if(j=="top"){var h=n.indexOf(f);n.splice(h,1);var q=new Array();q.push(f);for(var g=0;g<n.length;g++){q.push(n[g])}n=q}else{if(j=="bottom"){var h=n.indexOf(f);n.splice(h,1);var q=new Array();for(var g=0;g<n.length;g++){q.push(n[g])}q.push(f);n=q}else{if(j==0){var h=n.indexOf(f);n.splice(h,1)}}}}}var d={};for(var g=0;g<n.length;g++){d[n[g]]=c[n[g]]}this.changeProperties(d,f);if(j==0){if(this.propertyParent!=null){this.propertyParent.innerHTML=""}}},getProperty:function(n,d){var q=this;type=this.realType(d.type);if(!this.controls[type]){alert("This control is not in the control box.");return}var g={};var c=scil.clone(this.controls[type].attributes);if(type!="group"){c.splice(0,0,{name:"key",label:"Key",type:"input"});c.push({name:"colspan",label:"Colspan",type:"number"})}if(this.controls[type].attributes){for(var h=0;h<c.length;h++){var f={};var t=c[h].name;for(var u in c[h]){f[u]=c[h][u]}switch(t){case"key":f.value=n;break;case"type":f.items=this.getTypes();f.value=type;break;case"unit":f.items=this.getUnits();f.value=d[t];break;case"items":case"units":if(type=="select"||type=="dropdowninput"||type=="editableselect"||type=="dropdowncheck"||type=="multiselect"||type=="number"){f.value="";for(var l in d[t]){f.value+=d[t][l];if(l<d[t].length-1){f.value+="\n"}}}else{if(type=="table"){f.button={label:"...",onclick:function(){q.setTable()}}}else{if(type=="jsdraw.table"){f.button={label:"...",onclick:function(){q.setJsDrawTable()}}}}}break;default:f.value=d[t];break}if(f.type!="checkbox"){f.width=160}g[t]=f}}return g},getChangeValues:function(q){var c=this.getFormJS(this.textAreaCode.value);if(!c){return}var n=this.controlsDropDownList.value;var n=n.replace(/^\n+|\n+$/g,"");if(!n){return}var l=c[n].type;var j=q.key;for(var h in q){switch(h){case"key":c=this.changeKeyValue(c,n,j);break;case"type":c[j][h]=this.realType(q[h]);break;case"items":case"units":if(scil.Utils.isNullOrEmpty(q[h])){c[j][h]=null}else{if(type=="select"||type=="dropdowninput"||type=="editableselect"||type=="dropdowncheck"||type=="multiselect"||type=="number"){var f=scil.Utils.trim(q[h]).split("\n");var g=[];for(var d in f){g.push(scil.Utils.trim(f[d]))}c[j][h]=g}}break;default:if(q[h]){c[j][h]=q[h]}else{if(h=="required"){c[j][h]=null}}break}}this.changeProperties(c,n);if(l!=c[j].type){this.addProperty(j)}},changeKeyValue:function(c,h,g){var d={};for(var f in c){if(f==h){d[g]=c[f]}else{d[f]=c[f]}}return d},getTableColTypes:function(){var d=[];for(var c in scil.FormDesigner.controls){var f=scil.FormDesigner.controls[c];if(c=="note"||c=="group"||f=="-"||f==null||scil.Utils.startswith(c,"jsdraw")){continue}d.push(c)}return d},setTable:function(){var u=this;var A=this.controlsDropDownList.value;var t=A.replace(/^\n+|\n+$/g,"");if(!t){return}var q=this.getFormJS(this.textAreaCode.value);if(!q||!q[t]){return}var h=JsUtils.createElement(null,"div");var z=JsUtils.createElement(h,"div");var g={key:{label:"Column Key",type:"input",width:120},label:{label:"Column Label",type:"input",width:120},type:{label:"Type",type:"select",options:this.getTableColTypes(),width:120,onchange:function(c){u.selectInTableOnChange(w,c)}},width:{label:"Width",type:"input",width:120},items:{label:"Items",type:"input",width:300},viewonly:{label:"View Only",type:"checkbox",width:50},};var y=q[t].columns;var w=new scilligence.Table(false,true);w.render(z,g);var x=[];for(var f in y){var n="";if(y[f].type=="select"){if(y[f].items){for(var l in y[f].items){if(l==0){n+=y[f].items[l]}else{n+=","+y[f].items[l]}}}}x.push({key:f,label:y[f].label,type:y[f].type,items:n,width:y[f].width,viewonly:y[f].viewonly})}w.setData(x);var d=JsUtils.createElement(JsUtils.createElement(h,"div",null,{textAlign:"center"}),"button","OK",{width:"100px"});var j=new scilligence.Dialog("Setting",h);dojo.connect(d,"onclick",function(c){u.buildTable(w,A);j.hide()});j.show()},setJsDrawTable:function(){var f=this.controlsDropDownList.value;var c=this.form.fields[f];if(c==null||c.jsd==null){return}var d=this;c.jsd.defineCols(function(){var g=d.getFormJS(d.textAreaCode.value);if(!g||!g[f]){return}g[f].options.columns=scil.clone(c.jsd.columns);d.changeProperties(g,f)})},selectInTableOnChange:function(d,c){},buildTable:function(h,f){var n=h.getData();if(n==null||n.length==0){return}var j={};for(var c=0;c<n.length;++c){var l=scil.clone(n[c]);if(scil.Utils.isNullOrEmpty(l.key)){continue}var g=null;if(!scil.Utils.isNullOrEmpty(l.items)){g=l.items.split(",")}j[l.key]={label:l.label,type:l.type,width:l.width,viewonly:l.viewonly,items:g}}var d=this.getFormJS(this.textAreaCode.value);if(!d||!d[f]){return}d[f].columns=j;this.changeProperties(d,f)},buildJsDrawTable:function(g,f){var j=g.tbody;var h={};for(var c=1;c<j.childNodes.length;++c){var l=j.childNodes[c];if(l.childNodes[0].firstChild.value==""){continue}h[l.childNodes[0].firstChild.value]={label:l.childNodes[0].firstChild.value,type:l.childNodes[1].firstChild.value,width:l.childNodes[2].firstChild.value,viewonly:l.childNodes[3].firstChild.value}}var d=this.getFormJS(this.textAreaCode.value);if(!d||!d[f]){return}d[f].options.columns=h;this.changeProperties(d,f)},setCodeToStr:function(l){var h="{\n";var c=0;for(var f in l){if(c++>0){h+=",\n"}h+=f+": { ";var d=0;for(var g in l[f]){if(d++>0){h+=", "}if(g=="items"){h+="items: ["+l[f][g]+"]"}else{if(g=="required"){h+="required:"+l[f][g]}else{if(g=="columns"){h+=this.tableToCode(l[f][g])}else{if(g=="options"){}else{h+=g+': "'+l[f][g]+'"'}}}}}h+=" }"}h+="\n}";return h},tableToCode:function(c){var q="";q+="columns: {\n";var d=0;for(var l in c){if(d++>0){q+=",\n"}q+=l+": { ";var g=0;for(var n in c[l]){if(g++>0){q+=", "}if(n=="items"){q+="items: [";var h=0;for(var f in c[l][n]){if(h++>0){q+=","}q+=scil.Utils.json2str(f)+'"'}q+="]"}else{if(n=="required"){q+="required:"+c[l][n]}else{if(n=="columns"){q+=this.tableToCode(c[l][n])}else{q+=n+': "'+c[l][n]+'"'}}}}q+="}"}q+="}";return q},convertCodeToControl:function(){var d=this;this.divControl.innerHTML="";var c=this.getFormJS(this.textAreaCode.value);this.form=new scil.Form({viewonly:d.viewonly,viewonly:false,onselectrow:function(f){for(var g in d.form.items){if(d.form.items[g]==f){d.controlsDropDownList.value=g;d.selectedKeyChanged()}}}});this.form.render(this.divControl,c,{immediately:true});if(c){this.insertItem()}},getFormJS:function(s){if(s==null||s==""){return}try{eval("var temp="+s);form=temp;return form}catch(e){scil.Utils.alert("ERROR: "+e)}},getUnits:function(){var c=new Array();c.push("ug");c.push("mg");c.push("g");c.push("kg");c.push("uL");c.push("mL");c.push("L");c.push("cm");c.push("dm");c.push("m");c.push("km");c.push("°C");c.push("°F");c.push("g/mL");c.push("M");return c},realType:function(c){if(!c){c="input"}return c},getTypes:function(){var d=new Array();for(var c in this.controls){d.push(c)}return d}};scil.FormDesigner.controls={input:{label:"Inputbox",icon:"input.gif",attributes:[{name:"label",label:"Label",type:"input"},{name:"required",label:"Required",type:"checkbox"},{name:"type",label:"Type",type:"select"},{name:"width",label:"Width",type:"number"}]},number:{label:"Number",icon:"number.gif",attributes:[{name:"label",label:"Label",type:"input"},{name:"required",label:"Required",type:"checkbox"},{name:"type",label:"Type",type:"select"},{name:"width",label:"Width",type:"number"},{name:"unit",label:"Unit",type:"dropdowninput"},{name:"units",label:"Unit Options",type:"textarea",height:100},{name:"min",label:"Min Value",type:"number"},{name:"max",label:"Max Value",type:"number"},{name:"allowoperator",label:"Allow Operator",type:"checkbox"}]},checkbox:{label:"CheckBox",icon:"checkbox.png",attributes:[{name:"label",label:"Label",type:"input"},{name:"required",label:"Required",type:"checkbox"},{name:"type",label:"Type",type:"select"},{name:"width",label:"Width",type:"number"}]},textarea:{label:"Multiline Text",icon:"multiline.gif",attributes:[{name:"label",label:"Label",type:"input"},{name:"required",label:"Required",type:"checkbox"},{name:"type",label:"Type",type:"select"},{name:"width",label:"Width",type:"number"},{name:"height",label:"Height",type:"number"}]},htmltext:{label:"Html Editor",icon:"htmleditor.png",attributes:[{name:"label",label:"Label",type:"input"},{name:"required",label:"Required",type:"checkbox"},{name:"type",label:"Type",type:"select"},{name:"width",label:"Width",type:"number"},{name:"height",label:"Height",type:"number"},{name:"value",label:"Value",type:"textarea"}]},sep4:"-",richtext:{label:"Rich Text",icon:"richtext.gif",attributes:[{name:"label",label:"Label",type:"input"},{name:"required",label:"Required",type:"checkbox"},{name:"type",label:"Type",type:"select"},{name:"width",label:"Width",type:"number"},{name:"height",label:"Height",type:"number"}]},tabtext:{label:"Tab Text",icon:"tabtext.png",attributes:[{name:"label",label:"Label",type:"input"},{name:"required",label:"Required",type:"checkbox"},{name:"type",label:"Type",type:"select"},{name:"width",label:"Width",type:"number"},{name:"height",label:"Height",type:"number"}]},plaintext:{label:"Plain Text",icon:"plaintext.png",attributes:[{name:"label",label:"Label",type:"input"},{name:"required",label:"Required",type:"checkbox"},{name:"type",label:"Type",type:"select"},{name:"width",label:"Width",type:"number"},{name:"height",label:"Height",type:"number"}]},html:{label:"Html",icon:"html.png",attributes:[{name:"label",label:"Label",type:"input"},{name:"template",label:"Template",type:"input"},{name:"width",label:"Width",type:"number"},{name:"height",label:"Height",type:"number"},{name:"value",label:"Value",type:"textarea"}]},note:{label:"Note",icon:"note.png",attributes:[{name:"label",label:"Text",type:"textarea"},{name:"color",label:"Color",type:"color"}]},group:{label:"Group",icon:"group.gif",attributes:[{name:"label",label:"Label",type:"input"}]},sep5:"-",radio:{label:"Radio",icon:"radio.gif",attributes:[{name:"label",label:"Label",type:"input"},{name:"required",label:"Required",type:"checkbox"},{name:"type",label:"Type",type:"select"},{name:"width",label:"Width",type:"number"}]},hidden:{label:"Hidden",icon:"hidden.gif",attributes:[{name:"label",label:"Label",type:"input"},{name:"required",label:"Required",type:"checkbox"},{name:"type",label:"Type",type:"select"},{name:"width",label:"Width",type:"number"}]},color:{label:"Color",icon:"color.gif",attributes:[{name:"label",label:"Label",type:"input"},{name:"required",label:"Required",type:"checkbox"},{name:"type",label:"Type",type:"select"},{name:"width",label:"Width",type:"number"}]},date:{label:"Date",icon:"date.gif",attributes:[{name:"label",label:"Label",type:"input"},{name:"required",label:"Required",type:"checkbox"},{name:"type",label:"Type",type:"select"},{name:"width",label:"Width",type:"number"}]},table:{label:"Table",icon:"table.gif",columns:{column1:{label:"Input",type:"input",width:150},column3:{label:"Select",type:"select",width:150,items:["Items1","Items2","Items3"]},column4:{label:"Checkbox",type:"checkbox",width:50}},attributes:[{name:"label",label:"Label",type:"input"},{name:"required",label:"Required",type:"checkbox"},{name:"type",label:"Type",type:"select"},{name:"width",label:"Width",type:"number"},{name:"height",label:"Height",type:"number"},{name:"items",label:"Items",type:"text"}]},sep3:"-",select:{label:"Select",icon:"select.gif",items:["Items1","Items2","Items3"],attributes:[{name:"label",label:"Label",type:"input"},{name:"required",label:"Required",type:"checkbox"},{name:"type",label:"Type",type:"select"},{name:"width",label:"Width",type:"number"},{name:"items",label:"Items",type:"textarea",height:100}]},editableselect:{label:"Editable Select",icon:"select.gif",items:["Items1","Items2","Items3"],attributes:[{name:"label",label:"Label",type:"input"},{name:"required",label:"Required",type:"checkbox"},{name:"type",label:"Type",type:"select"},{name:"width",label:"Width",type:"number"},{name:"items",label:"Items",type:"textarea",height:100}]},multiselect:{label:"Multi Select",icon:"select.gif",items:["Items1","Items2","Items3"],attributes:[{name:"label",label:"Label",type:"input"},{name:"required",label:"Required",type:"checkbox"},{name:"type",label:"Type",type:"select"},{name:"width",label:"Width",type:"number"},{name:"items",label:"Items",type:"textarea",height:100}]},dropdowninput:{label:"Dropdown Input",icon:"select.gif",items:["Items1","Items2","Items3"],attributes:[{name:"label",label:"Label",type:"input"},{name:"required",label:"Required",type:"checkbox"},{name:"type",label:"Type",type:"select"},{name:"width",label:"Width",type:"number"},{name:"items",label:"Items",type:"textarea",height:100}]},dropdowncheck:{label:"Dropdown Check",icon:"select.gif",items:["Items1","Items2","Items3"],attributes:[{name:"label",label:"Label",type:"input"},{name:"required",label:"Required",type:"checkbox"},{name:"type",label:"Type",type:"select"},{name:"width",label:"Width",type:"number"},{name:"items",label:"Items",type:"textarea",height:100}]},sep2:"-",jsdraw:{label:"JSDraw Editor",icon:"jsdraw.gif",attributes:[{name:"label",label:"Label",type:"input"},{name:"required",label:"Required",type:"checkbox"},{name:"type",label:"Type",type:"select"},{name:"width",label:"Width",type:"number"},{name:"height",label:"Height",type:"number"},{name:"biology",label:"Biology Features",type:"checkbox"},{name:"rxn",label:"Reaction Features",type:"checkbox"},{name:"scale",label:"Scale",type:"number"},{name:"skin",label:"Skin",type:"select",items:["","w8","si"]},{name:"showcarbon",label:"Show Carbon",type:"select",items:["","terminal","all"]},{name:"showimplicithydrogens",label:"Show Implicit Hydrogens",type:"checkbox"},{name:"sendquery",label:"Send Query",type:"checkbox"},{name:"inktools",label:"Ink Tools",type:"checkbox"},{name:"background",label:"Background Color",type:"color"},]},"jsdraw.table":{label:"JSDraw Table",icon:"table2.gif",options:{searchable:true,columns:[{key:"input",caption:"Input",type:"input",width:150},{key:"date",caption:"Date",type:"date",width:150},{key:"f",caption:"F",type:"checkbox",width:50}],appendingmode:true},attributes:[{name:"label",label:"Label",type:"input"},{name:"required",label:"Required",type:"checkbox"},{name:"type",label:"Type",type:"select"},{name:"width",label:"Width",type:"number"},{name:"height",label:"Height",type:"number"},{name:"items",label:"Items",type:"text"}]},"jsdraw.se":{label:"JSDraw Sequence Editor",icon:"sequence.gif",attributes:[{name:"label",label:"Label",type:"input"},{name:"required",label:"Required",type:"checkbox"},{name:"type",label:"Type",type:"select"},{name:"width",label:"Width",type:"number"},{name:"height",label:"Height",type:"number"}]},sketches:{label:"Sketches",icon:"sketches.gif",attributes:[{name:"label",label:"Label",type:"input"},{name:"required",label:"Required",type:"checkbox"},{name:"type",label:"Type",type:"select"},{name:"width",label:"Width",type:"number"},{name:"height",label:"Height",type:"number"}]},plate:{label:"Assay Plate",icon:"plate.gif",attributes:[{name:"label",label:"Label",type:"input"},{name:"required",label:"Required",type:"checkbox"},{name:"type",label:"Type",type:"select"},{name:"size",label:"Size",type:"select",items:["","24","96","384"]},{name:"rows",label:"Rows",type:"number"},{name:"cols",label:"Cols",type:"number"}]},plates:{label:"Assay Plates",icon:"plates.gif",attributes:[{name:"label",label:"Label",type:"input"},{name:"required",label:"Required",type:"checkbox"},{name:"type",label:"Type",type:"select"},{name:"size",label:"Size",type:"select",items:["","24","96","384"]},{name:"rows",label:"Rows",type:"number"},{name:"cols",label:"Cols",type:"number"},{name:"showtable",label:"Show Table",type:"checkbox"}]},sep1:"-",file:{label:"File",icon:"file.gif",attributes:[{name:"label",label:"Label",type:"input"},{name:"required",label:"Required",type:"checkbox"},{name:"type",label:"Type",type:"select"},{name:"maxcount",label:"Max Count",type:"number"},{name:"width",label:"Width",type:"number"},{name:"height",label:"Height",type:"number"}]},filelink:{label:"File Link",icon:"filelink.gif",attributes:[{name:"label",label:"Label",type:"input"},{name:"required",label:"Required",type:"checkbox"},{name:"type",label:"Type",type:"select"},{name:"maxcount",label:"Max Count",type:"number"},{name:"source",label:"Source",type:"input"},{name:"width",label:"Width",type:"number"},{name:"height",label:"Height",type:"number"}]},filedblink:{label:"File DB Link",icon:"filelink.gif",attributes:[{name:"label",label:"Label",type:"input"},{name:"required",label:"Required",type:"checkbox"},{name:"type",label:"Type",type:"select"},{name:"maxcount",label:"Max Count",type:"number"},{name:"source",label:"Source",type:"input"},{name:"width",label:"Width",type:"number"},{name:"height",label:"Height",type:"number"}]},filepath:{label:"File Path",icon:"filelink.gif",attributes:[{name:"label",label:"Label",type:"input"},{name:"required",label:"Required",type:"checkbox"},{name:"type",label:"Type",type:"select"},{name:"maxcount",label:"Max Count",type:"number"},{name:"source",label:"Source",type:"input"},{name:"width",label:"Width",type:"number"},{name:"height",label:"Height",type:"number"}]},image:{label:"Image",icon:"img.gif",attributes:[{name:"label",label:"Label",type:"input"},{name:"required",label:"Required",type:"checkbox"},{name:"type",label:"Type",type:"select"},{name:"maxcount",label:"Max Count",type:"number"},{name:"width",label:"Width",type:"number"},{name:"height",label:"Height",type:"number"}]}};if(typeof(__JSDraw2_TouchMol)=="undefined"){dojo.require("dojox.charting.Chart");dojo.require("dojox.charting.plot2d.Areas");dojo.require("dojox.charting.plot2d.StackedAreas");dojo.require("dojox.charting.plot2d.Bars");dojo.require("dojox.charting.plot2d.ClusteredBars");dojo.require("dojox.charting.plot2d.Columns");dojo.require("dojox.charting.plot2d.ClusteredColumns");dojo.require("dojox.charting.plot2d.StackedColumns");dojo.require("dojox.charting.plot2d.Lines");dojo.require("dojox.charting.plot2d.StackedLines");dojo.require("dojox.charting.plot2d.Markers");dojo.require("dojox.charting.plot2d.MarkersOnly");dojo.require("dojox.charting.plot2d.Pie");dojo.require("dojox.charting.plot2d.Scatter");dojo.require("dojox.charting.plot2d.Grid");dojo.require("dojox.charting.plot2d.Spider");dojo.require("dojox.charting.plot2d.Bubble");dojo.require("dojox.charting.axis2d.Default");dojo.require("dojox.charting.action2d.Highlight");dojo.require("dojox.charting.action2d.Tooltip");dojo.require("dojox.charting.action2d.MoveSlice");dojo.require("dojox.charting.action2d.Magnify");dojo.require("dojox.charting.widget.Legend");dojo.require("dojox.charting.themes.Claro")}scil.Chart=scil.extend(scil._base,{constructor:function(d,c){scil.Chart.addStylesheet();if(typeof(d)=="string"){d=scil.byId(d)}this.parent=d;this.loadData(c)},loadData:function(c){this.options=c==null?{}:c;if(this.options.series!=null){this.render()}else{this.loadDataFromUrl(this.options.ajax==null?null:this.options.ajax.url,this.options.ajax.data)}},loadDataFromUrl:function(f,c){if(scil.Utils.isNullOrEmpty(f)){return false}this.options.series=null;var d=this;scil.Utils.jsonp(f,function(n){if(n==null||n.length==null||n.length==0){return}if(typeof(n[0])!="object"){d.options.series=[{data:n}]}else{var l=[];for(var j in n[0]){l.push(j)}var q=l[0];var g=[];for(var h=0;h<n.length;++h){g.push(n[h][q])}d.options.series=[];if(l.length==1){d.options.series.push({label:q,data:g})}else{d.options.xlabels=g;for(var j=1;j<l.length;++j){var g=[];var t=l[j];for(var h=0;h<n.length;++h){g.push(n[h][t])}d.options.series.push({label:t,data:g})}}}d.render()},c)},downloadImage:function(){if(JSDrawServices.url==null||JSDrawServices.url==""){scil.Utils.alert("JSDraw web service is not available");return}var c="<div style='width:"+this.parent.offsetWidth+"px'>"+this.parent.innerHTML+"</div>";scil.Utils.post(JSDrawServices.url+"?cmd=html2image",{html:c,css:scil.Chart.getCss(),width:this.parent.offsetWidth})},render:function(){scil.Utils.removeAll(this.parent);var u=null;switch(this.options.type){case"column":u=dojox.charting.plot2d.Columns;break;case"clusteredcolumn":u=dojox.charting.plot2d.ClusteredColumns;break;case"stackedcolumn":u=dojox.charting.plot2d.StackedColumns;break;case"bar":u=dojox.charting.plot2d.Bars;break;case"clusteredbar":u=dojox.charting.plot2d.ClusteredBars;break;case"line":u=dojox.charting.plot2d.Lines;break;case"stackedline":u=dojox.charting.plot2d.StackedLines;break;case"area":u=dojox.charting.plot2d.Areas;break;case"stackedarea":u=dojox.charting.plot2d.StackedAreas;break;case"scatter":u=dojox.charting.plot2d.Scatter;break;case"grid":u=dojox.charting.plot2d.Grid;break;case"spider":u=dojox.charting.plot2d.Spider;break;case"bubble":u=dojox.charting.plot2d.Bubble;break;case"pie":u=dojox.charting.plot2d.Pie;if(!(this.options.radius>0)){this.options.radius=100}break}if(!scil.Utils.isNullOrEmpty(this.options.title)){scil.Utils.createElement(this.parent,"h3",scil.Lang.res(this.options.title),{margin:0,textAlign:"center",fontSize:this.options.titlesize>0?this.options.titlesize+"px":null})}var g=scil.Utils.createElement(this.parent,"div");if(this.options.width>0){this.parent.style.width=this.options.width+"px"}if(this.options.height>0){g.style.height=this.options.height+"px"}var d=new dojox.charting.Chart(g);if(this.options.theme!=null){d.setTheme(dojox.charting.themes[this.options.theme])}else{d.setTheme(dojox.charting.themes.Claro)}if(this.options.fontcolor==null){this.options.fontcolor="blue"}var c={type:u,markers:true,gap:this.options.gap>0?this.options.gap:5,radius:this.options.radius>0?this.options.radius:null,htmlLabels:true,fontColor:this.options.fontcolor,labelWiring:this.options.fontcolor,animate:this.options.animate};if(this.options.linewidth>0){c.stroke={width:this.options.linewidth}}if(this.options.labelstyle!=null){c.labelStyle=this.options.labelstyle}if(this.options.shadow!=false){c.shadow={dx:2,dy:2,width:2,color:[0,0,0,0.3]}}d.addPlot("default",c);if(this.options.plots!=null){for(var j in this.options.plots){d.addPlot(j,this.options.plots[j])}}var y={};var A={vertical:true,fixLower:"major",fixUpper:"major"};if(this.options.xmin!=null){y.min=this.options.xmin}if(this.options.xmax!=null){y.max=this.options.xmax}if(this.options.xtitle!=null){y.title=this.options.xtitle;y.titleOrientation="away";y.titleGap=1}if(this.options.ymin!=null){A.min=this.options.ymin}if(this.options.ymax!=null){A.max=this.options.ymax}if(this.options.ytitle!=null){A.title=scil.Lang.res(this.options.ytitle);A.titleGap=5}var q=this.options.series;var z=this.options.xlabels;if(q[0].data!=null&&q[0].data.length==null){z=[];var x=[];var f=q[0].data;for(var j in f){z.push(j);x.push(f[j])}var t=[];for(var h=0;h<q.length;++h){if(h>0){x=[];f=q[h].data;for(var j=0;j<z.length;++j){var w=f[z[j]];x.push(w==null?0:w)}}t.push({label:scil.Lang.res(q[h].label),data:x,args:q[h].args,additup:q[h].additup})}q=t}if(this.options.type=="pie"){d.addSeries(q[0].label,q[0].xydata!=null?q[0].xydata:this.array2data(q[0].data,null,z,this.options.showpercentage))}else{if(z!=null){y.labels=this.array2data(z,true)}d.addAxis("x",y);d.addAxis("y",A);if(this.options.type=="bubble"){d.addSeries(q[0].label,q[0].xydata||q[0].data)}else{for(var h=0;h<q.length;++h){d.addSeries(q[h].label==null?"Series-"+(h+1):q[h].label,q[h].xydata!=null?q[h].xydata:this.array2data(q[h].data,null,z,null,q[h].additup),q[h].args)}}}if(this.options.tooltips!=false){new dojox.charting.action2d.Tooltip(d,"default")}switch(this.options.type){case"pie":case"scatter":case"grid":new dojox.charting.action2d.MoveSlice(d,"default");break;case"bar":case"clusteredbar":new dojox.charting.action2d.Highlight(d,"default");break;case"column":case"clusteredcolumn":new dojox.charting.action2d.Highlight(d,"default");break;case"line":case"stackedline":new dojox.charting.action2d.Magnify(d,"default");break;case"area":case"stackedarea":new dojox.charting.action2d.Magnify(d,"default");break}d.render();if(this.options.legend){var l=scil.Utils.createElement(this.parent,"div");new dojox.charting.widget.Legend({chart:d},l)}var n=this;d.connectToPlot("default",function(B){if(B.type=="onclick"){if(n.options.onclick!=null){n.options.onclick(B)}}else{if(B.type=="onmouseover"){if(n.options.onmouseover!=null){n.options.onmouseover(B)}}else{if(B.type=="onmouseout"){if(n.options.onmouseout!=null){n.options.onmouseout(B)}}}}})},array2data:function(g,d,x,l,c){var n=0;if(l){for(var f=0;f<g.length;++f){if(!isNaN(g[f])){n+=g[f]}}}var u=null;var h=[];for(var f=0;f<g.length;++f){if(d){h.push({value:f+1,text:g[f]})}else{var w=null;if(c){if(u==null){u=g[f]}else{if(g[f]!=null&&!isNaN(g[f])){u+=g[f]}}w=g[f]==null?null:u}else{w=g[f]}var j=w;var q=j;if(x!=null&&x[f]!=null){if(l&&!isNaN(j)&&n>0){j=(Math.round(j/n*1000)/10)+"%"}j=x[f]+" ("+j+")";q=x[f]}h.push({x:f+1,y:w,text:q,tooltip:j})}}if(h.length==1&&(this.options.type=="column"||this.options.type=="clusteredcolumn")){h.push({x:0,y:0,text:""})}return h}});scil.apply(scil.Chart,{stylesheetAdded:false,addStylesheet:function(){if(this.stylesheetAdded){return}this.stylesheetAdded=true;scil.Utils.addCss(this.getCss())},getCss:function(){var c=".dijitTooltip { position: absolute; z-index: 2000; display: block; left: 0; overflow: visible; }\r\n";c+=".dijitTooltipContainer { border: solid #aaf 1px; background: #fff; color: blue; padding: 2px; border-radius: 3px; }\r\n";c+=".dijitTooltipConnector { position: absolute; }\r\n";c+=".dojoxLegendIcon { 'float': left; }\r\n";return c}});scil.Graph=scil.extend(scil._base,{constructor:function(d,c){this.parent=typeof(d)=="string"?scil.byId(d):d;this.options=c==null?{}:c;this.cy=null;this.render()},getNode:function(c){return this.cy==null?null:this.cy.getElementById(c)},render:function(){if(typeof(cytoscape)=="undefined"){return}if(this.cy!=null){this.cy.layout();return}if(this.options.width>0){this.parent.style.width=this.options.width+(typeof(this.options.width)=="number"?"px":"")}if(this.options.height>0){this.parent.style.height=this.options.height+(typeof(this.options.height)=="number"?"px":"")}if(this.options.border!=null){this.parent.style.border=this.options.border}var d={name:scil.Utils.isNullOrEmpty(this.options.layout)?"cose-bilkent":this.options.layout,rows:1};if(this.options.animate){d.animate=true}else{d.animate=false}var c={container:this.parent,style:this._getStyle(),elements:{nodes:this.options.nodes,edges:this.options.edges},layout:d};if(this.options.args!=null){scil.apply(c,this.options.args)}this.cy=cytoscape(c);this.cy.nodes().ungrabify();var f=this;if(this.options.ontap!=null){this.cy.on("tap",function(g){f.options.ontap(g.cyTarget.data(),f,g)})}if(this.options.onclick!=null){this.cy.on("click",function(g){f.options.onclick(g.cyTarget.data(),f,g)})}if(this.options.onmouseover!=null){this.cy.on("mousemove","node",function(g){f.options.onmouseover(g.cyTarget.data(),f,g)})}if(this.options.onmouseout!=null){this.cy.on("mouseout","node",function(g){f.options.onmouseout(g.cyTarget.data(),f,g)})}},_getStyle:function(){var d=this.options.bordercolor==null?"blue":this.options.bordercolor;var f=this.options.edgecolor==null?d:this.options.edgecolor;var g=this.options.nodesize!=null?this.options.nodesize:60;var c=this.options.bordersize!=null?this.options.bordersize:4;return cytoscape.stylesheet().selector("node").css({height:g,width:g,"font-size":this.options.nodelabelfontsize,color:this.options.nodelabelcolor,"background-fit":"cover","border-color":d,"border-width":c/2,"border-opacity":0.5,label:"data(title)","background-color":"white","background-image":"data(icon)"}).selector("edge").css({width:c,"font-size":this.options.edgelabelfontsize,color:this.options.edgelabelcolor,"target-arrow-shape":"triangle","line-color":f,label:"data(title)","target-arrow-color":f}).selector(".autorotate").css({"edge-text-rotation":"autorotate"})}});scil.apply(scil.Graph,{connectOrphans:function(y,h,u,d,f){var c={};for(var l=0;l<y.length;++l){c[y[l].data.id]=y[l].data}for(var l=0;l<h.length;++l){var z=h[l].data.source;var A=h[l].data.target;c[z].__orphan=false;c[A].__orphan=false;h[l].data[u]=d}var x=0;var w=null;var j=null;for(var q in c){if(c[q].__orphan==false){continue}if(w!=null){var g={source:w.id,target:c[q].id};g[u]=f;h.push({data:g});++x}else{j=c[q]}w=c[q]}if(j!=w&&x>1){var g={source:w.id,target:j.id};g[u]=f;h.push({data:g})}}});scil.CDSSearch=scil.extend(scil._base,{constructor:function(f){if(typeof(f)=="string"){f=scil.byId(f)}this.tabs=new scil.Tabs(f);var j=this.tabs.addTab({caption:"Query",tabkey:"query"});var h=this.tabs.addTab({caption:"Search Results",tabkey:"results"});var c={q:{label:"Structure",type:"jsdraw",width:700,height:260},searchtype:{label:"Search Type",type:"select",items:["","Substructure","Full-structure","Exact Full-structure","Similarity 95%","Similarity 90%","Similarity 80%","Similarity 60%"]},prefered:{label:"Vendor",type:"checkbox",str:"Search Perfered Vendors Only"},status:{label:"Status",type:"html"}};var d=this;this.searchform=new scil.Form();this.searchform.render(j.clientarea,c,{immediately:true,buttons:{src:scil.App.imgSmall("submit.png"),label:"Search",onclick:function(){d.search()}}});this.pagetop=scil.Utils.createElement(h.clientarea,"div");scil.CDSSearch.columns.structureid.template="<img style='display:block' title='Click to View Live Structure' onclick='scil.CDSSearch.showStructure({?})' src='"+scil.CDSSearch.site+scil.CDSSearch.img+"'>";this.resulttable=new scil.Table({viewonly:true,header:true});this.resulttable.render(h.clientarea,scil.CDSSearch.columns);this.pagebottom=scil.Utils.createElement(h.clientarea,"div");this.norecords=scil.Utils.createElement(h.clientarea,"div","No Records Found",{color:"red",display:"none"});var g=scil.Utils.readCookie("__cds_query");this.setQuery(g,"Substructure",true)},setQuery:function(d,f,c){this.tabs.showTab("query");this.searchform.setData({q:d,searchtype:"Substructure",prefered:c,status:null})},search:function(f){var c=this.searchform.getData();scil.Utils.createCookie("__cds_query",c.q,90);c.q=this.searchform.fields.q.jsd.getSmiles();c.page=f;var d=this;this.showStatus(scil.Utils.imgTag("animatorsmall.gif")+"Searching ...");scil.Utils.jsonp(scil.CDSSearch.site+scil.CDSSearch.url+"public.searchall",function(g){var h=d.combineResults(g.rows);d.resulttable.setData(h);d.tabs.showTab("results");scil.Table.listPages(d.pagetop,g.page,g.pages,function(j){d.search(j)});scil.Table.listPages(d.pagebottom,g.page,g.pages,function(j){d.search(j)});d.norecords.style.display=g.rows==null||g.rows.length==0?"":"none";d.showStatus(null)},c,{onErr:function(g){d.showStatus(g)}})},showStatus:function(c){this.searchform.fields.status.innerHTML=c==null?"":"<div style='color:red'>"+c+"</div>"},combineResults:function(d){if(d==null){return null}var g=null;var h=[];for(var c=0;c<d.length;++c){var f=d[c];if(g==null||g.structureid!=f.structureid){g={structureid:f.structureid,catano:"",company:"",price:"",amount:"",status:""};h.push(g)}g.catano+="<div>"+(scil.Utils.isNullOrEmpty(f.catano)?"&nbsp;":f.catano)+"</div>";g.company+="<div>"+(scil.Utils.isNullOrEmpty(f.company)?"&nbsp;":f.company)+"</div>";g.amount+="<div>"+(scil.Utils.isNullOrEmpty(f.amount)||f.amount==0?"&nbsp;":this.formatNumber(f.amount,null,"g"))+"</div>";g.price+="<div>"+(scil.Utils.isNullOrEmpty(f.price)||f.amount==0?"&nbsp;":this.formatNumber(f.price,2,null,"$"))+"</div>";g.status+="<div>"+(scil.Utils.isNullOrEmpty(f.status)?"&nbsp;":f.status)+"</div>";last=f.structureid}return h},formatNumber:function(h,c,g,d){var f=JSDraw2.Table.formatValue(h,g,c);if(f!=null&&d!=null){f=d+f}return f}});scil.apply(scil.CDSSearch,{site:"https://carbon.scilligence.com/compounds/",url:"ajax.ashx?cmd=",img:"go.axd/structure/width=200,height=70/{?}/m.png",columns:{structureid:{label:"Structure",type:"html",attributes:{valign:"top"}},catano:{label:"Catalog No",width:200,attributes:{valign:"top"}},company:{label:"Vendor",width:200,attributes:{valign:"top"}},amount:{label:"Amount",width:200,attributes:{valign:"top",align:"right"}},price:{label:"Price",width:200,attributes:{valign:"top",align:"right"}},status:{label:"Status",width:200,attributes:{valign:"top"}}},showFromTable:function(c){var d=c.getCellValue(c.currow==null?0:c.currow,"structure",true);this.show(d)},show:function(c){this.create();this.dlg.show();this.dlg.moveCenter();if(c!=null){this.cds.setQuery(c)}},create:function(){if(this.dlg!=null){return}var c=scil.Utils.createElement(null,"div");this.dlg=new scil.Dialog("CDS Search",c);this.dlg.show();this.cds=new scil.CDSSearch(c)},showStructure:function(c){scil.Utils.jsonp(scil.CDSSearch.site+scil.CDSSearch.url+"public.getstructure",function(d){JSDraw2.Editor.showPopup("View Structure","Dismiss",null,{value:d,format:"xml"})},{structureid:c})}});scil.Clipboard={copy:function(g){if(scil.Utils.isNullOrEmpty(g)){return false}var c=scil.Utils.createElement(document.body,"textarea",null,{position:"fixed",top:0,left:0,width:"2px",height:"2px",padding:0,border:"none",outline:"none",boxShadow:"none",background:"transparent"});c.value=g;c.select();var f=false;try{f=document.execCommand("copy")}catch(d){}document.body.removeChild(c);return f}};scil.TooltipForm=scil.extend(scil._base,{constructor:function(c,f){this.options=f;this.key=null;this.a=c;if(this.a!=null){var d=this;dojo.connect(this.a,"onmouseout",function(){d.hide()});dojo.connect(this.a,"onmousemove",function(g){d.mousemove(g)})}},show:function(d,f){if(f!=null){this.create();var j=scil.Utils.getZindex(this.input)+1;this.dlg.show(null,j,false,true);var h=scil.Utils.scrollOffset();this.dlg.moveTo(d.clientX+h.x+10,d.clientY+h.y+10)}if(this.key!=f){this.key=f;if(f==null){if(this.dlg!=null){this.dlg.hide()}}else{if(this.options.ongetcaption!=null){var g=this.options.ongetcaption(f);this.dlg.setTitle("<div style='text-align:center'>"+g+"</div>")}if(this.options.ongetdata!=null){var c=this.options.ongetdata(f);if(typeof(c)=="string"){this.dlg.form.setXml(c)}else{this.dlg.form.setData(c)}}}}},hide:function(){if(this.dlg!=null){this.dlg.hide()}},mousemove:function(c){if(this.options==null){return}var d=this.options.ongetkey(c);this.show(c,d)},create:function(){if(this.dlg!=null){return}var c=this.options.ongetfields!=null?this.options.ongetfields(this):this.options.fields;this.dlg=scil.Form.createDlgForm(this.options.caption,c,null,{modal:false,viewonly:true,noclose:true});this.dlg.hide()}});if(typeof(__JSDraw2_TouchMol)=="undefined"){dojo.require("dijit.layout.AccordionContainer");dojo.require("dijit.layout.ContentPane")}scil.Accordion=scil.extend(scil._base,{constructor:function(g,f){scil.Accordion.addStylesheet();if(typeof(g)=="string"){g=scil.byId(g)}this.options=f==null?{}:f;var h="";if(this.options.width>0){h+="width:"+this.options.width+"px;"}if(this.options.height>0){h+="height:"+this.options.height+"px;"}this.container=new dijit.layout.AccordionContainer({style:h},g);for(var c=0;c<this.options.items.length;++c){var d=this.options.items[c];this.container.addChild(new dijit.layout.ContentPane({title:d.title,content:d.html}))}this.container.startup();if(this.options.onafterrender!=null){this.options.onafterrender(this)}}});scil.apply(scil.Accordion,{stylesheetAdded:false,addStylesheet:function(){if(this.stylesheetAdded){return}this.stylesheetAdded=true;scil.Utils.addCss(this.getCss())},getCss:function(){var c=".dijitAccordionInnerContainer{background-color: #efefef;border: solid 1px #b5bcc7;}\r\n.dijitAccordionContainer .dijitAccordionChildWrapper{background-color: #ffffff;border: 1px solid #759dc0;margin: 0 2px 2px;}\r\n.dijitAccordionTitle .arrowTextUp, .dijitAccordionTitle .arrowTextDown {display: none;font-size: 0.65em;font-weight: normal !important;}\r\n.dijitAccordionTitle{padding: 5px 7px 2px 7px;min-height: 17px;}\r\n";return c}});scil.DnD=scil.extend(scil._base,{constructor:function(f,d){this.src=null;this.copy=null;this.dragging=false;this.disabled=false;this.options=d;if(typeof(f)=="string"){f=scil.byId(f)}var c=this;dojo.connect(f,"onmousedown",function(g){if(!c.disabled){c.mousedown(g)}});dojo.connect(document.body,"onmousemove",function(g){if(!c.disabled){c.mousemove(g)}});dojo.connect(document.body,"onmouseup",function(g){if(!c.disabled){c.mouseup(g)}})},isDragging:function(){return this.dragging},cancel:function(){if(this.src!=null){if(this.options.oncancel!=null){this.options.oncancel(this)}}this.src=null;this.copy=null;this.dragging=false},mousedown:function(c,d){if(this.options.onstartdrag!=null){this.src=this.options.onstartdrag(c,this);this.startpos={x:c.clientX,y:c.clientY}}},mousemove:function(c){if(this.src==null){return}if(this.copy==null&&(Math.abs(c.clientX-this.startpos.x)>10||Math.abs(c.clientY-this.startpos.y)>10)){if(this.options.oncreatecopy!=null){this.copy=this.options.oncreatecopy(c,this)}}if(this.copy!=null){var d=scil.Utils.scrollOffset();this.copy.style.left=(c.clientX+d.x+2)+"px";this.copy.style.top=(c.clientY+d.y+2)+"px";this.dragging=true}if(this.options.ondragover!=null){this.options.ondragover(c,this)}},mouseup:function(c){if(this.src!=null){if(this.options.ondrop!=null){this.options.ondrop(c,this)}}this.src=null;this.copy=null;this.dragging=false}});scil.Resizable=scil.extend(scil._base,{constructor:function(c,f){if(typeof(c)=="string"){c=scil.byId(c)}this.options=f==null?{}:f;this.resizing=null;this.handle=c;this.bgcolor=this.handle.style.backgroundColor;if(this.options.direction=="y"){c.style.cursor="ns-resize"}else{if(this.options.direction=="x"){c.style.cursor="ew-resize"}}var d=this;dojo.connect(c,"onmousedown",function(g){d.start(g)});scil.connect(document.body,"onmousemove",function(g){if(d.resize(g)){g.preventDefault()}});scil.connect(document.body,"onmouseup",function(g){d.resizing=null});if(this.options.mouseovercolor!=null){scil.connect(c,"onmouseover",function(){d.handle.style.backgroundColor=d.options.mouseovercolor});scil.connect(c,"onmouseout",function(){d.handle.style.backgroundColor=d.bgcolor})}},resize:function(d){if(this.resizing==null){return false}var c=this.options.direction=="y"?(d.clientY-this.resizing.y):(d.clientX-this.resizing.x);if(c==0){return true}var g=false;if(this.options.onresize!=null){g=this.options.onresize(c,this)}if(g){if(this.options.direction=="y"){this.resizing.y=d.clientY}else{this.resizing.x=d.clientX}}return true},start:function(c){if(this.options.direction=="y"){this.resizing={y:c.clientY}}else{if(this.options.direction=="x"){this.resizing={x:c.clientX}}}}});scil.Favorite=scil.extend(scil._base,{constructor:function(c,d){this.key=c;this.items=null;this.onAddFavorite=d;this.changed=false},getList:function(c){this._load();return this.items[c]},contains:function(d,f){this._load();var c=this.items[f];return c==null?false:scil.Utils.indexOf(c,d)>=0},add:function(g,c,j){this._load();var d=this.items[j];if(d==null){if(c){this.items[j]=[g];this.changed=true}}else{var h=scil.Utils.indexOf(d,g);if(h<0&&c){d.push(g);this.changed=true}else{if(h>=0&&!c){d.splice(h,1);this.changed=true}}}if(this.onAddFavorite!=null){this.onAddFavorite(g,c,j)}if(this.changed){this._save()}},_save:function(){if(this.items==null){return}var c=scil.Utils.json2str(this.items);scil.Utils.createCookie("scil_helm_favorites_"+this.key,c)},_load:function(){if(this.items!=null){return}var s=scil.Utils.readCookie("scil_helm_favorites_"+this.key);var v=scil.Utils.eval(s);this.items=v==null?{}:v}});scil.WeighStation={dlg:null,kDefaultLastMinutes:10,kNote:"Note",kTimes:["","8:00","9:00","10:00","11:00","12:00","13:00","14:00","15:00","16:00","17:00","18:00","##:##"],show:function(c,d){this.callback=c;this.jss=d;if(this.dlg==null){this.create()}else{this.dlg.show()}},useData:function(){var n=this.dlg.form.fields.data.jsd.getCheckedRowData();if(n==null||n.length==0){scil.Utils.alert("Please select a row first");return}n.sort(function(t,u){return t.dataid<u.dataid?-1:1});for(var g=0;g<n.length;++g){var j=n[g];var l={dataid:j.dataid,weight:j.weight,stats:j.stats,deviceid:j.deviceid,ip:j.ip,dt:j.dt,note:j.note};if(typeof(l.dt)=="string"){l.dt=parseInt(l.dt)}if(l.weight=="-"){l.weight=""}if(this.callback!=null){this.callback(l)}else{if(this.jss!=null){var h=null;var q=null;for(var f=0;f<this.jss.columns.length;++f){var c=this.jss.columns[f];if(c.type=="mass"){h=c;break}else{if(c.key=="weight"){q=c}}}if(h==null&&q!=null){h=q}if(h!=null){var d={};d[h.key]=l.weight;this.jss.appendRow(d);this.jss.setWeighingTag(h,l,this.jss.getRowCount()-1)}}}}this.dlg.hide()},onSelectScale:function(){this.dlg.form.fields.data.jsd.clear();this.loadData()},loadData:function(){if(this.timer!=null){clearTimeout(this.timer);this.timer=null}var c=this.dlg.form.getData();c.data=null;var d=this;var f=scil.MobileData.getDefaultUrl(true,"list");scil.Utils.jsonp(f,function(g){d.dlg.form.fields.data.jsd.setData(g)},c)},create:function(){if(this.dlg!=null){return}var c=this;if(this.onGetStations!=null){this.onGetStations(function(d){c.create2(d)})}else{this.create2(JSDraw2.weighstations)}},create2:function(g){var f=this;var d={deviceid:{label:"Select Balance",type:"select",width:200,items:g,sort:false,onchange:function(){f.onSelectScale()}},note:{label:this.kNote,width:200},lastminutes:{label:"Last Minutes",type:"int",width:200,value:scil.WeighStation.kDefaultLastMinutes,onenter:function(){f.clearValues(true);f.onSelectScale()}},startdate:{label:"Start Date",type:"date",width:200,onenter:function(){f.clearValues(false);f.onSelectScale()}},starttime:{label:"Start Time",type:"dropdowninput",items:scil.WeighStation.kTimes,width:200,onenter:function(){f.clearValues(false);f.onSelectScale()}},enddate:{label:"End Date",type:"date",width:200,onenter:function(){f.clearValues(false);f.onSelectScale()}},endtime:{label:"End Time",type:"dropdowninput",items:scil.WeighStation.kTimes,width:200,onenter:function(){f.clearValues(false);f.onSelectScale()}},data:{label:"Data",type:"table",viewonly:true,rowcheck:true,columns:{dataid:{label:"DataID",width:70},deviceid:{label:"Balance",width:120},weight:{label:"Weight",width:80},stats:{label:"Stats",width:300,whitespace:""},dt:{label:"Time",width:100,render:function(h){return scil.Utils.timeStr(h,true)}},ip:{label:"IP Address",width:100},note:{label:this.kNote,width:150}}}};var f=this;var c=[{src:scil.App.imgSmall("submit.png"),label:"Use Data",onclick:function(){f.useData()}}," ",{src:scil.App.imgSmall("refresh.png"),label:"Refresh",onclick:function(){f.onSelectScale()}},];this.dlg=scil.Form.createDlgForm(scil.Lang.res("Weigh Station"),d,c)},clearValues:function(d){var c=this.dlg.form.fields;if(d){c.startdate.value="";c.starttime.value="";c.enddate.value="";c.endtime.value=""}else{c.lastminutes.value=""}}};scil.WeighRecords={dlg:null,show:function(){this.create();this.dlg.show()},onSelectScale:function(){this.dlg.form.fields.data.jsd.clear();this.loadData()},loadData:function(){if(this.timer!=null){clearTimeout(this.timer);this.timer=null}var c=this.dlg.form.getData();c.data=null;var d=this;var f=scil.MobileData.getDefaultUrl(true,"list");scil.Utils.jsonp(f,function(g){d.dlg.form.fields.data.jsd.setData(g)},c)},create:function(){if(this.dlg!=null){return}var c=this;if(scil.WeighStation.onGetStations!=null){scil.WeighStation.onGetStations(function(d){c.create2(d)})}else{this.create2(JSDraw2.weighstations)}},create2:function(g){var f=this;var d={deviceid:{label:"Select Balance",type:"select",width:200,items:g,onchange:function(){f.onSelectScale()}},note:{label:scil.WeighStation.kNote,width:200},lastminutes:{label:"Last Minutes",type:"int",width:200,value:10,onenter:function(){f.clearValues(true);f.onSelectScale()}},startdate:{label:"Start Date",type:"date",width:200,onenter:function(){f.clearValues(false);f.onSelectScale()}},starttime:{label:"Start Time",type:"dropdowninput",items:["","8:00","9:00","10:00","11:00","12:00","13:00","14:00","15:00","16:00","17:00","18:00","##:##"],width:200,onenter:function(){f.clearValues(false);f.onSelectScale()}},enddate:{label:"End Date",type:"date",width:200,onenter:function(){f.clearValues(false);f.onSelectScale()}},endtime:{label:"End Time",type:"dropdowninput",items:["","8:00","9:00","10:00","11:00","12:00","13:00","14:00","15:00","16:00","17:00","18:00","##:##"],width:200,onenter:function(){f.clearValues(false);f.onSelectScale()}},data:{label:"Data",type:"table",viewonly:true,options:{rowcheck:true},columns:{dataid:{label:"DataID",width:100},deviceid:{label:"Balance",width:200},weight:{label:"Weight",width:100},stats:{label:"Stats",width:160},dt:{label:"Time",width:150,type:"date",timeformat:"HH:MM:SS"},ip:{label:"IP Address",width:150},note:{label:scil.WeighStation.kNote,width:250}}}};var f=this;var c=[{src:scil.App.imgSmall("printer.png"),label:"Print",onclick:function(){new scil.Table.Print(f.dlg.form.fields.data.jsd,{checkedonly:true})}}," ",{src:scil.App.imgSmall("refresh.png"),label:"Refresh",onclick:function(){f.onSelectScale()}},];this.dlg=scil.Form.createDlgForm(scil.Lang.res("Weigh Records"),d,c)},clearValues:function(d){var c=this.dlg.form.fields;if(d){c.startdate.value="";c.starttime.value="";c.enddate.value="";c.endtime.value=""}else{c.lastminutes.value=""}}};scil.DnDFile=scil.extend(scil._base,{constructor:function(c,f){if(scil.DnDFile.disabled==true||scil.Utils.isIE&&scil.Utils.isIE<9){return}if(typeof(c)=="string"){c=scil.byId(c)}this.div=c;this.options=f==null?{}:f;this.disabled=false;this.oldbackgroundcolor=this.div.style.backgroundColor;this.oldheight=this.div.style.height;var d=this;this.div.addEventListener("dragenter",function(g){if(d.disabled){return}d.ondragenter(g)},false);this.div.addEventListener("dragleave",function(g){if(d.disabled){return}d.ondragleave(g)},false);this.div.addEventListener("dragover",function(g){if(d.disabled){return}d.ondragover(g)},false);this.div.addEventListener("drop",function(g){if(d.disabled){return}d.ondrop(g)},false)},ondragover:function(c){c.stopPropagation();c.preventDefault();c.dataTransfer.dropEffect="copy"},ondragenter:function(){this.div.style.backgroundColor="#99ff99";if(scil.Utils.isIE&&scil.Utils.isNullOrEmpty(this.div.style.height)&&this.div.offsetHeight>0){this.div.style.height=this.div.offsetHeight+"px"}},ondragleave:function(){this.div.style.backgroundColor=this.oldbackgroundcolor;if(scil.Utils.isIE){this.div.style.height=this.oldheight}},ondrop:function(c){c.stopPropagation();c.preventDefault();this.ondragleave();var j=this;var g=c.dataTransfer.files;for(var h=0,d;d=g[h];h++){if(this.disabled||this.options.imageonly&&!d.type.match("image.*")||this.options.type!=null&&!d.type.match(this.options.type)){continue}if(this.options.ondropfile!=null){this.options.ondropfile(d,this)}else{var l=new FileReader();l.onload=(function(f){return function(q){var u=q.target.result;var t=u.indexOf(",");var n={contents:u.substr(t+1),filename:f.name,lastmodifieddate:f.lastModifiedDate.getTime()};if(j.options.onupload!=null){if(j.options.onupload(n,this)==false){return}}scil.Utils.ajax(j.options.url,function(w){j.options.callback(w)},n)}})(d);l.readAsDataURL(d)}}}});scil.MobileData=scil.extend(scil._base,{constructor:function(c,f){this.timer=null;this.count=0;this.input=c;this.lastbarcode=null;this.options=f==null?{}:f;if(!(this.options.interval>0)){this.options.interval=scil.MobileData.kInterval}if(!(this.options.maxcount>0)){this.options.maxcount=scil.MobileData.kMaxCount}if(!(this.options.lastminutes>0)){this.options.lastminutes=1}if(this.input!=null&&this.options.connectevents!=false){var d=this;scil.connect(this.input,"onfocus",function(){d.start()});scil.connect(this.input,"onblur",function(){d.end()})}},start:function(){this.endTimer();this.count=0;if(this.isDisabled()){return}this.startTimer();if(this.options.onstart!=null){this.options.onstart(this)}this.lastbarcode=null;if(this.input!=null){this.input.style.backgroundColor="yellow"}},isDisabled:function(){return this.options.weighstation&&scil.Utils.isNullOrEmpty(scil.MobileData.weighstation)||scil.MobileData.disabled},startTimer:function(){this.endTimer();if(this.isDisabled()){return}if(this.options.onstarttimer==null||this.options.onstarttimer(this)){var c=this;this.timer=setTimeout(function(){c.watch()},this.options.interval)}},end:function(){this.endTimer();if(this.options.onend!=null){this.options.onend(this)}if(this.input!=null){this.input.style.backgroundColor=""}},endTimer:function(){if(this.timer!=null){clearTimeout(this.timer);this.timer=null}},watch:function(){var c={category:this.options.category,deviceid:scil.MobileData.weighstation,lastminutes:this.options.lastminutes,except:this.lastbarcode};if(this.options.onsenddata!=null){this.options.onsenddata(c,this)}var d=this;scil.Utils.ajax(this.options.url,function(f){if(f!=null){if(f.barcode==null){f.barcode=f.weight}if(f.barcode!=null){d.lastbarcode=f.barcode}else{if(f.dbnotconfigured){d.end()}}}d.onResult(f);++d.count;if(d.count<=d.options.maxcount){d.startTimer()}else{d.end()}},c)},onResult:function(c){if(c.barcode==null){return}if(this.options.onresult!=null){if(this.options.onresult(c)==true){return}}if(this.input!=null&&this.input.style.display!="none"){this.input.value=c.barcode;scil.MobileData.markRecieved(this.input);if(this.options.sendenter){scil.Utils.fireEvent(this.input,"keydown",false,true,{keyCode:13})}}}});scil.apply(scil.MobileData,{kMaxCount:240,kInterval:500,disabled:false,markRecieved:function(c){c.select();c.focus();c.style.backgroundColor="lime"},selectWeighstation:function(){if(JSDraw2.weighstations==null||JSDraw2.weighstations.length==0){scil.Utils.alert("Weigh station is not configured");return}var d=this;if(this.weighDlg==null){var c={note:{type:"html",template:"Please select a weigh station"},list:{type:"select",items:JSDraw2.weighstations,width:400}};this.weighDlg=scil.Form.createDlgForm("Select Weigh Station",c,{label:"Select",onclick:function(){d.weighstation=d.weighDlg.form.fields.list.value;d.weighDlg.hide()}},{hidelabel:true})}this.weighDlg.show();this.weighDlg.form.setData({list:d.weighstation})},getDefaultUrl:function(f,d){if(d==null){d="getlast"}var c=f?"weight":"mobile";if(scil.App.config==null){return JSDrawServices.url+"?cmd="+c+"."+d}else{return"ajax.ashx?cmd="+c+"."+d}},enable:function(){this.disabled=!this.disabled;scil.App.updateRightToolbar(scil.App.__user)},getMenuitems:function(){return[{label:"Mobile"+(this.disabled?"(Mute)":"(Live)"),onclick:function(){scil.MobileData.enable()}},"-",{label:"Weigh Records",onclick:function(){scil.WeighRecords.show()}},"-",{label:"Scan Settings",onclick:function(){scil.MobileData.showSettingDialog()}},"-",{label:"Download App",url:"http://apps.scilligence.com",target:"_blank"},]},showSettingDialog:function(){if(this.settingDlg==null){var g=scil.Utils.scriptUrl();var d=scil.App.getUserEmail();var f="<div style='text-align:center'>Click *Scan Settings* button in Settings page to scan:<br><img src='jsdraw/service.aspx?cmd=barcode&logo=4&color=purple&barcode={succeed:true,ret:{url:%27"+g+"%27,email:%27"+(d==null?"":d)+"%27}}&scale=2&wrapper=raw&type=qr2'></div>";var c=scil.Utils.createElement(null,"div",f);this.settingDlg=new scil.Dialog("Scan Settings",c)}this.settingDlg.show()},createImageList:function(d,f){var c={dataid:{label:"DataID",width:80,iskey:true},filename:{label:"File Name",width:200,type:"html",template:"<a target='_blank' href='"+JSDrawServices.url+"?cmd=mobile.previewimage&wrapper=raw&dataid={{dataid}}'>{?}</a>"},category:{label:"Category",width:100},deviceid:{label:"Device",width:100},dt:{label:"Uploaded",type:"date",width:80},note:{label:"Notes",width:200}};var g=new scil.Table({viewonly:true,rowcheck:(f?true:"radio")});g.render(d,c);return g},listImages:function(d,c){d.clear();scil.Utils.ajax(this.getDefaultUrl(false,"listimages"),function(f){d.setData(f)},c)},getSelectedImages:function(d){var c=d==null?null:d.getCheckedKeys();if(c==null||c.length==0){return null}return scil.Utils.array2str(c,",")},getSelectedImageNames:function(g,f){if(g==null){return}var d=g.getCheckedRowData();if(d!=null){for(var c=0;c<d.length;++c){f.push(d[c].filename)}}}});scil.Hazard={show:function(j,c){if(scil.Utils.isNullOrEmpty(j)){return}var h=this.getPhrases();var g={i:0};var d="";if(typeof(j)=="string"){d+=this._makeRows(h,null,j,g)}else{for(var f in j){d+=this._makeRows(h,f,j[f],g)}}if(scil.Utils.isNullOrEmpty(d)){return}d="<table cellspacing=0>"+d+"</table>";if(this.dlg==null){this.dlg=new scil.Dialog("Hazard Phrases",scil.Utils.createElement(null,"div"))}this.dlg.body.innerHTML=d;this.dlg.show(c);this.dlg.moveCenter()},_makeRows:function(j,h,u,g){if(scil.Utils.isNullOrEmpty(u)){return""}var c="";var q=u.split(",");var f={};for(var d=0;d<q.length;++d){var t=scil.Utils.trim(q[d]);if(t==""||f[t]!=null){continue}++g.i;f[t]=true;var l=j[t];c+="<tr"+(g.i%2==1?" style='background:#ddd'":"")+"><td style='width:5%;border-right:1px solid #fff;padding-right:10px;'>"+(h==null?"":h)+"</td><td style='width:5%;border-right:1px solid #fff;padding-right:10px;'>"+t+":</td><td><div style='padding:4px;max-width:800px;'>"+(l==null?"":l.s)+"</div></td></tr>"}return c},filterFlags:function(c){return c},renderFlags:function(n){if(scil.Hazard.filterFlags!=null){n=scil.Hazard.filterFlags(n)}if(scil.Utils.isNullOrEmpty(n)){return""}var g=false;var j=scil.Hazard.getPhrases();var l="";var q=typeof(n)=="string"?n.split(","):n;for(var f=0;f<q.length;++f){var d=q[f];if(d==""||d==" "){continue}var h=j[d];if(h==null){if(l!=""&&g){l+=","}l+=d;g=true}else{if(h.c==null){if(l!=""&&g){l+=","}l+="<u title='"+d+" - "+h.s+"'>"+d+"</u>";g=true}else{l+="<img src='img/hazard-"+h.c+".png' title='"+d+" - "+h.s+"' width=16/>";g=false}}}return l},getPhrases:function(){var d=null;for(var c in scil.Lang){if(c!="current"&&scil.Lang[c]==scil.Lang.current){d=c;break}}var f=d==null?null:this[c];if(f==null){f=this.phrases}return f},getListOptions:function(c){if(c!=null){var g={"":""};for(var d in c){g[d]=d+" - "+c[d]}return g}else{var g={"":""};var f=this.getPhrases();for(var d in f){g[d]=d+" - "+this.phrases[d].s}return g}},phrases:{H200:{s:"Unstable explosive",c:"explosive"},H201:{s:"Explosive; mass explosion hazard",c:"explosive"},H202:{s:"Explosive; severe projection hazard",c:"explosive"},H203:{s:"Explosive; fire, blast or projection hazard",c:"explosive"},H204:{s:"Fire or projection hazard",c:null},H205:{s:"May mass explode in fire",c:"explosive"},H220:{s:"Extremely flammable gas",c:"flammable"},H221:{s:"Flammable gas",c:"flammable"},H222:{s:"Extremely flammable aerosol",c:"flammable"},H223:{s:"Flammable aerosol",c:"flammable"},H224:{s:"Extremely flammable liquid and vapour",c:"flammable"},H225:{s:"Highly flammable liquid and vapour",c:"flammable"},H226:{s:"Flammable liquid and vapour",c:"flammable"},H227:{s:"Combustible liquid",c:"flammable"},H228:{s:"Flammable solid",c:"flammable"},H229:{s:"Pressurized container: may burst if heated",c:null},H230:{s:"May react explosively even in the absence of air",c:null},H231:{s:"May react explosively even in the absence of air at elevated pressure and/or temperature",c:null},H240:{s:"Heating may cause an explosion",c:null},H241:{s:"Heating may cause a fire or explosion",c:null},H242:{s:"Heating may cause a fire",c:null},H250:{s:"Catches fire spontaneously if exposed to air",c:null},H251:{s:"Self-heating; may catch fire",c:null},H252:{s:"Self-heating in large quantities; may catch fire",c:null},H260:{s:"In contact with water releases flammable gases which may ignite spontaneously",c:null},H261:{s:"In contact with water releases flammable gas",c:null},H270:{s:"May cause or intensify fire; oxidizer",c:"oxidizing"},H271:{s:"May cause fire or explosion; strong oxidizer",c:"oxidizing"},H272:{s:"May intensify fire; oxidizer",c:"oxidizing"},H280:{s:"Contains gas under pressure; may explode if heated",c:"compressedgas"},H281:{s:"Contains refrigerated gas; may cause cryogenic burns or injury",c:null},H290:{s:"May be corrosive to metals",c:"corrosive"},H300:{s:"Fatal if swallowed",c:null},H301:{s:"Toxic if swallowed",c:"toxic"},H302:{s:"Harmful if swallowed",c:"toxic"},H303:{s:"May be harmful if swallowed",c:null},H304:{s:"May be fatal if swallowed and enters airways",c:null},H305:{s:"May be harmful if swallowed and enters airways",c:null},H310:{s:"Fatal in contact with skin",c:null},H311:{s:"Toxic in contact with skin",c:"toxic"},H312:{s:"Harmful in contact with skin",c:null},H313:{s:"May be harmful in contact with skin",c:null},H314:{s:"Causes severe skin burns and eye damage",c:null},H315:{s:"Causes skin irritation",c:null},H316:{s:"Causes mild skin irritation",c:null},H317:{s:"May cause an allergic skin reaction",c:null},H318:{s:"Causes serious eye damage",c:null},H319:{s:"Causes serious eye irritation",c:null},H320:{s:"Causes eye irritation",c:null},H330:{s:"Fatal if inhaled",c:null},H331:{s:"Toxic if inhaled",c:"toxic"},H332:{s:"Harmful if inhaled",c:null},H333:{s:"May be harmful if inhaled",c:null},H334:{s:"May cause allergy or asthma symptoms or breathing difficulties if inhaled",c:null},H335:{s:"May cause respiratory irritation",c:null},H336:{s:"May cause drowsiness or dizziness",c:null},H340:{s:"May cause genetic defects",c:null},H341:{s:"Suspected of causing genetic defects",c:null},H350:{s:"May cause cancer",c:null},H351:{s:"Suspected of causing cancer",c:null},H360:{s:"May damage fertility or the unborn child",c:null},H361:{s:"Suspected of damaging fertility or the unborn child",c:null},H361d:{s:"Suspected of damaging the unborn child",c:null},H362:{s:"May cause harm to breast-fed children",c:null},H370:{s:"Causes damage to organs",c:null},H371:{s:"May cause damage to organs",c:null},H372:{s:"Causes damage to organs through prolonged or repeated exposure",c:null},H373:{s:"May cause damage to organs through prolonged or repeated exposure",c:null},H400:{s:"Very toxic to aquatic life",c:"toxic"},H401:{s:"Toxic to aquatic life",c:"toxic"},H402:{s:"Harmful to aquatic life",c:null},H410:{s:"Very toxic to aquatic life with long-lasting effects",c:"toxic"},H411:{s:"Toxic to aquatic life with long-lasting effects",c:"toxic"},H412:{s:"Harmful to aquatic life with long-lasting effects",c:null},H413:{s:"May cause long-lasting harmful effects to aquatic life",c:null},H420:{s:"Harms public health and the environment by destroying ozone in the upper atmosphere",c:null}},precautionary:{P101:"If medical advice is needed, have product container or label at hand.",P102:"Keep out of reach of children.",P103:"Read label before use.",P201:"Obtain special instructions before use.",P202:"Do not handle until all safety precautions have been read and understood.",P210:"Keep away from heat, hot surfaces, sparks, open flames and other ignition sources. No smoking. [As modified by IV ATP[5]]",P211:"Do not spray on an open flame or other ignition source.",P220:"Keep/Store away from clothing/…/combustible materials.",P221:"Take any precaution to avoid mixing with combustibles.",P222:"Do not allow contact with air.",P223:"Do not allow contact with water.",P230:"Keep wetted with …",P231:"Handle under inert gas.",P232:"Protect from moisture.",P233:"Keep container tightly closed.",P234:"Keep only in original container.",P235:"Keep cool..",P240:"Ground/bond container and receiving equipment.",P241:"Use explosion-proof electrical/ventilating/light/…/equipment.",P242:"Use only non-sparking tools.",P243:"Take precautionary measures against static discharge.",P244:"Keep valves and fittings free from oil and grease.",P250:"Do not subject to grinding/shock/…/friction.",P251:"Do not pierce or burn, even after use.",P260:"Do not breathe dust/fumes/gas/mist/vapours/spray.",P261:"Avoid breathing dust/fumes/gas/mist/vapours/spray.",P262:"Do not get in eyes, on skin, or on clothing.",P263:"Avoid contact during pregnancy/while nursing.",P264:"Wash … thoroughly after handling.",P270:"Do not eat, drink or smoke when using this product.",P271:"Use only outdoors or in a well-ventilated area.",P272:"Contaminated work clothing should not be allowed out of the workplace.",P273:"Avoid release to the environment.",P280:"Wear protective gloves/protective clothing/eye protection/face protection.",P281:"[Deleted by IV ATP]",P282:"Wear cold insulating gloves/face shield/eye protection.",P283:"Wear fire/flame resistant/retardant clothing.",P284:"[In case of inadequate ventilation] wear respiratory protection.",P285:"[Deleted by IV ATP]","P231+232":"Handle under inert gas. Protect from moisture","P235+410":"Keep cool. Protect from sunlight",P301:"IF SWALLOWED",P302:"IF ON SKIN",P303:"IF ON SKIN (or hair)",P304:"IF INHALED",P305:"IF IN EYES",P306:"IF ON CLOTHING",P307:"[Deleted by IV ATP]",P308:"If exposed or concerned",P309:"[Deleted by IV ATP]",P310:"Immediately call a POISON CENTER/doctor/…",P311:"Call a POISON CENTER/ doctor/…",P312:"Call a POISON CENTER/ doctor/…/if you feel unwell.",P313:"Get medical advice/attention.",P314:"Get medical advice/attention if you feel unwell.",P315:"Get immediate medical advice/attention.",P320:"Specific treatment is urgent (see … on this label).",P321:"Specific treatment (see … on this label).",P322:"[Deleted by IV ATP]",P330:"Rinse mouth.",P331:"Do NOT induce vomiting.",P332:"If skin irritation occurs",P333:"If skin irritation or a rash occurs",P334:"Immerse in cool water/wrap in wet bandages.",P335:"Brush off loose particles from skin.",P336:"Thaw frosted parts with lukewarm water. Do not rub affected areas.",P337:"If eye irritation persists",P338:"Remove contact lenses if present and easy to do. Continue rinsing.",P340:"Remove person to fresh air and keep comfortable for breathing.",P341:"[Deleted by IV ATP]",P342:"If experiencing respiratory symptoms",P350:"[Deleted by IV ATP]",P351:"Rinse cautiously with water for several minutes.",P352:"Wash with plenty of water/…",P353:"Rinse skin with water/shower.",P360:"Rinse immediately contaminated clothing and skin with plenty of water before removing clothes.",P361:"Take off immediately all contaminated clothing.",P362:"Take off contaminated clothing.",P363:"Wash contaminated clothing before reuse.",P364:"And wash it before reuse. [Added by IV ATP]",P370:"In case of fire",P371:"In case of major fire and large quantities",P372:"Explosion risk in case of fire.",P373:"DO NOT fight fire when fire reaches explosives.",P374:"Fight fire with normal precautions from a reasonable distance.",P375:"Fight fire remotely due to the risk of explosion.",P376:"Stop leak if safe to do so.",P377:"Leaking gas fire – do not extinguish unless leak can be stopped safely.",P378:"Use … to extinguish.",P380:"Evacuate area.",P381:"Eliminate all ignition sources if safe to do so.",P391:"Collect spillage.","P301+310":"IF SWALLOWED: Immediately call a POISON CENTER/doctor/…","P301+312":"IF SWALLOWED: Call a POISON CENTER/doctor/…/if you feel unwell.","P301+330+331":"IF SWALLOWED: Rinse mouth. Do NOT induce vomiting.","P302+334":"IF ON SKIN: Immerse in cool water/wrap in wet bandages.","P302+350":"[Deleted by IV ATP]","P302+352":"IF ON SKIN: Wash with plenty of water/…","P303+361+353":"IF ON SKIN (or hair): Take off immediately all contaminated clothing. Rinse skin with water/ shower.","P304+312":"IF INHALED: Call a POISON CENTER or doctor/physician if you feel unwell.","P304+340":"IF INHALED: Remove person to fresh air and keep comfortable for breathing.","P304+341":"[Deleted by IV ATP]","P305+351+338":"IF IN EYES: Rinse cautiously with water for several minutes. Remove contact lenses if present and easy to do – continue rinsing.","P306+360":"IF ON CLOTHING: Rinse immediately contaminated clothing and skin with plenty of water before removing clothes.","P307+311":"[Deleted by IV ATP]","P308+311":"If exposed or concerned: Call a POISON CENTER/ doctor/… [Added by IV ATP]","P308+313":"If exposed: Call a POISON CENTER or doctor/physician.","P309+311":"[Deleted by IV ATP]","P332+313":"If skin irritation occurs: Get medical advice/attention.","P333+313":"If skin irritation or a rash occurs: Get medical advice/attention.","P335+334":"Brush off loose particles from skin. Immerse in cool water/wrap in wet bandages.","P337+313":"If eye irritation persists get medical advice/attention.","P342+311":"If experiencing respiratory symptoms: Call a POISON CENTER/doctor/…","P361+364":"Take off immediately all contaminated clothing and wash it before reuse. [Added by IV ATP]","P362+364":"Take off contaminated clothing and wash it before reuse. [Added by IV ATP]","P370+376":"In case of fire: Stop leak if safe to do so.","P370+378":"In case of fire: Use … to extinguish.","P370+380":"In case of fire: Evacuate area.","P370+380+375":"In case of fire: Evacuate area. Fight fire remotely due to the risk of explosion.","P371+380+375":"In case of major fire and large quantities: Evacuate area. Fight fire remotely due to the risk of explosion.",P401:"Store …",P402:"Store in a dry place.",P403:"Store in a well ventilated place.",P404:"Store in a closed container.",P405:"Store locked up.",P406:"Store in a corrosive resistant/… container with a resistant inner liner.",P407:"Maintain air gap between stacks/pallets.",P410:"Protect from sunlight.",P411:"Store at temperatures not exceeding … °C/… °F.",P412:"Do not expose to temperatures exceeding 50 °C/122 °F.",P413:"Store bulk masses greater than … kg/… lbs at temperatures not exceeding … °C/… °F.",P420:"Store away from other materials.",P422:"Store contents under …","P402+404":"Store in a dry place. Store in a closed container.","P403+233":"Store in a well ventilated place. Keep container tightly closed.","P403+235":"Store in a well ventilated place. Keep cool.","P410+403":"Protect from sunlight. Store in a well-ventilated place.","P410+412":"Protect from sunlight. Do not expose to temperatures exceeding 50 °C/122 °F.","P411+235":"Store at temperatures not exceeding … °C/… °F. Keep cool.",P501:"Dispose of contents/container to … [… in accordance with local/regional/national/international regulation (to be specified)]."}};scil.UMDB={molcategories:["","Organic","Inorganic","Catalyst","Polymer","Peptide","RNA","Protein","Others"],namecategories:["","CATALOG","CAS","IUPAC","SYNONYM","SYSTEM","TRADE","MFCD"],currencies:["","USD","EUR","RMB","JPY","AUD","CAD"],units:["","g","mg","kg","mL","L"],jsdraw:null,init:function(f,d){var c=this;this.page=new scil.Page(f,null);this.buttons=["-",{type:"button",src:scil.App.imgSmall("import.png"),title:"Import from CSV/SDF file",onclick:function(){c.importFile()}},{type:"button",src:scil.App.imgSmall("export.png"),title:"Export SDF",onclick:function(){c.exportFile("umdb.sdf")}},"-",{type:"button",src:scil.App.imgSmall("overdue.png"),title:"Set Hazard Flags by CAS NOs",onclick:function(){c.setHazardFlags()}},{type:"button",src:scil.App.imgSmall("searchstructure.png"),title:"Search by Structure",onclick:function(){c.searchStructure()}},"-",{type:"select",key:"countperpage",label:"Count",items:["",10,25,50,100],onchange:function(){c.refresh()}},{type:"input",key:"source",label:"Source",styles:{width:100},autosuggesturl:"ajax.ashx?cmd=umdb.suggestsource",onenter:function(){c.refresh()}},{type:"select",key:"category",label:"Category",items:this.molcategories,onchange:function(){c.refresh()}},{type:"input",key:"name",label:"Name",styles:{width:100},autosuggesturl:"ajax.ashx?cmd=umdb.suggest",onenter:function(){c.refresh()}},{type:"select",label:"Controlled",key:"controlled",items:{"":"","true":"Controlled"},onchange:function(){c.refresh()}},{type:"select",key:"hazardflag",label:"Hazard",items:scil.Hazard.getListOptions(),onchange:function(){c.refresh()}}];var h=300;this.list=this.page.addForm({caption:"Molecules",key:"moleculeid",object:"umdb",buttons:this.buttons,onbeforerefresh:function(j){c.onbeforerefresh(j)},columns:{moleculeid:{type:"hidden",iskey:true},source:{label:"Source",width:100},cas:{label:"CAS",width:100},name:{label:"Name",width:100},category:{label:"Category",width:100},density:{label:"Density",type:"number",unit:"g/mL",width:80},bp:{label:"B.P.",type:"number",unit:"°C",width:80},mp:{label:"M.P.",type:"number",unit:"°C",width:80},logp:{label:"LogP",type:"number",width:80},hazardflags:{label:"Hazard Flags",width:20,type:"html",render:scil.Hazard.renderFlags},controlled:{label:"Controlled",type:"checkbox",width:50}},formcaption:"Molecule",fields:{moleculeid:{type:"hidden",iskey:true},source:{label:"Source",width:800},category:{label:"Category",width:800},density:{label:"Density",type:"number",unit:"g/mL",width:120},bp:{label:"B.P.",type:"number",unit:"°C",width:120},mp:{label:"M.P.",type:"number",unit:"°C",width:120},logp:{label:"LogP",type:"number",unit:"°C",width:120},hazardflags:{label:"Hazard Flags",type:"multiselect",items:scil.Hazard.getListOptions(),width:800},controlled:{label:"Controlled",type:"checkbox"},jsdraw:{label:"Structure",type:"jsdraw",width:800,height:300}}},null);var g=this.page.addTabs();this.addCatalogList(this,g,this.list,true);this.addNameList(this,g,this.list,true);this.addDetailForm(this,g,this.list,true);this.list.refresh(null,{moleculeid:d})},getCatalogFields:function(c){var d={packageid:{type:"hidden",iskey:true},nameid:{type:"hidden",iskey:true},moleculeid:{label:"UMID",width:100},source:{label:"Source",width:100},name:{label:"Catalog No",width:200},productname:{label:"Product Name",width:200,render:function(f){return f!=null&&f.length>30?f.substr(0,30)+"...":f}},cas:c=="list"?{label:"CAS",width:120}:null,packagecount:{label:"Packages",width:100},size:{label:"Size",width:100},price:{label:"Price",width:150,render:function(f,g){return scil.Utils.isNullOrEmpty(f)?"":f+(g.currency==null?"":g.currency)}},pricepergram:{label:"Price/g",width:150,render:function(f,g){return scil.Utils.isNullOrEmpty(f)?"":f+(g.currency==null?"":g.currency)}},purity:{label:"Purity",width:100,render:function(f){return f==null?null:f+"%"}},grade:{label:"Grade",width:100},expiration:{label:"Expiration",type:"date",width:100},rating:{label:"Rating",width:100},status:{label:"Status",width:100},note:{label:"Note",width:150},currency:{label:"Currency",type:"select",items:this.currencies},updatedate:{label:"Update Dt.",type:"date",viewonly:true},packages:{label:"Packages",type:"table",columns:{size:{label:"Size",width:100,type:"number",units:this.units},price:{label:"Price",width:100,type:"number"}}}};if(c=="list"){d.size=d.price=d.currency=d.packages=null;d.packageid=null}else{if(c=="catalog"){d.packagecount=d.currency=d.packages=null;d.nameid=null}else{if(c=="edit"){d.size=d.price=d.packagecount=d.updatedate=null;d.packageid=null}}}return d},searchStructure:function(){var c=this;JSDraw2.Editor.showPopup("Search by Structure","Search",function(d){var f=d.getXml();if(!scil.Utils.isNullOrEmpty(f)){c.jsdraw=d.getXml();c.refresh()}})},setHazardFlags:function(){if(this.hazardDlg==null){var d=this;var c={hazardflag:{label:"Hazard Flag",type:"select",items:scil.Hazard.getListOptions()},casnos:{label:"CAS NOs",type:"textarea",width:800,height:100}};this.hazardDlg=scil.Form.createDlgForm("Set Hazard Flags by CAS NOs",c,{label:"Save",onclick:function(){d.setHazardFlags2()}})}this.hazardDlg.show();this.hazardDlg.form.setData({})},setHazardFlags2:function(){var c=this;scil.Utils.ajax("ajax.ashx?cmd=umdb.sethazardflag",function(){c.hazardDlg.hide()},this.hazardDlg.form.getData())},exportFile:function(d){var c={filename:d};this.onbeforerefresh(c);scil.Utils.post("ajax.ashx?cmd=umdb.export",c,"_blank")},importFile:function(){var d=this;var c={source:{label:"Vendor",attributes:{name:"source"}},appending:{label:"Appending",type:"checkbox",str:"Appending Mode",attributes:{name:"appending"}},file:{label:"File",attributes:{name:"file"},type:"rawfile",str:"(Supporting CSV/SDF files)"}};this.importDlg=scil.Form.createDlgForm("Import File",c,{label:"Import",onclick:function(){d.importFile2()}},{usepostform:true})},importFile2:function(){this.importDlg.form.postForm("ajax.ashx?cmd=umdb.import",null,function(c){scil.Utils.alert(c)})},refresh:function(){this.list.refresh()},onbeforerefresh:function(c){if(this.jsdraw!=null){c.jsdraw=this.jsdraw}else{scil.Form.getButtonValuesByKey(this.buttons,["name","controlled","category","source","hazardflag","countperpage"],c)}this.jsdraw=null},addCatalogList:function(g,f,c,h){var d=this;g.catalogs=f.addForm({object:"umdb.catalog",tabkey:"name",key:"nameid",caption:"Catalogs",columns:this.getCatalogFields("list"),formcaption:"Name",fields:this.getCatalogFields("edit")},c)},addNameList:function(g,f,c,h){var d=this;g.names=f.addForm({object:"umdb.name",tabkey:"name",key:"nameid",caption:"Names",columns:{nameid:{type:"hidden",iskey:true},source:{label:"Source",width:100},category:{label:"Category",width:100},name:{label:"Name",width:300}},formcaption:"Name",fields:{nameid:{type:"hidden"},moleculeid:{label:"UMID",viewonly:true,width:200},source:{label:"Source",width:200},category:{label:"Category",type:"select",items:this.namecategories,width:200},name:{label:"Name",width:600}}},c)},addDetailForm:function(f,d,c,g){f.detail=d.addForm({type:"form",object:"umdb",caption:"Molecule",fields:{jsdraw:{label:"Structure",type:"jsdraw",width:800,height:400}}},c)}};scil.UMDB.Search={dlg:null,ajax:"ajax.ashx?cmd=",scopes:{"./":"Internal"},init:function(h,g){var f=this;this.page=new scil.Page(h);this.buttons=["-",{src:scil.App.imgSmall("cart.png"),title:"Purchase",onclick:function(){f.purchaseSelected()}},"-",{type:"select",key:"scope",label:"Database",items:this.scopes},"-",{type:"select",key:"countperpage",label:"Count",items:["",10,25,50,100],onchange:function(){f.refresh()}},{type:"select",key:"category",label:"Category",items:this.molcategories,onchange:function(){f.refresh()}},{type:"select",key:"packageonly",label:"Package",items:{"0":"All Catalog","1":"Package Only"},onchange:function(){f.refresh()}},{type:"input",key:"source",label:"Source",styles:{width:100},autosuggesturl:"ajax.ashx?cmd=",onsuggest:function(j,n,l){f.onsuggest(l,"umdb.suggestsource")},onenter:function(){f.refresh()}},{type:"input",key:"name",label:"Name",styles:{width:100},autosuggesturl:"ajax.ashx?cmd=",onsuggest:function(j,n,l){f.onsuggest(l,"umdb.suggest")},onenter:function(){f.refresh()}}];var c=scil.UMDB.getCatalogFields("catalog");c.moleculeid.type="html";c.moleculeid.template="<u>{?}</u>";var d=g!=null&&g.issearch;this.list=this.page.addForm({caption:d?null:"Catalog",key:"nameid",object:"umdb.search",rowcheck:true,jsonp:true,buttons:this.buttons,onbeforerefresh:function(j){f.onbeforerefresh(j)},columns:c});var f=this;new scil.Popup(this.list.table.tbody.parentNode,{caption:"UMDB",ongethtml2:function(l,j){var n=j.srcElement||j.target;if(n.tagName=="U"){return"<img src='"+f.getUrl("Chem2Image.aspx?source=umdb&q=")+n.innerHTML+"'/>"}else{return null}}})},onsuggest:function(c,d){c.url=this.getUrl(this.ajax)+d},purchaseSelected:function(){var c=this.list.table.getCheckedKeys();if(c==null||c.length==0){scil.Utils.alert("No items selected");return}var d=this;scil.Utils.jsonp(this.getUrl(this.ajax)+"umdb.loadpackages",function(f){if(d.callback!=null){d.callback(f,d)}},{packageids:scil.Utils.array2str(c,",")})},refresh:function(){this.list.refresh()},onbeforerefresh:function(c){scil.Form.getButtonValuesByKey(this.buttons,["name","category","source","countperpage","packageonly"],c);this.page.url=this.getUrl(this.ajax)},getUrl:function(c){var d=scil.Form.getButtonValueByKey(this.buttons,"scope");if(scil.Utils.isNullOrEmpty(d)){return c}return d+(scil.Utils.endswith(d,"/")?"":"/")+c},setSource:function(c){scil.Form.setButtonValueByKey(this.buttons,"source",c)},showDlg:function(c,f){if(this.dlg==null){var d=scil.Utils.createElement(null,"div",null,{width:f!=null&&f.width>0?f.width:1100});this.dlg=new scil.Dialog("Search Commerical Compounds",d);this.dlg.show();if(f==null){f={}}f.issearch=true;this.init(this.dlg,f)}else{this.dlg.show()}if(f.source!=null){this.setSource(f.source)}this.dlg.moveCenter();this.callback=c}};scil.Courier={url:"jsdraw/service.aspx",track:function(c,f){var d=this;scil.Utils.ajax(this.url+"?cmd=tracker.track",function(g){d.create();d.show(g)},{carrier:c,trackno:f})},create:function(){if(this.dlg!=null){return}var c={trackno:{label:"Tracking No",viewonly:true},details:{label:"Details",viewonly:true,type:"table",columns:{datetime:{label:"Date/Time",width:100},activity:{label:"Activity",width:400},location:{label:"Location",width:150}}}};this.dlg=scil.Form.createDlgForm("Tracking",c)},show:function(c){this.dlg.show();this.dlg.form.setData(c);this.dlg.moveCenter()}};scil.Math={sum:function(d){var f=0;for(var c=0;c<d.length;++c){f+=d[c]}return f},round:function(g,f){if(g==null||isNaN(g)){return null}var c=Math.pow(10,f);return Math.round(g*c)/c},min:function(d){var f=null;for(var c=0;c<d.length;++c){if(f==null||d[c]<f){f=d[c]}}return f},max:function(d){var f=null;for(var c=0;c<d.length;++c){if(f==null||d[c]>f){f=d[c]}}return f},median:function(c){if(c==null||c.length==0){return null}if(c.length==1){return c[0]}c.sort();if(c.length%2==1){return c[(c.length-1)/2]}var d=c.length/2;return(c[d]+c[d-1])/2},avg:function(c){return scil.Math.sum(c)/c.length},stdev:function(f){var g=0;var c=scil.Math.avg(f);for(var d=0;d<f.length;++d){g+=(f[d]-c)*(f[d]-c)}return Math.sqrt(g/(f.length-1))},cv:function(c){return this.stdev(c)*100/this.avg(c)},rsd:function(c){return scil.Math.stdev(c)/scil.Math.avg(c)},ad:function(f){var g=0;var c=scil.Math.avg(f);for(var d=0;d<f.length;++d){g+=Math.abs(f[d]-c)}return g/f.length},rd:function(f){var g=0;var c=scil.Math.avg(f);for(var d=0;d<f.length;++d){g+=Math.abs(f[d]-c)}return g/c},log10:function(c){return Math.log(c)/Math.LN10},lsfit:function(E,F){var w=0;var B=0;var A=0;var z=0;var f=0;var G=0;var H=0;var D=E.length;if(D!=F.length){throw new Error("The parameters values_x and values_y need to have same size!")}if(D===0){return null}for(var C=0;C<D;C++){G=E[C];H=F[C];w+=G;B+=H;z+=G*G;A+=G*H;f++}var j=(f*A-w*B)/(f*z-w*w);var d=(B/f)-(j*w)/f;var q=[];for(var C=0;C<D;C++){G=E[C];H=G*j+d;q.push(H)}var t=0;var u=0;var c=scil.Math.avg(F);for(var h=0;h<q.length;++h){var g=(q[h]-F[h]);var l=(F[h]-c);t+=g*g;u+=l*l}var n=1-t/u;return{yvalues:q,r2:n,formular:"y = "+scil.Utils.roundStr(j,2)+" x "+(d<0?"-":"+")+" "+scil.Utils.roundStr(Math.abs(d),2)}}};scil.Dictionary={init:function(c){var d={caption:"Categories",key:"category",name:"category",object:"dictionary",root:{selectable:true,name:"Categories",icon:scil.App.imgSmall("categories.png")}};this.page=new scil.Page(c,d);this.words=this.page.addForm(this.tableForm(),this.page.tree);this.words.refresh()},refresh:function(c){this.words.refresh()},onbeforerefresh:function(c){scil.Form.getButtonValuesByKey(this.buttons,["q","countperpage"],c)},tableForm:function(){var d=this;var c=scil.User.isAdmin();this.buttons=["-"];if(c){this.buttons.push({src:"small/import.png",title:"Import",onclick:function(){d.importText()}});this.buttons.push("-")}this.buttons.push({type:"select",key:"countperpage",label:"Count",items:["",10,25,50,100],onchange:function(){d.refresh()}});this.buttons.push({type:"input",key:"q",label:"Search",styles:{width:100},autosuggesturl:"ajax.ashx?cmd=dictionary.suggest",onenter:function(){d.refresh()}});return{caption:"Words",key:"wordid",object:"dictionary",buttons:this.buttons,canadd:c,canedit:c,download:true,onbeforerefresh:function(f){d.onbeforerefresh(f)},columns:{wordid:{type:"hidden",iskey:true},word:{label:"Word",width:200},data:{label:"Data",width:400}},formcaption:"Word",fields:{wordid:{type:"hidden"},word:{label:"Word",width:400},data:{label:"Data",width:400},category:{label:"Category",width:400}}}},importText:function(){var c=this;scil.Utils.prompt2({caption:"Import Words",message:"Paste Words below, one word per line",multiline:true,height:300,callback:function(d){scil.Utils.ajax("ajax.ashx?cmd=dictionary.import",function(f){c.refresh()},{category:c.words.args.category,text:d})}})}};scil.Animation={enabled:!scil.Utils.isIE&&typeof(anime)!="undefined",expandX:function(d,f,c){this.expandXY(d,f,null,c)},expandY:function(f,c,d){this.expandXY(f,null,c,d)},makeExpandable:function(f,d,c){f.style.overflow="hidden";if(d!=null){f.style.maxWidth=d}if(c!=null){f.style.maxHeight=c}f.style.display="block"},expandXY:function(j,l,f,h){var c=l!=null&&scil.Utils.isNullOrEmpty(j.style.maxWidth);var d=f!=null&&scil.Utils.isNullOrEmpty(j.style.maxHeight);if(c||d){if(c){j.style.maxWidth=(j.offsetWidth==null?0:j.offsetWidth)+"px"}if(d){j.style.maxHeight=(j.offsetHeight==null?0:j.offsetHeight)+"px"}var g=this;setTimeout(function(){g._expandxy(j,l,f,h)})}else{this._expandxy(j,l,f,h)}},_expandxy:function(g,j,d,f){var c=500;var h="";if(j!=null){h+=(h==""?"":",")+"max-width "+(c/1000)+"s"}if(d!=null){h+=(h==""?"":",")+"max-height "+(c/1000)+"s"}g.style.WebkitTransition=h;g.style.transition=h;this.makeExpandable(g,j==null?null:j+"px",d==null?null:d+"px");setTimeout(function(){if(j===0||d===0){g.style.display="none"}else{if(j!=null){if(g.offsetWidth>=j){g.style.maxWidth=(j+1000)+"px";g.style.display="visible"}g.style.maxWidth=g.offsetWidth+"px"}if(d!=null){if(g.offsetHeight>=d){g.style.maxHeight=(d+1000)+"px";g.style.display="visible"}g.style.maxHeight=g.offsetHeight+"px"}}if(f!=null){f()}},c)},flyin:function(f){var c=this.beginfly(f);this.run(f.div,{translateX:[{value:c.dx,duration:1000}],translateY:[{value:c.dy,duration:1000}],scale:[{value:0.3,duration:1500}],opacity:[{value:0.3,duration:1500}],easing:"easeInOutQuart"},null,function(){f.div.style.display="none"})},flyback:function(f){var c=this.beginfly(f);this.run(f.div,{translateX:[{value:c.dx,duration:500}],translateY:[{value:c.dy,duration:500}],scale:[{value:0.3,duration:500}],easing:"easeInOutQuart",direction:"alternate"},null,function(){f.div.style.display="none"})},beginfly:function(c){var d=scil.Utils.getOffset(c.src).offset(c.src.offsetWidth/2,c.src.offsetHeight/2);var f=scil.Utils.getOffset(c.dest);switch(c.destalign.align){case"left":f.offset(0,c.dest.offsetHeight/2);break;case"right":f.offset(c.dest.offsetWidth,c.dest.offsetHeight/2);break;case"top":f.offset(c.dest.offsetWidth/2,0);break;case"bottom":f.offset(c.dest.offsetWidth/2,c.dest.offsetHeight);break;default:f.offset(c.dest.offsetWidth/2,c.dest.offsetHeight/2);break}f.offset(c.destalign.dx==null?0:c.destalign.dx,c.destalign.dy==null?0:c.destalign.dy);if(!c.useimg){scil.apply(c.div.style,{width:c.src.offsetWidth+"px",height:c.src.offsetHeight+"px"})}scil.apply(c.div.style,{display:"",transform:"",left:(d.x-c.imgwidth/2)+"px",top:(d.y-c.imgheight/2)+"px"});return{dx:f.x-d.x,dy:f.y-d.y}},destoryflyer:function(c){if(c.div!=null){c.div.parentNode.removeChild(c.div);c.div=null}},makeflyer:function(n,c,g,j,h,d){if(typeof(n)=="string"){n=scil.byId(n)}if(typeof(c)=="string"){c=scil.byId(c)}var f=null;if(typeof(g)=="string"){f=scil.Utils.createElement(document.body,"img",null,{position:"absolute",zIndex:1000000,display:"none"},{src:g})}else{f=g}var q=f!=null;if(!q){var l=75;f=scil.Utils.createElement(document.body,"div",null,{position:"absolute",border:"solid 1px blue",background:"yellow",opacity:l/100,filter:"alpha(opacity="+l+")",zIndex:1000000,display:"none"})}if(j==null){j=50}if(h==null){h=50}return{div:f,useimg:q,src:n,dest:c,imgwidth:j,imgheight:h,destalign:d==null?{}:d}},shake:function(d,c){if(!this.enabled){if(c!=null){c()}return}anime.timeline().add({targets:d,translateX:30,duration:50,easing:"easeInOutQuart"}).add({targets:d,translateX:-30,duration:50,easing:"easeInOutQuart"}).add({targets:d,translateX:30,duration:50,easing:"easeInOutQuart"}).add({targets:d,translateX:0,duration:50,easing:"easeInOutQuart",complete:function(){if(c!=null){c()}}})},translateX:function(l,d,c,h){if(d==null){d=500}if(c==null){c=1000}var f=this;var g={mode:l.style.position,left:l.style.left,top:l.style.top,transform:""};var j=g.mode;if(scil.Utils.isNullOrEmpty(j)){j="relative"}this.run(l,{translateX:[{value:d,duration:c}]},{mode:j,dx:d},function(){f._setposition(l,g);if(h!=null){h()}})},translateY:function(l,d,c,h){if(d==null){d=500}if(c==null){c=1000}var f=this;var g={mode:l.style.position,left:l.style.left,top:l.style.top,transform:""};var j=g.mode;if(scil.Utils.isNullOrEmpty(j)){j="relative"}this.run(l,{translateY:[{value:d,duration:c}]},{mode:j,dy:d},function(){f._setposition(l,g);if(h!=null){h()}})},zoomin:function(h,c,g){if(c==null){c=1000}var d=this;var f={mode:"scale",transform:""};this.run(h,{scale:[{value:1,duration:c,easing:"easeInOutQuart"}]},{mode:"scale",scale:0},function(){d._setposition(h,f);if(g!=null){g()}})},zoomout:function(h,c,g){if(c==null){c=500}var d=this;var f={mode:"scale",transform:""};this.run(h,{scale:[{value:0,duration:c,easing:"easeInOutQuart"}]},{mode:"scale",scale:1},function(){d._setposition(h,f);if(g!=null){g()}})},run:function(j,c,h,g){if(!this.enabled){if(g!=null){g()}return}var n=null;var q=null;if(h!=null){if(h.mode=="scale"){if(h.scale!=null){this._setposition(j,{mode:h.mode,transform:"scale("+h.scale+")"})}}else{if(h.dx!=null){n=scil.Utils.parsePixel(j.style.left,0)}if(h.dy!=null){q=scil.Utils.parsePixel(j.style.top,0)}this._setposition(j,{mode:h.mode,left:n==null?null:(n-h.dx)+"px",top:q==null?null:(q-h.dy)+"px",transform:""})}}var f=this;if(c.length>0){var l=anime.timeline();for(var d=0;d<c.length;++d){c[d].targets=j;if(d==c.length-1&&g!=null){c[d].complete=g}l.add(c[d])}}else{c.targets=j;if(g){c.complete=g}anime(c)}},_setposition:function(c,d){if(d.mode!="scale"){if(d.mode=="relative"){c.style.position="relative"}else{if(d.mode=="absolute"){c.style.position="absolute"}else{c.style.position=d.mode==null?"":d.mode}}if(d.left!=null){c.style.left=d.left}if(d.top!=null){c.style.top=d.top}}if(d.transform!=null){c.style.transform=d.transform}}};scil.CardView=scil.extend(scil._base,{constructor:function(c){this.currow=null;this.options=c==null?{}:c;if(!(this.options.imgwidth>0)){this.options.imgwidth=300}if(!(this.options.imgheight>0)){this.options.imgheight=120}},clear:function(){for(var c=0;c<this.parent.childNodes.length;++c){delete this.parent.childNodes[c].data}scil.Utils.removeAll(this.parent);this.currow=null},autoHideColumns:function(){},showAllColumns:function(){},setXml:function(c){this.setData(scil.Table.xml2rows(c))},setData:function(d,g,c){if(c!=false){this.clear()}if(d!=null){for(var f=0;f<d.length;++f){this.addRow(d[f])}}},render:function(f,d){if(typeof(f)=="string"){f=scil.byId(f)}this.parent=scil.Utils.createElement(f,"div",null,{clear:"left"});this.items={};for(var c in d){if(d[c]!=null){this.items[c]=d[c];if(d[c].iskey){this.key=c}}}},getCurrentKey:function(){if(this.currow==null){return null}var c=this.currow.getAttribute("key");return c==""?null:c},getRowData:function(c,d){if(c==null){return null}if(typeof(c)=="number"){c=this.parent.childNodes[c];if(c==null){return null}}return c.data},getCurrentRowData:function(){return this.getRowData(this.currow)},getCheckedKeys:function(h){var g=[];var f=this.parent.childNodes;for(var c=0;c<f.length;++c){if(this._isChecked(f[c])){g.push(f[c].getAttribute("key"))}}if(g.length==0&&h){var d=this.getCurrentKey();if(d!=null){g.push(d)}}return g},selectFirstRow:function(){var c=this.parent.childNodes[0];this.selectRow(c)},getCheckedKeys2:function(){return this.getCheckedKeys(true)},checkRows:function(d){if(d==null){return}var f=this.parent.childNodes;for(var c=0;c<f.length;++c){if(scil.Utils.indexOf(d,f[c].getAttribute("key"))>=0){this.checkRow(f[c],true)}}},getCheckedRows:function(g){var f=[];var d=this.parent.childNodes;for(var c=0;c<d.length;++c){if(this._isChecked(d[c])){f.push(c)}}if(f.length==0&&g){for(var c=0;c<d.length;++c){if(d[c]==this.currow){f.push(c);break}}}return f},getCheckedRows2:function(){return this.getCheckedRows(true)},getCheckedRowData:function(j){var h=[];var g=this.parent.childNodes;for(var f=0;f<g.length;++f){if(this._isChecked(g[f])){h.push(this.getRowData(g[f]))}}if(h.length==0&&j){var c=this.getCurrentRowData();if(c!=null){h.push(c)}}return h},getCheckedRowData2:function(){this.getCheckedRowData(true)},delRow:function(d){var f=this.parent.childNodes;for(var c=0;c<f.length;++c){if(f[c].getAttribute("key")==d){delete f[c].data;this.parent.removeChild(f[c]);if(this.options.onchange!=null){this.options.onchange(this)}this.dirty=true;return true}}return false},updateRow:function(g,c){var h=this.parent.childNodes;for(var f=0;f<h.length;++f){if(h[f].getAttribute("key")==g){var d=h[f];if(c==null){c={}}var j=this.addRow(c,null,d);this.parent.removeChild(d);if(this.currow==d){this.selectRow(j)}return true}}return false},findRow:function(d){var f=this.parent.childNodes;for(var c=0;c<f.length;++c){if(f[c].getAttribute("key")==d){return f[c]}}return null},selectRow:function(c){if(typeof(c)=="string"){c=this.findRow(c)}if(this.currow==c){return}var d=this.currow;if(this.currow!=null){this.currow.style.background=""}if(c!=null){c.style.background=scil.App.config.frame}this.currow=c;if(this.options.onselectrow!=null){this.options.onselectrow(this.currow,d)}},ondblclick:function(c){if(this.options.ondblclick!=null){this.options.ondblclick(c,this)}},selectColumns:function(d,c,f){scil.Table.selectColumns(this,d,c,f)},allColsForDownload:function(){return scil.Table.allColsForDownload(this)},_getvalue:function(g,d){if(d==null){return null}var f=g[d];var c=this.items[d];if(c!=null&&c.render!=null){f=c.render(f,g,this)}return f},addRow:function(B){var n=this;var u={boxShadow:"2px 2px 6px 2px rgba(0,0,0,0.2)",background:"#fff",margin:"2px",textAlign:"center",width:this.options.width,overflowX:"hidden",border:"solid 1px gray"};if(this.options.type!="column"){scil.apply(u,{display:"table","float":"left"})}var d=scil.Utils.createElement(this.parent,"div",null,u);scil.connect(d,"onclick",function(){n.selectRow(d)});scil.connect(d,"ondblclick",function(){n.ondblclick(d)});var w=scil.Utils.createTable(d,0,0,{width:"100%"});var g=this.options.imgkey;if(g!=null){var A=scil.Utils.createElement(w,"tr");var y=scil.Utils.createElement(A,"td",null,{padding:"2px"});if(this.options.renderimg!=null){this.options.renderimg(y,value,this)}else{var t="100%";var f=this._getvalue(B,g);if(scil.Utils.isNullOrEmpty(f)){t="";if(typeof(this.options.imgempty)=="function"){f=this.options.imgempty(B)}else{if(this.options.imgempty!=null){f=this.options.imgempty}}}var q=null;if(!this.options.showtexts&&this.options.imgtitlekey!=null&&B!=null){q=B[this.options.imgtitlekey]}var c=scil.Utils.createElement(y,"div",q,{color:"#ccc",display:"block",position:"relative",width:this.options.imgwidth,height:this.options.imgheight,backgroundColor:"#fff",backgroundImage:"url('"+f+"')",backgroundRepeat:"no-repeat",backgroundPosition:"center",backgroundSize:t});if(this.options.rowcheck){d.check=JsUtils.createElement(c,"img",null,{position:"absolute",left:(this.options.imgwidth-32)+"px",top:"0",cursor:"pointer"},{src:"jsdraw/img/unchecked.gif",title:"Select"});scil.connect(d.check,"onclick",function(){n.checkRow(d)})}}}if(this.options.showtexts!=false){var z=null;if(this.options.horizontal){z=scil.Utils.createElement(A,"td",null,{borderLeft:"solid 1px gray"})}else{z=scil.Utils.createElement(scil.Utils.createElement(w,"tr"),"td",null,{borderTop:"solid 1px gray"})}var w=scil.Utils.createTable(scil.Utils.createElement(z,"div",null,{width:this.options.imgwidth,overflow:"hidden"}));w.parentNode.setAttribute("align","center");var j=this.options.ondisplayitems==null?this.items:this.options.ondisplayitems(this.items);for(var l in j){var h=j[l];if(l==g||h.type=="hidden"){continue}var A=scil.Utils.createElement(w,"tr");scil.Utils.createElement(A,"td",scil.Lang.res(h.label)+": ",{textAlign:"right",whiteSpace:"nowrap"});var x=scil.Utils.createElement(A,"td",null,{textAlign:"left"});x.field=scil.Form.createField(x,h,true,B==null?h.value:B[l],B,true,"card")}}d.data=B;if(this.key!=null&&B[this.key]!=null){d.setAttribute("key",B[this.key])}return d},checkRow:function(c,d){if(!this.options.rowcheck){return}if(typeof(c)=="string"){c=this._findByKey(c)}else{if(typeof(c)=="number"){c=this.parent.childNodes[c]}}if(c==null){return}if(d==null){d=!this._isChecked(c)}if(d){if(c.check!=null){c.check.src="jsdraw/img/checked.gif"}c.setAttribute("checked","1")}else{if(c.check!=null){c.check.src="jsdraw/img/unchecked.gif"}c.removeAttribute("checked")}},showColumn:function(d,c){},_isChecked:function(c){return c.getAttribute("checked")=="1"},_findByKey:function(d){var f=this.parent.childNodes;for(var c=0;c<f.length;++c){if(f[c].getAttribute("key")==d){return f[c]}}return null}});scil.FileUploader={current:null,upload:function(c){if(c.dlg==null){var d={};if(c.multiple){d.multiple="multiple"}var h={file:{label:(d.multiple?"Files":"File"),type:"rawfile",attributes:d}};scil.apply(h,c.fields);if(!scil.MobileData.disabled&&c.frommobile!=false){var j=this;h.mobileimages={type:"hidden"};h.mobileimagediv={label:"From Mobile",type:"div",style:{maxWidth:"400px"},button:{label:"Show",type:"a",onclick:function(){j.showImageList(c)}}}}var j=this;var g=c.caption==null?"Upload File":c.caption;var f=c.buttonlabel==null?"Upload":c.buttonlabel;c.dlg=scil.Form.createDlgForm(g,h,{label:f,onclick:function(l){l.preventDefault();scil.FileUploader.upload2(c)}},{usepostform:true})}c.dlg.show();this.current=c},getFilenames:function(c){var g=[];var f=c.dlg.form.fields.file.files;for(var d=0;d<f.length;++d){g.push(f[d].name)}scil.MobileData.getSelectedImageNames(c.mobileimagelist,g);return g},showImageList:function(c){if(c.mobileimagelist==null){c.mobileimagelist=scil.MobileData.createImageList(c.dlg.form.fields.mobileimagediv,c.multiple)}scil.MobileData.listImages(c.mobileimagelist,c.data)},upload2:function(c){if(c.dlg.form.fields.mobileimages!=null&&c.mobileimagelist!=null){c.dlg.form.fields.mobileimages.value=scil.MobileData.getSelectedImages(c.mobileimagelist)}if(c.onupload!=null){c.onupload(c,this)}else{this.upload3(c)}},upload3:function(c){c.dlg.form.post(c.url,c.data,function(d){if(c.callback(d,c)!=false){c.dlg.hide()}})},mapData:function(g,d){var f=this;var c=this.current;c.dlg.form.post(g,c.data,function(h){f.showMap(h,d)})},showMap:function(ret,cols){var options={"":""};for(var k in cols){options[k]=cols[k].label}var columns={};var dict=ret[0];for(var k in dict){columns[k]={label:k}}var fields={note:{type:"html",template:"Preview for the first 5 rows:"},table:{type:"table",viewonly:true,columns:columns}};var me=this;var selects={};var dlg=null;dlg=scil.Form.createDlgForm("Data Mapping",fields,{label:"Save Mapping",onclick:function(){me.saveMap(selects);dlg.hide()}},{hidelabel:true});dlg.show();dlg.form.setData({table:ret});var mapping=scil.Utils.eval(this.current.dlg.form.getFieldValue("__mapping"));var tbody=dlg.form.fields.table.jsd.tbody;var tr=scil.Utils.createElement(null,"tr");tbody.insertBefore(tr,tbody.firstChild.nextSibling.nextSibling);for(var k in columns){var td=scil.Utils.createElement(tr,"td");selects[k]=scil.Utils.createElement(td,"select");scil.Utils.listOptions(selects[k],options,(mapping==null||mapping[k]==null?this.findKeyByValue(options,k):mapping[k]),true,true)}},findKeyByValue:function(c,f){if(c==null){return f}for(var d in c){if(c[d]==f){return d}}return f},saveMap:function(d){var f={};for(var c in d){var g=d[c].value;if(g!=""){f[c]=g}}var g=scil.Utils.json2str(f);this.current.dlg.form.setFieldValue("__mapping",g)}};scil.AutoShrink=scil.extend(scilligence._base,{constructor:function(c,d,f){if(scil.AutoShrink.disabled){return}if(typeof(c)=="string"){c=scil.byId(c)}if(c==null||c.tagName!="INPUT"&&c.tagName!="SELECT"){return}var h=d.styles!=null&&d.styles.width!=null?d.styles.width:d.width;if(!(h>0)){h=100}var g=d.shrinkwidth;if(!(g>0)){g=20}scil.connect(c,"onfocus",function(){c.style.width=h+"px"});scil.connect(c,"onblur",function(){if(scil.Utils.isNullOrEmpty(c.value)){c.style.width=g+"px"}});if(f&&scil.Utils.isNullOrEmpty(c.value)){c.style.width=g+"px"}}});scil.SampleReceiver={instruments:{"":"","http://192.168.1.1:8012/?cmd=sendsample":"HPLC-001 (Test)"},send:function(c,f){if(this.dlg==null){var g=this;var d={url:{label:"Instrument",type:"select",items:this.instruments}};this.dlg=scil.Form.createDlgForm("Send Samples",d,{label:"Send",onclick:function(){g.send2()}})}this.key=f;this.field=c;this.dlg.show()},send2:function(){var f=this.dlg.form.getFieldValue("url");if(scil.Utils.isNullOrEmpty(f)){scil.Utils.alert("Please select an instrument first");return}this.dlg.hide();var d=scil.eln.User.me==null?null:scil.eln.User.me.name;var c={jss:this.field.jss,key:this.key,url:f,i:0,n:0,fileno:this.field.form.fileno,owner:d};this.sendNext(null,c)},sendNext:function(j,c){if(j!=null){++c.n}for(var f=c.i;f<c.jss.getRowCount();++f){var h=c.jss.getRowValues(f);if(h.select){var g=this;var d={sampleid:h[c.key==null?"sampleid":c.key],experimentno:c.fileno,owner:c.owner,note:h.note||h.comment};scil.Utils.jsonp(c.url,function(l){c.i=f+1;g.sendNext(l,c)},d);return}}if(c.n==0){scil.Utils.alert("No sample sent.")}else{scil.Utils.alert(c.n+" sample(s) sent successfully.")}}};scil.Annotator={disabled:true,dlg:null,ed:null,callback:null,kColor:"#fffe00",changed:false,kSeparator:"\n----------------\n",show:function(f,c){if(scil.Annotator.disabled){return}if(this.eddlg==null){var g=this;var d={btn:{type:"html",template:"<div title='"+scil.Lang.res("Annotate")+"' onclick='scil.Annotator.annotate()' style='background:#ddd; padding: 0 0 0 5px; border: solid 1px gray;'><img valign='middle' src='img/comment.gif'></div>"},ed:{type:"htmltext",width:800,height:400,readonly:true,hidetoolbar:true}};this.eddlg=scil.Form.createDlgForm("Annotation",d,{label:"Save",onclick:function(){g.save()}},{hidelabel:true})}this.changed=false;this.callback=c;this.eddlg.show();this.eddlg.form.setData({ed:f})},save:function(){if(this.changed){var d=this;var c=this.eddlg.form.getData();this.callback(c.ed,function(){d.eddlg.hide()})}else{this.eddlg.hide()}},annotate:function(){var c=scil.Form.getEd(this.eddlg.form.fields.ed);this.edit(c)},edit:function(d){this.ed=d;if(scil.Utils.isIE){scil.eln.Richtext.saveBookmark(this.ed)}var h=this.ed.selection.getNode();var c=this.getAnnSpan(h);if(this.dlg==null){var g=this;var f={annid:{type:"hidden"},oldnote:{type:"textarea",viewonly:true},note:{type:"textarea",width:500,height:50}};this.dlg=scil.Form.createDlgForm("Inline Annotation",f,[{label:"Save",onclick:function(){g.saveAnn()}}," ",{label:"Delete",onclick:function(){g.delAnn()}}],{hidelabel:true})}this.dlg.show();this.dlg.form.setData(c)},getAnnSpan:function(c){var d=c.getAttribute("annid");if(scil.Utils.startswith(d,"ann")){var g=c.getAttribute("title");var l=c.getAttribute("userid");if(l!=scil.User.getAuthorID()){return{annid:d,userid:l,oldnote:g}}var j="";var h=g.lastIndexOf(this.kSeparator);if(h>0){j=g.substr(h+this.kSeparator.length);g=g.substr(0,h)}else{j=g;g=null}var f=null;var h=j.lastIndexOf("\n(by ");if(h>0){f=j.substr(0,h)}return{annid:d,userid:l,oldnote:g,note:f}}return null},isAnnColor:function(c){return c==this.kColor||c=="rgb(255, 254, 0)"},saveAnn:function(){var d=this.dlg.form.getData();this.dlg.hide();var q=this.ed.settings.readonly;if(q){this.ed.setMode("design")}if(scil.Utils.isIE){scil.eln.Richtext.restoreBookmark(this.ed)}var t=new Date();var c="ann"+t.getTime();var u=scil.User.getAuthorID();var l=(scil.Utils.isNullOrEmpty(d.note)?scil.Lang.res("[No Comments]"):d.note)+"\n(by "+scil.User.getAuthorName()+" at "+scil.Utils.timeStr(t,true)+")";if(!scil.Utils.isNullOrEmpty(d.oldnote)){l=d.oldnote+this.kSeparator+l}var j=0;if(scil.Utils.isNullOrEmpty(d.annid)){this.ed.execCommand("HiliteColor",false,this.kColor);var h=this.ed.dom.doc.getElementsByTagName("span");for(var g=0;g<h.length;++g){var f=h[g];if(this.isAnnColor(f.style.backgroundColor)&&scil.Utils.isNullOrEmpty(f.getAttribute("annid"))){f.style.backgroundColor=this.kColor;f.setAttribute("annid",c);f.setAttribute("userid",u);f.setAttribute("title",l);++j}}}else{var h=this.ed.dom.doc.getElementsByTagName("span");for(var g=0;g<h.length;++g){var f=h[g];if(f.getAttribute("annid")==d.annid){f.style.backgroundColor=this.kColor;f.setAttribute("annid",c);f.setAttribute("userid",u);f.setAttribute("title",l);++j}}}if(q){this.ed.setMode("readonly")}this.changed=j>0;if(this.changed){this.ed.fire("change")}},delAnn:function(){var c=this.dlg.form.getData();this.dlg.hide();if(scil.Utils.isNullOrEmpty(c.annid)){return}var h=0;var g=this.ed.dom.doc.getElementsByTagName("span");for(var f=0;f<g.length;++f){var d=g[f];if(d.getAttribute("annid")==c.annid){d.style.backgroundColor="";d.removeAttribute("annid");d.removeAttribute("name");d.removeAttribute("title");d.removeAttribute("data-mce-style");++h}}this.changed=h>0;if(this.changed){this.ed.fire("change")}}};scil.FieldOKTA=scil.extend(scil._base,{constructor:function(f,d){if(typeof(f)=="string"){f=scil.byId(f)}this.options=d==null?{}:d;this.dlg=null;this.email=null;this.token=scil.Utils.createElement(f,"password",null,this.options,scil.FieldOKTA.kReadOnly?{readonly:"readonly"}:null);if(!this.options.viewonly){var c=this;scil.Utils.createElement(f,"span","&nbsp;");scil.Utils.createButton(f,{label:"Ext Auth",onclick:function(){c.show()}})}},show:function(){if(scil.OktaUI.enabled){var c=this;scil.OktaUI.show(function(f,d){c.token.value=f;if(c.options.emailfield!=null&&c.parentform!=null){c.parentform.setFieldValue(c.options.emailfield,d)}if(c.options.onfinish!=null){c.options.onfinish(f,c)}},!scil.Utils.isNullOrEmpty(this.email)?this.email:this.options.email,this.options.emailviewonly);return}},setValue:function(c){this.email=c;this.token.value=""},getValue:function(){return this.token.value}});scil.OktaUI={enabled:false,kUrl:"https://scilligence3.okta.com",kPage:"tools/okta/",dlg:null,callback:null,email:null,emailviewonly:false,oninit:function(d,c){},onfinish:function(f){this.dlg.hide();var c=f.user.profile.login;if(this.email!=null&&this.emailviewonly&&this.email.toLowerCase()!=c.toLowerCase()){scil.Utils.alert("Please sign in with: "+this.email);return}var d=this;scil.Utils.ajax("jsdraw/service.aspx?cmd=okta.validatetoken",function(g){if(d.callback!=null){d.callback(g.oktatoken,c,f)}},{email:c,token:f.session.token})},show:function(c,d,f){this.email=d;this.emailviewonly=f;this.create();this.dlg.show();this.callback=c;this.iframe.setAttribute("src",this.kPage+"?tm="+new Date().getTime());if(this.iframe.contentWindow.window.init!=null){this.iframe.contentWindow.window.init()}},create:function(){if(this.dlg!=null){return}var d=this;var c=scil.Utils.createElement(null,"div");this.iframe=scil.Utils.createElement(c,"iframe",null,{width:450,height:520},{frameborder:0});this.dlg=new scilligence.Dialog("OKTA Authentication",c)}};scil.FieldAzure=scil.extend(scil._base,{constructor:function(f,d){if(typeof(f)=="string"){f=scil.byId(f)}this.options=d==null?{}:d;this.dlg=null;this.email=null;this.token=scil.Utils.createElement(f,"password",null,this.options,scil.FieldAzure.kReadOnly?{readonly:"readonly"}:null);if(!this.options.viewonly){var c=this;scil.Utils.createElement(f,"span","&nbsp;");scil.Utils.createButton(f,{label:"Ext Auth",onclick:function(){c.show()}})}},show:function(){if(scil.AzureUI.enabled){var c=this;scil.AzureUI.show(function(f,d){c.token.value=f;if(c.options.emailfield!=null&&c.parentform!=null){c.parentform.setFieldValue(c.options.emailfield,d)}if(c.options.onfinish!=null){c.options.onfinish(f,c)}},!scil.Utils.isNullOrEmpty(this.email)?this.email:this.options.email,this.options.emailviewonly);return}},setValue:function(c){this.email=c;this.token.value=""},getValue:function(){return this.token.value}});scil.AzureUI={enabled:false,kPage:"tools/azure/",kInstance:"https://login.microsoftonline.com/",kTenant:"tyuanscilligence.onmicrosoft.com",kClientID:"b2587d24-51a7-44a1-a9f8-26c36522ec94",dlg:null,callback:null,email:null,emailviewonly:false,oninit:function(d,c){},onfinish:function(f){this.dlg.hide();var c=f.userName;if(this.email!=null&&this.emailviewonly&&this.email.toLowerCase()!=c.toLowerCase()){scil.Utils.alert("Please sign in with: "+this.email);return}var d=this;scil.Utils.ajax("jsdraw/service.aspx?cmd=azure.validatetoken",function(g){if(d.callback!=null){d.callback(g.azuretoken,c,f)}},{email:c,token:f.profile.exp})},show:function(c,d,f){this.email=d;this.emailviewonly=f;this.create();this.dlg.show();this.callback=c;this.iframe.setAttribute("src",this.kPage+"?tm="+new Date().getTime())},create:function(){if(this.dlg!=null){return}var d=this;var c=scil.Utils.createElement(null,"div");this.iframe=scil.Utils.createElement(c,"iframe",null,{width:450,height:520},{frameborder:0});this.dlg=new scilligence.Dialog("Auzre Authentication",c)}};scil.PKCE={generate:function(){var d=this.generateRandomString(128);var c=this.generateCodeChallenge(d);return{verifier:d,challenge:c}},generateRandomString:function(d){var g="";var f="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";for(var c=0;c<d;c++){g+=f.charAt(Math.floor(Math.random()*f.length))}return g},generateCodeChallenge:function(c){return code_challenge=this.base64URL(CryptoJS.SHA256(c))},base64URL:function(c){return c.toString(CryptoJS.enc.Base64).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}};scil.SciFinder={sso:"https://sso.cas.org",contact:"https://www.cas.org/contact",methods:["","Substances","Reactions","References","Suppliers"],search:function(d){this.createDlg();this.dlg.show();var c=this.dlg.form.getData();c.q=d.getXml();if(scil.Utils.isNullOrEmpty(c.method)){c.method="Substances"}this.dlg.form.setData(c)},search2:function(){var c=this.dlg.form.getData();this.cachequery(c);this.step1();this.dlg.hide()},createDlg:function(){if(this.dlg==null){var d={q:{label:"Search Structure",type:"jsdraw",scifinder:false,width:800,height:300},text:{label:"Search Text",width:800},markush:{label:"Markush Search",type:"checkbox"},method:{label:"Search Type",type:"select",items:this.methods}};var f=this;var c=[{label:"Search",onclick:function(){f.search2()}}," ",{label:"About",type:"a",onclick:function(){f.about()}}];this.dlg=scil.Form.createDlgForm("Search SciFinder<sup>n</sup>",d,c)}this.dlg.show()},about:function(){var c="<div style='width:500px'><a href='http://scifinder-n.cas.org' target='_blank'><img src='https://sso.cas.org/assets/images/logos/sf-n-logo.svg' width='90%'></a><br><br>In order to search SciFinder<sup>n</sup>, a <a href='"+this.contact+"' target='_blank'>SciFinder<sup>n</sup></a> subscription is needed.</div>";scil.Utils.alert2(c,"About SciFinder<sup>n</sup>")},step1:function(){var c=scil.PKCE.generate();this.pair=c;scil.Utils.createCookie("scifinder_verifier",c.verifier,1);var d=this.sso+"/as/authorization.oauth2?response_type=code&client_id="+JSDrawServices.scifinder.clientid+"&redirect_uri="+escape(this.callbackurl())+"&scope=sfn-search%20openid&code_challenge="+c.challenge+"&code_challenge_method=S256";window.open(d)},step2:function(c){var h=scil.Utils.readCookie("scifinder_verifier");var g=this.sso+"/as/token.oauth2";var d={grant_type:"authorization_code",client_id:JSDrawServices.scifinder.clientid,redirect_uri:this.callbackurl(),code_verifier:h,code:c};var f=this;scil.Utils.ajax(g,function(j){var l=j.access_token;f.submitsearch(l)},d,{ignoresucceedcheck:true})},submitsearch:function(d){var c=this.fetchquery();c.token="Bearer "+d;scil.Utils.ajax(JSDrawServices.url+"?cmd=scifinder.search",function(f){window.location=f.site+f.path},c)},callbackurl:function(){var d=JSDrawServices.url;var c=d.lastIndexOf("/");return d.substr(0,c+1)+"SciFinderLogin.htm"},cachequery:function(c){var d=scil.Utils.json2str(c);scil.Utils.createCookie("scifinder_query",d,1)},fetchquery:function(){var s=scil.Utils.readCookie("scifinder_query");return scil.Utils.eval(s)}};scil.ColorCoding=scil.extend(scil._base,{constructor:function(c){this.options=c==null?{}:c},getColor:function(n){var d=this.options;if(scil.Utils.isNullOrEmpty(n)){return n}if(typeof(n)=="string"){n=parseFloat(n)}if(isNaN(n)){return null}if(n<d.min.value){n=d.min.value}if(n>d.max.value){n=d.max.value}var j=this.str2color(d.min.color);var h=this.str2color(d.max.color);var l=j.r+(h.r-j.r)*(n-d.min.value)/(d.max.value-d.min.value);var f=j.g+(h.g-j.g)*(n-d.min.value)/(d.max.value-d.min.value);var c=j.b+(h.b-j.b)*(n-d.min.value)/(d.max.value-d.min.value);return this.color2str(l,f,c)},str2color:function(c){if(typeof c==="number"){return(c|0)}if(typeof c==="string"&&c[0]==="#"){c=c.slice(1)}var d=parseInt(c,16);return{r:(d&16711680)>>16,g:(d&65280)>>8,b:d&255}},color2str:function(f,d,c){f=Math.round(f).toString(16);d=Math.round(d).toString(16);c=Math.round(c).toString(16);return"#"+(f.length==1?"0"+f:f)+(d.length==1?"0"+d:d)+(c.length==1?"0"+c:c)}});scil.CSV={splitLine:function(h,j){if(h==null){return null}var l=[];var n="";var g=false;for(var f=0;f<h.length;++f){var d=h.substr(f,1);if(d==j&&!g){l.push(n);n=""}else{if(d=='"'){if(g){if(f==h.length-1||f<h.length-1&&h.substr(f+1,1)==j){g=false}else{n+=d}}else{if(n==""){g=true}else{n+=d}}}else{n+=d}}}l.push(n);return l}};scil.FieldChecklist=scil.extend(scil._base,{constructor:function(f,d){if(typeof(f)=="string"){f=scil.byId(f)}this.options=d==null?{}:d;this.tbody=scil.Utils.createTable(f,0,0);if(this.options.width>0){this.tbody.parentNode.style.width=this.options.width+""}this.setData(this.options.items);var c=this;if(this.options.editable&&!this.options.viewonly){scil.Utils.createButton(f,{src:scil.Utils.imgSrc("img/pen.gif"),title:"Edit",onclick:function(){c.edit()}})}},edit:function(){if(this.editDlg==null){var d=this;var c={table:{type:"table",columns:{checked:{type:"checkbox"},text:{label:"Text",width:400}}}};this.editDlg=scil.Form.createDlgForm("Edit Checklist",c,{label:"Save",onclick:function(){d.save()}},{hidelabel:true})}this.editDlg.show();this.editDlg.form.fields.table.jsd.setData(this.getData())},save:function(){var c=this.editDlg.form.fields.table.jsd.getData();this.setData(c);this.editDlg.hide()},addItem:function(g,d){if(scil.Utils.isNullOrEmpty(g)){return}var f=this;var j=scil.Utils.createElement(this.tbody,"tr");var h=scil.Utils.createElement(j,"td",null,{verticalAlign:"top"},{width:"1%"});var c=scil.Utils.createElement(h,"checkbox");scil.Utils.createElement(j,"td",g,null,{width:"99%"});if(this.options.viewonly){c.disabled=true}else{scil.connect(c,"onchange",function(l){f.checkItem(l.target||l.srcElement)})}c.checked=scil.Utils.isTrue(d);this.checkItem(c,d)},checkItem:function(c){var d=scil.Utils.getParent(c,"TR");if(d!=null){d.style.background=c.checked?"lime":""}},getXml:function(){var c=this.getData();return scil.Table.rows2xml(c)},setXml:function(d){var c=scil.Table.xml2rows(d);this.setData(c)},getData:function(){var f=[];for(var d=0;d<this.tbody.childNodes.length;++d){var h=this.tbody.childNodes[d];var c=h.childNodes[0].childNodes[0].checked;var g=scil.Utils.getInnerText(h.childNodes[1]);f.push({checked:c,text:g})}return f},setData:function(d){this.clear();if(d==null){return}for(var c=0;c<d.length;++c){var f=d[c];if(typeof(f)=="string"){this.addItem(f)}else{this.addItem(f.text,f.checked)}}},clear:function(){scil.Utils.removeAll(this.tbody)}});scil.Message={dlg:null,message:null,button:null,show:function(j,g,c,d,l){this.hide();var f=JSDraw2.Skin.dialog.bkcolor;switch((g+"").toLowerCase()){case"error":f="red";if(d==null){d=="Error"}break;case"warning":f="orange";if(d==null){d=="Warning"}break;case"succeed":case"success":f="green";if(d==null){d=="Succeed"}if(c==null){c=true}if(l==null){l=true}break;case"info":if(d==null){d=="Message"}if(c==null){c=true}if(l==null){l=true}break;default:f=g;if(d==null){d=="Message"}break}this.create(d);this.dlg.show(d);this.dlg.dialog.style.backgroundColor=f;this.message.innerHTML=j;this.dlg.moveCenter(null,l?50:null);if(c){if(!(c>200)){c=3000}var h=this;this.timer=setTimeout(function(){h.hide()},c)}},hide:function(){if(this.dlg!=null){this.dlg.hide()}if(this.timer!=null){clearTimeout(this.timer);this.timer=null}},ok:function(){this.dlg.hide()},create:function(c){if(this.dlg!=null){return}var d=this;var f=scil.Utils.createElement(null,"div");this.message=scil.Utils.createElement(f,"div",null,{minWidth:"400px",maxWidth:"900px",padding:"10px"});this.button=scil.Utils.createButton(scil.Utils.createElement(f,"div",null,{textAlign:"center"}),{label:"OK",onclick:function(){d.ok()}});this.dlg=new scilligence.Dialog("Message",f,{noclose:true})}};scil.RegMolChooseParent={dlg:null,tbody:null,callback:null,caches:[],kWidth:250,kHeight:150,kRegMolUrl:"../reg/",getUrl:function(){return scil.Registration==null?this.kRegMolUrl:""},pushCache:function(d,c){this.caches.push({parents:d,data:c});return this.caches.length-1},show:function(f,d,g){this.create();this.dlg.show();if(d!=null){this.callback=d}else{this.callback=function(h){g.parentNode.parentNode.innerHTML=h.compoundid}}var c=this.caches[f];this.list(c.parents);this.cache=c},create:function(){if(this.dlg!=null){return}var g=this;var f=scil.Utils.createElement(null,"div");this.tbody=scil.Utils.createTable(f);var c=scil.Utils.createElement(f,"div",null,{textAlign:"center",paddingTop:"10px"});scil.Utils.createButton(c,{label:"Register",onclick:function(){g.registerAgain()}});this.dlg=new scilligence.Dialog("Choose Parent",f)},registerAgain:function(n,g,j){var n=null;var d=this.tbody.getElementsByTagName("INPUT");for(var h=0;h<d.length;++h){var c=d[h];if(c.checked){n=c.getAttribute("pid")}}if(n==null){alert("Please select an Existing Parent of choose NEW");return}var l=this;var f=this.cache.data;f.selectparentid=n;scil.Utils.ajax(this.getUrl()+"ajax.ashx?cmd=batch.saveafterspecifyingparent",function(q){l.callback(q,f);l.dlg.hide()},f,{showprogress:true})},list:function(h){scil.Utils.removeAll(this.tbody);var q=scil.Utils.createElement(this.tbody,"tr");var n=scil.Utils.createElement(q,"td",null);scil.Utils.createElement(n,"div"," ",{border:"solid 1px #ddd",width:this.kWidth,height:this.kHeight,textAlign:"center",verticalAlign:"middle"});var f=scil.Utils.createElement(n,"div",null,{textAlign:"center"});scil.Utils.createElement(f,"radio","New",null,{name:"_chooseparent",pid:"new"});var c=1;for(var g=0;g<h.length;++g){var j=h[g];if(++c>5){c=1;q=scil.Utils.createElement(this.tbody,"tr")}var l="<img src='"+this.getUrl()+"go.axd/structure/width="+this.kWidth+",height="+this.kHeight+"/"+j.structureid+"/m.png' style='border:solid 1px #ddd'>";n=scil.Utils.createElement(q,"td",l);f=scil.Utils.createElement(n,"div",null,{textAlign:"center"});scil.Utils.createElement(f,"radio","<a target=_blank href='"+this.getUrl()+"Structure.aspx?structureid="+j.structureid+"'>"+j.part+"</a>",null,{name:"_chooseparent",pid:j.part})}this.dlg.moveCenter()}};scil.PDFViewer={dlg:null,iframe:null,data:null,show:function(j,f,g){this.data=f;if(g==null){g=j}if(j!=null&&!scil.Utils.startswith(j,"http://",true)&&!scil.Utils.startswith(j,"https://",true)&&!scil.Utils.startswith(j,"/")){j="../../../"+j}var c=dojo.window.getBox();if(this.dlg==null){this.iframe=scil.Utils.createElement(null,"iframe",null,{display:"block",width:c.w-80,height:c.h-80},{frameborder:0});this.dlg=new scilligence.Dialog("PDF Viewer",this.iframe,{bodystyle:{padding:0}});var h=this;this.iframe.addEventListener("load",function(){h.loadBase64(h.data);h.data=null},true)}this.iframe.style.width=(c.w-30)+"px";this.iframe.style.height=(c.h-80)+"px";this.dlg.show("PDF Viewer: "+g);if(j==null){this.iframe.setAttribute("src","tools/pdf.js/web/viewer.html?ticks="+new Date().getTime())}else{this.iframe.setAttribute("src","tools/pdf.js/web/viewer.html?file="+escape(j))}},loadBase64:function(c){var d=this.base64ToUint8Array(c);this.iframe.contentWindow.loadData(d)},base64ToUint8Array:function(c){var f=atob(c);var g=new Uint8Array(f.length);for(var d=0;d<f.length;d++){g[d]=f.charCodeAt(d)}return g}};scil.Viz=scil.extend(scil._base,{constructor:function(g,f,c){if(typeof(g)=="string"){g=scil.byId(g)}scil.Utils.unselectable(g);if(f==null){f={}}if(f.color==null){f.color="steelblue"}if(f.highlightcolor==null){f.highlightcolor="red"}if(f.selectcolor==null){f.selectcolor="red"}if(f.xkey==null){f.xkey="x"}if(f.type=="bar"){if(!(f.width>0)){f.width=800}if(!(f.height>0)){f.height=400}if(!(f.barwidth>0)){f.barwidth=30}}else{if(f.type=="pie"){if(!(f.width>0)){f.width=400}if(!(f.height>0)){f.height=300}if(!(f.depth>0)){f.depth=20}if(!(f.xyratio>0)){f.xyratio=0.8}if(!(f.radius>0)){f.radius=0.4}}else{if(f.type=="scatterplot"){if(!(f.width>0)){f.width=800}if(!(f.height>0)){f.height=400}if(f.shape==null){f.shape="circle"}if(!(f.radius>0)){f.radius=8}}}}this.type=f.type;this.parent=g;this.options=f;this.series=this.options.series!=null?this.options.series:[{key:"y"}];this.plots=[];this.tooltip=null;if(this.options.ontooltip!=null){var d=scil.Utils.createElement(null,"div");this.tooltip=new scil.Dialog("",d,{notitle:true})}this.root=null;this.selection=null;this.div=scil.Viz.createTitle(this.parent,this.options);this.svg=d3.select(this.div).append("svg:svg").attr("width",this.options.width).attr("height",this.options.height);this.data=c;this.root=this.svg.append("g");if(this.type!="pie"){this.initAxis()}this.redraw()},initAxis:function(){var f=!scil.Utils.isNullOrEmpty(this.options.xlabel);var g=!scil.Utils.isNullOrEmpty(this.options.ylabel);this.margin={top:20,right:20,bottom:g?50:30,left:f?60:40};this.chartwidth=this.options.width-this.margin.left-this.margin.right;this.chartheight=this.options.height-this.margin.top-this.margin.bottom;this.root.attr("transform","translate("+this.margin.left+","+this.margin.top+")");this.root.attr("width",this.chartwidth);this.root.attr("height",this.chartheight);var c=this;this.xfun=d3.scale.linear().domain([0,d3.max(this.data,function(q){return q[c.options.xkey]})]).range([0,c.chartwidth]);this.yfun=d3.scale.linear().domain([0,d3.max(this.data,function(q){return scil.Viz.maxOfSeries(q,c.options.series,c.options.stack)})]).range([c.chartheight,0]);var h=d3.svg.axis().scale(this.xfun).orient("bottom").innerTickSize(-this.chartheight).outerTickSize(0).tickPadding(10);var j=d3.svg.axis().scale(this.yfun).orient("left").innerTickSize(-this.chartwidth).outerTickSize(0).tickPadding(10);this.xaxis=this.root.append("g").classed("x axis",true).attr("transform","translate(0,"+this.chartheight+")").attr("shape-rendering","crispEdges").attr("stroke","black").attr("fill","none").style("font-size","12px").call(h).selectAll(".tick line").style("opacity",0.2);this.yaxis=this.root.append("g").classed("y axis",true).attr("transform","translate(0,0)").attr("shape-rendering","crispEdges").attr("stroke","black").attr("fill","none").style("font-size","12px").call(j).selectAll(".tick line").style("opacity",0.2);if(this.options.zoomable){var l=function(){c.root.select(".x.axis").call(h).selectAll(".tick line").style("opacity",0.2);c.root.select(".y.axis").call(j).selectAll(".tick line").style("opacity",0.2);for(var q=0;q<c.plots.length;++q){c.transformPlot(c.plots[q])}};var n=d3.behavior.zoom().x(this.xfun).y(this.yfun).scaleExtent([0,500]).on("zoom",l);this.svg.call(n)}if(f){this.root.append("text").attr("text-anchor","middle").attr("transform","translate("+(-this.margin.left/1.6)+","+(this.chartheight/2)+")rotate(-90)").text(this.options.xlabel)}if(g){this.root.append("text").attr("text-anchor","middle").attr("transform","translate("+(this.chartwidth/2)+","+(this.chartheight+(this.margin.bottom/1.5))+")").text(this.options.ylabel)}if(this.options.selectable&&this.type=="scatterplot"){var d=this.root.append("svg:rect");d.attr("x",0);d.attr("y",0);d.attr("width",200);d.attr("height",200);d.attr("fill","lightblue");d.attr("opacity","0.4");d.style("stroke","darkblue");d.style("stroke-width","1px");d.style("display","none");scil.connect(this.div,"onmousedown",function(q){c.onmousedown(d,q)});scil.connect(document.body,"onmousemove",function(q){c.onmousemove(d,q)});scil.connect(document.body,"onmouseup",function(q){c.onmouseup(d,q.shiftKey)});this.selection=d}},redraw:function(){switch(this.type){case"scatterplot":this.drawScatterplot();break;case"line":this.drawLine();break;case"bar":this.drawBars();break;case"pie":this.drawPie();break}},transformPlot:function(c){c.plot.attr("transform","translate("+this.xfun(c.data[this.options.xkey])+","+this.yfun(c.data[c.ser.key])+")")},polygon:function(j,h,n){var c=360/h;var f=new JSDraw2.Point(j,0);f.rotate(-90);var g=null;if(n){g=new JSDraw2.Point(j*(h==3?0.3:0.5),0);g.rotate(-90+c/2)}var l=f.x+","+f.y;if(n){l+=" \n"+g.x+","+g.y}for(var d=1;d<h;++d){f.rotate(c);l+=" \n"+f.x+","+f.y;if(n){g.rotate(c);l+=" \n"+g.x+","+g.y}}return l},drawPie:function(){var c=this.root.append("g");scil.Viz.Pie3D.draw(c,this.data,this.options.width/2,this.options.height/2,this.options.width/(3*this.options.xyratio),this.options.height/3,this.options.depth,this.options.radius,this.options.onlabel);var d=this;if(this.options.onclick!=null){this.root.selectAll(".topSlice").on("click",function(f){d.options.onclick(f)})}if(this.options.highlightcolor!="none"){this.root.selectAll(".topSlice").on("mouseover",function(f){scil.Viz.Pie3D.highlight(f,d.root,d.options)});this.root.selectAll(".topSlice").on("mouseout",function(f){scil.Viz.Pie3D.highlight(f,d.root,null)})}},drawScatterplot:function(){for(var h=0;h<this.data.length;++h){var g=this.data[h];for(var j=0;j<this.series.length;++j){var t=this.series[j];var u=g.s==null?(t.shape==null?this.options.shape:t.shape):g.s;var q=g.r>0?g.r:(t.radius>0?t.radius:this.options.radius);var f=g.c!=null?g.c:(t.color!=null?t.color:this.options.color);if(u=="circle"){s=this.root.append("svg:circle");s.attr("r",q)}else{if(u=="square"){s=this.root.append("svg:rect");delta=-q;s.attr("x",-q);s.attr("y",-q);s.attr("width",q*2);s.attr("height",q*2)}else{if(scil.Utils.startswith(u,"polygon")){var n=parseInt(u.substr(7));if(!(n>=3)){n=3}s=this.root.append("svg:polygon");s.attr("points",this.polygon(q,n,false))}else{if(scil.Utils.startswith(u,"star")){var n=parseInt(u.substr(4));if(!(n>=3)){n=3}s=this.root.append("svg:polygon");s.attr("points",this.polygon(q,n,true))}}}}s.attr("class","plot");s.attr("fill",f);if(g.f){s.style("stroke",this.options.selectcolor);s.style("stroke-width","2px")}var l={plot:s,data:g,ser:t,f:false};this.plots.push(l);this.transformPlot(l);this.addEvent(l)}}},drawBars:function(){for(var g=0;g<this.data.length;++g){var c=this.data[g];var u=0;for(var h=0;h<this.series.length;++h){var n=this.series[h];var q;var t=this.yfun(c[n.key]);var f=this.chartheight-this.yfun(c[n.key]);if(this.options.stack){q=this.xfun(c[this.options.xkey])-this.options.barwidth/2}else{q=this.xfun(c[this.options.xkey])-(this.options.barwidth*this.series.length/2)+h*this.options.barwidth}var l=this.root.append("rect").attr("x",q+1).attr("y",t-u).attr("width",this.options.barwidth-2).attr("height",f).attr("class","bar").style("fill",n.color==null?this.options.color:n.color);l.style("stroke-width","1px");if(c.f){l.style("stroke",this.options.selectcolor)}else{l.style("stroke","#fff")}if(this.options.stack){u+=f}var j={plot:l,data:c,ser:n,f:false};this.plots.push(j);this.addEvent(j)}}},drawLine:function(){for(var c=0;c<this.series.length;++c){var f=this.series[c];var d=d3.svg.line().x(function(g){return this.xfun(g[this.options.xkey])}).y(function(g){return this.yfun(g[f.key])});this.root.append("path").data([this.data]).attr("class","line").attr("d",d).style("fill","none").style("stroke",f.color==null?this.options.color:f.color).style("stroke-width","2px")}},selectAll:function(c){if(c==null){c=true}var g=0;for(var d=0;d<this.plots.length;++d){if(this.plots[d].f!=c){++g;this.updateSelect(this.plots[d],c)}}return g},updateSelect:function(c,g,h){c.f=g;if(c.f){c.plot.style("stroke",this.options.selectcolor)}else{c.plot.style("stroke","none")}c.plot.style("stroke-width",h+"px")},getSelected:function(){var d=[];for(var c=0;c<this.plots.length;++c){if(this.plots[c].f){d.push(this.plots[c].data)}}return d},onmousedown:function(g,f){var c=scil.Utils.getOffset(this.div);g.sel={x:c.x+this.margin.left,y:c.y+this.margin.top,p1:{x:f.clientX,y:f.clientY},p2:{x:f.clientX,y:f.clientY}}},onmousemove:function(d,c){if(d.sel==null){return}var f=d.sel;f.p2={x:c.clientX,y:c.clientY};d.style("display","");d.attr("x",Math.min(f.p1.x,f.p2.x)-f.x);d.attr("y",Math.min(f.p1.y,f.p2.y)-f.y);d.attr("width",Math.abs(f.p1.x-f.p2.x));d.attr("height",Math.abs(f.p1.y-f.p2.y))},onmouseup:function(l,t){if(l.sel==null){return}l.style("display","none");var q=l.sel;var w=Math.min(q.p1.x,q.p2.x)-q.x;var x=Math.max(q.p1.x,q.p2.x)-q.x;var z=Math.min(q.p1.y,q.p2.y)-q.y;var A=Math.max(q.p1.y,q.p2.y)-q.y;var j=0;for(var h=0;h<this.plots.length;++h){var c=this.plots[h];var u=this.xfun(c.data[this.options.xkey]);var y=this.yfun(c.data[c.ser.key]);var f=u>w&&u<x&&y>z&&y<A;var g=c.f==true;if(f==g||t&&g){continue}++j;this.updateSelect(c,f,2)}if(j>0&&this.options.onselect!=null){this.options.onselect()}l.sel=null},addEvent:function(c){var h=this;var f=c.plot;f.on("click",function(){if(h.options.selectable){var g=event!=null&&event.shiftKey;var d=0;if(g){h.updateSelect(c,!c.f);++d}else{d+=h.selectAll(false);if(!c.f){h.updateSelect(c,true);++d}}if(d>0&&h.options.onselect!=null){h.options.onselect()}}if(h.options.onclick!=null){h.options.onclick(c)}});f.on("mouseover",function(){this.style.fill=h.options.highlightcolor;if(h.tooltip!=null&&event!=null&&(h.selection==null||h.selection.sel==null)){var d=h.options.ontooltip(c);if(!scil.Utils.isNullOrEmpty(d)){h.tooltip.show2({modal:false,immediately:true});h.tooltip.body.innerHTML=d;var g=scil.Utils.scrollOffset();h.tooltip.moveTo(event.clientX+g.x+10,event.clientY+g.y+10)}}if(h.options.onmouseover!=null){h.options.onmouseover(c,event)}});f.on("mouseout",function(){var d=c.data.c;if(d==null){d=c.ser.color}if(d==null){d=h.options.color}this.style.fill=d;if(h.tooltip!=null){h.tooltip.hide(true)}if(h.options.onmouseout!=null){h.options.onmouseout(c,event)}})}});scil.apply(scil.Viz,{scatterplot:function(f,c,d){if(d==null){d={}}d.type="scatterplot";return new scil.Viz(f,d,c)},line:function(f,c,d){if(d==null){d={}}d.type="line";return new scil.Viz(f,d,c)},bar:function(f,c,d){if(d==null){d={}}d.type="bar";return new scil.Viz(f,d,c)},pie:function(f,c,d){if(d==null){d={}}d.type="pie";return new scil.Viz(f,d,c)},createTitle:function(d,c){if(scil.Utils.isNullOrEmpty(c.title)){return d}var f=scil.Utils.createTable(d,0,0,{border:"solid 1px gray"});var g={textAlign:"center",background:"#eee",borderBottom:"solid 1px gray",padding:"3px"};scil.apply(g,c.titlestyle);scil.Utils.createElement(scil.Utils.createElement(f,"tr"),"td",c.title,g);return scil.Utils.createElement(scil.Utils.createElement(f,"tr"),"td")},maxOfSeries:function(c,g,h){if(g==null){return c.y}var j=null;for(var f=0;f<g.length;++f){var l=c[g[f].key];if(l==null){continue}if(j==null){j=l;continue}if(h){j+=l}else{if(l>j){j=l}}}return j}});scil.viz=scil.Viz;scil.D3Chart=scil.Viz;scil.Viz.Pie3D={draw:function(f,d,z,A,t,u,j,l,q){var c=d3.layout.pie().sort(null).value(function(g){return g.value})(d);var w=f.append("g").attr("transform","translate("+z+","+A+")");var n=this;w.selectAll(".innerSlice").data(c).enter().append("path").attr("class","innerSlice").style("fill",function(g){return d3.hsl(g.data.color).darker(0.7)}).attr("d",function(g){return n.pieInner(g,t+0.5,u+0.5,j,l)});w.selectAll(".outerSlice").data(c).enter().append("path").attr("class","outerSlice").style("fill",function(g){return d3.hsl(g.data.color).darker(0.7)}).attr("d",function(g){return n.pieOuter(g,t-0.5,u-0.5,j)});w.selectAll(".topSlice").data(c).enter().append("path").attr("class","topSlice").style("fill",function(g){return g.data.color}).attr("d",function(g){return n.pieTop(g,t,u,l)});w.selectAll(".label").data(c).enter().append("text").attr("class","percent").attr("x",function(g){return 0.6*t*Math.cos(0.5*(g.startAngle+g.endAngle))}).attr("y",function(g){return 0.6*u*Math.sin(0.5*(g.startAngle+g.endAngle))}).style("fill","white").style("text-anchor","middle").style("font-size","12px").text(q!=null?q:scil.Viz.Pie3D.getLabel)},highlight:function(c,f,d){f.selectAll(".innerSlice").style("fill",function(g){return d3.hsl(g==c&&d!=null?d.highlightcolor:g.data.color).darker(0.7)});f.selectAll(".outerSlice").style("fill",function(g){return d3.hsl(g==c&&d!=null?d.highlightcolor:g.data.color).darker(0.7)});f.selectAll(".topSlice").style("fill",function(g){return g==c&&d!=null?d.highlightcolor:g.data.color})},pieTop:function(c,l,n,h){if(c.endAngle-c.startAngle==0){return"M 0 0"}var q=l*Math.cos(c.startAngle),t=n*Math.sin(c.startAngle),f=l*Math.cos(c.endAngle),g=n*Math.sin(c.endAngle);var j=[];j.push("M",q,t,"A",l,n,"0",(c.endAngle-c.startAngle>Math.PI?1:0),"1",f,g,"L",h*f,h*g);j.push("A",h*l,h*n,"0",(c.endAngle-c.startAngle>Math.PI?1:0),"0",h*q,h*t,"z");return j.join(" ")},pieOuter:function(c,q,t,l){var u=(c.startAngle>Math.PI?Math.PI:c.startAngle);var f=(c.endAngle>Math.PI?Math.PI:c.endAngle);var w=q*Math.cos(u),x=t*Math.sin(u),g=q*Math.cos(f),j=t*Math.sin(f);var n=[];n.push("M",w,l+x,"A",q,t,"0 0 1",g,l+j,"L",g,j,"A",q,t,"0 0 0",w,x,"z");return n.join(" ")},pieInner:function(c,t,u,l,n){var w=(c.startAngle<Math.PI?Math.PI:c.startAngle);var f=(c.endAngle<Math.PI?Math.PI:c.endAngle);var x=n*t*Math.cos(w),y=n*u*Math.sin(w),g=n*t*Math.cos(f),j=n*u*Math.sin(f);var q=[];q.push("M",x,y,"A",n*t,n*u,"0 0 1",g,j,"L",g,l+j,"A",n*t,n*u,"0 0 0",x,l+y,"z");return q.join(" ")},getLabel:function(c){return c.data.label+" "+((c.endAngle-c.startAngle>0.2?Math.round(1000*(c.endAngle-c.startAngle)/(Math.PI*2))/10+"%":""))}};scil.Viz.Radar=scil.extend(scil._base,{constructor:function(u,h,t){if(typeof(u)=="string"){u=scil.byId(u)}this.parent=u;this.options=t==null?{}:t;this.plots=[];if(this.options.highlightcolor==null){this.options.highlightcolor="red"}if(this.options.selectcolor==null){this.options.selectcolor="red"}if(this.options.headercolor==null){this.options.headercolor="#555"}if(!(this.options.size>0)){this.options.size=100}if(!(this.options.headersize>0)){this.options.headersize=30}var z=this.options.size/2-5;this.pie=d3.layout.pie().value(function(c){return 10});this.tooltip=null;if(this.options.ontooltip!=null){var j=scil.Utils.createElement(null,"div");this.tooltip=new scil.Dialog("",j,{notitle:true})}var l=z/(this.options.assays.length+1);this.arcs=[];for(var q=0;q<this.options.assays.length;++q){this.options.assays[q].arc=d3.svg.arc().innerRadius((q+1)*l).outerRadius((q+2)*l)}this.div=scil.Viz.createTitle(this.parent,this.options);if(this.options.single){this.svg=d3.select(this.div).append("svg");this.svg.attr("width",this.options.size);this.svg.attr("height",this.options.size);var C=this.options.size/2;var E=this.options.size/2;this.draw(h,C,E);return}var n=this.groupData(h,this.options.xkey,this.options.ykey);var D=this.options.headersize;var F=this.options.headersize;this.svg=d3.select(this.div).append("svg");this.svg.attr("width",this.options.size*this.cols.length+D+1);this.svg.attr("height",this.options.size*this.rows.length+F+1);var g=this.options.size;this.svg.append("line").attr("x1",1).attr("y1",1).attr("x2",this.cols.length*g+D).attr("y2",1).attr("stroke","#aaa").attr("stroke-width","0.5px");this.svg.append("line").attr("x1",1).attr("y1",1).attr("x2",1).attr("y2",this.rows.length*g+F).attr("stroke","#aaa").attr("stroke-width","0.5px");var A;if(this.options.xylabel!=null){var B=this.options.xylabel;if(B!=null&&B.img!=null){A=this.svg.append("image");A.attr("xlink:href",B.img);A.attr("transform","translate("+(D/2-B.width/2)+","+(F/2-B.height/2)+")")}else{A=this.svg.append("text");A.attr("text-anchor","middle");A.style("font-size","12px");A.attr("transform","translate("+D/2+","+(F/2+6)+")");A.text(B);A.attr("fill",this.options.headercolor);A.style("stroke",this.options.headercolor)}}for(var w=0;w<=this.rows.length;++w){var E=this.options.size*w+this.options.size/2+F;var B=this.rows[w];if(this.options.ylabels!=null&&this.options.ylabels[B]!=null){B=this.options.ylabels[B]}if(B!=null&&B.img!=null){A=this.svg.append("image");A.attr("xlink:href",B.img);A.attr("transform","translate("+(D/2-B.width/2)+","+(E-B.height/2)+")")}else{A=this.svg.append("text");A.attr("text-anchor","middle");A.style("font-size","12px");A.attr("transform","translate("+D/2+","+(E+6)+")");A.text(B);A.attr("fill",this.options.headercolor);A.style("stroke",this.options.headercolor)}this.addEvent2(A);this.svg.append("line").attr("x1",0).attr("y1",w*g+F).attr("x2",this.cols.length*g+D).attr("y2",w*g+F).attr("stroke","#aaa").attr("stroke-width","0.5px")}for(var f=0;f<=this.cols.length;++f){var C=this.options.size*f+this.options.size/2+D;var B=this.cols[f];if(this.options.xlabels!=null&&this.options.xlabels[B]!=null){B=this.options.xlabels[B]}if(B!=null&&B.img!=null){A=this.svg.append("image");A.attr("xlink:href",B.img);A.attr("transform","translate("+(C-B.width/2)+","+(F/2-B.height/2)+")")}else{A=this.svg.append("text");A.attr("text-anchor","middle");A.style("font-size","12px");A.attr("transform","translate("+C+","+(F/2+6)+")");A.text(B);A.attr("fill",this.options.headercolor);A.style("stroke",this.options.headercolor)}this.addEvent2(A);this.svg.append("line").attr("x1",f*g+D).attr("y1",0).attr("x2",f*g+D).attr("y2",this.rows.length*g+F).attr("stroke","#aaa").attr("stroke-width","0.5px")}for(var q=0;q<n.length;++q){var g=n[q];var C=this.options.size*g.x+this.options.size/2+D;var E=this.options.size*g.y+this.options.size/2+F;this.draw(g.data,C,E)}},groupData:function(f,q,w){var g={};var t={};var z={};for(var h=0;h<f.length;++h){var c=f[h];var n=c[q];var u=c[w];if(t[n]==null){t[n]=true}if(z[u]==null){z[u]=true}var j=n+","+u;if(g[j]==null){g[j]={x:n,y:u,data:[]}}g[j].data.push(c)}this.rows=scil.Utils.getDictKeys(z);this.cols=scil.Utils.getDictKeys(t);this.rows.sort();this.cols.sort();var l=scil.Utils.getDictValues(g);for(var h=0;h<l.length;++h){l[h].x=scil.Utils.indexOf(this.cols,l[h].x);l[h].y=scil.Utils.indexOf(this.rows,l[h].y)}return l},draw:function(c,h,j){var g=this.svg.append("g");g.attr("transform","translate("+h+","+j+")");var f=this;for(var d=0;d<this.options.assays.length;++d){this.addAssay(g,c,this.options.assays[d],"path"+d)}},addAssay:function(q,g,c,n){var l=this;var t=q.datum(g).selectAll(n).data(this.pie).enter().append("path").attr("class","plot").attr("stroke","#fff").attr("d",c.arc);var j=t[0];for(var h=0;h<j.length;++h){var g=j[h].__data__.data;var f={plot:d3.select(j[h]),data:g,color:this.oncolor(g,c),assay:c,f:false};f.plot.attr("fill",f.color==null?"#ddd":f.color);f.plot.attr("stroke","#fff");this.plots.push(f);this.addEvent(f)}},addEvent2:function(d){var c=this;d.on("click",function(){if(c.options.onheaderclick!=null){c.options.onheaderclick(this)}});d.on("mouseover",function(){this.style.fill=c.options.highlightcolor;this.style.stroke=c.options.highlightcolor;if(c.options.onheadermouseover!=null){c.options.onheadermouseover(this,event)}});d.on("mouseout",function(){this.style.fill=c.options.headercolor;this.style.stroke=c.options.headercolor;if(c.options.onheadermouseout!=null){c.options.onheadermouseout(this,event)}})},addEvent:function(c){var f=this;var g=c.plot;g.on("click",function(){if(c.color==null){return}if(f.options.selectable){var h=event!=null&&event.shiftKey;var d=0;if(h){f.updateSelect(c,!c.f);++d}else{d+=f.selectAll(false);if(!c.f){f.updateSelect(c,true);++d}}if(d>0&&f.options.onselect!=null){f.options.onselect()}}if(f.options.onclick!=null){f.options.onclick(c)}});g.on("mouseover",function(){if(c.color==null){return}this.style.fill=f.options.highlightcolor;if(f.tooltip!=null&&event!=null){var d=f.options.ontooltip(c);if(!scil.Utils.isNullOrEmpty(d)){f.tooltip.show2({modal:false,immediately:true});f.tooltip.body.innerHTML="<div style='white-space:nowrap'>"+d+"</div>";var h=scil.Utils.scrollOffset();f.tooltip.moveTo(event.clientX+h.x+10,event.clientY+h.y+10)}}if(f.options.onmouseover!=null){f.options.onmouseover(c,event)}});g.on("mouseout",function(){if(c.color==null){return}this.style.fill=c.color==null?"#ddd":c.color;if(f.tooltip!=null){f.tooltip.hide(true)}if(f.options.onmouseout!=null){f.options.onmouseout(c,event)}})},selectAll:function(c){if(c==null){c=true}var g=0;for(var d=0;d<this.plots.length;++d){if(this.plots[d].f!=c){++g;this.updateSelect(this.plots[d],c)}}return g},updateSelect:function(c,g){c.f=g;if(c.f){c.plot.style("stroke",this.options.selectcolor)}else{c.plot.style("stroke","none")}},getSelected:function(){var d=[];for(var c=0;c<this.plots.length;++c){if(this.plots[c].f){d.push(this.plots[c].data)}}return d},oncolor:function(f,c){if(c.oncolor!=null){return c.oncolor(f,c)}var q=f[c.key];if(q==null){return null}var l=Math.min(c.red,c.green);var j=Math.max(c.red,c.green);q=Math.round((q-l)*(255/(j-l)));if(q<0){q=0}else{if(q>255){q=255}}var n,h;if(l==c.red){n=(255-q);h=q}else{h=(255-q);n=q}h=h.toString(16);n=n.toString(16);return"#"+(n.length==1?"0"+n:n)+(h.length==1?"0"+h:h)+"00"}});scil.Viz.Heatmap=scil.extend(scil._base,{constructor:function(C,g,y){if(typeof(C)=="string"){C=scil.byId(C)}this.div=C;this.options=y==null?{}:y;this.data=g;if(!(this.options.width>0)){this.options.width=800}if(!(this.options.height>0)){this.options.height=600}var j={top:80,right:0,bottom:10,left:80};var H=this.options.width;var h=this.options.height;var I=d3.scale.ordinal().rangeBands([0,H]);var J=d3.scale.linear().domain([0,4]).clamp(true);var d=d3.scale.category10().domain(d3.range(10));var F=d3.select(this.div).append("svg").attr("width",H+j.left+j.right).attr("height",h+j.top+j.bottom).style("margin-left",-j.left+"px").append("g").attr("transform","translate("+j.left+","+j.top+")");var l=[];var w=g.nodes;var u=w.length;w.forEach(function(n,c){n.index=c;n.count=0;l[c]=d3.range(u).map(function(x){return{x:x,y:c,z:0}})});g.links.forEach(function(c){l[c.source][c.target].z+=c.value;l[c.target][c.source].z+=c.value;l[c.source][c.source].z+=c.value;l[c.target][c.target].z+=c.value;w[c.source].count+=c.value;w[c.target].count+=c.value});var B={name:d3.range(u).sort(function(c,n){return d3.ascending(w[c].name,w[n].name)}),count:d3.range(u).sort(function(c,n){return w[n].count-w[c].count}),group:d3.range(u).sort(function(c,n){return w[n].group-w[c].group})};I.domain(B.name);F.append("rect").attr("fill","#eee").attr("width",H).attr("height",h);var D=F.selectAll(".row").data(l).enter().append("g").attr("class","row").attr("transform",function(c,n){return"translate(0,"+I(n)+")"}).each(E);D.append("line").attr("x2",H).attr("stroke","#fff");D.append("text").attr("x",-6).attr("y",I.rangeBand()/2).attr("dy",".32em").attr("text-anchor","end").style("font-size","10px").text(function(c,n){return w[n].name});var f=F.selectAll(".column").data(l).enter().append("g").attr("class","column").attr("transform",function(c,n){return"translate("+I(n)+")rotate(-90)"});f.append("line").attr("x1",-H);f.append("text").attr("x",6).attr("y",I.rangeBand()/2).attr("dy",".32em").attr("text-anchor","start").style("font-size","10px").text(function(c,n){return w[n].name});function E(n){var c=d3.select(this).selectAll(".cell").data(n.filter(function(x){return x.z})).enter().append("rect").attr("class","cell").attr("x",function(x){return I(x.x)}).attr("width",I.rangeBand()).attr("height",I.rangeBand()).style("fill-opacity",function(x){return J(x.z)}).style("fill",function(x){return w[x.x].group==w[x.y].group?d(w[x.x].group):null}).on("mouseover",t).on("mouseout",q)}function t(c){d3.selectAll(".row text").attr("fill",function(n,x){return x==c.y?"red":""});d3.selectAll(".column text").attr("fill",function(n,x){return x==c.x?"red":""})}function q(){d3.selectAll("text").attr("fill","")}d3.select("#order").on("change",function(){clearTimeout(G);A(this.value)});function A(n){I.domain(B[n]);var c=F.transition().duration(2500);c.selectAll(".row").delay(function(x,z){return I(z)*4}).attr("transform",function(x,z){return"translate(0,"+I(z)+")"}).selectAll(".cell").delay(function(x){return I(x.x)*4}).attr("x",function(x){return I(x.x)});c.selectAll(".column").delay(function(x,z){return I(z)*4}).attr("transform",function(x,z){return"translate("+I(z)+")rotate(-90)"})}var G=setTimeout(function(){A("group");var c=d3.select("#order").property("selectedIndex",2).node();if(c!=null){c.focus()}},5000)}});scil.Viz.OrgChart=scil.extend(scil._base,{constructor:function(d,c){if(typeof(d)=="string"){d=scil.byId(d)}if(c==null){c={}}if(!(c.width>0)){c.width=500}if(!(c.height>0)){c.height=300}if(!(c.boxwidth>0)){c.boxwidth=150}if(!(c.boxheight>0)){c.boxheight=50}if(!(c.spacing>0)){c.spacing=20}if(!(c.depth>0)){c.depth=80}this.parent=d;this.options=c;d.style.width=c.width+"px";d.style.height=c.height+"px";++scil.Viz.OrgChart.__id;if(scil.Utils.isNullOrEmpty(d.id)){c.id="#orgchart"+scil.Viz.OrgChart.__id}else{c.id="#"+d.id}this._root={};this._nodes=[];this._counter=0;this._svgroot=null;this._svg=null;this._tree=null;this._diagonal=null;this._lineFunction=null;this._duration=750;this._mode="line";this._callerNode=null;this._callerMode=0;this.initTree(c)},initTree:function(l){var w=scil.apply({id:"",data:{},modus:"line",loadFunc:function(){}},l);id=w.id;this._mode=w.modus;this._root=w.data;this.parent.innerHTML="";var y=this.options.width;var f=this.options.height;this._tree=d3.layout.tree().nodeSize([this.options.boxwidth+this.options.spacing,this.options.boxheight+this.options.spacing]);var j=this;this._diagonal=d3.svg.diagonal().projection(function(z){return[z.x+j.options.boxwidth/2,z.y+j.options.boxheight/2]});this._lineFunction=d3.svg.line().x(function(z){return z.x}).y(function(z){return z.y}).interpolate("linear");var c=this._root.children.length;var n=2;var u=c*this.options.boxwidth+(c-1)*this.options.spacing;var t=n*this.options.boxwidth+(n-1)*this.options.spacing*1.5;var q={x:(y-u)/2,y:(f-t)/2};this._svgroot=d3.select(id).append("svg").attr("width",y).attr("height",f).call(zm=d3.behavior.zoom().scaleExtent([0.15,3]).on("zoom",function(){j.redraw()}));this._svg=this._svgroot.append("g").attr("transform","translate("+q.x+","+q.y+")");var h=[{offset:"0%",color:"#03A9F4",opacity:1},{offset:"100%",color:"#0288D1",opacity:1}];if(this.options.fills!=null){for(var g in this.options.fills){var d=this.options.fills[g];var x=[{offset:"0%",color:d.color1,opacity:1},{offset:"100%",color:d.color2,opacity:1}];this.defLinearGradient(g,"0%","0%","0%","100%",x);if(g=="main"){def=null}}}if(h!=null){this.defLinearGradient("main","0%","0%","0%","100%",h)}this.defBoxShadow("boxShadow");zm.translate([q.x,q.y]);this._root.x0=0;this._root.y0=f/2;this._root.children.forEach(function(z){j.collapse(z)});this.update(this._root);d3.select(id).style("height",f)},defLinearGradient:function(f,j,n,l,q,g){var c=this._svgroot.append("svg:defs").append("svg:linearGradient").attr("id",f).attr("x1",j).attr("y1",n).attr("x2",l).attr("y2",q).attr("spreadMethod","pad");for(var d in g){var h=g[d];c.append("svg:stop").attr("offset",h.offset).attr("stop-color",h.color).attr("stop-opacity",h.opacity)}},defBoxShadow:function(d){var c=this._svgroot.append("svg:defs").append("svg:filter").attr("id",d).attr("height","150%").attr("width","150%");c.append("svg:feOffset").attr("dx","2").attr("dy","2").attr("result","offOut");c.append("svg:feGaussianBlur").attr("in","offOut").attr("result","blurOut").attr("stdDeviation","2");c.append("svg:feBlend").attr("in","SourceGraphic").attr("in2","blurOut").attr("mode","normal")},collapse:function(c){var f=this;if(c.children){c._children=c.children;c._children.forEach(function(g){f.collapse(g)});c.children=null}},update:function(n){var f=this;this._nodes=this._tree.nodes(this._root).reverse();var d=this._tree.links(this._nodes);var f=this;this._nodes.forEach(function(q){q.y=q.depth*f.options.depth});var g=this._svg.selectAll("g.node").data(this._nodes,function(q){return q.id||(q.id=++f._counter)});var h=g.enter().append("g").attr("class","node").attr("transform",function(q){return"translate("+n.x0+","+n.y0+")"}).attr("key",function(q){return q.id}).on("click",function(q){f.nodeclick(this,q)});h.append("rect").attr("width",this.options.boxwidth).attr("height",this.options.boxheight).attr("fill","#898989").attr("filter","url(#boxShadow)");h.append("rect").attr("width",this.options.boxwidth).attr("height",this.options.boxheight).attr("id",function(q){return q.id}).attr("fill",function(q){return"url(#"+(q.fill==null?"main":q.fill)+")"}).style("cursor",function(q){return(q.children||q._children||q.hasChild)?"pointer":"default"}).attr("class","box");h.append("text").attr("x",this.options.boxwidth/2).attr("y",this.options.boxheight/2).attr("dy",".35em").attr("text-anchor","middle").style("cursor",function(q){return(q.children||q._children||q.hasChild)?"pointer":"default"}).text(function(q){return f.wrapLabel(q.label,q._children==null)});var l=g.transition().duration(this._duration).attr("transform",function(q){return"translate("+q.x+","+q.y+")"});l.select("rect.box").attr("fill",function(q){return"url(#"+(q.fill==null?"main":q.fill)+")"});var j=g.exit().transition();j.duration(this._duration).attr("transform",function(q){return"translate("+n.x+","+n.y+")"}).remove();var c=this._svg.selectAll("path.link").data(d,function(q){return q.target.id});if(this._mode==="line"){c.enter().append("path","g").attr("class","link").attr("d",function(q){return f.draw1(q)}).style("fill","none").style("stroke","#424242").style("stroke-width","1.5px");c.transition().duration(this._duration).attr("d",function(q){return f.draw2(q)});c.exit().transition().duration(this._duration).attr("d",function(q){return f.draw3(q)}).each("end",function(){f._callerNode=null})}else{if(this._mode==="diagonal"){c.enter().insert("path","g").attr("class","link").attr("x",this.options.boxwidth/2).attr("y",this.options.boxheight/2).attr("d",function(q){var t={x:n.x0,y:n.y0};return f._diagonal({source:t,target:t})});c.transition().duration(this._duration).attr("d",this._diagonal);c.exit().transition().duration(this._duration).attr("d",function(q){var t={x:n.x,y:n.y};return f._diagonal({source:t,target:t})}).remove()}}this._nodes.forEach(function(q){q.x0=q.x;q.y0=q.y})},wrapLabel:function(d,c){return c?d:"("+d+")"},draw1:function(c){var f=this;var g=(function(h){var j=[{x:h.source.x0+parseInt(f.options.boxwidth/2),y:h.source.y0+f.options.boxheight+2},{x:h.source.x0+parseInt(f.options.boxwidth/2),y:h.source.y0+f.options.boxheight+2},{x:h.source.x0+parseInt(f.options.boxwidth/2),y:h.source.y0+f.options.boxheight+2},{x:h.source.x0+parseInt(f.options.boxwidth/2),y:h.source.y0+f.options.boxheight+2}];return j})(c);return this._lineFunction(g)},draw2:function(c){var f=this;var g=(function(h){var j=[{x:h.source.x+parseInt(f.options.boxwidth/2),y:h.source.y+f.options.boxheight},{x:h.source.x+parseInt(f.options.boxwidth/2),y:h.target.y-f.options.spacing/2},{x:h.target.x+parseInt(f.options.boxwidth/2),y:h.target.y-f.options.spacing/2},{x:h.target.x+parseInt(f.options.boxwidth/2),y:h.target.y}];return j})(c);return this._lineFunction(g)},draw3:function(c){var f=this;var g=(function(h){var j=[{x:f._callerNode.x+parseInt(f.options.boxwidth/2),y:f._callerNode.y+f.options.boxheight+2},{x:f._callerNode.x+parseInt(f.options.boxwidth/2),y:f._callerNode.y+f.options.boxheight+2},{x:f._callerNode.x+parseInt(f.options.boxwidth/2),y:f._callerNode.y+f.options.boxheight+2},{x:f._callerNode.x+parseInt(f.options.boxwidth/2),y:f._callerNode.y+f.options.boxheight+2}];return j})(c);return this._lineFunction(g)},nodeclick:function(h,c){var j=this;var f=null;if(!c.children&&!c._children&&c.hasChild){this._loadFunction(c,function(d){var g={id:c.id,desc:c.label,children:d.result};g.children.forEach(function(l){if(!j._tree.nodes(c)[0]._children){j._tree.nodes(c)[0]._children=[]}l.x=c.x;l.y=c.y;l.x0=c.x0;l.y0=c.y0;j._tree.nodes(c)[0]._children.push(l)});if(c.children){j._callerNode=c;j._callerMode=0;c._children=c.children;c.children=null}else{j._callerNode=null;j._callerMode=1;c.children=c._children;c._children=null}j.update(c)})}else{if(c.children){j._callerNode=c;j._callerMode=0;c._children=c.children;c.children=null}else{j._callerNode=c;j._callerMode=1;c.children=c._children;c._children=null}j.update(c)}h.lastElementChild.innerHTML=this.wrapLabel(c.label,j._callerMode==1)},redraw:function(){this._svg.attr("transform","translate("+d3.event.translate+") scale("+d3.event.scale.toFixed(1)+")")},moveCenter:function(){var h=this._svg[0][0];var f=h.getBoundingClientRect();var l=null;var d=h.childNodes;for(var c=0;c<d.length;++c){if(d[c].tagName=="g"&&d[c].getAttribute("key")==this._root.id){l=d[c];break}}if(l==null){return}var g=l.getBoundingClientRect();var n=(this.options.width-f.width)/2+(g.x-f.x);var q=(this.options.height-f.height)/2;var j=1;this._svg.attr("transform","translate("+n+","+q+") scale("+j+")");zm.translate([n,q])}});scil.Viz.OrgChart.__id=0;scil.Page=scil.extend(scil._base,{constructor:function(l,n,d,h,j){var c;if(d!=null&&d.length>0||h!=null||j!=null){c={middle:h,onRefreshReceivers:j,forms:d}}else{c=d==null?{}:d}if(n==null&&c.left==null){c.left=false}if(n!=null){c.onresize=n.onresizetree}if(l.__isdialog){l=l.body}else{}this.onRefreshReceivers=c.onRefreshReceivers;this.explorer=new scil.Page.Explorer(l,c);if(n!=null&&n.root!=null&&n.root.children!=null&&n.translate){for(var f=0;f<n.root.children.length;++f){n.root.children[f].name=scil.Lang.res(n.root.children[f].name)}}this.tree=null;if(n!=null){if(n.type=="table"||n.type=="block"||n.type=="column"){this.table=new scil.Page.Table(this,n,this.explorer.left)}else{if(n.type=="form"){this.form=new scil.Page.Form(this,n,this.explorer.left)}else{this.tree=new scil.Page.Tree(this,n,this.explorer.left)}}}if(c.forms!=null){var g=this.tree==null?this.form:this.tree;for(var f=0;f<c.forms.length;++f){g=this.addForm(c.forms[f],g)}}},fillscreen:function(){document.body.style.overflow="hidden";document.body.style.overflowX="hidden";var c=dojo.window.getBox();if(this.tree!=null&&this.tree.form!=null){this.tree.form.fillscreen(c.h)}else{if(this.table!=null&&this.table.form!=null){this.table.form.fillscreen(c.h)}}if(this.lastright!=null){if(this.lastright.form!=null){this.lastright.form.fillscreen(c.h)}else{this.lastright.fillscreen(c.h)}}var f=this;window.onresize=function(){f.fillscreen()}},addTabs:function(c){var d=new scil.Page.Tab(this,c,this.explorer.right);if(c!=null&&c.visible==false||c==false){d.hide()}this.lastright=d;return d},addDiv:function(d,c){this.lastright=null;return scil.Utils.createElement(this.explorer.right,"div",d,c)},addForm:function(g,f,h,d){var c=scil.Page.addForm(this,g,f,h,d);this.lastright=c;return c},addResizeHandle:function(f,d){var c=this.addDiv();c.style.height=(d>0?d:scil.Page.kHandleWidth)+"px";c.style.marginBottom="2px";new scil.Resizable(c,{direction:"y",mouseovercolor:scil.Page.kHandleColor,onresize:f});return c},removeForm:function(c){var d=c.form.root;d.parentNode.removeChild(d)},receiverRefresh:function(d,c){if(this.onRefreshReceivers!=null){this.onRefreshReceivers(c,d)}for(var f=0;f<d.receivers.length;++f){d.receivers[f].refresh(d,c)}},receiverClear:function(c){for(var d=0;d<c.receivers.length;++d){c.receivers[d].clear()}}});scil.apply(scil.Page,{kHandleWidth:5,kHandleColor:"#aaf",addForm:function(h,g,f,j,d){if(j==null){j=d?h.explorer.left:h.explorer.right}var c=null;if(g.type=="form"){c=new scil.Page.Form(h,g,j)}else{if(g.type=="custom"){c=new scil.Page.Custom(h,g,j)}else{if(g.type=="html"){c=new scil.Page.Html(h,g,j)}else{if(g.type=="gantt"){c=new scil.Page.Gantt(h,g,j)}else{if(g.type=="calendar"){c=new scil.Page.Calendar(h,g,j)}else{c=new scil.Page.Table(h,g,j)}}}}}if(f!=null){f.receivers.push(c)}scil.Page.setBorder(c.form);g.form=c;return c},setBorder:function(c){c.toolbar.style.borderLeftColor=scil.App.config.line;c.toolbar.style.borderRightColor=scil.App.config.line;c.main.style.borderLeftColor=scil.App.config.line;c.main.style.borderRightColor=scil.App.config.line;c.main.style.borderBottomColor=scil.App.config.line},getFilterArgs:function(h){var c=h.args;if(c==null){c={}}var f=h.options.buttons;if(f==null){return c}var n=[];var g={};for(var j=0;j<f.length;++j){var d=f[j];if(d!=null&&!scil.Utils.isNullOrEmpty(d.key)){n.push(d.key);if(d.cookiekey!=null){g[d.key]=d.cookiekey}}}scil.Form.getButtonValuesByKey(f,n,c);for(var l in g){scil.Utils.createCookie("scil_pagetable_"+g[l],c[l])}return c}});window.onpopstate=function(c){scil.History.state=c.state};scil.Page.Explorer=scil.extend(scil._base,{constructor:function(g,f){if(typeof(g)=="string"){g=scil.byId(g)}this.options=f;this.resizing=null;if(f.resizable==null){f.resizable=true}var h=scil.Utils.createTable(g,0,0,{width:"100%"});var q=scil.Utils.createElement(h,"tr");if(f.left==false){this.left=null;this.middle=null}else{var u=f.leftwidth>0?f.leftwidth:200;var l=scil.Utils.createElement(q,"td",null,{width:"1%",paddingRight:"1px"},{vAlign:"top"});var j=scil.Utils.createTable(l,0,0,f.resizable?null:{width:u});var t=scil.Utils.createElement(j,"tr");var n=scil.Utils.createElement(t,"td");this.left=scil.Utils.createElement(n,"div",null,f.resizable?{width:u,overflow:"hidden"}:null);if(f.middle!=false){this.middle=scil.Utils.createElement(q,"td");var c=scil.Utils.createElement(this.middle,"div",null,{width:scil.Page.kHandleWidth});scil.Utils.unselectable(this.middle);scil.Utils.unselectable(c)}if(f.resizable){var d=this;new scil.Resizable(this.middle,{direction:"x",mouseovercolor:scil.Page.kHandleColor,onresize:function(w){return d.onresize(w)}})}}this.right=f.right==false?null:scil.Utils.createElement(q,"td",null,{width:"99%",paddingLeft:f.left==false?null:"1px"},{vAlign:"top"})},onresize:function(c){var d=scil.Utils.parsePixel(this.left.style.width)+c;if(d>20){this.left.style.width=d+"px";if(this.options.onresize!=null){this.options.onresize(d,this)}return true}return false}});scil.Page.ExplorerForm=scil.extend(scil._base,{constructor:function(j,d,c){this.options=scil.Page.ExplorerForm.cloneArgs(d.options,c);this.form=d;if(typeof(j)=="string"){j=scil.byId(j)}this.parent=j;var g=d.page.layout;var n=scil.Utils.createTable(this.parent,0,0,{width:"100%",background:"#fff",tableLayout:g});this.dom=this.root=n.parentNode;if(this.options.visible==false){this.root.style.display="none"}if(this.options.caption==null){n.parentNode.style.borderTop="solid 1px "+scil.Page.ExplorerForm.kHeaderStyle.background;this.title=null}else{var f=scil.Page.ExplorerForm.kHeaderStyle;f.border="1px solid "+scil.App.config.line;f.borderRadius=JSDraw2.Skin.kBorderRadius+" "+JSDraw2.Skin.kBorderRadius+" 0 0";if(scil.Page.ExplorerForm.kHeaderStyle.nobackground){f.background=null}var l=scil.Lang.res(this.options.caption);if(this.options.icon!=null){l="<img src='"+this.options.icon+"'>"+l}this.title=scil.Utils.createElement(scil.Utils.createElement(n,"tr"),"td",l,f)}this.toolbar=scil.Utils.createElement(scil.Utils.createElement(n,"tr"),"td",null,scil.Page.ExplorerForm.kToolbarStyle);if(this.options.toolbarvisible==false){this.toolbar.style.display="none"}this.toolbar.style.whiteSpace="nowrap";this.main=scil.Utils.createElement(scil.Utils.createElement(n,"tr"),"td",null,scil.Page.ExplorerForm.kAreaStyle);this.div=scil.Utils.createElement(this.main,"div");this.table=n.parentNode;this.recreateToolbar(this.options.buttons);if(this.title!=null&&this.options.expandable!=false){var h=this;dojo.connect(this.title,"onclick",function(){var q=!h.isExpanded();h.expand(q);if(h.options.onexpandform!=null){h.options.onexpandform(q)}});if(this.options.expanded==false){this.expand(false)}}if(this.options.marginTop!=null){this.table.style.marginTop=this.options.marginTop}this.table.style.marginBottom=this.options.marginBottom==null?"25px":this.options.marginBottom},initButtons:function(g,d){if(d==null||g==null){return}var f=g.options.filtervalues;for(var h=0;h<d.length;++h){var c=d[h];if(c!=null){if(typeof(c)=="object"){c.form=g}if(scil.Utils.isNullOrEmpty(c.key)){continue}if(c.type=="select"&&c.onchange==null){c.onchange=function(){g.refresh()}}else{if((c.type=="input"||c.type=="date")&&c.onenter==null){c.onenter=function(){g.refresh()}}}if(c.styles==null){c.styles={}}c.styles.border="solid 1px #ddd";if(f!=null){var j=f[c.key];if(j!=null){c.value=j}}}}},fillscreen:function(f){if(!(f>0)){return}var d=scil.Utils.getOffset(this.div);this.div.style.height=(f-d.y-8)+"px";this.div.style.overflowX="auto";this.div.style.overflowY="auto";this.dom.style.tableLayout="fixed";if(!this.scrollconnected){this.scrollconnected=true;var c=this;scil.connect(this.div,"onscroll",function(g){scil.Utils.fireEvent(document,"scrollinside",null,null,g)})}},recreateToolbar:function(c){this.initButtons(this.form,c);this.toolbar.style.display="";scil.Utils.removeAll(this.toolbar);if(c==null||c.length==0){this.toolbar.style.display="none"}else{scil.Form.createToolbarButtons(this.toolbar,c)}},isVisible:function(){return scil.Utils.isAllParentVisible(this.root)},show:function(){if(this.isVisible()){return}this.root.style.display="";if(this.host!=null&&this.host.refresh!=null&&this.host.refreshneeded){this.host.refresh()}},hide:function(){this.root.style.display="none"},collapse:function(){this.expand(false)},expanded:true,expandedheight:null,expandedwidth:null,expand:function(d){if(d==null){d=true}if(this.expanded==d){return}var c=this.options.collapsedwidth>0?this.parent:this.dom;if(this.expanded){this.expandedheight=c.offsetHeight;this.expandedwidth=c.offsetWidth}var g=this;if(this.options.collapsedwidth>0){scil.Animation.expandXY(c,d?this.expandedwidth:this.options.collapsedwidth,d?this.expandedheight:this.title.offsetHeight,function(){g.onexpanded(d)})}else{scil.Animation.expandY(c,d?this.expandedheight:this.title.offsetHeight,function(){g.onexpanded(d)})}this.expanded=d},onexpanded:function(d){if(d){var c=this.options.collapsedwidth>0?this.parent:this.dom;c.style.maxHeight="";c.style.maxWidth="";if(this.host!=null&&this.host.refresh!=null&&this.host.refreshneeded){this.host.refresh()}}this.title.style.backgroundImage=scil.App.imgSmall(d?"expand.png":"collapse.png",true);this.title.style.backgroundRepeat="no-repeat";this.title.style.backgroundPosition="left center"},isExpanded:function(){return this.expanded}});scil.apply(scil.Page.ExplorerForm,{kHeaderStyle:{nobackground:true,border:"solid 1px",fontWeight:"bold",padding:"8px 10px 8px 16px",whiteSpace:"nowrap",borderTopLeftRadius:JSDraw2.Skin.kBorderRadius,borderTopRightRadius:JSDraw2.Skin.kBorderRadius},kToolbarStyle:{background:"#f5f5f5",border:"solid 1px #f5f5f5",padding:"1px 5px 3px 5px",overflowX:"hidden",borderBottom:"solid 1px #ccc"},kAreaStyle:{border:"solid 1px #f5f5f5",padding:"5px"},cloneArgs:function(d,c){var f={toolbarvisible:d.toolbarvisible,expandable:d.expandable,caption:d.caption,visible:d.visible,marginTop:d.marginTop,marginBottom:d.marginBottom,expanded:d.expanded,onexpand:d.onexpand};if(c!=null){scil.apply(f,c)}return f}});scil.Page.Tab=scil.extend(scil._base,{constructor:function(f,d,g){this.page=f;this.options=d==null?{}:d;this.onShowTab2=this.options.onShowTab;var c=this;this.options.onShowTab=function(l,j){if(j!=null&&j.form!=null){j.form.hide()}if(l.form!=null){l.form.show();l.form.form.fillscreen(c.screenheight)}if(c.onShowTab2!=null){c.onShowTab2(l,j)}if(c.options.trackhistory!=null&&j!=null){var h=l.getAttribute("key");if(!scil.Utils.isNullOrEmpty(h)){scil.History.update(c.options.trackhistory,h)}}};this.options.forpage=true;this.tabs=new scil.Tabs(g,this.options)},fillscreen:function(c){if(this.tabs.currenttab!=null){this.tabs.currenttab.form.form.fillscreen(c)}this.screenheight=c},addForm:function(g,f){var h=scil.Page.Tab.getTabKey(g.tabkey);var j=this.tabs.addTab(g,h);var c=g.captions;g.caption=null;j.form=scil.Page.addForm(this.page,g,f,j.clientarea);g.caption=c;scil.Page.setBorder(j.form.form);j.form.form.fillscreen(this.screenheight);if(this.options.trackhistory!=null){var d=scil.History.get(this.options.trackhistory);if(!scil.Utils.isNullOrEmpty(d)&&d==h){this.tabs.showTab(j)}}return j.form},removeTab:function(c){return this.tabs.removeTab(c)},closeTab:function(c){return this.tabs.closeTab(c)},findTab:function(c){return this.tabs.findTab(c)},showTab:function(c){this.tabs.showTab(c)},show:function(){this.tabs.show()},hide:function(){this.tabs.hide()}});scil.apply(scil.Page.Tab,{_tabindex:0,getTabKey:function(c){if(scil.Utils.isNullOrEmpty(c)){c="#tabindex"+(++this._tabindex)}return c}});scil.Page.Form=scil.extend(scil._base,{constructor:function(h,g,j){var f=this;this.refreshneeded=true;this.page=h;this.options=g;this.receivers=[];this.ajaxurl=this.options.ajaxurl==null?"ajax.ashx?cmd=":this.options.ajaxurl;var d=[];if(g.norefresh==false){d.push({src:scil.App.imgSmall("refresh.png"),title:"Refresh",onclick:function(){f.refresh()}})}if(g.toggleautohiderows==null&&scil.Page.Form.toggleautohiderows||g.toggleautohiderows){d.push({src:scil.App.imgSmall("hiderows.png"),title:"Show/Hide Blank Rows",onclick:function(){f.toggleAutoHideRows(true)}})}if(this.options.buttons!=null){d=d.concat(this.options.buttons)}if(g.editable){d.push({src:scil.App.imgSmall("edit.png"),title:"Edit",onclick:function(){f.edit()}})}if(g.viewonly==null){g.viewonly=true}this.form=new scil.Page.ExplorerForm(j,this,{buttons:d});this.form.host=this;if(this.options.usetabs!=null){var c={tabs:this.options.fields,viewonly:g.viewonly,border:true,onchange:this.options.onformchange};this.table=new scil.TabbedForm(c).render(this.form.div)}else{this.table=new scil.Form({autohiderows:this.options.autohiderows,alternativeforms:this.options.alternativeforms,viewonly:g.viewonly,onchange:this.options.onformchange});this.table.render(this.form.div,this.options.fields,{immediately:true,hidelabel:g.hidelabel})}},toggleAutoHideRows:function(d){if(this.table!=null){var c=!this.table.options.autohiderows;this.table.options.autohiderows=c}else{var c=!this.options.autohiderows;this.options.autohiderows=c}if(d){this.refresh()}},show:function(){this.form.show()},hide:function(){this.form.hide()},refresh:function(d,c){if(c!=null){this.args=c}if(!this.form.isVisible()||!this.form.isExpanded()){this.refreshneeded=true;return}if(scil.Utils.isDictEmpty(this.args)){return}this.load(this.table,false)},load:function(d,c){d.setData({});this.refreshneeded=false;var g=scil.Page.getFilterArgs(this);if(this.options.onbeforerefresh!=null){if(this.options.onbeforerefresh(g,c,"load",this)=="cancel"){return}}this.page.receiverClear(this);var f=this;scil.Utils.ajax(this.ajaxurl+this.options.object+".load",function(h){if(h==null||h==""){h=g}if(f.options.onsetdata!=null){f.options.onsetdata(d,h)}else{if(f.options.savedoc&&h.doc!=null&&h.doc!=""){d.setXml(h.doc);d.setData(h,true)}else{d.setData(h)}}},g)},clear:function(){this.table.setData({});this.page.receiverClear(this)},edit:function(){var c=this;if(this.dlg==null){this.dlg=scil.Form.createDlgForm(this.options.caption,this.options.fields,{label:"Save",onclick:function(){c.save()}})}this.dlg.show();this.load(this.dlg.form,true)},save:function(){if(this.dlg.form.checkRequiredFields()>0){scil.Utils.alert("Some required field(s) are blank");return}var d=this;var c=this.dlg.form.getData();if(this.options.savedoc){c.doc=this.dlg.form.getXml()}if(this.options.onbeforesave){if(this.options.onbeforesave(c,this.args,this.dlg.form)==false){return false}}scil.Utils.ajax(this.ajaxurl+this.options.object+".save",function(f){d.dlg.hide();d.refresh();if(d.options.onaftersave){d.options.onaftersave(f,d)}},c,{showprogress:true})}});scil.apply(scil.Page.Form,{toggleautohiderows:true});scil.Page.Table=scil.extend(scil._base,{constructor:function(h,g,j){var f=this;this.refreshneeded=true;this.page=h;this.options=g;this.receivers=[];this.ajaxurl=this.options.ajaxurl==null?"ajax.ashx?cmd=":this.options.ajaxurl;var c=[];if(!g.norefresh){c.push({src:scil.App.imgSmall("refresh.png"),title:"Refresh",onclick:function(){f.refresh()}})}if(g.toggleautohidecolumns==null&&scil.Page.Table.toggleautohidecolumns||g.toggleautohidecolumns){c.push({src:scil.App.imgSmall("hidecolumns.png"),title:"Show/Hide Blank Columns",onclick:function(){f.toggleAutoHideColumns(true)}})}if(this.options.issearch){c.push({label:"Use",onclick:function(){f.searchselected()}});this.options.fields=null;this.options.rowcheck=this.options.multiselect?true:"radio"}else{if(this.options.fields!=null){c.push("-");if(this.options.canadd!=false){c.push({src:scil.App.imgSmall("add.png"),title:"New",onclick:function(){f.add()}})}if(this.options.canedit!=false){c.push({src:scil.App.imgSmall("edit.png"),title:"Edit",onclick:function(){f.edit()}})}if(this.options.allowcopy){c.push({src:scil.App.imgSmall("copy.png"),title:"Copy",onclick:function(){f.edit(null,true)}})}}if(this.options.delmany){c.push({src:scil.App.imgSmall("del.png"),title:"Delete Selected",onclick:function(){f.delSelected()}})}if(this.options["import"]||this.options.download){c.push("-");if(this.options["import"]){c.push({src:scil.App.imgSmall("upload.png"),title:"Import data from files",onclick:function(){f.importData()}})}if(this.options.download=="advanced"){c.push({src:scil.App.imgSmall("download.png"),title:"Download",items:[{label:"All Columns",onclick:function(){f.selectDownload("all")}},{label:"Select Columns",onclick:function(){f.selectDownload()}}]})}else{if(this.options.download){c.push({src:scil.App.imgSmall("download.png"),title:"Download",onclick:function(){f.download()}})}}}}if(this.options.buttons!=null){c=c.concat(this.options.buttons)}if(this.options.columnhideable||this.options.columnhidable){c.push("-");c.push({src:scil.App.imgSmall("columns.png"),title:"Show/Hide Columns",onclick:function(){f.table.showHideColumns()}})}if(!scil.Utils.isNullOrEmpty(this.options.savequery)){var l=this.options.savequery;c.push({label:"Query",type:"a",items:[],onclick:function(q,n){scil.Page.ToolbarQuery.selectQuery(f,l,q,n)},onshowdropdown:function(n){return scil.Page.ToolbarQuery.onshowdropdown(l,n)}})}this.restoreCookieKeys(c);this.form=new scil.Page.ExplorerForm(j,this,{buttons:c});this.form.host=this;this.form.main.style.padding="0";if(JSDraw2.Skin.kPagesLocation=="top"||JSDraw2.Skin.kPagesLocation=="topbottom"){this.toppages=scil.Utils.createElement(this.form.div,"div")}this.tablediv=scil.Utils.createElement(this.form.div,"div",null,{borderRight:"solid 1px "+scil.App.config.line});if(this.options.display!=null){this.switchView(this.options.display)}this.recreateTable();if(JSDraw2.Skin.kPagesLocation=="bottom"||JSDraw2.Skin.kPagesLocation=="topbottom"){this.bottompages=scil.Utils.createElement(this.form.div,"div",null,{padding:"10px 10px 10px 30px"})}this.msg=scil.Utils.createElement(this.form.div,"div");if(this.options.loadmore){var d=scil.Utils.createElement(this.form.div,"div",null,{clear:"left"});this.loadmorebutton=scil.Utils.createButton(d,{label:"Load More",type:"a",onclick:function(){f.loadMore()}});this.loadmorebutton.style.display="none"}},delSelected:function(){var c=this.table.getCheckedKeys();if(c==null||c.length==0){scil.Utils.alert("No row checked");return}var d=this;scil.Utils.confirmYes("Delete selected records?",function(){scil.Utils.ajax(d.ajaxurl+d.options.object+".delmany",function(){d.refresh()},{_keys:scil.Utils.array2str(c,",")})})},toggleAutoHideColumns:function(d){if(this.table!=null){var c=!this.table.options.autohidecolumns;this.table.options.autohidecolumns=c}else{var c=!this.options.autohidecolumns;this.options.autohidecolumns=c}if(d){this.refresh(null,null,null,this.args==null?null:this.args.page)}},searchselected:function(){var c=this.table.getCheckedRowData();if(this.options.onsearchselect!=null){this.options.onsearchselect(c)}},addSubform:function(d,c){if(c>0){this.form.dom.style.marginBottom=c+"px"}scil.Page.addForm(this.page,d,this,this.form.dom.parentNode)},recreateTable:function(){scil.Utils.removeAll(this.tablediv);var d=this;var c=scil.clone(this.options);c.selectrow=true;c.onselectrow=function(f){d.selectrow(f)};if(c.pushleft==null){c.pushleft=scil.Page.Table.pushleft}if(c.autohidecolumns==null){c.autohidecolumns=scil.Page.Table.autohidecolumns}if(this.options.type=="block"){this.table=new scil.CardView(c);this.table.render(this.tablediv,this.options.columns)}else{if(this.options.type=="column"){this.table=new scil.CardView(c);this.table.render(this.tablediv,this.options.columns)}else{this.table=new scil.Table(true,null,c);this.table.render(this.tablediv,this.options.columns);this.table.tbody.parentNode.style.width="100%"}}this.recreateneeded=false;if(this.options.oncreatetable!=null){this.options.oncreatetable(this)}},switchView:function(d){if(d==this.display){return false}var c=this.options.displays[d];if(c==null){return false}if(this.options.rowcheck&&this.table!=null){this.selectedkeys=this.table.getCheckedKeys()}this.display=d;scil.apply(this.options,c);this.setRecreate();return true},selectFirstRow:function(){this.table.selectFirstRow()},show:function(){this.form.show()},hide:function(){this.form.hide()},clear:function(){scil.Utils.removeAll(this.toppages);scil.Utils.removeAll(this.bottompages);scil.Utils.removeAll(this.msg);this.table.setData({});this.page.receiverClear(this)},selectrow:function(g){var f=g==null?null:g.getAttribute("key");var c=null;c={};c[this.options.key]=f;var d=this.table.getRowData(g);if(this.options.name!=null&&d!=null){c[this.options.name]=d[this.options.name]}if(this.options.onpushdata!=null){this.options.onpushdata(c,d,this)}this.page.receiverRefresh(this,c);if(this.options.onselectrow!=null){this.options.onselectrow(g,c)}},loadPage:function(c){if(this.args==null){this.args={}}if(this.options.onloadpage!=null){this.options.onloadpage(this.args,c,this)}this.refresh(null,null,null,c)},setRecreate:function(){this.recreateneeded=true},list:function(g,d){if(this.recreateneeded){this.recreateTable()}var f=this;if(g==null){g={}}var c=g.rows==null?g:g.rows;this.table.setData(c,null,d?false:true);if(this.loadmorebutton==null){scil.Table.listPages(this.toppages,g.page,g.pages,function(j){f.loadPage(j)});scil.Table.listPages(this.bottompages,g.page,g.pages,function(j){f.loadPage(j)});if(c==null||c.length==0){this.msg.innerHTML="<div style='color:#FF8C00;padding:5px;'>"+scil.Lang.res("No Records Found")+"</div>"}else{scil.Utils.removeAll(this.msg)}}else{if(c==null||c.length==0||g.page!=null&&g.page>=g.pages){this.loadmorebutton.style.display="none"}else{var h;if(g.page!=null&&g.pages!=null){h=scil.Lang.res("Load page")+" "+(g.page+1)+"/"+g.pages}else{h=scil.Lang.res("Load More")}this.loadmorebutton.innerHTML=h;this.loadmorebutton.style.display=""}}if(this.table!=null){this.table.autoHideColumns()}},importData:function(j){var g=this;var f=this.options.importfields;if(this.options.bulkupdate||j){if(f==null){f={}}f.__updatemode={label:"Update Mode",type:"checkbox",viewonly:j,value:j,str:"Update data by primary key"}}if(this.options.datamapping){if(f==null){f={}}var h=this.ajaxurl+this.options.object+".importpreview";f.__mapping={label:"Data Mapping",viewonly:true,attributes:{name:"__mapping"},width:50,button2:{label:"Preview & Mapping",type:"a",onclick:function(n){scil.FileUploader.mapData(h,g.options.columns);n.preventDefault()}}}}var l=this.ajaxurl+this.options.object+".import";var c=this.options.importcaption==null?"Import Data":this.options.importcaption;var d=this.options.onimportdata==null?this.args:this.options.onimportdata(this);scil.FileUploader.upload({caption:c,multiple:true,fields:f,data:d,url:l,callback:function(n){g.importData2(n)}})},importData2:function(c){if(this.options.onimported!=null){this.options.onimported(c)}else{if(c.message!=null){scil.Utils.alert(c.message)}}this.refresh()},restoreCookieKeys:function(d){if(d==null){return}if(this.options.trackhistory!=null){this._historyargs=scil.History.get(this.options.trackhistory)}for(var f=0;f<d.length;++f){var c=d[f];if(c!=null&&!scil.Utils.isNullOrEmpty(c.key)){if(c.cookiekey!=null){var g=scil.Utils.readCookie("scil_pagetable_"+c.cookiekey);if(!scil.Utils.isNullOrEmpty(g)){c.value=g}}if(this._historyargs!=null&&this._historyargs[c.key]!=null){c.value=this._historyargs[c.key]}}}},download:function(c,d){var f=scil.Page.getFilterArgs(this);if(this.table.options.rowcheck){f._keys=scil.Utils.array2str(this.table.getCheckedKeys(),",")}f._columns=scil.Table.rows2xml(c);f._fileformat=d;if(this.options.onbeforerefresh==null||this.options.onbeforerefresh(f,null,"download",this)!="cancel"){this.download2(f)}},download2:function(f){if(this.options.downloadformats==null){this.download3(f);return}if(this.extDlg==null){var d=this;var c={_fileformat:{label:"Select File Format",type:"select",items:this.options.downloadformats}};this.extDlg=scil.Form.createDlgForm("Download",c,{label:"Download",onclick:function(){d.download3()}})}this.extDlg.show();this.extDlg.params=f},download3:function(f){if(f==null){var c=this.extDlg.form.getData();f=this.extDlg.params;f._fileformat=c._fileformat}scil.Utils.post(this.ajaxurl+this.options.object+".download",f,"_blank");if(this.extDlg!=null){this.extDlg.hide()}},selectDownload:function(c){if(c){this.download(this.table.allColsForDownload())}else{var d=this;this.table.selectColumns("Select Columns",function(f){d.download(f)},function(f){return true})}},refresh:function(d,c,h,f,j){if(this._historyargs!=null){this.args=c!=null?c:this._historyargs;this._historyargs=null}else{if(c!=null){this.args=c}if(this.args==null){this.args={}}this.args.page=f}if(this.options.extraparams!=null){scil.apply(this.args,this.options.extraparams,false)}if(!this.form.isVisible()||!this.form.isExpanded()){this.refreshneeded=true;return}this.page.receiverClear(this);this.refreshneeded=false;var g=scil.Page.getFilterArgs(this);if(g!=null&&g.display!=null&&this.options.displays!=null){this.switchView(g.display)}if(this.options.onbeforerefresh==null||this.options.onbeforerefresh(g,h,"refresh",this)!="cancel"){this.refresh2(g,h,null,j);if(this.options.trackhistory!=null){scil.History.update(this.options.trackhistory,g)}}},loadMore:function(){if(this.moreparams==null){this.moreparams={}}if(this.moreparams.page==null){this.moreparams.page=1}++this.moreparams.page;this.refresh2(this.moreparams,null,"loadmore")},refresh2:function(g,h,d,j){var f=this;var c=this.options.jsonp?scil.Utils.jsonp:scil.Utils.ajax;c(this.ajaxurl+this.options.object+".list",function(l){f.refresh3(l,h,d);f.moreparams=g},g,{showprogress:this.options.showprogress||j})},refresh3:function(f,g,d){if(this.options.onbeforelisting!=null){this.options.onbeforelisting(f,this)}if(g){this.list(f,d);this.table.selectFirstRow()}else{var c=this.table.getCurrentKey();this.list(f,d);if(c!=null){this.table.selectRow(c)}}if(this.options.onrefreshed!=null){this.options.onrefreshed(this)}if(this.selectedkeys!=null){this.table.checkRows(this.selectedkeys);this.selectedkeys=null}},add:function(c){if(this.options.onAddNew!=null&&this.options.onAddNew(this.args)==false){return}this.add2(c,"create")},add2:function(f,c){this.create();this.dlg.show();if(this.options.usetabs){this.dlg.form.tabs.showTab(0)}if(this.options.onshowform!=null){this.options.onshowform(this.dlg,this.args,c)}var d=f!=null?f:(this.options.defaultvalues==null?{}:this.options.defaultvalues);this.applyArgs(d);if(this.options.key!=null){d[this.options.key]=null}if(this.options.onloaddata){this.options.onloaddata(d,this.args,this.dlg)}this.dlg.form.setData(d);this.dlg.editkey=null;this.setButtons(c)},copyNew:function(c){if(c==null){c=this.table.key}if(c==null){return}var d=this;this.edit(function(f){f[c]="";d.dlg.editkey=null},true)},edit:function(g,c){if(this.table.currow==null){scil.Utils.alert("please select a row first");return}this.add2(null,c?"copy":"save");var f=this;var d={};d[this.options.key]=this.table.currow.getAttribute("key");this.dlg.editkey=c?null:d[this.options.key];if(!c&&this.options.onEdit!=null&&this.options.onEdit(d,this)=="stop"){this.dlg.hide();return}d._iscopying=c;scil.Utils.ajax(this.ajaxurl+this.options.object+".load",function(h){if(f.options.onloaddata){if(f.options.onloaddata(h,f.args,f.dlg,c)=="stop"){f.dlg.hide();return}}if(g!=null){g(h,f)}f.dlg._iscopying=c;f.dlg._copyingfrom=null;if(c){f.dlg._copyingfrom=h[f.table.key];h[f.table.key]=null}if(f.options.savedoc&&h.doc!=null&&h.doc!=""){f.dlg.form.setXml(h.doc);f.dlg.form.setData(h,true)}else{f.dlg.form.setData(h)}},d)},applyArgs:function(c){if(this.args!=null){for(var d in this.args){var f=this.args[d];if(!scil.Utils.isNullOrEmpty(f)){c[d]=f}}}},cancel:function(){if(this.dlg!=null){this.dlg.hide()}},save:function(){if(this.dlg.form.checkRequiredFields()>0){scil.Utils.alert("Some required field(s) are blank");return}var d=this;var c=this.dlg.form.getData();if(this.options.savedoc){c.doc=this.dlg.form.getXml()}if(this.options.onbeforesave){if(this.options.onbeforesave(c,this.args,this.dlg.form)==false){return false}}c._iscopying=this.dlg._iscopying;if(this.dlg._iscopying){c._copyingfrom=this.dlg._copyingfrom;c[this.table.key]=null}scil.Utils.ajax(this.ajaxurl+this.options.object+".save",function(g){d.dlg.hide();if(g!=null&&g.rows!=null&&g.rows.length>0){for(var f=0;f<g.rows.length;++f){if(d.dlg.editkey!=null){d.table.updateRow(d.dlg.editkey,g.rows[f])}else{d.table.addRow(g.rows[f])}}scil.Utils.removeAll(d.msg)}else{d.refresh()}if(d.options.onaftersave){d.options.onaftersave(g,d)}if(d.table!=null){d.table.autoHideColumns()}},c,{showprogress:true})},del:function(){var c=this;scil.Utils.confirmYes("Delete this record?",function(){var d=c.dlg.form.getData();scil.Utils.ajax(c.ajaxurl+c.options.object+".del",function(f){c.dlg.hide();c.refresh()},d)})},setButtons:function(c){if(this.dlg==null){return}for(var f=0;f<this.dlg.form.buttons.length;++f){var d=this.dlg.form.buttons[f];if(d==null){continue}var g=d.getAttribute("key");if(g=="delete"){d.style.display=c=="save"?"":"none"}else{if(g=="save"){d.style.display=c!="copy"?"":"none"}else{if(g=="copy"){d.style.display=c=="copy"?"":"none"}}}}},create:function(){if(this.dlg!=null){return}var d=this;var c=[{src:scil.App.imgSmall("submit.png"),label:"Save",key:"save",onclick:function(){d.save()}}];if(this.options.allowcopy){c.push(" ");c.push({src:scil.App.imgSmall("copy.png"),label:"Copy",key:"copy",onclick:function(){d.save()}})}if(this.options.candelete!=false){c.push(" ");c.push({src:scil.App.imgSmall("del.png"),label:"Delete",key:"delete",onclick:function(){d.del()}})}c.push(" ");c.push({src:scil.App.imgSmall("cancel.png"),label:"Cancel",key:"cancel",onclick:function(){d.cancel()}});if(this.options.editbuttons!=null){if(this.options.editbuttons.length==null){c.push(this.options.editbuttons)}else{c=c.concat(this.options.editbuttons)}}if(this.options.usetabs){this.dlg=scil.Form.createTabDlgForm(this.options.formcaption,{tabs:this.options.fields,buttons:c,border:true,onchange:this.options.onformdatachange})}else{this.dlg=scil.Form.createDlgForm(this.options.formcaption,this.options.fields,c,{alternativeforms:this.options.alternativeforms,hidelabel:this.options.hidelabel,oncreated:this.options.oncreateform,onchange:this.options.onformdatachange})}}});scil.apply(scil.Page.Table,{pushleft:false,autohidecolumns:false,toggleautohidecolumns:true});scil.Page.Tree=scil.extend(scil._base,{constructor:function(h,g,j){var f=this;this.refreshneeded=true;this.page=h;this.options=g==null?{}:g;this.receivers=[];this.ajaxurl=this.options.ajaxurl==null?"ajax.ashx?cmd=":this.options.ajaxurl;var d=[];if(this.options.onrender==null){d.push({src:scil.App.imgSmall("refresh.png"),title:"Refresh",onclick:function(){f.refresh()}});if(this.options.fields!=null){d.push("-",{src:scil.App.imgSmall("add.png"),title:"New",onclick:function(){f.add()}});d.push({src:scil.App.imgSmall("edit.png"),title:"Edit",onclick:function(){f.edit()}})}}if(this.options.buttons!=null){d=d.concat(this.options.buttons)}var c=null;if(this.options.object!=null){c={dropdown:this.options.dropdown,url:this.ajaxurl+this.options.object+".tree",icongap:"3px",translate:this.options.translate,onAddItem:this.options.onAddItem,onAfterAjaxCall:this.options.onAfterAjaxCall}}this.form=new scil.Page.ExplorerForm(j,this,{buttons:d,collapsedwidth:20});this.form.host=this;if(this.options.onrender!=null){this.options.onrender(this.form.div,c)}else{this.tree=new scil.Tree(this.form.div,c);this.tree.onSelectItem=function(l){f.select(l)};this.tree.onExpandItem=function(n,l){if(f.options.onexpand!=null){return f.options.onexpand(n,l)}};if(this.options.startrefresh!=false){this.refresh()}}this.form.main.style.padding=0;scil.Page.setBorder(this.form)},show:function(){this.form.show()},hide:function(){this.form.hide()},select:function(d){if(this.options.onselectitem!=null){if(this.options.onselectitem(d)){return}}var c={};if(this.options.onBuildArgs!=null){c=this.options.onBuildArgs(d)}else{if(d!=null&&d.item!=null&&d.item[this.options.key]!=null){c=scil.clone(d.item)}}this.page.receiverRefresh(this,c)},refresh:function(c){if(!this.form.isVisible()){this.refreshneeded=true;return}if(this.tree==null){return}if(c){this.tree.reloadCur();return}this.refreshneeded=false;this.tree.clear();if(this.options.root!=null){if(this.options.root.selectable==null){this.options.root.selectable=false}if(this.options.root.showroot==false&&this.options.root.children!=null){for(var d=0;d<this.options.root.children.length;++d){this.tree.cur=this.tree.add(null,this.options.root.children[d])}}else{this.tree.cur=this.tree.add(null,this.options.root)}}if(this.options.object!=null&&this.options.object!=""){this.tree.reloadCur()}},applyArgs:function(c){if(this.args!=null){scil.apply(c,this.args)}},add:function(){this.create();this.dlg.show();if(this.options.onshowform!=null){this.options.onshowform(this.dlg)}this.dlg.form.setData(this.options.defaultvalues==null?{}:this.options.defaultvalues)},edit:function(){this.add();var c={};c[this.options.key]=this.tree.cur==null||this.tree.cur.item==null?null:this.tree.cur.item[this.options.key];if(c[this.options.key]!=null){var d=this;scil.Utils.ajax(this.ajaxurl+this.options.object+".load",function(f){if(d.options.onloaddata){d.options.onloaddata(f)}d.dlg.form.setData(f)},c)}},save:function(){var d=this;var c=this.dlg.form.getData();if(this.options.onbeforesave){var f={};f[this.options.key]=this.tree.cur==null||this.tree.cur.item==null?null:this.tree.cur.item[this.options.key];if(this.options.onbeforesave(c,f)==false){return false}}scil.Utils.ajax(this.ajaxurl+this.options.object+".save",function(){d.dlg.hide();if(d.options.onSaved!=null){d.options.onSaved(d,c)}else{d.refresh(true)}},c)},del:function(){var d=this;var c=this.dlg.form.getData();scil.Utils.ajax(this.ajaxurl+this.options.object+".del",function(){d.dlg.hide();d.refresh()},c)},create:function(){if(this.dlg!=null){return}var d=this;var c=[{src:scil.App.imgSmall("submit.png"),label:"Save",onclick:function(){d.save()}},{src:scil.App.imgSmall("del.png"),label:"Delete",onclick:function(){d.del()}}];this.dlg=scil.Form.createDlgForm(this.options.formcaption,this.options.fields,c);if(this.options.oncreateform!=null){this.options.oncreateform(this.dlg.form)}}});scil.Page.Custom=scil.extend(scil._base,{constructor:function(g,f,h){var d=this;this.refreshneeded=true;this.page=g;this.options=f;this.receivers=[];this.ajaxurl=this.options.ajaxurl==null?"ajax.ashx?cmd=":this.options.ajaxurl;var c=[];if(f.norefresh==false){c.push({src:scil.App.imgSmall("refresh.png"),title:"Refresh",onclick:function(){d.refresh()}})}if(this.options.buttons!=null){c=c.concat(this.options.buttons)}this.form=new scil.Page.ExplorerForm(h,this,{buttons:c});this.form.host=this;if(this.options.oncreate!=null){this.options.oncreate(this.form.div,this.options)}},show:function(){this.form.show()},hide:function(){this.form.hide()},refresh:function(d,c){if(c!=null){this.args=c}if(!this.form.isVisible()){this.refreshneeded=true;return}this.refreshneeded=false;var f=scil.Page.getFilterArgs(this);if(this.options.onrefresh!=null){this.options.onrefresh(d,f,this)}},clear:function(){if(this.options.onclear!=null){this.options.onclear(this)}}});scil.Page.Calendar=scil.extend(scil._base,{constructor:function(h,g,j){var f=this;this.refreshneeded=true;this.page=h;this.options=g;this.receivers=[];this.ajaxurl=this.options.ajaxurl==null?"ajax.ashx?cmd=":this.options.ajaxurl;var d=[];if(g.norefresh==false){d.push({src:scil.App.imgSmall("refresh.png"),title:"Refresh",onclick:function(){f.refresh()}})}if(this.options.buttons!=null){d=d.concat(this.options.buttons)}this.form=new scil.Page.ExplorerForm(j,this,{buttons:d});this.form.host=this;var l=scil.Utils.createTable(this.form.div);l.parentNode.setAttribute("align","center");var n=scil.Utils.createElement(scil.Utils.createElement(l,"tr"),"td");var c=scil.clone(this.options);c.onNextYear=function(){f.refresh()};c.onNextMonth=function(){f.refresh()};c.onSetToday=function(){f.refresh()};c.onclick=function(t,q,u){if(q=="evt"){if(f.options.onclickevent!=null){f.options.onclickevent(u)}}};c.ondblclick=function(t,q,u){if(q=="area"){if(f.options.ondblclick!=null){f.options.ondblclick(t)}}};this.table=new scil.Calendar(n,c)},show:function(){this.form.show()},hide:function(){this.form.hide()},refresh:function(d,c){if(c!=null){this.args=c}if(!this.form.isVisible()||!this.form.isExpanded()){this.refreshneeded=true;return}if(scil.Utils.isDictEmpty(this.args)){return}var f=this;this.refreshneeded=false;var g=this.args;if(g==null){g={}}if(f.options.onbeforerefresh!=null){f.options.onbeforerefresh(g)}this.page.receiverClear(this);scil.Utils.ajax(this.ajaxurl+this.options.object+".calendar",function(h){if(f.options.onsetdata!=null){f.options.onsetdata(f.table,h)}},g)},clear:function(){this.table.setEvents(null);this.page.receiverClear(this)}});scil.Page.Gantt=scil.extend(scil._base,{constructor:function(g,f,h){scil.Page.Gantt.initLib();var d=this;this.refreshneeded=true;this.page=g;this.gantt=null;this.options=f==null?{}:f;this.receivers=[];this.ajaxurl=this.options.ajaxurl==null?"ajax.ashx?cmd=":this.options.ajaxurl;this.data=null;this.edit=false;this.canedit=false;if(!(this.options.height>0)){this.options.height=500}if(this.options.view==null){this.options.view="Year"}if(this.options.colors==null){this.options.colors={alert:"red",delayed:"#F1AA3E",notstarted:"#AAA",closed:"#055F05",milestone:"red",task:"#08BCD2",project:"#78F79D"}}if(this.options.keys==null){this.options.keys={}}if(this.options.keys.taskid==null){this.options.keys.taskid="taskid"}if(this.options.keys.projectid==null){this.options.keys.projectid="projectid"}if(this.options.keys.starteddt==null){this.options.keys.starteddt="starteddt"}if(this.options.keys.finisheddt==null){this.options.keys.finisheddt="finisheddt"}if(this.options.keys.timeline==null){this.options.keys.timeline="timeline"}if(this.options.keys.title==null){this.options.keys.title="title"}var c=[];if(f.norefresh!=false){c.push({src:scil.App.imgSmall("refresh.png"),title:"Refresh",onclick:function(){d.refresh()}});c.push("|")}c.push({type:"select",label:"Scale",items:scil.Page.Gantt.kScales,onchange:function(j){d.setScale((j.srcElement||j.target).value)}});if(this.options.buttons!=null){c=c.concat(this.options.buttons)}this.form=new scil.Page.ExplorerForm(h,this,{buttons:c});this.form.host=this;this.ganttdiv=scil.Utils.createElement(this.form.div,"div");this.controldiv=scil.Utils.createElement(this.ganttdiv,"div");this.parentdiv=scil.Utils.createElement(this.ganttdiv,"div",null,{height:this.options.height})},show:function(){this.form.show()},hide:function(){this.form.hide()},refresh:function(d,c){if(c!=null){this.args=c}if(!this.form.isVisible()){this.refreshneeded=true;return}this.refreshneeded=false;this.edit=false;this.reloadChart()},clear:function(){if(this.options.onclear!=null){this.options.onclear()}this.selecteddata=null;if(this.gantt!=null){this.gantt.destroy();this.gantt=null}},reloadChart:function(c){this.clear();if(scil.Utils.isDictEmpty(this.args)){return}var d=this;d.projectid=null;scil.Utils.ajax(this.ajaxurl+this.options.object+".gantt",function(f){d.projectid=d.args.projectid;d.taskid=d.args.taskid;d.canedit=f.canedit;if(!f.canedit){d.edit=false}d.renderChart(f,d.args.projectid);if(c!=null){c()}},this.args,{showprogress:true})},editChart:function(c){if(!this.canedit){scil.Utils.alert("You don't have privilege to edit it");return}this.edit=c;this.reloadChart()},saveChart:function(){var c={};var q=[];this._collectData(q,c,this.data,{});for(var f in c){var n=c[f];var l=this.parseConnections(n,c);if(l==null){continue}for(var d=0;d<l.length;++d){var h=l[d];var j=h.source;if(n.taskid>0&&j.taskid>0){q.push({staskid:j.taskid,ttaskid:n.taskid,lag:h.lag})}else{if(!(n.taskid>0)&&!(j.taskid>0)){q.push({sprojectid:j.projectid,tprojectid:n.projectid,lag:h.lag})}}}}var g=this;scil.pmf.ajax("gantt.savetimeline",function(){g.editChart(false)},{projectid:this.projectid,taskid:this.taskid,xml:scil.Table.rows2xml(q)},{showprogress:true})},parseConnections:function(l,f){if(scil.Utils.isNullOrEmpty(l.predecessor)){return null}var h=[];var j=l.predecessor.split(",");for(var g=0;g<j.length;++g){var d=this.parseOneConnection(j[g],l,f);if(d!=null){h.push(d)}}return h},parseOneConnection:function(l,q,f){if(!/FS([+|-]?[0-9]+[d|D])?$/.test(l)){return null}var c=null;var j=l.indexOf("FS");if(j>0){c=l.substr(j+2,l.length-3);l=l.substr(0,j)}var g=parseInt(l);var n=f[g];if(n==null){return null}var h=Math.round((this._getDate(q.start_date)-this._getDate(n.end_date))/(24*60*60*1000))-1;return{sourceid:g,name:n.name,source:n,target:q,lag:h}},editConnections:function(){if(this.selecteddata==null){scil.Utils.alert("Please select the parent Project or Task first");return}var c={};var h=[];this._collectData(h,c,this.data,{});var g=this.parseConnections(this.selecteddata,c);if(g==null||g.length==0){return}if(this.connectionDlg==null){var d={table:{type:"table",addrow:false,columns:{sourceid:{type:"hidden"},name:{label:"Name",viewonly:true,width:300},lag:{label:"Lag",type:"number",unit:"Day",width:80}}}};var f=this;this.connectionDlg=scil.Form.createDlgForm("Edit Connections",d,{label:"Save",onclick:function(){f.editConnections2()}},{hidelabel:true})}this.connectionDlg.show();this.connectionDlg.form.setData({table:g})},editConnections2:function(){var g=this.connectionDlg.form.fields.table.jsd.getData();var f=null;for(var c=0;c<g.length;++c){if(f==null){f=""}else{f+=","}var d=parseInt(g[c].lag);if(isNaN(d)){d=0}f+=this._renderLag(g[c].sourceid,d)}this.selecteddata.predecessor=f;this.connectionDlg.hide();this.redrawChart()},addTask:function(c){if(this.selecteddata==null){scil.Utils.alert("Please select the parent Project or Task first");return}var f=this;var g=this.selecteddata;var d={projectcode:g.projectid==null?null:"#"+g.projectid,parenttaskid:g.taskid,category:c};scil.pmf.Task.createTask(d,function(j){var h=j.rows[0];h.name="Task#"+h.taskid;var l=f.makeTask(h,"taskid",scil.Page.Gantt.kMaxProjectID);g.children.push(l);f.gantt.addRecord(l,"child");if(g.taskid>0){f.selectTask(g.taskid+scil.Page.Gantt.kMaxProjectID)}else{f.selectTask(g.projectid)}})},editTask:function(){var f=this.selecteddata;if(f==null||!(f.taskid>0)){scil.Utils.alert("Please select the Task first");return}var d=this;var c={taskid:f.taskid};scil.pmf.Task.createTask(c,function(g){d.reloadChart(function(){d.selectTask(f.taskid+scil.Page.Gantt.kMaxProjectID)})})},selectTask:function(d){var f=-1;var g=this.gantt.model.updatedRecords;for(var c=0;c<g.length;++c){if(g[c].item.id==d){f=c;break}}if(f>=0){this.gantt.option("selectedRowIndex",f);this.gantt._$treegridHelper.ejTreeGrid("updateScrollBar")}},makeTask:function(c,d,f){var g=c;g.id=f+g[d];g.children=[];g.milestone=c.category=="Milestone";g.start_date=c[this.options.keys.starteddt]==null?c.created:c[this.options.keys.starteddt];g.end_date=c.timeline;if(g.milestone){g.end_date=g.start_date}else{if(g.end_date==null){g.end_date=g.start_date}}if(!g.milestone&&g.end_date-g.start_date<scil.Page.Gantt.kOneDayTicks){g.end_date=g.start_date+scil.Page.Gantt.kOneDayTicks}if(c[this.options.keys.finisheddt]>0&&c[this.options.keys.finisheddt]<this.today){g.progress=100}g.finisheddate=scil.Utils.dateStr(c[this.options.keys.finisheddt],true,"yyyy-mm-dd");g.state=g.status==null?"":g.status;if(this.options.onrendertitle!=null){g.title=this.options.onrendertitle(c,g)}else{g.title=c.title}if(this.options.onmaketask!=null){this.options.onmaketask(g,c)}return g},setScale:function(c){if(this.options.view==c){return}this.options.view=c;switch(this.options.view){case"Day":this.gantt.model.scheduleHeaderSettings.timescaleUnitSize="100%";this.gantt.model.scheduleHeaderSettings.scheduleHeaderType=ej.Gantt.ScheduleHeaderType.Day;this.gantt.reRenderChart(ej.Gantt.ScheduleHeaderType.Day);break;case"Week":this.gantt.model.scheduleHeaderSettings.timescaleUnitSize="100%";this.gantt.model.scheduleHeaderSettings.scheduleHeaderType=ej.Gantt.ScheduleHeaderType.Week;this.gantt.reRenderChart(ej.Gantt.ScheduleHeaderType.Week);break;case"Month":this.gantt.model.scheduleHeaderSettings.timescaleUnitSize="100%";this.gantt.model.scheduleHeaderSettings.weekHeaderFormat="M/dd";this.gantt.model.scheduleHeaderSettings.scheduleHeaderType=ej.Gantt.ScheduleHeaderType.Month;this.gantt.reRenderChart(ej.Gantt.ScheduleHeaderType.Month);break;default:this.gantt.model.scheduleHeaderSettings.timescaleUnitSize=scil.Page.Gantt.kYearWidth;this.gantt.model.scheduleHeaderSettings.scheduleHeaderType=ej.Gantt.ScheduleHeaderType.Year;this.gantt.reRenderChart(ej.Gantt.ScheduleHeaderType.Year);break}this.gantt=$("#"+this.parentdiv.id).data("ejGantt")},_renderLag:function(d,c){return d+"FS"+(c!=0?(c>0?"+"+c:c)+"d":"")},renderChart:function(w,q){this.clear();var n=0;var d={};if(w.projects!=null){for(var g=0;g<w.projects.items.length;++g){var y=this.makeTask(w.projects.items[g],this.options.keys.projectid,0);y.pos=++n;d[y.id]=y}}if(w.tasks!=null){for(var g=0;g<w.tasks.items.length;++g){var y=this.makeTask(w.tasks.items[g],this.options.keys.taskid,scil.Page.Gantt.kMaxProjectID);y.pos=++n;d[y.id]=y}}if(w.projects!=null&&w.projects.relationships!=null){for(var g=0;g<w.projects.relationships.length;++g){var u=w.projects.relationships[g];var x=d[u.dependingon];var z=d[u.projectid];if(x!=null&&dest!=null){if(z.predecessor==null){z.predecessor=x.id+"FS"}else{z.predecessor+=","+x.id+"FS"}}}}if(w.tasks!=null&&w.tasks.relationships!=null){for(var g=0;g<w.tasks.relationships.length;++g){var u=w.tasks.relationships[g];var x=d[scil.Page.Gantt.kMaxProjectID+u.dependingon];var z=d[scil.Page.Gantt.kMaxProjectID+u.taskid];if(x!=null&&z!=null){if(z.predecessor==null){z.predecessor=this._renderLag(x.id,u.lag)}else{z.predecessor+=","+this._renderLag(x.id,u.lag)}}}}this.data=[];for(var h in d){var y=d[h];var l=d[y.parentid];if(l!=null){l.children.push(y)}else{this.data.push(y)}}this._sortPos(this.data);var B=this.getTooltipTemplate();var A=scil.Utils.dateStr(scil.Utils.time(),true,"yyyy-mm-dd");var f={};f._ganttDateFormatter=function(C){var t=this.data[C];return t?ej.format(t,"yyyy-MM-dd"):""};$.views.helpers(f);var j=this;var c={dataSource:this.data,allowSelection:true,allowColumnResize:true,taskIdMapping:"id",taskNameMapping:"name",startDateMapping:"start_date",endDateMapping:"end_date",progressMapping:"progress",milestoneMapping:"milestone",childMapping:"children",treeColumnIndex:0,predecessorMapping:"predecessor",taskbarTooltipTemplate:B,allowGanttChartEditing:this.edit,allowDragAndDrop:this.edit,isResponsive:true,stripLines:[{day:A,label:scil.Lang.res("Today"),lineStyle:"solid",lineColor:"orange",lineWidth:2}],scheduleHeaderSettings:{scheduleHeaderType:this.options.view.toLocaleLowerCase(),timescaleUnitSize:scil.Page.Gantt.kYearWidth},rowHeight:window.theme=="material"?48:window.theme=="office-365"?36:30,editSettings:{allowEditing:false,allowAdding:false,allowDeleting:false,editMode:"cellEditing"},load:function(){j.onload(this)},rowSelected:function(t){j.selecteddata=t.data.item},queryTaskbarInfo:function(t){j.queryTaskbarInfo(t)},actionComplete:function(t){if(t.requestType=="validatePredecessor"&&t.predecessorValidation){t.predecessor.indexOf("FS")!=-1?(t.predecessorValidation=true):(t.predecessorValidation=false)}}};if(scil.Lang.language=="cn"){c.locale="zh_CN"}if(scil.Utils.isNullOrEmpty(this.parentdiv.id)){this.parentdiv.id="__scil_gantt"+(++scil.Page.Gantt.__index)}$("#"+this.parentdiv.id).ejGantt(c);this.gantt=$("#"+this.parentdiv.id).data("ejGantt");if(this.edit&&this.control==null){var j=this;this.control=scil.Utils.createElement(this.controldiv,"div",null,{display:"none",padding:"5px",background:"yellow",border:"1px solid orange",borderBottom:"none",textAlign:"center"});scil.Utils.createButton(this.control,{label:"Save",onclick:function(){j.saveChart(true)}});scil.Utils.createButton(this.control," ");scil.Utils.createButton(this.control,{label:"Cancel",onclick:function(){j.editChart(false)}});scil.Utils.createButton(this.control," ");scil.Utils.createButton(this.control,{label:"Edit Connections",onclick:function(){j.editConnections()}})}if(this.control!=null){this.control.style.display=this.edit?"":"none"}},getTooltipTemplate:function(){if(this.options.tooltipstemplate!=null){return this.options.tooltipstemplate}return"<table><tr><td colspan=2 style='padding:3px'><b>{{:taskName)}}</b></td></tr><tr><td style='padding:3px'><b>"+scil.Lang.res("Full Name")+":</b></td><td style='padding:3px'>{{:title)}}</td></tr><tr><td style='padding:3px'><b>"+scil.Lang.res("Owner")+":</b></td><td style='padding:3px'>{{:owner)}}</td></tr><tr><td style='padding:3px'><b>"+scil.Lang.res("Progress")+":</b></td><td style='padding:3px'>{{:progress)}}</td></tr><tr><td style='padding:3px'><b>"+scil.Lang.res("Start")+":</b></td><td style='padding:3px'>{{:~_ganttDateFormatter('startDate')}}</td></tr><tr><td style='padding:3px'><b>"+scil.Lang.res("Timeline")+":</b></td><td style='padding:3px'>{{:~_ganttDateFormatter('endDate')}}</td></tr><tr><td style='padding:3px'><b>"+scil.Lang.res("Status")+":</b></td><td style='padding:3px'>{{:state)}}</td></tr><tr><td style='padding:3px'><b>"+scil.Lang.res("Finished")+":</b></td><td style='padding:3px'>{{:finish}}</td></tr></table>"},onload:function(g){var f=g.getColumns();f[0]=scil.clone(f[1]);f[0].headerText=scil.Lang.res("Project/Task");f[0].width=100;f[1]=scil.clone(f[0]);f[1].field="title";f[1].mappingName="title";f[1].headerText=scil.Lang.res("Full Name");f[1].width=150;f[2].headerText=scil.Lang.res("Start");f[2].format="{0:yyyy-M-d}";f[2].width=80;f[3].headerText=scil.Lang.res("Timeline");f[3].format="{0:yyyy-M-d}";f[3].width=80;f[4].field="progress";f[4].mappingName="progress";f[4].headerText=scil.Lang.res("Progress");f[4].width=50;f[5]=scil.clone(f[4]);f[5].field="state";f[5].mappingName="state";f[5].headerText=scil.Lang.res("Status");f[5].width=60;f[6].field="finish";f[6].mappingName="finisheddate";f[6].headerText=scil.Lang.res("Finished");f[6].width=80;f[6].visible=true;f[7]=scil.clone(f[0]);f[7].field="owner";f[7].mappingName="owner";f[7].headerText=scil.Lang.res("Owner");f[7].width=80;f[7].visible=true;if(this.options.columns!=null){for(var h=0;h<this.options.columns.length;++h){var d=this.options.columns[h];if(f[h]!=null&&d!=null){scil.apply(f[h],d)}}}if(this.options.onsetcolumns!=null){this.options.onsetcolumns(f)}},queryTaskbarInfo:function(c){var d=c.data.item;if(d.taskid>0){if(d.milestone){c.milestoneBackground=this.options.colors.milestone;if(d.status=="Closed"){c.milestoneBackground="green"}}else{c.taskbarBackground=this.options.colors.task}}else{c.taskbarBackground=this.options.colors.project}if(d.color!=null){c.taskbarBackground=d.color}c.progressbarBackground=d.progresscolor!=null?d.progresscolor:"green";c.parentTaskbarBackground=c.taskbarBackground;c.parentProgressbarBackground=c.progressbarBackground},_collectData:function(h,c,f,g){if(f==null||f.length==0){return}for(var d=0;d<f.length;++d){var j=f[d];if(j.taskid>0&&g.projectid>0){j.projectid=g.projectid}c[j.id]=j;h.push({projectid:j.projectid,taskid:j.taskid,parentprojectid:g.projectid,parenttaskid:g.taskid,starteddt:this._getTime(j.start_date),timeline:this._getTime(j.end_date),progress:j.progress});this._collectData(h,c,j.children,j)}},_sortPos:function(d){if(d==null||d.length==0){return}d.sort(function(f,g){return f.pos<g.pos?-1:1});for(var c=0;c<d.length;++c){this._sortPos(d[c].children)}},_getTime:function(c){if(typeof(c)=="number"){return c}else{if(typeof(c)=="object"){return c.getTime()}}return c},_getDate:function(d){var f=this._getTime(d);var c=new Date(f);return new Date(c.getFullYear(),c.getMonth(),c.getDate()).getTime()},convertToLocalTime:function(c){return c},updateProgress:function(){if(this.selecteddata==null){scil.Utils.alert("Please select the parent Project or Task first");return}var d=this.selecteddata;if(this.esttimelineDlg==null){var f=this;var c={estimatedtimeline:{label:"Estimated Timeline",type:"date"},progress:{label:"Progress",type:"number",unit:"%"},note:{label:"Note",type:"textarea",width:600,height:50}};this.esttimelineDlg=scil.Form.createDlgForm("Update Progress",c,{label:"Save",onclick:function(){f.updateProgress2()}})}this.esttimelineDlg.item=d;this.esttimelineDlg.show();this.esttimelineDlg.form.setData(d)},updateProgress2:function(){var g=this;var c=this.esttimelineDlg.form.getData();var f=this.esttimelineDlg.item;this.esttimelineDlg.hide();if(f.taskid>0){c.taskid=f.taskid;scil.pmf.ajax("task.setprogress",function(d){g.updateProgress3(d,f)},c,{showprogress:true})}else{if(f.projectid>0){c.projectid=f.projectid;scil.pmf.ajax("project.setprogress",function(d){g.updateProgress3(d,f)},c,{showprogress:true})}}},updateProgress3:function(d,c){c.starteddt=d.starteddt;c.estimatedtimeline=d.estimatedtimeline;c.progress=d.progress;this.redrawChart()},redrawChart:function(){this.gantt.reRenderChart();this.gantt=$("#"+this.parentdiv.id).data("ejGantt")},finish:function(h){if(this.selecteddata==null){scil.Utils.alert("Please select the parent Project or Task first");return}var c=this.selecteddata;if(this.finishDlg==null){var g=this;var f={starteddt:{label:"Started Date",type:"date"},finisheddt:{label:"Finished Date",type:"date"},note:{label:"Note",type:"textarea",width:600,height:50}};this.finishDlg=scil.Form.createDlgForm("Finish",f,{label:"Save",onclick:function(){g.finish2()}})}this.finishDlg.item=c;this.finishDlg.show();this.finishDlg.form.setData({starteddt:c.start_date,finisheddt:new Date().getTime()})},finish2:function(){var f=this.finishDlg.item;var c=this.finishDlg.form.getData();this.finishDlg.hide();this.finish3(f,c)},finish3:function(f,c){var g=this;if(f.taskid>0){c.taskid=f.taskid;scil.pmf.ajax("task.finish",function(d){g.finish4(d,f)},c,{showprogress:true})}else{if(task.projectid>0){c.projectid=f.projectid;scil.pmf.ajax("project.finish",function(d){g.finish4(d,f)},c,{showprogress:true})}}},finish4:function(d,c){c.status=d.status;c.start_date=d.starteddt;c.end_date=d.finisheddt}});scil.apply(scil.Page.Gantt,{__index:0,kYearWidth:"70%",kMaxProjectID:1000000000,kOneDayTicks:1000*60*60*24,kScales:["Day","Week","Month","Year"],__initialized:false,initLib:function(){if(this.__initialized){return}this.__initialized=true;if(typeof(ej)!="undefined"){ej.addCulture("zh_CN",{name:"zh-CN",englishName:"Chinese (Simplified, China)",nativeName:"中文(中华人民共和国)",language:"zh-CHS",numberFormat:{pattern:["-n"],",":",",".":".",groupSizes:[3],NaN:"非数字",negativeInfinity:"负无穷大",positiveInfinity:"正无穷大",percent:{pattern:["-n%","n%"],groupSizes:[3],",":",",".":".",symbol:"%"},currency:{pattern:["$-n","$n"],groupSizes:[3],",":",",".":".",symbol:"¥"}},calendars:{standard:{firstDay:1,days:{names:["星期日","星期一","星期二","星期三","星期四","星期五","星期六"],namesAbbr:["日","一","二","三","四","五","六"],namesShort:["日","一","二","三","四","五","六"]},months:{names:["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月",""],namesAbbr:["1月","2月","3月","4月","5月","6月","7月","8月","9月","10月","11月","12月",""]},AM:["上午","上午","上午"],PM:["下午","下午","下午"],patterns:{d:"yyyy/M/d",D:"yyyy'年'M'月'd'日'",t:"H:mm",T:"H:mm:ss",f:"yyyy'年'M'月'd'日' H:mm",F:"yyyy'年'M'月'd'日' H:mm:ss",M:"M'月'd'日'",Y:"yyyy'年'M'月'"}}}})}}});scil.Page.MyTable={searchers:{},searcher:null,querydata:null,formdata:null,oninit:null,kStructureSearchTypes:{"":"",full:"Full-Structure",sub:"Substructure",sim90:"Similarity - 90%",sim80:"Similarity - 80%",sim70:"Similarity - 70%"},kChartTypes:{"":"",clusteredcolumn:"Clustered Column",column:"Column",stackedcolumn:"Stacked Column",line:"Line",stackedline:"Stacked Line",area:"Area",stackedarea:"Stacked Area",pie:"Pie",scatter:"Scatter Plot",bubble:"Bubble",},init:function(h,j,c){if(typeof(j)=="string"){j={table:j}}if(j==null){j={}}var g=null;if(typeof(c)=="number"||typeof(c)=="string"){g=c}var f=this;this.querydata=j==null?{}:j;this.formdata=c;var d=this.querydata.table;this.callDef(d,this.querydata.category,function(l){f.init2(h,l,f.querydata.id,d,g)})},init2:function(n,l,f,g,j){if(l.accessdenied){if(typeof(n)=="string"){n=scil.byId(n)}scil.Utils.createElement(n,"div","Access Denied",{color:"red"});return}if(!scil.Utils.isNullOrEmpty(j)){this.querydata[l.key]=j}if(this.oninit!=null){this.oninit(l,f,g)}this.page=new scil.Page(n,l.tree,{resizable:l.resizable,leftwidth:l.leftwidth>0?l.leftwidth:320});if(l.mainlist!=false){this.list=this.page.addForm(this.getOptions(l),this.page.tree)}var q=l.tabs;if(q!=null&&q.length>0){this.tabs=this.page.addTabs({trackhistory:l.tracktabhistory});for(var d=0;d<q.length;++d){if(q[d].call){if(typeof(q[d].call)=="string"){switch(q[d].call){case"chart":this.addChart(this.tabs,this.list,g,l.charting);break;case"workflow":this.addWorkflow(this.tabs,this.list,g);break;case"log":this.addLog(this.tabs,this.list,g,l.key);break}}else{if(typeof(q[d].call=="function")){q[d].call(this.tabs,this.list)}}}else{var h=this;this.callDef2(q[d],function(t){h.tabs.addForm(h.getOptions(t),h.list)})}}}var c=scil.clone(this.querydata);this.list.refresh(null,c,true)},hasValue:function(c,g){if(c==null){return false}if(scil.Utils.isNullOrEmpty(c[g])){return true}var f=scil.Form.xml2Json(c.__advanced);return f!=null&&scil.Utils.isNullOrEmpty(f[g])},addForm:function(j,f,g,d,c){var h=this;var l=g==null?null:new scil.Page.MyTable.Receiver(g);this.callDef(f,d,function(q){if(q==null||q.oninit!=null&&q.oninit(q,h)=="stop"){return}var n=j.addForm(h.getOptions(q),null);if(l!=null){l.setForm(n)}if(c!=null){c(n)}})},addWorkflow:function(f,c){var d=this;this.sql=f.addForm({caption:"Workflow",type:"custom",oncreate:function(h,g){d.workflowparent=h},onrefresh:function(j,g,h){scil.Workflow.Request.clear(d.workflowparent);if(g.requestid!=null){scil.Workflow.Request.init(d.workflowparent,null,g.requestid)}}},c)},addChart:function(l,h,g,f){var c=f.buttons;if(c==null){c=[]}c.push("|");c.push({key:"by",label:"Chart-By",type:"select",items:f.byitems});c.push({key:"groupby",label:"Time-By",type:"select",items:["","week","month","quarter","year"]});c.push({key:"charttype",label:"Chart Type",type:"select",items:this.kChartTypes});var j=this;var d={cmd:"mytable."+g+".chart",title:"Chart"};d.stats=l.addForm({caption:"Chart",object:"mytable."+g+".chart",type:"custom",norefresh:false,buttons:c,onrefresh:function(q,n){j.refreshChart(d,n)}},h)},refreshChart:function(d,c){var g=d.stats.form.div;scil.Utils.removeAll(g);if(scil.Utils.isNullOrEmpty(c.by)||scil.Utils.isNullOrEmpty(c.charttype)){return}var f=scil.Utils.createElement(g,"div");new scil.Chart(f,{type:c.charttype,legend:true,animate:true,width:800,height:300,ymin:0,title:d.title,ajax:{url:"Ajax.ashx?cmd="+d.cmd,data:c}})},addLog:function(f,d,c,g){this.sql=f.addForm({caption:"Log",object:"mytable."+c+".log",onbeforerefresh:function(h){if(h!=null){h.dataid=h[g]}},columns:{logid:{label:"Log ID"},dataid:{label:"Data ID"},action:{label:"Action"},note:{label:"Note"},author:{label:"Author"},dt:{label:"Date",type:"date"},}},d)},callDef:function(g,f,d){var c=this.querydata==null?{}:scil.clone(this.querydata);c.category=f;var h=this;scil.Utils.ajax("ajax.ashx?cmd=mytable."+g+".def",function(j){h.callDef2(j,d)},c)},callDef2:function(options,callback){if(options==null||options==""){return}if(options.customjs!=null){try{eval(options.customjs)}catch(e){scil.Utils.alert("Error on Custom JS: "+e.message)}}if(options.oninit!=null){if(options.oninit(options,this)=="stop"){return}}callback(options)},showSearch:function(f,d,c){var g="ajax.ashx?cmd=mytable."+f+".def";this.search(g,d,c)},refresh:function(c){if(this.list!=null){this.list.refresh(null,c)}else{if(this.searcher!=null){this.searcher.refresh(c)}}},getOptions:function(c){if(c.columns!=null&&c.columns[c.key]!=null){c.columns[c.key].iskey=true}return c},search:function(g,d,c){this.searcher=this.searchers[g];if(this.searcher!=null){this.searcher.show(d);return}var f=this;scil.Utils.ajax(g,function(j){var h=f.getOptions(j);if(c!=null){scil.apply(h,c)}f.searcher=new scil.Page.Search(h);f.searchers[g]=f.searcher;f.searcher.show(d)})},popupJSDraw:function(f,d){var g=this;var d=d==null?this.list:d;var c=d.options.buttons;JSDraw2.Editor.showPopup("Draw Query","Done",function(h){scil.Form.setButtonValueByKey(c,f,h.getSmiles());d.refresh(null,null,null,null,true)})},showStructureSearch:function(c,g){if(this.ssDlg==null){var f=this;var d={m:{label:"Structure",type:"jsdraw",width:800,height:300},t:{label:"Search Type",type:"select",items:this.kStructureSearchTypes}};this.ssDlg=scil.Form.createFormDlg("Structure Search",d,{label:"Search",onclick:function(){f.structureSearch()}})}this.ssDlg._button=c;this.ssDlg.show();scil.Utils.getParent(this.ssDlg.form.fields.t,"TR").style.display=g=="All"?"":"none"},structureSearch:function(){var f=this.ssDlg._button.key;var d=this.ssDlg._button.form;var c=d.options.buttons;scil.Form.setButtonValueByKey(c,f,this.ssDlg.form.getXml());this.ssDlg.hide();d.refresh(null,null,null,null,true)}};scil.Page.MyTable.Receiver=scil.extend(scil._base,{constructor:function(c){this.form=null;this.cache=null;c.receivers.push(this)},setForm:function(c){this.form=c;if(this.cache!=null){this.form.refresh(this.cache.from,this.cache.args);this.cache=null}},refresh:function(d,c){if(this.form!=null){this.form.refresh(d,c)}else{this.cache={from:d,args:c}}},clear:function(){if(this.form!=null){this.form.clear()}}});scil.mytable={};scil.Page.MyTableBuilder={kCategories:["","System","Standard","Customization","Test"],kDataTypes:["","Text","Float","Long","Bool","Date","[user]","[created date]","[date]","[author]","[reference]","[tab]"],kDisplayTypes:["","input","number","checkbox","date","file","image","select","textarea","htmltext","html","table","jsdraw","jsdraw.se","jsdraw.table","signature","dropdowninput","editableselect","multiselect"],kFilterTypes:["","input","number","date","select","range","like","structure","helm"],kDisplays:["","Yes","No","Viewonly","Hidden"],kFilterDisplays:["","Yes","No","Hidden"],kFieldCategories:["","System","Standard","Customization"],kAggregates:{"":"","avg(?)":"Average","dbo.Median(?)":"Median","dbo.Mode(?)":"Mode","dbo.Range(?)":"Range","max(?)":"Max","min(?)":"Min","sum(?)":"Sum","count(?)":"Count","exp(avg(log(?)))":"Geometric Mean","dbo.Concat(?)":"List","dbo.ConcatDistinct(?)":"List Unique"},testCode:function(c){scil.Utils.ajax("ajax.ashx?cmd=mytable.mytablemanager.test",function(d){if(d.succeed){scil.Utils.alert("All good!")}else{scil.Utils.alert(d.error)}},{tableid:c.args.tableid})},addAPIs:function(f,c){var d=this;this.sql=f.addForm({caption:"APIs",type:"custom",norefresh:false,onrefresh:function(j,g,h){var l=c.table.getCurrentRowData();var q=scil.Utils.isNullOrEmpty(l.alias)?l.dbtable:l.alias;var t=window.location+"";p=t.lastIndexOf("/");t=t.substr(0,p+1);def=t+"ajax.ashx?cmd=mytable."+q+".def";t+="MyTable="+q;var n="";n+="URLs:\r\n";n+="---------------------\r\n";n+="   MyTable: <a target=_blank href='"+t+"'>"+t+"</a>\r\n";n+="   Definition: <a target=_blank href='"+def+"'>"+def+"</a>\r\n";n+="\r\n";n+="AJAX Commands:\r\n";n+="---------------------\r\n";n+="   - mytable."+q+".chart\r\n";n+="   - mytable."+q+".def\r\n";n+="   - mytable."+q+".del\r\n";n+="   - mytable."+q+".download\r\n";n+="   - mytable."+q+".import\r\n";n+="   - mytable."+q+".list\r\n";n+="   - mytable."+q+".listall\r\n";n+="   - mytable."+q+".load\r\n";n+="   - mytable."+q+".save\r\n";n+="   - mytable."+q+".update\r\n";n+="   - mytable."+q+".suggest\r\n";n+="\r\n";n+="Example AJAX Call:\r\n";n+="---------------------\r\n";n+="   scil.Utils.ajax('ajax.ashx?cmd=mytable."+q+".load', function (ret) {\r\n";n+="      alert(ret.projectcode); \r\n";n+="   }, {projectid: 122}\r\n";n+="\r\n";n+="Workflow Callback APIs:\r\n";n+="---------------------\r\n";n+="   - long SaveToMyTable(string mytablekey, string database, long primarykey)\r\n";n+="   - long SaveToMyTable(string mytablekey, string database, long primarykey, string key, object value)\r\n";n+="   - Database.Row ReadFromMyTable(string mytablekey, string database, long primarykey)\r\n";h.form.div.innerHTML="<pre>"+n+"</pre>"}},c)},addSQL:function(d,c){this.sql=d.addForm({caption:"SQL",type:"custom",norefresh:false,onrefresh:function(h,f,g){scil.Utils.ajax("ajax.ashx?cmd=mytable.mytablemanager.getsql",function(j){g.form.div.innerHTML="<pre>"+j+"</pre>"},{tableid:f.tableid})}},c)},addCS:function(f,c){var d=this;f.addForm({caption:"MyTable C#",type:"custom",buttons:[{src:"small/go2.png",title:"Test Code",onclick:function(h,g){d.testCode(g.form)}}],norefresh:false,onrefresh:function(j,g,h){scil.Utils.ajax("ajax.ashx?cmd=mytable.mytablemanager.getcs",function(l){h.form.div.innerHTML="<pre>"+l+"</pre>"},{tableid:g.tableid})}},c)},addJSDrawForm:function(f,c){var d=this;f.addForm({caption:"JSDraw Form",type:"custom",norefresh:false,onrefresh:function(j,g,h){scil.Utils.ajax("ajax.ashx?cmd=mytable.mytablemanager.getjsform",function(l){h.form.div.innerHTML="<pre>"+l+"</pre>"},{tableid:g.tableid})}},c)},addCustomJS:function(f,c){var d=this;f.addForm({caption:"Custom JavaScript",type:"form",object:"mytable.mytablemanager.customjs",editable:true,hidelabel:true,fields:{tableid:{type:"hidden"},customjs:{label:"Code",type:"textarea",width:800,height:400,mode:"javascript",allowhtml:true}}},c)},addCustomCode:function(f,c){var d=this;f.addForm({caption:"Custom C#",type:"form",object:"mytable.mytablemanager.customcode",editable:true,hidelabel:true,buttons:[{src:"small/go2.png",title:"Test Code",onclick:function(h,g){d.testCode(g.form)}},"-"],fields:{tableid:{type:"hidden"},fun:{label:"Override",type:"select",items:scil.Utils.getDictKeys(this.kOverrides),onchange:function(g,h){d.addOverride(h)}},customcode:{label:"Code",type:"textarea",width:800,height:400,mode:"c#",allowhtml:true}}},c)},addOverride:function(d){var f=d.fields.fun.value;var c=this.kOverrides[f];if(c!=null){d.fields.customcode.value+=c.replace(/[|]/g,"\r\n")}},importView:function(c){scil.Utils.prompt2({caption:"Import View",message:"Please type a database View",callback:function(d){scil.Utils.ajax("ajax.ashx?cmd=mytable.mytablemanager.import.view",function(f){if(f.rows!=null&&f.rows.length==1){c.table.addRow(f.rows[0])}else{c.refresh()}},{tableid:c.args.tableid,view:d})}})},showOnSave:function(c){c.value="delegate (UserDB db, long id, Database.Row r, Database.Row input, Field f)\r\n{\r\n  return true;\r\n}"},onEditField:function(c,d){var f=d.table.getRowDataByKey(c.fieldid);if(f.locked){scil.Utils.alert("Locked item cannot be edited");return"stop"}},changeFieldOrder:function(c){var d=this;scil.Utils.ajax("ajax.ashx?cmd=mytable.mytablebuilder.listcols",function(f){d.changeFieldOrder2(c,f)},{tableid:c.args.tableid})},changeFieldOrder2:function(d,g){if(this.orderDlg==null){var f=this;var c={list:{type:"table",viewonly:true,draggable:true,columns:{fieldid:{type:"hidden"},move:{label:"Move",type:"html",template:"<div style='cursor:move;background:url(img/reorder.gif) no-repeat center'>&nbsp;</div>"},label:{label:"Label"},dbkey:{label:"dbkey"},list:{label:"List"},edit:{label:"Edit"}}}};this.orderDlg=scil.Form.createDlgForm("Change Order",c,{label:"Save",onclick:function(){f.changeFieldOrder3(d)}},{hidelabel:true})}this.orderDlg.show();this.orderDlg.form.setData({list:g})},changeFieldOrder3:function(c){var f=this;var h="";var g=this.orderDlg.form.fields.list.jsd.getData();for(var d=0;d<g.length;++d){h+=g[d].fieldid+","}scil.Utils.ajax("ajax.ashx?cmd=mytable.mytablebuilder.saveposition",function(){f.orderDlg.hide();c.refresh()},{tableid:c.args.tableid,fieldids:h})},kOverrides:{CheckPermision:"|protected override void CheckPermision(UserDB db, Action action)|{|    base.CheckPermision(db, action);|}|",GetListCols:"|protected override string GetListCols(Action action)|{|    return base.GetListCols(action);|}|",GetSortBy:"|protected override string GetSortBy(UserDB db, Database.Row args)|{|    return base.GetSortBy(db, args);|}|",ListSql:"|protected override string ListSql(UserDB db, long id, Database.Row args, Scilligence.MolEngine.Common.Pair<string, string> paging, Action action)|{|    return base.ListSql(db, id, args, paging, action);|}|",OnAfterSave:"|protected override void OnAfterSave(UserDB db, long id, Database.Row r, bool isnew)|{|    base.OnAfterSave(db, id, r, isnew);|}|",OnCustomCmd:"|protected override bool OnCustomCmd(UserDB db, string cmd, System.IO.TextWriter w, System.Collections.Specialized.NameValueCollection items, out bool ret)|{|    return base.OnCustomCmd(db, cmd, w, items, out ret);|}|",OnImportFile:"|protected override Database.Row[] OnImportFile(UploadedFile file, Database.Row args)|{|    return base.OnImportFile(file, args);|}|",OnSave:"|protected override bool OnSave(UserDB db, long id, Database.Row r)|{|    return base.OnSave(db, id, r);|}|",OnWriteDef:"|protected override void OnWriteDef(UserDB db, string category, bool mollist)|{|    base.OnWriteDef(db, category, mollist);|}|",SqlFilter:"|protected override string SqlFilter(UserDB db, Database.Row args)|{|    return base.SqlFilter(db, args);|}|",TreeSql:"|protected override string TreeSql(UserDB db)|{|    return base.TreeSql(db);|}|"}};scil.Page.MolList={fullscreen:true,init:function(h,f,d,c){var g=this;this.object=f;scil.Utils.ajax("ajax.ashx?cmd=mytable."+f+".def",function(j){g.init2(h,j,d)},{category:c,mollist:true})},init2:function(h,g,f){if(g.oninit!=null){g.oninit(g,this)}var l=this.getOptions(g.tree,g);this.page=new scil.Page(h,l,{resizable:true,leftwidth:g.leftwidth>0?g.leftwidth:320});var j=g.tabs;if(j!=null&&j.length>0){this.tabs=this.page.addTabs();for(var d=0;d<j.length;++d){this.tabs.addForm(this.getOptions(j[d],g),this.page.table)}}else{this.page.addForm(this.getOptions(g.details,g),this.page.table)}scil.Page.MyTable.list=this.page.table;var c=null;if(f!=null){c[g.key]=f}this.page.table.refresh(null,c,true);if(g.fullscreen!=null){this.fullscreen=g.fullscreen}if(this.fullscreen){this.page.fillscreen()}},refresh:function(c){if(this.page.table!=null){this.page.table.refresh(null,c)}},getOptions:function(c,d){if(c.columns!=null&&c.columns[c.key]!=null){c.columns[c.key].iskey=true}if(d!=null){if(c.object==null){c.object=d.object}if(c.key==null){c.key=d.key}if(c.caption==null){c.caption=d.caption}}return c}};scil.Page.Search=scil.extend(scil._base,{constructor:function(d){this.dlg=null;this.callback=null;this.options=d;var c=scil.Utils.createElement(null,"div");this.dlg=new scil.Dialog("",c);this.dlg.show("Search "+(d.caption||d.formcaption));this.init(this.dlg,d)},show:function(c){this.dlg.show();this.callback=c},init:function(f,d){var c=this;scil.apply(this.options,{issearch:true,pushleft:false,onsearchselect:function(g){c.onsearchselect(g)},onrefreshed:function(){c.onrefreshed()}});this.page=new scil.Page(f,null);this.list=this.page.addForm(d,null);this.list.refresh()},refresh:function(c){this.list.refresh(null,c)},onsearchselect:function(c){this.dlg.hide();if(this.callback!=null){this.callback(c)}},onrefreshed:function(){if(this.dlg!=null&&!this.moved){this.moved=true;this.dlg.moveCenter()}}});scil.Page.Html=scil.extend(scil._base,{constructor:function(g,f,h){var d=this;this.refreshneeded=true;this.page=g;this.options=f;this.receivers=[];this.ajaxurl=this.options.ajaxurl==null?"ajax.ashx?cmd=":this.options.ajaxurl;var c=[];if(f.norefresh==false){c.push({src:scil.App.imgSmall("refresh.png"),title:"Refresh",onclick:function(){d.refresh()}})}if(this.options.buttons!=null){c=c.concat(this.options.buttons)}this.form=new scil.Page.ExplorerForm(h,this,{buttons:c});this.form.host=this},show:function(){this.form.show()},hide:function(){this.form.hide()},refresh:function(d,c){if(c!=null){this.args=c}if(!this.form.isVisible()||!this.form.isExpanded()){this.refreshneeded=true;return}if(scil.Utils.isDictEmpty(this.args)){return}this.form.div.innerHTML="";var f=this;this.refreshneeded=false;var g=this.args;if(g==null){g={}}if(f.options.onbeforerefresh!=null){f.options.onbeforerefresh(g)}scil.Utils.ajax(this.ajaxurl+this.options.object+".load",function(h){var j=null;if(typeof(h)=="string"){j=h}else{j=h.html}f.form.div.innerHTML=j==null?null:j},g)},clear:function(){this.form.div.innerHTML=""}});scil.Page.Query=scil.extend(scil._base,{constructor:function(){},show:function(c){this.button=c;this.create(this.button.fields);this.dlg.show();var h=this.button.key;var g=this.button.form;var d=g.options.buttons;var f=scil.Form.getButtonValueByKey(d,h);this.dlg.form.setXml(f)},create:function(d){if(this.dlg!=null){return}var g=this;var c=[{label:"Search",onclick:function(){g.search()}}];if(this.button.savequery!=null){c.push(" ");var f=this.button.form;var h=this.button.savequery;c.push({label:"Query",items:[],onclick:function(l,j){scil.Page.ToolbarQuery.selectQuery(f,h,l,j,g)},onshowdropdown:function(j){return scil.Page.ToolbarQuery.onshowdropdown(h,j)}})}this.dlg=scil.Form.createDlgForm("Advanced Query",d,c)},search:function(){var f=this.button.key;var d=this.button.form;var c=d.options.buttons;scil.Form.setButtonValueByKey(c,f,this.dlg.form.getXml());this.dlg.hide();d.refresh()},clear:function(){this.dlg.form.clear()},getQueryValues:function(){return this.dlg.form.getData()},setQueryValues:function(c){return this.dlg.form.setData(c)}});scil.apply(scil.Page.Query,{queries:{},show:function(c){var d=this.queries[c.queryid];if(d==null){d=new scil.Page.Query();this.queries[c.queryid]=d}d.show(c)}});scil.Page.ToolbarQuery={onshowdropdown:function(f,c){if(c.options.items.length>0){return}scil.Utils.ajax("ajax.ashx?cmd=mytable.toolbarquery.list",function(h){var g=[];g.push({label:"Save Query",key:"[save]"});g.push({label:"Clear Values",key:"[clear]"});if(h.rows!=null&&h.rows.length>0){g.push({label:"Manage Queries",key:"[manage]"});g.push("-");for(var d=0;d<h.rows.length;++d){g.push({label:h.rows[d].name,key:h.rows[d].queryid})}}c.resetItems(g);c.show2()},{place:f});return"cancel"},selectQuery:function(form,place,key,button,query){var me=this;if(key=="[save]"){this.saveQuery(form,place,button,query)}else{if(key=="[clear]"){this.setQueryValues(form);if(query!=null){query.clear()}form.refresh()}else{if(key=="[manage]"){this.showDlg(place,button)}else{scil.Utils.ajax("ajax.ashx?cmd=mytable.toolbarquery.load",function(ret){var args=scil.Utils.eval(ret.data);me.setQueryValues(form,args,query);form.refresh()},{queryid:key})}}}},saveQuery:function(f,g,c,h){var d=this.getQueryValues(f,h);var j=scil.Utils.json2str(d);scil.Utils.prompt2({caption:"Save Query",message:"Please enter a name for this query",autosuggesturl:"ajax.ashx?cmd=mytable.toolbarquery.suggestname&place="+escape(g),callback:function(l){scil.Utils.ajax("ajax.ashx?cmd=mytable.toolbarquery.save",function(n){c.jsd.resetItems([])},{name:l,data:j,place:g})}})},getQueryValues:function(g,l){if(l!=null){return l.getQueryValues()}var f=g.options.buttons;if(f==null){return null}var j=[];var c={};for(var h=0;h<f.length;++h){var d=f[h];if(d!=null&&!scil.Utils.isNullOrEmpty(d.key)){j.push(d.key)}}scil.Form.getButtonValuesByKey(f,j,c);return c},setQueryValues:function(g,c,j){if(j!=null){j.setQueryValues(c)}var f=g.options.buttons;if(f==null){return}if(c==null){c={}}for(var h=0;h<f.length;++h){var d=f[h];if(d!=null&&!scil.Utils.isNullOrEmpty(d.key)){scil.Form.setButtonValueByKey(f,d.key,c[d.key])}}},showDlg:function(f,c){var d=this;this.button=c;scil.Utils.ajax("ajax.ashx?cmd=mytable.toolbarquery.list",function(g){d.showDlg2(g.rows)},{place:f})},showDlg2:function(f){if(this.dlg==null){var c={table:{type:"table",viewonly:true,rowcheck:true,columns:{queryid:{label:"QueryID",width:100,iskey:true},name:{label:"Name",width:300}}}};var d=this;this.dlg=scil.Form.createDlgForm("Manage Queryies",c,{label:"Delete Selected",onclick:function(){d.delSelected()}},{hidelabel:true})}this.dlg.show();this.dlg.form.setData({table:f})},delSelected:function(){var d=this;var c=this.dlg.form.fields.table.jsd.getCheckedKeys();scil.Utils.ajax("ajax.ashx?cmd=mytable.toolbarquery.delmany",function(f){d.button.jsd.resetItems([]);d.dlg.hide()},{_keys:scil.Utils.array2str(c)})}};scil.History={disabled:false,state:null,append:function(d,g,f){if(!this.disabled&&history!=null){var c=history.state==null?{}:history.state;c[d]=g;history.pushState(c,null,f==null?"":f)}},update:function(d,g,f){if(!this.disabled&&history!=null){var c=history.state==null?{}:history.state;c[d]=g;history.replaceState(c,null,f==null?"":f)}},get:function(c){return this.disabled||history==null||history.state==null?null:history.state[c]}};scil.connect(window,"onpopstate",function(c){scil.History.state=c.state});scil.Workflow={notefield:{label:"Note",type:"textarea",width:500,height:50},dlg:null,options:{roles:["","(manager)","(admin)","(assignee)","(assignee.manager)","(requestor)","(anyone)","(script)","(subrequest)","(authorized-user)","(authorized-field)"],actions:["","Approve","Assign","Process","Finish","Close","(Script)","Parallel","Wait","Sub"],statuses:["","Draft","New","Approved","Assigned","Processing","Finished","Closed"],requesturl:"Request.aspx",ajaxurl:"Ajax.ashx",downloadurl:null,downloadpdfurl:"Download.ashx"},createAction:function(parent,cmd,requestid,request,ext){var me=this;var disabled=false;var color="";var args={label:cmd};if(ext!=null&&ext.externalaction){var fun=scil.Utils.isNullOrEmpty(ext.externalscript)?null:scil.Utils.eval("function(cmd,requestid,request){"+ext.externalscript+"}");if(fun!=null){args.label="&rarr;"+cmd;args.onclick=function(){fun(cmd,requestid,request)}}else{disabled=true;color="gray"}}else{args.onclick=function(){me.doAction(cmd,requestid,request)}}if(scil.Workflow.Request.onCreateAction!=null){scil.Workflow.Request.onCreateAction(args,request,ext)}var b=scil.Utils.createButton(parent,args);b.disabled=disabled;b.style.color=color},doAction:function(c,g,f){var d=this;if(scil.Workflow.Request.ondoaction!=null&&scil.Workflow.Request.ondoaction(c,g,f)=="cancel"){return}scil.Utils.ajax(scil.Workflow.options.ajaxurl+"?cmd=workflow.loadaction",function(h){d.doAction2(c,g,h,f)},{action:c,requestid:g})},doAction2:function(cmd,requestid,ret,request){var me=this;var items={};var obj=null;if(ret!=null&&cmd!="Reject"){obj=typeof(ret.subform)=="string"?scil.Utils.eval(ret.subform):ret.subform}if(obj!=null){scil.apply(items,obj)}if(items.assignee!=null){items.assignee.autosuggesturl=scil.Workflow.options.ajaxurl+"?cmd=user.suggest"}var onchange=null;var buttons=[{label:cmd,onclick:function(){me.doAction3(cmd,requestid,request,null,items.onsubmit)}}];if(!scil.Utils.isDictEmpty(items)){buttons.push(" ");buttons.push({label:"Save for Later",type:"a",onclick:function(){me.doAction3(cmd,requestid,request,true)}});var res=scil.Workflow.Request;onchange=function(field,form,args,cmd){if(res.onSubFormChanged!=null&&me.cmd!=null){res.onSubFormChanged(field,form,args,me.cmd,scil.workflow.Request.formid)}if(items.onchange!=null){items.onchange(field,form,args)}}}if(this.notefield!=null){scil.apply(items,{__notes:this.notefield})}scil.apply(items,{requestid:{type:"hidden"}});if(scil.Workflow.Request.onCreateSubForm!=null){scil.Workflow.Request.onCreateSubForm(items,buttons,cmd,scil.workflow.Request.formid)}this.dlg=scil.Form.createDlgForm(cmd+" Request",items,buttons,{onchange:onchange});var data=request==null||request.form==null?null:request.form.getData();if(data==null){data={}}data.requestid=requestid;for(var k in items){var f=items[k];if(f.value=="{me}"&&scil.Project.user!=null){data[k]=scil.Project.user.fullname}else{if(f.value=="{date}"||f.value=="{today}"){data[k]=scil.Utils.dateStr(new Date(),true,f.format)}else{if(f.value!=null){data[k]=f.value}}}}this.dlg.form.setData(data,true);this.cmd=cmd;if(scil.Workflow.Request.onShowSubForm!=null){scil.Workflow.Request.onShowSubForm(this.dlg.form,data,cmd,scil.workflow.Request.formid)}if(items.onshowform!=null){items.onshowform(this.dlg.form,data,cmd)}},doAction3:function(c,l,j,n,h){if(this.dlg.form.checkRequiredFields()>0){scil.Utils.alert("Some required field(s) are blank");return}var d=this.dlg.form.getData(true);for(var f in d){if(d[f]==null){d[f]=""}}d.action=c;d.requestid=l;var g=this;if(!n&&h!=null){h(d,j,n)}else{g.doAction4(d,j,n)}},doAction4:function(c,f,g){var d=this;scil.Utils.ajax(scil.Workflow.options.ajaxurl+"?cmd=workflow."+(g?"saveaction":"doaction"),function(h){d.dlg.hide();if(f!=null){f.reload()}else{window.location.reload()}},c,{showprogress:true})},escQueryValue:function(c){return c==null?"":c.replace(/[\=]/g,"%3D").replace(/[\&]/g,"%26")},dict2querystring:function(d){var c=null;if(d!=null){for(var f in d){if(c==null){c=""}else{c+="&"}c+=f+"="+this.escQueryValue(d[f])}}return c}};scil.workflow=scil.Workflow;scil.Workflow.Form={kGroupForm:true,sampleworkflow:"<div version='1.3' class='JSDraw' app='JSDraw V3.2.3' style='width:800px;height:380px;'><i i='1' x='SHAPE' type='ellipse' p='10.680 -8.740 2.280 2.280' from='4'>New</i><i i='2' x='SHAPE' type='rectangle' p='15.680 -8.520 5.120 1.840' from='1' outputstatus='Closed' reject='4' userrole='(anyone)'>Close</i><i i='3' x='SHAPE' type='ellipse' p='23.640 -8.740 2.640 2.280' from='2'>Closed</i><i i='4' x='SHAPE' type='ellipse' p='5.720 -8.700 2.880 2.200'>Draft</i></div>",init:function(d,c){var g={caption:"Forms",key:"name",name:"category",object:"workflow.form",root:{name:"Forms",icon:scil.App.imgSmall("categories.png"),leaf:false}};this.page=new scil.Page(d,c>0?null:g);this.forms=this.page.addForm(this.tableForm(),this.page.tree);var f=this.page.addTabs();this.addDetails(f,this.forms);this.addHistortyList(f,this.forms)},addDetails:function(d,c){this.detail=d.addForm({type:"form",caption:"Form Detail",object:"workflow.form",fields:this.getFields(false)},c)},addHistortyList:function(d,c){this.history=d.addForm({type:"table",caption:"Form History",object:"workflow.form.history",columns:{historyid:{label:"History ID"},dt:{label:"Date",type:"date"},author:{label:"Author"}}},c)},tableForm:function(){var c=this;return{caption:"Forms",key:"formid",object:"workflow.form",columns:{formid:{label:"Form ID",iskey:true,width:80},category:{label:"Category",width:120},name:{label:"Display Name",width:400},internalname:{label:"Internal Name",width:100},owner:{label:"Owner",width:100},requests:{label:"Requests",width:60},active:{label:"Active",type:"checkbox"}},formcaption:"Form Definition",onbeforesave:function(d){return c.getUserKeys(d)},usetabs:true,fields:this.getFields(true)}},getFields:function(l){var g=this;var h=scil.User.options==null?[]:scil.User.options.roles;var j=scil.clone(h);j.push("(anyone)");j.push("(projectmanager)");j.push("(projectmember)");j.push("(projectreader)");var f={formid:{type:"hidden"},category:{label:"Category",width:300},name:{label:"Display Name",width:800},internalname:{label:"Internal Name",width:300},form:{label:"Form",type:l?"code":"textarea",mode:"javascript",width:800,height:150,button:[{label:"Designer",onclick2:function(n){g.showDesigner(n)}},{label:"Test Script",onclick2:function(n){g.testFormJS(n)}}],str:"(Use <u>F11</u> to enter/exit full-screen mode)"},script:{label:"Script",type:l?"code":"textarea",mode:"javascript",width:800,height:80,button:{label:"Test Script",onclick2:function(n){g.testFormJS(n)}},str:"(Use <u>F11</u> to enter/exit full-screen mode)"},workflow:{label:"Workflow",type:"jsdraw",options:{fullscreen:true,width:800,height:240,workflow:true}},active:{label:"Active",type:"checkbox"}};var c={recurrence:{label:"Recurrence",type:"select",items:["","Yearly","Quarterly","Monthly"]},hastimeline:{label:"Has Timeline",type:"checkbox"},maxrequestsperday:{label:"Max Requests/Day",type:"number"},sendemail:{label:"Sending Email",type:"checkbox"},createroles:{label:"Creating Roles",type:"multiselect",items:h,width:300,str:"(Anyone can create it by default)"},viewroles:{label:"Viewing Roles",type:"multiselect",items:j,width:300,str:"(Project Reader can view it by default)"},owner:{label:"Owner",width:300,autosuggesturl:"ajax.ashx?cmd=user.suggest"},summaryfields:{label:"Summary Fields",width:800},downloadable:{label:"Download PDF",type:"checkbox"},deletable:{label:"Deletable",type:"checkbox"},pdfrender:{label:"PDF Render",width:800},requestno:{label:"Request No",width:200,str:" e.g. scino->SCI-yyyymmdd-###"},populatetable:{label:"Populate to Table",width:200},populatekey:{label:"Populating Primary Key",width:200},populatestatuses:{label:"Populating Statuses",width:200},populatefields:{label:"Populating Fields",width:800},populateiteratefield:{label:"Populating Iterate Table",width:800},copyto:{label:"Copy To",type:"table",columns:{internalname:{label:"Destination Form",width:120},fields:{label:"Fields to Be Copied",width:660}}}};if(l){return{general:{caption:"General",fields:f},advanced:{caption:"Advanced",fields:c}}}else{var d=scil.clone(f);scil.apply(d,c);return d}},getUserKeys:function(data){if(scil.Utils.isNullOrEmpty(data.form)){return}var d;try{eval("d="+data.form)}catch(e){scil.Utils.alert("Failed to parse the javascript form: "+e);return false}if(d==null){scil.Utils.alert("Failed to parse the javascript form");return false}var userkeys=null;for(var k in d){var field=d[k];if(field==null){continue}if(field.type=="user"){if(userkeys==null){userkeys=k}else{userkeys+=","+k}}}data.userkeys=userkeys},showDesigner:function(c){scil.FormDesigner.show(c.jsd.getValue(),function(d){c.jsd.setValue(d)})},testFormJS:function(field){var s=field.jsd.getValue();if(scil.Utils.isNullOrEmpty(s)){return}try{eval("var temp="+s);scil.Utils.alert("Test Passed")}catch(e){scil.Utils.alert("ERROR: "+e)}},combine:function(items,json){if(scil.Utils.isNullOrEmpty(json)){return items}if(items==null){items={}}eval("var items2="+json);if(items2!=null){if(scil.Workflow.options!=null){for(var k in items2){if(items2[k].type=="file"){items2[k].options=scil.apply({uploadurl:scil.Workflow.options.uploadurl,downloadurl:scil.Workflow.options.downloadurl,onpreview:scil.Workflow.options.preview==null?null:function(d){scil.Workflow.options.preview(d.fileid)}},items2[k].options)}else{if(items2[k].type=="image"){items2[k].options=scil.apply({uploadurl:scil.Workflow.options.uploadurl,downloadurl:scil.Workflow.options.downloadurl},items2[k].options)}}}}if(!scil.Utils.isDictEmpty(items2)){if(this.kGroupForm){scil.apply(items,{formbody:{label:"Form",type:"group"}})}scil.apply(items,items2)}}return items}};scil.Workflow.Request={sysstatus:{Cancelled:-2,Closed:-1,Draft:0,New:1},parent:null,form:null,formid:null,requestid:null,kColorFinish:"#093",kColorFinish2:"#061",kColorNext:"#b90",kColorRed:"#900",dlg:null,dlgdiv:null,refreshargs:null,copying:false,kDefaultWidth:800,autohiderows:false,onbeforesave:null,onLoad:null,onMainFormChanged:null,onSubFormChanged:null,onBeforeAction:null,onrendered:null,onformcreated:null,onRenderForm:null,onCreateAction:null,init:function(j,g,l,f,c,d){var h=this;this.data=d;this.copying=c;this.refreshargs={parent:j,formid:g,requestid:l,edit:f};if(this.onLoad!=null){if(this.onLoad(this)){return}}scil.ready(function(){h.reload(false)})},reload:function(d){if(this.refreshargs==null){return}if(d==null){d=true}var c=this;scil.Utils.ajax(scil.Workflow.options.ajaxurl+"?cmd=workflow.request.load",function(f){c.render(c.refreshargs.parent,f,c.refreshargs.edit);if(c.onrendered!=null){c.onrendered(c)}},{formid:this.refreshargs.formid,requestid:this.refreshargs.requestid,copy:this.copying},{showprogress:d})},showDlg:function(d,c){this.createDlg();this.dlg.show(d.requestid>0?"Request #"+d.requestid:"New Request");if(this.dlg.form!=null){this.dlg.form.destory()}this.render(this.dlgdiv,d,false);this.dlg.moveCenter()},createDlg:function(){if(this.dlg!=null){return}this.dlgdiv=scil.Utils.createElement(document.body,"div");this.dlg=new scil.Dialog(null,this.dlgdiv);this.dlg.show()},clear:function(){scil.Utils.removeAll(this.parent)},render:function(parent,ret,edit){this.parent=typeof(parent)=="string"?scil.byId(parent):parent;this.ret=ret;scil.Utils.removeAll(this.parent);var form=null;if(ret!=null){form=ret.requestid==null?ret:ret.form}if(this.copying){ret.requestid=null}if(form==null){this.parent.innerHTML="<table style='border:solid 1px red;' align='center'><tr><td style='padding:20px;color:red;'>Invalid Form</td></tr></table>";return false}else{if(ret.edit&&(!(ret.requestid>0)||this.copying)&&form.cancreate==false){this.parent.innerHTML="<table style='border:solid 1px red;' align='center'><tr><td style='padding:20px;color:red;'>You don't have role to create requests using this form: "+form.name+"</td></tr></table>";return false}}this.workflowform=form;var tbody=scil.Utils.createTable(this.parent,0,0);this.formid=form.formid;this.requestid=ret.requestid;var editable=ret.requestid==null||edit!=null&&ret.edit;this.refreshargs={parent:parent,formid:this.formid,requestid:this.requestid,edit:editable};this.isnew=editable&&!(ret.requestid>0);var formname=form.name;if(form.formid>0){formname="<a href='Requests.aspx?formid="+form.formid+"'>"+scil.Utils.escXmlValue(formname)+"</a>"}var me=this;var s=null;if(this.requestid==null){s=scil.Lang.res("New")+" "+formname}else{if(ret.requestno!=null){s=formname+" "+ret.requestno}else{s=formname+" #"+this.requestid}}scil.Utils.createElement(scil.Utils.createTD(tbody),"h2",s);if(ret.workflow!=false){var box=scil.Utils.createCenterBox(scil.Utils.createTD(tbody));scil.apply(box.style,{border:"solid 1px #aaa",background:"#fafafa",padding:"10px",borderRadius:"5px"});scil.Utils.getParent(box,"TABLE").style.marginBottom="15px";var ht=this.calcHeight(ret.workflow);var div=scil.Utils.createElement(box,"div",null,{border:"solid 1px gray"});this.workflow=new JSDraw2.Editor(div,{workflow:true,viewonly:true,width:this.kDefaultWidth,height:ht>120?ht:120});this.workflow.setXml(ret.workflow);if(!this.copying&&this.markProgress(this.workflow.m,ret)){this.workflow.redraw()}if(!editable){var div=scil.Utils.createElement(box,"div",null,{border:"solid 1px gray",width:this.kDefaultWidth});new scil.Workflow.History(new scil.Page(div,null,null,false),null,"1px",false,this.requestid)}}var totalworkdays=null;var leading={};if(this.requestid>0){leading={__controls:{type:"div",autohide:false}};if(form.hastimeline){scil.apply(leading,{controlheader:{label:"Control Information",type:"group"},requestor:{label:"Requestor",viewonly:true},created:{label:"Created Date",type:"date",viewonly:true},startdate:{label:"Started Date",type:"date",viewonly:true},finishdate:{label:"Finished Date",type:"date",viewonly:true},timeline:{label:"Required Finish Date",type:"date"},expectedfinishdate:{label:"Expected Finish Date",type:"date",viewonly:true},workdays:{label:"Required Work Days",viewonly:true},delaydays:{label:"Delay Days",viewonly:true},status:{label:"Status",viewonly:true}})}}else{if(form.hastimeline){leading={controlheader:{label:"Control Information",type:"group"},workdays:{label:"Required Work Days",viewonly:true,unit:JSDraw2.Language.res("days")},estimatedfinishdate:{label:"Estimated Finish Date",type:"date",viewonly:true,str:JSDraw2.Language.res(", if starting today")},timeline:{label:"Required Finish Date",type:"date"}}}}var items=scil.Workflow.Form.combine(leading,form.form);if(items.projectcode!=null){items.projectcode.autosuggesturl=scil.Workflow.options.ajaxurl+"?cmd=project.suggest"}if(items.taskcode!=null){items.taskcode.autosuggesturl=scil.Workflow.options.ajaxurl+"?cmd=projecttask.suggest";items.taskcode.options={onsuggest:function(args,form){args.projectcode=form.fields.projectcode.value}}}if(this.isnew){for(var k in items){if(items[k]!=null&&items[k].showlater){items[k]=null}}}if(this.onRenderForm!=null){this.onRenderForm(items,editable,this)}var me=this;this.form=new scil.Form({viewonly:!editable,autohiderows:this.autohiderows,onchange:!editable?null:function(field,form,args){if(me.onMainFormChanged!=null){me.onMainFormChanged(field,form,args)}if(items.onchange!=null){items.onchange(field,form,args)}}});this.form.render(scil.Utils.createTD(tbody),items,{immediately:true});this.form.preventUnsaved();if(this.onformcreated!=null){this.onformcreated(this)}var d=scil.Utils.createElement(scil.Utils.createTD(tbody),"div",null,{marginTop:"20px"});if(editable){scil.Utils.createButton(d,{label:"Save Draft",onclick:function(){me.save("Draft",items)}});scil.Utils.createButton(d,{label:"Submit Request",onclick:function(){me.save("New",items)}});if(!this.isnew){scil.Utils.createElement(d,"span","&nbsp;");scil.Utils.createButton(d,{label:"Cancel Request",onclick:function(){me.save("Cancelled",items)}});scil.Utils.createElement(d,"span","&nbsp;");scil.Utils.createButton(d,{label:"View Request",url:scil.Workflow.options.requesturl+"?requestid="+this.requestid})}}else{if(ret.edit){scil.Utils.createButton(d,{label:"Edit",url:scil.Workflow.options.requesturl+"?edit=1&requestid="+this.requestid})}}if(ret.changetimeline){scil.Utils.createButton(d,{label:"Change Timeline",onclick:function(){me.changeTimeline()}})}if(!editable){if(ret.downloadable){scil.Utils.createElement(d,"span","&nbsp;");scil.Utils.createButton(d,{label:"Download PDF",target:"_blank",url:scil.Workflow.options.downloadpdfurl+"?topic=request.downloadpdf&requestid="+this.requestid})}if(!this.copying){scil.Utils.createElement(d,"span","&nbsp;");var url=scil.Workflow.options.requesturl+"?edit=1&copyrequest=1&requestid="+this.requestid+"&formid=";if(ret.copyto!=null){var items=[{label:"Copy",url:url+this.formid}];for(var k in ret.copyto){items.push({label:"Copy to "+k,url:url+ret.copyto[k]})}scil.Utils.createButton(d,{label:"Copy",items:items})}else{scil.Utils.createButton(d,{label:"Copy",url:url+this.formid})}}}if(!editable&&ret.sendemail){scil.Utils.createElement(d,"span","&nbsp;");scil.Utils.createButton(d,{label:"Send Email",onclick:function(){scil.Workflow.Email.show(me)}})}if(ret.candelete){scil.Utils.createElement(d,"span","&nbsp;");scil.Utils.createButton(d,{label:"Delete Request",onclick:function(){me.del()}})}if(ret.cancancel){scil.Utils.createElement(d,"span","&nbsp;");scil.Utils.createButton(d,{label:"Cancel Request",onclick:function(){me.cancelRequest()}})}if(ret.admin&&!editable){scil.Utils.createElement(d,"span","&nbsp;");scil.Utils.createButton(d,{label:"Overwrite Status",onclick:function(){me.setStatus()}})}if(ret.resetoperators&&!editable){scil.Utils.createElement(d,"span","&nbsp;");scil.Utils.createButton(d,{label:"Reset Opertors",onclick:function(){me.resetOperators()}})}var hascontrol=false;if(ret.doc!=null){this.form.setXml(ret.doc);this.form.setData(ret,true);if(this.form.fields.__controls!=null&&ret.actions!=null){for(var i=0;i<ret.actions.length;++i){var ext=this.getExternalAction(ret.actions[i],ret.seqids);scil.Workflow.createAction(this.form.fields.__controls,ret.actions[i],ret.requestid,this,ext);hascontrol=true}}}else{if(!this.copying&&this.isnew){this.form.setData(ret,true)}}if(this.copying&&ret!=null){for(var k in items){var item=items[k];if(item!=null&&(item.viewonly||item.notcopy)){this.form.setFieldValue(k,null)}}}if(this.isnew&&this.data!=null){var data=typeof(this.data)=="string"?scil.Utils.eval(this.data):this.data;if(data!=null){for(var k in data){this.form.setFieldValue(k,data[k])}}}if(!hascontrol&&this.form.fields.__controls!=null){scil.Utils.getParent(this.form.fields.__controls,"TR").style.display="none"}if(this.onShowMainForm!=null){this.onShowMainForm(this.form,this.data,this.copying,ret.form.formid)}if(items.onshowform!=null){items.onshowform(this.form,this.data,this.copying)}return true},getExternalAction:function(c,j){var f=this.workflow==null?null:this.workflow.m;if(f==null||j==null){return null}for(var d=0;d<j.length;++d){var h=j[d];var g=f.getObjectById(h);if(g!=null&&g.externalaction&&(g.text==c||g.reject!=null&&c=="Reject"||g.cancel&&c=="Cancel")){return{externalaction:g.externalaction,externalscript:g.externalscript}}}return null},calcHeight:function(g){var c=new JSDraw2.Mol();c.setXml(g);var d=c.rect();if(d==null){return 120}var f=d.height/d.width;if(f>120/this.kDefaultWidth){return Math.round(120*(f/(120/this.kDefaultWidth)))}return 120},changeTimeline:function(){if(this.timelineDlg==null){var d=this;var c={requestid:{type:"hidden"},oldtimeline:{label:"Old Timeline",type:"date",viewonly:true},timeline:{label:"New Timeline",type:"date",required:true},reason:{label:"Reason",type:"textarea",width:500,height:40,required:true}};this.timelineDlg=scil.Form.createDlgForm("Change Timeline",c,{label:"Change",onclick:function(){d.changeTimeline2()}})}this.timelineDlg.show();this.timelineDlg.form.setData({requestid:this.ret.requestid,oldtimeline:this.ret.timeline})},changeTimeline2:function(){var c=this;data=this.timelineDlg.form.getData();scil.Utils.ajax(scil.Workflow.options.ajaxurl+"?cmd=workflow.request.changetimeline",function(d){c.timelineDlg.hide();c.form.setFieldValue("timeline",data.timeline)},data,{showprogress:true})},save:function(f,d){if(f=="New"&&this.form.checkRequiredFields()>0){scil.Utils.alert("Some required field(s) are blank");return}if(f=="Cancelled"&&this.requestid==0){window.location=scil.Workflow.options.requesturl;return}var c={formid:this.formid,requestid:this.requestid,doc:this.form.getXml()};c.company=this.form.fields.company==null?null:this.form.fields.company.value;c.projectcode=this.form.fields.projectcode==null?null:this.form.fields.projectcode.value;c.taskcode=this.form.fields.taskcode==null?null:this.form.fields.taskcode.value;c.status=f;if(this.copying){c.requestid=null}if(this.onbeforesave!=null){if(!this.onbeforesave(c,this)){return}}if(d.onsubmit!=null){d.onsubmit(c,this)}else{this.saveRequest(c)}},saveRequest:function(c){var d=this;scil.Utils.ajax(scil.Workflow.options.ajaxurl+"?cmd=workflow.request.save",function(f){d.form.setDirty(false);window.location=scil.Workflow.options.requesturl+"?requestid="+f.rows[0].requestid},c,{showprogress:true})},cancelRequest:function(){var c=this;scil.Utils.confirmYes("Cancel this request?",function(){c.cancelRequest2()})},cancelRequest2:function(){var c=this;scil.Utils.ajax(scil.Workflow.options.ajaxurl+"?cmd=workflow.request.cancel",function(d){c.reload()},{requestid:this.requestid},{showprogress:true})},del:function(){var c=this;scil.Utils.confirmYes("Delete this request?",function(){c.del2()})},del2:function(){var c=this;scil.Utils.ajax(scil.Workflow.options.ajaxurl+"?cmd=workflow.request.del",function(d){scil.Utils.alert("This request is removed");c.clear()},{requestid:this.requestid},{showprogress:true})},resetOperators:function(){var c=this;scil.Utils.ajax(scil.Workflow.options.ajaxurl+"?cmd=workflow.request.listoperators",function(d){if(d!=null&&d.length>0){c.resetOperators2(d)}else{scil.Utils.alert("Not able to reset any operators")}},{requestid:this.requestid},{showprogress:true})},resetOperators2:function(f){var d=this;if(this.operatorDlg==null){var d=this;var c={requestid:{type:"hidden"},operators:{label:"Operators",type:"table",addrow:false,delrow:false,columns:{seqid:{type:"hidden"},action:{label:"Action",viewonly:true},operator:{label:"Current Operator",viewonly:true},setto:{label:"Set To",autosuggesturl:"ajax.ashx?cmd=user.suggest"}}},note:{label:"Note",type:"textarea",width:600,height:40}};this.operatorDlg=scil.Form.createDlgForm("Reset Operators",c,{label:"Reset",onclick:function(){d.resetOperators3()}})}this.operatorDlg.show();this.operatorDlg.form.setData({requestid:this.requestid,operators:f})},resetOperators3:function(){var c=this.operatorDlg.form.getData();scil.Utils.ajax(scil.Workflow.options.ajaxurl+"?cmd=workflow.request.resetoperators",function(d){window.location=scil.Workflow.options.requesturl+"?requestid="+c.requestid},c,{showprogress:true})},setStatus:function(){var c=this;scil.Utils.ajax(scil.Workflow.options.ajaxurl+"?cmd=workflow.request.liststatus",function(d){c.setStatus2(d)},{requestid:this.requestid},{showprogress:true})},setStatus2:function(f){var d=this;if(this.statusdlg==null){var c={requestid:{type:"hidden"},seqid:{label:"New Status",type:"select"},note:{label:"Note",type:"textarea",width:600,height:40}};this.statusdlg=scil.Form.createDlgForm("Set Status",c,{label:"Set",onclick:function(){d.setStatus3()}})}this.statusdlg.show();scil.Utils.listOptions(this.statusdlg.form.fields.seqid,f,null,true);this.statusdlg.statuses=f;this.statusdlg.form.setData({requestid:this.requestid})},setStatus3:function(){var c=this.statusdlg.form.getData();c.status=this.statusdlg.statuses[c.seqid];scil.Utils.ajax(scil.Workflow.options.ajaxurl+"?cmd=workflow.request.overwritestatus",function(d){window.location=scil.Workflow.options.requesturl+"?requestid="+c.requestid},c,{showprogress:true})},markProgress:function(l,n){if(l==null){return false}var f=n.history;if(f==null){f=[]}if(f.length>0&&f[f.length-1].shapeid!=n.shapeid){f.push({shapeid:n.shapeid,dt:n.finisheddate})}var j=null;var u={};startdate=new Date(n.startdate||n.created);if(n.status!="Draft"){for(var g=0;g<f.length;++g){var d=f[g];j=l.getObjectById(d.shapeid);if(j==null){continue}if(u[d.shapeid]==null){j.color=this.kColorFinish;u[d.shapeid]=j.workdays}else{j.color=this.kColorFinish2}if(j.text=="New"){j.timeline=scil.Utils.dateStr(startdate)}else{j.timeline=scil.Utils.dateStr(d.dt)}}}if(n.seqids!=null){for(var g=0;g<n.seqids.length;++g){var t=n.seqids[g];var q=l.getObjectById(t);if(q!=null){q.color=this.kColorFinish;q.textcolor="#ff0";q.fill="solid"}}}var c=n.delaydays;if(c!=null){if(c>0){c="+"+c}j.workdays=c;if(c>0){j.color=this.kColorRed}}return f.length>0},getTotalWorkDays:function(d){if(d==null){return null}var g=0;for(var c=0;c<d.graphics.length;++c){var f=JSDraw2.Shape.cast(d.graphics[c]);if(f!=null&&f.workdays>0){g+=f.workdays}}return g>0?g+JSDraw2.Language.res("days"):null}};scil.Workflow.History=scil.extend(scil._base,{constructor:function(f,h,d,c,g){this.requestid=g;this.history=f.addForm(this.tableHistryForm(d,c),h);this.history.form.title.style.borderTopLeftRadius=0;this.history.form.title.style.borderTopRightRadius=0},tableHistryForm:function(d,c,g){var f=this;this.buttons=["-",{type:"input",key:"author",label:"Author",autosuggesturl:"Ajax.ashx?cmd=user.suggest",styles:{width:100},onenter:function(){f.refresh()}},{type:"select",key:"sortby",items:["Time","Author"],label:"Sort By",onchange:function(){f.refresh()}},];var h={caption:"Workflow Log",key:"historyid",object:"workflow.history",buttons:this.buttons,onbeforerefresh:function(j){f.onbeforerefresh(j)},columns:scil.Workflow.History.columns,formcaption:"Add Comment",fields:{requestid:{type:"hidden"},notes:{label:"Notes",type:"textarea",width:500,height:60}},canedit:false,marginBottom:d,expanded:c,onexpand:function(j){f.onexpand(j)}};return h},refresh:function(){this.history.refresh()},onbeforerefresh:function(c){scil.Form.getButtonValuesByKey(this.buttons,["author","sortby"],c);c.requestid=this.requestid},onexpand:function(){if(this.requestid==null){return}this.history.refresh(null,{requestid:this.requestid});this.requestid=null}});scil.apply(scil.Workflow.History,{columns:{histryid:{type:"hidden"},action:{label:"Action",width:60},dt:{label:"Date",type:"date",width:100},fullname:{label:"User",width:100},notes:{label:"Notes",width:500}}});scil.Workflow.Email={dlg:null,templates:{},ajax:"ajax.ashx?cmd=sendemail.getemails",show:function(d){this.create();var c=this;var f=d==null?{}:this.collectPersons(d.form);scil.Utils.ajax(this.ajax,function(g){c.show2(d,g)},f)},show2:function(c,d){this.dlg.show();this.dlg.form.setData(c==null?{}:{requestid:c.requestid,attachment:true,to:d==null?null:d.contactemails,cc:d==null?null:d.useremails})},collectPersons:function(f){var l="";var d="";var c=f.getFieldValue("company");var j=f.getFieldValue("projectcode");for(var h in f.items){var g=f.items[h];if(g.autosuggesturl=="ajax.ashx?cmd=user.suggest"){l+=f.getFieldValue(h)+"|"}if(g.autosuggesturl=="ajax.ashx?cmd=contact.suggest"){d+=f.getFieldValue(h)+"|"}}return{users:l,contacts:d,company:c,projectcode:j}},send:function(){var c=this;scil.Utils.confirmYes("Please confirm it before sending this email.  Continue?",function(){c.send2()})},send2:function(){var c=this;data=this.dlg.form.getData();scil.Utils.ajax("ajax.ashx?cmd=workflow.sendemail",function(d){scil.Utils.alert("Email sent successfully");c.dlg.hide()},data)},create:function(){if(this.dlg!=null){return}var d=this;var c={requestid:{type:"hidden"},to:{label:"To",width:800},cc:{label:"CC",width:800},bcc:{label:"BCC",width:800},attachment:{label:"Attach as PDF",type:"checkbox"},template:{label:"Choose Template",type:"select",items:scil.Utils.getDictKeys(this.templates,true),onchange:function(f,g){d.selectTemplate(f,g)}},subject:{label:"Subject",width:800},body:{label:"Body",type:"textarea",width:800,height:400}};this.dlg=scil.Form.createDlgForm("Send Email",c,{label:"Send",onclick:function(){d.send()}})},selectTemplate:function(c,d){var f=this.templates[c.value];if(f!=null){d.fields.subject.value=f.subject;d.fields.body.value=f.body}}};if(typeof(org)=="undefined"){org={}}if(org.helm==null){org.helm={}}scil.helm={kVersion:"1.1.2",atomscale:2,bondscale:1.6,defaultbondratio:1,allowHeadToHeadConnection:true,ambiguity:false,ajaxurl:"JSDraw/Service.aspx?cmd=",HELM:{BASE:"HELM_BASE",SUGAR:"HELM_SUGAR",LINKER:"HELM_LINKER",AA:"HELM_AA",CHEM:"HELM_CHEM",BLOB:"HELM_BLOB",NUCLEOTIDE:"HELM_NUCLETIDE"},blobtypes:["Bead","Gold Particle","protein"],isHelmNode:function(c){if(c==null){return false}var d=typeof(c)=="string"?c:c.biotype();return d==scil.helm.HELM.BASE||d==scil.helm.HELM.SUGAR||d==scil.helm.HELM.LINKER||d==scil.helm.HELM.AA||d==scil.helm.HELM.CHEM||d==scil.helm.HELM.BLOB||d==scil.helm.HELM.NUCLEOTIDE},isHelmNodeEx:function(c){return this.isHelmNode(1)||this.isProteinAntibody(c)},isBlobEx:function(c){var d=c.biotype();return d==scil.helm.HELM.BLOB||d==JSDraw2.BIO.ANTIBODY||d==JSDraw2.BIO.PROTEIN},isInlineSmilesNode:function(c){var d=c.biotype();return new RegExp("^[#][0-9]+$").test(c.elem)},isProteinAntibody:function(c){var d=c.biotype();return d==JSDraw2.BIO.ANTIBODY||d==JSDraw2.BIO.PROTEIN},monomerTypeList:function(){var c={"":""};c[scil.helm.HELM.BASE]="Base";c[scil.helm.HELM.SUGAR]="Sugar";c[scil.helm.HELM.LINKER]="Linker";c[scil.helm.HELM.AA]="Amino Acid";c[scil.helm.HELM.CHEM]="Chem";return c},symbolCase:function(c){return c==null||scil.helm.kCaseSensitive?c:c.toLowerCase()},about:function(){var f=this;if(this.aboutDlg==null){var d=scil.Utils.createElement(null,"div");scil.Utils.createElement(d,"img",null,{width:425,height:145},{src:scil.Utils.imgSrc("img/helm.png")});scil.Utils.createElement(d,"div","Built on <a target=_blank href='http://www.jsdraw.com'>JSDraw.Lite "+JSDraw2.kFileVersion+"</a> (open source), by <a target=_blank href='http://www.scillignece.com'>Scilligence</a>",{textAlign:"right",paddingRight:"26px"});var g=scil.Utils.createTable(d,null,null,{borderTop:"solid 1px gray",width:"100%"});var h=scil.Utils.createElement(g,"tr");scil.Utils.createElement(h,"td",this.kVersion);scil.Utils.createElement(h,"td","&copy; 2016, <a target='_blank' href='http://www.pistoiaalliance.org/'>http://www.pistoiaalliance.org/</a>",{textAlign:"center"});scil.Utils.createElement(scil.Utils.createElement(g,"tr"),"td","&nbsp;");var c=scil.Utils.createElement(scil.Utils.createElement(d,"div",null,{textAlign:"center"}),"button","OK",{width:scil.Utils.buttonWidth+"px"});f.aboutDlg=new JSDraw2.Dialog("About HELM Web Editor",d);scil.connect(c,"onclick",function(j){f.aboutDlg.hide();j.preventDefault()})}this.aboutDlg.show()},isAmbiguous:function(d,c){if(d=="*"||d=="_"||c==scil.helm.HELM.AA&&d=="X"||(c==scil.helm.HELM.SUGAR||c==scil.helm.HELM.BASE||c==scil.helm.HELM.LINKER)&&d=="N"){return true}if(!scil.Utils.startswith(d,"(")||!scil.Utils.endswith(d,")")){return false}d=d.substr(1,d.length-2);var f=scil.helm.IO.split(d,",");if(f.length>1){return true}f=scil.helm.IO.split(d,"+");if(f.length>1){return true}return false},setNodeType:function(c,d,g){var l=scil.helm.Monomers.getMonomer(d,g);if(l!=null){var j=c.bio==null?null:c.bio.id;c.bio={type:d,id:j};c.elem=l.id;return true}var h=scil.helm.isAmbiguous(g,d);if(!h){g="("+g+")";h=scil.helm.isAmbiguous(g,d)}if(h){c.elem="?";c.bio={type:d,id:j,ambiguity:g};return true}return false}};org.helm.webeditor=scil.helm;scil.helm.Interface={createCanvas:function(d,c){return new JSDraw2.Editor(d,c)},createMol:function(d){if(scil.Utils.isNullOrEmpty(d)){return null}var c=new JSDraw2.Mol();return c.setXml(d)},createPoint:function(c,d){return new JSDraw2.Point(c,d)},createRect:function(d,f,g,c){return new JSDraw2.Rect(d,f,g,c)},createAtom:function(c,d){return c.addAtom(new JSDraw2.Atom(d))},createBond:function(g,c,d,f){return g.addBond(new JSDraw2.Bond(c,d,f==null?JSDraw2.BONDTYPES.SINGLE:f))},getAtomStats:function(d,c){var f={atoms:c,bonds:d.bonds};var g=JSDraw2.FormulaParser.getAtomStats(f);return g},molEquals:function(c,d){var f=c.mol!=null?c.mol:(c.mol=this.createMol(scil.helm.Monomers.getMolfile(c)));var g=d.mol!=null?d.mol:(d.mol=this.createMol(scil.helm.Monomers.getMolfile(d)));return g.fullstructureMatch(f)},molStats:function(d){var c=this.createMol(d);if(c==null){return null}c.calcHCount();return JSDraw2.FormulaParser.getAtomStats(c)},getElementMass:function(c){return JSDraw2.PT[c].m},getCurrentAtom:function(c){return JSDraw2.Atom.cast(c.curObject)},scaleCanvas:function(c){var d=JSDraw2.Editor.BONDLENGTH/c.bondlength;if(JSDraw2.Editor.BONDLENGTH/c.bondlength>1){c.scale(JSDraw2.Editor.BONDLENGTH/c.bondlength)}},drawMonomer:function(z,d,q,j,l,h){if(d.hidden){return}h=null;var f=d.biotype();var g=scil.Utils.isNullOrEmpty(h)?scil.helm.Monomers.getColor(d):h;var A=j*scil.helm.atomscale;var n=l/2;if(f==scil.helm.HELM.LINKER){JSDraw2.Drawer.drawEllipse(z,scil.helm.Interface.createRect(q.x-A/2,q.y-A/2,A,A),g.linecolor,n).setFill(g.backgroundcolor)}else{if(f==scil.helm.HELM.SUGAR){JSDraw2.Drawer.drawRect(z,scil.helm.Interface.createRect(q.x-A/2,q.y-A/2,A,A),g.linecolor,n,l*3).setFill(g.backgroundcolor)}else{if(f==scil.helm.HELM.BASE){JSDraw2.Drawer.drawDiamond(z,scil.helm.Interface.createRect(q.x-A/2,q.y-A/2,A,A),g.linecolor,n).setFill(g.backgroundcolor)}else{if(f==scil.helm.HELM.AA){JSDraw2.Drawer.drawHexgon(z,scil.helm.Interface.createRect(q.x-A/2,q.y-A/2,A,A),g.linecolor,n,l*3).setFill(g.backgroundcolor)}else{if(f==scil.helm.HELM.CHEM){JSDraw2.Drawer.drawRect(z,scil.helm.Interface.createRect(q.x-A/2,q.y-A/2,A,A),g.linecolor,n).setFill(g.backgroundcolor)}else{if(f==scil.helm.HELM.BLOB){JSDraw2.Drawer.drawRect(z,scil.helm.Interface.createRect(q.x-A/2,q.y-A/2,A,A),g.linecolor,n*2,l*5).setFill(g.backgroundcolor)}else{if(f==scil.helm.HELM.NUCLEOTIDE){JSDraw2.Drawer.drawPentagon(z,scil.helm.Interface.createRect(q.x-A/2,q.y-A/2,A,A),g.linecolor,n,l*3).setFill(g.backgroundcolor)}}}}}}}var u=q.clone();q.offset(0,-1);JSDraw2.Drawer.drawLabel(z,q,d.elem,g.textcolor,j*(d.elem.length>1?2/d.elem.length:1),null,null,null,false);if(d.bio.id>0){var t=q.clone();t.offset(-j*1.2,-j*1.2);JSDraw2.Drawer.drawLabel(z,t,d.bio.id,"#00FF00",j,null,null,null,false)}if(!scil.Utils.isNullOrEmpty(d.bio.annotation)){var t=q.clone();var y=d.bio.annotation;if(d.bio.annotationshowright){var g=d.biotype()==scil.helm.HELM.AA?0.7:1;t.offset(j*g,-j*1.5);JSDraw2.Drawer.drawLabel(z,t,y,"#FFA500",j,null,"start",null,false)}else{var g=d.biotype()==scil.helm.HELM.AA?1.5:1;t.offset(-j*g,-j*1.5);JSDraw2.Drawer.drawLabel(z,t,y,"#FFA500",j,null,"end",null,false)}}if(!scil.Utils.isNullOrEmpty(d.tag)){var x=j/2;JSDraw2.Drawer.drawEllipse(z,scil.helm.Interface.createRect(u.x+x/2,u.y-A/3-x/2,x,x),"white",n).setFill("red")}},addToolbar:function(c,d,h,g){var h=[{c:"helm_base",t:"Base",label:"Base"},{c:"helm_sugar",t:"Sugar",label:"Sugar"},{c:"helm_linker",t:"Linker",label:"Linker"},{c:"helm_aa",t:"Peptide",label:"Peptide"},{c:"helm_chem",t:"Chemistry",label:"Chemistry"}];var f={c:"helm_nucleotide",t:"Nucleotide",label:"Nucleotide",sub:h,hidden:true};c.push(f);c.push({c:"new",t:"New",label:"New"});if(typeof(JSDrawServices)!="undefined"&&JSDrawServices.url!=null){c.push({c:"open",t:"Load",label:"Load"});c.push({c:"save",t:"Save",label:"Save"})}c.push({c:"|"})},getHelmToolbar:function(c,d,g,f){this.addToolbar(c,true,null,f);if(scil.helm.ambiguity){c.push({c:"helm_blob",t:"BLOB",label:"BLOB"});c.push({c:"bracket",t:"Bracket",label:"Bracket"})}c.push({c:"|"});c.push({c:"undo",t:"Undo",label:"Undo"});c.push({c:"redo",t:"Redo",label:"Redo"});c.push({c:"|"});c.push({c:"eraser",t:"Eraser",label:"Eraser"});c.push({c:"|"});c.push({c:"select",t:"Box Selection",label:"Select",sub:g});c.push({c:"|"});c.push({c:"helm_import",t:"Import Sequence",label:"Import",tooltips:"Import Sequence"});c.push({c:"helm_find",t:"Find/Replace",label:"Find/Replace"});c.push({c:"helm_layout",t:"Clean",label:"Clean"});c.push({c:"|"});c.push({c:"zoomin",t:"Zoom in",label:"Zoom"});c.push({c:"zoomout",t:"Zoom out",label:"Zoom"});c.push({c:"|"});c.push({c:"center",t:"Move to center",label:"Center"});c.push({c:"moveview",t:"Move/View",label:"Move"})},onContextMenu:function(j,h,q){var n=[];if(j.options.toolbarmode=="helm"){var c=JSDraw2.Atom.cast(j.curObject);var d=JSDraw2.Bond.cast(j.curObject);var l=JSDraw2.Group.cast(j.curObject);if(c!=null&&c.hidden){c=null}if(c!=null){var f=c.biotype();if(f==scil.helm.HELM.SUGAR&&c.bio!=null){n.push({caption:"Set as Sense",key:"helm_set_sense"});n.push({caption:"Set as Antisense",key:"helm_set_antisense"});n.push({caption:"Clear Annotation",key:"helm_set_clear"});n.push("-");n.push({caption:"Create Complementary Strand",key:"helm_complementary_strand"})}if(c.superatom!=null){if(n.length>0){n.push("-")}n.push({caption:"Expand"})}if(scil.helm.ambiguity&&scil.helm.isHelmNode(f)&&c.superatom==null){if(n.length>0){n.push("-")}if(f==scil.helm.HELM.BLOB){n.push({caption:"Blob Type",callback:function(t,u){j.helm.setHelmBlobType(u,t)},children:scil.helm.blobtypes})}else{if(c.group==null){n.push({caption:"Create Group",key:"helm_create_group"})}}n.push("-");n.push({caption:"Set Monomer Attributes",key:"helm_atom_prop"})}}else{if(d!=null&&(d.a1.biotype()==scil.helm.HELM.BLOB||d.a2.biotype()==scil.helm.HELM.BLOB)){n.push({caption:"Set Bond Attributes",key:"helm_bond_prop"})}else{if(l!=null){n.push({caption:"Create Group",key:"helm_create_group"});n.push("-");n.push({caption:"Collapse",key:"helm_group_collapse"});n.push("-");n.push({caption:"Set Attributes",key:"group_setproperties"})}}}}else{var c=JSDraw2.Atom.cast(j.curObject);if(c!=null&&c.bio==null){n.push({caption:"R Group",callback:function(t,u){j.menuSetAtomType(t,u)},children:["R1","R2","R3","R4","R5"]})}n.push({caption:"Copy Molfile",key:"copymolfile"})}var g=JSDraw2.Bracket.cast(j.curObject);if(g!=null){n.push({caption:"Set Subscript",key:"setbracketsubscription"})}if(n.length>0){n.push("-")}if(j.options.toolbarmode=="helm"){}else{n.push({caption:"About JSDraw",key:"about"})}return n}};scil.helm.Cap={caps:{H:"H",OH:"O",X:"X",Cl:"Cl",Br:"Br",Allyl:"\n   JSDraw206151820302D\n\n  3  2  0  0  0  0              0 V2000\n   20.1245   -6.8900    0.0000 C\n   21.4755   -7.6700    0.0000 C\n   22.8265   -6.8900    0.0000 C\n  1  2  1\n  2  3  2\nM  APO  1   1   1\nM  END"},replaceRAtom:function(d,l,j){if(d=="H"){var h=j.getAllBonds(l);var c=h==null?null:h[0];if(c!=null){j.delAtom(l,true)}}else{if(this.caps[d]!=null){var n=this.caps[d];if(JSDraw2.PT[n]!=null){l.elem=n;l.alias=null}else{var h=j.getAllBonds(l);var c=h==null?null:h[0];if(c!=null){var f=new JSDraw2.Mol();f.setMolfile(n);if(JSDraw2.SuperAtoms.addToMol!=null){JSDraw2.SuperAtoms.addToMol(j,l,f,c.bondLength())}}}}else{throw"Unsupported R cap: "+d}}},getStats:function(d,l){var n=this.caps[l];if(n==null){return}if(n=="OH"||n=="O"){d.add("O",1);d.add("H",1);return}else{if(n=="H"){d.add("H",1);return}}var h=n==null||n.Length>2?null:JSDraw2.PT[n];if(h!=null){d.add(n,1)}else{var j=new JSDraw2.Mol();j.setMolfile(n);if(j!=null){var f=JSDraw2.FormulaParser.getAtomStats(j);d.mergeFrom(f)}}}};scil.helm.MonomerColors={unknown:"#FFFF00",bases:{A:"#A0A0FF",G:"#FF7070",T:"#A0FFA0",C:"#FF8C4B",U:"#FF8080"},linkers:{P:"#9aa5e1",p:"#9aa5e1"},sugars:{R:"#7a85c1",r:"#7a85c1"},aas:{A:"#C8C8C8",R:"#145AFF",N:"#00DCDC",D:"#E60A0A",C:"#E6E600",E:"#00DCDC",Q:"#E60A0A",G:"#EBEBEB",H:"#8282D2",I:"#0F820F",L:"#0F820F",K:"#145AFF",M:"#E6E600",F:"#3232AA",P:"#DC9682",S:"#FA9600",T:"#FA9600",W:"#B45AB4",Y:"#3232AA",V:"#0F820F"},chems:{R:"#eeeeee",},blobs:{B:"#999999",G:"#e2e2e2"}};scil.helm.Monomers={smilesmonomerid:0,smilesmonomers:{},aliasset:{},defaultmonomers:{HELM_BASE:null,HELM_SUGAR:null,HELM_LINKER:null,HELM_AA:null,HELM_CHEM:null},blobs:{blob:{n:"Blob",id:"Blob",na:"B",rs:0,at:{},m:""},group:{n:"Group",id:"Group",na:"G",rs:0,at:{},m:""}},parseNucleotide:function(d){var l=scil.helm.MonomerExplorer.nucleotides[d];if(l==null){l=d}var f=l.indexOf("(");var g=l.indexOf(")");var j=scil.helm.IO.trimBracket(l.substr(0,f));var c=scil.helm.IO.trimBracket(l.substr(f+1,g-f-1));var h=scil.helm.IO.trimBracket(l.substr(g+1));return{base:c,ribose:j,phosphate:h}},getMonomerSmiles:function(c){for(var d in this.smilesmonomers){if(this.smilesmonomers[d].id==c){return d}}return null},clear:function(){this.sugars={};this.linkers={};this.bases={};this.aas={};this.chems={}},getDefaultMonomer:function(c){var d=this.defaultmonomers[c];if(d!=null){return d}if(c==scil.helm.HELM.BASE){return this._getFirstKey(scil.helm.Monomers.bases,"a")}else{if(c==scil.helm.HELM.SUGAR){return this._getFirstKey(scil.helm.Monomers.sugars,"r")}else{if(c==scil.helm.HELM.LINKER){return this._getFirstKey(scil.helm.Monomers.linkers,"p")}else{if(c==scil.helm.HELM.AA){return this._getFirstKey(scil.helm.Monomers.aas,"A")}else{if(c==scil.helm.HELM.CHEM){return this._getFirstKey(scil.helm.Monomers.chems,"R")}else{if(c==scil.helm.HELM.BLOB){return this._getFirstKey(scil.helm.Monomers.blobs)}}}}}}return"?"},_getFirstKey:function(g,d,f){if(d!=null&&g[scil.helm.symbolCase(d)]!=null){return g[scil.helm.symbolCase(d)].id}if(f!=null&&g[scil.helm.symbolCase(f)]!=null){return g[scil.helm.symbolCase(f)].id}for(var c in g){return c}return"?"},saveTextDB:function(h){var d=["id","symbol","name","naturalanalog","molfile","smiles","polymertype","monomertype","r1","r2","r3","r4","r5","author","createddate"];var g="";var f={n:0};g+=this.saveMonomersAsText(this.aas,"PEPTIDE","Undefined",d,f);g+=this.saveMonomersAsText(this.sugars,"RNA","Backbone",d,f);g+=this.saveMonomersAsText(this.linkers,"RNA","Backbone",d,f);g+=this.saveMonomersAsText(this.bases,"RNA","Branch",d,f);g+=this.saveMonomersAsText(this.chems,"CHEM","Undefined",d,f);g=f.n+"\n"+g;if(h==null){return g}var c={client:"jsdraw",wrapper:"none",filename:"monomers.txt",directsave:1,contents:g};scil.Utils.post(h,c,"_blank")},saveMonomerDB:function(f){var d="<MONOMER_DB>\n";d+="<PolymerList>\n";d+="<Polymer polymerType='PEPTIDE'>\n";d+=this.saveMonomers(this.aas,"PEPTIDE","Undefined");d+="</Polymer>\n";d+="<Polymer polymerType='RNA'>\n";d+=this.saveMonomers(this.sugars,"RNA","Backbone");d+=this.saveMonomers(this.linkers,"RNA","Backbone");d+=this.saveMonomers(this.bases,"RNA","Branch");d+="</Polymer>\n";d+="<Polymer polymerType='CHEM'>\n";d+=this.saveMonomers(this.chems,"CHEM","Undefined");d+="</Polymer>\n";d+="</PolymerList>\n";d+="</MONOMER_DB>";if(f==null){return d}var c={client:"jsdraw",wrapper:"none",filename:"HELMMonomerDB.xml",directsave:1,contents:d};scil.Utils.post(f,c,"_blank")},saveMonomersAsText:function(l,q,f,c,g){var h="";for(var d in l){var j=this.writeOneAsText({id:++g.n,symbol:d,monomertype:f,polymertype:q,name:l[d].n,naturalanalog:l[d].na,m:l[d]},c);h+=JSDraw2.Base64.encode(j)+"\n"}return h},saveMonomers:function(g,h,d){var f="";for(var c in g){f+=this.writeOne({id:c,mt:d,type:h,m:g[c]})}return f},loadFromUrl:function(f,d,c){scil.Utils.jsonp(f,function(g){if(g.monomers!=null){g=g.monomers}scil.helm.Monomers.loadDB(g,d);if(c!=null){c()}})},loadFromXml:function(d){var c=scil.Utils.parseXml(d);if(c==null){return false}this.loadMonomers(c)},loadDB:function(f,h,c){if(c!=false){this.clear()}if(f.length==null&&f.list!=null){f=f.list}for(var d=0;d<f.length;++d){var n=f[d];var g=null;if(h!=null){g=h(n)}else{g={id:n.symbol,n:n.name,na:n.naturalanalog,type:n.polymertype,mt:n.monomertype,m:n.molfile};g.at={};var l=0;for(var j=1;j<=5;++j){if(n["r"+j]){g.at["R"+j]=n["r"+j];++l}}g.rs=l}this.addOneMonomer(g)}},loadMonomers:function(d,c){var g=d.getElementsByTagName("Monomer");if(g==null||g.length==0){return false}if(c==null){for(var f=0;f<g.length;++f){var h=this.readOne(g[f]);if(h!=null){this.addOneMonomer(h)}}return true}var l=[];var q=[];for(var f=0;f<g.length;++f){var h=this.readOne(g[f]);var n=this.getMonomer(this.helm2Type(h),h.id);if(n==null){l.push(h)}else{if(!scil.helm.Interface.molEquals(n,h)){q.push(h)}}}var j=this;this.renameNextMonomer(l,q,function(){var w=[];for(var t=0;t<l.length;++t){var u=l[t];j.addOneMonomer(u);if(u.oldname!=null){w.push(u)}}c(w)})},renameNextMonomer:function(g,h,c){if(h.length==0){c();return}var f=this;var d=h[0];scil.Utils.prompt2({caption:"Duplicate Monomer",message:"Monomer name, "+d.id+", is used. Please enter a new name for it:",callback:function(j){if(f.getMonomer(d.type,j)==null){d.oldname=d.id;d.id=j;g.push(d);h.splice(0,1)}f.renameNextMonomer(g,h,c)}})},getAliases:function(c){return null},getMonomerSet:function(c){if(c==null){return null}if(c.T=="ATOM"){c=c.biotype()}if(c==scil.helm.HELM.BASE){return scil.helm.monomers.bases}else{if(c==scil.helm.HELM.SUGAR){return scil.helm.monomers.sugars}else{if(c==scil.helm.HELM.LINKER){return scil.helm.monomers.linkers}else{if(c==scil.helm.HELM.AA){return scil.helm.monomers.aas}else{if(c==scil.helm.HELM.CHEM){return scil.helm.monomers.chems}else{if(c==scil.helm.HELM.BLOB){return scil.helm.monomers.blobs}}}}}}return null},getMonomerColors:function(c){if(c==null){return null}if(c.T=="ATOM"){c=c.biotype()}if(c==scil.helm.HELM.BASE){return scil.helm.MonomerColors.bases}else{if(c==scil.helm.HELM.SUGAR){return scil.helm.MonomerColors.sugars}else{if(c==scil.helm.HELM.LINKER){return scil.helm.MonomerColors.linkers}else{if(c==scil.helm.HELM.AA){return scil.helm.MonomerColors.aas}else{if(c==scil.helm.HELM.CHEM){return scil.helm.MonomerColors.chems}else{if(c==scil.helm.HELM.BLOB){return scil.helm.MonomerColors.blobs}}}}}}return null},getMonomerList:function(c){var g=this.getMonomerSet(c);if(g==null){return null}var f=[];for(var d in g){f.push(g[d].id)}return f},getMonomer:function(c,g){if(c==null&&g==null){return null}var h;var d;if(g==null){d=c.biotype();h=c.elem}else{d=c;h=scil.helm.IO.trimBracket(g)}if(h=="?"){var f={id:"?",n:"?",na:"?",rs:2,at:{},m:""};if(d==scil.helm.HELM.SUGAR){f.at.R3="H"}return f}if(d==scil.helm.HELM.LINKER&&h=="null"){return{id:"null",n:"?",na:"?",rs:2,at:{R1:"H",R2:"H"},m:""}}var j=this.getMonomerSet(d);if(j==null){return null}var f=j[scil.helm.symbolCase(h)];if(f!=null){return f}var j=this.getAliases(d);if(j==null){return null}var f=j[scil.helm.symbolCase(h)];if(f!=null){return f}},hasR:function(g,d,f){var c=this.getMonomer(g,d);return c!=null&&c.at!=null&&c.at[f]!=null},getColor:function(c){var f=this.getMonomer(c,c.elem);if(f==null){f={}}var g=this.getMonomerColors(c);if(g==null){g={}}var d=g[f.na];if(f.backgroundcolor==null&&c.elem=="?"){f.backgroundcolor=scil.helm.MonomerColors.unknown}return{linecolor:f.linecolor==null?"#000":f.linecolor,backgroundcolor:f.backgroundcolor==null?(d==null?"#eee":d):f.backgroundcolor,textcolor:f.textcolor==null?"#000":f.textcolor,nature:f.nature}},getColor2:function(h,g){var d=this.getMonomer(h,g);if(d==null){d={}}var f=this.getMonomerColors(h);if(f==null){f={}}var c=f[d.na];return{linecolor:d.linecolor==null?"#000":d.linecolor,backgroundcolor:d.backgroundcolor==null?(c==null?"#eee":c):d.backgroundcolor,textcolor:d.textcolor==null?"#000":d.textcolor,nature:d.nature}},getMolfile:function(c){if(c!=null&&c.m==null&&c.mz!=null){c.m=scil.helm.IO.uncompressGz(c.mz)}return c==null?null:c.m},helm2Type:function(c){if(c.type=="PEPTIDE"){return scil.helm.HELM.AA}else{if(c.type=="CHEM"){return scil.helm.HELM.CHEM}else{if(c.type=="RNA"){if(c.mt=="Branch"){return scil.helm.HELM.BASE}if(c.mt=="Backbone"){if(c.na=="P"||c.na=="p"){return scil.helm.HELM.LINKER}else{return scil.helm.HELM.SUGAR}}}}}return null},convertAtomMapping2Rs:function(d){if(d==null){return null}for(var c=1;c<=10;++c){d=d.replace(new RegExp("\\[\\*\\:"+c+"\\]"),"[R"+c+"]")}return d},addSmilesMonomer:function(j,g){g=this.convertAtomMapping2Rs(g);var h=this.findSmilesRs(g);if(h==null||h.length==0){return null}g=this.chemAxon2JSDrawSmiles(g);if(this.smilesmonomers[g]!=null){return this.smilesmonomers[g]}var d={at:{},smiles:g,issmiles:true};d.id="#"+(++this.smilesmonomerid);d.name="SMILES Monomer #"+this.smilesmonomerid;for(var c=0;c<h.length;++c){d.at[h[c]]="H"}d.rs=h.length;var f=this.getMonomerSet(j);f[scil.helm.symbolCase(d.id)]=d;var l=this.cleanupurl;if(l==null){l=JSDrawServices.url+"?cmd=cleanup"}if(l!=null){if(this.onMonomerSmiles!=null){this.onMonomerSmiles(d,g)}else{scil.Utils.ajax(l,function(n){if(n!=null&&n.output!=null){d.m=n.output}else{d.m=""}},{input:g,inputformat:"smiles",outputformat:"mol"})}}this.smilesmonomers[g]=d;return d},waitForSmilesMonomers:function(f,c){if(f==null){f=30}if(!this.checkSmilesMonomers()){c();return true}if(--f<=0){return false}var d=this;setTimeout(function(){d.waitForSmilesMonomers(f,c)},1000)},checkSmilesMonomers:function(){for(var c in this.smilesmonomers){if(this.smilesmonomers[c].m==null){return true}}return false},chemAxon2JSDrawSmiles:function(c){return c},findSmilesRs:function(f){var d=[];for(var c=1;c<=10;++c){var g=f.replace(new RegExp("\\[R"+c+"\\]"),"");if(g.length==f.length){continue}f=g;d.push("R"+c)}if(d.length==0){for(var c=1;c<=10;++c){var g=f.replace(new RegExp("_R"+c),"");if(g.length==f.length){continue}f=g;d.push("R"+c)}}return d},addOneMonomer:function(c){var d=this.getMonomerSet(this.helm2Type(c));if(d==null){return false}delete c.type;delete c.mt;d[scil.helm.symbolCase(c.id)]=c;return true},writeOneAsText:function(g,c){var h=g.m.mz;if(scil.Utils.isNullOrEmpty(h)&&g.m.m!=null){h=g.m.m}g.molfile=h;if(g.m.at!=null){for(var l in g.m.at){g[scil.helm.symbolCase(l)]=g.m.at[l]}}var j="";for(var d=0;d<c.length;++d){if(d>0){j+="|"}var f=c[d];j+=g[f]==null?"":g[f]}return j},writeOne:function(d){var f=this.getMolfile(d.m);if(f!=null){var h=scil.helm.IO.compressGz(f);if(h!=null){f=h}}var h="<Monomer>\n";h+="<MonomerID>"+scil.Utils.escXmlValue(d.id)+"</MonomerID>\n";h+="<MonomerSmiles>"+scil.Utils.escXmlValue(d.smiles)+"</MonomerSmiles>\n";h+="<MonomerMolFile>"+scil.Utils.escXmlValue(f)+"</MonomerMolFile>\n";h+="<NaturalAnalog>"+scil.Utils.escXmlValue(d.m.na)+"</NaturalAnalog>\n";h+="<MonomerType>"+scil.Utils.escXmlValue(d.mt)+"</MonomerType>\n";h+="<PolymerType>"+scil.Utils.escXmlValue(d.type)+"</PolymerType>\n";if(d.m.at!=null){h+="<Attachments>\n";for(var g in d.m.at){var c=d.m.at[g];h+="<Attachment>\n";h+="<AttachmentID>"+g+"-"+c+"</AttachmentID>\n";h+="<AttachmentLabel>"+g+"</AttachmentLabel>\n";h+="<CapGroupName>"+c+"</CapGroupName>\n";h+="<CapGroupSmiles></CapGroupSmiles>\n";h+="</Attachment>\n"}h+="</Attachments>\n"}h+="</Monomer>\n";return h},readOne:function(f){var t=this.readValue(f,"MonomerMolFile");var j=null;var l=null;if(t!=null){if(t.indexOf("M  END")>0){j=t}else{l=t}}var j={type:this.readValue(f,"PolymerType"),mt:this.readValue(f,"MonomerType"),id:this.readValue(f,"MonomerID"),n:this.readValue(f,"MonomerName"),na:this.readValue(f,"NaturalAnalog"),mz:l,m:j,at:{}};var q=0;var h=f.getElementsByTagName("Attachment");if(h!=null){for(var g=0;g<h.length;++g){var c=h[g];var n=this.readValue(c,"AttachmentLabel");var d=this.readValue(c,"CapGroupName");if(j.at[n]==null){++q}j.at[n]=d}}j.rs=q;return j},readValue:function(c,f){var d=c.getElementsByTagName(f);if(d==null||d.length==0){return null}return scil.Utils.getInnerText(d[0])}};scil.helm.monomers=scil.helm.Monomers;scil.helm.Monomers.aas={d:{id:"D",n:"Aspartic acid",na:"D",m:"\n  JSDraw  12021015502D          \n\n 10  9  0  0  0  0            999 V2000\n    7.4800   -2.7926    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    6.7655   -3.2050    0.0000 C   0  0  2  0  0  0  0  0  0  0  0  0\n    6.0510   -2.7925    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    5.3365   -3.2049    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    4.6220   -2.7924    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n    5.3364   -4.0299    0.0000 R#  0  0  0  0  0  0  0  0  0  0  0  0\n    7.4801   -1.9676    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n    6.7654   -4.0300    0.0000 N   0  0  0  0  0  0  0  0  0  0  0  0\n    8.1945   -3.2052    0.0000 R#  0  0  0  0  0  0  0  0  0  0  0  0\n    6.0510   -4.4425    0.0000 R#  0  0  0  0  0  0  0  0  0  0  0  0\n  7  1  2  0  0  0  0\n  1  2  1  0  0  0  0\n  1  9  1  0  0  0  0\n  2  8  1  0  0  0  0\n  2  3  1  1  0  0  0\n  3  4  1  0  0  0  0\n  4  6  1  0  0  0  0\n  4  5  2  0  0  0  0\n  8 10  1  0  0  0  0\nM  RGP  3   6   3   9   2  10   1\nM  END\n\n$$$$\n",rs:3,at:{R2:"OH",R3:"OH",R1:"H"}},e:{id:"E",n:"Glutamic acid",na:"E",m:"\n  JSDraw  12021015512D          \n\n 11 10  0  0  0  0            999 V2000\n    0.8787   -0.2594    0.0000 C   0  0  1  0  0  0  0  0  0  0  0  0\n    0.1643    0.1532    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n   -0.5503   -0.2592    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n   -1.2646    0.1534    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    1.5933    0.1530    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n   -1.9792   -0.2590    0.0000 R#  0  0  0  0  0  0  0  0  0  0  0  0\n   -1.2645    0.9784    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n    1.5934    0.9780    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n    0.8786   -1.0844    0.0000 N   0  0  0  0  0  0  0  0  0  0  0  0\n    2.3077   -0.2596    0.0000 R#  0  0  0  0  0  0  0  0  0  0  0  0\n    0.1641   -1.4969    0.0000 R#  0  0  0  0  0  0  0  0  0  0  0  0\n  5  1  1  0  0  0  0\n  1  9  1  0  0  0  0\n  1  2  1  1  0  0  0\n  2  3  1  0  0  0  0\n  3  4  1  0  0  0  0\n  4  7  2  0  0  0  0\n  4  6  1  0  0  0  0\n  5  8  2  0  0  0  0\n  5 10  1  0  0  0  0\n  9 11  1  0  0  0  0\nM  RGP  3   6   3  10   2  11   1\nM  END\n\n$$$$\n",rs:3,at:{R2:"OH",R3:"OH",R1:"H"}},f:{id:"F",n:"Phenylalanine",na:"F",m:"\n  JSDraw  08190815502D          \n\n 13 13  0  0  0  0            999 V2000\n   -3.6075    2.0774    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n   -4.3219    1.6650    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n   -4.3220    0.8400    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n   -3.6077    0.4274    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n   -2.8931    0.8398    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n   -2.8930    1.6648    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n   -2.1785    2.0772    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n   -1.4640    1.6646    0.0000 C   0  0  2  0  0  0  0  0  0  0  0  0\n   -1.4641    0.8396    0.0000 N   0  0  0  0  0  0  0  0  0  0  0  0\n   -0.7495    2.0770    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n   -0.7493    2.9021    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n   -0.0351    1.6644    0.0000 R#  0  0  0  0  0  0  0  0  0  0  0  0\n   -2.1786    0.4271    0.0000 R#  0  0  0  0  0  0  0  0  0  0  0  0\n  1  2  1  0  0  0  0\n  1  6  2  0  0  0  0\n  2  3  2  0  0  0  0\n  3  4  1  0  0  0  0\n  4  5  2  0  0  0  0\n  5  6  1  0  0  0  0\n  6  7  1  0  0  0  0\n  8  7  1  1  0  0  0\n  8  9  1  0  0  0  0\n  8 10  1  0  0  0  0\n 10 11  2  0  0  0  0\n 10 12  1  0  0  0  0\n  9 13  1  0  0  0  0\nM  RGP  2  12   2  13   1\nM  END\n\n$$$$\n",rs:2,at:{R2:"OH",R1:"H"}},g:{id:"G",n:"Glycine",na:"G",m:"\n  JSDraw  08190815292D          \n\n  6  5  0  0  0  0            999 V2000\n   -0.7189   -0.6069    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n   -0.0044   -0.1945    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n   -0.0043    0.6304    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n   -0.7190   -1.4318    0.0000 N   0  0  0  0  0  0  0  0  0  0  0  0\n    0.7101   -0.6071    0.0000 R#  0  0  0  0  0  0  0  0  0  0  0  0\n   -1.4335   -1.8443    0.0000 R#  0  0  0  0  0  0  0  0  0  0  0  0\n  4  1  1  0  0  0  0\n  1  2  1  0  0  0  0\n  2  3  2  0  0  0  0\n  2  5  1  0  0  0  0\n  4  6  1  0  0  0  0\nM  RGP  2   5   2   6   1\nM  END\n\n$$$$\n",rs:2,at:{R2:"OH",R1:"H"}},a:{id:"A",n:"Alanine",na:"A",m:"\n  JSDraw  06250814262D          \n\n  7  6  0  0  0  0            999 V2000\n    5.4886   -3.0482    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    6.2031   -3.4608    0.0000 C   0  0  1  0  0  0  0  0  0  0  0  0\n    6.9176   -3.0483    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    6.2030   -4.2858    0.0000 N   0  0  0  0  0  0  0  0  0  0  0  0\n    6.9177   -2.2233    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n    7.6321   -3.4609    0.0000 R#  0  0  0  0  0  0  0  0  0  0  0  0\n    5.4886   -4.6983    0.0000 R#  0  0  0  0  0  0  0  0  0  0  0  0\n  2  1  1  1  0  0  0\n  4  2  1  0  0  0  0\n  2  3  1  0  0  0  0\n  3  5  2  0  0  0  0\n  3  6  1  0  0  0  0\n  4  7  1  0  0  0  0\nM  RGP  2   6   2   7   1\nM  END\n\n$$$$\n",rs:2,at:{R2:"OH",R1:"H"}},c:{id:"C",n:"Cysteine",na:"C",m:"\n  JSDraw  12021015502D          \n\n  9  8  0  0  0  0            999 V2000\n    0.8481    0.4124    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    0.1336    0.0000    0.0000 C   0  0  2  0  0  0  0  0  0  0  0  0\n   -0.5808    0.4126    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n   -1.2952    0.0001    0.0000 S   0  0  0  0  0  0  0  0  0  0  0  0\n    0.1335   -0.8249    0.0000 N   0  0  0  0  0  0  0  0  0  0  0  0\n    0.8482    1.2374    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n    1.5625   -0.0001    0.0000 R#  0  0  0  0  0  0  0  0  0  0  0  0\n   -0.5810   -1.2374    0.0000 R#  0  0  0  0  0  0  0  0  0  0  0  0\n   -2.0097    0.4126    0.0000 R#  0  0  0  0  0  0  0  0  0  0  0  0\n  6  1  2  0  0  0  0\n  1  2  1  0  0  0  0\n  1  7  1  0  0  0  0\n  2  5  1  0  0  0  0\n  2  3  1  1  0  0  0\n  3  4  1  0  0  0  0\n  5  8  1  0  0  0  0\n  4  9  1  0  0  0  0\nM  RGP  3   7   2   8   1   9   3\nM  END\n\n$$$$\n",rs:3,at:{R2:"OH",R1:"H",R3:"H"}},l:{id:"L",n:"Leucine",na:"L",m:"\n  JSDraw  08200815002D          \n\n 10  9  0  0  0  0            999 V2000\n   -2.7541    2.1476    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n   -3.4686    0.9102    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n   -3.4686    1.7352    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n   -4.1830    2.1477    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n   -2.0397    1.7351    0.0000 C   0  0  1  0  0  0  0  0  0  0  0  0\n   -1.3250    2.1476    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n   -1.3250    2.9726    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n   -2.0397    0.9101    0.0000 N   0  0  0  0  0  0  0  0  0  0  0  0\n   -0.6105    1.7350    0.0000 R#  0  0  0  0  0  0  0  0  0  0  0  0\n   -2.7542    0.4976    0.0000 R#  0  0  0  0  0  0  0  0  0  0  0  0\n  3  1  1  0  0  0  0\n  5  1  1  1  0  0  0\n  3  2  1  0  0  0  0\n  3  4  1  0  0  0  0\n  5  8  1  0  0  0  0\n  5  6  1  0  0  0  0\n  6  7  2  0  0  0  0\n  6  9  1  0  0  0  0\n  8 10  1  0  0  0  0\nM  RGP  2   9   2  10   1\nM  END\n\n$$$$\n",rs:2,at:{R2:"OH",R1:"H"}},m:{id:"M",n:"Methionine",na:"M",m:"\n  JSDraw  08190815482D          \n\n 10  9  0  0  0  0            999 V2000\n   -4.1128    0.8183    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n   -4.8273   -0.4191    0.0000 N   0  0  0  0  0  0  0  0  0  0  0  0\n   -4.1127    1.6433    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n   -4.8272    0.4059    0.0000 C   0  0  1  0  0  0  0  0  0  0  0  0\n   -5.5418    0.8185    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n   -6.2563    0.4061    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n   -7.6852    0.4062    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n   -6.9707    0.8186    0.0000 S   0  0  0  0  0  0  0  0  0  0  0  0\n   -3.3983    0.4057    0.0000 R#  0  0  0  0  0  0  0  0  0  0  0  0\n   -5.5418   -0.8316    0.0000 R#  0  0  0  0  0  0  0  0  0  0  0  0\n  3  1  2  0  0  0  0\n  1  4  1  0  0  0  0\n  1  9  1  0  0  0  0\n  4  2  1  0  0  0  0\n  4  5  1  1  0  0  0\n  5  6  1  0  0  0  0\n  6  8  1  0  0  0  0\n  8  7  1  0  0  0  0\n  2 10  1  0  0  0  0\nM  RGP  2   9   2  10   1\nM  END\n\n$$$$\n",rs:2,at:{R2:"OH",R1:"H"}},n:{id:"N",n:"Asparagine",na:"N",m:"\n  JSDraw  08190815142D          \n\n 10  9  0  0  0  0            999 V2000\n    6.9268   -2.8241    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    6.2123   -3.2366    0.0000 C   0  0  2  0  0  0  0  0  0  0  0  0\n    5.4978   -2.8241    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    6.9268   -1.9991    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n    6.2123   -4.0616    0.0000 N   0  0  0  0  0  0  0  0  0  0  0  0\n    4.7834   -3.2366    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    4.0690   -2.8242    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n    4.7834   -4.0616    0.0000 N   0  0  0  0  0  0  0  0  0  0  0  0\n    7.6413   -3.2366    0.0000 R#  0  0  0  0  0  0  0  0  0  0  0  0\n    5.6290   -4.6450    0.0000 R#  0  0  0  0  0  0  0  0  0  0  0  0\n  4  1  2  0  0  0  0\n  1  2  1  0  0  0  0\n  1  9  1  0  0  0  0\n  2  5  1  0  0  0  0\n  2  3  1  1  0  0  0\n  3  6  1  0  0  0  0\n  6  8  1  0  0  0  0\n  6  7  2  0  0  0  0\n  5 10  1  0  0  0  0\nM  RGP  2   9   2  10   1\nM  END\n\n$$$$\n",rs:2,at:{R2:"OH",R1:"H"}},h:{id:"H",n:"Histidine",na:"H",m:"\n  JSDraw  08190815312D          \n\n 12 12  0  0  0  0            999 V2000\n    1.2557    0.4210    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    0.5412    0.0086    0.0000 C   0  0  2  0  0  0  0  0  0  0  0  0\n   -0.1733    0.4211    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n   -0.8878    0.0087    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n   -2.1685   -0.3674    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n   -0.9114   -0.8159    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n   -1.6648    0.2860    0.0000 N   0  0  0  0  0  0  0  0  0  0  0  0\n   -1.7029   -1.0484    0.0000 N   0  0  0  0  0  0  0  0  0  0  0  0\n    0.5411   -0.8164    0.0000 N   0  0  0  0  0  0  0  0  0  0  0  0\n    1.2558    1.2461    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n    1.9702    0.0084    0.0000 R#  0  0  0  0  0  0  0  0  0  0  0  0\n   -0.1733   -1.2289    0.0000 R#  0  0  0  0  0  0  0  0  0  0  0  0\n 10  1  2  0  0  0  0\n  1  2  1  0  0  0  0\n  1 11  1  0  0  0  0\n  2  9  1  0  0  0  0\n  2  3  1  1  0  0  0\n  3  4  1  0  0  0  0\n  6  4  2  0  0  0  0\n  7  4  1  0  0  0  0\n  7  5  2  0  0  0  0\n  5  8  1  0  0  0  0\n  8  6  1  0  0  0  0\n  9 12  1  0  0  0  0\nM  RGP  2  11   2  12   1\nM  END\n\n$$$$\n",rs:2,at:{R2:"OH",R1:"H"}},i:{id:"I",n:"Isoleucine",na:"I",m:"\n  JSDraw  08190815422D          \n\n 10  9  0  0  0  0            999 V2000\n   -0.7783   -0.6153    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n   -1.4928   -0.2028    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    0.6506   -0.6155    0.0000 C   0  0  1  0  0  0  0  0  0  0  0  0\n    1.3652   -0.2031    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    1.3653    0.6219    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n    0.6505   -1.4405    0.0000 N   0  0  0  0  0  0  0  0  0  0  0  0\n   -0.0638   -0.2029    0.0000 C   0  0  1  0  0  0  0  0  0  0  0  0\n   -0.0637    0.6221    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    2.0796   -0.6157    0.0000 R#  0  0  0  0  0  0  0  0  0  0  0  0\n   -0.0640   -1.8530    0.0000 R#  0  0  0  0  0  0  0  0  0  0  0  0\n  1  7  1  0  0  0  0\n  1  2  1  0  0  0  0\n  3  7  1  0  0  0  0\n  3  6  1  0  0  0  0\n  3  4  1  1  0  0  0\n  4  5  2  0  0  0  0\n  4  9  1  0  0  0  0\n  7  8  1  6  0  0  0\n  6 10  1  0  0  0  0\nM  RGP  2   9   2  10   1\nM  END\n\n$$$$\n",rs:2,at:{R2:"OH",R1:"H"}},k:{id:"K",n:"Lysine",na:"K",m:"\n  JSDraw  12021015522D          \n\n 12 11  0  0  0  0            999 V2000\n   -1.2102    2.0919    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n   -1.9248    1.6794    0.0000 C   0  0  2  0  0  0  0  0  0  0  0  0\n   -2.6392    2.0920    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n   -3.3538    1.6795    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n   -4.0682    2.0920    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n   -4.7828    1.6795    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n   -5.4972    2.0921    0.0000 N   0  0  0  0  0  0  0  0  0  0  0  0\n   -1.9248    0.8544    0.0000 N   0  0  0  0  0  0  0  0  0  0  0  0\n   -1.2102    2.9169    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n   -0.4958    1.6794    0.0000 R#  0  0  0  0  0  0  0  0  0  0  0  0\n   -2.6393    0.4419    0.0000 R#  0  0  0  0  0  0  0  0  0  0  0  0\n   -6.2117    1.6796    0.0000 R#  0  0  0  0  0  0  0  0  0  0  0  0\n  9  1  2  0  0  0  0\n  1  2  1  0  0  0  0\n  1 10  1  0  0  0  0\n  2  8  1  0  0  0  0\n  2  3  1  1  0  0  0\n  3  4  1  0  0  0  0\n  4  5  1  0  0  0  0\n  5  6  1  0  0  0  0\n  6  7  1  0  0  0  0\n  8 11  1  0  0  0  0\n  7 12  1  0  0  0  0\nM  RGP  3  10   2  11   1  12   3\nM  END\n\n$$$$\n",rs:3,at:{R2:"OH",R1:"H",R3:"H"}},t:{id:"T",n:"Threonine",na:"T",m:"\n  JSDraw  08190820372D          \n\n  9  8  0  0  0  0            999 V2000\n   -3.2927    2.1067    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n   -4.0072    0.8691    0.0000 N   0  0  0  0  0  0  0  0  0  0  0  0\n   -3.2926    2.9316    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n   -4.0071    1.6941    0.0000 C   0  0  1  0  0  0  0  0  0  0  0  0\n   -5.4360    1.6943    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n   -4.7216    2.1068    0.0000 C   0  0  1  0  0  0  0  0  0  0  0  0\n   -4.7215    2.9317    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n   -2.5783    1.6942    0.0000 R#  0  0  0  0  0  0  0  0  0  0  0  0\n   -4.7217    0.4566    0.0000 R#  0  0  0  0  0  0  0  0  0  0  0  0\n  3  1  2  0  0  0  0\n  4  1  1  1  0  0  0\n  1  8  1  0  0  0  0\n  4  2  1  0  0  0  0\n  4  6  1  0  0  0  0\n  6  5  1  0  0  0  0\n  6  7  1  1  0  0  0\n  2  9  1  0  0  0  0\nM  RGP  2   8   2   9   1\nM  END\n\n$$$$\n",rs:2,at:{R2:"OH",R1:"H"}},w:{id:"W",n:"Tryptophan",na:"W",m:"\n  JSDraw  08190820412D          \n\n 16 17  0  0  0  0            999 V2000\n   -0.4698    2.4303    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n   -0.4698    3.2553    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n   -1.1843    1.1927    0.0000 N   0  0  0  0  0  0  0  0  0  0  0  0\n   -1.1843    2.0177    0.0000 C   0  0  1  0  0  0  0  0  0  0  0  0\n   -1.8988    2.4303    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n   -2.6133    2.0177    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n   -2.6271    1.1929    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n   -3.3935    2.2860    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n   -3.8895    1.6267    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n   -3.7164    3.0451    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n   -4.5353    3.1451    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n   -5.0313    2.4859    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n   -4.7084    1.7267    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n   -3.4159    0.9513    0.0000 N   0  0  0  0  0  0  0  0  0  0  0  0\n    0.2447    2.0178    0.0000 R#  0  0  0  0  0  0  0  0  0  0  0  0\n   -1.8988    0.7802    0.0000 R#  0  0  0  0  0  0  0  0  0  0  0  0\n  2  1  2  0  0  0  0\n  1  4  1  0  0  0  0\n  1 15  1  0  0  0  0\n  4  3  1  0  0  0  0\n  4  5  1  1  0  0  0\n  5  6  1  0  0  0  0\n  7  6  2  0  0  0  0\n  8  6  1  0  0  0  0\n 14  7  1  0  0  0  0\n  8  9  2  0  0  0  0\n  8 10  1  0  0  0  0\n  9 14  1  0  0  0  0\n 13  9  1  0  0  0  0\n 10 11  2  0  0  0  0\n 11 12  1  0  0  0  0\n 12 13  2  0  0  0  0\n  3 16  1  0  0  0  0\nM  RGP  2  15   2  16   1\nM  END\n\n$$$$\n",rs:2,at:{R2:"OH",R1:"H"}},v:{id:"V",n:"Valine",na:"V",m:"\n  JSDraw  08190820502D          \n\n  9  8  0  0  0  0            999 V2000\n   -5.2963    0.6040    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n   -6.0107    0.1915    0.0000 C   0  0  2  0  0  0  0  0  0  0  0  0\n   -6.7252    1.4290    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n   -6.7252    0.6040    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n   -7.4396    0.1915    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n   -5.2963    1.4290    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n   -6.0107   -0.6335    0.0000 N   0  0  0  0  0  0  0  0  0  0  0  0\n   -4.5818    0.1915    0.0000 R#  0  0  0  0  0  0  0  0  0  0  0  0\n   -6.7252   -1.0460    0.0000 R#  0  0  0  0  0  0  0  0  0  0  0  0\n  6  1  2  0  0  0  0\n  1  2  1  0  0  0  0\n  1  8  1  0  0  0  0\n  2  7  1  0  0  0  0\n  2  4  1  1  0  0  0\n  4  3  1  0  0  0  0\n  4  5  1  0  0  0  0\n  7  9  1  0  0  0  0\nM  RGP  2   8   2   9   1\nM  END\n\n$$$$\n",rs:2,at:{R2:"OH",R1:"H"}},q:{id:"Q",n:"Glutamine",na:"Q",m:"\n  JSDraw  08190815272D          \n\n 11 10  0  0  0  0            999 V2000\n    2.8012   -4.0307    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    2.0867   -4.4433    0.0000 C   0  0  2  0  0  0  0  0  0  0  0  0\n    1.3722   -4.0307    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    0.6578   -4.4433    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    2.8013   -3.2057    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n   -0.7711   -4.4432    0.0000 N   0  0  0  0  0  0  0  0  0  0  0  0\n    2.0867   -5.2683    0.0000 N   0  0  0  0  0  0  0  0  0  0  0  0\n   -0.0565   -3.2056    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n   -0.0566   -4.0306    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    3.5157   -4.4432    0.0000 R#  0  0  0  0  0  0  0  0  0  0  0  0\n    1.3722   -5.6808    0.0000 R#  0  0  0  0  0  0  0  0  0  0  0  0\n  5  1  2  0  0  0  0\n  1  2  1  0  0  0  0\n  1 10  1  0  0  0  0\n  2  7  1  0  0  0  0\n  2  3  1  1  0  0  0\n  3  4  1  0  0  0  0\n  4  9  1  0  0  0  0\n  9  6  1  0  0  0  0\n  9  8  2  0  0  0  0\n  7 11  1  0  0  0  0\nM  RGP  2  10   2  11   1\nM  END\n\n$$$$\n",rs:2,at:{R2:"OH",R1:"H"}},p:{id:"P",n:"Proline",na:"P",m:"\n  JSDraw  08190815522D          \n\n  9  9  0  0  0  0            999 V2000\n   -3.4704    1.8073    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n   -3.9525    1.1377    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n   -3.4647    0.4725    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n   -2.6812    0.7308    0.0000 N   0  0  0  0  0  0  0  0  0  0  0  0\n   -2.6848    1.5558    0.0000 C   0  0  2  0  0  0  0  0  0  0  0  0\n   -1.9703    1.9683    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n   -1.9703    2.7933    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n   -1.2558    1.5558    0.0000 R#  0  0  0  0  0  0  0  0  0  0  0  0\n   -2.0978    0.1474    0.0000 R#  0  0  0  0  0  0  0  0  0  0  0  0\n  1  2  1  0  0  0  0\n  5  1  1  1  0  0  0\n  2  3  1  0  0  0  0\n  3  4  1  0  0  0  0\n  4  5  1  0  0  0  0\n  5  6  1  0  0  0  0\n  6  7  2  0  0  0  0\n  6  8  1  0  0  0  0\n  4  9  1  0  0  0  0\nM  RGP  2   8   2   9   1\nM  END\n\n$$$$\n",rs:2,at:{R2:"OH",R1:"H"}},s:{id:"S",n:"Serine",na:"S",m:"\n  JSDraw  08190820582D          \n\n  8  7  0  0  0  0            999 V2000\n   -2.0394    2.5340    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n   -2.0394    3.3589    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n   -2.7539    1.2964    0.0000 N   0  0  0  0  0  0  0  0  0  0  0  0\n   -2.7539    2.1214    0.0000 C   0  0  1  0  0  0  0  0  0  0  0  0\n   -3.4683    2.5340    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n   -4.1827    2.1215    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n   -1.3249    2.1215    0.0000 R#  0  0  0  0  0  0  0  0  0  0  0  0\n   -3.4684    0.8839    0.0000 R#  0  0  0  0  0  0  0  0  0  0  0  0\n  2  1  2  0  0  0  0\n  1  4  1  0  0  0  0\n  1  7  1  0  0  0  0\n  4  3  1  0  0  0  0\n  4  5  1  1  0  0  0\n  5  6  1  0  0  0  0\n  3  8  1  0  0  0  0\nM  RGP  2   7   2   8   1\nM  END\n\n$$$$\n",rs:2,at:{R2:"OH",R1:"H"}},r:{id:"R",n:"Arginine",na:"R",m:"\n  JSDraw  08190814412D          \n\n 13 12  0  0  0  0            999 V2000\n    8.4822   -2.8352    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    7.7677   -3.2478    0.0000 C   0  0  2  0  0  0  0  0  0  0  0  0\n    7.0532   -2.8351    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    6.3388   -3.2477    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    5.6244   -2.8351    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    7.7676   -4.0214    0.0000 N   0  0  0  0  0  0  0  0  0  0  0  0\n    8.4822   -2.0102    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n    4.9099   -3.2477    0.0000 N   0  0  0  0  0  0  0  0  0  0  0  0\n    4.1954   -2.8351    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    4.1954   -2.0101    0.0000 N   0  0  0  0  0  0  0  0  0  0  0  0\n    3.4810   -3.2477    0.0000 N   0  0  0  0  0  0  0  0  0  0  0  0\n    9.1967   -3.2477    0.0000 R#  0  0  0  0  0  0  0  0  0  0  0  0\n    6.9708   -4.2349    0.0000 R#  0  0  0  0  0  0  0  0  0  0  0  0\n  7  1  2  0  0  0  0\n  1  2  1  0  0  0  0\n  1 12  1  0  0  0  0\n  2  6  1  0  0  0  0\n  2  3  1  1  0  0  0\n  3  4  1  0  0  0  0\n  4  5  1  0  0  0  0\n  5  8  1  0  0  0  0\n  8  9  1  0  0  0  0\n  9 11  1  0  0  0  0\n  9 10  2  0  0  0  0\n  6 13  1  0  0  0  0\nM  RGP  2  12   2  13   1\nM  END\n\n$$$$\n",rs:2,at:{R2:"OH",R1:"H"}},y:{id:"Y",n:"Tyrosine",na:"Y",m:"\n  JSDraw  08190820432D          \n\n 14 14  0  0  0  0            999 V2000\n   -2.8122    1.4277    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n   -3.5268    0.1903    0.0000 N   0  0  0  0  0  0  0  0  0  0  0  0\n   -2.8121    2.2527    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n   -3.5267    1.0153    0.0000 C   0  0  1  0  0  0  0  0  0  0  0  0\n   -4.2412    1.4279    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n   -4.9557    1.0154    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n   -5.6701    1.4280    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n   -6.3846    1.0155    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n   -5.6702   -0.2220    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n   -4.9558    0.1904    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n   -6.3847    0.1905    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n   -7.0992   -0.2219    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n   -2.0977    1.0151    0.0000 R#  0  0  0  0  0  0  0  0  0  0  0  0\n   -4.2412   -0.2222    0.0000 R#  0  0  0  0  0  0  0  0  0  0  0  0\n  3  1  2  0  0  0  0\n  1  4  1  0  0  0  0\n  1 13  1  0  0  0  0\n  4  2  1  0  0  0  0\n  4  5  1  1  0  0  0\n  5  6  1  0  0  0  0\n 10  6  1  0  0  0  0\n  7  6  2  0  0  0  0\n  7  8  1  0  0  0  0\n  8 11  2  0  0  0  0\n 11  9  1  0  0  0  0\n  9 10  2  0  0  0  0\n 11 12  1  0  0  0  0\n  2 14  1  0  0  0  0\nM  RGP  2  13   2  14   1\nM  END\n\n$$$$\n",rs:2,at:{R2:"OH",R1:"H"}}};scil.helm.Monomers.sugars={r:{id:"R",n:"Ribose",na:"R",m:"\n  JSDraw  06150820452D          \n\n 12 12  0  0  0  0            999 V2000\n    1.4617    2.2807    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n    0.7479    1.8672    0.0000 C   0  0  1  0  0  0  0  0  0  0  0  0\n    2.1768    1.8692    0.0000 C   0  0  2  0  0  0  0  0  0  0  0  0\n    0.9625    1.0707    0.0000 C   0  0  2  0  0  0  0  0  0  0  0  0\n    1.9644    1.0721    0.0000 C   0  0  1  0  0  0  0  0  0  0  0  0\n    0.9637    0.2457    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n    1.9656    0.2471    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n    0.5994    2.7216    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    2.1756    2.9004    0.0000 R#  0  0  0  0  0  0  0  0  0  0  0  0\n    0.1279    3.0752    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n   -0.6971    3.2298    0.0000 R#  0  0  0  0  0  0  0  0  0  0  0  0\n    1.6650   -0.3083    0.0000 R#  0  0  0  0  0  0  0  0  0  0  0  0\n  1  2  1  0  0  0  0\n  1  3  1  0  0  0  0\n  2  4  1  0  0  0  0\n  2  8  1  1  0  0  0\n  3  5  1  0  0  0  0\n  3  9  1  1  0  0  0\n  4  5  1  0  0  0  0\n  4  6  1  6  0  0  0\n  5  7  1  6  0  0  0\n  6 12  1  0  0  0  0\n  8 10  1  0  0  0  0\n 10 11  1  0  0  0  0\nM  RGP  3   9   3  11   1  12   2\nM  END\n\n$$$$\n",rs:3,at:{R3:"OH",R1:"H",R2:"H"}}};scil.helm.Monomers.linkers={p:{id:"P",n:"Phosphate",na:"P",m:"\n  JSDraw  06150820472D          \n\n  5  4  0  0  0  0            999 V2000\n    0.1179    0.7366    0.0000 P   0  0  0  0  0  0  0  0  0  0  0  0\n   -0.7071    0.7366    0.0000 R#  0  0  0  0  0  0  0  0  0  0  0  0\n    0.1179    1.5616    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n    0.9429    0.7366    0.0000 R#  0  0  0  0  0  0  0  0  0  0  0  0\n    0.1179   -0.0884    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n  1  2  1  0  0  0  0\n  1  3  2  0  0  0  0\n  1  4  1  0  0  0  0\n  1  5  1  0  0  0  0\nM  RGP  2   2   1   4   2\nM  END\n\n$$$$\n",rs:2,at:{R1:"OH",R2:"OH"}}};scil.helm.Monomers.bases={g:{id:"G",n:"Guanine",na:"G",m:"\n  JSDraw  06150820502D          \n\n 12 13  0  0  0  0            999 V2000\n   -1.7509   -3.8489    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n   -1.0364   -4.2614    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n   -1.0364   -5.0864    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n   -1.7509   -5.4989    0.0000 N   0  0  0  0  0  0  0  0  0  0  0  0\n   -2.4654   -5.0864    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n   -2.4654   -4.2614    0.0000 N   0  0  0  0  0  0  0  0  0  0  0  0\n   -0.3220   -5.4989    0.0000 N   0  0  0  0  0  0  0  0  0  0  0  0\n    0.3925   -5.0864    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    0.3925   -4.2614    0.0000 N   0  0  0  0  0  0  0  0  0  0  0  0\n   -1.7509   -3.0239    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n   -3.1798   -5.4989    0.0000 N   0  0  0  0  0  0  0  0  0  0  0  0\n   -0.3220   -6.3239    0.0000 R#  0  0  0  0  0  0  0  0  0  0  0  0\n  1 10  2  0  0  0  0\n  1  6  1  0  0  0  0\n  1  2  1  0  0  0  0\n  9  2  1  0  0  0  0\n  2  3  2  0  0  0  0\n  7  3  1  0  0  0  0\n  3  4  1  0  0  0  0\n  4  5  2  0  0  0  0\n  5  6  1  0  0  0  0\n  5 11  1  0  0  0  0\n  7  8  1  0  0  0  0\n  7 12  1  0  0  0  0\n  8  9  2  0  0  0  0\nM  RGP  1  12   1\nM  END\n\n$$$$\n",rs:1,at:{R1:"H"}},a:{id:"A",n:"Adenine",na:"A",m:"\n  JSDraw  06150816552D          \n\n 11 12  0  0  0  0            999 V2000\n   -4.0674   -0.7795    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n   -3.3529   -1.1920    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n   -3.3529   -2.0170    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n   -4.0674   -2.4295    0.0000 N   0  0  0  0  0  0  0  0  0  0  0  0\n   -4.7818   -2.0170    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n   -4.7818   -1.1920    0.0000 N   0  0  0  0  0  0  0  0  0  0  0  0\n   -2.6384   -2.4295    0.0000 N   0  0  0  0  0  0  0  0  0  0  0  0\n   -1.9240   -2.0170    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n   -1.9240   -1.1920    0.0000 N   0  0  0  0  0  0  0  0  0  0  0  0\n   -4.0674    0.0455    0.0000 N   0  0  0  0  0  0  0  0  0  0  0  0\n   -2.6384   -3.2545    0.0000 R#  0  0  0  0  0  0  0  0  0  0  0  0\n  1 10  1  0  0  0  0\n  1  6  2  0  0  0  0\n  1  2  1  0  0  0  0\n  9  2  1  0  0  0  0\n  2  3  2  0  0  0  0\n  7  3  1  0  0  0  0\n  3  4  1  0  0  0  0\n  4  5  2  0  0  0  0\n  5  6  1  0  0  0  0\n  7  8  1  0  0  0  0\n  7 11  1  0  0  0  0\n  8  9  2  0  0  0  0\nM  RGP  1  11   1\nM  END\n\n$$$$\n",rs:1,at:{R1:"H"}},c:{id:"C",n:"Cytosine",na:"C",m:"\n  JSDraw  06150820522D          \n\n  9  9  0  0  0  0            999 V2000\n   -1.3611   -7.5896    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n   -0.6466   -8.0021    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n   -0.6466   -8.8271    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n   -1.3611   -9.2396    0.0000 N   0  0  0  0  0  0  0  0  0  0  0  0\n   -2.0755   -8.8271    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n   -2.0755   -8.0021    0.0000 N   0  0  0  0  0  0  0  0  0  0  0  0\n   -1.3611   -6.7646    0.0000 N   0  0  0  0  0  0  0  0  0  0  0  0\n   -2.7900   -9.2396    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n   -1.3611  -10.0646    0.0000 R#  0  0  0  0  0  0  0  0  0  0  0  0\n  1  2  1  0  0  0  0\n  1  6  2  0  0  0  0\n  1  7  1  0  0  0  0\n  2  3  2  0  0  0  0\n  3  4  1  0  0  0  0\n  4  5  1  0  0  0  0\n  4  9  1  0  0  0  0\n  5  6  1  0  0  0  0\n  5  8  2  0  0  0  0\nM  RGP  1   9   1\nM  END\n\n$$$$\n",rs:1,at:{R1:"H"}},u:{id:"U",n:"Uracil",na:"U",m:"\n  JSDraw  06150820512D          \n\n  9  9  0  0  0  0            999 V2000\n   -1.2138  -11.7383    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n   -0.4993  -12.1508    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n   -0.4993  -12.9758    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n   -1.2138  -13.3884    0.0000 N   0  0  0  0  0  0  0  0  0  0  0  0\n   -1.9283  -12.9758    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n   -1.9283  -12.1508    0.0000 N   0  0  0  0  0  0  0  0  0  0  0  0\n   -1.2138  -10.9133    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n   -2.6427  -13.3883    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n   -1.2138  -14.2134    0.0000 R#  0  0  0  0  0  0  0  0  0  0  0  0\n  1  7  2  0  0  0  0\n  1  6  1  0  0  0  0\n  1  2  1  0  0  0  0\n  2  3  2  0  0  0  0\n  3  4  1  0  0  0  0\n  4  5  1  0  0  0  0\n  4  9  1  0  0  0  0\n  5  8  2  0  0  0  0\n  5  6  1  0  0  0  0\nM  RGP  1   9   1\nM  END\n\n$$$$\n",rs:1,at:{R1:"H"}},t:{id:"T",n:"Thymine",na:"T",m:"\n  JSDraw  06150820542D          \n\n 10 10  0  0  0  0            999 V2000\n    5.8512   -2.0140    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    6.5686   -2.4215    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    6.5744   -3.2465    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    5.8628   -3.6641    0.0000 N   0  0  0  0  0  0  0  0  0  0  0  0\n    5.1454   -3.2565    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    5.1396   -2.4315    0.0000 N   0  0  0  0  0  0  0  0  0  0  0  0\n    5.8455   -1.1891    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n    4.4339   -3.6740    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n    5.8686   -4.4891    0.0000 R#  0  0  0  0  0  0  0  0  0  0  0  0\n    7.3655   -2.2080    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n  1  7  2  0  0  0  0\n  1  6  1  0  0  0  0\n  1  2  1  0  0  0  0\n  2  3  2  0  0  0  0\n  3  4  1  0  0  0  0\n  4  5  1  0  0  0  0\n  4  9  1  0  0  0  0\n  5  8  2  0  0  0  0\n  5  6  1  0  0  0  0\n  2 10  1  0  0  0  0\nM  RGP  1   9   1\nM  END\n\n$$$$\n",rs:1,at:{R1:"H"}}};scil.helm.Monomers.chems={example:{id:"Example",n:"Symmetric Doubler",na:null,m:"\n  JSDraw  09241011262D          \n\n 23 22  0  0  0  0            999 V2000\n   -3.8304    2.5045    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n   -3.8304    1.6795    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n   -3.1159    1.2670    0.0000 N   0  0  0  0  0  0  0  0  0  0  0  0\n   -2.4014    1.6795    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n   -1.6869    1.2670    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n   -0.9725    1.6795    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n   -0.2580    1.2670    0.0000 N   0  0  0  0  0  0  0  0  0  0  0  0\n    0.4565    1.6795    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    0.4565    2.5045    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n   -1.6869    0.4420    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n    1.1709    2.9170    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    1.1709    3.7420    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    1.8854    4.1545    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n    1.8854    4.9795    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n   -4.5448    2.9170    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n   -4.5448    3.7420    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n   -5.2593    4.1545    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n   -5.2593    4.9795    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n    1.1709    1.2670    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n   -4.5448    1.2670    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0\n   -2.0994   -0.2725    0.0000 R#  0  0  0  0  0  0  0  0  0  0  0  0\n   -5.9738    5.3920    0.0000 R#  0  0  0  0  0  0  0  0  0  0  0  0\n    2.5999    5.3920    0.0000 R#  0  0  0  0  0  0  0  0  0  0  0  0\n  1  2  1  0  0  0  0\n  2  3  1  0  0  0  0\n  3  4  1  0  0  0  0\n  4  5  1  0  0  0  0\n  5  6  1  0  0  0  0\n  6  7  1  0  0  0  0\n  7  8  1  0  0  0  0\n  8  9  1  0  0  0  0\n  5 10  1  0  0  0  0\n  9 11  1  0  0  0  0\n 11 12  1  0  0  0  0\n 12 13  1  0  0  0  0\n 13 14  1  0  0  0  0\n  1 15  1  0  0  0  0\n 15 16  1  0  0  0  0\n 16 17  1  0  0  0  0\n 17 18  1  0  0  0  0\n  8 19  2  0  0  0  0\n  2 20  2  0  0  0  0\n 10 21  1  0  0  0  0\n 18 22  1  0  0  0  0\n 14 23  1  0  0  0  0\nM  RGP  3  21   1  22   2  23   3\nM  END\n\n$$$$\n",rs:3,at:{R1:"H",R2:"H",R3:"H"}},r:{id:"R",n:"R",na:null,m:null,rs:0,at:{}}};scil.helm.Plugin=scil.extend(scil._base,{constructor:function(c){this.jsd=c;this.monomerexplorer=null},getMF:function(c){return scil.helm.Formula.getMF(this.jsd.m,c)},getMW:function(){return scil.helm.Formula.getMW(this.jsd.m)},getExtinctionCoefficient:function(){return scil.helm.ExtinctionCoefficient.calculate(this.jsd.m)},getSpareRs:function(c,n){if(!scil.helm.isHelmNode(c)){return[]}var h=scil.helm.Monomers.getMonomer(c);if(h==null){return null}if(h.id=="?"){return"?"}if(n==null){n=[]}else{n.splice(0,n.length)}for(var j in h.at){var g=parseInt(j.substr(1));n[g]=true}var q=[];var f=this.jsd.m.getNeighborBonds(c);for(var g=0;g<f.length;++g){var d=f[g];if(d.a1==c){q[d.r1]=true;if(n[d.r1]!=null){n[d.r1]=false}}else{if(d.a2==c){q[d.r2]=true;if(n[d.r2]!=null){n[d.r2]=false}}}}var l=[];for(var g=1;g<=n.length;++g){if(n[g]){l.push(g)}}if(l.length==0&&c.biotype()==scil.helm.HELM.BLOB){return"?"}return l.length==0?null:l},expandNode:function(d){var z=scil.helm.Monomers.getMonomer(d);var D=scil.helm.Interface.createMol(scil.helm.monomers.getMolfile(z));var n={};var y=this.jsd.m;var j=scil.helm.Chain.getChain(y,d);var g=y.getNeighborBonds(d);for(var w=0;w<g.length;++w){var f=g[w];var l=scil.helm.MolViewer.connectMol(y,d,f,D);n[l.r]=l.a}var C=[];for(var w=0;w<D.atoms.length;++w){var E=D.atoms[w];if(E.elem=="R"){C.push(E)}}for(var w=0;w<C.length;++w){scil.helm.MolViewer.capRGroup(D,C[w].alias,z)}y.atoms.splice(scil.Utils.indexOf(y.atoms,d),1);D.setBondLength(this.jsd.bondlength);var h=D.center();if(n.R1!=null&&n.R2!=null){if(n.R1.p.x>n.R2.p.x){D.flipX(h.x)}}D.offset(d.p.x-h.x,d.p.y-h.y);y.atoms=y.atoms.concat(D.atoms);y.bonds=y.bonds.concat(D.bonds);if(j!=null){var x=[];var B=null;for(var w=0;w<j.atoms.length;++w){if(j.atoms[w]==d){B=[]}else{(B==null?x:B).push(j.atoms[w])}}if(n.R1!=null&&x.length>0){var A={x:n.R1.p.x-this.jsd.bondlength*2,y:n.R1.p.y};var q=A.x-x[x.length-1].p.x;var u=A.y-x[x.length-1].p.y;for(var w=0;w<x.length;++w){x[w].p.offset(q,u)}}if(n.R2!=null&&B.length>0){var A={x:n.R2.p.x+this.jsd.bondlength*2,y:n.R2.p.y};var q=A.x-B[0].p.x;var u=A.y-B[0].p.y;for(var w=0;w<B.length;++w){B[w].p.offset(q,u)}}}return true},setAtomProp:function(j){var c=JSDraw2.Atom.cast(j);if(c==null){return}if(this.atomPropDlg==null){var h=this;var g={elem:{label:"Monomer Symbol"},tag:{label:"Annotation"}};this.atomPropDlg=scil.Form.createDlgForm("Monomer Attributes",g,{label:"Save",onclick:function(){h.setAtomProp2()}})}else{this.atomPropDlg.show()}var f=c.elem;if(f=="?"&&!scil.Utils.isNullOrEmpty(c.bio.ambiguity)){f=c.bio.ambiguity}if(f=="Blob"||f=="Group"){this.atomPropDlg.form.fields.elem.setAttribute("readonly","readonly")}else{this.atomPropDlg.form.fields.elem.removeAttribute("readonly")}var d={elem:f,tag:c.tag};this.atomPropDlg.form.setData(d);this.atomPropDlg.atom=c},setAtomProp2:function(){var g=this.atomPropDlg.form.getData();g.elem=scil.Utils.trim(g.elem);g.tag=scil.Utils.trim(g.tag);if(scil.Utils.isNullOrEmpty(g.elem)){scil.Utils.alert("Monomer Type cannot be blank");return}var h=false;var d=this.jsd.clone();var c=this.atomPropDlg.atom;if(c.elem!=g.elem||(c.tag==null?"":c.tag)!=g.tag){var l=scil.helm.Monomers.getMonomerSet(c.biotype());var j=l[scil.helm.symbolCase(g.elem)];if(j==null){if(!scil.helm.isAmbiguous(g.elem,c.biotype())){g.elem="("+g.elem+")";if(!scil.helm.isAmbiguous(g.elem,c.biotype())){scil.Utils.alert("Invalid Monomer Type");return}}c.elem="?";c.bio.ambiguity=g.elem}else{c.elem=g.elem;c.bio.ambiguity=null}h=true;c.tag=g.tag==""?null:g.tag}this.atomPropDlg.hide();if(h){this.jsd.pushundo(d);this.jsd.refresh(true)}},setBondProp:function(l){var c=JSDraw2.Bond.cast(l);if(c==null){return}var g={};var d=this._getDisplayName(c,g,1);var f=this._getDisplayName(c,g,2);if(!d&&!f){return}g.a1ratio=c.ratio1;g.a2ratio=c.ratio2;if(this.bondPropDlg==null){var j=this;var h={a1:{label:"Monomer #1",viewonly:true},a1pos:{label:"Position"},a1r:{label:"R#"},a1ratio:{label:"Ratio",type:"number",accepts:"^[?]$"},a2:{label:"Monomer #2",viewonly:true},a2pos:{label:"Position"},a2r:{label:"R#"},a2ratio:{label:"Ratio",type:"number",accepts:"^[?]$"}};this.bondPropDlg=scil.Form.createDlgForm("Bond Attributes",h,{label:"Save",onclick:function(){j.setBondProp2()}})}else{this.bondPropDlg.show()}this.bondPropDlg.form.fields.a1pos.disabled=!d;this.bondPropDlg.form.fields.a1r.disabled=!d;this.bondPropDlg.form.fields.a2pos.disabled=!f;this.bondPropDlg.form.fields.a2r.disabled=!f;if(scil.Utils.isNullOrEmpty(g.a1ratio)){g.a1ratio=scil.helm.defaultbondratio}if(scil.Utils.isNullOrEmpty(g.a2ratio)){g.a2ratio=scil.helm.defaultbondratio}this.bondPropDlg.form.setData(g);this.bondPropDlg.bond=c},_getDisplayName:function(g,h,j){var c="a"+j;var q="r"+j;var f="a"+j+"r";var d="a"+j+"pos";var n=false;if(scil.helm.isBlobEx(g[c])){n=true;h[c]=g[c].elem;var l=typeof(g[q])=="string"?g[q].indexOf(":"):-1;if(l>0){h[d]=g[q].substr(0,l);h[f]=g[q].substr(l+1)}else{h[f]=g[q]}}else{h[c]=g[c].elem;h.a1r=g[q]}return n},setBondProp2:function(){var g=this.bondPropDlg.form.getData();this.bondPropDlg.hide();if(g.a1ratio=="?"||g.a2ratio=="?"){g.a1ratio=g.a2ratio="?"}else{if(g.a1ratio==""){g.a1ratio=scil.helm.defaultbondratio}if(g.a2ratio==""){g.a2ratio=scil.helm.defaultbondratio}}var h=false;var d=this.jsd.clone();var c=this.bondPropDlg.bond;if(scil.helm.isBlobEx(c.a1)){if(this._makeBondR(g.a1pos,g.a1r,c,"r1")){h=true}}if(!this._isRatioEq(c.ratio1,g.a1ratio)){c.ratio1=g.a1ratio>0||g.a1ratio=="?"?g.a1ratio:null;h=true}if(scil.helm.isBlobEx(c.a2)){if(this._makeBondR(g.a2pos,g.a2r,c,"r2")){h=true}}if(!this._isRatioEq(c.ratio2,g.a2ratio)){c.ratio2=g.a2ratio>0||g.a2ratio=="?"?g.a2ratio:null;h=true}if(h){this.jsd.pushundo(d);this.jsd.refresh(true)}},_isRatioEq:function(c,d){if(!(c>0||c=="?")||c==""){c=null}if(!(d>0||d=="?")||d==""){d=null}return c==d},_makeBondR:function(f,g,c,d){if(f!=null){f=f.trim()}if(scil.Utils.isNullOrEmpty(f)){f="?"}if(g!=null){g=g.trim()}if(scil.Utils.isNullOrEmpty(g)){g="?"}var h=f+":"+(!isNaN(g)&&g>0?"R"+g:g);if(c[d]==h){return false}c[d]=h;return true},expandSuperAtom:function(d){var c=JSDraw2.Atom.cast(d);if(c==null||c.bio==null||!scil.helm.isHelmNode(c)){return false}this.jsd.pushundo();if(this.groupExpand(c)){this.jsd.refresh(true)}return true},hasSpareR:function(c,h){if(c==null){return false}if(!scil.helm.isHelmNode(c)){return true}if(typeof(h)=="string"&&scil.Utils.startswith(h,"R")){h=parseInt(h.substr(1))}if(c.biotype()==scil.helm.HELM.BLOB){return true}var j=this.getSpareRs(c);if(j==null||j.indexOf(h)<0){return false}var f=this.jsd.m.getNeighborBonds(c);for(var g=0;g<f.length;++g){var d=f[g];if(d.a1==c&&d.r1==h){return false}else{if(d.a2==c&&d.r2==h){return false}}}return true},getDefaultNodeType:function(d,g,f){var j=null;if(this.monomerexplorer!=null){j=this.monomerexplorer.selected[d]}if(f&&j==""){return j}if(!scil.Utils.isNullOrEmpty(j)){return j}var l=scil.helm.Monomers.getMonomerSet(d);var h=l==null||this.jsd._keypresschar==null?null:l[this.jsd._keypresschar];if(h!=null){return h.id}if(g!=null){return g}return scil.helm.Monomers.getDefaultMonomer(d)},setNodeType:function(c,d,f){return scil.helm.setNodeType(c,d,f)},setNodeTypeFromGui:function(c,h){var g=scil.helm.Monomers.getMonomer(c,h);if(g!=null){c.elem=h;return true}var d=scil.helm.isAmbiguous(h,c.biotype());if(!d){h="("+h+")";d=scil.helm.isAmbiguous(h,c.biotype())}if(d){c.elem="?";c.bio.ambiguity=h;return true}scil.Utils.alert("Unknown monomer type: "+h);return false},cancelDnD:function(){if(this.monomerexplorer!=null){this.monomerexplorer.dnd.cancel()}},replaceMonomer:function(h,f,l,q){var j=0;var d=this.jsd.m.atoms;for(var g=0;g<d.length;++g){var c=d[g];if((q&&c.selected||!q)&&f==c.elem&&(h==""||h==c.biotype())){if(this.setNodeType(c,c.biotype(),l)){++j}}}return j},makeComplementaryStrand:function(c){var d=scil.helm.Chain.getChain(this.jsd.m,c);if(d==null){return null}return d.makeComplementaryStrand(this.jsd.m,this.jsd.bondlength)},makeHairpin:function(c){var d=scil.helm.Chain.getChain(this.jsd.m,c);if(d==null){return null}var g=scil.helm.AutoPair.makeHairpin(this.jsd.m,d.bases);if(g){this.clean(c);this.jsd.moveCenter()}return g},pairDuplex:function(){var c=scil.helm.Chain.getChains(this.jsd.m);if(c==null||c.length!=2){return null}var d=scil.helm.AutoPair.pairDuplex(this.jsd.m,c[0].bases,c[1].bases);if(d){this.clean();this.jsd.moveCenter()}return d},removeHydrogenBonds:function(){var f=0;for(var d=this.jsd.m.bonds.length-1;d>=0;--d){var c=this.jsd.m.bonds[d];if(c.type==JSDraw2.BONDTYPES.UNKNOWN){this.jsd.m.bonds.splice(d,1);++f}}return f>0},setHelmBlobType:function(c,d){if(c.biotype()==scil.helm.HELM.BLOB&&c.bio.blobtype!=d){this.jsd.pushundo();c.bio.blobtype=d;this.jsd.refresh(true)}},createGroup:function(c,t,C){var A=[];var w=this.jsd.m.graphics;for(var x=0;x<w.length;++x){if(JSDraw2.Group.cast(w[x])!=null&&w[x].selected){A.push(w[x])}}if(A.length>1){return this.createGroup2(A,t)}A=[];var j=this.jsd.m.atoms;for(var x=0;x<j.length;++x){if(j[x].selected){A.push(j[x])}}if(A.length==0){return false}var n=null;var q=scil.helm.Chain.getChains(this.jsd.m);if(q.length>0){var d=A[0];for(var x=0;x<q.length;++x){if(scil.Utils.indexOf(q[x].atoms,d)>=0){n=q[x];break}}}if(n==null){return false}for(var x=0;x<A.length;++x){if(scil.Utils.indexOf(n.atoms,A[x])<0&&scil.Utils.indexOf(n.bases,A[x])<0){scil.Utils.alert("All monomer should be in one chain");return false}}var B=[];for(var x=0;x<n.bonds.length;++x){var l=n.bonds[x];var y=scil.Utils.indexOf(A,l.a1);var z=scil.Utils.indexOf(A,l.a2);if(y<0&&z>=0||y>=0&&z<0){B.push({bond:l,ai:y>=0?1:2})}}var u=this.createGroup2(A,t);if(u!=null&&B.length>0){var D=this.collapseGroup(u);scil.helm.Layout.resetIDs(D.superatom,true);this.groupExpand(D);for(var x=0;x<B.length;++x){var l=B[x];if(l.ai==1){var f=l.bond.a1;l.bond.a1=D;l.bond.r1=f._aaid+":R"+l.bond.r1}else{var h=l.bond.a2;l.bond.a2=D;l.bond.r2=h._aaid+":R"+l.bond.r2}}}if(u!=null&&C){scil.helm.Layout.resetIDs(this.jsd.m)}return u!=null},createGroup2:function(h,c){var d=new JSDraw2.Group("","helmgroup");d.gap=10;this.jsd.m.addGraphics(d);for(var f=0;f<h.length;++f){h[f].group=d}if(c){this.collapseGroup(d)}return d},collapseGroup:function(d,c){if(JSDraw2.Group.cast(d)==null){return null}this.jsd.m.clearFlag();var f=this._collapseGroup(d);if(f!=null&&c){this.clean()}return f},_collapseGroup:function(n){var y=n.a!=null?n.a:scil.helm.Interface.createAtom(this.jsd.m,new JSDraw2.Point());var w=new JSDraw2.Mol();y.superatom=w;y.hidden=null;y.group=n.group;y.ratio=n.ratio;y.tag=n.tag;this.setNodeType(y,scil.helm.HELM.BLOB,"group");var t=scil.clone(this.jsd.m.graphics);for(var u=0;u<t.length;++u){var q=t[u];if(q.group==n){this._collapseGroup(q)}}var f=this.jsd.m.atoms;for(var u=f.length-1;u>=0;--u){var c=f[u];if(c.group==n){w.atoms.push(c);c.f=true;c.selected=false;f.splice(u,1)}}var d=0;var l=[];var j=this.jsd.m.bonds;for(var u=j.length-1;u>=0;--u){var h=j[u];if(h.a1.f!=h.a2.f){++d;l.push(h);if(h.a1.f){h.a1.attachpoints.push(d);h.a1=y;h.apo1=d}else{h.a2.attachpoints.push(d);h.a2=y;h.apo2=d}}else{if(h.a1.f&&h.a2.f){w.bonds.push(h);j.splice(u,1)}}}var x=scil.helm.Layout.getRect(w.atoms);y.p=x.center();this.jsd.m.delGraphics(n);return y},groupExpand:function(d){if(d==null||d.superatom==null){return false}var q=d.superatom;var h=this.jsd.m.getAllBonds(d);for(var n=0;n<h.length;++n){var f=h[n];if(f.a1==d){var t=this.findAtomByAP(q,f.apo1);if(t!=null){f.a1=t;scil.Utils.delFromArray(t.attachpoints,f.apo1);f.apo1=null}}else{var t=this.findAtomByAP(q,f.apo2);if(t!=null){f.a2=t;scil.Utils.delFromArray(t.attachpoints,f.apo2);f.apo2=null}}}var j=q.rect().center();q.offset(d.p.x-j.x,d.p.y-j.y);this.jsd.m.mergeMol(q);var l=new JSDraw2.Group("","helmgroup");l.gap=10;this.jsd.m.addGraphics(l);for(var n=0;n<q.atoms.length;++n){q.atoms[n].group=l}l.a=d;l.group=d.group;l.ratio=d.ratio;l.tag=d.tag;d.superatom=null;d.hidden=true;return true},findAtomByAP:function(g,d){for(var f=0;f<g.atoms.length;++f){var c=g.atoms[f];if(scil.Utils.indexOf(c.attachpoints,d)>=0){return c}}return null},applyRule:function(c){scil.helm.RuleSet.applyRule(this,c)},applyRules:function(c){scil.helm.RuleSet.applyRules(this,c)},addNode:function(j,f,g){g=scil.helm.IO.trimBracket(g);var h=scil.helm.Monomers.getMonomer(f,g);if(h==null){h=scil.helm.Monomers.addSmilesMonomer(f,g)}var d=null;if(h==null&&scil.helm.isAmbiguous(g,f)){h=scil.helm.Monomers.getMonomer(f,"?");d=g}if(h==null){scil.Utils.alert("Unknown "+f+" monomer name: "+g);return null}var c=scil.helm.Interface.createAtom(this.jsd.m,j);this.setNodeType(c,f,h.id==null?g:h.id);c.bio.ambiguity=d;return c},addBond:function(c,d,g,h){if(c==null||d==null||c==d||g!="?"&&!this.hasSpareR(c,g)||h!="?"&&!this.hasSpareR(d,h)){return null}var f=scil.helm.Interface.createBond(this.jsd.m,c,d);f.r1=g;f.r2=h;return f},addHydrogenBond:function(c,d){if(c==null||d==null||c==d){return null}var f=scil.helm.Interface.createBond(this.jsd.m,c,d);f.type=JSDraw2.BONDTYPES.UNKNOWN;return f},connnectGroup:function(j,f){var g=this.jsd.toggle(j);var h=f;var n=JSDraw2.Atom.cast(g);var q=JSDraw2.Atom.cast(h);var l=false;if(n==null){var c=JSDraw2.Group.cast(g);if(c!=null&&!scil.Utils.isNullOrEmpty(c.ratio)){l=true;c.ratio=null}n=this.collapseGroup(c);this.groupExpand(n)}if(q==null){var d=JSDraw2.Group.cast(h);if(d!=null&&!scil.Utils.isNullOrEmpty(d.ratio)){l=true;d.ratio=null}q=this.collapseGroup(d);this.groupExpand(q)}if(l){scil.Utils.alert("Ratios on groups are removed")}if(n!=null&&q!=null){this.connectFragment(n,q);this.jsd.moveCenter();return true}return false},connectFragment:function(d,f,n){var g=this.jsd.m.findBond(d,f);if(g!=null){return null}var c=null;var q=null;var u=d.p.x<f.p.x?d:f;if(d.p.x>f.p.x){var A=d;d=f;f=A}var l=scil.helm.bondscale*this.jsd.bondlength;var h=d.biotype();var j=f.biotype();var x=this.getSpareRs(d);var y=this.getSpareRs(f);if((x==null||y==null)){if(this.canPair(d,f)&&this.jsd.m.findBond(d,f)==null){g=scil.helm.Interface.createBond(this.jsd.m,d,f,JSDraw2.BONDTYPES.UNKNOWN);this.finishConnect(n)}else{var z="";if(x==null&&y==null){z="Both monomers don't"}else{if(x==null){z="Monomer, "+d.elem+(d.bio.id==null?"":d.bio.id)+", doesn't"}else{if(y==null){z="Monomer, "+f.elem+(f.bio.id==null?"":f.bio.id)+", doesn't"}}}scil.Utils.alert(z+" have any connecting point available");this.finishConnect(n)}return g}if(x.length<=1&&y.length<=1){if(h==scil.helm.HELM.LINKER){h=scil.helm.HELM.SUGAR}if(j==scil.helm.HELM.LINKER){j=scil.helm.HELM.SUGAR}if(!scil.helm.allowHeadToHeadConnection){if(h==j&&(h==scil.helm.HELM.SUGAR||h==scil.helm.HELM.AA)&&x[0]==y[0]&&(x[0]==1||x[0]==2)){scil.Utils.alert("head-to-head / tail-to-tail connection is not allowed");return}}q=this.jsd.getFragment(f);g=this.addBond(d,f,x[0],y[0])}else{if(n){this.jsd.refresh()}var w=this;this.chooseRs(x,y,d,f,function(t,B){q=w.jsd.getFragment(f);g=w.addBond(d,f,t,B);w.finishConnect(n,g,true)});return}this.finishConnect(n,g);return g},canPair:function(c,d){if(c.biotype()==scil.helm.HELM.BASE&&d.biotype()==scil.helm.HELM.BASE){var f=c.elem;var g=d.elem;return f=="A"&&(g=="T"||g=="U")||(f=="T"||f=="U")&&g=="A"||f=="G"&&g=="C"||f=="C"&&g=="G"}return false},needLinker:function(){var c=this.getDefaultNodeType(scil.helm.HELM.LINKER);return c!="null"},finishConnect:function(f,c,d){if(d!=false){this.clean(null)}this.jsd.refresh(f||c!=null)},chooseRs:function(n,q,c,d,f){if(this.chooseRDlg==null){var l=this;var g={s1:{label:"Monomer 1",type:"jsdraw",width:240,height:150,viewonly:true,style:{border:"solid 1px gray"}},r1:{type:"select",width:120},g:{type:"div"},s2:{label:"Monomer 2",type:"jsdraw",width:240,height:150,viewonly:true,style:{border:"solid 1px gray"}},r2:{type:"select",width:120}};this.chooseRDlg=scil.Form.createDlgForm("Choose Connecting Points",g,{label:"OK",width:240,onclick:function(){l.chooseRs2()}})}this.chooseRDlg.callback=f;this.chooseRDlg.show2({owner:this.jsd});this._listRs(this.chooseRDlg.form.fields.r1,n,2);this._listRs(this.chooseRDlg.form.fields.r2,q,1);this.chooseRDlg.form.fields.r1.disabled=n.length<=1;this.chooseRDlg.form.fields.r2.disabled=q.length<=1;var h=scil.helm.Monomers.getMonomer(c);var j=scil.helm.Monomers.getMonomer(d);this.chooseRDlg.form.fields.s1.jsd.setMolfile(scil.helm.Monomers.getMolfile(h));this.chooseRDlg.form.fields.s2.jsd.setMolfile(scil.helm.Monomers.getMolfile(j));var t=scil.Utils.getParent(this.chooseRDlg.form.fields.s1,"TR");var u=scil.Utils.getParent(this.chooseRDlg.form.fields.s2,"TR");t.childNodes[0].innerHTML=c.elem+(c.bio==null||c.bio.id==null?"":c.bio.id);u.childNodes[0].innerHTML=d.elem+(d.bio==null||d.bio.id==null?"":d.bio.id);this.chooseRDlg.rs1=n;this.chooseRDlg.rs2=q},chooseRs2:function(){var c=this.chooseRDlg.form.getData();if(scil.Utils.isNullOrEmpty(c.r1)&&this.chooseRDlg.rs1.length>0||scil.Utils.isNullOrEmpty(c.r2)&&this.chooseRDlg.rs2.length>0){scil.Utils.alert("Please select Rs for both Nodes");return}this.chooseRDlg.hide();this.chooseRDlg.callback(c.r1==null||c.r1=="?"?c.r1:parseInt(c.r1),c.r2==null||c.r2=="?"?c.r2:parseInt(c.r2))},_listRs:function(f,d,h){var g={};for(var c=0;c<d.length;++c){g[d[c]+""]=d[c]=="?"?"?":("R"+d[c])}scil.Utils.listOptions(f,g,h==null?null:(h+""),true,false)},changeMonomer:function(c,d){var f=this.getDefaultNodeType(c.biotype());if(!scil.Utils.isNullOrEmpty(f)&&c.elem!=f&&f!="null"&&c.biotype()!=scil.helm.HELM.BLOB){this.jsd.pushundo(d);this.setNodeType(c,c.biotype(),f);this.jsd.refresh(true)}else{scil.Utils.beep()}},extendChain:function(c,j,x,y,h){var C=[];var B=this.getSpareRs(c,C);if(B==null){scil.Utils.alert("No connecting points available");this.jsd.redraw();return}var l=y.x>x.x?scil.helm.bondscale*this.jsd.bondlength:-scil.helm.bondscale*this.jsd.bondlength;var w=scil.helm.Interface.createPoint(c.p.x+l,c.p.y);var d=null;var z=null;var A=null;var g=null;if(j=="helm_chem"){if(Math.abs(y.y-x.y)/Math.abs(y.x-x.x)>5){w=scil.helm.Interface.createPoint(c.p.x,c.p.y+Math.abs(l)*(y.y>x.y?1:-1))}d=this.addNode(w,scil.helm.HELM.CHEM,this.getDefaultNodeType(scil.helm.HELM.CHEM));if(d!=null){this.connectFragment(c,d,true);return}}else{if(j=="helm_aa"){if(Math.abs(y.y-x.y)/Math.abs(y.x-x.x)>5){w=scil.helm.Interface.createPoint(c.p.x,c.p.y+Math.abs(l)*(y.y>x.y?1:-1))}d=this.addNode(w,scil.helm.HELM.AA,this.getDefaultNodeType(scil.helm.HELM.AA))}else{if(j=="helm_linker"){d=this.addNode(w,scil.helm.HELM.LINKER,this.getDefaultNodeType(scil.helm.HELM.LINKER))}else{if(j=="helm_sugar"){d=this.addNode(w,scil.helm.HELM.SUGAR,this.getDefaultNodeType(scil.helm.HELM.SUGAR))}else{if(j=="helm_base"){if(c.biotype()==scil.helm.HELM.SUGAR&&this.hasSpareR(c,3)){z=3;A=1;w=scil.helm.Interface.createPoint(c.p.x,c.p.y+Math.abs(l));d=this.addNode(w,scil.helm.HELM.BASE,this.getDefaultNodeType(scil.helm.HELM.BASE))}}else{if(j=="helm_nucleotide"||j=="helm_sugar"){if(Math.abs(y.y-x.y)/Math.abs(y.x-x.x)>5){if(c.biotype()==scil.helm.HELM.SUGAR&&C[3]==true){z=3;A=1;w=scil.helm.Interface.createPoint(c.p.x,c.p.y+Math.abs(l));var D=this.getDefaultNodeType(scil.helm.HELM.BASE,null,true);d=D==""?null:this.addNode(w,scil.helm.HELM.BASE,D)}}else{if(C[1]==true||C[2]==true){var u=this.getDefaultNodeType(scil.helm.HELM.SUGAR,null,true);var n=this.getDefaultNodeType(scil.helm.HELM.LINKER,null,true);var t=null;var E=null;if(l<0){if(C[1]){z=1}else{z=2}}else{if(C[2]){z=2}else{z=1}}A=z==1?2:1;if(z==1){if(n!="null"&&n!=""){t=this.addNode(w.clone(),scil.helm.HELM.LINKER,n);if(u!=""){w.x+=l}}if(u!=""){E=this.addNode(w.clone(),scil.helm.HELM.SUGAR,u)}if(t!=null){g=this.addBond(c,t,z,A);this.addBond(t,E,z,A)}else{g=this.addBond(c,E,z,A)}}else{if(u!=""){E=this.addNode(w.clone(),scil.helm.HELM.SUGAR,u);w.x+=l}if(n!="null"&&n!=""){t=this.addNode(w.clone(),scil.helm.HELM.LINKER,n)}if(t!=null){if(E==null){g=this.addBond(c,t,z,A)}else{g=this.addBond(c,E,z,A);this.addBond(E,t,z,A)}}else{g=this.addBond(c,E,z,A)}}var f=null;if(j=="helm_nucleotide"&&E!=null&&scil.helm.Monomers.hasR(scil.helm.HELM.SUGAR,u,"R3")){var D=this.getDefaultNodeType(scil.helm.HELM.BASE,null,true);if(D!=""){f=this.addNode(E.p.clone(),scil.helm.HELM.BASE,D);this.addBond(E,f,3,1);var q=g.a1.p.x<g.a2.p.x?g.r1:g.r2;if(q==1){f.p.y-=Math.abs(l)}else{f.p.y+=Math.abs(l)}}}this.jsd.pushundo(h);this.finishConnect(false,g)}}}}}}}}if(d!=null){if(z==null||A==null){if(this.hasSpareR(c,2)&&!this.hasSpareR(c,1)){z=2;A=1}else{if(this.hasSpareR(c,1)&&!this.hasSpareR(c,2)){z=1;A=2}else{z=l>0?2:1;A=z==2?1:2}}}g=this.addBond(c,d,z,A)}if(g!=null){this.jsd.pushundo(h);this.finishConnect(false,g)}else{this.jsd.refresh()}},getHelm:function(c,d){return scil.helm.IO.getHelm(this.jsd.m,c,d)},getSequence:function(c){return scil.helm.IO.getSequence(this.jsd.m,c)},getXHelm:function(){return scil.helm.IO.getXHelm(this.jsd.m)},setHelm:function(g,f){this.jsd.clear();var d=0;try{if(!scil.Utils.isNullOrEmpty(g)){d=scil.helm.IO.read(this,g,"HELM",f)}}catch(c){this.jsd.clear();return}if(d>0){this.clean();this.jsd.fitToWindow();this.jsd.refresh()}},setXHelm:function(h){var c=typeof(h)=="string"?scil.Utils.parseXml(h):h;if(c==null){return false}var d=c.getElementsByTagName("HelmNotation");if(d==null||d.length==0){return false}var h=scil.Utils.getInnerText(d[0]);var f=c.getElementsByTagName("Monomers");if(f==null||f.length==0){this.setHelm(h);return}var g=this;scil.helm.monomers.loadMonomers(f[0],function(j){if(g.monomerexplorer!=null){g.monomerexplorer.reloadTabs()}g.setHelm(h,j)})},isXHelm:function(c){var d=c==null?null:c.getElementsByTagName("Xhelm");return d!=null&&d.length==1},showImportDlg:function(){if(this.inputSeqDlg==null){var c={type:{label:"Sequence Type",type:"select",items:["HELM","Peptide","RNA","Nucleotide"]},sequence:{label:"Sequence",type:"textarea",width:800,height:50},separator:{label:"Separator",width:100,str:"(Legacy sequences with dedicated separator, e.g. dC.dA.xE)"}};var d=this;this.inputSeqDlg=scil.Form.createDlgForm("Import Sequence",c,[{label:"Import",onclick:function(){d.importSequence(false)}},{label:"Append",onclick:function(){d.importSequence(true)}}])}this.inputSeqDlg.show2({owner:this.jsd})},importSequence:function(c){var d=this.inputSeqDlg.form.getData();if(this.setSequence(d.sequence,d.type,null,null,c,d.separator)){this.inputSeqDlg.hide()}},setSequence:function(x,g,y,h,c,w){var x=scil.Utils.trim(x);if(/^[a-z]+$/.test(x)){x=x.toUpperCase()}var l=0;var d=this.jsd.clone();this.jsd.clear();try{l=scil.helm.IO.read(this,x,g,null,y,h,w)}catch(f){this.jsd.restoreClone(d);var u=f.message==null?f:f.message;if(!scil.Utils.isNullOrEmpty(u)){scil.Utils.alert("Error: "+u)}return false}if(l>0){this.jsd.pushundo(d);this.clean();if(c){this.jsd.scale(d.bondlength/this.jsd.bondlength);var j=d.mol.clone();var t=j.rect();var q=this.jsd.m.rect();if(q!=null&&t!=null){this.jsd.m.offset(t.center().x-q.center().x,t.bottom()+this.jsd.bondlength*4-q.bottom())}j.mergeMol(this.jsd.m);this.jsd.m=j}this.jsd.fitToWindow();this.jsd.refresh(true)}return true},clean:function(c,d){if(d){this.jsd.pushundo()}scil.helm.Layout.clean(this.jsd,c);if(d){this.jsd.moveCenter();this.jsd.refresh(true)}},resetIDs:function(){scil.helm.Layout.resetIDs(this.jsd.m)},dropMonomer:function(q,j,g){var l=this.jsd.eventPoint(g);if(l.x<=0||l.y<=0||l.x>=this.jsd.dimension.x||l.y>=this.jsd.dimension.y||j=="null"){return false}var h=false;if(this.jsd.curObject==null){var d=q=="nucleotide"?"helm_nucleotide":scil.helm.symbolCase(q);if(this.isHelmCmd(d)){l.offset(this.jsd.bondlength*0.4,this.jsd.bondlength*0.4);this.jsd.pushundo();var c=scil.helm.Interface.createAtom(this.jsd.m,l);this.createIsolatedMonomer(d,c);h=true}}else{var n=scil.helm.Monomers.getMonomerSet(q);if(scil.helm.isAmbiguous(j,q)){var c=scil.helm.Interface.getCurrentAtom(this.jsd);if(c==null||!scil.helm.isHelmNode(c)||c.biotype()!=q||c.elem==j){return false}}else{if(n==null||n[scil.helm.symbolCase(j)]==null){return false}j=n[scil.helm.symbolCase(j)].id;var c=scil.helm.Interface.getCurrentAtom(this.jsd);if(c==null||!scil.helm.isHelmNode(c)||c.biotype()!=q||c.elem==j){return false}}this.jsd.pushundo();this.setNodeType(c,c.biotype(),j);h=true}if(h){this.jsd.refresh(true)}return h},showFindReplaceDlg:function(){if(this.findDlg==null){var c={finding:{label:"Find",width:400,str:"<div>(Monomer symbol or position)</div>"},monomertype:{label:"Monomer Type",type:"select",sort:false,items:scil.helm.monomerTypeList()},replacewith:{label:"Replace With",width:400},selectedonly:{label:"Scope",type:"checkbox",str:"Search Selected Only"}};var d=this;this.findDlg=scil.Form.createDlgForm("Find and Replace",c,[{label:"Find",onclick:function(){d.showFindReplaceDlg2("find")}},{label:"Find All",onclick:function(){d.showFindReplaceDlg2("findall")}},{label:"Replace All",onclick:function(){d.showFindReplaceDlg2("replaceall")}}])}this.findDlg.show2({owner:this.jsd})},showFindReplaceDlg2:function(c){var d=this.findDlg.form.getData();if(scil.Utils.isNullOrEmpty(d.finding)||c=="replaceall"&&scil.Utils.isNullOrEmpty(d.replacewith)){scil.Utils.alert("Find and Replace With cannot be blank");return}if(c=="find"){this.find(d.finding,false,d.monomertype,d.selectedonly)}else{if(c=="findall"){this.find(d.finding,true,d.monomertype,d.selectedonly)}else{if(c=="replaceall"){this.replaceAll(d.finding,d.replacewith,d.monomertype,d.selectedonly)}}}},getSelectedAtoms:function(){var f=[];var c=this.jsd.m.atoms;for(var d=0;d<c.length;++d){if(c[d].selected){f.push(c[d])}}return f},find:function(c,l,t,w){var g=w?this.getSelectedAtoms():this.jsd.m.atoms;this.jsd.m.setSelected(false);var u=0;var f=null;if(/^[0-9]+$/.test(c)){var d=parseInt(c);for(var q=0;q<g.length;++q){if(g[q].bio!=null&&d==g[q].bio.id&&(scil.Utils.isNullOrEmpty(t)||t==g[q].biotype())){++u;g[q].selected=true;f=g[q];break}}}else{for(var q=0;q<g.length;++q){if(c==g[q].elem&&(t==""||t==g[q].biotype())){++u;g[q].selected=true;if(!l){f=g[q];break}}}}if(l){scil.Utils.alert(u+" node(s) found")}else{if(u==0){scil.Utils.alert("Cannot find "+c)}else{scil.helm.Interface.scaleCanvas(this.jsd);var h=this.jsd.dimension.x/2-f.p.x;var j=this.jsd.dimension.y/2-f.p.y;this.jsd.m.offset(h,j)}}if(u>0){this.jsd.redraw()}},findRNACombo:function(d){var l=null;var g=this.jsd.m.getNeighborAtoms(d);for(var f=0;f<g.length;++f){var h=g[f];if(scil.helm.HELM.SUGAR==h.biotype()){l=h;break}}var j=null;var g=this.jsd.m.getNeighborBonds(l);for(var f=0;f<g.length;++f){var c=g[f];var h=c.otherAtom(l);if(scil.helm.HELM.LINKER==h.biotype()&&(c.a1==l&&c.r1==2&&c.r2==1||c.a2==l&&c.r2==2&&c.r1==1)){j=h;break}}return{base:d,ribose:l,phosphate:j}},replaceAll:function(c,d,q,w,x){var u=scil.helm.Monomers.parseNucleotide(d);var t=0;var h=this.jsd.clone();if(typeof(c)=="number"||/^[0-9]+$/.test(c)){var f=typeof(c)=="number"?c:parseInt(c);var g=w?this.getSelectedAtoms():this.jsd.m.atoms;for(var l=0;l<g.length;++l){if(g[l].bio!=null&&f==g[l].bio.id){if(u!=null&&scil.helm.HELM.BASE==g[l].biotype()){var j=this.findRNACombo(g[l]);if(this.setNodeType(j.base,j.base.biotype(),u.base)&&(j.ribose==null||this.setNodeType(j.ribose,j.ribose.biotype(),u.ribose))&&(j.phosphate==null||this.setNodeType(j.phosphate,j.phosphate.biotype(),u.phosphate))){++t}}else{if(q==""||q==g[l].biotype()){if(this.setNodeType(g[l],g[l].biotype(),d)){++t}}}break}}}else{t=this.replaceMonomer(q,c,d,w)}if(t>0&&!x){this.jsd.pushundo(h);this.jsd.refresh(true)}if(!x){scil.Utils.alert(t+" node(s) replaced")}},dblclickMomonor:function(h,g){if(g=="null"){return}var f=[];var c=this.jsd.m.atoms;for(var d=0;d<c.length;++d){if(c[d].selected&&c[d].biotype()==h&&c[d].elem!=g){f.push(c[d])}}if(f.length>0){this.jsd.pushundo();for(var d=0;d<f.length;++d){this.setNodeType(f[d],f[d].biotype(),g)}this.jsd.refresh(true)}return f.length},isHelmCmd:function(c){return c=="helm_nucleotide"||c=="helm_base"||c=="helm_sugar"||c=="helm_chem"||c=="helm_aa"||c=="helm_linker"||c=="helm_blob"},createIsolatedMonomer:function(g,c){if(g=="helm_nucleotide"){var l=this.monomerexplorer==null?null:scil.Utils.getInnerText(this.monomerexplorer.lastdiv);if(l=="*"){this.setNodeType(c,scil.helm.HELM.NUCLEOTIDE,"*");return true}var j=this.getDefaultNodeType(scil.helm.HELM.SUGAR,null,true);if(j==""){var h=this.getDefaultNodeType(scil.helm.HELM.LINKER);this.setNodeType(c,scil.helm.HELM.LINKER,h)}else{this.setNodeType(c,scil.helm.HELM.SUGAR,j);if(scil.helm.Monomers.hasR(scil.helm.HELM.SUGAR,j,"R3")){var l=this.getDefaultNodeType(scil.helm.HELM.BASE,null,true);if(!scil.Utils.isNullOrEmpty(l)){var f=this.addNode(scil.helm.Interface.createPoint(c.p.x,c.p.y+this.jsd.bondlength*scil.helm.bondscale),scil.helm.HELM.BASE,l);this.addBond(c,f,3,1)}}var h=this.getDefaultNodeType(scil.helm.HELM.LINKER);if(h==null||h=="null"){return}var d=this.addNode(scil.helm.Interface.createPoint(c.p.x+this.jsd.bondlength*scil.helm.bondscale,c.p.y),scil.helm.HELM.LINKER,h);this.addBond(c,d,2,1)}}else{if(g=="helm_base"){this.setNodeType(c,scil.helm.HELM.BASE,this.getDefaultNodeType(scil.helm.HELM.BASE))}else{if(g=="helm_sugar"){this.setNodeType(c,scil.helm.HELM.SUGAR,this.getDefaultNodeType(scil.helm.HELM.SUGAR))}else{if(g=="helm_linker"){this.setNodeType(c,scil.helm.HELM.LINKER,this.getDefaultNodeType(scil.helm.HELM.LINKER))}else{if(g=="helm_aa"){this.setNodeType(c,scil.helm.HELM.AA,this.getDefaultNodeType(scil.helm.HELM.AA))}else{if(g=="helm_chem"){this.setNodeType(c,scil.helm.HELM.CHEM,this.getDefaultNodeType(scil.helm.HELM.CHEM))}else{if(g=="helm_blob"){this.setNodeType(c,scil.helm.HELM.BLOB,this.getDefaultNodeType(scil.helm.HELM.BLOB));this.setHelmBlobType(c,scil.helm.blobtypes[0])}else{return false}}}}}}}return true}});scil.helm.Chain=scil.extend(scil._base,{constructor:function(c){this.id=c;this.bonds=[];this.atoms=[];this.basebonds=[];this.bases=[]},containsBothAtoms:function(c){return scil.Utils.indexOf(this.atoms,c.a1)>=0&&scil.Utils.indexOf(this.atoms,c.a2)>=0},getComplementary:function(c){var d=scil.helm.Monomers.getMonomer(c);switch(d.na){case"A":return"T";case"G":return"C";case"T":case"U":return"A";case"C":return"G";default:return"U"}},makeComplementaryStrand:function(w,l){var x=new scil.helm.Chain(null);var t=null;var u=null;var n=l*scil.helm.bondscale;for(var q=0;q<this.atoms.length;++q){var c=this.atoms[q];var g=this.bases[q];var f=c.clone();x.atoms.splice(0,0,f);f.p.y+=3*n;f.bio.annotation=null;w.addAtom(f);if(g!=null){var h=g.clone();x.bases.splice(0,0,h);h.p.y+=n;h.elem=this.getComplementary(g);w.addAtom(h);var j=new JSDraw2.Bond(f,h);x.basebonds.splice(0,0,j);j.r1=3;j.r2=1;w.addBond(j);j=new JSDraw2.Bond(g,h,JSDraw2.BONDTYPES.UNKNOWN);w.addBond(j)}else{x.bases.splice(0,0,null)}if(t!=null){var j=new JSDraw2.Bond(t,f);x.bonds.splice(0,0,j);j.r1=1;j.r2=2;w.addBond(j)}t=f;if(f.biotype()==scil.helm.HELM.SUGAR){u=f;f.elem=scil.helm.Monomers.getDefaultMonomer(scil.helm.HELM.SUGAR)}else{if(f.biotype()==scil.helm.HELM.LINKER){f.elem=scil.helm.Monomers.getDefaultMonomer(scil.helm.HELM.LINKER)}}}if(u!=null){u.bio.annotation="5'"}x.resetIDs();return x},_getPolymers:function(){var l=[];var j=null;var h=this.isCircle()?this.atoms.length-1:this.atoms.length;for(var g=0;g<h;++g){var c=this.atoms[g];var f=c.biotype();if(f==scil.helm.HELM.AA){if(j!=null&&j.type!="Peptide"){j=null}if(j==null){j={type:"Peptide",atoms:[]};l.push(j)}j.atoms.push(c)}else{if(f==scil.helm.HELM.SUGAR||f==scil.helm.HELM.HELM_LINKER){if(j!=null&&j.type!="RNA"){j=null}if(f==scil.helm.HELM.SUGAR){var d=this.bases[g];if(d!=null){if(j==null){j={type:"RNA",atoms:[]};l.push(j)}j.atoms.push(d)}}}else{j=null}}}return l},getMol:function(c,j){var h=scil.helm.Monomers.getMonomer(c);var g=scil.helm.monomers.getMolfile(h);var f=scil.helm.Interface.createMol(g);if(j!=null){for(var l in h.at){if(j.hasSpareR(c,l)){scil.helm.MolViewer.capRGroup(f,l,h)}}}for(var d=0;d<f.atoms.length;++d){f.atoms[d]._helmgroup=c}return f},_expandBackbone:function(w,y){var l=null;var q=null;var x=this.isCircle()?this.atoms.length-1:this.atoms.length;for(var j=0;j<x;++j){var c=this.atoms[j];var g=this.bases[j];c.f=true;q=this.getMol(c,y);if(g!=null){var u=this.getMol(g,y);scil.helm.MolViewer.mergeMol(q,"R3",u,"R1",c,g)}if(l==null){l=q}else{var z,A;var d,f;var h=this.bonds[j-1];if(h.a2==c){A=h.r2;z=h.r1;d=h.a1;f=h.a2}else{A=h.r1;z=h.r2;d=h.a2;f=h.a1}scil.helm.MolViewer.mergeMol(l,"R"+z,q,"R"+A,d,f)}}if(this.isCircle()){var h=this.bonds[x-1];var C=scil.helm.MolViewer.findR(l,"R"+h.r1,h.a1);var B=scil.helm.MolViewer.findR(l,"R"+h.r2,h.a2);if(C!=null&&B!=null){l.atoms.splice(scil.Utils.indexOf(l.atoms,C.a1),1);l.atoms.splice(scil.Utils.indexOf(l.atoms,B.a1),1);l.bonds.splice(scil.Utils.indexOf(l.bonds,B.b),1);if(C.b.a1==C.a1){C.b.a1=B.a0}else{C.b.a2=B.a0}}}w.atoms=w.atoms.concat(l.atoms);w.bonds=w.bonds.concat(l.bonds)},_connectBranches:function(h,l,f){if(f==null||f.bonds==null){return}var j=this.isCircle()?this.atoms.length-1:this.atoms.length;for(var g=0;g<j;++g){var c=this.atoms[g];this._connectBranches2(h,c,f,l);var d=this.bases[g];if(d!=null){this._connectBranches2(h,d,f,l)}}},_connectBranches2:function(l,c,h,q){var t=null;var u=null;var d=null;var f=null;for(var j=0;j<h.bonds.length;++j){var g=h.bonds[j];if(g==null){continue}if(g.a1==c&&!g.a2.f){t=g.r1;u=g.r2;d=g.a1;f=g.a2}else{if(g.a2==c&&!g.a1.f){t=g.r2;u=g.r1;d=g.a2;f=g.a1}}if(f!=null){g.f=true;break}}if(f==null){return}var n=this.getMol(f,q);scil.helm.MolViewer.mergeMol(l,"R"+t,n,"R"+u,c,f)},isCircle:function(){return this.atoms.length>=3&&this.atoms[0]==this.atoms[this.atoms.length-1]},resetIDs:function(q){var f=0;var c=0;var g=0;var l=this.isCircle()?this.atoms.length-1:this.atoms.length;for(var j=0;j<l;++j){var d=this.atoms[j];var h=d.biotype();if(h==scil.helm.HELM.AA){d._aaid=++c;d.bio.id=++f;if(f==1){d.bio.annotation="n"}else{d.bio.annotation=null}g=0}else{if(h==scil.helm.HELM.SUGAR||h==scil.helm.HELM.LINKER){if(h==scil.helm.HELM.SUGAR&&this.bases[j]!=null){d._aaid=++c;this.bases[j]._aaid=++c;this.bases[j].bio.id=++g;if(g==1){if(d.bio.annotation!="5'ss"&&d.bio.annotation!="5'as"){d.bio.annotation="5'"}}else{d.bio.annotation=null}}f=0;c=0}else{f=0;c=0;g=0}}}},setFlag:function(c){for(var d=0;d<this.atoms.length;++d){this.atoms[d].f=c}for(var d=0;d<this.bonds.length;++d){this.bonds[d].f=c}},containsAtom:function(c){return scil.Utils.indexOf(this.atoms,c)!=-1},hasBase:function(){for(var c=0;c<this.bases.length;++c){if(this.bases[c]!=null){return true}}return false},layoutLine:function(d){var j=this.getRect();var f=scil.helm.bondscale*d;var c=this.atoms[0];c.p=scil.helm.Interface.createPoint(j.left,j.top);for(var g=1;g<this.atoms.length;++g){var h=c.p;c=this.atoms[g];c.p=scil.helm.Interface.createPoint(h.x+f,h.y)}},layoutRows:function(c,d){var h=0;var f=scil.helm.bondscale*c;var l=this.atoms[0].p.x;for(var g=1;g<this.atoms.length;++g){++h;var j=this.atoms[g-1].p;if(h>=d){h=0;this.bonds[g-1].shape="Z";this.atoms[g].p=scil.helm.Interface.createPoint(l,j.y+Math.abs(f))}else{this.atoms[g].p=scil.helm.Interface.createPoint(j.x+f,j.y)}}},layoutCircle:function(c){var d=360/(this.atoms.length-1);scil.helm.Layout.layoutCircle(this.atoms,c,d,0)},rotate:function(d,h){if(d==0){return}var g=this.isCircle()?this.atoms.length-1:this.atoms.length;for(var f=0;f<g;++f){if(h!=null){this.atoms[f].p.rotateAround(h,d)}else{this.atoms[f].p.rotate(d)}var c=this.bases[f];if(c!=null){if(h!=null){c.p.rotateAround(h,d)}else{c.p.rotate(d)}}}},move:function(d){var g=this.isCircle()?this.atoms.length-1:this.atoms.length;for(var f=0;f<g;++f){this.atoms[f].p.offset2(d);var c=this.bases[f];if(c!=null){c.p.offset2(d)}}},findInnerBasePairs:function(h){if(h==null){return null}var j=[];for(var d=0;d<h.bonds.length;++d){var c=h.bonds[d];var f=scil.Utils.indexOf(this.bases,c.a1);var g=scil.Utils.indexOf(this.bases,c.a2);if(f>=0&&g>=0){j.push({b:c,i1:f,i2:g})}}return j},layoutBases:function(w,l){var C={};if(w!=null&&l>0){var z=this.findInnerBasePairs(w);if(z!=null){for(var u=0;u<z.length;++u){var y=z[u];C[y.i1]=C[y.i2]=true;var A=this.atoms[y.i1];var B=this.atoms[y.i2];var h=this.bases[y.i1];var j=this.bases[y.i2];h.p=B.p.clone().setLength(l,A.p);j.p=A.p.clone().setLength(l,B.p)}}}var t=this.isCircle();var x=t?this.atoms.length-1:this.atoms.length;for(var u=0;u<x;++u){var c=this.bases[u];if(c==null||C[u]){continue}var q=this.atoms[u];var h=null;var j=null;if(u==0){if(t){h=this.bonds[this.bonds.length-1]}j=this.bonds[u]}else{h=this.bonds[u-1];j=this.bonds[u]}if(h!=null&&j!=null){var d=h.a1==q?h.a2:h.a1;var f=j.a1==q?j.a2:j.a1;var g=q.p.angleAsOrigin(d.p,f.p);if(Math.abs(g-180)>10){c.p=d.p.clone().rotateAround(q.p,180+g/2)}else{c.p=d.p.clone().rotateAround(q.p,-90)}}else{if(h!=null){var d=h.a1==q?h.a2:h.a1;c.p=d.p.clone().rotateAround(q.p,-90)}else{if(j!=null){var f=j.a1==q?j.a2:j.a1;c.p=f.p.clone().rotateAround(q.p,90)}}}}},getRect:function(){return scil.helm.Layout.getRect(this.atoms)},getSequence:function(j){var w="";var u=this.isCircle()?this.atoms.length-1:this.atoms.length;var q=null;for(var l=0;l<u;++l){var d=this.atoms[l];var g=d.biotype();if(g==scil.helm.HELM.AA){var t=scil.helm.Monomers.getMonomer(d);if(t!=null){if(q!=scil.helm.HELM.AA){if(w.length>0&&w.substr(w.length-1)!="-"){w+="-"}}var h=scil.Utils.isNullOrEmpty(t.na)?"?":t.na;if(j&&d.selected){h="<span style='background:#bbf;'>"+h+"</span>"}w+=h}}else{if(g==scil.helm.HELM.SUGAR){var f=this.bases[l];var t=scil.helm.Monomers.getMonomer(f);if(t!=null){if(q!=scil.helm.HELM.SUGAR&&q!=scil.helm.HELM.LINKER){if(w.length>0&&w.substr(w.length-1)!="-"){w+="-"}}var h=scil.Utils.isNullOrEmpty(t.na)?"?":t.na;if(j&&f.selected){h="<span style='background:#bbf;'>"+h+"</span>"}w+=h}}}q=g}return w},getHelm:function(I,u,B,t){var L=[];var d=0;var q=null;var A=null;var C=this.isCircle()?this.atoms.length-1:this.atoms.length;var h=[];var z=null;var l=0;for(var w=0;w<C;++w){var c=this.atoms[w];var g=c.biotype();if(g==scil.helm.HELM.LINKER||g==scil.helm.HELM.SUGAR||g==scil.helm.HELM.NUCLEOTIDE){g=scil.helm.HELM.BASE}if(g!=z||g==scil.helm.HELM.CHEM||g==scil.helm.HELM.BLOB){var D=null;if(g==scil.helm.HELM.BASE){D="RNA"}else{if(g==scil.helm.HELM.AA){D="PEPTIDE"}else{if(g==scil.helm.HELM.CHEM){D="CHEM"}else{if(g==scil.helm.HELM.BLOB){if(c.elem=="Group"){D="G"}else{if(c.bio.blobtype=="protein"){D="PEPTIDE"}else{D="BLOB"}}}}}}var K=D+(++I.chainid[D]);if(D=="G"){scil.helm.IO.getGroupHelm(I,K,c,u);if(this.atoms.length==1){I.groupatoms[K]=c}}if(w==0){if(c.biotype()==scil.helm.HELM.SUGAR&&(c.bio.annotation=="5'ss"||c.bio.annotation=="5'as")){I.annotations[K]={strandtype:c.bio.annotation.substr(2)}}}if(w>0&&A!=null){var x=this.atoms[w-1];var f=this.bonds[w-1];var E=f.a1==x?f.r1:f.r2;var F=f.a1==x?f.r2:f.r1;var G=f.a1==x?f.ratio1:f.ratio2;var H=f.a1==x?f.ratio2:f.ratio1;c._aaid=1;scil.helm.IO.addConnection(I,A,K,x,c,E,F,G,H,null,u&&f.selected);if(!scil.Utils.startswith(A,"G")){++l;I.sequences[A]=this._getSequence(L,B)}I.chains[A]=h}if(q==null){q=K}h=[];d=0;L=[];A=K;z=g}c._aaid=++d;h.push(c);L.push({atoms:[],code:"",type:c.biotype()});var j=scil.helm.IO.getCode(c,u);L[L.length-1].atoms.push(c);if(this.bases[w]!=null){var f=this.bases[w];j+=scil.helm.IO.getCode(f,u,true);L[L.length-1].atoms.push(f);f._aaid=++d;h.push(f)}L[L.length-1].code+=j}if(L.length>0){if(!scil.Utils.startswith(A,"G")){I.sequences[A]=this._getSequence(L,B);if(l==0&&t!=null&&!scil.Utils.isNullOrEmpty(t.ratio)){I.ratios[A]=t.ratio}}I.chains[A]=h;if(t!=null&&q==A&&!scil.Utils.isNullOrEmpty(t.tag)){h.annotation=t.tag}}if(this.isCircle()){var y=this.atoms[this.atoms.length-1];var f=this.bonds[this.bonds.length-1];if(y==f.a1){var J=q;q=A;A=J}scil.helm.IO.addConnection(I,q,A,f.a1,f.a2,f.r1,f.r2,null,null,f.tag,u&&f.selected)}},_getSequence:function(y,q){var x="";var t=false;for(var g=0;g<y.length;++g){if(g>0){if(t||!(y[g-1].type==scil.helm.HELM.SUGAR&&y[g].type==scil.helm.HELM.LINKER)){x+=".";t=false}}var d=this._getBracket(y[g].atoms[0],q);var w=d==null?null:d.getSubscript(q);if(!scil.Utils.isNullOrEmpty(w)){var f=-1;var c=scil.clone(d.atoms);for(var l=g;l<y.length;++l){var n=y[l].atoms;for(var h=0;h<n.length;++h){var u=scil.Utils.indexOf(c,n[h]);if(u>=0){c.splice(u,1)}else{f=-2;break}}if(f==-2){break}if(c.length==0){f=l;break}}if(f>=0){if(x.length>0&&!scil.Utils.endswith(x,".")){x+="."}if(g==f){x+=y[g].code}else{x+="(";var z=g;for(var l=g;l<=f;++l){if(l>z){if(!(y[l-1].type==scil.helm.HELM.SUGAR&&y[l].type==scil.helm.HELM.LINKER)){x+="."}}x+=y[l].code}x+=")"}x+="'"+w+"'";g=f;t=true;continue}}x+=y[g].code}return x},_getBracket:function(c,g){if(g==null){return null}for(var f=0;f<g.graphics.length;++f){var d=JSDraw2.Bracket.cast(g.graphics[f]);if(d==null){continue}if(scil.Utils.indexOf(d.atoms,c)>=0){return d}}return null},getAtomByAAID:function(c){if(!(c>0)){return null}for(var d=0;d<this.atoms.length;++d){if(this.atoms[d]._aaid==c){return this.atoms[d]}}for(var d=0;d<this.bases.length;++d){if(this.bases[d]._aaid==c){return this.bases[d]}}return null}});scil.apply(scil.helm.Chain,{getChain:function(d,f){if(f==null){return null}var c=this._getChains(d,f);return c==null?null:c[0]},getChains:function(d,c){return this._getChains(d,null,c)},_setChainID:function(c,d){for(var f=0;f<c.atoms.length;++f){c.atoms[f]._chainid=d;if(c.bases[f]!=null){c.bases[f]._chainid=d}}},_removeChainID:function(c){for(var d=0;d<c.length;++d){delete c[d]._chainid}},_getChains:function(E,F,n){var h=null;var l=[];var q=[];for(var A=0;A<E.bonds.length;++A){var g=E.bonds[A];if(!scil.helm.isHelmNode(g.a1)||!scil.helm.isHelmNode(g.a2)){continue}if(g.r1==1&&g.r2==2||g.r1==2&&g.r2==1){l.push(g);if(h==null&&F!=null&&g.a1==F||g.a2==F){h=l.length-1}}else{q.push(g)}}if(F!=null&&h==null){return null}var x=[];while(l.length>0){var w=new scil.helm.Chain();x.splice(0,0,w);var g=null;if(h==null){g=l[l.length-1];l.splice(l.length-1,1)}else{g=l[h];l.splice(h,1);h=null}var z=g.r1==2?g.a1:g.a2;var G=g.r2==1?g.a2:g.a1;w.bonds.push(g);w.atoms.push(z);w.atoms.push(G);while(l.length>0){var y=0;for(var A=l.length-1;A>=0;--A){g=l[A];if(g.a1==z||g.a2==z){l.splice(A,1);z=g.a1==z?g.a2:g.a1;w.bonds.splice(0,0,g);w.atoms.splice(0,0,z);++y}else{if(g.a1==G||g.a2==G){l.splice(A,1);G=g.a1==G?g.a2:g.a1;w.bonds.push(g);w.atoms.push(G);++y}}}if(y==0){break}}if(F!=null){break}}E.clearFlag();for(var A=0;A<x.length;++A){var f=x[A].atoms;for(var C=0;C<f.length;++C){f[C].f=true}}if(F==null){var f=E.atoms;for(var C=0;C<f.length;++C){var c=f[C];if(c.f||!scil.helm.isHelmNode(c)){continue}if(c.biotype()!=scil.helm.HELM.BASE){c.f=true;var w=new scil.helm.Chain();x.splice(0,0,w);w.atoms.push(c)}}}for(var A=0;A<x.length;++A){var f=x[A].atoms;var l=x[A].bonds;if(x[A].isCircle()){if(f[0].biotype()==scil.helm.HELM.LINKER&&f[1].biotype()==scil.helm.HELM.SUGAR){f.splice(0,1);f.push(f[0]);l.push(l[0]);l.splice(0,1)}for(var B=0;B<f.length-1;++B){var t=f[B].biotype();if(t==scil.helm.HELM.LINKER){t=scil.helm.HELM.SUGAR}var u=f[B+1].biotype();if(u==scil.helm.HELM.LINKER){u=scil.helm.HELM.SUGAR}if(t!=u){for(var C=0;C<=B;++C){f.splice(0,1);f.push(f[0]);l.push(l[0]);l.splice(0,1)}break}}}for(var C=0;C<f.length;++C){var c=f[C];if(c.biotype()==scil.helm.HELM.SUGAR){for(var B=q.length-1;B>=0;--B){var d=null;var g=q[B];if(g.a1==c&&g.r1==3&&g.r2==1&&g.a2.biotype()==scil.helm.HELM.BASE){d=x[A].bases[C]=g.a2}else{if(g.a2==c&&g.r2==3&&g.r1==1&&g.a1.biotype()==scil.helm.HELM.BASE){d=x[A].bases[C]=g.a1}}if(d!=null){x[A].basebonds.push(g);q.splice(B,1);d.f=true}}}}}if(n!=null){var D=[];for(var A=0;A<q.length;++A){var g=q[A];if(!g.a1.f){g.a1.f=true;D.push(g.a1)}if(!g.a2.f){g.a2.f=true;D.push(g.a2)}}n.bonds=q;n.atoms=D}return x}});scil.helm.Layout={circleshape:false,clean:function(u,d){var x=u.m;var g=u.bondlength;x.clearFlag();var q=scil.helm.Chain._getChains(x,d);scil.helm.Chain._removeChainID(x.atoms);for(var t=0;t<q.length;++t){var l=q[t];scil.helm.Chain._setChainID(l,t);if(!l.hasBase()&&l.atoms.length>50){l.layoutRows(g,10)}else{if(l.isCircle()){l.layoutCircle(g)}else{if(this.circleshape){if(!this.layoutInnerCircle(l,g,x,t)){if(!this.layoutHairpin(l,g,x,t)){l.layoutLine(g)}}}else{if(!this.layoutHairpin(l,g,x,t)){l.layoutLine(g)}}}l.layoutBases(x,scil.helm.bondscale*g)}l.setFlag(true);l.resetIDs()}u.updateGroupRect();this.layoutCrossChainBonds(x,q,g);this.layoutBranches(x);if(!this.circleshape){var n={};for(var t=0;t<x.bonds.length;++t){var f=x.bonds[t];if(f.r1>2||f.r2>2){for(var w=0;w<q.length;++w){if(q[w].containsBothAtoms(f)){if(q[w].isCircle()){f.shape=null}else{if(n[w]==null){n[w]=[]}n[w].push(f)}break}}}}for(var j in n){var h=n[j];for(var t=0;t<h.length;++t){h[t].shape="U";h[t].ushift=this.checkoverlapping(h,t,h[t])}}}scil.helm.Chain._removeChainID(x.atoms)},checkoverlapping:function(d,g,c){for(var j=1;j<50;++j){var h=false;for(var f=0;f<g;++f){if(d[f].ushift==j&&this.xOverlapped(d[f],c)){h=true;break}}if(!h){return j}}return 1},xOverlapped:function(c,d){var f=Math.min(c.a1.p.x,c.a2.p.x);var g=Math.max(c.a1.p.x,c.a2.p.x);var h=Math.min(d.a1.p.x,d.a2.p.x);var j=Math.max(d.a1.p.x,d.a2.p.x);return h>=f&&h<=g||j>=f&&j<=g},layoutFragments:function(h,c){var f=h.splitFragments(true);if(f.length<2){return}var l=f[0].rect();var n=l.center().x;var q=l.bottom()+3*c;for(var g=1;g<f.length;++g){var d=f[g];var j=d.rect();d.offset(n-j.center().x,q-j.top);q+=j.height+3*c}},resetIDs:function(g,c){var d=scil.helm.Chain._getChains(g);for(var f=0;f<d.length;++f){d[f].resetIDs(c)}},layoutHairpin:function(j,h,w,l){var B=[];for(var u=0;u<w.bonds.length;++u){var g=w.bonds[u];if(g.a1._chainid!=null&&g.a2._chainid!=null&&g.a1._chainid==l&&g.a2._chainid==l&&scil.Utils.indexOf(j.bonds,g)<0&&scil.Utils.indexOf(j.basebonds,g)<0){var c=scil.Utils.indexOf(j.bases,g.a1);var d=scil.Utils.indexOf(j.bases,g.a2);if(c>=0&&d>=0){var z={a1:c<d?c:d,a2:c<d?d:c};B.push(z)}}}if(B.length==0){return false}var A=B[0];for(var u=1;u<B.length;++u){var C=B[u];if(C.a1<=A.a1&&C.a1>=A.a2&&C.a1<=A.a1&&C.a1>=A.a2){A=C}else{if(A.a1>C.a1||A.a1<C.a2||A.a2>C.a1||A.a2<C.a2){if(C.a2-C.a1<A.a2-A.a1){A=C}}}}var f=[];for(var u=A.a1;u<=A.a2;++u){f.push(j.atoms[u])}f.push(f[0]);var x=f.length+1;var q=360/x;this.layoutCircle(f,h,-q,q*1.5);var t=scil.helm.bondscale*h;var y=j.atoms[A.a1].p.clone();for(var u=A.a1-1;u>=0;--u){y.x-=t;j.atoms[u].p=y.clone()}y=j.atoms[A.a2].p.clone();for(var u=A.a2+1;u<j.atoms.length;++u){y.x-=t;j.atoms[u].p=y.clone()}return true},layoutInnerCircle:function(j,h,u,l){var z=[];for(var t=0;t<u.bonds.length;++t){var g=u.bonds[t];if(g.a1._chainid!=null&&g.a2._chainid!=null&&g.a1._chainid==l&&g.a2._chainid==l&&scil.Utils.indexOf(j.bonds,g)<0&&scil.Utils.indexOf(j.basebonds,g)<0){var c=scil.Utils.indexOf(j.atoms,g.a1);var d=scil.Utils.indexOf(j.atoms,g.a2);if(c>=0&&d>=0){var x={a1:c<d?c:d,a2:c<d?d:c};z.push(x)}}}if(z.length==0){return false}var y=z[0];for(var t=1;t<z.length;++t){var A=z[t];if(A.a1>=y.a1&&A.a1<=y.a2&&A.a1>=y.a1&&A.a1<=y.a2){y=A}else{if(y.a1<A.a1||y.a1>A.a2||y.a2<A.a1||y.a2>A.a2){if(A.a2-A.a1>y.a2-y.a1){y=A}}}}var f=[];for(var t=y.a1;t<=y.a2;++t){f.push(j.atoms[t])}f.push(f[0]);var n=360/(f.length-1);this.layoutCircle(f,h,n,-n/2);var q=scil.helm.bondscale*h;var w=j.atoms[y.a1].p.clone();for(var t=y.a1-1;t>=0;--t){w.x+=q;j.atoms[t].p=w.clone()}w=j.atoms[y.a2].p.clone();for(var t=y.a2+1;t<j.atoms.length;++t){w.x+=q;j.atoms[t].p=w.clone()}return true},layoutCircle:function(d,f,g,t){var q=this.getRect(d);var l=q.center();var h=scil.helm.bondscale*f;var n=(h/2)/Math.sin((g/2)*Math.PI/180);var c=d[0];c.p=scil.helm.Interface.createPoint(l.x+n,l.y);if(t!=null&&t!=0){c.p.rotateAround(l,t)}for(var j=1;j<d.length-1;++j){d[j].p=d[j-1].p.clone().rotateAround(l,-g)}},layoutCrossChainBonds:function(D,x,l){var A={};for(var B=0;B<D.bonds.length;++B){var j=D.bonds[B];if(!scil.helm.isHelmNode(j.a1)||!scil.helm.isHelmNode(j.a2)){continue}if(j.a1._chainid!=null&&j.a2._chainid!=null&&j.a1._chainid!=j.a2._chainid){var d,f;if(A[j.a1._chainid]&&A[j.a2._chainid]){continue}else{if(A[j.a1._chainid]){d=j.a1;f=j.a2}else{if(A[j.a2._chainid]){d=j.a2;f=j.a1}else{var u=x[j.a1._chainid];var w=x[j.a2._chainid];if(u.atoms.length<w.atoms.length){d=j.a2;f=j.a1}else{d=j.a1;f=j.a2}}}}if(j.type==JSDraw2.BONDTYPES.UNKNOWN){if(j.a1.p.y>j.a2.p.y){f=j.a1;d=j.a2}else{f=j.a2;d=j.a1}var t=x[f._chainid];t.rotate(180);var z=d.p.clone().offset(0,l*scil.helm.bondscale).offset(-f.p.x,-f.p.y);t.move(z)}else{var n=D.getNeighborBonds(d);if(n.length==3){scil.Utils.delFromArray(n,j);var C=j.a1.biotype()==scil.helm.HELM.CHEM||j.a2.biotype()==scil.helm.HELM.CHEM;var F=n[0].otherAtom(d).p;var G=n[1].otherAtom(d).p;var E=new JSDraw2.Point((F.x+G.x)/2,(F.y+G.y)/2);if(E.distTo(d.p)<l/30){E=F.clone();E.rotateAround(d.p,-90,l*(C?2:4))}else{E.rotateAround(d.p,180,l*(C?2:4))}var t=x[f._chainid];E.offset(-f.p.x,-f.p.y);t.move(E);n=D.getNeighborBonds(f);if(n.length==3){scil.Utils.delFromArray(n,j);var y;var q=f.p.clone();var g=d.p.angleTo(q);var F=n[0].otherAtom(f).p;var G=n[1].otherAtom(f).p;var E=new JSDraw2.Point((F.x+G.x)/2,(F.y+G.y)/2);if(E.distTo(q)<l/30){var h=G.angleTo(q);y=(g-h)-90}else{var h=E.angleTo(q);y=(g+180)-h}t.rotate(y,q)}}else{var E=d.p.clone().offset(0,l*3);if(this._hasOverlap(x,A,E,l/30)){E=d.p.clone().offset(0,-l*3)}var z=E.offset(-f.p.x,-f.p.y);x[f._chainid].move(z)}}A[d._chainid]=true;A[f._chainid]=true}}},_hasOverlap:function(d,f,j,l){for(var g=0;g<d.length;++g){if(!f[g]){continue}var c=d[g].atoms;for(var h=0;h<c.length;++h){if(c[h].p.distTo(j)<l){return true}}}return false},layoutBranches:function(x){for(var u=0;u<x.bonds.length;++u){var h=x.bonds[u];if(!scil.helm.isHelmNode(h.a1)||!scil.helm.isHelmNode(h.a2)){continue}if(!h.f&&h.a1.f!=h.a2.f){var t=h.a1.f?h.a1:h.a2;var c=h.a1.f?h.a2:h.a1;var j=null;var l=null;var q=x.getNeighborBonds(t);for(var w=q.length-1;w>=0;--w){var y=q[w];if(y.f){if(j==null&&y.a1==t&&y.r1==2||y.a2==t&&y.r2==2){j=y;q.splice(u,0)}else{if(l==null&&y.a1==t&&y.r1==1||y.a2==t&&y.r2==1){l=y;q.splice(u,0)}}}}if(j!=null||l!=null){if(j!=null&&l!=null){var d=j.a1==t?j.a2:j.a1;var f=l.a1==t?l.a2:l.a1;var g=t.p.angleAsOrigin(d.p,f.p);if(Math.abs(g-180)>10){c.p=d.p.clone().rotateAround(t.p,g/2)}else{c.p=d.p.clone().rotateAround(t.p,90)}}else{if(j!=null){var d=j.a1==t?j.a2:j.a1;c.p=d.p.clone().rotateAround(t.p,180)}else{if(l!=null){var f=l.a1==t?l.a2:l.a1;c.p=f.p.clone().rotateAround(t.p,180)}}}h.f=h.a1.f=h.a2.f=true}}}},getRect:function(d){var c=d[0];var h=c.p.x;var l=c.p.y;var j=h;var n=l;for(var f=1;f<d.length;++f){var g=d[f].p;if(g.x<h){h=g.x}else{if(g.x>j){j=g.x}}if(g.y<l){l=g.y}else{if(g.y>n){n=g.y}}}return scil.helm.Interface.createRect(h,l,j-h,n-l)}};scil.helm.IO={kVersion:"V2.0",getHelm:function(l,f,n){var j=this._makeSmilesMonomers(l.clone());for(var g=0;g<j.atoms.length;++g){var c=j.atoms[g];if(!scil.helm.isHelmNode(c)&&!c.hidden){return null}}var q={chainid:{RNA:0,PEPTIDE:0,CHEM:0,BLOB:0,G:0},sequences:{},connections:[],chains:{},pairs:[],groupatoms:[],groups:{},annotations:{},singletons:{},ratios:{}};this.getHelm2(j,f,q);for(var h in q.chains){var d=q.chains[h];var c=d[0];if(d.length==1&&c.biotype()==scil.helm.HELM.BLOB&&!scil.Utils.isNullOrEmpty(c.tag)){d.annotation=c.tag}}for(var h in q.groups){if(q.groups[h].length==1){q.singletons[h]=q.groups[h][0]}}for(var h in q.singletons){delete q.groups[h]}if(l.chiral!=null){if(q.annotations==null){q.annotations={}}q.annotations.chiral=l.chiral}return this.getHelmString(q,f,n)},getHelm2:function(G,C,I,z){var h={};var u=scil.helm.Chain.getChains(G,h);for(var D=0;D<G.atoms.length;++D){G.atoms[D]._aaid=null}for(var D=0;D<u.length;++D){var t=u[D];t.getHelm(I,C,G,z)}for(var D=0;D<h.atoms.length;++D){var d=h.atoms[D];if(d.biotype()==scil.helm.HELM.CHEM){var E="CHEM"+(++I.chainid.CHEM);I.sequences[E]=this.getCode(d,C);I.chains[E]=[d];d._aaid=1}else{if(d.biotype()==scil.helm.HELM.BLOB){var E;if(d.elem=="Group"){E="G"+(++I.chainid.G);this.getGroupHelm(I,E,d,C)}else{E="BLOB"+(++I.chainid.BLOB);I.sequences[E]=this.getCode(d,C)}I.chains[E]=[d];d._aaid=1}else{return null}}}var B=[];for(var D=0;D<G.graphics.length;++D){var x=JSDraw2.Group.cast(G.graphics[D]);if(x!=null){B.push(x)}}for(var D=0;D<B.length;++D){var x=B[D];if(scil.Utils.isNullOrEmpty(x.tag)){continue}for(var l in I.chains){if(this.allBelongToGroup(I.chains[l],x)){I.chains[l].annotation=x.tag;break}}}for(var E in I.groupatoms){var d=I.groupatoms[E];for(var D=0;D<B.length;++D){var x=B[D];if(x.a==d){B.splice(D,1);this._scanGroup(I,x,E);break}}}var A=[];for(var D=0;D<B.length;++D){var x=B[D];var H="G";var E=H+(++I.chainid[H]);A[D]=E;this._scanGroup(I,x,E)}for(var D=0;D<B.length;++D){var x=B[D];var w=I.groups[A[D]];if(w==null){continue}for(var F=0;F<B.length;++F){var y=B[F];if(y.group==x){var E=A[F];if(scil.Utils.indexOf(w,E)<0){w.push(E)}}}for(var E in I.groupatoms){var d=I.groupatoms[E];if(d.group==x){if(scil.Utils.indexOf(w,E)<0){w.push(E)}break}}}for(var D=0;D<h.bonds.length;++D){var f=h.bonds[D];var K="";if(!scil.Utils.isNullOrEmpty(f.tag)){K='"'+f.tag.replace(/"/g,'\\"')+'"'}if(f.type==JSDraw2.BONDTYPES.UNKNOWN){var n=this.findChainID(I.chains,f.a1);var q=this.findChainID(I.chains,f.a2);var J=n+","+q+","+f.a1._aaid+":pair-"+f.a2._aaid+":pair";I.pairs.push(J+K)}else{var n=this.findChainID(I.chains,f.a1);var q=this.findChainID(I.chains,f.a2);this.addConnection(I,n,q,f.a1,f.a2,f.r1,f.r2,f.ratio1,f.ratio2,f.tag,C&&f.selected)}}},_makeSmilesMonomers:function(u){var j=[];for(var q=u.bonds.length-1;q>=0;--q){var h=u.bonds[q];var D=scil.helm.isHelmNode(h.a1);var E=scil.helm.isHelmNode(h.a2);if(D!=E||scil.helm.isProteinAntibody(h.a1)||scil.helm.isProteinAntibody(h.a2)){j.push(h);u.bonds.splice(q,1)}}if(j.length==0){return u}var A=new JSDraw2.Mol();var n=u.splitFragments();for(var q=0;q<n.length;++q){var l=n[q];if(scil.helm.isHelmNode(l.atoms[0])){A.mergeMol(l);continue}var z=null;if(l.atoms.length==1&&scil.helm.isProteinAntibody(l.atoms[0])){z=l.atoms[0]}var B=0;var w=new JSDraw2.Atom(new JSDraw2.Point());for(var t=j.length-1;t>=0;--t){var h=j[t];var f=scil.Utils.indexOf(l.atoms,h.a1);var g=f>=0?-1:scil.Utils.indexOf(l.atoms,h.a2);if(f>=0||g>=0){++B;var c=l.atoms[f>=0?f:g];var d=new JSDraw2.Atom(new JSDraw2.Point());d.elem="R"+B;var y=new JSDraw2.Bond(c,d);l.atoms.push(d);l.bonds.push(y);if(f>=0){h.r1=h.a1==z?"*":B;h.a1=w}else{h.r2=h.a2==z?"*":B;h.a2=w}j.splice(t,1);A.bonds.push(h)}}if(z!=null){scil.helm.setNodeType(w,scil.helm.HELM.BLOB,"Blob");w.bio.blobtype=="protein"}else{var C=l.getSmiles();var x=scil.helm.Monomers.addSmilesMonomer(scil.helm.HELM.CHEM,C);scil.helm.setNodeType(w,scil.helm.HELM.CHEM,x.id)}A.atoms.push(w)}return A},_scanGroup:function(l,h,j){var f=[];for(var d in l.chains){if(this.allBelongToGroup(l.chains[d],h)){f.push(d);if(!scil.Utils.isNullOrEmpty(h.ratio)){l.ratios[d]=h.ratio}}}l.groups[j]=f;l.ratios[j]=h.ratio},getGroupHelm:function(n,h,c,g){var f={};for(var j in n.sequences){f[j]=true}var l=c.superatom;if(c.hidden){n.groupatoms[h]=c}else{this.getHelm2(l,g,n,c);var d=[];for(var j in n.sequences){if(!f[j]){d.push(j)}}n.groups[h]=d}},addConnection:function(x,j,l,c,d,q,t,u,w,y,n){var f=c.biotype()==scil.helm.HELM.BLOB?"?":c._aaid;var g=d.biotype()==scil.helm.HELM.BLOB?"?":d._aaid;x.connections.push({c1:j,c2:l,ai1:f,ai2:g,r1:q,r2:t,ratio1:u,ratio2:w,tag:y,h:n})},renderConnection:function(g,f){if(g.singletons[f.c1]!=null){f.c1=g.singletons[f.c1];if(f.ai1>0){f.ai1="?"}}if(g.singletons[f.c2]!=null){f.c2=g.singletons[f.c2];if(f.ai2>0){f.ai2="?"}}var d=f.c1+","+f.c2;d+=","+scil.helm.IO.connectionStr(f.ai1,f.r1,f.ai2,f.r2);if(!scil.Utils.isNullOrEmpty(f.tag)){d+='"'+f.tag.replace(/"/g,'\\"')+'"'}if(f.h){d="<span style='background:#bbf;'>"+d+"</span>"}return d},connectionStr:function(c,f,d,g){return this.rStr(c,f)+"-"+this.rStr(d,g)},rStr:function(c,d){if(typeof(d)=="string"&&d.indexOf(":")>0){return d}var f=c+":";if(d=="*"||d=="?"){return f+d}return f+"R"+d},allBelongToGroup:function(c,d){for(var f=0;f<c.length;++f){if(c[f].group!=d){return false}}return true},getHelmString:function(z,l,x){var A="";var u=[];for(var t in z.sequences){u.push(t)}u.sort();for(var n=0;n<u.length;++n){var t=u[n];A+=(A==""?"":"|")+t+"{"+z.sequences[t]+"}";var g=z.chains[t];if(g!=null&&!scil.Utils.isNullOrEmpty(g.annotation)){A+=this.wrapAnnotation(g.annotation)}}if(A==""){return A}var h=0;A+="$";var j=[];for(var n=0;n<z.connections.length;++n){var f=z.connections[n];A+=(++h>1?"|":"")+this.renderConnection(z,f);if((f.ratio1>0||f.ratio1=="?")&&(f.ratio2>0||f.ratio1=="?")){var B=f.c1+":"+f.ratio1+"+"+f.c2+":"+f.ratio2;q="G"+(++z.chainid.G);j.push(q+"("+B+")")}}for(var n=0;n<z.pairs.length;++n){A+=(++h>1?"|":"")+z.pairs[n]}A+="$";var w=[];for(var q in z.groups){var B="";var w=z.groups[q];for(var n=0;n<w.length;++n){var f=w[n];if(z.singletons[f]!=null){f=z.singletons[f]}var y=z.ratios[f];var C=z.ratios[q]=="or"?",":"+";B+=(n>0?C:"")+f+(scil.Utils.isNullOrEmpty(y)?"":":"+y)}j.push(q+"("+B+")")}for(var n=0;n<j.length;++n){A+=(n>0?"|":"")+j[n]}A+="$";if(!scil.Utils.isNullOrEmpty(x)){if(z.annotations==null){z.annotations={}}z.annotations.monomersurl=x}var d=scil.Utils.json2str(z.annotations,null,true);A+=d=="null"||d=="{}"?"":d;A+="$";return A+this.kVersion},getSequence:function(h,f){var c={};var d=scil.helm.Chain.getChains(h,c);if(d==null){return null}var j="";for(var g=0;g<d.length;++g){var l=d[g].getSequence(f);if(scil.Utils.isNullOrEmpty(l)){continue}if(j!=""){j+="\r\n"}j+=l}return j},getXHelm:function(f){var g=this.getHelm(f);if(scil.Utils.isNullOrEmpty(g)){return g}var g="<Xhelm>\n<HelmNotation>"+scil.Utils.escXmlValue(g)+"</HelmNotation>\n";var d=this.getMonomers(f);if(d!=null){g+="<Monomers>\n";for(var c in d){g+=scil.helm.Monomers.writeOne(d[c])}g+="</Monomers>\n"}g+="</Xhelm>";return g},getMonomers:function(h){var l={};var d=h.atoms;for(var g=0;g<d.length;++g){var c=d[g];var f=c.biotype();if(!scil.helm.isHelmNode(c)){continue}var h=scil.helm.Monomers.getMonomer(c);var n=f+" "+c.elem;if(l[n]==null){var q=null;var j=null;if(f==scil.helm.HELM.CHEM){q="CHEM";j="Undefined"}else{if(f==scil.helm.HELM.AA){q="PEPTIDE";j="Undefined"}else{if(f==scil.helm.HELM.SUGAR){q="RNA";j="Backbone"}else{if(f==scil.helm.HELM.BASE){q="RNA";j="Branch"}else{if(f==scil.helm.HELM.LINKER){q="RNA";j="Backbone"}}}}}l[n]={id:c.elem,mt:j,type:q,m:h}}}return l},getCode:function(c,g,f){var j;var d=false;if(typeof(c)=="object"&&c.biotype()==scil.helm.HELM.BLOB){d=true;if(c.elem=="Group"){j="Group"}else{j=c.bio!=null&&scil.Utils.isNullOrEmpty(c.bio.blobtype)?"":c.bio.blobtype}}else{if(typeof(c)=="string"){j=c}else{var h=scil.helm.Monomers.getMonomer(c);if(h.issmiles){j=h.smiles}else{j=c.elem}}if(j=="?"&&c.bio!=null){j=c.bio.ambiguity==null?"?":c.bio.ambiguity}else{if(j.length>1){j="["+j+"]"}}}if(!d){j+=this.wrapAnnotation(c.tag)}if(f){j="("+j+")"}if(g&&c.selected){j="<span style='background:#bbf;'>"+j+"</span>"}return j},wrapAnnotation:function(c){if(!scil.Utils.isNullOrEmpty(c)){return'"'+c.replace(/"/g,'\\"')+'"'}return""},findChainID:function(f,c){for(var g in f){var d=f[g];if(scil.Utils.indexOf(d,c)>=0){return g}}return null},read:function(j,n,f,l,w,g,t){if(scil.Utils.isNullOrEmpty(n)){return 0}var q=n.toUpperCase();if(scil.Utils.isNullOrEmpty(f)){if(/^((RNA)|(PEPTIDE)|(CHEM)|(BLOB))[0-9]+/.test(q)){f="HELM"}else{if(/^[A|G|T|C|U]+[>]?$/.test(q)){f="RNA"}else{if(/^[A|C-I|K-N|P-T|V|W|Y|Z]+[>]?$/.test(q)){f="Peptide"}else{throw"Cannot detect the format using nature monomer names"}}}}var h=scil.helm.Interface.createPoint(0,0);if(f=="HELM"){return this.parseHelm(j,n,h,l)}else{if(f=="Peptide"){var c=new scil.helm.Chain();var d=scil.Utils.endswith(n,">");if(d){n=n.substr(0,n.length-1)}var u=this.splitChars(n,t);if(d){u.push(">")}return this.addAAs(j,u,c,h)}else{if(f=="RNA"){var c=new scil.helm.Chain();var u=this.splitChars(n,t);return this.addRNAs(j,u,c,h,w,g)}else{if(f=="Nucleotide"){var c=new scil.helm.Chain();var u=this.splitChars(n,t);return this.addNucleotides(j,u,c,h)}}}}return 0},parseHelm:function(plugin,s,origin,renamedmonomers){var n=0;var sections=this.split(s,"$");var chains={};var gi=100;var groups={};var groupannotations={};s=sections[0];if(!scil.Utils.isNullOrEmpty(s)){var seqs=this.split(s,"|");for(var i=0;i<seqs.length;++i){var e=this.detachAnnotation(seqs[i]);s=e.str;p=s.indexOf("{");var sid=s.substr(0,p);var type=sid.replace(/[0-9]+$/,"").toUpperCase();var id=parseInt(sid.substr(type.length));var chain=new scil.helm.Chain(sid);chains[sid]=chain;chain.type=type;s=s.substr(p+1);p=s.indexOf("}");s=s.substr(0,p);var n2=0;var ss=this.split(s,".");if(type=="PEPTIDE"){n2=this.addAAs(plugin,ss,chain,origin,renamedmonomers)}else{if(type=="RNA"){n2=this.addHELMRNAs(plugin,ss,chain,origin,renamedmonomers)}else{if(type=="CHEM"){n2=this.addChem(plugin,s,chain,origin,renamedmonomers)}else{if(type=="BLOB"){n2=this.addBlob(plugin,s,chain,origin,renamedmonomers,e.tag)}}}}if(n2>0){n+=n2;origin.y+=4*plugin.jsd.bondlength}if(!scil.Utils.isNullOrEmpty(e.tag)&&groups[sid]==null){++gi;var g="G"+gi;sections[2]+="|"+g+"("+sid+")";groups[sid]=g;groupannotations[g]=e.tag}}}var hydrogenpairs=[];var connections=[];var connatoms={};s=sections[1];if(!scil.Utils.isNullOrEmpty(s)){var ss=s==""?[]:this.split(s,"|");for(var i=0;i<ss.length;++i){if(ss[i].indexOf("pair")>0){hydrogenpairs.push(ss[i]);continue}var e=this.detachAnnotation(ss[i]);var c=this.parseConnection(e.str);if(c==null){continue}if(isNaN(c.a1)&&!/^G[0-9]+$/.test(c.chain1)&&!scil.Utils.startswith(c.chain1,"BLOB")){if(groups[c.chain1]==null){++gi;var g="G"+gi;sections[2]+="|"+g+"("+c.chain1+")";groups[c.chain1]=g}c.chain1=groups[c.chain1]}if(isNaN(c.a2)&&!/^G[0-9]+$/.test(c.chain2)&&!scil.Utils.startswith(c.chain2,"BLOB")){if(groups[c.chain2]==null){++gi;var g="G"+gi;sections[2]+="|"+g+"("+c.chain2+")";groups[c.chain2]=g}c.chain2=groups[c.chain2]}c.tag=e.tag;connections.push(c);connatoms[c.chain1]=true;connatoms[c.chain2]=true}}s=sections[2];var bondratios=[];if(!scil.Utils.isNullOrEmpty(s)){var ss=s==""?[]:this.split(s,"|");for(var i=0;i<ss.length;++i){if(scil.Utils.endswith(ss[i],")")&&/^[G|g][0-9]+[\(]/.test(ss[i])){var p=ss[i].indexOf("(");var c=ss[i].substr(p+1,ss[i].length-p-2);var id=ss[i].substr(0,p);if(connatoms[id]!=null){var chain=this.createGroupForChains(plugin,chains,id,c);if(chain!=null){chains[id]=chain}}else{if(!this.parseBondRatios(bondratios,c)){var chain=this.createGroupForChains(plugin,chains,id,c,groupannotations[id]);if(chain!=null&&chain.atoms.length==1){plugin.groupExpand(chain.atoms[0])}}}}else{hydrogenpairs.push(ss[i])}}}for(var i=0;i<hydrogenpairs.length;++i){var c=this.parseConnection(hydrogenpairs[i]);if(c==null||chains[c.chain1]==null||chains[c.chain2]==null||!scil.Utils.startswith(c.chain1,"RNA")||!scil.Utils.startswith(c.chain2,"RNA")){continue}var atom1=chains[c.chain1].getAtomByAAID(c.a1);var atom2=chains[c.chain2].getAtomByAAID(c.a2);if(atom1==null||atom2==null){continue}if(c.r1!="pair"||c.r2!="pair"){continue}plugin.addHydrogenBond(atom1,atom2)}for(var i=0;i<connections.length;++i){var c=connections[i];if(c==null||chains[c.chain1]==null||chains[c.chain2]==null){continue}if(groups[c.chain1]!=null){c.chain1=groups[c.chain1]}if(groups[c.chain2]!=null){c.chain2=groups[c.chain2]}var chain1=chains[c.chain1];var chain2=chains[c.chain2];var atom1,atom2;var a1=parseInt(c.a1);var a2=parseInt(c.a2);if(a1>0&&!scil.Utils.startswith(c.chain1,"G")&&!scil.Utils.startswith(c.chain1,"BLOB")){atom1=chain1.getAtomByAAID(c.a1)}else{atom1=chain1.atoms[0];c.r1=c.a1+":"+c.r1}if(a2>0&&!scil.Utils.startswith(c.chain2,"G")&&!scil.Utils.startswith(c.chain2,"BLOB")){atom2=chain2.getAtomByAAID(c.a2)}else{atom2=chain2.atoms[0];c.r2=c.a2+":"+c.r2}if(atom1==null||atom2==null){continue}if(c.r1==null||c.r2==null){continue}var r1=scil.Utils.startswith(c.r1,"R")?parseInt(c.r1.substr(1)):c.r1;var r2=scil.Utils.startswith(c.r2,"R")?parseInt(c.r2.substr(1)):c.r2;var b=plugin.addBond(atom1,atom2,r1,r2);if(b!=null){b.tag=c.tag;var bondratio=this.findBondRatio(bondratios,groups,c.chain1,c.chain2);if(bondratio!=null){b.ratio1=bondratio.ratio1!=null?bondratio.ratio1:scil.helm.defaultbondratio;b.ratio2=bondratio.ratio2!=null?bondratio.ratio2:scil.helm.defaultbondratio}}}s=sections[3];if(!scil.Utils.isNullOrEmpty(s)){var ann=scil.Utils.eval(s);if(ann!=null){for(var k in ann){var chain=chains[k];if(chain!=null&&chain.type=="RNA"){var strandtype=ann[k].strandtype;if(strandtype=="ss"||strandtype=="as"){chain.atoms[0].bio.annotation="5'"+strandtype}}if(k=="chiral"){plugin.jsd.m.chiral=ann.chiral}}}else{var ss=this.split(s,"|");for(var i=0;i<ss.length;++i){var s=ss[i];p=s.indexOf("{");var chn=s.substr(0,p);s=s.substr(p);if(s=="{ss}"||s=="{as}"){var chain=chains[chn];if(chain!=null&&chain.type=="RNA"){chain.atoms[0].bio.annotation="5'"+s.substr(1,s.length-2)}}}}}return n},findBondRatio:function(f,j,g,h){for(var l=0;l<f.length;++l){var n=f[l];var c=n.c1;var d=n.c2;if(j[c]!=null){c=j[c]}if(j[d]!=null){d=j[d]}if(c==g&&d==h){return{ratio1:n.ratio1,ratio2:n.ratio2}}else{if(c==h&&d==g){return{ratio1:n.ratio2,ratio2:n.ratio1}}}}return null},parseBondRatios:function(c,g){var d=g.indexOf("+");if(d<0){d=g.indexOf(",")}if(d<=0){return false}var f={};var h=g.substr(0,d);var j=g.substr(d+1);d=h.indexOf(":");if(d>0){f.c1=h.substr(0,d);f.ratio1=h.substr(d+1)}else{f.c1=h}d=j.indexOf(":");if(d>0){f.c2=j.substr(0,d);f.ratio2=j.substr(d+1)}else{f.c2=j}c.push(f);return true},createGroupForChains:function(B,t,q,l,F){var z=null;var E=this.splitString(l,"+");if(E.length>1){z="and"}else{E=this.splitString(l,",");if(E.length>1){z="or"}}var f=[];var h=null;for(var x=0;x<E.length;++x){var C=null;var D=E[x];var A=D.indexOf(":");if(A>0){C=D.substr(A+1);D=D.substr(0,A)}var n=t[D];if(n==null){continue}var j=[];for(var y=0;y<n.atoms.length;++y){j.push(n.atoms[y]);if(n.bases[y]!=null){j.push(n.bases[y])}}var w=B.createGroup2(j,false);if(w!=null){w.ratio=C;w.tag=F;var d=B.collapseGroup(w);d._aaid=1;f.push(d);h=d}}if(f.length>1){var u=B.createGroup2(f,false);if(u==null){return null}u.ratio=z;u.tag=F;h=B.collapseGroup(u);h._aaid=1}var n=new scil.helm.Chain(E[q]);n.atoms.push(h);return n},splitString:function(h,j){var g=[];var l="";for(var f=0;f<h.length;++f){var d=h.substr(f,1);if(j.indexOf(d)>=0){g.push(l);l=""}else{l+=d}}if(g.length==0||l.length>0){g.push(l)}return g},split:function(u,w){var t=[];var j="";var n=0;var f=0;var d=0;var q=0;for(var l=0;l<u.length;++l){var g=u.substr(l,1);if(g==w&&f==0&&n==0&&d==0&&q==0){t.push(j);j=""}else{j+=g;if(q>0){if(g=="\\"&&l+1<u.length){++l;var h=u.substr(l,1);j+=h;g+=h}}if(g=='"'){if(!(l>0&&u.substr(l-1,1)=="\\")){q=q==0?1:0}}else{if(g=="["){++f}else{if(g=="]"){--f}else{if(g=="("){++n}else{if(g==")"){--n}else{if(g=="{"){++d}else{if(g=="}"){--d}}}}}}}}}t.push(j);return t},parseConnection:function(f){var g=f.split(",");if(g.length!=3){return null}var h=g[2].split("-");if(h.length!=2){return null}var c=h[0].split(":");var d=h[1].split(":");if(c.length!=2||d.length!=2){return null}return{chain1:g[0],chain2:g[1],a1:c[0],r1:c[1],a2:d[0],r2:d[1]}},splitChars:function(d,f){var g=[];if(f==null){for(var c=0;c<d.length;++c){g.push(d.substr(c,1))}}else{g=d.split(f)}return g},trimBracket:function(c){if(c!=null&&scil.Utils.startswith(c,"[")&&scil.Utils.endswith(c,"]")){return c.substr(1,c.length-2)}return c},getRenamedMonomer:function(h,c,g){if(g==null||g.length==0){return c}c=scil.helm.IO.trimBracket(c);for(var d=0;d<g.length;++d){var f=g[d];if(f.oldname==c){return f.id}}return c},detachAnnotation:function(f){var d=this._detachAppendix(f,'"');if(d.tag!=null){return d}var c=this._detachAppendix(f,"'");return{tag:d.tag,repeat:c.tag,str:c.str}},_detachAppendix:function(g,d){var h=null;if(scil.Utils.endswith(g,d)){var f=g.length-1;while(f>0){f=g.lastIndexOf(d,f-1);if(f<=0||g.substr(f-1,1)!="\\"){break}}if(f>0&&f<g.length-1){h=g.substr(f+1,g.length-f-2);g=g.substr(0,f)}}if(h!=null){h=h.replace(new RegExp("\\"+d,"g"),d)}return{tag:this.unescape(h),str:g}},unescape:function(c){if(scil.Utils.isNullOrEmpty(c)){return c}return c.replace(/[\\]./g,function(d){switch(d){case"\\r":return"\r";case"\\n":return"\n";case"\\t":return"\t";default:return d.substr(1)}})},escape:function(c){if(scil.Utils.isNullOrEmpty(c)){return c}return c.replace(/[\"|\'|\\|\r|\n|\t]/g,function(d){switch(d){case"\r":return"\\r";case"\n":return"\\n";case"\t":return"\\t";default:return"\\"+d}})},addNode:function(j,d,c,h,n,g,l){var f=this.detachAnnotation(g);a2=j.addNode(h,n,this.getRenamedMonomer(n,f.str,l));if(a2==null){throw"Failed to creating node: "+f.str}a2.tag=f.tag;c.push(a2);a2._aaid=d.atoms.length+d.bases.length;return a2},addChem:function(g,d,c,f,h){this.addNode(g,c,c.atoms,f.clone(),scil.helm.HELM.CHEM,d,h);return 1},addBlob:function(l,h,f,j,n,d){var g=this.detachAnnotation(h);var c=this.addNode(l,f,f.atoms,j.clone(),scil.helm.HELM.BLOB,"Blob",n);c.bio.blobtype=g.str=="Blob"||g.str=="[Blob]"?null:g.str;if(!scil.Utils.isNullOrEmpty(c.tag)){c.tag=g.tag}else{if(!scil.Utils.isNullOrEmpty(d)){c.tag=d}}return 1},addAAs:function(t,y,f,q,w){var n=t.jsd.m;var l={n:0,firstatom:null,a1:null,a2:null,p:q.clone(),delta:scil.helm.bondscale*t.jsd.bondlength};for(var h=0;h<y.length;++h){if(h==y.length-1&&y[h]==">"){if(l.firstatom!=l.a1){f.bonds.push(t.addBond(l.a1,l.firstatom,2,1))}break}var g=this.detachAnnotation(y[h]);var c=[];var u=new JSDraw2.Rect(l.p.x+l.delta/2,l.p.y-l.delta,0,l.delta*2);if(scil.Utils.startswith(g.str,"(")&&scil.Utils.endswith(g.str,")")){var z;var x=g.str.substr(1,g.str.length-2);if(x.indexOf(",")>0||x.indexOf("+")>0){z=[x]}else{z=this.splitChars(x,".")}if(z.length==1){c.push(this._addOneAA(t,f,g.str,null,w,l))}else{for(var j=0;j<z.length;++j){c.push(this._addOneAA(t,f,z[j],null,w,l))}}}else{c.push(this._addOneAA(t,f,g.str,g.tag,w,l))}if(!scil.Utils.isNullOrEmpty(g.repeat)){u.width=l.p.x+l.delta/2-u.left;var d=new JSDraw2.Bracket(null,u);d.atoms=c;n.addGraphics(d);d.createSubscript(n,g.repeat)}}return l.n},_addOneAA:function(g,d,j,l,h,f){f.p.x+=f.delta;var c=this.addNode(g,d,d.atoms,f.p.clone(),scil.helm.HELM.AA,j,h);f.a2=c;f.a2.tag=l;if(f.a1!=null){d.bonds.push(g.addBond(f.a1,f.a2,2,1))}if(f.firstatom==null){f.firstatom=f.a2}f.a1=f.a2;f.a1.bio.id=++f.n;return c},addHELMRNAs:function(t,x,f,q,w){var n=t.jsd.m;var l={n:0,count:0,firstatom:null,a1:null,a2:null,a3:null,p:q.clone(),delta:scil.helm.bondscale*t.jsd.bondlength};for(var h=0;h<x.length;++h){var g=this.detachAnnotation(x[h]);if(scil.Utils.startswith(g.str,"(")&&scil.Utils.endswith(g.str,")")){var c=[];var u=new JSDraw2.Rect(l.p.x+l.delta/2,l.p.y-l.delta,0,l.delta*3);var y=this.splitChars(g.str.substr(1,g.str.length-2),".");for(var j=0;j<y.length;++j){this._addOneHELMRNA(t,f,y[j],w,l,c)}if(!scil.Utils.isNullOrEmpty(g.repeat)){u.width=l.p.x+l.delta/2-u.left;var d=new JSDraw2.Bracket(null,u);d.atoms=c;n.addGraphics(d);d.createSubscript(n,g.repeat)}}else{this._addOneHELMRNA(t,f,x[h],w,l,[])}}return l.count},_addOneHELMRNA:function(t,h,w,u,n,d){var j=this.splitCombo(w);for(var l=0;l<j.length;++l){var g=j[l];var q=scil.helm.Monomers.getMonomer(scil.helm.HELM.SUGAR,g.symbol);if(q!=null){n.p.x+=n.delta;n.a2=this.addNode(t,h,h.atoms,n.p.clone(),scil.helm.HELM.SUGAR,g.symbol,u);if(n.a1!=null){h.bonds.push(t.addBond(n.a1,n.a2,2,1))}n.a1=n.a2;if(!scil.Utils.isNullOrEmpty(g.base)){n.a3=this.addNode(t,h,h.bases,scil.helm.Interface.createPoint(n.p.x,n.p.y+n.delta),scil.helm.HELM.BASE,g.base,u);t.addBond(n.a1,n.a3,3,1);n.a3.bio.id=++n.n;++n.count;d.push(n.a3)}}else{if(!scil.Utils.isNullOrEmpty(g.base)){throw"Base attached to Linker: "+w}var f=w=="*"?scil.helm.HELM.NUCLEOTIDE:scil.helm.HELM.LINKER;n.p.x+=n.delta;n.a2=this.addNode(t,h,h.atoms,n.p.clone(),f,g.symbol,u);h.bonds.push(t.addBond(n.a1,n.a2,2,1));n.a1=n.a2;++n.count}d.push(n.a1);n.a1.tag=g.tag}},addNucleotides:function(A,D,d,u){var t=0;scil.helm.MonomerExplorer.loadNucleotides();var g=null;var j=null;var q=A.jsd.m;var f=scil.helm.bondscale*A.jsd.bondlength;var w=u.clone();for(var h=0;h<D.length;++h){var C=scil.helm.MonomerExplorer.nucleotides[D[h]];if(scil.Utils.isNullOrEmpty(C)){throw"Unknown nucleotide: "+D[h]}var x=C.indexOf("(");var y=C.indexOf(")");var E=scil.helm.IO.trimBracket(C.substr(0,x));var c=scil.helm.IO.trimBracket(C.substr(x+1,y-x-1));var l=scil.helm.IO.trimBracket(C.substr(y+1));if(E==""&&l==""){throw"Invalid nucleotide definition: "+C}var B=null;var z=null;if(E!=""){w.x+=f;B=this.addNode(A,d,d.atoms,w.clone(),scil.helm.HELM.SUGAR,E);if(j!=null){d.bonds.push(A.addBond(j,B,2,1))}j=B;if(g==null){g=j}}if(l!=""){w.x+=f;var z=this.addNode(A,d,d.atoms,w.clone(),scil.helm.HELM.LINKER,l);if(j!=null){d.bonds.push(A.addBond(j,z,2,1))}j=z;if(g==null){g=j}}if(!scil.Utils.isNullOrEmpty(c)&&B!=null){a3=this.addNode(A,d,d.bases,scil.helm.Interface.createPoint(w.x,w.y+f),scil.helm.HELM.BASE,c);A.addBond(B,a3,3,1);a3.bio.id=++t}}return t},addRNAs:function(y,z,g,w,A,q){var u=0;if(scil.Utils.isNullOrEmpty(A)){A="R"}if(scil.Utils.isNullOrEmpty(q)||q=="null"){q="P"}var j=null;var d=null;var f=null;var t=y.jsd.m;var h=scil.helm.bondscale*y.jsd.bondlength;var x=w.clone();for(var l=0;l<z.length;++l){if(l==z.length-1&&z[l]==">"){if(j!=d){x.x+=h;var c=this.addNode(y,g,g.atoms,x.clone(),scil.helm.HELM.LINKER,q);g.bonds.push(y.addBond(d,c,2,1));g.bonds.push(y.addBond(c,j,2,1))}break}if(d!=null){x.x+=h;var c=this.addNode(y,g,g.atoms,x.clone(),scil.helm.HELM.LINKER,q);g.bonds.push(y.addBond(d,c,2,1));d=c}x.x+=h;f=this.addNode(y,g,g.atoms,x.clone(),scil.helm.HELM.SUGAR,A);if(d!=null){g.bonds.push(y.addBond(d,f,2,1))}d=f;if(j==null){j=d}a3=this.addNode(y,g,g.bases,scil.helm.Interface.createPoint(x.x,x.y+h),scil.helm.HELM.BASE,z[l]);y.addBond(d,a3,3,1);a3.bio.id=++u}return u},splitCombo:function(l){var j=[];var g=null;var f=0;while(f<l.length){var d=l.substr(f,1);if(d=="("){if(f==0){throw"Invalid combo: "+l}var h=l.indexOf(")",f+1);if(h<=f){throw"Invalid combo: "+l}if(j[j.length-1].base==null){j[j.length-1].base=l.substr(f+1,h-f-1)}else{j.push({symbol:l.substr(f,h-f+1)})}f=h}else{if(d=="["){var h=l.indexOf("]",f+1);if(h<=f){throw"Invalid combo: "+l}j.push({symbol:l.substr(f,h-f+1)});f=h}else{if(d=='"'){var h=l.indexOf('"',f+1);if(h<=f){throw"Invalid combo: "+l}j[j.length-1].tag=l.substr(f+1,h-f-1);f=h}else{j.push({symbol:d})}}}++f}return j},compressGz:function(f){if(scil.Utils.isNullOrEmpty(f)){return null}if(typeof pako!="undefined"){try{var c=pako.deflate(f,{gzip:true});return btoa(String.fromCharCode.apply(null,c))}catch(d){}}return null},uncompressGz:function(c){if(scil.Utils.isNullOrEmpty(c)){return null}if(typeof pako=="undefined"){return null}try{var j=atob(c);var f=j.split("").map(function(l){return l.charCodeAt(0)});var d=new Uint8Array(f);var g=pako.inflate(d);return String.fromCharCode.apply(null,new Uint16Array(g))}catch(h){return null}}};scil.helm.MonomerExplorer=scil.extend(scil._base,{constructor:function(h,j,g){this.plugin=j;this.options=g==null?{}:g;this.height=null;var t=this.options.monomerwidth>0?this.options.monomerwidth:50;this.kStyle={borderRadius:"5px",border:"solid 1px gray",backgroundRepeat:"no-repeat",display:"table",width:t,height:t,"float":"left",margin:2};if(this.options.mexuseshape){this.kStyle.border=null}this.selected={};this.selected[scil.helm.HELM.BASE]=scil.helm.Monomers.getDefaultMonomer(scil.helm.HELM.BASE);this.selected[scil.helm.HELM.LINKER]=scil.helm.Monomers.getDefaultMonomer(scil.helm.HELM.LINKER);this.selected[scil.helm.HELM.SUGAR]=scil.helm.Monomers.getDefaultMonomer(scil.helm.HELM.SUGAR);this.selected[scil.helm.HELM.AA]=scil.helm.Monomers.getDefaultMonomer(scil.helm.HELM.AA);this.selected[scil.helm.HELM.CHEM]=scil.helm.Monomers.getDefaultMonomer(scil.helm.HELM.CHEM);var f=this;this.div=scil.Utils.createElement(h,"div",null,{fontSize:this.options.mexfontsize==null?"90%":this.options.mexfontsize});if(this.options.mexfind){var c=scil.Utils.createElement(this.div,"div",null,{background:"#eee",borderBottom:"solid 1px gray",padding:"4px 0 4px 0"});var n=scil.Utils.createTable(c,0,0);var q=scil.Utils.createElement(n,"tr");scil.Utils.createElement(q,"td","Quick Replace:",null,{colSpan:3});this.findtype=scil.Utils.createElement(scil.Utils.createElement(q,"td"),"select",null,{width:100});scil.Utils.listOptions(this.findtype,scil.helm.monomerTypeList(),null,true,false);q=scil.Utils.createElement(n,"tr");this.findinput=scil.Utils.createElement(scil.Utils.createElement(q,"td"),"input",null,{width:60});scil.Utils.createElement(scil.Utils.createElement(q,"td"),"span","&rarr;");this.findreplace=scil.Utils.createElement(scil.Utils.createElement(q,"td"),"input",null,{width:60});scil.Utils.createButton(scil.Utils.createElement(q,"td",null,{textAlign:"right"}),{label:"Update",onclick:function(){f.findReplace()}})}if(this.options.mexfilter!=false){var c=scil.Utils.createElement(this.div,"div",null,{background:"#eee",borderBottom:"solid 1px gray",padding:"4px 0 4px 0"});var n=scil.Utils.createTable(c,0,0);var q=scil.Utils.createElement(n,"tr");scil.Utils.createElement(q,"td",JSDraw2.Language.res("Filter")+":",{paddingLeft:"5px"});this.filterInput=scil.Utils.createElement(scil.Utils.createElement(q,"td"),"input");scil.connect(this.filterInput,"onkeyup",function(d){f.filter(d)})}var l=[];if(this.options.mexmonomerstab){l.push({caption:"Monomers",tabkey:"monomers"})}else{this.addMonomerTabs(l)}if(scil.helm.MonomerExplorer.showrules){l.push({caption:"Rules",tabkey:"rule"})}var u=this.options.width!=null?this.options.width:300;this.height=this.options.height!=null?this.options.height:400;this.tabs=new scil.Tabs(scil.Utils.createElement(this.div,"div",null,{padding:"5px"}),{onShowTab:function(d){f.onShowTab(d)},tabpadding:this.options.mexmonomerstab?"10px":"5px 2px 1px 2px",tabs:l,marginBottom:0});this.dnd=this.createDnD(this.div);scil.connect(document.body,"onmousemove",function(d){f.showMol(d)});scil.helm.MonomerExplorer.loadNucleotides()},addMonomerTabs:function(c){if(this.options.mexfavoritetab!=false){c.push({caption:"Favorite",tabkey:"favorite"})}c.push({caption:"Chem",tabkey:"chem"});c.push({caption:"Peptide",tabkey:"aa"});c.push({caption:"RNA",tabkey:"rna"})},findReplace:function(){this.plugin.replaceAll(this.findinput.value,this.findreplace.value,this.findtype.value)},filter:function(c){var d=this.tabs.currentTabKey();if(d=="rule"){scil.helm.RuleSet.filterRules(this.rules,this.filterInput.value,this.rules_category.value)}else{this.filterGroup(this.filterInput.value)}},filterGroup:function(z){if(z==""){z=null}var j=this.curtab.clientarea.className=="filtergroup"?[this.curtab.clientarea]:this.curtab.clientarea.getElementsByClassName("filtergroup");for(var t=0;t<j.length;++t){var B=[];var c=[];var l=[];var y=j[t];for(var q=0;q<y.childNodes.length;++q){var g=y.childNodes[q];var x=scil.Utils.getInnerText(g);var n=scil.Utils.isNullOrEmpty(x)?g.innerHTML:null;var h=1;if(scil.Utils.isNullOrEmpty(x)){h=0}else{if(z!=null){h=0;if(scil.Utils.startswith(x.toLowerCase(),z)){h=1}else{if(x.toLowerCase().indexOf(z)>=0){h=2}else{if(z.length>=3||scil.helm.MonomerExplorer.filtername){var C=g.getAttribute("helm");var A=C==scil.helm.MonomerExplorer.kNucleotide?scil.helm.MonomerExplorer.nucleotides:scil.helm.Monomers.getMonomerSet(C);var w=A[scil.helm.symbolCase(x)];if(w!=null&&w.n!=null){if(scil.Utils.startswith(w.n.toLowerCase(),z)){h=1}else{if(w.n.toLowerCase().indexOf(z)>=0){h=2}}}}}}}}if(h==1){B.push({id:x,div:g,html:n})}else{if(h==2){c.push({id:x,div:g,html:n})}else{l.push(g)}}}B.sort(scil.helm.MonomerExplorer.compareMonomers);if(c.length>0){c.sort(scil.helm.MonomerExplorer.compareMonomers);B=B.concat(c)}var u=null;for(var q=0;q<B.length;++q){var g=B[q];y.insertBefore(g.div,y.childNodes[q]);u=g.div;if(z!=null){g.div.firstChild.firstChild.innerHTML=this.highlightString(g.id,z)}else{g.div.firstChild.firstChild.innerHTML=g.html!=null?g.html:g.id}g.div.style.display="table"}for(var q=0;q<l.length;++q){l[q].style.display="none"}}},highlightString:function(f,d){var c=f.toLowerCase().indexOf(d);if(c<0){return f}return f.substr(0,c)+"<span style='background:yellow'>"+f.substr(c,d.length)+"</span>"+f.substr(c+d.length)},reloadTab:function(f){var c=null;switch(f){case"nucleotide":c=f;break;case scil.helm.HELM.AA:c="aa";break;case scil.helm.HELM.CHEM:c="chem";break;case scil.helm.HELM.BASE:c="base";break;case scil.helm.HELM.LINKER:c="linker";break;case scil.helm.HELM.SUGAR:c="sugar";break;default:return}var d=this.tabs.findTab(c);if(d==null&&this.monomerstabs!=null){d=this.monomerstabs.findTab(c)}if(d==null){d=this.rnatabs.findTab(c)}if(d!=null){this.onShowTab(d,true)}},reloadTabs:function(){var d=this.tabs.tr.childNodes;for(var c=0;c<d.length;++c){var f=d[c];scil.Utils.removeAll(f.clientarea);f._childrencreated=false}this.onShowTab(this.tabs.currenttab)},resize:function(c){this.height=c;if(this.divRule!=null){this.divRule.style.height=this.getHeight("rule")+"px"}if(this.divFavorite!=null){this.divFavorite.style.height=this.getHeight("favorite")+"px"}if(this.divChem!=null){this.divChem.style.height=this.getHeight("chem")+"px"}if(this.divAA!=null){this.divAA.style.height=this.getHeight("aa")+"px"}if(this.rnatabs!=null){this.rnatabs.resizeClientarea(0,this.getHeight("RNA"))}},getHeight:function(g){var c=this.options.mexmonomerstab?0:14;var d=this.options.mexmonomerstab?0:47;var f=this.options.mexmonomerstab?0:46;switch(g){case"rule":return this.height-19+c;case"favorite":return this.height-33+d;case"chem":return this.height-33+d;case"aa":return this.height-33+d;case"RNA":return this.height-59+f}return this.height},onShowTab:function(u,j){if(u==null){return}this.filterInput.value="";this.curtab=u;this.filterGroup("");var l=u.getAttribute("key");if(j||l=="favorite"&&scil.helm.MonomerExplorer.favorites.changed){u._childrencreated=false;if(l=="favorite"){scil.helm.MonomerExplorer.favorites.changed=false}}if(this.plugin!=null&&this.plugin.jsd!=null){this.plugin.jsd.doCmd("helm_"+l)}if(u._childrencreated){return}u._childrencreated=true;var q=this;var h=u.clientarea;scil.Utils.unselectable(h);scil.Utils.removeAll(h);if(l=="favorite"){this.divFavorite=scil.Utils.createElement(h,"div",null,{width:"100%",height:this.getHeight(l),overflowY:"scroll"});this.recreateFavorites(this.divFavorite)}else{if(l=="rna"){var f=scil.Utils.createElement(h,"div");this.createMonomerGroup3(f,"RNA",0,false)}else{if(l=="nucleotide"){var g=scil.helm.MonomerExplorer.loadNucleotides();var n=scil.Utils.getDictKeys(g);this.createMonomerGroup4(h,l,n)}else{if(l=="aa"){this.divAA=scil.Utils.createElement(h,"div",null,{width:"100%",height:this.getHeight(l),overflowY:"scroll"});dojo.connect(this.divAA,"onmousedown",function(d){q.select(d)});dojo.connect(this.divAA,"ondblclick",function(d){q.dblclick(d)});this.createMonomerGroup4(this.divAA,scil.helm.HELM.AA,null,false,this.options.mexgroupanalogs!=false)}else{if(l=="chem"){this.divChem=scil.Utils.createElement(h,"div",null,{width:"100%",height:this.getHeight(l),overflowY:"scroll"});this.createMonomerGroup(this.divChem,scil.helm.HELM.CHEM)}else{if(l=="base"){this.createMonomerGroup4(h,scil.helm.HELM.BASE,null,null,this.options.mexgroupanalogs!=false)}else{if(l=="sugar"){this.createMonomerGroup4(h,scil.helm.HELM.SUGAR,null)}else{if(l=="linker"){this.createMonomerGroup4(h,scil.helm.HELM.LINKER,null,true)}else{if(l=="rule"){var w=scil.Utils.createElement(h,"div",null,{background:"#ccc"});scil.Utils.createElement(w,"span","Category:");this.rules_category=scil.Utils.createElement(w,"select");scil.Utils.listOptions(this.rules_category,scil.helm.RuleManager.categories);var q=this;scil.connect(this.rules_category,"onchange",function(){scil.helm.RuleSet.filterRules(q.rules,q.filterInput.value,q.rules_category.value)});this.divRule=scil.Utils.createElement(h,"div",null,{width:"100%",height:this.getHeight(l),overflowY:"scroll"});this.listRules()}else{if(l=="monomers"){var f=scil.Utils.createElement(h,"div",null,{paddingTop:"5px"});if(this.options.canvastoolbar==false){var c=scil.Utils.createElement(f,"div","<img src='"+scil.Utils.imgSrc("helm/arrow.png")+"' style='vertical-align:middle'>Mouse Pointer",{cursor:"pointer",padding:"2px",border:"solid 1px gray",margin:"5px"});scil.connect(c,"onclick",function(){q.plugin.jsd.doCmd("lasso")})}var t=[];this.addMonomerTabs(t);this.monomerstabs=new scil.Tabs(f,{onShowTab:function(d){q.onShowTab(d)},tabpadding:"5px 2px 1px 2px",tabs:t,marginBottom:0})}}}}}}}}}}},listRules:function(){var c=this;this.rules=scil.helm.RuleSet.listRules(this,function(d){c.plugin.applyRule(d)},function(d){c.plugin.applyRules(d)})},getMonomerDictGroupByAnalog:function(n){var l=scil.helm.Monomers.getMonomerSet(n);var f=[];for(var d in l){if(this.choosemonomer(l[d])==false){continue}f.push(l[d]);if(f.length>50){f=null;break}}if(f!=null){return{"*":this.getMonomerNames(f)}}var j={};var c=n==scil.helm.HELM.AA;if(c){j["C-Term"]=[];j["N-Term"]=[]}for(var d in l){var g=l[d];if(this.choosemonomer(g)==false){continue}var h=g.na;if(c){if(g.at.R1==null){h="N-Term"}else{if(g.at.R2==null){h="C-Term"}}}if(scil.Utils.isNullOrEmpty(h)){h="X"}if(j[h]==null){j[h]=[]}j[h].push(g)}for(var d in j){j[d]=this.getMonomerNames(j[d])}return j},getMonomerList:function(f,h,c){if(f!=null){f.sort();return f}f=[];var g=scil.helm.Monomers.getMonomerSet(h);if(g!=null){for(var d in g){if(this.choosemonomer(g[d])){f.push(g[d])}}}return this.getMonomerNames(f,c)},choosemonomer:function(c){return c.status!="Retired"&&(this.options.showvirtual||c.status!="Virtual")},getMonomerNames:function(f,c){var g=[];f.sort(scil.helm.MonomerExplorer.compareMonomers);for(var d=0;d<f.length;++d){g.push(f[d].id)}return g},createMonomerGroup:function(d,h,f,c){var g=this;f=this.getMonomerList(f,h,c);if(scil.helm.ambiguity){if(h==scil.helm.HELM.CHEM){f.splice(0,0,"*")}}d.style.overflowY="scroll";this._listMonomers(d,f,h,this.options.mexfavoritefirst);dojo.connect(d,"onmousedown",function(j){g.select(j)});dojo.connect(d,"ondblclick",function(j){g.dblclick(j)})},createMonomerGroup3:function(j,l,n,g){var t=this;var u=scil.Utils.createElement(j,"div");if(g){var c=scil.Utils.createElement(u,"div",l+":",{background:"#ddd",borderTop:"solid 1px #aaa",marginTop:n==0?null:"1px"});if(n>0){new scil.Resizable(c,{direction:"y",mouseovercolor:"#aaf",onresize:function(d,y){return t.onresize(d,n)}})}}var h=scil.Utils.createElement(u,"div");dojo.connect(h,"onmousedown",function(d){t.select(d)});dojo.connect(h,"ondblclick",function(d){t.dblclick(d)});if(l=="RNA"){var f=scil.helm.Monomers.bases.A==null?"a":"A";var q=scil.helm.Monomers.linkers.P==null?"p":"P";var w=scil.helm.Monomers.sugars.R==null?"r":"R";var x=[{caption:this.createRNATabCaption("nucleotide","R(A)P"),tabkey:"nucleotide",onmenu:this.options.mexrnapinontab?function(d){t.onPinMenu(d)}:null},{caption:this.createRNATabCaption("base",f),tabkey:"base"},{caption:this.createRNATabCaption("sugar",w),tabkey:"sugar"},{caption:this.createRNATabCaption("linker",q),tabkey:"linker"}];this.rnatabs=new scil.Tabs(scil.Utils.createElement(h,"div",null,{paddingTop:"5px"}),{onShowTab:function(d){t.onShowTab(d)},tabpadding:"2px",tabs:x,marginBottom:0,clientareaheight:this.getHeight("RNA")})}},createRNATabCaption:function(f,d){var c=" style='font-size: 80%;padding-left:20px;background-repeat:no-repeat;background-position:left center;background-image:";return"<div title='Nucleotide (Combined)' "+c+scil.Utils.imgSrc("img/helm_"+f.toLowerCase()+".gif",true)+"'>"+(d==""?"_":d)+"</div>"},onPinMenu:function(c){if(this.pinmenu==null){var f=this;var d=[{caption:"Pin This Nucleotide"}];this.pinmenu=new scil.ContextMenu(d,function(){f.addNucleotide()})}this.pinmenu.show(c.clientX,c.clientY)},createMonomerGroup4:function(j,x,t,f,l){if(l){var h=this.getMonomerDictGroupByAnalog(x);if(scil.helm.ambiguity){if(x==scil.helm.HELM.AA){h["?"]=["*","_","X"]}else{if(x==scil.helm.HELM.BASE){h["?"]=["_","N","*"]}}}var t=[];if(this.options.mexfavoritefirst){for(var q in h){var u=h[q];for(var n=0;n<u.length;++n){var c=u[n];if(scil.helm.MonomerExplorer.favorites.contains(c,x)){t.push(c)}}}this._listMonomer2(j,scil.Utils.imgTag("star.png"),t,x,20)}t=scil.Utils.getDictKeys(h);t.sort();var u=[];for(var n=0;n<t.length;++n){var q=t[n];if(q=="C-Term"||q=="N-Term"){u.push(q);continue}this._listMonomer2(j,q,h[q],x,20)}for(var n=0;n<u.length;++n){var q=u[n];this._listMonomer2(j,q,h[q],x,60)}}else{if(x=="nucleotide"&&!this.options.mexrnapinontab){var w=this;var g=this.createMonomerDiv(j,scil.Utils.imgTag("pin.png"),null,null,false);g.setAttribute("title","Pin This Nucleotide");scil.connect(g,"onclick",function(){w.addNucleotide()})}var t=this.getMonomerList(t,x,f);if(scil.helm.ambiguity){if(x==scil.helm.HELM.SUGAR){t.splice(0,0,"*")}else{if(x==scil.helm.HELM.LINKER){t.splice(0,0,"*")}else{if(x=="nucleotide"){t.splice(0,0,"*")}}}}this._listMonomers(j,t,x,this.options.mexfavoritefirst)}},addNucleotide:function(h){var g=this.getCombo();var c=scil.helm.MonomerExplorer.nucleotides;for(var d in c){if(g==c[d]){scil.Utils.alert("There is a defined nucleotide called: "+d);return}}var f=this;scil.Utils.prompt2({caption:"Pin Nucleotide: "+g,message:"Please give a short name for the nucleotide, "+g,callback:function(j){if(scil.helm.MonomerExplorer.addCustomNucleotide(j,g)){f.reloadTab("nucleotide")}}})},_listMonomer2:function(c,d,g,n,q){if(g.length==0){return}var j=scil.Utils.createTable(c,0,0);var l=scil.Utils.createElement(j,"tr");var f=scil.Utils.createElement(l,"td",null,{verticalAlign:"top"});var h=scil.Utils.createElement(l,"td",null,{verticalAlign:"top"});scil.Utils.createElement(f,"div",d,{width:q,background:"#eee",border:"solid 1px #aaa",textAlign:"center"});this._listMonomers(h,g,n)},createMonomerGroupFav:function(g,c,l){var h=scil.helm.MonomerExplorer.favorites.getList(l);if(h==null||h.length==0){return}h.sort();scil.Utils.createElement(g,"div",c+":",{background:"#ddd",border:"solid 1px #ddd"});var f=scil.Utils.createElement(g,"div",null,{display:"table",paddingBottom:"10px"});this._listMonomers(f,h,l,false);var j=this;dojo.connect(f,"onmousedown",function(d){j.select(d)});dojo.connect(f,"ondblclick",function(d){j.dblclick(d)})},_listMonomers:function(c,f,j,h){c.className="filtergroup";if(h){var g=[];for(var d=0;d<f.length;++d){if(scil.helm.MonomerExplorer.favorites.contains(f[d],j)){this.createMonomerDiv(c,f[d],j)}else{g.push(f[d])}}for(var d=0;d<g.length;++d){this.createMonomerDiv(c,g[d],j)}}else{for(var d=0;d<f.length;++d){this.createMonomerDiv(c,f[d],j)}}},recreateFavorites:function(c){this.createMonomerGroupFav(c,"Nucleotide",scil.helm.MonomerExplorer.kNucleotide);this.createMonomerGroupFav(c,"Base",scil.helm.HELM.BASE);this.createMonomerGroupFav(c,"Sugar",scil.helm.HELM.SUGAR);this.createMonomerGroupFav(c,"Linker",scil.helm.HELM.LINKER);this.createMonomerGroupFav(c,"Chemistry",scil.helm.HELM.CHEM);this.createMonomerGroupFav(c,"Peptide",scil.helm.HELM.AA)},createMonomerDiv:function(n,l,u,t,q){var j=scil.helm.MonomerExplorer.favorites.contains(l,u);if(t==null){t=scil.clone(this.kStyle)}else{t=scil.apply(scil.clone(this.kStyle),t)}if(this.options.mexusecolor!=false){var c;var f=scil.helm.MonomerExplorer.customnucleotides;if(u=="nucleotide"&&f!=null&&f[l]!=null){c={backgroundcolor:"#afa"}}else{c=t.backgroundColor=scil.helm.Monomers.getColor2(u,l)}t.backgroundColor=c==null?null:c.backgroundcolor}if(q!=false){t.backgroundImage=scil.Utils.imgSrc("img/star"+(j?"":"0")+".png",true)}var h=scil.Utils.createElement(n,"div",null,t,{helm:u,bkcolor:t.backgroundColor,star:(q?1:null)});scil.Utils.unselectable(h);if(this.options.mexuseshape){this.setMonomerBackground(h,0)}var g=scil.Utils.createElement(h,"div",null,{display:"table-cell",textAlign:"center",verticalAlign:"middle"});scil.Utils.createElement(g,"div",l,{overflow:"hidden",width:this.kStyle.width});return h},setMonomerBackground:function(d,g){var h=d.getAttribute("helm");if(scil.Utils.isNullOrEmpty(h)){return}var c=h.toLowerCase();if(h!=scil.helm.MonomerExplorer.kNucleotide){c=c.substr(c.indexOf("_")+1)}d.style.backgroundImage=scil.Utils.imgSrc("img/mon-"+c+g+".png",true)},getMonomerDiv:function(d){var c=d.target||d.srcElement;if(c==null||c.tagName==null){return}for(var f=0;f<3;++f){var g=c.getAttribute("helm");if(!scil.Utils.isNullOrEmpty(g)){break}c=c.tagName=="BODY"?null:c.parentNode;if(c==null){break}}return scil.Utils.isNullOrEmpty(g)?null:c},createDnD:function(c){var d=this;return new scil.DnD(c,{onstartdrag:function(g,f){return d.getMonomerDiv(g)},oncreatecopy:function(g,f){if(d.dnd.floatingbox==null){var h=scil.Utils.getMaxZindex();var j={"float":null,backgroundImage:null,filter:"alpha(opacity=80)",opacity:0.8,color:scil.helm.MonomerExplorer.color,backgroundColor:scil.helm.MonomerExplorer.backgroundcolor,zIndex:(h>0?h:100)+1,position:"absolute"};if(d.options.useshape){j.backgroundColor=null}d.dnd.floatingbox=d.createMonomerDiv(document.body,null,null,j,false)}d.dnd.floatingbox.style.display="table";d.dnd.floatingbox.style.backgroundColor=scil.helm.MonomerExplorer.backgroundcolor;d.dnd.floatingbox.innerHTML=f.src.innerHTML;d.dnd.floatingbox.setAttribute("helm",f.src.getAttribute("helm"));if(d.options.useshape){d.setMonomerBackground(d.dnd.floatingbox,1)}return d.dnd.floatingbox},ondrop:function(g,f){if(d.dnd.floatingbox==null){return}d.dnd.floatingbox.style.display="none";var h=g.target||g.srcElement;if(!scil.Utils.hasAnsestor(h,d.plugin.jsd.div)){return}var j=d.dnd.floatingbox.getAttribute("helm");d.plugin.dropMonomer(j,scil.Utils.getInnerText(d.dnd.floatingbox),g)},oncancel:function(f){if(d.dnd.floatingbox==null){return}d.dnd.floatingbox.style.display="none";var g=d.dnd.floatingbox.getAttribute("helm")}})},showMol:function(c){var h=this.getMonomerDiv(c);if(h!=null&&!this.dnd.isDragging()){var j=h.getAttribute("helm");var g=j==scil.helm.MonomerExplorer.kNucleotide?scil.helm.MonomerExplorer.nucleotides:scil.helm.Monomers.getMonomerSet(j);var f=scil.Utils.getInnerText(h);var d=g[scil.helm.symbolCase(f)];if(d==null){d=g[f]}scil.helm.MolViewer.show(c,j,d,f)}else{var h=c.srcElement||c.target;if(!scil.Utils.isChildOf(h,this.plugin.jsd.div)){scil.helm.MolViewer.hide()}}},splitLists:function(g){var d=[[],[],[],[]];for(var c in g){var f=g[c];if(f.at.R1==null){d[2].push(c)}else{if(f.at.R2==null){d[3].push(c)}else{if(c.length==1){d[0].push(c)}else{d[1].push(c)}}}}return d},changeFavorite:function(c){var d=c.getAttribute("star")!="1";if(d){c.setAttribute("star","1");c.style.backgroundImage=scil.Utils.imgSrc("img/star.png",true)}else{c.setAttribute("star","");c.style.backgroundImage=scil.Utils.imgSrc("img/star0.png",true)}var h=c.getAttribute("helm");var g=scil.Utils.getInnerText(c);scil.helm.MonomerExplorer.favorites.add(g,d,h)},select:function(n){var h=this.getMonomerDiv(n);if(h!=null){var g=scil.Utils.getOffset(h,true,true);var x=scil.Utils.getParent(h.parentNode,"div");var j=n.clientX-g.x+x.scrollLeft;var l=n.clientY-g.y+x.scrollTop;if(j>=0&&j<16&&l>=0&&l<16){this.changeFavorite(h);n.preventDefault();return}}var q=h==null?null:h.getAttribute("helm");if(scil.Utils.isNullOrEmpty(q)){return}this.plugin.jsd.activate(true);var u=scil.Utils.getInnerText(h);if(q==scil.helm.MonomerExplorer.kNucleotide){if(u!="*"){var f=scil.helm.Monomers.parseNucleotide(u);var y=f.ribose;var c=f.base;var t=f.phosphate;if(scil.Utils.isNullOrEmpty(t)){t="null"}this.selected[scil.helm.HELM.BASE]=c;this.selected[scil.helm.HELM.LINKER]=t;this.selected[scil.helm.HELM.SUGAR]=y;if(this.rnatabs!=null){var A=this.rnatabs;var w=y+"("+c+")"+t;A.updateTabLabel("nucleotide",this.createRNATabCaption("nucleotide",w));A.updateTabLabel("sugar",this.createRNATabCaption("sugar",y));A.updateTabLabel("linker",this.createRNATabCaption("linker",t));A.updateTabLabel("base",this.createRNATabCaption("base",c))}}}else{u=scil.helm.IO.trimBracket(u);if(this.rnatabs!=null){var z=null;var A=this.rnatabs;switch(q){case scil.helm.HELM.SUGAR:z="sugar";break;case scil.helm.HELM.LINKER:z="linker";break;case scil.helm.HELM.BASE:z="base";break}if(z!=null){A.updateTabLabel(z,this.createRNATabCaption(z,u))}}this.selected[q]=u;if(A!=null){A.updateTabLabel("nucleotide",this.createRNATabCaption("nucleotide",this.getCombo()))}}if(this.lastdiv!=null){this.lastdiv.style.color="";if(this.options.mexuseshape){this.setMonomerBackground(this.lastdiv,0)}else{var w=this.lastdiv.getAttribute("bkcolor");this.lastdiv.style.backgroundColor=w==null?"":w}}if(this.options.mexuseshape){this.setMonomerBackground(h,1)}else{h.style.backgroundColor=scil.helm.MonomerExplorer.backgroundcolor}h.style.color=scil.helm.MonomerExplorer.color;this.lastdiv=h;if(this.plugin!=null&&this.plugin.jsd!=null){switch(q){case scil.helm.HELM.AA:this.plugin.jsd.doCmd("helm_aa");break;case scil.helm.HELM.CHEM:this.plugin.jsd.doCmd("helm_chem");break;case scil.helm.HELM.BASE:this.plugin.jsd.doCmd(this.options.alwaysdrawnucleotide?"helm_nucleotide":"helm_base");break;case scil.helm.HELM.LINKER:this.plugin.jsd.doCmd(this.options.alwaysdrawnucleotide?"helm_nucleotide":"helm_linker");break;case scil.helm.HELM.SUGAR:this.plugin.jsd.doCmd(this.options.alwaysdrawnucleotide?"helm_nucleotide":"helm_sugar");break;case scil.helm.MonomerExplorer.kNucleotide:this.plugin.jsd.doCmd("helm_nucleotide");break}}},getCombo:function(){var g=this.selected[scil.helm.HELM.SUGAR];var d=this.selected[scil.helm.HELM.LINKER];var c=this.selected[scil.helm.HELM.BASE];var f=scil.helm.IO.getCode(g);if(!scil.helm.Monomers.hasR(scil.helm.HELM.SUGAR,g,"R3")){f+="()"}else{f+="("+scil.helm.IO.getCode(c)+")"}if(d!="null"){f+=scil.helm.IO.getCode(d)}return f},dblclick:function(d){var c=this.getMonomerDiv(d);var f=c==null?null:c.getAttribute("helm");if(scil.helm.isHelmNode(f)){if(this.plugin.dblclickMomonor(f,scil.Utils.getInnerText(c))==0){scil.Utils.beep()}}}});scil.apply(scil.helm.MonomerExplorer,{kUseShape:false,kNucleotide:"nucleotide",backgroundcolor:"blue",color:"white",customnucleotides:null,filtername:false,showrules:false,favorites:new scil.Favorite("monomers",function(d,c,g){scil.helm.MonomerExplorer.onAddFavorite(d,c,g)}),nucleotides:{A:"R(A)P",C:"R(C)P",G:"R(G)P",T:"R(T)P",U:"R(U)P"},compareMonomers:function(c,d){if(c.id==d.id){return 0}else{if(c.id==null){return -1}else{if(d.id==null){return 1}else{if(c.id.length!=d.id.length&&(c.id.length==1||d.id.length==1)){return c.id.length>d.id.length?1:-1}else{return scil.helm.symbolCase(c.id)>scil.helm.symbolCase(d.id)?1:-1}}}}},onAddFavorite:function(d,c,g){if(!c&&g=="nucleotide"&&this.customnucleotides!=null&&this.customnucleotides[d]!=null){delete this.customnucleotides[d];this.saveNucleotides()}},addCustomNucleotide:function(c,d){c=scil.Utils.trim(c);if(scil.Utils.isNullOrEmpty(c)){scil.Utils.alert("The short name cannot be blank");return false}if(this.nucleotides[c]!=null){scil.Utils.alert("The short name is used for: "+this.nucleotides[c]);return false}if(this.customnucleotides==null){this.customnucleotides={}}this.nucleotides[c]=d;this.customnucleotides[c]=d;this.saveNucleotides();this.favorites.add(c,true,"nucleotide");return true},saveNucleotides:function(){var c=scil.Utils.json2str(this.customnucleotides);scil.Utils.createCookie("scil_helm_nucleotides",c)},loadNucleotides:function(){if(this._nucleotidesloaded){return this.nucleotides}if(this.nucleotides==null){this.nucleotides=[]}this._nucleotidesloaded=true;var s=scil.Utils.readCookie("scil_helm_nucleotides");this.customnucleotides=scil.Utils.eval(s);if(this.customnucleotides!=null&&this.customnucleotides.length==null){var list={};for(var k in this.customnucleotides){if(this.nucleotides[k]==null){list[k]=this.customnucleotides[k];this.nucleotides[k]=this.customnucleotides[k]}}this.customnucleotides=list}return this.nucleotides},showDlg:function(c){this.createDlg(c);this.dlg.show2({owner:c,modal:false});c.helm.monomerexplorer=this.mex},createDlg:function(d){if(this.dlg!=null){return}var c=scil.Utils.createElement(null,"div",null,{width:500});this.dlg=new scil.Dialog("Monomer Explorer",c);this.dlg.show2({owner:d,modal:false});this.mex=new scil.helm.MonomerExplorer(c,d.helm,{height:350,showvirtual:d.options.showvirtualmonomers});this.dlg.moveCenter()}});scil.helm.MolViewer={dlg:null,jsd:null,molscale:1,delay:800,show:function(d,l,g,c,f,j){if(d.button!=0){this.hide();return}var h=this;this.clearTimer();this.tm=setTimeout(function(){h.show2({x:d.clientX,y:d.clientY},l,g,c,f,j)},this.delay)},clearTimer:function(){if(this.tm!=null){clearTimeout(this.tm);this.tm=null}},show2:function(x,w,l,f,g,c){this.tm=null;if(l==null&&c==null||w=="ANTIBODY"||w=="PROTEIN"){return}if(g!=null&&g.contextmenu!=null&&g.contextmenu.isVisible()){return}this.create();if(this.cur!=(w+"."+f)||!this.dlg.isVisible()){this.cur=w+"."+f;if(l!=null&&typeof(l)=="string"){var t=l;l={n:l,m:this.assemblyMol(t)}}var q="";if(l!=null){q=l.n;if(q==null){q=c.elem}else{q=f+"<br>"+q}}else{if(c.bio!=null&&!scil.Utils.isNullOrEmpty(c.bio.ambiguity)){q=c.bio.ambiguity}}var d="";if(c!=null&&w==scil.helm.HELM.BLOB&&!scil.Utils.isNullOrEmpty(c.bio.blobtype)){d="{"+c.bio.blobtype+"}"}var h=this.dlg.form.fields;this.dlg.show2({title:"<div style='font-size:80%;color:#000'>"+q+d+"</div>",modal:false,immediately:true});var n=scil.helm.monomers.getMolfile(l);if(scil.Utils.isNullOrEmpty(n)){h.jsd.style.display="none"}else{h.jsd.style.display="";h.jsd.jsd.setXml(n)}var t="";if(l!=null&&l.at!=null){for(var j in l.at){t+="<tr><td>"+j+"=</td><td>&nbsp;"+l.at[j]+"</td></tr>"}}if(t==""){h.rs.style.display="none"}else{h.rs.style.display="";h.rs.innerHTML="<table cellspacing=0 cellpadding=0 style='font-size:80%'>"+t+"</table>"}var t="";if(c!=null){if(!scil.Utils.isNullOrEmpty(c.tag)){t+="<div>"+c.tag+"</div>"}}if(t==""){h.notes.style.display="none"}else{h.notes.style.display="";h.notes.innerHTML=t;h.notes.style.borderTop=h.rs.style.display==""?"solid 1px gray":""}}var u=scil.Utils.scrollOffset();this.dlg.moveTo(x.x+u.x+10,x.y+u.y+10)},assemblyMol:function(u){var q=u.indexOf("(");var t=u.indexOf(")");var w=u.substr(0,q);var c=u.substr(q+1,t-q-1);var d=u.substr(t+1);var n=scil.helm.Monomers.getMonomer(scil.helm.HELM.SUGAR,scil.helm.IO.trimBracket(w));var l=scil.helm.Monomers.getMonomer(scil.helm.HELM.LINKER,scil.helm.IO.trimBracket(d));var j=scil.helm.Monomers.getMonomer(scil.helm.HELM.BASE,scil.helm.IO.trimBracket(c));var f=scil.helm.Interface.createMol(scil.helm.monomers.getMolfile(n));var g=scil.helm.Interface.createMol(scil.helm.monomers.getMolfile(l));var h=scil.helm.Interface.createMol(scil.helm.monomers.getMolfile(j));this.mergeMol(f,"R2",g,"R1");this.mergeMol(f,"R3",h,"R1");return f.getMolfile()},capRGroup:function(h,l,j){var f=j==null||j.at==null?null:j.at[l];if(f=="OH"){f="O"}for(var g=0;g<h.bonds.length;++g){var d=h.bonds[g];if(d.a1.alias==l||d.a2.alias==l){var c=d.a1.alias==l?d.a1:d.a2;if(JSDraw2.PT[f]!=null){h.setAtomType(c,f);c.alias=null}else{c.alias=f}return true}}return false},findR:function(g,h,c){for(var f=0;f<g.bonds.length;++f){var d=g.bonds[f];if(d.a1.alias==h&&(c==null||d.a1._helmgroup==c)){return{b:d,a0:d.a2,a1:d.a1}}else{if(d.a2.alias==h&&(c==null||d.a2._helmgroup==c)){return{b:d,a0:d.a1,a1:d.a2}}}}return null},mergeMol:function(f,g,j,h,c,d){this.joinMol(f,g,j,h,c,d);f.atoms=f.atoms.concat(j.atoms);f.bonds=f.bonds.concat(j.bonds);return f.getMolfile()},connectMol:function(f,c,d,j){var g="R"+(d.a1==c?d.r1:d.r2);var h=this.findR(j,g);j.atoms.splice(scil.Utils.indexOf(j.atoms,h.a1),1);j.bonds.splice(scil.Utils.indexOf(j.bonds,h.b),1);if(d.a1==c){d.a1=h.a0;d.r1=null}else{d.a2=h.a0;d.r2=null}return{r:g,a:h.a0}},joinMol:function(g,h,n,j,c,d){var q=this.findR(g,h,c);var l=this.findR(n,j,d);if(q!=null&&l!=null){this.extendDistance(q.a0.p,q.a1.p,1);this.extendDistance(l.a0.p,l.a1.p,1);n.offset(q.a1.p.x-l.a0.p.x,q.a1.p.y-l.a0.p.y);var f=q.a1.p.angleAsOrigin(q.a0.p,l.a1.p);n.rotate(q.a1.p,-f);g.atoms.splice(scil.Utils.indexOf(g.atoms,q.a1),1);n.atoms.splice(scil.Utils.indexOf(n.atoms,l.a1),1);n.bonds.splice(scil.Utils.indexOf(n.bonds,l.b),1);if(q.b.a1==q.a1){q.b.a1=l.a0}else{q.b.a2=l.a0}}},extendDistance:function(g,f,h){var c=f.x-g.x;var d=f.y-g.y;f.x=g.x+h*c;f.y=g.y+h*d},create:function(){if(this.dlg!=null){return}var c={jsd:{type:"jsdraw",width:180,height:130,scale:this.molscale,viewonly:true},rs:{type:"html",viewonly:true,style:{borderTop:"solid 1px gray",width:180}},notes:{type:"html",viewonly:true,style:{width:180,color:"gray"}}};this.dlg=scil.Form.createDlgForm("",c,null,{hidelabel:true,modal:false,noclose:true});this.dlg.hide(true);this.dlg.dialog.style.backgroundColor="#fff";this.dlg.dialog.titleElement.style.borderBottom="solid 1px #ddd";this.dlg.dialog.titleElement.style.textAlign="center"},hide:function(){this.clearTimer();if(this.dlg!=null&&this.dlg.isVisible()){this.dlg.hide(true)}}};scil.helm.Formula={getMF:function(d,c){var f=this.getAtomStats(d);return JSDraw2.FormulaParser.stats2mf(f)},subscription:function(d,c){if(d==1){return""}return c?"<sub>"+d+"</sub>":d},getMW:function(c){var d=this.getAtomStats(c);if(d==null){return null}var f=JSDraw2.FormulaParser.stats2mw(d);return Math.round(f*10000)/10000},getAtomStats:function(c){var d=c.expandSuperAtoms();var f=new JSDraw2.FormulaStats();this.getAtomStats2(d,f);return f},getAtomStats2:function(q,z){var g=[];for(var h=0;h<q.graphics.length;++h){var f=JSDraw2.Bracket.cast(q.graphics[h]);if(f!=null&&f.atoms!=null&&f.atoms.length>0){var u=f.getSubscript(q);if(!(u>0)){return null}if(u>1){g.push({br:f,n:u})}}}var d=[];var l=[];for(var h=0;h<q.atoms.length;++h){var c=q.atoms[h];if(c.elem=="?"){return null}if(scil.helm.isHelmNode(c)){if(c.biotype()==scil.helm.HELM.BLOB&&c.superatom!=null){this.getAtomStats2(c.superatom,z)}else{l.push(c);var u=this.getRepeat(g,c);if(u>0){for(var j=1;j<u;++j){l.push(c)}}}}else{d.push(c)}}var x=d.length==null?null:scil.helm.Interface.getAtomStats(q,d);z.mergeFrom(x);if(l.length==0){return z}for(var h=0;h<l.length;++h){var c=l[h];var t=scil.helm.Monomers.getMonomer(c);this.countMonomer(z,t);for(var w in t.at){var y=t.at[w];if(!this.isRUsed(c,w,q.bonds)){scil.helm.Cap.getStats(z,y)}z.add("R",-1)}}return z},isRUsed:function(c,h,f){for(var g=0;g<f.length;++g){var d=f[g];if(d.a1==c&&"R"+d.r1==h){return true}if(d.a2==c&&"R"+d.r2==h){return true}}return false},getRepeat:function(f,c){for(var g=0;g<f.length;++g){var d=f[g];if(scil.Utils.indexOf(d.br.atoms,c)>=0){return d.n}}return 1},countMonomer:function(d,c){if(c==null){return}if(c.stats==null){c.stats=scil.helm.Interface.molStats(scil.helm.monomers.getMolfile(c))}d.mergeFrom(c.stats)}};scil.helm.HELMEditor={dlg:null,app:null,showpopup:function(c){this.show(c.getXml(),function(d){c.setXml(d)})},show:function(d,c){this.create();this.dlg.show();this.app.canvas.setXml(d);this.callback=c},create:function(){if(this.dlg!=null){return}var f=dojo.window.getBox();f.w-=60;f.h-=110;var j=this;var h=scil.Utils.createElement(null,"div");var c=scil.Utils.createElement(h,"div",null,{width:f.w,height:f.h});var g=scil.Utils.createElement(h,"div",null,{textAlign:"center"});scil.Utils.createButton(g,{label:"Save",src:scil.Utils.imgSrc("img/tick.gif"),onclick:function(){if(j.callback!=null){j.callback(j.app.canvas.getXml())}j.dlg.hide()}});scil.Utils.createButton(g," ");scil.Utils.createButton(g,{label:"Cancel",src:scil.Utils.imgSrc("img/cancel.gif"),onclick:function(){j.dlg.hide()}});this.dlg=new scilligence.Dialog("HELM Editor",h,{notitle:true});this.dlg.show();this.app=new scil.helm.App(c,{mexfontsize:"90%",topmargin:0,mexmonomerstab:true,canvastoolbar:true,sequenceviewonly:false,mexfavoritefirst:true,mexfilter:true,areasize:f})}};scil.helm.ExtinctionCoefficient={peptide:{W:5500,Y:1490,C:62.5},rna:{A:15.34,C:7.6,G:12.16,U:10.21,T:8.699999999999999,AA:13.65,AC:10.67,AG:12.79,AU:12.14,AT:11.42,CA:10.67,CC:7.52,CG:9.390000000000001,CU:8.369999999999999,CT:7.66,GA:12.92,GC:9.19,GG:11.43,GU:10.96,GT:10.22,UA:12.52,UC:8.9,UG:10.4,UU:10.11,UT:9.449999999999999,TA:11.78,TC:8.15,TG:9.699999999999999,TU:9.449999999999999,TT:8.609999999999999},calculate:function(h){var d=scil.helm.Chain.getChains(h);if(d==null||d.length==0){return""}var l=0;for(var f=0;f<d.length;++f){var c=d[f];var j=c._getPolymers();for(var g=0;g<j.length;++g){if(j[g].type=="RNA"){l+=this._calculateRNA(j[g].atoms)}else{if(j[g].type=="Peptide"){l+=this._calculatePeptide(j[g].atoms)}}}}return l},_calculatePeptide:function(d){if(d==null||d.length==0){return 0}var f={};for(var h=0;h<d.length;++h){var c=d[h];var l=scil.helm.Monomers.getMonomer(c);var g=l==null?null:l.na;if(g!=null&&this.peptide[g]){if(f[g]==null){f[g]=1}else{++f[g]}}}var n=0;for(var j in f){n+=this.peptide[j]*f[j]}return n/1000},_calculateRNA:function(d){if(d==null||d.length==0){return 0}var f={};var l=null;for(var h=0;h<d.length;++h){var c=d[h];var n=scil.helm.Monomers.getMonomer(c);var g=n==null?null:n.na;if(g==null){l=null;continue}if(this.rna[g]){if(f[g]==null){f[g]=1}else{++f[g]}}else{if(l!=null&&this.rna[l+g]){if(f[l+g]==null){f[l+g]=1}else{++f[l+g]}}}l=g}var q=0;for(var j in f){q+=this.rna[j]*f[j]}return q}};scil.helm.App=scil.extend(scil._base,{constructor:function(f,d){this.toolbarheight=30;if(typeof(f)=="string"){f=scil.byId(f)}this.mex=null;this.canvas=null;this.sequence=null;this.notation=null;this.properties=null;this.structureview=null;this.options=d==null?{}:d;if(d.ambiguity!=null){scil.helm.ambiguity=d.ambiguity}if(!scil.Utils.isNullOrEmpty(this.options.jsdrawservice)){JSDrawServices={url:this.options.jsdrawservice}}if(this.options.monomercleanupurl!=null&&scil.helm.Monomers.cleanupurl==null){scil.helm.Monomers.cleanupurl=this.options.monomercleanupurl}if(this.options.rulesurl!=null){scil.Utils.ajax(this.options.rulesurl,function(g){if(g.rules!=null){g=g.rules}scil.helm.RuleSet.loadDB(g)})}if(this.options.monomersurl!=null){var c=this;scil.Utils.ajax(this.options.monomersurl,function(g){if(g.monomers!=null){g=g.monomers}scil.helm.Monomers.loadDB(g,c.options.monomerfun);c.init(f)})}else{this.init(f)}},_getAreaSize:function(){return this.options.areasize==null?dojo.window.getBox():this.options.areasize},calculateSizes:function(){var c=this._getAreaSize();if(this.options.topmargin>0){c.h-=this.options.topmargin}var f=0;if(this.page!=null&&this.page.explorer!=null&&this.page.explorer.left!=null){f=this.page.explorer.left.offsetWidth}if(!(f>0)){f=300}var g={height:0,topheight:0,bottomheight:0,leftwidth:0,rightwidth:0};g.height=c.h-90-(this.options.mexfilter!=false?30:0)-(this.options.mexfind?60:0);g.leftwidth=f;g.rightwidth=c.w-f-25-(this.options.rightmargin>0?this.options.rightmargin:0);g.topheight=c.h*0.7;g.bottomheight=c.h-g.topheight-105;return g},init:function(f){var d=this;var g=this.calculateSizes();var h={caption:this.options.topmargin>0?null:"Palette",marginBottom:"2px",onresizetree:function(j){d.resizeWindow()},onrender:function(j){d.treediv=j;d.createPalette(j,g.leftwidth-10,g.height)}};this.page=new scil.Page(f,h,{resizable:true,leftwidth:g.leftwidth});scil.Utils.unselectable(this.page.explorer.left);var c=this.page.addDiv();this.canvasform=this.page.addForm({type:"custom",marginBottom:"2px",oncreate:function(j){d.createCanvas(j,g.rightwidth,g.topheight)}});this.handle=this.page.addResizeHandle(function(j){return d.onresize(j)},8);this.sequencebuttons=[{label:"Format",type:"select",items:["","RNA","Peptide"],key:"format"},{src:scil.Utils.imgSrc("img/moveup.gif"),label:"Apply",title:"Apply Sequence",onclick:function(){d.updateCanvas("sequence",false)}},{src:scil.Utils.imgSrc("img/add.gif"),label:"Append",title:"Append Sequence",onclick:function(){d.updateCanvas("sequence",true)}}];this.tabs=this.page.addTabs({marginBottom:"2px",onShowTab:function(){d.updateProperties()}});this.tabs.addForm({caption:"Sequence",type:"custom",tabkey:"sequence",buttons:this.options.sequenceviewonly?null:this.sequencebuttons,oncreate:function(j){d.createSequence(j,g.rightwidth,g.bottomheight)}});this.tabs.addForm({caption:"HELM",type:"custom",tabkey:"notation",buttons:this.options.sequenceviewonly?null:[{src:scil.Utils.imgSrc("img/moveup.gif"),label:"Apply",title:"Apply HELM Notation",onclick:function(){d.updateCanvas("notation",false)}},{src:scil.Utils.imgSrc("img/add.gif"),label:"Append",title:"Append HELM Notation",onclick:function(){d.updateCanvas("notation",true)}},{src:scil.Utils.imgSrc("img/tick.gif"),label:"Validate",title:"Validate HELM Notation",onclick:function(){d.validateHelm()}}],oncreate:function(j){d.createNotation(j,g.rightwidth,g.bottomheight)}});this.tabs.addForm({caption:"Properties",type:"custom",tabkey:"properties",oncreate:function(j){d.createProperties(j,g.rightwidth,g.bottomheight)}});this.tabs.addForm({caption:"Structure View",type:"custom",tabkey:"structureview",oncreate:function(j){d.createStructureView(j,g.rightwidth,g.bottomheight)}});scil.connect(window,"onresize",function(j){d.resizeWindow()})},validateHelm:function(){if(this.options.onValidateHelm!=null){this.options.onValidateHelm(this);return}var f=this.options.validateurl;if(f==null){f=JSDrawServices.url+"?cmd=helm.validate"}this.setNotationBackgroundColor("white");var c=scil.Utils.getInnerText(this.notation);if(scil.Utils.isNullOrEmpty(c)){return}var d=this;scil.Utils.ajax(f,function(g){d.setNotationBackgroundColor(g.valid?"#9fc":"#fcf")},{helm:c})},resizeWindow:function(){var d=this.calculateSizes();this.canvas.resize(d.rightwidth,d.topheight-70);var c={width:d.rightwidth+"px",height:d.bottomheight+"px"};scil.apply(this.sequence.style,c);scil.apply(this.notation.style,c);c={width:d.rightwidth+"px",height:(d.bottomheight+this.toolbarheight)+"px"};scil.apply(this.properties.parent.style,c);this.structureview.resize(d.rightwidth,d.bottomheight+this.toolbarheight);this.mex.resize(d.height)},swapCanvasSequence:function(){var c=this.canvasform.form.dom;var f=this.handle;var d=this.tabs.tabs.dom;if(f.nextSibling==d){c.parentNode.insertBefore(d,c);c.parentNode.insertBefore(f,c)}else{c.parentNode.insertBefore(d,c.nextSibling);c.parentNode.insertBefore(f,c.nextSibling)}},onresize:function(d){if(this.handle.nextSibling==this.tabs.tabs.dom){var f=this.canvas.dimension.y;var c=scil.Utils.parsePixel(this.sequence.style.height);if(f+d>80&&c-d>20){this.canvas.resize(0,f+d);this.sequence.style.height=(c-d)+"px";this.notation.style.height=(c-d)+"px";this.properties.parent.style.height=(c-d)+"px";this.structureview.resize(0,c-d);return true}}else{var f=scil.Utils.parsePixel(this.sequence.style.height);var c=this.canvas.dimension.y;if(f+d>20&&c-d>80){this.sequence.style.height=(f+d)+"px";this.notation.style.height=(f+d)+"px";this.properties.parent.style.height=(f+d)+"px";this.structureview.resize(0,f+d);this.canvas.resize(0,c-d);return true}}return false},createPalette:function(c,g,d){var f=scil.clone(this.options);f.width=g;f.height=d;this.mex=new scil.helm.MonomerExplorer(c,null,f)},createCanvas:function(d,h,f){d.style.border="solid 1px #eee";var g=this;var c={skin:"w8",showabout:this.options.showabout,showtoolbar:this.options.canvastoolbar!=false,toolbarmode:scil.helm.App.toolbarmode,showmonomerexplorer:true,inktools:false,biology:true,rxn:false,width:h,height:f,ondatachange:function(){g.updateProperties()},onselectionchanged:function(){g.onselectionchanged()},onselectcurrent:function(j,n,l){g.onselectcurrent(j,n,l)},onvalidatetext:function(l,j){return g.onvalidatetext(l,j)}};this.canvas=scil.helm.Interface.createCanvas(d,c);this.canvas.helm.monomerexplorer=this.mex;this.mex.plugin=this.canvas.helm;this.canvas._testdeactivation=function(j,l){var n=j.target||j.srcElement;return scil.Utils.hasAnsestor(n,g.canvas.helm.monomerexplorer.div)}},onvalidatetext:function(d,c){if(scil.Utils.isNullOrEmpty(d)){return}var f=c.text;if(f!=null&&f.fieldtype=="BRACKET_TYPE"&&f.anchors.length==1&&JSDraw2.Bracket.cast(f.anchors[0])!=null){if(!/^[*]|([0-9]+([-][0-9]+)?)$/.test(d)){scil.Utils.alert("Invalid subscript");return false}}},onselectcurrent:function(d,h,f){var c=JSDraw2.Atom.cast(h);if(c==null||f.start!=null||f.contextmenu!=null&&f.contextmenu.isVisible()){scil.helm.MolViewer.hide();return}var n=c==null?null:c.biotype();var l=scil.helm.Monomers.getMonomerSet(n);var j=c==null?null:c.elem;var g=l==null?null:l[scil.helm.symbolCase(j)];if(g!=null&&g.m==""&&c!=null&&c.superatom!=null){g.m=c.superatom.getXml()}scil.helm.MolViewer.show(d,n,g,j,f,c)},createSequence:function(d,g,f){var c={};if(!this.options.sequenceviewonly){c.contenteditable="true";c.spellcheck="false"}this.sequence=scil.Utils.createElement(d,"div",null,{width:g,height:f,overfloatY:"scroll",wordBreak:"break-all"},c)},createNotation:function(d,g,f){var c={};if(!this.options.sequenceviewonly){c.contenteditable="true";c.spellcheck="false"}this.notation=scil.Utils.createElement(d,"div",null,{width:g,height:f,overfloatY:"scroll",wordBreak:"break-all"},c)},createProperties:function(f,j,h){var c=scil.Utils.createElement(f,"div",null,{width:j,overflow:"scroll",height:h+this.toolbarheight});var g={mw:{label:"Molecular Weight"},mf:{label:"Molecular Formula"},ec:{label:"Extinction Coefficient"}};this.properties=new scil.Form({viewonly:true});this.properties.render(c,g,{immediately:true})},createStructureView:function(f,h,g){var c=scil.Utils.createElement(f,"div",null,{width:h,height:g+this.toolbarheight});this.structureview=new JSDraw2.Editor(c,{viewonly:true})},resize:function(){var c=this._getAreaSize();var j=c.w;var f=c.h;var g=c.l;var h=c.t},updateCanvas:function(f,c){var d=null;var g=this.canvas.helm;var h=null;if(f=="sequence"){if(this.sequencebuttons!=null){d=this.getValueByKey(this.sequencebuttons,"format")}h=scil.Utils.trim(scil.Utils.getInnerText(this.sequence));if(/^((RNA)|(PEPTIDE)|(CHEM)|(BLOB))[0-9]+/.test(h)){d="HELM"}else{h=h.replace(/[\n][>|;].*[\r]?[\n]/ig,"").replace(/^[>|;].*[\r]?[\n]/i,"");h=h.replace(/[ \t\r\n]+/g,"")}}else{h=scil.Utils.getInnerText(this.notation)}g.setSequence(h,d,g.getDefaultNodeType(scil.helm.HELM.SUGAR),g.getDefaultNodeType(scil.helm.HELM.LINKER),c)},getValueByKey:function(f,d){for(var c=0;c<f.length;++c){if(f[c].key==d){return f[c].b.value}}return null},updateProperties:function(){switch(this.tabs.tabs.currentTabKey()){case"sequence":if(this.sequence!=null){this.sequence.innerHTML=this.canvas.getSequence(true)}break;case"notation":if(this.notation!=null){var c=scil.Utils.getInnerText(this.notation);var d=this.canvas.getHelm(true,this.options.monomersurl);if(c!=d){this.notation.innerHTML=d;this.setNotationBackgroundColor("white")}}break;case"properties":this.calculateProperties();break;case"structureview":this.updateStructureView();break}},setNotationBackgroundColor:function(d){if(this.notation!=null){this.notation.parentNode.parentNode.style.background=d}},onselectionchanged:function(){switch(this.tabs.tabs.currentTabKey()){case"sequence":if(this.sequence!=null){this.sequence.innerHTML=this.canvas.getSequence(true)}break;case"notation":if(this.notation!=null){this.notation.innerHTML=this.canvas.getHelm(true)}break;case"structureview":this.updateStructureView();break}},calculateProperties:function(){if(this.properties==null){return}var c={};this.properties.setData(c);if(this.options.calculatorurl!=null){var f=this;var d=this.canvas.getHelm();if(d!=null){scil.Utils.ajax(this.options.calculatorurl,function(g){f.properties.setData(g)},{helm:d})}}else{c.mw=Math.round(this.canvas.getMolWeight()*100)/100;c.mf=this.canvas.getFormula(true);c.ec=Math.round(this.canvas.getExtinctionCoefficient(true)*100)/100;this.properties.setData(c)}},getSelectedAsMol:function(g){var h=new JSDraw2.Mol();for(var f=0;f<g.atoms.length;++f){if(g.atoms[f].selected){h.atoms.push(g.atoms[f])}}var c=h.atoms;for(var f=0;f<g.bonds.length;++f){var d=g.bonds[f];if(d.selected&&d.a1.selected&&d.a2.selected){h.bonds.push(d)}}return h},selectBondsOfSelectedAtoms:function(f){var g=0;for(var d=0;d<f.bonds.length;++d){var c=f.bonds[d];if(!c.selected&&c.a1.selected&&c.a2.selected){c.selected=true;++g}}return g},containsAll:function(d,f){for(var c=0;c<f.length;++c){if(scil.Utils.indexOf(d,f[c])<0){return false}}return true},expandRepeat:function(j,E,u,F){var C=null;var D=null;var g=null;var h=null;var B=[];for(var n=0;n<u.bonds.length;++n){var d=u.bonds[n];var q=scil.Utils.indexOf(j.atoms,d.a1);var t=scil.Utils.indexOf(j.atoms,d.a2);if(q>=0&&t>=0){B.push(d)}else{if(q>=0&&t<0){if(d.r1==1){C=d.a1;g=d}else{if(d.r1==2){D=d.a1;h=d}}}else{if(t>=0&&q<0){if(d.r2==1){C=d.a2;g=d}else{if(d.r2==2){D=d.a2;h=d}}}}}}for(var l=0;l<E-1;++l){var A=[];var x=null;var y=null;for(var n=0;n<j.atoms.length;++n){var c=j.atoms[n];var w=c.clone();F.atoms.push(w);A.push(w);if(c==C){x=w}else{if(c==D){y=w}}}for(var n=0;n<B.length;++n){var f=B[n];var z=f.clone();F.bonds.push(z);u.bonds.push(z);z.a1=A[scil.Utils.indexOf(j.atoms,f.a1)];z.a2=A[scil.Utils.indexOf(j.atoms,f.a2)]}var z=null;if(g==null){z=new JSDraw2.Bond(null,null,JSDraw2.BONDTYPES.SINGLE);z.r1=2;z.r2=1}else{z=g.clone()}F.bonds.push(z);u.bonds.push(z);if(g==null||g.a1==C){z.a1=x;z.a2=D}else{z.a2=x;z.a1=D}if(h!=null){h.replaceAtom(D,y);D=y}}},updateStructureView:function(){if(this.structureview==null){return}this.structureview.clear(true);var y=this.canvas.m.clone();for(var u=0;u<y.atoms.length;++u){y.atoms[u].__mol=null}if(this.selectBondsOfSelectedAtoms(y)>0){this.canvas.refresh()}var G=this.getSelectedAsMol(y);if(G==null||G.atoms.length==0){return}var f=G.atoms;var j=G.bonds;for(var u=0;u<y.graphics.length;++u){var l=JSDraw2.Bracket.cast(y.graphics[u]);if(l==null){continue}var F=l==null?null:l.getSubscript(y);var D=parseInt(F);if(D>1&&l.atoms!=null&&l.atoms.length>0&&this.containsAll(f,l.atoms)){this.expandRepeat(l,D,y,G)}}var h=null;var B=[];for(var u=0;u<f.length;++u){var c=f[u];var C=scil.helm.Monomers.getMonomer(c);var x=scil.helm.Interface.createMol(scil.helm.monomers.getMolfile(C));c.__mol=x;var q=y.getAllBonds(c);var I={};for(var w=0;w<q.length;++w){var g=q[w];if(g.a1==c){I["R"+g.r1]=true}else{if(g.a2==c){I["R"+g.r2]=true}}}for(var E in C.at){if(I[E]){continue}this._replaceR(x,E,C.at[E])}if(x!=null&&!x.isEmpty()){var t=x.medBondLength();if(!(h>0)){h=t}else{x.scale(h/t,new JSDraw2.Point(0,0))}}B.push(x)}while(f.length>0){var c=f[0];f.splice(0,1);this.connectNextMonomer(c,f,j)}var A=B[0];for(var u=1;u<B.length;++u){A.mergeMol(B[u])}if(A==null){return}var H=this.options.cleanupurl;if(H==null){H=JSDrawServices.url+"?cmd=cleanup"}if(H!=null){if(this.options.onCleanUpStructure!=null){this.options.onCleanUpStructure(A,this)}else{var z=this;scil.Utils.ajax(H,function(d){z.structureview.setMolfile(d==null?null:d.output)},{input:A.getMolfile(),inputformat:"mol",outputformat:"mol"})}}else{this.structureview.setMolfile(A.getMolfile())}},_replaceR:function(g,h,d){for(var f=0;f<g.atoms.length;++f){var c=g.atoms[f];if(c.elem=="R"&&c.alias==h){scil.helm.Cap.replaceRAtom(d,c,g);return true}}return false},connectNextMonomer:function(c,d,g){var j=c.__mol;var q=[];for(var h=g.length-1;h>=0;--h){var f=g[h];var u=null;var w=null;var n=null;if(f.a1==c){u=f.r1==null?null:"R"+f.r1;w=f.r2==null?null:"R"+f.r2;n=f.a2}else{if(f.a2==c){u=f.r2==null?null:"R"+f.r2;w=f.r1==null?null:"R"+f.r1;n=f.a1}}if(n==null){continue}g.splice(h,1);if(n.__mol==null){continue}var l=n.__mol;if(u!=null&&w!=null){scil.helm.MolViewer.joinMol(j,u,l,w)}q.push(n)}for(var h=0;h<q.length;++h){var n=q[h];var t=scil.Utils.indexOf(d,n);if(t==-1||t==null){continue}d.splice(t,1);this.connectNextMonomer(n,d,g)}}});scil.apply(scil.helm.App,{toolbarmode:"helm"});scil.helm.MonomerManager=scil.extend(scil._base,{constructor:function(d,c){if(typeof(d)=="string"){d=scil.byId(d)}this.options=c==null?{}:c;if(this.options.ajaxurl==null){this.options.ajaxurl=scil.helm.ajaxurl}this.libid=this.options.libid;if(d!=null){this.init(d,this.options.viewonly)}},showSearch:function(c){if(this.dlg==null){var d=scil.Utils.createElement(null,"div");this.dlg=new scil.Dialog("",d);this.dlg.show("Search Monomers");this.init(this.dlg,true,true)}this.dlg.show();this.dlg.moveCenter();this.callback=c},init:function(l,t,g){var j=this;this.page=new scil.Page(l);var j=this;this.buttons=["-"];this.buttons.push({type:"input",key:"symbol",labelstyle:{fontSize:"90%"},label:"Symbol",styles:{width:100},autosuggesturl:this.getAjaxUrl("suggest"),onenter:function(){j.refresh()},onchange:function(){j.clearFilterValue("name")}});this.buttons.push({type:"input",key:"name",labelstyle:{fontSize:"90%"},label:"Name",styles:{width:100},autosuggesturl:this.getAjaxUrl("suggestname"),onenter:function(){j.refresh()},onchange:function(){j.clearFilterValue("symbol")}});this.buttons.push({type:"select",key:"polymertype",labelstyle:{fontSize:"90%"},items:scil.helm.MonomerManager.getPolymerTypes(),label:"Polymer Type",styles:{width:100},onchange:function(){j.refresh()}});this.buttons.push({type:"select",key:"monomertype",labelstyle:{fontSize:"90%"},items:scil.helm.MonomerManager.getMonomerTypes(),label:"Monomer Type",styles:{width:100},onchange:function(){j.refresh()}});this.buttons.push({type:"input",key:"naturalanalog",labelstyle:{fontSize:"90%"},label:"Natural Analog",styles:{width:100},onenter:function(){j.refresh()}});this.buttons.push({type:"select",key:"status",labelstyle:{fontSize:"90%"},items:scil.helm.MonomerManager.getStatuses(),label:"Status",styles:{width:100},onchange:function(){j.refresh()}});this.buttons.push("|");this.buttons.push({type:"input",key:"smiles",labelstyle:{fontSize:"90%"},label:"Substructure",onclicklabel:function(){j.drawSubstructure()},styles:{width:100},onenter:function(){j.refresh()},onchange:function(){j.refresh()}});this.buttons.push("|");this.buttons.push({label:"Display As",key:"display",cookiekey:"helm_monomer_display",type:"select",value:"Card",items:scil.Utils.getDictKeys(scil.helm.MonomerManager.displays),onchange:function(){j.refresh()}});this.buttons.push("|");this.buttons.push({type:"select",key:"countperpage",labelstyle:{fontSize:"90%"},label:"Count",items:["",10,25,50,100],onchange:function(){j.refresh()}});if(!t&&typeof(JSDrawServices)!="undefined"&&JSDrawServices.url!=null){this.buttons.splice(0,0,"-");this.buttons.splice(0,0,{type:"a",src:scil.Utils.imgSrc("img/open.gif"),title:"Import Monomers",onclick:function(){j.uploadFile()}});this.buttons.splice(0,0,"-");this.buttons.splice(0,0,{type:"a",src:scil.Utils.imgSrc("img/save.gif"),title:"Export Monomers",items:["JSON","SDF"],onclick:function(u){j.exportFile(u)}})}if(scil.helm.MonomerManager.onGetButtons!=null){scil.helm.MonomerManager.onGetButtons(this.buttons,this)}var c=scil.helm.MonomerManager.columns;c.id.render=function(x,w,u){return u==null?x:j.getAjaxUrl("image&wrapper=raw&w="+u.options.imgwidth+"&h="+u.options.imgheight+"&id="+x+"&capr="+u.options.capr)};var d=scil.helm.MonomerManager.fields;d.polymertype.items=scil.helm.MonomerManager.getPolymerTypes();d.monomertype.items=scil.helm.MonomerManager.getMonomerTypes();d.status.items=scil.helm.MonomerManager.getStatuses();for(var f=1;f<=5;++f){d["r"+f].items=scil.Utils.getDictKeys(scil.helm.Cap.caps)}scil.helm.MonomerManager.current=this;scil.helm.MonomerManager.ajaxurl=this.options.ajaxurl;c.versions={label:"Versions",type:"html",render:function(u,w){return u>0?"<a href='javascript:scil.helm.MonomerManager.showVersions("+w.id+")'>"+u+"</a>":null}};var n=g?null:scil.helm.MonomerManager.getTabs();if(n!=null){n.general.fields=d}this.monomers=this.page.addForm({caption:"Monomer List",key:"id",object:this.getCmd(),ajaxurl:scil.helm.ajaxurl,imagewidth:30,allowcopy:!t,canadd:!t,canedit:!t,rowcheck:g,buttons:this.buttons,ondisplayitems:function(u){return j.getItemsForCardView(u)},onbeforerefresh:function(u){j.onbeforerefresh(u)},onbeforesave:function(w,u,x){return j.onbeforesave(w,u,x)},columns:c,imgkey:"id",imgtitlekey:"symbol",autohidecolumns:true,displays:scil.helm.MonomerManager.displays,savedoc:true,formcaption:"Monomer",usetabs:n!=null,fields:n!=null?n:d});if(!g){if(n==null){this.page.addForm({caption:"Monomer",type:"form",object:this.getCmd(),ajaxurl:scil.helm.ajaxurl,fields:d},this.monomers)}else{var q=this.page.addTabs();for(var h in n){q.addForm({caption:n[h].caption,type:"form",object:this.getCmd(),ajaxurl:scil.helm.ajaxurl,fields:n[h].fields},this.monomers)}}}this.monomers.refresh()},getCmd:function(c){return(this.libid>0?"helm.monomerorg."+this.libid:"helm.monomer")+(c==null?"":"."+c)},getAjaxUrl:function(c){return this.options.ajaxurl+this.getCmd(c)},getItemsForCardView:function(d){if(d==null||scil.helm.MonomerManager.carditems==null){return d}var g={};var f=scil.helm.MonomerManager.carditems;for(var c=0;c<f.length;++c){g[f[c]]=d[f[c]]}return g},drawSubstructure:function(){var c=this;JSDraw2.Editor.showPopup("Draw Query","Done",function(d){scil.Form.setButtonValueByKey(c.buttons,"smiles",d.getSmiles())})},clearFilterValue:function(d){for(var c=0;c<this.buttons.length;++c){if(this.buttons[c].key==d){this.buttons[c].b.value="";break}}},onbeforesave:function(h,d,j){if(h.polymertype!="CHEM"&&scil.Utils.isNullOrEmpty(h.naturalanalog)){scil.Utils.alert("Natural Analog cannot be blank");return false}if(scil.helm.MonomerManager.savejsdraw){h.molfile=j.fields.molfile.jsd.getXml()}else{h.molfile=j.fields.molfile.jsd.getMolfile()}var q={};var f=j.fields.molfile.jsd.m.atoms;for(var l=0;l<f.length;++l){var c=f[l];if(c.elem=="R"){var n=(c.alias==null?"R":c.alias);if(q[n.toLowerCase()]!=null){scil.Utils.alert("The R cannot be used twice: "+n);return false}q[n.toLowerCase()]=n}}for(var n in q){var g=h[n];if(scil.Utils.isNullOrEmpty(g)){scil.Utils.alert("The cap of "+q[n]+" is not defined yet");return false}}for(var l=1;l<=5;++l){var n="r"+l;if(!scil.Utils.isNullOrEmpty(h[n.toLowerCase()])&&q[n.toLowerCase()]==null){scil.Utils.alert("R"+l+" is defined, but not drawn in the structure");return false}}},refresh:function(c){this.monomers.refresh()},onbeforerefresh:function(c){this.monomers.switchView(c.display)},uploadFile:function(){var c={duplicatecheck:{label:"Duplicate Check",type:"checkbox",value:true},overwritemode:{label:"Overwriting Mode",type:"checkbox"}};scil.FileUploader.upload({caption:"Import Monomer Library",fields:c,url:this.getAjaxUrl("uploadlib"),callback:function(d){scil.Utils.alert2(d.n+" monomers are imported.\r\n"+(d.errors==null?"":d.errors))}})},exportFile:function(c){window.open(this.options.ajaxurl.replace("/post?","/get?")+this.getCmd("savefile&wrapper=raw&ext="+c),"_blank")}});scil.apply(scil.helm.MonomerManager,{current:null,savejsdraw:false,carditems:null,kFilters:["status","polymertype","monomertype","symbol","name","smiles","display","smiles","display","countperpage"],displays:{Table:{type:"table"},Card:{type:"block",imgwidth:250,imgheight:150,showtexts:true,capr:0},Structure:{type:"block",imgwidth:200,imgheight:150,showtexts:false,capr:0},"Card (capped)":{type:"block",imgwidth:250,imgheight:150,showtexts:true,capr:1},"Structure (capped)":{type:"block",imgwidth:200,imgheight:150,showtexts:false,capr:1}},getTabs:function(){return null},showVersions:function(c){var d=this;scil.Utils.ajax(this.current.getAjaxUrl("versions"),function(f){d.showVersions2(f)},{id:c})},showVersions2:function(f){if(this.versionDlg==null){var c={table:{type:"table",viewonly:true,columns:{versionid:{label:"Version ID"},dt:{label:"Date",type:"date"},user:{label:"User"},action:{label:"Action"},notes:{label:"Notes"}}}};this.versionDlg=scil.Form.createDlgForm("Versions",c,null,{hidelabel:true})}for(var d=1;d<f.length;++d){f[d].versionid=f[d-1].versionid}f[0].versionid="Current";this.versionDlg.show();this.versionDlg.form.setData({table:f});this.versionDlg.moveCenter()},getValueByKey:function(f,d){for(var c=0;c<f.length;++c){if(f[c].key==d){return f[c].b.value}}return null},getPolymerTypes:function(){return["","RNA","CHEM","PEPTIDE"]},getMonomerTypes:function(){return["","Backbone","Branch","Undefined"]},getStatuses:function(){return["","Virtual","Active","Retired"]},columns:{id:{type:"hidden",iskey:true},symbol:{label:"Symbol",width:100},aliases:{label:"Aliases",width:100},name:{label:"Name",width:200},polymertype:{label:"Polymer Type",width:100},monomertype:{label:"Monomer Type",width:100},naturalanalog:{label:"N.A.",width:100},status:{label:"Status",width:60},r1:{label:"R1",width:50},r2:{label:"R2",width:50},r3:{label:"R3",width:50},author:{label:"Author",width:100},versions:null,createddate:{label:"Created Date",type:"date",width:100}},fields:{id:{type:"hidden"},symbol:{label:"Symbol",required:true},aliases:{label:"Aliases",width:800},name:{label:"Name",required:true,width:800},polymertype:{label:"Polymer Type",required:true,type:"select",items:null,width:100},monomertype:{label:"Monomer Type",required:true,type:"select",items:null,width:100},naturalanalog:{label:"Natural Analog",required:true,width:100},status:{label:"Status",type:"select",items:null},author:{label:"Author",width:100},smiles:{label:"SMILES",width:800,viewonly:true},molfile:{label:"Structure",type:"jsdraw",width:800,height:300},r1:{label:"R1",type:"select",items:null},r2:{label:"R2",type:"select",items:null},r3:{label:"R3",type:"select",items:null},r4:{label:"R4",type:"select",items:null},r5:{label:"R5",type:"select",items:null}}});scil.helm.MonomerLibApp=scil.helm.MonomerManager;scil.helm.RuleSet={kApplyAll:false,rules:[{id:1,category:"Demo",name:"Replace base A with U",description:"",script:"function(plugin) {var n = plugin.replaceMonomer(scil.helm.HELM.BASE, 'A', 'U');return n > 0;}"},{id:2,category:"Demo",name:"Replace base A with G",description:"",script:"function(plugin) {var n = plugin.replaceMonomer(scil.helm.HELM.BASE, 'A', 'G');return n > 0;}"},{id:3,category:"Test",name:"Replace base A with T",description:"",script:"function(plugin) {var n = plugin.replaceMonomer(scil.helm.HELM.BASE, 'A', 'T');return n > 0;}"}],loadDB:function(c){this.rules=c},favorites:new scil.Favorite("ruleset"),saveTextDB:function(t){var d=["id","name","description","script","author","category"];var h=0;var l="";for(var f=0;f<this.rules.length;++f){var j=this.rules[f];var q="";for(var g=0;g<d.length;++g){q+=(g>0?"|":"")+j[d[g]]}l+=JSDraw2.Base64.encode(q)+"\n";++h}l=h+"\n"+l;if(t==null){return l}var c={client:"jsdraw",wrapper:"none",filename:"rules.txt",directsave:1,contents:l};scil.Utils.post(t,c,"_blank")},addFavorite:function(c){var h=c.srcElement||c.target;var j=scil.Utils.getParent(h,"TR");var g=j.getAttribute("ruleid");var d=h.getAttribute("star")!="1";if(d){h.setAttribute("star","1");h.src=scil.Utils.imgSrc("img/star.png")}else{h.setAttribute("star","");h.src=scil.Utils.imgSrc("img/star0.png")}this.favorites.add(g,d)},filterRules:function(j,h,c){h=scil.Utils.trim(h).toLowerCase();var f=j.childNodes;for(var d=0;d<this.rules.length;++d){var g=this.rules[d];var l=f[d+1];if((h==""||g.name.toLowerCase().indexOf(h)>=0)&&(scil.Utils.isNullOrEmpty(c)||c==g.category)){l.style.display=""}else{l.style.display="none"}}},listRules:function(t,c,d){var g=t.divRule;scil.Utils.removeAll(g);var q=this;var w=scil.Utils.createTable(g,0,0,{width:"100%"});var x=scil.Utils.createElement(w,"tr",null,{background:"#eee",display:(this.kApplyAll?"":"none")});var f=scil.Utils.createElement(scil.Utils.createElement(x,"td"),"checkbox");scil.Utils.createButton(scil.Utils.createElement(x,"td",null,{textAlign:"right",padding:"3px 3px 3px 0"},{colSpan:3}),this.createApplyAll("Apply All",d,w));scil.connect(f,"onclick",function(){q.checkAll(w)});var l=1;var n=[];for(var j=0;j<this.rules.length;++j){var u=this.rules[j];var h=this.favorites.contains(u.id);if(this.favorites.contains(u.id)){this.listOneRule(t,w,u,++l,c,true)}else{n.push(u)}}for(var j=0;j<n.length;++j){this.listOneRule(t,w,n[j],++l,c)}return w},listOneRule:function(h,l,j,f,c,d){var g=this;var q=scil.Utils.createElement(l,"tr",null,{background:f%2==1?"#eee":null},{ruleid:j.id});scil.Utils.createElement(scil.Utils.createElement(q,"td"),"checkbox",null,{display:(this.kApplyAll?"":"none"),width:"1%"});var n=scil.Utils.createElement(q,"td");scil.Utils.createElement(n,"img",null,{},{star:(d?1:null),src:scil.Utils.imgSrc("img/star"+(d?"":"0")+".png")},function(t){g.addFavorite(t);h.listRules()});n=scil.Utils.createElement(q,"td",null,{width:"99%"});this.listOneRule2(n,j,c,f)},listOneRule2:function(n,h,d,f){var j=h.name;if(scil.Utils.isNullOrEmpty(j)){j=h.description}if(j.length>50){j=j.substr(0,47)+"..."}var l=scil.Utils.createTable(n,0,0,{width:"100%"});var q=scil.Utils.createElement(l,"tr");scil.Utils.createElement(q,"td","["+h.id+"] "+j,{padding:"3px 0 3px 0"},{title:h.description});var c=scil.Utils.createElement(scil.Utils.createElement(q,"td",null,{textAlign:"right"}),"button",JSDraw2.Language.res("Apply"),{display:"none"});var g=this;scil.connect(c,"onclick",function(){d(h.script)});scil.connect(n,"onmouseover",function(t){c.style.display=""});scil.connect(n,"onmouseout",function(t){c.style.display="none"})},checkAll:function(h){var g=h.childNodes;var c=g[0].childNodes[0].childNodes[0].checked;for(var d=1;d<g.length;++d){var j=g[d];j.childNodes[0].childNodes[0].checked=c}},createApplyAll:function(d,c,f){return{label:d,type:"a",onclick:function(g){var j=[];var l=f.childNodes;for(var h=1;h<l.length;++h){var n=l[h];if(n.childNodes[0].childNodes[0].checked){j.push(parseInt(n.getAttribute("ruleid")))}}if(j.length==0){scil.Utils.alert("No rule selected")}else{c(j)}}}},applyRules:function(h,l){if(l.length==0){return}var g=[];for(var d=0;d<l.length;++d){for(var f=0;f<this.rules.length;++f){var j=this.rules[f];if(l[d]==j.id){g.push(j);break}}}var c={plugin:h,n:g.length,changed:0,list:g,cloned:h.jsd.clone()};this._applyNextRule(c)},applyRule:function(f,g){var d=[{script:g,name:null}];var c={plugin:f,n:d.length,changed:0,list:d,cloned:f.jsd.clone()};this._applyNextRule(c)},_applyNextRule:function(c){if(c.list.length==0){return}var f=this;var g=c.list[0];c.list.splice(0,1);var d=function(j,h){if(h!=null){scil.Utils.alert(h);c.plugin.jsd.restoreClone(c.cloned);return}if(j){++c.changed}if(c.list.length>0){f._applyNextRule(c);return}if(c.changed>0){c.plugin.jsd.pushundo(c.cloned);c.plugin.jsd.refresh(true);scil.Utils.alert((c.n>1?"Rules":"Rule")+" applied successfully!")}else{scil.Utils.alert((c.n>1?"Rules":"Rule")+" applied, but nothing changed!")}};this._applyOneRule(c.plugin,g.script,g.name,d)},_applyOneRule:function(plugin,script,name,callback){var rulefun=null;if(typeof(script)=="string"){rulefun=scil.Utils.eval(script)}else{if(typeof(script)=="function"){rulefun=script}}var f=false;var error=null;if(rulefun==null){error="Error: Invalid rule function: "+name}else{try{f=rulefun(plugin)}catch(e){error="Error: "+(name==null?"":name)+"\n---------------\n"+e.message+"\n---------------\n"+e.stack}}callback(f,error)}};scil.helm.RuleManager=scil.extend(scil._base,{constructor:function(d,c){if(typeof(d)=="string"){d=scil.byId(d)}this.options=c==null?{}:c;this.init(d)},init:function(f){var d=this;this.page=new scil.Page(f);var d=this;this.buttons=["-",{type:"select",key:"category",labelstyle:{fontSize:"90%"},items:scil.helm.RuleManager.categories,label:"Category",styles:{width:100},onchange:function(){d.refresh()}},{type:"select",key:"countperpage",labelstyle:{fontSize:"90%"},label:"Count",items:["",10,25,50,100],onchange:function(){d.refresh()}}];var c=scil.helm.RuleManager.getFields();c.script.button=[{label:"Test Script",onclick2:function(g){d.testscript(g)}},{label:"Test Applying",onclick2:function(g,h){d.testapplying(g,h)}}];c.test={label:"Test Structure",type:"jsdraw",helmtoolbar:true,width:900,height:300};this.rules=this.page.addForm({caption:"Rule Set",key:"id",object:"helm.rule",ajaxurl:scil.helm.ajaxurl,buttons:this.buttons,onbeforerefresh:function(g){d.onbeforerefresh(g)},onbeforesave:function(h,g,j){h.test=null},columns:{id:{label:"ID",width:50,iskey:true},category:{label:"Category",width:60},name:{label:"Name",width:100},description:{label:"Description",width:200},author:{label:"Author",width:100},createddate:{label:"Created Date",type:"date",width:100}},formcaption:"Rule",fields:c,defaultvalues:{script:"function(plugin) {\n\n}\n\n//function(plugin) { \n//    scil.Utils.ajax('http://SERVER/youerservice', function(ret) {\n//        plugin.setHelm(ret.new_helm);\n//    });\n//} "}});this.page.addForm({caption:"Rule",type:"form",object:"helm.rule",ajaxurl:scil.helm.ajaxurl,fields:scil.helm.RuleManager.getFields()},this.rules);this.rules.refresh()},refresh:function(c){this.rules.refresh()},onbeforerefresh:function(c){scil.Form.getButtonValuesByKey(this.buttons,["category","countperpage"],c)},testapplying:function(c,d){var f=d.fields.test.jsd.helm;f.applyRule(c.value)},testscript:function(field){var s=field.value;if(scil.Utils.trim(s)==""){return}try{eval("var __fun="+s);if(typeof(__fun)=="function"){scil.Utils.alert("Looks good!")}else{scil.Utils.alert("It should be a Javascript function, like this: \nfunction(plugin) {\n //... \n}")}}catch(e){scil.Utils.alert(e.message)}}});scil.apply(scil.helm.RuleManager,{categories:["","General"],getFields:function(){return{id:{label:"ID",viewonly:true},category:{label:"Category",width:200,type:"select",items:this.categories},name:{label:"Name",required:true,width:800},description:{label:"Description",type:"textarea",width:900,height:40},author:{label:"Author",width:100},script:{label:"Javascript",required:true,type:"textarea",width:900,height:160}}}});scil.helm.RuleSetApp=scil.helm.RuleManager;scil.helm.HELMEditor={dlg:null,app:null,showpopup:function(c){this.show(c.getXml(),function(d){c.setXml(d)})},show:function(d,c){this.create();this.dlg.show();this.app.canvas.setXml(d);this.callback=c},create:function(){if(this.dlg!=null){return}var f=dojo.window.getBox();f.w-=60;f.h-=110;var j=this;var h=scil.Utils.createElement(null,"div");var c=scil.Utils.createElement(h,"div",null,{width:f.w,height:f.h});var g=scil.Utils.createElement(h,"div",null,{textAlign:"center"});scil.Utils.createButton(g,{label:"Save",src:scil.Utils.imgSrc("img/tick.gif"),onclick:function(){if(j.callback!=null){j.callback(j.app.canvas.getXml())}j.dlg.hide()}});scil.Utils.createButton(g," ");scil.Utils.createButton(g,{label:"Cancel",src:scil.Utils.imgSrc("img/cancel.gif"),onclick:function(){j.dlg.hide()}});this.dlg=new scilligence.Dialog("HELM Editor",h,{notitle:true});this.dlg.show();this.app=new scil.helm.App(c,{mexfontsize:"90%",topmargin:0,mexmonomerstab:true,canvastoolbar:true,sequenceviewonly:false,mexfavoritefirst:true,mexfilter:true,areasize:f})}};scil.helm.AutoPair={kMaxEndLength:10,kMinCircelSize:4,pairs:{AT:1,TA:1,AU:1,UA:1,CG:1,GC:1},makeHairpin:function(d,c){var g=this.getNA(c);var f=scil.helm.AutoPair.hairpin(g.seq);return this.createPairs(d,f,g.list,g.list)},pairDuplex:function(f,c,d){var h=this.getNA(c);var j=this.getNA(d);var g=scil.helm.AutoPair.duplex(h.seq,j.seq);return this.createPairs(f,g,h.list,j.list)},createPairs:function(l,t,h,j){if(t==null||t.length==0){return false}var q=0;for(var g=0;g<t.length;++g){var c=h[t[g].i1];var d=j[t[g].i2];if(l.findBond(c,d)!=null){continue}++q;var f=new JSDraw2.Bond(c,d,JSDraw2.BONDTYPES.UNKNOWN);l.bonds.push(f)}return q>0},getNA:function(d){var j="";var g=[];for(var f=0;f<d.length;++f){var c=d[f];if(c==null){continue}var h=scil.helm.Monomers.getMonomer(c);if(h!=null){j+=h.na;g.push(c)}}return{seq:j,list:g}},hairpin:function(q){var n=[];var g=q.length/3;if(g>this.kMaxEndLength){g=this.kMaxEndLength}for(var h=0;h<g;++h){for(var j=0;j<g;++j){var d=h;var f=q.length-1-j;var l=[];for(var c=0;c<q.length;++c){if(f-d<this.kMinCircelSize){break}if(d>=f||!this.canPair(q.substr(d,1),q.substr(f,1))){break}l.push({i1:d,i2:f});++d;--f}if(l.length>n.length){n=l}}}return n},duplex:function(j,l){var h=[];for(var d=0;d<j.length;++d){for(var f=l.length-1;f>=0;--f){var g=[];for(var c=0;c<j.length;++c){if(d>=j.length||f<0||!this.canPair(j.substr(d,1),l.substr(f,1))){break}g.push({i1:d,i2:f});++d;--f}if(g.length>h.length){h=g}}}return h},canPair:function(c,d){return this.pairs[c+d]||this.pairs[d+c]}};scil.helm.Layout.optimize=function(t,B,A){var x=t.m;if(typeof(Springy)=="undefined"||x.atoms.length==0){return}var l=new Springy.Graph();x.resetIds();var y={};var h=scil.helm.Chain.getChains(x);for(var q=0;q<h.length;++q){var d=h[q].atoms;for(var u=0;u<d.length;++u){var c=d[u];var j=l.newNode({label:c.id});y[c.id]={a:c,g:j}}}for(var q=0;q<x.bonds.length;++q){var f=x.bonds[q];if(y[f.a1.id]!=null&&y[f.a2.id]!=null){l.newEdge(y[f.a1.id].g,y[f.a2.id].g)}}var w=new Springy.Layout.ForceDirected(l,400,400,0.5,1);var z=0;var C=new Springy.Renderer(w,function(g){++z;scil.Progress.update(z*100/1000,z+" loops, chaos factor: "+Math.round(g))},function(){},function(){},function(g,n){},function(){w.eachNode(function(n,G){y[n.data.label].p=G.p});for(var D in y){var F=y[D];if(!scil.Utils.isNumber(F.p.x)||!scil.Utils.isNumber(F.p.y)){return}F.a.p=new JSDraw2.Point(F.p.x,F.p.y)}for(var g=0;g<h.length;++g){h[g].layoutBases()}var E=x.medBondLength();x.scale(t.bondlength*scil.helm.bondscale/E);scil.Progress.hide();if(A!=null){A(t)}});scil.Progress.show("Layout Sequence ...",function(){w.stop()});C.start()};scil.helm.Plugin.prototype.optimize=function(){var c=this.jsd.clone();scil.helm.Layout.optimize(this.jsd,function(d){},function(d){d.pushundo(c);d.fitToWindow();d.refresh(true)})};scil.helm.Interface.addToolbar=function(c,d,n,j){if(j.toolbarmode=="helm"){c.push({c:"new",t:"New",label:"New"});c.push({c:"open",t:"Load",label:"Load"});c.push({c:"save",t:"Save",label:"Save"});c.push({c:"|"})}var f=false;var l=j==null||!j.showmonomerexplorer;var n=[{c:"helm_aa",t:"Peptide",label:"Peptide",hidden:f},{c:"helm_nucleotide",t:"Nucleotide",label:"Nucleotide",hidden:f},{c:"helm_base",t:"Base",label:"Base",hidden:f},{c:"helm_sugar",t:"Sugar",label:"Sugar",hidden:f},{c:"helm_linker",t:"Linker",label:"Linker",hidden:f},{c:"helm_chem",t:"Chemistry",label:"Chemistry",hidden:f}];if(!d){n.push({c:"helm_import",t:"Import Sequence",label:"Import",tooltips:"Import Sequence"});n.push({c:"helm_find",t:"Find/Replace",label:"Find/Replace"});n.push({c:"helm_layout",t:"Clean",label:"Clean"})}n.push({c:"antibody",t:"Antibody",label:"Antibody"});n.push({c:"protein",t:"Protein",label:"Protein"});if((j==null||j.toolbarmode!="helm")&&l){n.push({c:"helm_editor",t:"Show Editor",label:"Editor",tooltips:"Show Popup Editor"})}var h={c:"helm_mex",t:"Monomers",label:"Monomers",tooltips:"Monomer Explorer",hidden:f};if(d){c.push(h);for(var g=0;g<n.length;++g){c.push(n[g])}}else{h.sub=n;c.push(h)}};scil.helm.Monomers.getAliases=function(c){if(this.aliasset[c]!=null){return this.aliasset[c]}var d=this.aliasset[c]={};var l=this.getMonomerSet(c);if(l==null){return null}for(var g in l){var h=l[g];if(h.aliases!=null){for(var f=0;f<h.aliases.length;++f){var j=scil.helm.symbolCase(h.aliases[f]);if(d[j]==null){d[j]=h}}}}return d};